{"repo": "AntennaPod/AntennaPod", "pull_number": 7885, "instance_id": "AntennaPod__AntennaPod-7885", "issue_numbers": ["7825"], "base_commit": "c4dc0ae9eec957fa7124e068ef9e55eb6175f35e", "patch": "diff --git a/app/src/main/res/layout/addfeed.xml b/app/src/main/res/layout/addfeed.xml\nindex 730cb8b64d..bf7532b4be 100644\n--- a/app/src/main/res/layout/addfeed.xml\n+++ b/app/src/main/res/layout/addfeed.xml\n@@ -38,7 +38,7 @@\n \n             <androidx.cardview.widget.CardView\n                 android:layout_width=\"match_parent\"\n-                android:layout_height=\"56dp\"\n+                android:layout_height=\"wrap_content\"\n                 android:layout_marginTop=\"8dp\"\n                 android:layout_marginBottom=\"8dp\"\n                 android:layout_marginHorizontal=\"16dp\"\n", "test_patch": "", "problem_statement": "The search box placeholder text on the 'Add podcast' screen is moved up\n### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [x] I will describe the problem with as much detail as possible.\n- [x] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.8.0\n\n### Android version\n\n15\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n![Image](https://github.com/user-attachments/assets/25b595ee-2720-4930-990c-f7a92a02d63b)\n\n### Expected behaviour\n\n_No response_\n\n### Current behaviour\n\n_No response_\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2025-07-17T15:32:38Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7884, "instance_id": "AntennaPod__AntennaPod-7884", "issue_numbers": ["7837"], "base_commit": "c4dc0ae9eec957fa7124e068ef9e55eb6175f35e", "patch": "diff --git a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\nindex 08cbbcdc73..b26d13d2ba 100644\n--- a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\n+++ b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\n@@ -454,7 +454,8 @@ private List<MediaBrowserCompat.MediaItem> loadChildrenSynchronous(@NonNull Stri\n                     new FeedItemFilter(FeedItemFilter.DOWNLOADED), UserPreferences.getDownloadsSortedOrder());\n         } else if (parentId.equals(getResources().getString(R.string.episodes_label))) {\n             feedItems = DBReader.getEpisodes(0, MAX_ANDROID_AUTO_EPISODES_PER_FEED,\n-                    new FeedItemFilter(FeedItemFilter.UNPLAYED), UserPreferences.getAllEpisodesSortOrder());\n+                    new FeedItemFilter(UserPreferences.getPrefFilterAllEpisodes()),\n+                    UserPreferences.getAllEpisodesSortOrder());\n         } else if (parentId.startsWith(\"FeedId:\")) {\n             long feedId = Long.parseLong(parentId.split(\":\")[1]);\n             feedItems = DBReader.getFeed(feedId, true, 0, MAX_ANDROID_AUTO_EPISODES_PER_FEED).getItems();\n", "test_patch": "", "problem_statement": "Episodes screen in Android Auto doesn't apply filters\n### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [x] I will describe the problem with as much detail as possible.\n- [x] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.8.0\n\n### Android version\n\nAndroid 13\n\n### Device model\n\nOnePlus Nord CE\n\n### First occurred\n\n>1 month ago (as long as I've been using Android Auto)\n\n### Steps to reproduce\n\n1. Start AntennaPod on the phone\n2. Apply a filter to the _Episodes_ tab\n3. Start AntennaPod in Android Auto\n4. Check the _Episodes_ tab\n\n### Expected behaviour\n\nThe episode list to match between Android and Android Auto views, including filters.\n\nIn my case, I have the view filtered to _Not played_ and _Downloaded_.\n\n### Current behaviour\n\nAll episodes are shown via Android Auto, making it tricky to find the next one I haven't played yet.\n\n#6888 was recently noticed to be fixed, though that only applies to individual podcasts' episode lists rather than the top-level screen.\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2025-07-17T15:23:41Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7880, "instance_id": "AntennaPod__AntennaPod-7880", "issue_numbers": ["7866"], "base_commit": "21a4d7d876e1bb72c988a544af645c38ec2aff98", "patch": "diff --git a/app/proguard.cfg b/app/proguard.cfg\nindex 1fd4cc5013..135640340a 100644\n--- a/app/proguard.cfg\n+++ b/app/proguard.cfg\n@@ -31,7 +31,11 @@\n # android-iconify\n -keep class com.joanzapata.** { *; }\n \n+# RxJava\n+-keep class io.reactivex.Single\n+\n #### Proguard rules for fyyd client\n+-keep class de.mfietz.fyydlin.** { *; }\n # Retrofit 2.0\n -dontwarn retrofit2.**\n -keep class retrofit2.** { *; }\n", "test_patch": "", "problem_statement": "IllegalArgumentException when searching fyyd\n### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [x] I will describe the problem with as much detail as possible.\n- [x] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.8.0f (f68387199)\n\n### Android version\n\n11 \n\n### Device model\n\nOnePlus 7 Pro\n\n### First occurred\n\nToday\n\n### Steps to reproduce\n\n1. Go to \"Add podcast\"\n2. Tap \"Search fyyd\"\n3. Enter text to search for (e.g. \"Future Knowledge\" or \"Serious Trouble\")\n4. Press Enter\n\n### Expected behaviour\n\nI expected AntennaPod to either display podcasts to pick from or say no results were found\n\n### Current behaviour\n\nI get\n```\njava.lang.IllegalArgumentException: Unable to create call adapter for class io.reactivex.Single\n    for method FyydService.searchPodcasts\n```\n\n![Image](https://github.com/user-attachments/assets/e2c3cf7a-78da-4248-a553-c5839c5cb150)\n\n### Logs\n\n[full-logs.txt](https://github.com/user-attachments/files/21084257/full-logs.txt)\n\nEdit: fix autocorrected text\n", "hints_text": "I can reproduce this bug on:\n\n### App version\n3.8.0 (095f60da8)\n\n### Android version\n14\n\n### Device model\nShiftPhone 8.1\n\nHowever, I cannot reproduce it with a **development build** from the same commit on either emulators or a real device.\n\nTo reproduce it, a **release build** is needed; the error can then be reproduced on the emulator as well.\n\n## Possible solution\n\nThis seems to have to do with minification. I played around and the following proguard rules are the minimum I found to keep the classes whose removal produce the expetion:\n```\n# RxJava\n-keep,allowobfuscation,allowshrinking class io.reactivex.Single\n\n# Fyyd\n-keep class de.mfietz.fyydlin.** { *; }\n```\n\nAs I am not an expert on proguard (and don't have the actual release keys), I would leave this up to @ByteHamster or someone with similar experience.\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/needs-decision-meeting-updates/4169/26\n", "created_at": "2025-07-16T20:20:27Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7879, "instance_id": "AntennaPod__AntennaPod-7879", "issue_numbers": ["7861"], "base_commit": "21a4d7d876e1bb72c988a544af645c38ec2aff98", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/SearchFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/SearchFragment.java\nindex b92ffc81c4..a7c6c556b8 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/SearchFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/SearchFragment.java\n@@ -159,7 +159,7 @@ public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMen\n             protected void onSelectedItemsUpdated() {\n                 super.onSelectedItemsUpdated();\n                 FeedItemMenuHandler.onPrepareMenu(floatingSelectMenu.getMenu(), getSelectedItems(),\n-                        R.id.add_to_queue_item, R.id.remove_inbox_item);\n+                        R.id.remove_inbox_item);\n                 floatingSelectMenu.updateItemVisibility();\n             }\n         };\n", "test_patch": "", "problem_statement": "Add more actions like \"add to playlist\" on search multi selection\n### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [x] I will describe the problem with as much detail as possible.\n- [x] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.8.0f\n\n### Feature or improvement you want\n\nWhen searching episode in a podcast, I would like to be able to make a multi selection and add them to my playlist\n\n### Why should this be added?\n\nI'm using AntennaPod for my kids to listen to kids' stories podcasts. Often they want to listen to the whole thing multiple times. Some of those podcasts have misc episodes, like \"news from the podcast\" that they are not interested in. An easy way around that would be to search for a pattern (e.g. the stories episodes are named \"number - title\", I search for \" - \" and I get them all without the \"news from the podcast\" ones) and add all the results, or most of them. \n\nToday I'm selecting them one by one, \"add to playlist\". Very tedious with 100+ episodes. I can already select multiple episodes in the search, it just miss the \"add to playlist\" button.\n\nQuite similarly, I could use now and then the other actions like \"mark as read\" or \"reset position\".\n\nThanks ! \ud83d\ude4f\ud83c\udfff \n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "", "created_at": "2025-07-16T19:49:41Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7870, "instance_id": "AntennaPod__AntennaPod-7870", "issue_numbers": ["7611"], "base_commit": "21a4d7d876e1bb72c988a544af645c38ec2aff98", "patch": "diff --git a/ui/common/src/main/java/de/danoeh/antennapod/ui/common/PagedToolbarFragment.java b/ui/common/src/main/java/de/danoeh/antennapod/ui/common/PagedToolbarFragment.java\nindex 48793ff1362..2b6355b819e 100644\n--- a/ui/common/src/main/java/de/danoeh/antennapod/ui/common/PagedToolbarFragment.java\n+++ b/ui/common/src/main/java/de/danoeh/antennapod/ui/common/PagedToolbarFragment.java\n@@ -23,11 +23,21 @@ protected void setupPagedToolbar(final MaterialToolbar toolbar, final ViewPager2\n             return false;\n         });\n         viewPager.registerOnPageChangeCallback(new ViewPager2.OnPageChangeCallback() {\n+            private int selectedPosition = 0;\n+\n             @Override\n             public void onPageSelected(int position) {\n-                Fragment child = getChildFragmentManager().findFragmentByTag(\"f\" + position);\n-                if (child != null) {\n-                    child.onPrepareOptionsMenu(toolbar.getMenu());\n+                selectedPosition = position;\n+            }\n+\n+            @Override\n+            public void onPageScrollStateChanged(int state) {\n+                super.onPageScrollStateChanged(state);\n+                if (state == ViewPager2.SCROLL_STATE_IDLE) {\n+                    Fragment child = getChildFragmentManager().findFragmentByTag(\"f\" + selectedPosition);\n+                    if (child != null) {\n+                        child.onPrepareOptionsMenu(toolbar.getMenu());\n+                    }\n                 }\n             }\n         });\n", "test_patch": "", "problem_statement": "`onPrepareOptionsMenu` not run on first tab switch in statistics\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n### App version\r\n\r\ncommit 99a6c96\r\n\r\n### Android version\r\n\r\n15\r\n\r\n### Device model\r\n\r\nsdk_gphone64_x86_64 (Emulator in Android Studio)\r\n\r\n### First occurred\r\n\r\nAt least 3.6.1f (8ec7d08e2) onwards, might've been happening longer\r\n\r\n### Steps to reproduce\r\n\r\n1. Open subscriptions tab\r\n2. Open statistics page\r\n3. Select either of the other tabs (Years/Downloads)\r\n\r\n### Expected behaviour\r\n\r\nFilter button disappears, Reset option disappears for downloads tab, stays for years tab.\r\n\r\n### Current behaviour\r\n\r\nFilter button remains, but is non-functional. \"Reset statistics data\" seems to be functional.\r\nAppears to work normally on subsequent tab switches.\r\n\r\nI noticed this on my own phone (FP4 with A13 and latest fdroid release) and replicated with the emulator in Android Studio with latest git (see screen recording)\r\n\r\n[2025-01-15 00:30.webm](https://github.com/user-attachments/assets/6a21aa08-7e9d-4d89-aa98-8abcdab79265)\r\n\r\n\r\n### Logs\r\n\r\n_No response_\n", "hints_text": "will year filter will show same Filter as subscription?\nIs anyone working on it? Otherwise I can take a look\n> will year filter will show same Filter as subscription?\n\nThe filter menu itself does not actually open, only the icon/button remains\n\n> Is anyone working on it? Otherwise I can take a look\n\nAfaik noone is currently working on this, though I don't see behind the scenes ofc\n> Is anyone working on it?\n\nIf there is no comment that someone is working on it, you are welcome to pick it up :)\n\n> Otherwise I can take a look\n\nNote that I'm not sure how easy it is to solve this issue. If you want to get familiar with the AntennaPod code base, it might be better to start with an issue labelled \"good first issue\".", "created_at": "2025-07-09T08:28:59Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7862, "instance_id": "AntennaPod__AntennaPod-7862", "issue_numbers": ["7767"], "base_commit": "b65062d18da572c6c48793073d76f17f42799a62", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\nindex c75048a7b7..eecc448954 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\n@@ -104,6 +104,7 @@ public class FeedItemlistFragment extends Fragment implements AdapterView.OnItem\n     private Feed feed;\n     private Disposable disposable;\n     private FeedItemListFragmentBinding viewBinding;\n+    private Pair<Integer, Integer> scrollPosition = null;\n \n     /**\n      * Creates new ItemlistFragment which shows the Feeditems of a specific\n@@ -248,6 +249,12 @@ private void updateRecyclerPadding() {\n                 viewBinding.recyclerView.getPaddingRight(), paddingBottom);\n     }\n \n+    @Override\n+    public void onPause() {\n+        super.onPause();\n+        scrollPosition = viewBinding.recyclerView.getScrollPosition();\n+    }\n+\n     @Override\n     public void onDestroyView() {\n         super.onDestroyView();\n@@ -654,6 +661,8 @@ private void loadItems() {\n                         adapter.updateItems(feed.getItems());\n                         adapter.setTotalNumberOfItems(result.second);\n                         updateToolbar();\n+                        viewBinding.recyclerView.restoreScrollPosition(scrollPosition);\n+                        scrollPosition = null;\n                     }, error -> {\n                         feed = null;\n                         refreshHeaderView();\ndiff --git a/app/src/main/res/layout/feed_item_list_fragment.xml b/app/src/main/res/layout/feed_item_list_fragment.xml\nindex f2535bfbde..7344d2d73a 100644\n--- a/app/src/main/res/layout/feed_item_list_fragment.xml\n+++ b/app/src/main/res/layout/feed_item_list_fragment.xml\n@@ -2,6 +2,7 @@\n <androidx.coordinatorlayout.widget.CoordinatorLayout\n     xmlns:android=\"http://schemas.android.com/apk/res/android\"\n     xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    android:id=\"@+id/coordinatorLayout\"\n     android:layout_width=\"match_parent\"\n     android:layout_height=\"match_parent\"\n     android:fitsSystemWindows=\"true\">\n", "test_patch": "", "problem_statement": "Remember position in episode list on the podcast preview screen\n### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [x] I will describe the problem with as much detail as possible.\n- [x] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.8.0\n\n### Feature or improvement you want\n\nAs mentioned in [#7697](https://github.com/AntennaPod/AntennaPod/issues/7697#issuecomment-2817089489), it would be great to also remember the position in the list of episodes on the podcast preview screen too.\n\nCurrently, each time one goes back after previewing a specific episode, the position in the list is lost (as the fragment gets re-created).\n\n### Why should this be added?\n\nIf a user is previewing older episodes, they currently need to scroll manually to find the position in the list again.\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "", "created_at": "2025-07-01T13:27:57Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7855, "instance_id": "AntennaPod__AntennaPod-7855", "issue_numbers": ["7853"], "base_commit": "e818aefd1338078c8a58ea812fcfdaa4b05eac7a", "patch": "diff --git a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\nindex 17b6246be7..08cbbcdc73 100644\n--- a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\n+++ b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\n@@ -390,8 +390,7 @@ private MediaBrowserCompat.MediaItem createBrowsableMediaItemForFeed(Feed feed)\n         MediaDescriptionCompat.Builder builder = new MediaDescriptionCompat.Builder()\n                 .setMediaId(\"FeedId:\" + feed.getId())\n                 .setTitle(feed.getTitle())\n-                .setDescription(feed.getDescription())\n-                .setSubtitle(feed.getCustomTitle());\n+                .setDescription(feed.getDescription());\n         if (feed.getImageUrl() != null) {\n             builder.setIconUri(Uri.parse(feed.getImageUrl()));\n         }\n", "test_patch": "", "problem_statement": "Android Auto custom feed title duplicated when set\n### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [x] I will describe the problem with as much detail as possible.\n- [x] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.8.0\n\n### Android version\n\nAndroid 13\n\n### Device model\n\nOnePlus Nord CE\n\n### First occurred\n\n\\>1 month ago (as long as I've been using Android Auto)\n\n### Steps to reproduce\n\n1. Set a custom title for a feed\n2. View it in the feed list at Android Auto > More\n\n### Expected behaviour\n\nGiven the subtitle is set, presumably the feed's own title and the custom one.\n\n### Current behaviour\n\nThe custom title appears twice;\n\n![Feed list with duplicate title](https://github.com/user-attachments/assets/db85209b-d6ad-47c5-a362-bd676a54aa42)\n\nThis happens because the title defaults to the custom title if set, and the subtitle is explicitly set to the custom title:\n\nhttps://github.com/AntennaPod/AntennaPod/blob/e818aefd1338078c8a58ea812fcfdaa4b05eac7a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java#L390-L394\n\nhttps://github.com/AntennaPod/AntennaPod/blob/e818aefd1338078c8a58ea812fcfdaa4b05eac7a/model/src/main/java/de/danoeh/antennapod/model/feed/Feed.java#L274-L276\n\nWe probably want `.setTitle(feed.getFeedTitle())`, perhaps flipping them so that the user's custom title is preferred?\n\n### Logs\n\n_No response_\n", "hints_text": "Instead of showing both, shouldn't we just remove the subtitle and only ever show the custom title?\nI was thinking about this earlier -- it does seem a bit redundant when I've explicitly chosen a custom name (in particular for me when this is typically to remove taglines etc. from feed names).\n\nThe subtitle slot could perhaps be used for something else (number of available episodes?), or just left out to keep the list clean.\nI would just leave it clean for now. It's for using in a car after all :)", "created_at": "2025-06-26T23:25:33Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7830, "instance_id": "AntennaPod__AntennaPod-7830", "issue_numbers": ["7809"], "base_commit": "c3a1f3a98e8040f10a862fc7acac56810f5a586a", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/episode/ItemFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/episode/ItemFragment.java\nindex 07d40490fa..9cabd04bda 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/episode/ItemFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/episode/ItemFragment.java\n@@ -1,5 +1,7 @@\n package de.danoeh.antennapod.ui.screen.episode;\n \n+import android.content.ClipData;\n+import android.content.ClipboardManager;\n import android.content.Context;\n import android.os.Build;\n import android.os.Bundle;\n@@ -189,9 +191,28 @@ public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container,\n             }\n             actionButton2.onClick(getContext());\n         });\n+        txtvPodcast.setOnLongClickListener(v -> {\n+            copyToClipboard(requireContext(), txtvPodcast.getText().toString());\n+            return true;\n+        });\n+        txtvTitle.setOnLongClickListener(v -> {\n+            copyToClipboard(requireContext(), txtvTitle.getText().toString());\n+            return true;\n+        });\n         return layout;\n     }\n \n+    public void copyToClipboard(Context context, String text) {\n+        ClipboardManager clipboard = (ClipboardManager) context.getSystemService(Context.CLIPBOARD_SERVICE);\n+        if (clipboard != null) {\n+            ClipData clip = ClipData.newPlainText(text, text);\n+            clipboard.setPrimaryClip(clip);\n+            if (Build.VERSION.SDK_INT <= 32) {\n+                EventBus.getDefault().post(new MessageEvent(getString(R.string.copied_to_clipboard)));\n+            }\n+        }\n+    }\n+\n     private void showOnDemandConfigBalloon(boolean offerStreaming) {\n         final boolean isLocaleRtl = TextUtils.getLayoutDirectionFromLocale(Locale.getDefault())\n                 == View.LAYOUT_DIRECTION_RTL;\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedInfoFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedInfoFragment.java\nindex e139347eee..baf5722a15 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedInfoFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedInfoFragment.java\n@@ -2,6 +2,7 @@\n \n import android.content.ActivityNotFoundException;\n import android.content.ClipData;\n+import android.content.ClipboardManager;\n import android.content.Context;\n import android.content.Intent;\n import android.content.res.Configuration;\n@@ -15,6 +16,7 @@\n import android.view.MenuItem;\n import android.view.View;\n import android.view.ViewGroup;\n+\n import androidx.activity.result.ActivityResultLauncher;\n import androidx.activity.result.contract.ActivityResultContracts;\n import androidx.annotation.NonNull;\n@@ -82,14 +84,7 @@ public static FeedInfoFragment newInstance(Feed feed) {\n         @Override\n         public void onClick(View v) {\n             if (feed != null && feed.getDownloadUrl() != null) {\n-                String url = feed.getDownloadUrl();\n-                ClipData clipData = ClipData.newPlainText(url, url);\n-                android.content.ClipboardManager cm = (android.content.ClipboardManager) getContext()\n-                        .getSystemService(Context.CLIPBOARD_SERVICE);\n-                cm.setPrimaryClip(clipData);\n-                if (Build.VERSION.SDK_INT <= 32) {\n-                    EventBus.getDefault().post(new MessageEvent(getString(R.string.copied_to_clipboard)));\n-                }\n+                copyToClipboard(requireContext(), feed.getDownloadUrl());\n             }\n         }\n     };\n@@ -128,7 +123,14 @@ public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup c\n             StatisticsFragment fragment = new StatisticsFragment();\n             ((MainActivity) getActivity()).loadChildFragment(fragment, TransitionEffect.SLIDE);\n         });\n-\n+        viewBinding.header.txtvTitle.setOnLongClickListener(v -> {\n+            copyToClipboard(requireContext(), viewBinding.header.txtvTitle.getText().toString());\n+            return true;\n+        });\n+        viewBinding.header.txtvAuthor.setOnLongClickListener(v -> {\n+            copyToClipboard(requireContext(), viewBinding.header.txtvAuthor.getText().toString());\n+            return true;\n+        });\n         return viewBinding.getRoot();\n     }\n \n@@ -164,6 +166,17 @@ public void onConfigurationChanged(@NonNull Configuration newConfig) {\n                 horizontalSpacing, viewBinding.infoContainer.getPaddingBottom());\n     }\n \n+    public void copyToClipboard(Context context, String text) {\n+        ClipboardManager clipboard = (ClipboardManager) context.getSystemService(Context.CLIPBOARD_SERVICE);\n+        if (clipboard != null) {\n+            ClipData clip = ClipData.newPlainText(text, text);\n+            clipboard.setPrimaryClip(clip);\n+            if (Build.VERSION.SDK_INT <= 32) {\n+                EventBus.getDefault().post(new MessageEvent(getString(R.string.copied_to_clipboard)));\n+            }\n+        }\n+    }\n+\n     private void showFeed() {\n         Log.d(TAG, \"Language is \" + feed.getLanguage());\n         Log.d(TAG, \"Author is \" + feed.getAuthor());\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\nindex 91fa9e7ddf..c75048a7b7 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\n@@ -1,7 +1,11 @@\n package de.danoeh.antennapod.ui.screen.feed;\n \n+import android.content.ClipData;\n+import android.content.ClipboardManager;\n+import android.content.Context;\n import android.content.res.Configuration;\n import android.graphics.LightingColorFilter;\n+import android.os.Build;\n import android.os.Bundle;\n import android.util.Log;\n import android.view.ContextMenu;\n@@ -554,6 +558,25 @@ private void setupHeaderView() {\n             FeedItemFilterDialog.newInstance(feed).show(getChildFragmentManager(), null);\n         });\n         viewBinding.header.txtvFailure.setOnClickListener(v -> showErrorDetails());\n+        viewBinding.header.txtvAuthor.setOnLongClickListener(view -> {\n+            copyToClipboard(requireContext(), viewBinding.header.txtvAuthor.getText().toString());\n+            return true;\n+        });\n+        viewBinding.header.txtvTitle.setOnLongClickListener(view -> {\n+            copyToClipboard(requireContext(), viewBinding.header.txtvTitle.getText().toString());\n+            return true;\n+        });\n+    }\n+\n+    public void copyToClipboard(Context context, String text) {\n+        ClipboardManager clipboard = (ClipboardManager) context.getSystemService(Context.CLIPBOARD_SERVICE);\n+        if (clipboard != null) {\n+            ClipData clip = ClipData.newPlainText(text, text);\n+            clipboard.setPrimaryClip(clip);\n+            if (Build.VERSION.SDK_INT <= 32) {\n+                EventBus.getDefault().post(new MessageEvent(getString(R.string.copied_to_clipboard)));\n+            }\n+        }\n     }\n \n     private void showErrorDetails() {\n", "test_patch": "", "problem_statement": "Enable copying podcast title and host\n### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [x] I will describe the problem with as much detail as possible.\n- [x] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.8.0\n\n### Feature or improvement you want\n\nMake podcast title and host selectable and copable.\n\n### Why should this be added?\n\nCurrently, Shownotes (description) can be copied, but individual podcast title and host cannot. It would be super helpful if titles and hosts were selectable too \u2014making it easier to reference and share them without extra steps.\n\nPlease let me know if they should be split into multiple issues :)\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "This issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/needs-decision-meeting-updates/4169/23\n\nHello, I would like to work on this.\nHi @GiannisMakris \nGreat! Please go ahead \u2013 you can submit a PR. For introductory info about code style, asking questions, etc: https://antennapod.org/contribute/develop/app", "created_at": "2025-06-02T19:51:10Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7829, "instance_id": "AntennaPod__AntennaPod-7829", "issue_numbers": ["7743"], "base_commit": "a244fe08970c8879b0dc8791e0fbe22cc99305c2", "patch": "diff --git a/net/common/src/main/java/de/danoeh/antennapod/net/common/AntennapodHttpClient.java b/net/common/src/main/java/de/danoeh/antennapod/net/common/AntennapodHttpClient.java\nindex 0a5231172df..7686a862cf3 100644\n--- a/net/common/src/main/java/de/danoeh/antennapod/net/common/AntennapodHttpClient.java\n+++ b/net/common/src/main/java/de/danoeh/antennapod/net/common/AntennapodHttpClient.java\n@@ -63,7 +63,7 @@ public static OkHttpClient.Builder newBuilder() {\n \n         OkHttpClient.Builder builder = new OkHttpClient.Builder();\n         builder.interceptors().add(new BasicAuthorizationInterceptor());\n-        builder.networkInterceptors().add(new UserAgentInterceptor());\n+        builder.interceptors().add(new UserAgentInterceptor());\n \n         // set cookie handler\n         CookieManager cm = new CookieManager();\ndiff --git a/ui/glide/src/main/java/de/danoeh/antennapod/ui/glide/ApOkHttpUrlLoader.java b/ui/glide/src/main/java/de/danoeh/antennapod/ui/glide/ApOkHttpUrlLoader.java\nindex d66f08ec8f6..e8794f9e976 100644\n--- a/ui/glide/src/main/java/de/danoeh/antennapod/ui/glide/ApOkHttpUrlLoader.java\n+++ b/ui/glide/src/main/java/de/danoeh/antennapod/ui/glide/ApOkHttpUrlLoader.java\n@@ -14,6 +14,7 @@\n import de.danoeh.antennapod.model.feed.FeedMedia;\n import de.danoeh.antennapod.net.common.AntennapodHttpClient;\n import de.danoeh.antennapod.net.common.NetworkUtils;\n+import de.danoeh.antennapod.net.common.UserAgentInterceptor;\n import okhttp3.Interceptor;\n import okhttp3.OkHttpClient;\n import okhttp3.Protocol;\n@@ -42,6 +43,7 @@ private static OkHttpClient getInternalClient() {\n                     if (internalClient == null) {\n                         OkHttpClient.Builder builder = AntennapodHttpClient.newBuilder();\n                         builder.interceptors().add(new NetworkAllowanceInterceptor());\n+                        builder.interceptors().add(new UserAgentInterceptor());\n                         builder.cache(null); // Handled by Glide\n                         internalClient = builder.build();\n                     }\n", "test_patch": "", "problem_statement": "Wrong User-Agent for various places\n### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [x] I will describe the problem with as much detail as possible.\n- [x] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.7\n\n### Android version\n\n15\n\n### Device model\n\nPixel 7a\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\nThis probably is causing AntennaPod market share to be under-counted by *a lot*\n\n1) Build AntennaPod inspect the network packets\n2) Use the app like a normal user\n2) Look at the request header to check the user-agent\n\nThe list of very important requests are download button, subscription screen showing the top 25 podcasts and the stream media\n\nThese [urls](https://raw.githubusercontent.com/tonytamsf/blobs/refs/heads/main/bad-agent/connections.json) are in the attached connections.json from the Android Network Inspector\n\n```\nhttps://coachvaleriegreene.com/podcast-download/4852/judith.mp3\n\nhttps://itunes.apple.com/US/rss/toppodcasts/limit=25/explicit=true/json\n\nhttps://nyt.simplecastaudio.com/3026b665-46df-4d18-98e9-d1ce16bbb1df/episodes/fa31105c-900b-40c0-bdb0-2e9e2a86957f/audio/128/default.mp3/default.mp3_ywr3ahjkcgo_3f5931fd37ccec6ec70eabc8e0281f2f_51367330.mp3?aid=rss_feed&awCollectionId=3026b665-46df-4d18-98e9-d1ce16bbb1df&awEpisodeId=fa31105c-900b-40c0-bdb0-2e9e2a86957f&feed=kEKXbjuJ&hash_redirect=1&x-total-bytes=51367330&x-ais-classified=unclassified&listeningSessionID=0CD_382_96__e64852b2149d51c37c95730e10664756b95f986b\n```\n\n### Expected behaviour\n\nExpect the `user-agent` to be AntennaPod/3.7.0 \n\n\n\n\n### Current behaviour\n\nbut see `okhttp/4.12.0`\n\n### Logs\n\n_No response_\n", "hints_text": "Here is network export of the data https://raw.githubusercontent.com/tonytamsf/blobs/refs/heads/main/bad-agent/connections.json\n\nHere is the callstack\n\n<img width=\"649\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/470c51f8-11b5-407f-9329-3ea532755fae\" />\n\n<img width=\"636\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/5939c689-b7e2-4b69-8a52-0f7d24637954\" />\nI think for the iTunes request, I would keep the current behavior. I would change as few things as possible there to avoid Apple somehow deciding to block us.\nJust so I am clear, @ByteHamster  - for iTunes, you would rather keep `okhttp/4.12.0` as the `User-Agent`?\nYes, I would keep it set to `okhttp/4.12.0` to not risk iTunes doing weird stuff. In another issue, we already had trouble with hosts having a user-agent white-list (where okhttp was on that whitelist but AntennaPod wasn't).\nWhen a site whitelist `okhttp` they are allowing all Android apps, that feels odd to do, but I get why you are hesitant.\n\nWe are trading off AntennaPod's traffic to searching, browsing to iTunes, not being recognized.  \n\nIf you just want me to send AntennaPod/x.y.z for downloading and streaming, I can work on that.    The code would be messy (I think)\n\nWhat does @keunes think about the tradeoff? and maybe bring in James Cridland into the conversation since he care about tracking podcast market share\nI would not expect Apple to make a decision to cut off AntennaPod. Their API is public and there are dozens of other apps with bigger traffic. If anything, that sounds more like a Google move. So I think the risk is limited. And if they were to block us and we don't have Discovery anymore, so be it (we still have search). Should that happen we can switch to another data provider, or we just change the user agent back to okhttp at that point.\n\nFor tracking and showcasing market share, excluding the iTunes calls wouldn't matter I think (because Apple won't release that data anyway)? But if it makes code more complex, I'd say we just keep it simple and take the (small) risk.\nYeah, if it's easier to fix everywhere including iTunes, we can do that :) Actually, I wonder why we don't already have it everywhere. We add the UserAgentInterceptor to the main HttpClient...\n> We add the UserAgentInterceptor to the main HttpClient...\n\nIn my testing, switching to using `interceptors()` and not `networkinterceptors()` seem to have fixed user-agent issues\n\nhttps://github.com/AntennaPod/AntennaPod/blob/4ce89e0fbaa26477a388ca3700b0ce4e4a05f23f/net/common/src/main/java/de/danoeh/antennapod/net/common/AntennapodHttpClient.java#L66\n\n", "created_at": "2025-05-31T09:11:45Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7824, "instance_id": "AntennaPod__AntennaPod-7824", "issue_numbers": ["7822"], "base_commit": "0478bb1af9d3b8140e1a430aeeeba12869c71987", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/ProxyDialog.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/ProxyDialog.java\nindex b8922207913..dd1e712a8be 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/ProxyDialog.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/ProxyDialog.java\n@@ -103,13 +103,8 @@ public Dialog show() {\n         ArrayAdapter<String> adapter = new ArrayAdapter<>(context,\n                 android.R.layout.simple_list_item_1, types);\n         viewBinding.proxyTypeSpinner.setAdapter(adapter);\n+        viewBinding.proxyTypeSpinner.setThreshold(999);\n         viewBinding.proxyTypeSpinner.setText(proxyConfig.type.name());\n-        viewBinding.proxyTypeSpinner.setOnClickListener(view -> {\n-            if (viewBinding.proxyTypeSpinner.getText().length() != 0) {\n-                viewBinding.proxyTypeSpinner.setText(\"\");\n-                viewBinding.proxyTypeSpinner.postDelayed(viewBinding.proxyTypeSpinner::showDropDown, 100);\n-            }\n-        });\n         viewBinding.proxyTypeSpinner.addTextChangedListener(new TextWatcher() {\n             @Override\n             public void beforeTextChanged(CharSequence s, int start, int count, int after) {\n", "test_patch": "", "problem_statement": "SOCKS not available as proxy type\n### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [x] I will describe the problem with as much detail as possible.\n- [x] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.8.0\n\n### Android version\n\n15\n\n### Device model\n\nHonor magic6 pro\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Open settings\n2. Goto downloads\n3. Add proxy\n4. Socks not available as type\n\n![Image](https://github.com/user-attachments/assets/16ecaea7-bfb5-40c6-bf99-ac43ec3edde5)\nScreenshot showing proxy type pulled down showing only DIRECT. \n\n### Expected behaviour\n\n_No response_\n\n### Current behaviour\n\n_No response_\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2025-05-27T21:13:52Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7815, "instance_id": "AntennaPod__AntennaPod-7815", "issue_numbers": ["7702"], "base_commit": "49e6da67271dead9d0a574c9ecbd70c35da18d36", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/swipeactions/RemoveFromHistorySwipeAction.java b/app/src/main/java/de/danoeh/antennapod/ui/swipeactions/RemoveFromHistorySwipeAction.java\nindex 4e89be62308..3d99a4cba84 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/swipeactions/RemoveFromHistorySwipeAction.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/swipeactions/RemoveFromHistorySwipeAction.java\n@@ -38,10 +38,10 @@ public String getTitle(Context context) {\n \n     @Override\n     public void performAction(FeedItem item, Fragment fragment, FeedItemFilter filter) {\n-        Date playbackCompletionDate = item.getMedia().getPlaybackCompletionDate();\n+        Date lastPlayedTimeHistory = item.getMedia().getLastPlayedTimeHistory();\n         DBWriter.deleteFromPlaybackHistory(item);\n         EventBus.getDefault().post(new MessageEvent(fragment.getString(R.string.removed_history_label),\n-                context -> DBWriter.addItemToPlaybackHistory(item.getMedia(), playbackCompletionDate),\n+                context -> DBWriter.addItemToPlaybackHistory(item.getMedia(), lastPlayedTimeHistory),\n                 fragment.getString(R.string.undo)));\n     }\n \ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItemFilter.java b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItemFilter.java\nindex 1faeda01220..08755fb18bc 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItemFilter.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItemFilter.java\n@@ -117,7 +117,7 @@ public boolean matches(FeedItem item) {\n         } else if (showNotFavorite && item.isTagged(FeedItem.TAG_FAVORITE)) {\n             return false;\n         } else if (showInHistory && item.getMedia() != null\n-                && item.getMedia().getPlaybackCompletionDate().getTime() == 0) {\n+                && item.getMedia().getLastPlayedTimeHistory().getTime() == 0) {\n             return false;\n         } else if (!includeNotSubscribed && item.getFeed() != null\n                 && item.getFeed().getState() != Feed.STATE_SUBSCRIBED) {\ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedMedia.java b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedMedia.java\nindex 88d6a77141c..91e41ce229f 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedMedia.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedMedia.java\n@@ -38,12 +38,12 @@ public class FeedMedia implements Playable {\n     private long downloadDate;\n     private int duration;\n     private int position; // Current position in file\n-    private long lastPlayedTime; // Last time this media was played (in ms)\n+    private long lastPlayedTimeStatistics; // Last time this media was played (in ms)\n     private int playedDuration; // How many ms of this file have been played\n     private long size; // File size in Byte\n     private String mimeType;\n     @Nullable private volatile FeedItem item;\n-    private Date playbackCompletionDate;\n+    private Date lastPlayedTimeHistory;\n     private int startPosition = -1;\n     private int playedDurationWhenStarted;\n \n@@ -66,8 +66,8 @@ public FeedMedia(FeedItem i, String downloadUrl, long size,\n \n     public FeedMedia(long id, FeedItem item, int duration, int position,\n                      long size, String mimeType, String localFileUrl, String downloadUrl,\n-                     long downloadDate, Date playbackCompletionDate, int playedDuration,\n-                     long lastPlayedTime) {\n+                     long downloadDate, Date lastPlayedTimeHistory, int playedDuration,\n+                     long lastPlayedTimeStatistics) {\n         this.localFileUrl = localFileUrl;\n         this.downloadUrl = downloadUrl;\n         this.downloadDate = downloadDate;\n@@ -80,17 +80,17 @@ public FeedMedia(long id, FeedItem item, int duration, int position,\n         this.playedDurationWhenStarted = playedDuration;\n         this.size = size;\n         this.mimeType = mimeType;\n-        this.playbackCompletionDate = playbackCompletionDate == null\n-                ? null : (Date) playbackCompletionDate.clone();\n-        this.lastPlayedTime = lastPlayedTime;\n+        this.lastPlayedTimeHistory = lastPlayedTimeHistory == null\n+                ? null : (Date) lastPlayedTimeHistory.clone();\n+        this.lastPlayedTimeStatistics = lastPlayedTimeStatistics;\n     }\n \n     public FeedMedia(long id, FeedItem item, int duration, int position,\n                      long size, String mimeType, String localFileUrl, String downloadUrl,\n-                     long downloadDate, Date playbackCompletionDate, int playedDuration,\n-                     Boolean hasEmbeddedPicture, long lastPlayedTime) {\n+                     long downloadDate, Date lastPlayedTimeHistory, int playedDuration,\n+                     Boolean hasEmbeddedPicture, long lastPlayedTimeStatistics) {\n         this(id, item, duration, position, size, mimeType, localFileUrl, downloadUrl, downloadDate,\n-                playbackCompletionDate, playedDuration, lastPlayedTime);\n+                lastPlayedTimeHistory, playedDuration, lastPlayedTimeStatistics);\n         this.hasEmbeddedPicture = hasEmbeddedPicture;\n     }\n \n@@ -178,8 +178,8 @@ public void setDuration(int duration) {\n     }\n \n     @Override\n-    public void setLastPlayedTime(long lastPlayedTime) {\n-        this.lastPlayedTime = lastPlayedTime;\n+    public void setLastPlayedTimeStatistics(long lastPlayedTimeStatistics) {\n+        this.lastPlayedTimeStatistics = lastPlayedTimeStatistics;\n     }\n \n     public int getPlayedDuration() {\n@@ -199,8 +199,8 @@ public int getPosition() {\n     }\n \n     @Override\n-    public long getLastPlayedTime() {\n-        return lastPlayedTime;\n+    public long getLastPlayedTimeStatistics() {\n+        return lastPlayedTimeStatistics;\n     }\n \n     public void setPosition(int position) {\n@@ -260,14 +260,14 @@ public void setItem(FeedItem item) {\n         }\n     }\n \n-    public Date getPlaybackCompletionDate() {\n-        return playbackCompletionDate == null\n-                ? null : (Date) playbackCompletionDate.clone();\n+    public Date getLastPlayedTimeHistory() {\n+        return lastPlayedTimeHistory == null\n+                ? null : (Date) lastPlayedTimeHistory.clone();\n     }\n \n-    public void setPlaybackCompletionDate(Date playbackCompletionDate) {\n-        this.playbackCompletionDate = playbackCompletionDate == null\n-                ? null : (Date) playbackCompletionDate.clone();\n+    public void setLastPlayedTimeHistory(Date lastPlayedTimeHistory) {\n+        this.lastPlayedTimeHistory = lastPlayedTimeHistory == null\n+                ? null : (Date) lastPlayedTimeHistory.clone();\n     }\n \n     public boolean isInProgress() {\n@@ -298,9 +298,9 @@ public void writeToParcel(Parcel dest, int flags) {\n         dest.writeString(localFileUrl);\n         dest.writeString(downloadUrl);\n         dest.writeLong(downloadDate);\n-        dest.writeLong((playbackCompletionDate != null) ? playbackCompletionDate.getTime() : 0);\n+        dest.writeLong((lastPlayedTimeHistory != null) ? lastPlayedTimeHistory.getTime() : 0);\n         dest.writeInt(playedDuration);\n-        dest.writeLong(lastPlayedTime);\n+        dest.writeLong(lastPlayedTimeStatistics);\n     }\n \n     @Override\ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/playback/Playable.java b/model/src/main/java/de/danoeh/antennapod/model/playback/Playable.java\nindex 8bf1c4e2065..c3fda817044 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/playback/Playable.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/playback/Playable.java\n@@ -61,7 +61,7 @@ public interface Playable extends Parcelable, Serializable {\n      * Returns last time (in ms) when this playable was played or 0\n      * if last played time is unknown.\n      */\n-    long getLastPlayedTime();\n+    long getLastPlayedTimeStatistics();\n \n     /**\n      * Returns the description of the item, if available.\n@@ -100,7 +100,7 @@ public interface Playable extends Parcelable, Serializable {\n     /**\n      * @param lastPlayedTimestamp  timestamp in ms\n      */\n-    void setLastPlayedTime(long lastPlayedTimestamp);\n+    void setLastPlayedTimeStatistics(long lastPlayedTimestamp);\n \n     /**\n      * This method should be called every time playback starts on this object.\ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/playback/RemoteMedia.java b/model/src/main/java/de/danoeh/antennapod/model/playback/RemoteMedia.java\nindex c979488a6a7..4e98add2c79 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/playback/RemoteMedia.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/playback/RemoteMedia.java\n@@ -40,7 +40,7 @@ public class RemoteMedia implements Playable {\n     private List<Chapter> chapters;\n     private int duration;\n     private int position;\n-    private long lastPlayedTime;\n+    private long lastPlayedTimeStatistics;\n \n     public RemoteMedia(String downloadUrl, String itemId, String feedUrl, String feedTitle,\n                        String episodeTitle, String episodeLink, String feedAuthor,\n@@ -159,8 +159,8 @@ public int getPosition() {\n     }\n \n     @Override\n-    public long getLastPlayedTime() {\n-        return lastPlayedTime;\n+    public long getLastPlayedTimeStatistics() {\n+        return lastPlayedTimeStatistics;\n     }\n \n     @Override\n@@ -194,8 +194,8 @@ public void setDuration(int newDuration) {\n     }\n \n     @Override\n-    public void setLastPlayedTime(long lastPlayedTimestamp) {\n-        lastPlayedTime = lastPlayedTimestamp;\n+    public void setLastPlayedTimeStatistics(long lastPlayedTimestamp) {\n+        lastPlayedTimeStatistics = lastPlayedTimestamp;\n     }\n \n     @Override\n@@ -255,7 +255,7 @@ public void writeToParcel(Parcel dest, int flags) {\n         dest.writeString(notes);\n         dest.writeInt(duration);\n         dest.writeInt(position);\n-        dest.writeLong(lastPlayedTime);\n+        dest.writeLong(lastPlayedTimeStatistics);\n     }\n \n     public static final Parcelable.Creator<RemoteMedia> CREATOR = new Parcelable.Creator<RemoteMedia>() {\n@@ -266,7 +266,7 @@ public RemoteMedia createFromParcel(Parcel in) {\n                     in.readString(), in.readString(), new Date(in.readLong()), in.readString());\n             result.setDuration(in.readInt());\n             result.setPosition(in.readInt());\n-            result.setLastPlayedTime(in.readLong());\n+            result.setLastPlayedTimeStatistics(in.readLong());\n             return result;\n         }\n \ndiff --git a/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/AutoDownloadManager.java b/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/AutoDownloadManager.java\nindex 2eb1d1b56ea..82cfc522db0 100644\n--- a/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/AutoDownloadManager.java\n+++ b/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/AutoDownloadManager.java\n@@ -29,7 +29,7 @@ public static void setInstance(AutoDownloadManager instance) {\n \n     /**\n      * Removed downloaded episodes outside of the queue if the episode cache is full. Episodes with a smaller\n-     * 'playbackCompletionDate'-value will be deleted first.\n+     * 'lastPlayedTimeHistory'-value will be deleted first.\n      * <p/>\n      * This method should NOT be executed on the GUI thread.\n      *\ndiff --git a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/autodownload/APCleanupAlgorithm.java b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/autodownload/APCleanupAlgorithm.java\nindex c8db7e7fd11..011f0169544 100644\n--- a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/autodownload/APCleanupAlgorithm.java\n+++ b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/autodownload/APCleanupAlgorithm.java\n@@ -47,8 +47,8 @@ public int performCleanup(Context context, int numberOfEpisodesToDelete) {\n         List<FeedItem> delete;\n \n         Collections.sort(candidates, (lhs, rhs) -> {\n-            Date l = lhs.getMedia().getPlaybackCompletionDate();\n-            Date r = rhs.getMedia().getPlaybackCompletionDate();\n+            Date l = lhs.getMedia().getLastPlayedTimeHistory();\n+            Date r = rhs.getMedia().getLastPlayedTimeHistory();\n \n             if (l == null) {\n                 l = new Date();\n@@ -105,8 +105,8 @@ private List<FeedItem> getCandidates() {\n                 // make sure this candidate was played at least the proper amount of days prior\n                 // to now\n                 if (media != null\n-                        && media.getPlaybackCompletionDate() != null\n-                        && media.getPlaybackCompletionDate().before(mostRecentDateForDeletion)) {\n+                        && media.getLastPlayedTimeHistory() != null\n+                        && media.getLastPlayedTimeHistory().before(mostRecentDateForDeletion)) {\n                     candidates.add(item);\n                 }\n             }\ndiff --git a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/autodownload/AutoDownloadManagerImpl.java b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/autodownload/AutoDownloadManagerImpl.java\nindex 2b0eb4d6293..dfcfaae9a80 100644\n--- a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/autodownload/AutoDownloadManagerImpl.java\n+++ b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/autodownload/AutoDownloadManagerImpl.java\n@@ -43,7 +43,7 @@ public Future<?> autodownloadUndownloadedItems(final Context context) {\n \n     /**\n      * Removed downloaded episodes outside of the queue if the episode cache is full. Episodes with a smaller\n-     * 'playbackCompletionDate'-value will be deleted first.\n+     * 'lastPlayedTimeHistory'-value will be deleted first.\n      * <p/>\n      * This method should NOT be executed on the GUI thread.\n      *\ndiff --git a/playback/base/src/main/java/de/danoeh/antennapod/playback/base/RewindAfterPauseUtils.java b/playback/base/src/main/java/de/danoeh/antennapod/playback/base/RewindAfterPauseUtils.java\nindex 3ea8e59c560..f8af620d7f1 100644\n--- a/playback/base/src/main/java/de/danoeh/antennapod/playback/base/RewindAfterPauseUtils.java\n+++ b/playback/base/src/main/java/de/danoeh/antennapod/playback/base/RewindAfterPauseUtils.java\n@@ -19,12 +19,12 @@ public abstract class RewindAfterPauseUtils {\n \n     /**\n      * @param currentPosition  current position in a media file in ms\n-     * @param lastPlayedTime  timestamp when was media paused\n+     * @param lastPlayedTimeStatistics  timestamp when was media paused\n      * @return  new rewinded position for playback in milliseconds\n      */\n-    public static int calculatePositionWithRewind(int currentPosition, long lastPlayedTime) {\n-        if (currentPosition > 0 && lastPlayedTime > 0) {\n-            long elapsedTime = System.currentTimeMillis() - lastPlayedTime;\n+    public static int calculatePositionWithRewind(int currentPosition, long lastPlayedTimeStatistics) {\n+        if (currentPosition > 0 && lastPlayedTimeStatistics > 0) {\n+            long elapsedTime = System.currentTimeMillis() - lastPlayedTimeStatistics;\n             long rewindTime = 0;\n \n             if (elapsedTime > ELAPSED_TIME_FOR_LONG_REWIND) {\ndiff --git a/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastPsmp.java b/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastPsmp.java\nindex 07a3639d962..44abdabab28 100644\n--- a/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastPsmp.java\n+++ b/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastPsmp.java\n@@ -334,7 +334,7 @@ private void playMediaObject(@NonNull final Playable playable, final boolean for\n     public void resume() {\n         int newPosition = RewindAfterPauseUtils.calculatePositionWithRewind(\n                         media.getPosition(),\n-                        media.getLastPlayedTime());\n+                        media.getLastPlayedTimeStatistics());\n         seekTo(newPosition);\n         remoteMediaClient.play();\n     }\n@@ -353,7 +353,7 @@ public void prepare() {\n             if (position > 0) {\n                 position = RewindAfterPauseUtils.calculatePositionWithRewind(\n                         position,\n-                        media.getLastPlayedTime());\n+                        media.getLastPlayedTimeStatistics());\n             }\n             remoteMediaClient.load(new MediaLoadRequestData.Builder()\n                     .setMediaInfo(remoteMedia)\ndiff --git a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/internal/LocalPSMP.java b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/internal/LocalPSMP.java\nindex 37cacd262f7..543e5908bee 100644\n--- a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/internal/LocalPSMP.java\n+++ b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/internal/LocalPSMP.java\n@@ -233,7 +233,7 @@ public void resume() {\n \n                 if (playerStatus == PlayerStatus.PREPARED && media.getPosition() > 0) {\n                     int newPosition = RewindAfterPauseUtils.calculatePositionWithRewind(\n-                            media.getPosition(), media.getLastPlayedTime());\n+                            media.getPosition(), media.getLastPlayedTimeStatistics());\n                     seekTo(newPosition);\n                 }\n                 mediaPlayer.start();\ndiff --git a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/internal/PlayableUtils.java b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/internal/PlayableUtils.java\nindex beef456f95a..7e71db953ed 100644\n--- a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/internal/PlayableUtils.java\n+++ b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/internal/PlayableUtils.java\n@@ -1,5 +1,7 @@\n package de.danoeh.antennapod.playback.service.internal;\n \n+import java.util.Date;\n+\n import de.danoeh.antennapod.storage.database.DBWriter;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedMedia;\n@@ -17,10 +19,11 @@ public abstract class PlayableUtils {\n      */\n     public static void saveCurrentPosition(Playable playable, int newPosition, long timestamp) {\n         playable.setPosition(newPosition);\n-        playable.setLastPlayedTime(timestamp);\n+        playable.setLastPlayedTimeStatistics(timestamp);\n \n         if (playable instanceof FeedMedia) {\n             FeedMedia media = (FeedMedia) playable;\n+            media.setLastPlayedTimeHistory(new Date(timestamp));\n             FeedItem item = media.getItem();\n             if (item != null && item.isNew()) {\n                 DBWriter.markItemPlayed(FeedItem.UNPLAYED, item.getId());\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java\nindex 9daa1c137ca..b0b7009daa6 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java\n@@ -45,7 +45,7 @@ static void upgrade(final SQLiteDatabase db, final int oldVersion, final int new\n         }\n         if (oldVersion <= 7) {\n             db.execSQL(\"ALTER TABLE \" + PodDBAdapter.TABLE_NAME_FEED_MEDIA\n-                    + \" ADD COLUMN \" + PodDBAdapter.KEY_PLAYBACK_COMPLETION_DATE\n+                    + \" ADD COLUMN \" + PodDBAdapter.KEY_LAST_PLAYED_TIME_HISTORY\n                     + \" INTEGER\");\n         }\n         if (oldVersion <= 8) {\n@@ -210,7 +210,7 @@ static void upgrade(final SQLiteDatabase db, final int oldVersion, final int new\n         }\n         if (oldVersion < 1040002) {\n             db.execSQL(\"ALTER TABLE \" + PodDBAdapter.TABLE_NAME_FEED_MEDIA\n-                    + \" ADD COLUMN \" + PodDBAdapter.KEY_LAST_PLAYED_TIME + \" INTEGER DEFAULT 0\");\n+                    + \" ADD COLUMN \" + PodDBAdapter.KEY_LAST_PLAYED_TIME_STATISTICS + \" INTEGER DEFAULT 0\");\n         }\n         if (oldVersion < 1040013) {\n             db.execSQL(PodDBAdapter.CREATE_INDEX_FEEDITEMS_PUBDATE);\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBWriter.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBWriter.java\nindex 93b961f9ae6..62e2d9504e9 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBWriter.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBWriter.java\n@@ -296,16 +296,16 @@ public static Future<?> addItemToPlaybackHistory(FeedMedia media) {\n      * current date regardless of the current value.\n      *\n      * @param media FeedMedia that should be added to the playback history.\n-     * @param date PlaybackCompletionDate for <code>media</code>\n+     * @param date LastPlayedTimeHistory for <code>media</code>\n      */\n     public static Future<?> addItemToPlaybackHistory(final FeedMedia media, Date date) {\n         return runOnDbThread(() -> {\n             Log.d(TAG, \"Adding item to playback history\");\n-            media.setPlaybackCompletionDate(date);\n+            media.setLastPlayedTimeHistory(date);\n \n             PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n-            adapter.setFeedMediaPlaybackCompletionDate(media);\n+            adapter.setFeedMediaLastPlayedTimeHistory(media);\n             adapter.close();\n             EventBus.getDefault().post(PlaybackHistoryEvent.listUpdated());\n \ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/FeedItemPermutors.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/FeedItemPermutors.java\nindex a9c59e2bb52..7955ebbbbc4 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/FeedItemPermutors.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/FeedItemPermutors.java\n@@ -79,8 +79,8 @@ public static Permutor<FeedItem> getPermutor(@NonNull SortOrder sortOrder) {\n                 comparator = (f1, f2) -> Long.compare(size(f2), size(f1));\n                 break;\n             case COMPLETION_DATE_NEW_OLD:\n-                comparator = (f1, f2) -> f2.getMedia().getPlaybackCompletionDate()\n-                        .compareTo(f1.getMedia().getPlaybackCompletionDate());\n+                comparator = (f1, f2) -> f2.getMedia().getLastPlayedTimeHistory()\n+                        .compareTo(f1.getMedia().getLastPlayedTimeHistory());\n                 break;\n             default:\n                 throw new IllegalArgumentException(\"Permutor not implemented\");\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\nindex e4b612b38bf..edc6934b462 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n@@ -95,7 +95,6 @@ public class PodDBAdapter {\n     public static final String KEY_FEED_IDENTIFIER = \"feed_identifier\";\n     public static final String KEY_REASON_DETAILED = \"reason_detailed\";\n     public static final String KEY_DOWNLOADSTATUS_TITLE = \"title\";\n-    public static final String KEY_PLAYBACK_COMPLETION_DATE = \"playback_completion_date\";\n     public static final String KEY_AUTO_DOWNLOAD_ENABLED = \"auto_download\"; // Both tables use the same key\n     public static final String KEY_KEEP_UPDATED = \"keep_updated\";\n     public static final String KEY_AUTO_DELETE_ACTION = \"auto_delete_action\";\n@@ -109,7 +108,8 @@ public class PodDBAdapter {\n     public static final String KEY_SORT_ORDER = \"sort_order\";\n     public static final String KEY_LAST_UPDATE_FAILED = \"last_update_failed\";\n     public static final String KEY_HAS_EMBEDDED_PICTURE = \"has_embedded_picture\";\n-    public static final String KEY_LAST_PLAYED_TIME = \"last_played_time\";\n+    public static final String KEY_LAST_PLAYED_TIME_HISTORY = \"playback_completion_date\";\n+    public static final String KEY_LAST_PLAYED_TIME_STATISTICS = \"last_played_time\";\n     public static final String KEY_INCLUDE_FILTER = \"include_filter\";\n     public static final String KEY_EXCLUDE_FILTER = \"exclude_filter\";\n     public static final String KEY_MINIMAL_DURATION_FILTER = \"minimal_duration_filter\";\n@@ -197,11 +197,11 @@ public class PodDBAdapter {\n             + \" INTEGER,\" + KEY_FILE_URL + \" TEXT,\" + KEY_DOWNLOAD_URL\n             + \" TEXT,\" + KEY_DOWNLOAD_DATE + \" INTEGER,\" + KEY_POSITION\n             + \" INTEGER,\" + KEY_SIZE + \" INTEGER,\" + KEY_MIME_TYPE + \" TEXT,\"\n-            + KEY_PLAYBACK_COMPLETION_DATE + \" INTEGER,\"\n+            + KEY_LAST_PLAYED_TIME_HISTORY + \" INTEGER,\"\n             + KEY_FEEDITEM + \" INTEGER,\"\n             + KEY_PLAYED_DURATION + \" INTEGER,\"\n             + KEY_HAS_EMBEDDED_PICTURE + \" INTEGER,\"\n-            + KEY_LAST_PLAYED_TIME + \" INTEGER\" + \")\";\n+            + KEY_LAST_PLAYED_TIME_STATISTICS + \" INTEGER\" + \")\";\n \n     private static final String CREATE_TABLE_DOWNLOAD_LOG = \"CREATE TABLE \"\n             + TABLE_NAME_DOWNLOAD_LOG + \" (\" + TABLE_PRIMARY_KEY + KEY_FEEDFILE\n@@ -292,11 +292,11 @@ public class PodDBAdapter {\n             + TABLE_NAME_FEED_MEDIA + \".\" + KEY_POSITION + \", \"\n             + TABLE_NAME_FEED_MEDIA + \".\" + KEY_SIZE + \", \"\n             + TABLE_NAME_FEED_MEDIA + \".\" + KEY_MIME_TYPE + \", \"\n-            + TABLE_NAME_FEED_MEDIA + \".\" + KEY_PLAYBACK_COMPLETION_DATE + \", \"\n+            + TABLE_NAME_FEED_MEDIA + \".\" + KEY_LAST_PLAYED_TIME_HISTORY + \", \"\n             + TABLE_NAME_FEED_MEDIA + \".\" + KEY_FEEDITEM + \", \"\n             + TABLE_NAME_FEED_MEDIA + \".\" + KEY_PLAYED_DURATION + \", \"\n             + TABLE_NAME_FEED_MEDIA + \".\" + KEY_HAS_EMBEDDED_PICTURE + \", \"\n-            + TABLE_NAME_FEED_MEDIA + \".\" + KEY_LAST_PLAYED_TIME;\n+            + TABLE_NAME_FEED_MEDIA + \".\" + KEY_LAST_PLAYED_TIME_STATISTICS;\n \n     private static final String KEYS_FEED =\n             TABLE_NAME_FEEDS + \".\" + KEY_ID + \" AS \" + SELECT_KEY_FEED_ID + \", \"\n@@ -523,12 +523,12 @@ public long setMedia(FeedMedia media) {\n         values.put(KEY_DOWNLOAD_DATE, media.getDownloadDate());\n         values.put(KEY_FILE_URL, media.getLocalFileUrl());\n         values.put(KEY_HAS_EMBEDDED_PICTURE, media.hasEmbeddedPicture());\n-        values.put(KEY_LAST_PLAYED_TIME, media.getLastPlayedTime());\n+        values.put(KEY_LAST_PLAYED_TIME_STATISTICS, media.getLastPlayedTimeStatistics());\n \n-        if (media.getPlaybackCompletionDate() != null) {\n-            values.put(KEY_PLAYBACK_COMPLETION_DATE, media.getPlaybackCompletionDate().getTime());\n+        if (media.getLastPlayedTimeHistory() != null) {\n+            values.put(KEY_LAST_PLAYED_TIME_HISTORY, media.getLastPlayedTimeHistory().getTime());\n         } else {\n-            values.put(KEY_PLAYBACK_COMPLETION_DATE, 0);\n+            values.put(KEY_LAST_PLAYED_TIME_HISTORY, 0);\n         }\n         if (media.getItem() != null) {\n             values.put(KEY_FEEDITEM, media.getItem().getId());\n@@ -548,7 +548,8 @@ public void setFeedMediaPlaybackInformation(FeedMedia media) {\n             values.put(KEY_POSITION, media.getPosition());\n             values.put(KEY_DURATION, media.getDuration());\n             values.put(KEY_PLAYED_DURATION, media.getPlayedDuration());\n-            values.put(KEY_LAST_PLAYED_TIME, media.getLastPlayedTime());\n+            values.put(KEY_LAST_PLAYED_TIME_STATISTICS, media.getLastPlayedTimeStatistics());\n+            values.put(KEY_LAST_PLAYED_TIME_HISTORY, media.getLastPlayedTimeHistory().getTime());\n             db.update(TABLE_NAME_FEED_MEDIA, values, KEY_ID + \"=?\",\n                     new String[]{String.valueOf(media.getId())});\n         } else {\n@@ -556,15 +557,15 @@ public void setFeedMediaPlaybackInformation(FeedMedia media) {\n         }\n     }\n \n-    public void setFeedMediaPlaybackCompletionDate(FeedMedia media) {\n+    public void setFeedMediaLastPlayedTimeHistory(FeedMedia media) {\n         if (media.getId() != 0) {\n             ContentValues values = new ContentValues();\n-            values.put(KEY_PLAYBACK_COMPLETION_DATE, media.getPlaybackCompletionDate().getTime());\n+            values.put(KEY_LAST_PLAYED_TIME_HISTORY, media.getLastPlayedTimeHistory().getTime());\n             values.put(KEY_PLAYED_DURATION, media.getPlayedDuration());\n             db.update(TABLE_NAME_FEED_MEDIA, values, KEY_ID + \"=?\",\n                     new String[]{String.valueOf(media.getId())});\n         } else {\n-            Log.e(TAG, \"setFeedMediaPlaybackCompletionDate: ID of media was 0\");\n+            Log.e(TAG, \"setFeedMediaLastPlayedTimeHistory: ID of media was 0\");\n         }\n     }\n \n@@ -954,7 +955,7 @@ public void removeFeed(Feed feed) {\n \n     public void clearPlaybackHistory() {\n         ContentValues values = new ContentValues();\n-        values.put(KEY_PLAYBACK_COMPLETION_DATE, 0);\n+        values.put(KEY_LAST_PLAYED_TIME_HISTORY, 0);\n         db.update(TABLE_NAME_FEED_MEDIA, values, null, null);\n     }\n \n@@ -1061,7 +1062,7 @@ public Cursor getNextInQueue(final FeedItem item) {\n \n     public final Cursor getPausedQueueCursor(int limit) {\n         final String hasPositionOrRecentlyPlayed = TABLE_NAME_FEED_MEDIA + \".\"  + KEY_POSITION + \" >= 1000\"\n-                + \" OR \" + TABLE_NAME_FEED_MEDIA + \".\" + KEY_LAST_PLAYED_TIME\n+                + \" OR \" + TABLE_NAME_FEED_MEDIA + \".\" + KEY_LAST_PLAYED_TIME_STATISTICS\n                 + \" >= \" + (System.currentTimeMillis() - 30000);\n         final String query = \"SELECT \" + KEYS_FEED_ITEM_WITHOUT_DESCRIPTION + \", \" + KEYS_FEED_MEDIA\n                 + \" FROM \" + TABLE_NAME_QUEUE\n@@ -1069,7 +1070,7 @@ public final Cursor getPausedQueueCursor(int limit) {\n                 + \" ON \" + SELECT_KEY_ITEM_ID + \" = \" + TABLE_NAME_QUEUE + \".\" + KEY_FEEDITEM\n                 +  JOIN_FEED_ITEM_AND_MEDIA\n                 + \" ORDER BY (CASE WHEN \" + hasPositionOrRecentlyPlayed + \" THEN \"\n-                    + TABLE_NAME_FEED_MEDIA + \".\" + KEY_LAST_PLAYED_TIME + \" ELSE 0 END) DESC , \"\n+                    + TABLE_NAME_FEED_MEDIA + \".\" + KEY_LAST_PLAYED_TIME_STATISTICS + \" ELSE 0 END) DESC , \"\n                 + TABLE_NAME_QUEUE + \".\" + KEY_ID\n                 + \" LIMIT \" + limit;\n         return db.rawQuery(query, null);\n@@ -1124,13 +1125,14 @@ public final Cursor getFeedEpisodeCountCursor(long feedId, FeedItemFilter filter\n     }\n \n     public Cursor getRandomEpisodesCursor(int limit, int seed) {\n+        long oneHourAgo = System.currentTimeMillis() - 1000L * 3600L;\n         final String allItems = SELECT_FEED_ITEMS_AND_MEDIA\n                 + \" WHERE (\" + KEY_READ + \" = \" + FeedItem.NEW + \" OR \" + KEY_READ + \" = \" + FeedItem.UNPLAYED + \") \"\n                     // Only from the last two years. Older episodes often contain broken covers and stuff like that\n                     + \" AND \" + KEY_PUBDATE + \" > \" + (System.currentTimeMillis() - 1000L * 3600L * 24L * 356L * 2)\n                     // Hide episodes that have been played but not completed\n-                    + \" AND (\" + KEY_LAST_PLAYED_TIME + \" == 0\"\n-                        + \" OR \" + KEY_LAST_PLAYED_TIME + \" > \" + (System.currentTimeMillis() - 1000L * 3600L) + \")\"\n+                    + \" AND (\" + KEY_LAST_PLAYED_TIME_STATISTICS + \" == 0\"\n+                        + \" OR \" + KEY_LAST_PLAYED_TIME_STATISTICS + \" > \" + oneHourAgo + \")\"\n                     + \" AND \" + SELECT_WHERE_FEED_IS_SUBSCRIBED;\n         final String query = \"SELECT MAX(\" + randomEpisodeNumber(seed) + \"), * FROM (\" + allItems + \")\"\n                 + \" GROUP BY \" + KEY_FEED\n@@ -1184,7 +1186,7 @@ public final Cursor getFeedItemCursorByUrl(List<String> urls) {\n         }\n         final String query = SELECT_FEED_ITEMS_AND_MEDIA\n                 + \" WHERE \" + KEY_DOWNLOAD_URL + \" IN (\" + urlsString + \")\"\n-                + \" ORDER BY \" + KEY_PLAYBACK_COMPLETION_DATE + \" DESC\";\n+                + \" ORDER BY \" + KEY_LAST_PLAYED_TIME_HISTORY + \" DESC\";\n         return db.rawQuery(query, null);\n     }\n \n@@ -1206,10 +1208,10 @@ public final Cursor getFeedItemCursor(final String guid, final String episodeUrl\n \n     public final Cursor getMonthlyStatisticsCursor() {\n         final String query = \"SELECT SUM(\" + KEY_PLAYED_DURATION + \") AS total_duration\"\n-                + \", strftime('%m', datetime(\" + KEY_LAST_PLAYED_TIME + \"/1000, 'unixepoch')) AS month\"\n-                + \", strftime('%Y', datetime(\" + KEY_LAST_PLAYED_TIME + \"/1000, 'unixepoch')) AS year\"\n+                + \", strftime('%m', datetime(\" + KEY_LAST_PLAYED_TIME_STATISTICS + \"/1000, 'unixepoch')) AS month\"\n+                + \", strftime('%Y', datetime(\" + KEY_LAST_PLAYED_TIME_STATISTICS + \"/1000, 'unixepoch')) AS year\"\n                 + \" FROM \" + TABLE_NAME_FEED_MEDIA\n-                + \" WHERE \" + KEY_LAST_PLAYED_TIME + \" > 0 AND \" + KEY_PLAYED_DURATION + \" > 0\"\n+                + \" WHERE \" + KEY_LAST_PLAYED_TIME_STATISTICS + \" > 0 AND \" + KEY_PLAYED_DURATION + \" > 0\"\n                 + \" GROUP BY year, month\"\n                 + \" ORDER BY year, month\";\n         return db.rawQuery(query, null);\n@@ -1217,16 +1219,16 @@ public final Cursor getMonthlyStatisticsCursor() {\n \n     public final Cursor getFeedStatisticsCursor(boolean includeMarkedAsPlayed, long timeFilterFrom,\n                                                 long timeFilterTo, long sixMonthsAgo) {\n-        final String lastPlayedTime = TABLE_NAME_FEED_MEDIA + \".\" + KEY_LAST_PLAYED_TIME;\n-        String wasStarted = TABLE_NAME_FEED_MEDIA + \".\" + KEY_PLAYBACK_COMPLETION_DATE + \" > 0\"\n+        final String lastPlayedTimeStatistics = TABLE_NAME_FEED_MEDIA + \".\" + KEY_LAST_PLAYED_TIME_STATISTICS;\n+        String wasStarted = TABLE_NAME_FEED_MEDIA + \".\" + KEY_LAST_PLAYED_TIME_HISTORY + \" > 0\"\n                 + \" AND \" + TABLE_NAME_FEED_MEDIA + \".\" + KEY_PLAYED_DURATION + \" > 0\";\n         if (includeMarkedAsPlayed) {\n             wasStarted = \"(\" + wasStarted + \") OR \"\n                     + TABLE_NAME_FEED_ITEMS + \".\" + KEY_READ + \"=\" + FeedItem.PLAYED + \" OR \"\n                     + TABLE_NAME_FEED_MEDIA + \".\" + KEY_POSITION + \"> 0\";\n         }\n-        final String timeFilter = lastPlayedTime + \">=\" + timeFilterFrom\n-                + \" AND \" + lastPlayedTime + \"<\" + timeFilterTo;\n+        final String timeFilter = lastPlayedTimeStatistics + \">=\" + timeFilterFrom\n+                + \" AND \" + lastPlayedTimeStatistics + \"<\" + timeFilterTo;\n         String playedTime = TABLE_NAME_FEED_MEDIA + \".\" + KEY_PLAYED_DURATION;\n         if (includeMarkedAsPlayed) {\n             playedTime = \"(CASE WHEN \" + playedTime + \" != 0\"\n@@ -1238,8 +1240,9 @@ public final Cursor getFeedStatisticsCursor(boolean includeMarkedAsPlayed, long\n \n         final String query = \"SELECT \" + KEYS_FEED + \", \"\n                         + \"COUNT(*) AS num_episodes, \"\n-                        + \"MIN(CASE WHEN \" + lastPlayedTime + \" > 0\"\n-                                + \" THEN \" + lastPlayedTime + \" ELSE \" + Long.MAX_VALUE + \" END) AS oldest_date, \"\n+                        + \"MIN(CASE WHEN \" + lastPlayedTimeStatistics + \" > 0\"\n+                                + \" THEN \" + lastPlayedTimeStatistics\n+                                + \" ELSE \" + Long.MAX_VALUE + \" END) AS oldest_date, \"\n                         + \"SUM(CASE WHEN (\" + wasStarted + \") THEN 1 ELSE 0 END) AS episodes_started, \"\n                         + \"IFNULL(SUM(CASE WHEN (\" + timeFilter + \")\"\n                                 + \" THEN (\" + playedTime + \") ELSE 0 END), 0) AS played_time, \"\n@@ -1263,10 +1266,10 @@ public final Cursor getFeedStatisticsCursor(boolean includeMarkedAsPlayed, long\n     public final Cursor getTimeBetweenReleaseAndPlayback(long timeFilterFrom, long timeFilterTo) {\n         final String from = \" FROM \" + TABLE_NAME_FEED_ITEMS\n                 + JOIN_FEED_ITEM_AND_MEDIA\n-                + \" WHERE \" + TABLE_NAME_FEED_MEDIA + \".\" + KEY_LAST_PLAYED_TIME + \">=\" + timeFilterFrom\n+                + \" WHERE \" + TABLE_NAME_FEED_MEDIA + \".\" + KEY_LAST_PLAYED_TIME_STATISTICS + \">=\" + timeFilterFrom\n                         + \" AND \" + TABLE_NAME_FEED_ITEMS + \".\" + KEY_PUBDATE + \">=\" + timeFilterFrom\n-                        + \" AND \" + TABLE_NAME_FEED_MEDIA + \".\" + KEY_LAST_PLAYED_TIME + \"<\" + timeFilterTo;\n-        final String query = \"SELECT \" + TABLE_NAME_FEED_MEDIA + \".\" + KEY_LAST_PLAYED_TIME\n+                        + \" AND \" + TABLE_NAME_FEED_MEDIA + \".\" + KEY_LAST_PLAYED_TIME_STATISTICS + \"<\" + timeFilterTo;\n+        final String query = \"SELECT \" + TABLE_NAME_FEED_MEDIA + \".\" + KEY_LAST_PLAYED_TIME_STATISTICS\n                 + \" - \" + TABLE_NAME_FEED_ITEMS + \".\" + KEY_PUBDATE + \" AS diff\"\n                 + from\n                 + \" ORDER BY diff ASC\"\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemFilterQuery.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemFilterQuery.java\nindex 481107cfac2..f5f0a95c358 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemFilterQuery.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemFilterQuery.java\n@@ -22,7 +22,7 @@ public static String generateFrom(FeedItemFilter filter) {\n         // The keys used within this method, but explicitly combined with their table\n         String keyRead = PodDBAdapter.TABLE_NAME_FEED_ITEMS + \".\" + PodDBAdapter.KEY_READ;\n         String keyPosition = PodDBAdapter.TABLE_NAME_FEED_MEDIA + \".\" + PodDBAdapter.KEY_POSITION;\n-        String keyCompletionDate = PodDBAdapter.TABLE_NAME_FEED_MEDIA + \".\" + PodDBAdapter.KEY_PLAYBACK_COMPLETION_DATE;\n+        String keyCompletionDate = PodDBAdapter.TABLE_NAME_FEED_MEDIA + \".\" + PodDBAdapter.KEY_LAST_PLAYED_TIME_HISTORY;\n         String keyDownloaded = PodDBAdapter.TABLE_NAME_FEED_MEDIA + \".\" + PodDBAdapter.KEY_DOWNLOAD_DATE;\n         String keyMediaId = PodDBAdapter.TABLE_NAME_FEED_MEDIA + \".\" + PodDBAdapter.KEY_ID;\n         String keyItemId = PodDBAdapter.TABLE_NAME_FEED_ITEMS + \".\" + PodDBAdapter.KEY_ID;\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemSortQuery.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemSortQuery.java\nindex 236e9cbcf90..96a3a509fe3 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemSortQuery.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemSortQuery.java\n@@ -23,7 +23,7 @@ public static String generateFrom(SortOrder sortOrder) {\n                 return PodDBAdapter.TABLE_NAME_FEED_MEDIA + \".\" + PodDBAdapter.KEY_SIZE + \" \" + \"DESC\";\n             case COMPLETION_DATE_NEW_OLD:\n                 return PodDBAdapter.TABLE_NAME_FEED_MEDIA + \".\"\n-                        + PodDBAdapter.KEY_PLAYBACK_COMPLETION_DATE + \" \" + \"DESC\";\n+                        + PodDBAdapter.KEY_LAST_PLAYED_TIME_HISTORY + \" \" + \"DESC\";\n             case DATE_OLD_NEW:\n                 return PodDBAdapter.TABLE_NAME_FEED_ITEMS + \".\" + PodDBAdapter.KEY_PUBDATE + \" \" + \"ASC\";\n             case EPISODE_FILENAME_A_Z:\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedMediaCursor.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedMediaCursor.java\nindex 51b25584fbb..ecd2c9c856f 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedMediaCursor.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedMediaCursor.java\n@@ -13,7 +13,7 @@\n  */\n public class FeedMediaCursor extends CursorWrapper {\n     private final int indexId;\n-    private final int indexPlaybackCompletionDate;\n+    private final int indexLastPlayedTimeHistory;\n     private final int indexDuration;\n     private final int indexPosition;\n     private final int indexSize;\n@@ -22,13 +22,13 @@ public class FeedMediaCursor extends CursorWrapper {\n     private final int indexDownloadUrl;\n     private final int indexDownloadDate;\n     private final int indexPlayedDuration;\n-    private final int indexLastPlayedTime;\n+    private final int indexLastPlayedTimeStatistics;\n     private final int indexHasEmbeddedPicture;\n \n     public FeedMediaCursor(Cursor cursor) {\n         super(cursor);\n         indexId = cursor.getColumnIndexOrThrow(PodDBAdapter.SELECT_KEY_MEDIA_ID);\n-        indexPlaybackCompletionDate = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_PLAYBACK_COMPLETION_DATE);\n+        indexLastPlayedTimeHistory = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_LAST_PLAYED_TIME_HISTORY);\n         indexDuration = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_DURATION);\n         indexPosition = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_POSITION);\n         indexSize = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_SIZE);\n@@ -37,7 +37,7 @@ public FeedMediaCursor(Cursor cursor) {\n         indexDownloadUrl = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_DOWNLOAD_URL);\n         indexDownloadDate = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_DOWNLOAD_DATE);\n         indexPlayedDuration = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_PLAYED_DURATION);\n-        indexLastPlayedTime = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_LAST_PLAYED_TIME);\n+        indexLastPlayedTimeStatistics = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_LAST_PLAYED_TIME_STATISTICS);\n         indexHasEmbeddedPicture = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_HAS_EMBEDDED_PICTURE);\n     }\n \n@@ -46,8 +46,8 @@ public FeedMediaCursor(Cursor cursor) {\n      */\n     @NonNull\n     public FeedMedia getFeedMedia() {\n-        long playbackCompletionTime = getLong(indexPlaybackCompletionDate);\n-        Date playbackCompletionDate = playbackCompletionTime > 0 ? new Date(playbackCompletionTime) : null;\n+        long lastPlayedTimeHistoryTime = getLong(indexLastPlayedTimeHistory);\n+        Date lastPlayedTimeHistory = lastPlayedTimeHistoryTime > 0 ? new Date(lastPlayedTimeHistoryTime) : null;\n \n         Boolean hasEmbeddedPicture;\n         switch (getInt(indexHasEmbeddedPicture)) {\n@@ -72,10 +72,10 @@ public FeedMedia getFeedMedia() {\n                 getString(indexFileUrl),\n                 getString(indexDownloadUrl),\n                 getLong(indexDownloadDate),\n-                playbackCompletionDate,\n+                lastPlayedTimeHistory,\n                 getInt(indexPlayedDuration),\n                 hasEmbeddedPicture,\n-                getLong(indexLastPlayedTime)\n+                getLong(indexLastPlayedTimeStatistics)\n         );\n     }\n }\n", "test_patch": "diff --git a/app/src/androidTest/java/de/test/antennapod/ui/UITestUtils.java b/app/src/androidTest/java/de/test/antennapod/ui/UITestUtils.java\nindex 4b93dcee9b9..8eef573d07a 100644\n--- a/app/src/androidTest/java/de/test/antennapod/ui/UITestUtils.java\n+++ b/app/src/androidTest/java/de/test/antennapod/ui/UITestUtils.java\n@@ -183,7 +183,7 @@ public void addLocalFeedData(boolean downloadEpisodes) throws Exception {\n \n             queue.add(feed.getItems().get(0));\n             if (feed.getItems().get(1).hasMedia()) {\n-                feed.getItems().get(1).getMedia().setPlaybackCompletionDate(new Date());\n+                feed.getItems().get(1).getMedia().setLastPlayedTimeHistory(new Date());\n             }\n         }\n         localFeedDataAdded = true;\ndiff --git a/net/download/service/src/test/java/de/danoeh/antennapod/net/download/service/episode/autodownload/DbCleanupTests.java b/net/download/service/src/test/java/de/danoeh/antennapod/net/download/service/episode/autodownload/DbCleanupTests.java\nindex c9a707327a0..737b4b93677 100644\n--- a/net/download/service/src/test/java/de/danoeh/antennapod/net/download/service/episode/autodownload/DbCleanupTests.java\n+++ b/net/download/service/src/test/java/de/danoeh/antennapod/net/download/service/episode/autodownload/DbCleanupTests.java\n@@ -130,9 +130,9 @@ void populateItems(final int numItems, Feed feed, List<FeedItem> items,\n                        boolean addToFavorites) throws IOException {\n         for (int i = 0; i < numItems; i++) {\n             Date itemDate = new Date(numItems - i);\n-            Date playbackCompletionDate = null;\n+            Date lastPlayedTimeHistory = null;\n             if (itemState == FeedItem.PLAYED) {\n-                playbackCompletionDate = itemDate;\n+                lastPlayedTimeHistory = itemDate;\n             }\n             FeedItem item = new FeedItem(0, \"title\", \"id\" + i, \"link\", itemDate, itemState, feed);\n \n@@ -140,7 +140,7 @@ void populateItems(final int numItems, Feed feed, List<FeedItem> items,\n             assertTrue(f.createNewFile());\n             files.add(f);\n             item.setMedia(new FeedMedia(0, item, 1, 0, 1L, \"m\",\n-                    f.getAbsolutePath(), \"url\", System.currentTimeMillis(), playbackCompletionDate, 0, 0));\n+                    f.getAbsolutePath(), \"url\", System.currentTimeMillis(), lastPlayedTimeHistory, 0, 0));\n             items.add(item);\n         }\n \ndiff --git a/net/download/service/src/test/java/de/danoeh/antennapod/net/download/service/episode/autodownload/DbReaderTest.java b/net/download/service/src/test/java/de/danoeh/antennapod/net/download/service/episode/autodownload/DbReaderTest.java\nindex a3dc9bd6fae..8f54609b013 100644\n--- a/net/download/service/src/test/java/de/danoeh/antennapod/net/download/service/episode/autodownload/DbReaderTest.java\n+++ b/net/download/service/src/test/java/de/danoeh/antennapod/net/download/service/episode/autodownload/DbReaderTest.java\n@@ -324,9 +324,9 @@ public void testGetPlaybackHistoryLength() {\n                 adapter.open();\n                 for (int i = 0; i < playedItems; ++i) {\n                     FeedMedia m = feed.getItems().get(i).getMedia();\n-                    m.setPlaybackCompletionDate(new Date(i + 1));\n+                    m.setLastPlayedTimeHistory(new Date(i + 1));\n \n-                    adapter.setFeedMediaPlaybackCompletionDate(m);\n+                    adapter.setFeedMediaLastPlayedTimeHistory(m);\n                 }\n                 adapter.close();\n \n@@ -506,8 +506,8 @@ public void testGetPlaybackHistory() {\n             adapter.open();\n             for (int i = 0; i < playedItems; i++) {\n                 FeedMedia m = feed.getItems().get(i).getMedia();\n-                m.setPlaybackCompletionDate(new Date(i + 1));\n-                adapter.setFeedMediaPlaybackCompletionDate(m);\n+                m.setLastPlayedTimeHistory(new Date(i + 1));\n+                adapter.setFeedMediaLastPlayedTimeHistory(m);\n                 ids[ids.length - 1 - i] = m.getItem().getId();\n             }\n             adapter.close();\n@@ -520,7 +520,7 @@ public void testGetPlaybackHistory() {\n                     numReturnedItems, saved.size());\n             for (int i = 0; i < numReturnedItems; i++) {\n                 FeedItem item = saved.get(i);\n-                assertNotNull(item.getMedia().getPlaybackCompletionDate());\n+                assertNotNull(item.getMedia().getLastPlayedTimeHistory());\n                 assertEquals(String.format(\"Wrong sort order with offset %d and limit %d: \",\n                                 paramOffset, paramLimit),\n                         item.getId(), ids[paramOffset + i]);\ndiff --git a/net/download/service/src/test/java/de/danoeh/antennapod/net/download/service/episode/autodownload/DbWriterTest.java b/net/download/service/src/test/java/de/danoeh/antennapod/net/download/service/episode/autodownload/DbWriterTest.java\nindex 4fc41a73b4c..d61e2076661 100644\n--- a/net/download/service/src/test/java/de/danoeh/antennapod/net/download/service/episode/autodownload/DbWriterTest.java\n+++ b/net/download/service/src/test/java/de/danoeh/antennapod/net/download/service/episode/autodownload/DbWriterTest.java\n@@ -94,7 +94,8 @@ public void tearDown() {\n     @Test\n     public void testSetFeedMediaPlaybackInformation() throws Exception {\n         final int position = 50;\n-        final long lastPlayedTime = 1000;\n+        final long lastPlayedTimeStatistics = 1000;\n+        final Date lastPlayedTimeHistory = new Date();\n         final int playedDuration = 60;\n         final int duration = 100;\n \n@@ -110,8 +111,9 @@ public void testSetFeedMediaPlaybackInformation() throws Exception {\n         DBWriter.setFeedItem(item).get(TIMEOUT, TimeUnit.SECONDS);\n \n         media.setPosition(position);\n-        media.setLastPlayedTime(lastPlayedTime);\n+        media.setLastPlayedTimeStatistics(lastPlayedTimeStatistics);\n         media.setPlayedDuration(playedDuration);\n+        media.setLastPlayedTimeHistory(lastPlayedTimeHistory);\n \n         DBWriter.setFeedMediaPlaybackInformation(item.getMedia()).get(TIMEOUT, TimeUnit.SECONDS);\n \n@@ -119,7 +121,8 @@ public void testSetFeedMediaPlaybackInformation() throws Exception {\n         FeedMedia mediaFromDb = itemFromDb.getMedia();\n \n         assertEquals(position, mediaFromDb.getPosition());\n-        assertEquals(lastPlayedTime, mediaFromDb.getLastPlayedTime());\n+        assertEquals(lastPlayedTimeStatistics, mediaFromDb.getLastPlayedTimeStatistics());\n+        assertEquals(lastPlayedTimeHistory, mediaFromDb.getLastPlayedTimeHistory());\n         assertEquals(playedDuration, mediaFromDb.getPlayedDuration());\n         assertEquals(duration, mediaFromDb.getDuration());\n     }\n@@ -467,12 +470,12 @@ public void testDeleteFeedItems() throws Exception {\n         adapter.close();\n     }\n \n-    private FeedMedia playbackHistorySetup(Date playbackCompletionDate) {\n+    private FeedMedia playbackHistorySetup(Date lastPlayedTimeHistory) {\n         Feed feed = new Feed(\"url\", null, \"title\");\n         feed.setItems(new ArrayList<>());\n         FeedItem item = new FeedItem(0, \"title\", \"id\", \"link\", new Date(), FeedItem.PLAYED, feed);\n         FeedMedia media = new FeedMedia(0, item, 10, 0, 1, \"mime\", null,\n-                \"url\", 0, playbackCompletionDate, 0, 0);\n+                \"url\", 0, lastPlayedTimeHistory, 0, 0);\n         feed.getItems().add(item);\n         item.setMedia(media);\n         PodDBAdapter adapter = PodDBAdapter.getInstance();\n@@ -493,7 +496,7 @@ public void testAddItemToPlaybackHistoryNotPlayedYet() throws Exception {\n         adapter.close();\n \n         assertNotNull(media);\n-        assertNotNull(media.getPlaybackCompletionDate());\n+        assertNotNull(media.getLastPlayedTimeHistory());\n     }\n \n     @Test\n@@ -508,8 +511,8 @@ public void testAddItemToPlaybackHistoryAlreadyPlayed() throws Exception {\n         adapter.close();\n \n         assertNotNull(media);\n-        assertNotNull(media.getPlaybackCompletionDate());\n-        assertNotEquals(media.getPlaybackCompletionDate().getTime(), oldDate);\n+        assertNotNull(media.getLastPlayedTimeHistory());\n+        assertNotEquals(media.getLastPlayedTimeHistory().getTime(), oldDate);\n     }\n \n     @SuppressWarnings(\"SameParameterValue\")\n", "problem_statement": "Add episodes to playback history even when not completing them\n### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [x] I will describe the problem with as much detail as possible.\n- [x] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.7.0\n\n### Feature or improvement you want\n\nSometimes I play an episode but do not complete it. I expect it to be displayed on the history screen nonetheless.\n\n### Why should this be added?\n\n_No response_\n\n### Screenshots / Drawings / Technical details\n\nCurrently we have a column `completed_date`. Re-purpose that column into storing `last_played_date_history`. Note that there is also `last_played_date` which is for statistics. These should stay separate fields. Because columns cannot be renamed, just rename the references to it in Java (PodDbAdaper, FeedItem, etc). Fill that column with the last played date, just like the other column.\n", "hints_text": "Hi, I would be interested to work on this. Just for clarification:\nyour idea is to repurpose `completion_date` to store the same value as `last_played_time`? \n\nAs of sqlite v. 3.28 its possible to rename columns, from what i could find:\nhttps://stackoverflow.com/questions/805363/how-do-i-rename-a-column-in-an-sqlite-database-table\n \n> Just for clarification: your idea is to repurpose completion_date to store the same value as last_played_time?\n\nExactly :) They wouldn't always be the same value, in case one of them is cleared (clear statistics vs clear playback history), but generally yes\n\n> As of sqlite v. 3.28 its possible to rename columns\n\nAh, interesting. I didn't know that. However, we support Android versions that don't have sqlite 3.28 yet, so I would just rename the references in Java but keep the old sqlite column names internally\nThanks for clearing that up :)", "created_at": "2025-05-15T14:52:26Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7814, "instance_id": "AntennaPod__AntennaPod-7814", "issue_numbers": ["7813"], "base_commit": "a977b44f7a2dbcc459032da71531bfd0213eb3f9", "patch": "diff --git a/app/src/main/AndroidManifest.xml b/app/src/main/AndroidManifest.xml\nindex 970d957364b..911ea0098ea 100644\n--- a/app/src/main/AndroidManifest.xml\n+++ b/app/src/main/AndroidManifest.xml\n@@ -273,14 +273,6 @@\n             </intent-filter>\n         </activity>\n \n-        <receiver\n-            android:name=\".spa.SPAReceiver\"\n-            android:exported=\"true\">\n-            <intent-filter>\n-                <action android:name=\"de.danoeh.antennapdsp.intent.SP_APPS_QUERY_FEEDS_RESPONSE\"/>\n-            </intent-filter>\n-        </receiver>\n-\n         <provider\n             android:authorities=\"@string/provider_authority\"\n             android:name=\"androidx.core.content.FileProvider\"\ndiff --git a/app/src/main/java/de/danoeh/antennapod/PodcastApp.java b/app/src/main/java/de/danoeh/antennapod/PodcastApp.java\nindex 61cb571bd20..a16a25615d6 100644\n--- a/app/src/main/java/de/danoeh/antennapod/PodcastApp.java\n+++ b/app/src/main/java/de/danoeh/antennapod/PodcastApp.java\n@@ -6,7 +6,6 @@\n \n import com.google.android.material.color.DynamicColors;\n \n-import de.danoeh.antennapod.spa.SPAUtil;\n import org.greenrobot.eventbus.EventBus;\n import org.greenrobot.eventbus.EventBusException;\n \n@@ -45,6 +44,5 @@ public void onCreate() {\n         DynamicColors.applyToActivitiesIfAvailable(this);\n         ClientConfigurator.initialize(this);\n         PreferenceUpgrader.checkUpgrades(this);\n-        SPAUtil.sendSPAppsQueryFeedsIntent(this);\n     }\n }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/spa/SPAReceiver.java b/app/src/main/java/de/danoeh/antennapod/spa/SPAReceiver.java\ndeleted file mode 100644\nindex e9119216460..00000000000\n--- a/app/src/main/java/de/danoeh/antennapod/spa/SPAReceiver.java\n+++ /dev/null\n@@ -1,54 +0,0 @@\n-package de.danoeh.antennapod.spa;\n-\n-import android.content.BroadcastReceiver;\n-import android.content.Context;\n-import android.content.Intent;\n-import android.text.TextUtils;\n-import android.util.Log;\n-import android.widget.Toast;\n-\n-import java.util.Arrays;\n-import java.util.Collections;\n-\n-import de.danoeh.antennapod.R;\n-import de.danoeh.antennapod.ClientConfigurator;\n-import de.danoeh.antennapod.net.download.serviceinterface.FeedUpdateManager;\n-import de.danoeh.antennapod.storage.database.FeedDatabaseWriter;\n-import de.danoeh.antennapod.model.feed.Feed;\n-\n-/**\n- * Receives intents from AntennaPod Single Purpose apps\n- */\n-public class SPAReceiver extends BroadcastReceiver{\n-    private static final String TAG = \"SPAReceiver\";\n-\n-    public static final String ACTION_SP_APPS_QUERY_FEEDS = \"de.danoeh.antennapdsp.intent.SP_APPS_QUERY_FEEDS\";\n-    private static final String ACTION_SP_APPS_QUERY_FEEDS_REPSONSE = \"de.danoeh.antennapdsp.intent.SP_APPS_QUERY_FEEDS_RESPONSE\";\n-    private static final String ACTION_SP_APPS_QUERY_FEEDS_REPSONSE_FEEDS_EXTRA = \"feeds\";\n-\n-    @Override\n-    public void onReceive(Context context, Intent intent) {\n-        if (!TextUtils.equals(intent.getAction(), ACTION_SP_APPS_QUERY_FEEDS_REPSONSE)) {\n-            return;\n-        }\n-        Log.d(TAG, \"Received SP_APPS_QUERY_RESPONSE\");\n-        if (!intent.hasExtra(ACTION_SP_APPS_QUERY_FEEDS_REPSONSE_FEEDS_EXTRA)) {\n-            Log.e(TAG, \"Received invalid SP_APPS_QUERY_RESPONSE: Contains no extra\");\n-            return;\n-        }\n-        String[] feedUrls = intent.getStringArrayExtra(ACTION_SP_APPS_QUERY_FEEDS_REPSONSE_FEEDS_EXTRA);\n-        if (feedUrls == null) {\n-            Log.e(TAG, \"Received invalid SP_APPS_QUERY_REPSONSE: extra was null\");\n-            return;\n-        }\n-        Log.d(TAG, \"Received feeds list: \" + Arrays.toString(feedUrls));\n-        ClientConfigurator.initialize(context);\n-        for (String url : feedUrls) {\n-            Feed feed = new Feed(url, null, \"Unknown podcast\");\n-            feed.setItems(Collections.emptyList());\n-            FeedDatabaseWriter.updateFeed(context, feed, false);\n-        }\n-        Toast.makeText(context, R.string.sp_apps_importing_feeds_msg, Toast.LENGTH_LONG).show();\n-        FeedUpdateManager.getInstance().runOnce(context);\n-    }\n-}\ndiff --git a/app/src/main/java/de/danoeh/antennapod/spa/SPAUtil.java b/app/src/main/java/de/danoeh/antennapod/spa/SPAUtil.java\ndeleted file mode 100644\nindex 7630d49cd0f..00000000000\n--- a/app/src/main/java/de/danoeh/antennapod/spa/SPAUtil.java\n+++ /dev/null\n@@ -1,52 +0,0 @@\n-package de.danoeh.antennapod.spa;\n-\n-import android.content.Context;\n-import android.content.Intent;\n-import android.content.SharedPreferences;\n-import androidx.preference.PreferenceManager;\n-import android.util.Log;\n-\n-import de.danoeh.antennapod.BuildConfig;\n-\n-/**\n- * Provides methods related to AntennaPodSP (https://github.com/danieloeh/AntennaPodSP)\n- */\n-public class SPAUtil {\n-    private static final String TAG = \"SPAUtil\";\n-\n-    private static final String PREF_HAS_QUERIED_SP_APPS = \"prefSPAUtil.hasQueriedSPApps\";\n-\n-    private SPAUtil() {\n-    }\n-\n-    /**\n-     * Sends an ACTION_SP_APPS_QUERY_FEEDS intent to all AntennaPod Single Purpose apps.\n-     * The receiving single purpose apps will then send their feeds back to AntennaPod via an\n-     * ACTION_SP_APPS_QUERY_FEEDS_RESPONSE intent.\n-     * This intent will only be sent once.\n-     *\n-     * @return True if an intent was sent, false otherwise (for example if the intent has already been\n-     * sent before.\n-     */\n-    public static synchronized boolean sendSPAppsQueryFeedsIntent(Context context) {\n-        assert context != null : \"context = null\";\n-        final Context appContext = context.getApplicationContext();\n-        if (appContext == null) {\n-            Log.wtf(TAG, \"Unable to get application context\");\n-            return false;\n-        }\n-        SharedPreferences prefs = PreferenceManager.getDefaultSharedPreferences(appContext);\n-        if (!prefs.getBoolean(PREF_HAS_QUERIED_SP_APPS, false)) {\n-            appContext.sendBroadcast(new Intent(SPAReceiver.ACTION_SP_APPS_QUERY_FEEDS));\n-            if (BuildConfig.DEBUG) Log.d(TAG, \"Sending SP_APPS_QUERY_FEEDS intent\");\n-\n-            SharedPreferences.Editor editor = prefs.edit();\n-            editor.putBoolean(PREF_HAS_QUERIED_SP_APPS, true);\n-            editor.apply();\n-\n-            return true;\n-        } else {\n-            return false;\n-        }\n-    }\n-}\ndiff --git a/config/checkstyle/suppressions.xml b/config/checkstyle/suppressions.xml\nindex abec3ef3774..936168a0d88 100644\n--- a/config/checkstyle/suppressions.xml\n+++ b/config/checkstyle/suppressions.xml\n@@ -11,16 +11,16 @@\n     <suppress checks=\".\" files=\"[\\\\/].idea[\\\\/]\"/>\n     \n     <!-- Legacy code, should be gradually updated when touching these lines anyway -->\n-    <suppress checks=\"LineLength\" files=\"(VolumeAdaptionSettingTest.java|DBUpgrader.java|PlaybackServiceMediaPlayer.java|PlaybackService.java|LocalPSMP.java|PlaybackServiceTaskManager.java|DBWriter.java|PodcastSearchResult.java|PlaybackServiceTaskManagerTest.java|HTTPBin.java|SPAReceiver.java|UriUtil.java|FeedDiscovererTest.java|PlaybackServiceMediaPlayerTest.java|UITestUtils.java)\"/>\n+    <suppress checks=\"LineLength\" files=\"(VolumeAdaptionSettingTest.java|DBUpgrader.java|PlaybackServiceMediaPlayer.java|PlaybackService.java|LocalPSMP.java|PlaybackServiceTaskManager.java|DBWriter.java|PodcastSearchResult.java|PlaybackServiceTaskManagerTest.java|HTTPBin.java|UriUtil.java|FeedDiscovererTest.java|PlaybackServiceMediaPlayerTest.java|UITestUtils.java)\"/>\n     <suppress checks=\"VariableDeclarationUsageDistance\" files=\"(FeedFilterTest.java|ChapterReader.java|FastBlurTransformation.java|PreferencesTest.java|ItemFilterDialog.java|PlaybackServiceMediaPlayerTest.java)\"/>\n-    <suppress checks=\"WhitespaceAround\" files=\"(LongList.java|IntentUtils.java|PlaybackServiceMediaPlayer.java|ShakeListener.java|LocalPSMP.java|PodcastSearchResult.java|UITestUtils.java|SPAReceiver.java|SkipIntroEndingChangedEvent.java|PlaybackController.java)\"/>\n+    <suppress checks=\"WhitespaceAround\" files=\"(LongList.java|IntentUtils.java|PlaybackServiceMediaPlayer.java|ShakeListener.java|LocalPSMP.java|PodcastSearchResult.java|UITestUtils.java|SkipIntroEndingChangedEvent.java|PlaybackController.java)\"/>\n     <suppress checks=\"WhitespaceAfter\" files=\"(LongList.java|IntentUtils.java|TimeSpeedConverter.java|LocalPSMP.java|PlaybackController.java|PodcastSearchResult.java)\"/>\n-    <suppress checks=\"AbbreviationAsWordInName\" files=\"(FeedItemPermutorsTest.java|DBUpgrader.java|PodDBAdapter.java|DBWriter.java|DBReader.java|RewindAfterPauseUtilTest.java|PlaybackServiceMediaPlayer.java|PlaybackService.java|LocalPSMP.java|PlaybackServiceTaskManager.java|GpodnetUploadChangesResponse.java|GpodnetEpisodeActionPostResponse.java|UrlCheckerTest.java|UriUtilTest.java|UriUtil.java|PlaybackServiceTaskManagerTest.java|SPAUtil.java|FeedDiscovererTest.java|PlaybackServiceMediaPlayerTest.java|DefaultPSMPCallback.java|UITestUtils.java|APCleanupAlgorithmTest.java|APNullCleanupAlgorithm.java|APCleanupAlgorithm.java|HTTPBin.java|UITestUtilsTest.java|FeedDiscoverer.java|SPAReceiver.java|APQueueCleanupAlgorithm.java|CancelablePSMPCallback.java)\"/>\n-    <suppress checks=\"NeedBraces\" files=\"(PlaybackServiceMediaPlayerTest.java|FeedPreferences.java|DownloadRequest.java|HTTPBin.java|UITestUtils.java|SPAUtil.java)\"/>\n+    <suppress checks=\"AbbreviationAsWordInName\" files=\"(FeedItemPermutorsTest.java|DBUpgrader.java|PodDBAdapter.java|DBWriter.java|DBReader.java|RewindAfterPauseUtilTest.java|PlaybackServiceMediaPlayer.java|PlaybackService.java|LocalPSMP.java|PlaybackServiceTaskManager.java|GpodnetUploadChangesResponse.java|GpodnetEpisodeActionPostResponse.java|UrlCheckerTest.java|UriUtilTest.java|UriUtil.java|PlaybackServiceTaskManagerTest.java|FeedDiscovererTest.java|PlaybackServiceMediaPlayerTest.java|DefaultPSMPCallback.java|UITestUtils.java|APCleanupAlgorithmTest.java|APNullCleanupAlgorithm.java|APCleanupAlgorithm.java|HTTPBin.java|UITestUtilsTest.java|FeedDiscoverer.java|APQueueCleanupAlgorithm.java|CancelablePSMPCallback.java)\"/>\n+    <suppress checks=\"NeedBraces\" files=\"(PlaybackServiceMediaPlayerTest.java|FeedPreferences.java|DownloadRequest.java|HTTPBin.java|UITestUtils.java)\"/>\n     <suppress checks=\"NonEmptyAtclauseDescription\" files=\"(FeedFilter.java|AspectRatioVideoView.java|Playable.java|PlaybackServiceTaskManager.java|PodcastSearchResult.java|OpmlBackupAgent.java)\"/>\n     <suppress checks=\"OperatorWrapCheck\" files=\"(Atom.java|DBUpgrader.java|PodDBAdapter.java|PlaybackController.java|GpodnetUploadChangesResponse.java|HtmlToPlainText.java|PodcastSearchResult.java|PowerConnectionReceiver.java|FeedDiscoverer.java|PlaybackService.java)\"/>\n     <suppress checks=\"JavadocParagraph\" files=\"(FeedItemPermutors.java|HtmlToPlainText.java|FeedItemMenuHandler.java|RewindAfterPauseUtils.java|PlaybackServiceMediaPlayer.java|UITestUtils.java|NestedScrollableHost.java|PlaybackService.java)\"/>\n-    <suppress checks=\"JavadocTagContinuationIndentation\" files=\"(LongList.java|DBReader.java|LocalPSMP.java|GpodnetService.java|FeedDiscoverer.java|SPAUtil.java|PlaybackServiceMediaPlayer.java)\"/>\n+    <suppress checks=\"JavadocTagContinuationIndentation\" files=\"(LongList.java|DBReader.java|LocalPSMP.java|GpodnetService.java|FeedDiscoverer.java|PlaybackServiceMediaPlayer.java)\"/>\n     <suppress checks=\"MemberName\" files=\"(OpmlBackupAgent.java|ShakeListener.java|PlaybackController.java|AspectRatioVideoView.java|PlaybackService.java|PlaybackServiceMediaPlayerTest.java)\"/>\n     <suppress checks=\"LocalVariableName\" files=\"(ShakeListener.java|ItemEnqueuePositionCalculatorTest.java)\"/>\n </suppressions>\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex bd429ec84ba..798448d17e5 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -811,9 +811,6 @@\n     <string name=\"release_schedule_saturday\">Sat</string>\n     <string name=\"release_schedule_sunday\">Sun</string>\n \n-    <!-- AntennaPodSP -->\n-    <string name=\"sp_apps_importing_feeds_msg\">Importing subscriptions from single-purpose apps&#8230;</string>\n-\n     <!-- Add podcast fragment -->\n     <string name=\"search_podcast_hint\">Search podcast\u2026</string>\n     <string name=\"search_itunes_label\">Search Apple Podcasts</string>\n", "test_patch": "", "problem_statement": "Unauthorized Podcast Subscription Vulnerability via Unvalidated Broadcast Intent\n### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [x] I will describe the problem with as much detail as possible.\n- [x] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.8.0\n\n### Android version\n\n14\n\n### Device model\n\nSM-A235F/DSN\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\nThis vulnerability allows an attacker to **add podcast subscriptions or import feeds into AntennaPod without the user\u2019s knowledge or consent**, simply **by sending a broadcast intent from any external app** \n\n1. Set up an external app with a button:\nIn the external app, place a button, When the button is clicked, the external app sends an Intent to AntennaPod.\n\n2. Send the Intent:\nThe Intent is sent to AntennaPod using Action \"de.danoeh.antennapdsp.intent.SP_APPS_QUERY_FEEDS_RESPONSE\"\n\n3. Attach the RSS feed URL:\n The external app includes an RSS feed URL in the Intent (for example, a podcast URL).\n\n4. Send the Intent:\nThe Intent is sent, and AntennaPod processes it, adding the feed URL to its list of subscriptions.\n\n5. Observe the behavior in AntennaPod:\nAfter sending the Intent, AntennaPod will accept the feed URL and add it to the subscriptions list, even without validating the source of the Intent. \n\n If you want to share with you the Logic of the external app let me Know \n\n### Expected behaviour\n\n_No response_\n\n### Current behaviour\n\n#### External App Logic\n\nThe external app will:\n    1. Have a simple UI with a button.\n    2. Send a broadcast Intent with the action and an RSS feed URL when the button is clicked.\n    3. Target the vulnerable app to add the feed to its subscriptions.\n\n#### 1. The external app sends an Intent with an RSS feed URL.\n\n#### 2. AntennaPod receives the Intent and adds the podcast to its subscriptions tab.\n\n#### 3. The user has granted permission to the external app to send the feed URL\n\nhttps://github.com/user-attachments/assets/a7cfd26e-57f8-4638-be7e-9996fca73d69\n\n### Logs\n\n```\nResolving type=null scheme=null defaultOnly=false userId=0 of Intent { act=de.danoeh.antennapdsp.intent.SP_APPS_QUERY_FEEDS_RESPONSE flg=0x18 cmp=de.danoeh.antennapod/.spa.SPAReceiver (has extras) }**\n2025-05-13 02:39:20.577  1978-2010  IntentResolver          system_process                       V  Action list: null\n2025-05-13 02:39:20.577  1978-2010  IntentResolver          system_process                       V  Final result list:\n2025-05-13 02:39:20.579 17204-17204 SPAReceiver             de.danoeh.antennapod                 D  Received SP_APPS_QUERY_RESPONSE\n2025-05-13 02:39:20.580 17204-17204 SPAReceiver             de.danoeh.antennapod                 D  Received feeds list: [https://media.rss.com/ctbbpodcast/feed.xml]\n2025-05-13 02:39:20.580 17204-17204 DBReader                de.danoeh.antennapod                 D  Extracting Feedlist\n2025-05-13 02:39:20.580  1717-6431  audio_hw_generic        android.hardware.audio@2.0-service   W  Not supplying enough data to HAL, expected position 24596476 , only wrote 24596471\n2025-05-13 02:39:20.581 17204-17204 FeedDbWriter            de.danoeh.antennapod                 D  Found no existing Feed with title Unknown podcast. Adding as new one.\n2025-05-13 02:39:20.582 17204-17289 de.danoeh....er@b0c8159 de.danoeh.antennapod                 D  Inserting new Feed into db\n2025-05-13 02:39:20.590 17204-17204 DBReader                de.danoeh.antennapod                 D  getFeed() called with: feedId = [1]\n2025-05-13 02:39:20.592 17204-17204 DBReader                de.danoeh.antennapod                 D  getFeedItemList() called with: feed = [de.danoeh.antennapod.model.feed.Feed@20]\n2025-05-13 02:39:20.593 17204-17204 DBReader                de.danoeh.antennapod                 D  getFavoriteIDList() called\n2025-05-13 02:39:20.594 17204-17204 DBReader                de.danoeh.antennapod                 D  getQueueIDList() called\n2025-05-13 02:39:20.596 17204-17264 DBReader                de.danoeh.antennapod                 D  Extracting Feedlist\n2025-05-13 02:39:20.613  1743-1810  gralloc_ranchu          and...raphics.allocator@2.0-service  D  gralloc_alloc: Creating ashmem region of size 528384\n2025-05-13 02:39:20.616  1978-2578  ConnectivityService     system_process                       D  requestNetwork for uid/pid:10150/17204 NetworkRequest [ TRACK_DEFAULT id=110, [ Capabilities: INTERNET&NOT_RESTRICTED&TRUSTED Uid: 10150] ]\n2025-05-13 02:39:20.616  1978-2116  WifiNetworkFactory      system_process                       D  got request NetworkRequest [ TRACK_DEFAULT id=110, [ Capabilities: INTERNET&NOT_RESTRICTED&TRUSTED Uid: 10150] ] with score 60 and serial -1\n2025-05-13 02:39:20.616  1978-2116  UntrustedW...orkFactory system_process                       D  got request NetworkRequest [ TRACK_DEFAULT id=110, [ Capabilities: INTERNET&NOT_RESTRICTED&TRUSTED Uid: 10150] ] with score 60 and serial -1\n2025-05-13 02:39:20.616  2489-2489  PhoneSwitc...stListener com.android.phone                    D  got request NetworkRequest [ TRACK_DEFAULT id=110, [ Capabilities: INTERNET&NOT_RESTRICTED&TRUSTED Uid: 10150] ] with score 60 and serial -1\n2025-05-13 02:39:20.638  1743-1810  gralloc_ranchu          and...raphics.allocator@2.0-service  D  gralloc_alloc: Creating ashmem region of size 528384\n2025-05-13 02:39:20.647  1743-1807  gralloc_ranchu          and...raphics.allocator@2.0-service  D  gralloc_alloc: Creating ashmem region of size 528384\n2025-05-13 02:39:20.647 17204-17245 EGL_emulation           de.danoeh.antennapod                 D  eglMakeCurrent: 0xe3c1a300: ver 2 0 (tinfo 0xe3c0f2f0)\n2025-05-13 02:39:20.671 17204-17230 WM-Processor            de.danoeh.antennapod                 I  Moving WorkSpec (8adbd422-760f-4a43-99bf-bd0364caf894) to the foreground\n2025-05-13 02:39:20.675 17204-17204 WM-SystemFgDispatcher   de.danoeh.antennapod                 I  Started foreground service Intent { act=ACTION_START_FOREGROUND cmp=de.danoeh.antennapod/androidx.work.impl.foreground.SystemForegroundService (has extras) }\n2025-05-13 02:39:20.678 17204-17290 DBReader                de.danoeh.antennapod                 D  Extracting Feedlist\n2025-05-13 02:39:20.683 17204-17291 UserPreferences         de.danoeh.antennapod                 D  User data folder not writable or not set. Trying default.\n2025-05-13 02:39:20.689 17204-17291 DownloadRequestCreat    de.danoeh.antennapod                 D  Requesting download of url https://media.rss.com/ctbbpodcast/feed.xml\n2025-05-13 02:39:20.691 17204-17291 AntennapodHttpClient    de.danoeh.antennapod                 D  Creating new instance of HTTP client\n2025-05-13 02:39:20.849  2182-2418  EGL_emulation           com.android.systemui                 D  eglMakeCurrent: 0xebda0ee0: ver 2 0 (tinfo 0xca3bc330)\n2025-05-13 02:39:21.346 17204-17291 HttpDownloader          de.danoeh.antennapod                 D  Response code is 200\n2025-05-13 02:39:21.346 17204-17291 HttpDownloader          de.danoeh.antennapod                 D  Getting size of download\n2025-05-13 02:39:21.347 17204-17291 HttpDownloader          de.danoeh.antennapod                 D  Size is -1\n2025-05-13 02:39:21.347 17204-17291 UserPreferences         de.danoeh.antennapod                 D  User data folder not writable or not set. Trying default.\n2025-05-13 02:39:21.348 17204-17291 HttpDownloader          de.danoeh.antennapod                 D  Free space is 5648228352\n2025-05-13 02:39:21.348 17204-17291 HttpDownloader          de.danoeh.antennapod                 D  Starting download\n2025-05-13 02:39:21.360 17204-17291 HttpDownloader          de.danoeh.antennapod                 D  Download was successful\n2025-05-13 02:39:21.362 17204-17291 TypeGetter              de.danoeh.antennapod                 D  Recognized type RSS 2.0\n2025-05-13 02:39:21.363 17204-17291 SyndHandler             de.danoeh.antennapod                 D  Recognized PodcastIndex namespace\n2025-05-13 02:39:21.363 17204-17291 SyndHandler             de.danoeh.antennapod                 D  Recognized ITunes namespace\n2025-05-13 02:39:21.363 17204-17291 SyndHandler             de.danoeh.antennapod                 D  Recognized Content namespace\n2025-05-13 02:39:21.363 17204-17291 SyndHandler             de.danoeh.antennapod                 D  Recognized Atom namespace\n2025-05-13 02:39:21.485 17204-17291 FeedParserTask          de.danoeh.antennapod                 D  Critical Thinking - Bug Bounty Podcast parsed\n2025-05-13 02:39:21.485 17204-17291 FeedParserTask          de.danoeh.antennapod                 D  Deletion of file '/storage/emulated/0/Android/data/de.danoeh.antennapod/files/cache/feed-Unknown podcast1' successful\n2025-05-13 02:39:21.485 17204-17291 DBReader                de.danoeh.antennapod                 D  getFeed() called with: feedId = [1]\n2025-05-13 02:39:21.486 17204-17291 DBReader                de.danoeh.antennapod                 D  getFeedItemList() called with: feed = [de.danoeh.antennapod.model.feed.Feed@20]\n2025-05-13 02:39:21.487 17204-17291 DBReader                de.danoeh.antennapod                 D  getFavoriteIDList() called\n2025-05-13 02:39:21.487 17204-17291 DBReader                de.danoeh.antennapod                 D  getQueueIDList() called\n2025-05-13 02:39:21.488 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Feed with title Critical Thinking - Bug Bounty Podcast already exists. Syncing new with existing one.\n2025-05-13 02:39:21.488 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 121: Slonser\u2019s Image Injection 0-day -> ATO & New Caido Collab Plugin\n2025-05-13 02:39:21.488 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 120: SpaceRaccoon - From Day Zero to Zero Day\n2025-05-13 02:39:21.489 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 119: Abusing Iframes from a client-side hacker\n2025-05-13 02:39:21.489 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 118: Hacking Happy Hour: 0days on Tap and SQLi Shots\n2025-05-13 02:39:21.489 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Hacking AI Series: Vulnus ex Machina - Part 1\n2025-05-13 02:39:21.489 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 116: Auth Bypasses and Google VRP Writeups\n2025-05-13 02:39:21.489 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 115: Mentee to Career Hacker - Mokusou (So Sakaguchi)\n2025-05-13 02:39:21.489 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 114: Single Page Application Hacking Playbook\n2025-05-13 02:39:21.489 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 113: Best Technical Takeaways from Portswigger Top 10 2024\n2025-05-13 02:39:21.489 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 112: Interview with Ciar\u00e1n Cotter (MonkeHack) - Critical Lab Researcher and Full-time Hunter\n2025-05-13 02:39:21.489 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 111: How to Bypass DOMPurify in Bug Bounty with Kevin Mizu\n2025-05-13 02:39:21.489 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 110: Oauth Gadget Correlation and Common Attacks\n2025-05-13 02:39:21.489 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 109: Creative Recon - Alternative Techniques\n2025-05-13 02:39:21.490 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 108: How to Hack Salesforce, ServiceNow, and Other SaaS Products With Aaron Costello\n2025-05-13 02:39:21.490 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 107: Bypassing Cross-Origin Browser Headers\n2025-05-13 02:39:21.490 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 106: Announcing our new cohost...\n2025-05-13 02:39:21.490 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 105: Best Critical Thinking Moments from 2024\n2025-05-13 02:39:21.490 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 104: 2024 Hacker Stats & 2025 Goals\n2025-05-13 02:39:21.490 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 103: Getting ANSI about Unicode Normalization\n2025-05-13 02:39:21.490 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 102: Building Web Hacking Micro Agents with Jason Haddix\n2025-05-13 02:39:21.491 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 101: CTBB Hijacked: Rez0__ on AI Attack Vectors with Johann Rehberger\n2025-05-13 02:39:21.491 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Ep 100 - 8 Fav Bugs of 2024, Farewell Joel, Hello Shift - Cursor of Hacking\n2025-05-13 02:39:21.491 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 99: Back to the Basics - Web Fundamental to 100k a Year in Bug Bounty\n2025-05-13 02:39:21.491 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 98: Team 82 Sharon Brizinov - The Live Hacking Polymath\n2025-05-13 02:39:21.491 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 97: Bcrypt Hash Input Truncation & Mobile Device Threat Modeling\n2025-05-13 02:39:21.491 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 96: Cookies & Caching with MatanBer\n2025-05-13 02:39:21.491 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 95: Attacking Chrome Extensions with MatanBer - Big Impact on the Client-Side\n2025-05-13 02:39:21.491 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 94: Zendesk Fiasco & the CTBB Naughty List\n2025-05-13 02:39:21.492 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 93: A Chat with Dr. Bouman - Life as a Hacker and a Doctor\n2025-05-13 02:39:21.492 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 92 - SAML XPath Confusion, Chinese DNS Poisoning, and AI Powered 403 Bypasser\n2025-05-13 02:39:21.492 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 91: Zero to LHE in 9 Months (feat gr3pme)\n2025-05-13 02:39:21.492 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 90: 5k Clickjacking, Encryption Oracles, and Cursor for PoCs\n2025-05-13 02:39:21.492 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 89: The Untapped Bug Bounty Landscape of IoT w/ Matt Brown\n2025-05-13 02:39:21.492 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 88: News, Tools, and Writeups\n2025-05-13 02:39:21.492 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 87: 'Hacker Wife' Mariah Gardner on Bug Bounty mentality and relationships\n2025-05-13 02:39:21.492 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 86: The X-Correlation between Frans & RCE - Research Drop\n2025-05-13 02:39:21.493 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 85: Practical Applications of DEFCON 32 Web Research\n2025-05-13 02:39:21.493 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 84: 0xLupin & Takeaways from Google's Las Vegas BugSwat\n2025-05-13 02:39:21.493 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 83: Brainstorming Proxy Plugins\n2025-05-13 02:39:21.493 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 82: Part-Time Bug Bounty\n2025-05-13 02:39:21.493 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 81: Crushing Client-Side on Any Scope with MatanBer\n2025-05-13 02:39:21.493 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 80: Pwn2Own VS H1 Live Hacking Event (feat SinSinology)\n2025-05-13 02:39:21.493 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 79: The State of CSS Injection - Leaking Text Nodes & HTML Attributes\n2025-05-13 02:39:21.494 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 78: Less Writing, More Hacking - Reporting Efficiency Techniques\n2025-05-13 02:39:21.494 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 77: Bug Bounty Mental - Practical Tips for Staying Sharp & Motivated\n2025-05-13 02:39:21.494 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 76: Match & Replace - HTTP Proxies' Most Underrated Feature\n2025-05-13 02:39:21.494 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 75: *Rerun* of The OG Bug Bounty King - Frans Rosen\n2025-05-13 02:39:21.494 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 74: Supply Chain Attack Primer - Popping RCE Without an HTTP Request (feat 0xLupin)\n2025-05-13 02:39:21.494 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 73: Sandboxed IFrames and WAF Bypasses\n2025-05-13 02:39:21.494 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 72: Research TLDRs & Smuggling Payloads in Well Known Data Types\n2025-05-13 02:39:21.494 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 71: More VDP Chats & AI Bias Bounty Strats with Keith Hoodlet\n2025-05-13 02:39:21.495 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 70: NahamCon and CSP Bypasses Everywhere\n2025-05-13 02:39:21.495 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 69: Johan Carlsson - 3 Month Check-in on Full-time Bug Bounty.\n2025-05-13 02:39:21.495 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 68: 0-days & HTMX-SS with Mathias\n2025-05-13 02:39:21.495 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 67: VDPs & Accidental Program VS Hacker Debate Part 2\n2025-05-13 02:39:21.495 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 66: CDN-CGI Research, Intent To Ship, and Louis Vuitton\n2025-05-13 02:39:21.496 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 65: Motivation and Methodology with Sam Curry (Zlz)\n2025-05-13 02:39:21.496 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 64: .NET Remoting, CDN Attack Surface, and Recon vs Main App\n2025-05-13 02:39:21.496 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 63: JHaddix Returns\n2025-05-13 02:39:21.496 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 62: Frontend Language Oddities\n2025-05-13 02:39:21.496 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 61: A Hacker on Wall Street - JR0ch17\n2025-05-13 02:39:21.497 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 60: Our Take on PortSwigger's Top 10 Web Hacking Techniques of 2023\n2025-05-13 02:39:21.497 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 59: Bug Bounty Gadget Hunting & Hacker's Intuition\n2025-05-13 02:39:21.497 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 58: Youssef Sammouda - Client-Side & ATO War Stories\n2025-05-13 02:39:21.497 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 57: Technical breakdown from Miami Hacking Event - H1-305\n2025-05-13 02:39:21.497 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 56: Using Data Science to win Bug Bounty - Mayonaise (aka Jon Colston)\n2025-05-13 02:39:21.497 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 55: Popping WordPress Plugins - Methodology Braindump\n2025-05-13 02:39:21.497 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 54: White Box Formulas - Vulnerable Coding Patterns\n2025-05-13 02:39:21.498 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 53: 500k/yr as Full-Time Bug Hunter & Content Creator - Nahamsec\n2025-05-13 02:39:21.498 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 52: Best Technical Content from Year 1 of CTBB Podcast\n2025-05-13 02:39:21.498 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 51: Hacker Stats 2023 & 2024 Goals\n2025-05-13 02:39:21.498 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 50: \u00adMathias \"Fall in a well\" Karlsson - Bug Bounty Prophet\n2025-05-13 02:39:21.498 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 49: Getting Live Hacking Event Invites & Bug Bounty Collab with Nagli\n2025-05-13 02:39:21.498 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 48: MVH, DEFCON Black Badge, Googler - Sam Erb\n2025-05-13 02:39:21.498 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 47: CSP Research, Iframe Hopping, and Client-side Shenanigans\n2025-05-13 02:39:21.498 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 46: The SAML Ramble\n2025-05-13 02:39:21.498 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 45: The OG Bug Bounty King - Frans Rosen\n2025-05-13 02:39:21.498 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 44: URL Parsing & Auth Bypass Magic\n2025-05-13 02:39:21.499 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 43: Caido - The Up-And-Coming HTTP Proxy\n2025-05-13 02:39:21.499 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 42: Renniepak Interview & Intigriti LHE Recap\n2025-05-13 02:39:21.499 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 41: Mini Masterclass: Attack Vector Ideation\n2025-05-13 02:39:21.499 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 40: Bug Bounty Mentoring\n2025-05-13 02:39:21.499 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 39: The Art of Architectures\n2025-05-13 02:39:21.499 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 38: Mobile Hacking Maestro: Sergey Toshin\n2025-05-13 02:39:21.499 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 37: Tokyo Hacking & Interview with 0xLupin\n2025-05-13 02:39:21.499 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 36: Bug Bounty Ethics & CT Exclusive Bug Reports\n2025-05-13 02:39:21.499 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 35: King of Collaboration: Douglas Day\n2025-05-13 02:39:21.499 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 34: Program vs Hacker Debate\n2025-05-13 02:39:21.499 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 33: The Master of Hacker Show&Tell: Inti De Ceukelaire\n2025-05-13 02:39:21.500 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 32: The Great Write-up Low-down\n2025-05-13 02:39:21.500 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 31: Alex Chapman - The Man of Many Crits\n2025-05-13 02:39:21.500 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 30: Recon Legend Shubs - From Burgers to Bounties\n2025-05-13 02:39:21.500 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 29: Live Episode with Sean Yeoh - Assetnote Engineer\n2025-05-13 02:39:21.500 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 28: Surfin' with CSRFs\n2025-05-13 02:39:21.500 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 27: Top 7 Esoteric Web Vulnerabilities\n2025-05-13 02:39:21.500 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 26: Client-side Quirks & Browser Hacks\n2025-05-13 02:39:21.500 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 25: 2xMVH & Multi-million dollar hacker Inhibitor181\n2025-05-13 02:39:21.500 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 24: AI + Hacking with Daniel Miessler and Rez0\n2025-05-13 02:39:21.500 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 23: Hacker Loadouts\n2025-05-13 02:39:21.500 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 22: Chipping Away at Hardware Hacking\n2025-05-13 02:39:21.500 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 21: Chill Chat with Legendary DoD Hacker Corben Leo\n2025-05-13 02:39:21.501 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 20: Hacker Brain Hacks - Overcoming Bug Bounty's Mental Tolls\n2025-05-13 02:39:21.501 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 19: Audit Code, Earn Bounties (Part 2) + Zip-Snip, Sitecore, and more!\n2025-05-13 02:39:21.501 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 18: Audit Code, Earn Bounties\n2025-05-13 02:39:21.501 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 17: LA Live Chat with Five Legendary Hackers\n2025-05-13 02:39:21.501 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 16: The Hacker's Toolkit\n2025-05-13 02:39:21.501 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 15: The Israeli Million-Dollar Hacker\n2025-05-13 02:39:21.501 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 14: Mobile Hacking Dynamic Analysis w/ Frida + Random Hacker Stuff\n2025-05-13 02:39:21.501 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 13: How to Find a Good BBP + Acropalypse + ZDI\n2025-05-13 02:39:21.501 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 12: JHaddix on Hacker->Hacker CISO, OG Hacking Techniques, and Crazy Reports\n2025-05-13 02:39:21.501 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 11: CV$$, Web Cache Deception, and SSTI\n2025-05-13 02:39:21.501 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 10: The Life of a Full-Time Bug Bounty Hunter + BB News + Reports from Mentees\n2025-05-13 02:39:21.502 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 9: Headless Browser SSRF & RebindMultiA Tool Release + Web3 Bug\n2025-05-13 02:39:21.502 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 8: PostMessage Bugs, CSS Injection, and Bug Drops\n2025-05-13 02:39:21.502 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 7: PortSwigger Top 10, TruffleSecurity Drama, and More!\n2025-05-13 02:39:21.502 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 6: Mobile Hacking Attack Vectors with Teknogeek (Joel Margolis)\n2025-05-13 02:39:21.502 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 5: AI Security, Hacking WiFi, the New XSS Hunter, and more\n2025-05-13 02:39:21.502 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 4: H1-407 Event Madness & Takeaways Part 2 w/ Special Guest Spaceraccoon\n2025-05-13 02:39:21.502 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 3: H1-407 Event Madness & Takeaways Part 1\n2025-05-13 02:39:21.502 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 2: Exploit Writing & Automation / Do you need to know how to program to hack?\n2025-05-13 02:39:21.502 17204-17291 FeedDbWriter            de.danoeh.antennapod                 D  Found new item: Episode 1: Introductions, Bug Bounty Reports, and BB Tips\n2025-05-13 02:39:21.503 17204-17289 de.danoeh....er@b0c8159 de.danoeh.antennapod                 D  Updating existing Feed in db\n2025-05-13 02:39:21.541 17204-17291 DBReader                de.danoeh.antennapod                 D  getFeedDownloadLog() called with: feed = [1]\n2025-05-13 02:39:21.542 17204-17265 DBReader                de.danoeh.antennapod                 D  Extracting Feedlist\n2025-05-13 02:39:21.544 17204-17290 DBReader                de.danoeh.antennapod                 D  Extracting Feedlist\n2025-05-13 02:39:21.545 17204-17290 AutoDownloadManager     de.danoeh.antennapod                 D  autodownloadUndownloadedItems\n```\n", "hints_text": "@ByteHamster \nThanks for confirming and updating the ticket\nwhat are the next steps? Let me know if there's anything I can help with.", "created_at": "2025-05-13T18:59:17Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7803, "instance_id": "AntennaPod__AntennaPod-7803", "issue_numbers": ["7547"], "base_commit": "b4de4548ae59233bf426e83b4d7384175bcf5e51", "patch": "diff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBReader.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBReader.java\nindex a5d47a163c5..08f9dd5a348 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBReader.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBReader.java\n@@ -612,8 +612,9 @@ public static StatisticsResult getStatistics(boolean includeMarkedAsPlayed,\n         adapter.open();\n \n         StatisticsResult result = new StatisticsResult();\n+        long sixMonthsAgo = System.currentTimeMillis() - (long) (1000L * 3600 * 24 * 30.44 * 6);\n         try (FeedCursor cursor = new FeedCursor(adapter.getFeedStatisticsCursor(\n-                includeMarkedAsPlayed, timeFilterFrom, timeFilterTo))) {\n+                includeMarkedAsPlayed, timeFilterFrom, timeFilterTo, sixMonthsAgo))) {\n             int indexOldestDate = cursor.getColumnIndexOrThrow(\"oldest_date\");\n             int indexNumEpisodes = cursor.getColumnIndexOrThrow(\"num_episodes\");\n             int indexEpisodesStarted = cursor.getColumnIndexOrThrow(\"episodes_started\");\n@@ -621,6 +622,7 @@ public static StatisticsResult getStatistics(boolean includeMarkedAsPlayed,\n             int indexPlayedTime = cursor.getColumnIndexOrThrow(\"played_time\");\n             int indexNumDownloaded = cursor.getColumnIndexOrThrow(\"num_downloaded\");\n             int indexDownloadSize = cursor.getColumnIndexOrThrow(\"download_size\");\n+            int indexNumRecentUnplayed = cursor.getColumnIndexOrThrow(\"num_recent_unplayed\");\n \n             while (cursor.moveToNext()) {\n                 Feed feed = cursor.getFeed();\n@@ -632,13 +634,14 @@ public static StatisticsResult getStatistics(boolean includeMarkedAsPlayed,\n                 long totalDownloadSize = cursor.getLong(indexDownloadSize);\n                 long episodesDownloadCount = cursor.getLong(indexNumDownloaded);\n                 long oldestDate = cursor.getLong(indexOldestDate);\n+                boolean hasRecentUnplayed = cursor.getLong(indexNumRecentUnplayed) > 0;\n \n                 if (episodes > 0 && oldestDate < Long.MAX_VALUE) {\n                     result.oldestDate = Math.min(result.oldestDate, oldestDate);\n                 }\n \n                 result.feedTime.add(new StatisticsItem(feed, feedTotalTime, feedPlayedTime, episodes,\n-                        episodesStarted, totalDownloadSize, episodesDownloadCount));\n+                        episodesStarted, totalDownloadSize, episodesDownloadCount, hasRecentUnplayed));\n             }\n         }\n         adapter.close();\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\nindex 84e62a759e4..e4b612b38bf 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n@@ -1215,7 +1215,8 @@ public final Cursor getMonthlyStatisticsCursor() {\n         return db.rawQuery(query, null);\n     }\n \n-    public final Cursor getFeedStatisticsCursor(boolean includeMarkedAsPlayed, long timeFilterFrom, long timeFilterTo) {\n+    public final Cursor getFeedStatisticsCursor(boolean includeMarkedAsPlayed, long timeFilterFrom,\n+                                                long timeFilterTo, long sixMonthsAgo) {\n         final String lastPlayedTime = TABLE_NAME_FEED_MEDIA + \".\" + KEY_LAST_PLAYED_TIME;\n         String wasStarted = TABLE_NAME_FEED_MEDIA + \".\" + KEY_PLAYBACK_COMPLETION_DATE + \" > 0\"\n                 + \" AND \" + TABLE_NAME_FEED_MEDIA + \".\" + KEY_PLAYED_DURATION + \" > 0\";\n@@ -1246,7 +1247,10 @@ public final Cursor getFeedStatisticsCursor(boolean includeMarkedAsPlayed, long\n                         + \"SUM(CASE WHEN \" + TABLE_NAME_FEED_MEDIA + \".\" + KEY_DOWNLOAD_DATE + \" > 0\"\n                                 + \" THEN 1 ELSE 0 END) AS num_downloaded, \"\n                         + \"SUM(CASE WHEN \" + TABLE_NAME_FEED_MEDIA + \".\" + KEY_DOWNLOAD_DATE + \" > 0\"\n-                                + \" THEN \" + TABLE_NAME_FEED_MEDIA + \".\" + KEY_SIZE + \" ELSE 0 END) AS download_size\"\n+                                + \" THEN \" + TABLE_NAME_FEED_MEDIA + \".\" + KEY_SIZE + \" ELSE 0 END) AS download_size, \"\n+                        + \"SUM(CASE WHEN \" + TABLE_NAME_FEED_ITEMS + \".\" + KEY_READ + \" != \" + FeedItem.PLAYED\n+                                + \" AND \" + TABLE_NAME_FEED_ITEMS + \".\" + KEY_PUBDATE + \" >= \" + sixMonthsAgo\n+                                + \" THEN 1 ELSE 0 END) AS num_recent_unplayed \"\n                 + \" FROM \" + TABLE_NAME_FEED_ITEMS\n                 + JOIN_FEED_ITEM_AND_MEDIA\n                 + \" INNER JOIN \" + TABLE_NAME_FEEDS\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/StatisticsItem.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/StatisticsItem.java\nindex 27c5e3bdd05..30baef29930 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/StatisticsItem.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/StatisticsItem.java\n@@ -31,9 +31,11 @@ public class StatisticsItem {\n      */\n     public final long episodesDownloadCount;\n \n+    public final boolean hasRecentUnplayed;\n+\n     public StatisticsItem(Feed feed, long time, long timePlayed,\n                           long episodes, long episodesStarted,\n-                          long totalDownloadSize, long episodesDownloadCount) {\n+                          long totalDownloadSize, long episodesDownloadCount, boolean hasRecentUnplayed) {\n         this.feed = feed;\n         this.time = time;\n         this.timePlayed = timePlayed;\n@@ -41,5 +43,6 @@ public StatisticsItem(Feed feed, long time, long timePlayed,\n         this.episodesStarted = episodesStarted;\n         this.totalDownloadSize = totalDownloadSize;\n         this.episodesDownloadCount = episodesDownloadCount;\n+        this.hasRecentUnplayed = hasRecentUnplayed;\n     }\n }\ndiff --git a/ui/echo/src/main/java/de/danoeh/antennapod/ui/echo/screen/HoarderScreen.java b/ui/echo/src/main/java/de/danoeh/antennapod/ui/echo/screen/HoarderScreen.java\nindex 68ec40fff74..4f1b7af135c 100644\n--- a/ui/echo/src/main/java/de/danoeh/antennapod/ui/echo/screen/HoarderScreen.java\n+++ b/ui/echo/src/main/java/de/danoeh/antennapod/ui/echo/screen/HoarderScreen.java\n@@ -1,6 +1,7 @@\n package de.danoeh.antennapod.ui.echo.screen;\n \n import android.content.Context;\n+import android.text.TextUtils;\n import android.view.LayoutInflater;\n import android.view.View;\n import de.danoeh.antennapod.storage.database.DBReader;\n@@ -62,8 +63,12 @@ public void startLoading(DBReader.StatisticsResult statisticsResult) {\n                 totalActivePodcasts++;\n                 if (item.timePlayed > 0) {\n                     playedActivePodcasts++;\n-                } else {\n-                    unplayedActive.add(item.feed.getTitle());\n+                } else if (item.hasRecentUnplayed) {\n+                    String title = item.feed.getTitle();\n+                    if (TextUtils.isEmpty(title)) {\n+                        title = item.feed.getFeedIdentifier();\n+                    }\n+                    unplayedActive.add(title);\n                 }\n             }\n         }\n", "test_patch": "", "problem_statement": "AntennaPod Echo suggested I \"check out again\" a podcast that hasn't had new episodes for 3 years\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\r\n\r\n### App version\r\n\r\n3.5.0f\r\n\r\n### Feature or improvement you want\r\n\r\nIn my AntennaPod Echo review of 2024, one of the screens said something like:\r\n\r\n\"You've played episodes from X% of your Y active subscriptions this year. How about checking out (podcast name) again?\"\r\n\r\nThe podcast that it picked is one that was in my subscriptions list but which hasn't released a new episode since 2021 (there's been no statement that it's ended, so I remain in hope, but probably in vain!)\r\n\r\nI had listened to all the episodes of that podcast - there were none remaining to be listened to.\r\n\r\nI'm mentioning this as a feature request rather than a bug report, as I guess this is subjective, but I wonder if the algorithm for picking the podcast on this slide could be improved? I realise that \"check out again\" could be interpreted as \"re-listen to old episodes\", which I suppose I *could* do, but it sounded more like \"hey, why aren't you giving more attention to this particular podcast\", like I was doing something wrong!\r\n\r\nSorry, I didn't capture a screenshot as I stupidly clicked the X button on the AntennaPod Echo banner (see #7543). I found the text that I think I saw in the source code!\r\n\r\nThanks for the AntennaPod Echo feature in general. It's quite fun, and I appreciate that it's all generated on-device :)\n", "hints_text": "Thanks @JohnVeness for bringing this up. This screen just presents a random subscription, but that should be changed to a random subscription from among the ones that have released at least 1 episode in the past 6 months which has not been played yet.\nHi, I'd like to work on this issue. If no one is currently working on it, I'll start investigating and preparing a PR. \ud83d\ude0a\nThanks @MKryo . Please go ahead :-)", "created_at": "2025-05-06T03:56:32Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7801, "instance_id": "AntennaPod__AntennaPod-7801", "issue_numbers": ["7697"], "base_commit": "6fe2d54935fe5d674b71ef71d7390dcd703d9aa5", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemListRecyclerView.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemListRecyclerView.java\nindex 2b301b03dd..0cf2f6e2e3 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemListRecyclerView.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemListRecyclerView.java\n@@ -1,23 +1,19 @@\n package de.danoeh.antennapod.ui.episodeslist;\n \n import android.content.Context;\n-import android.content.SharedPreferences;\n import android.content.res.Configuration;\n import android.util.AttributeSet;\n import android.view.View;\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n import androidx.appcompat.view.ContextThemeWrapper;\n+import androidx.core.util.Pair;\n import androidx.recyclerview.widget.DividerItemDecoration;\n import androidx.recyclerview.widget.LinearLayoutManager;\n import androidx.recyclerview.widget.RecyclerView;\n import de.danoeh.antennapod.R;\n \n public class EpisodeItemListRecyclerView extends RecyclerView {\n-    private static final String TAG = \"EpisodeItemListRecyclerView\";\n-    private static final String PREF_PREFIX_SCROLL_POSITION = \"scroll_position_\";\n-    private static final String PREF_PREFIX_SCROLL_OFFSET = \"scroll_offset_\";\n-\n     private LinearLayoutManager layoutManager;\n \n     public EpisodeItemListRecyclerView(@NonNull Context context) {\n@@ -51,29 +47,18 @@ protected void onConfigurationChanged(Configuration newConfig) {\n         setPadding(horizontalSpacing, getPaddingTop(), horizontalSpacing, getPaddingBottom());\n     }\n \n-    public void saveScrollPosition(String tag) {\n+    public Pair<Integer, Integer> getScrollPosition() {\n         int firstItem = layoutManager.findFirstVisibleItemPosition();\n         View firstItemView = layoutManager.findViewByPosition(firstItem);\n-        float topOffset;\n-        if (firstItemView == null) {\n-            topOffset = 0;\n-        } else {\n-            topOffset = firstItemView.getTop();\n-        }\n-\n-        getContext().getSharedPreferences(TAG, Context.MODE_PRIVATE).edit()\n-                .putInt(PREF_PREFIX_SCROLL_POSITION + tag, firstItem)\n-                .putInt(PREF_PREFIX_SCROLL_OFFSET + tag, (int) topOffset)\n-                .apply();\n+        int topOffset = firstItemView == null ? 0 : firstItemView.getTop();\n+        return new Pair<>(firstItem, topOffset);\n     }\n \n-    public void restoreScrollPosition(String tag) {\n-        SharedPreferences prefs = getContext().getSharedPreferences(TAG, Context.MODE_PRIVATE);\n-        int position = prefs.getInt(PREF_PREFIX_SCROLL_POSITION + tag, 0);\n-        int offset = prefs.getInt(PREF_PREFIX_SCROLL_OFFSET + tag, 0);\n-        if (position > 0 || offset > 0) {\n-            layoutManager.scrollToPositionWithOffset(position, offset);\n+    public void restoreScrollPosition(Pair<Integer, Integer> scrollPosition) {\n+        if (scrollPosition == null || (scrollPosition.first == 0 && scrollPosition.second == 0)) {\n+            return;\n         }\n+        layoutManager.scrollToPositionWithOffset(scrollPosition.first, scrollPosition.second);\n     }\n \n     public boolean isScrolledToBottom() {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodesListFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodesListFragment.java\nindex 673f2a98a8..931273f72c 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodesListFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodesListFragment.java\n@@ -98,7 +98,6 @@ public void onResume() {\n     @Override\n     public void onPause() {\n         super.onPause();\n-        recyclerView.saveScrollPosition(getPrefName());\n         unregisterForContextMenu(recyclerView);\n     }\n \n@@ -406,15 +405,15 @@ protected void loadItems() {\n                 .observeOn(AndroidSchedulers.mainThread())\n                 .subscribe(\n                         data -> {\n-                            final boolean restoreScrollPosition = episodes.isEmpty();\n+                            final boolean firstLoaded = episodes.isEmpty();\n                             episodes = data.first;\n                             hasMoreItems = !(page == 1 && episodes.size() < EPISODES_PER_PAGE);\n                             progressBar.setVisibility(View.GONE);\n                             listAdapter.setDummyViews(0);\n                             listAdapter.updateItems(episodes);\n                             listAdapter.setTotalNumberOfItems(data.second);\n-                            if (restoreScrollPosition) {\n-                                recyclerView.restoreScrollPosition(getPrefName());\n+                            if (firstLoaded) {\n+                                onItemsFirstLoaded();\n                             }\n                             updateToolbar();\n                         }, error -> {\n@@ -436,11 +435,12 @@ protected void loadItems() {\n \n     protected abstract String getFragmentTag();\n \n-    protected abstract String getPrefName();\n-\n     protected void updateToolbar() {\n     }\n \n+    protected void onItemsFirstLoaded() {\n+    }\n+\n     @Subscribe(sticky = true, threadMode = ThreadMode.MAIN)\n     public void onEventMainThread(FeedUpdateRunningEvent event) {\n         swipeRefreshLayout.setRefreshing(event.isFeedUpdateRunning);\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/AllEpisodesFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/AllEpisodesFragment.java\nindex eee2657c28..87810887ec 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/AllEpisodesFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/AllEpisodesFragment.java\n@@ -7,6 +7,8 @@\n import android.view.ViewGroup;\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n+import androidx.core.util.Pair;\n+\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.storage.database.DBReader;\n import de.danoeh.antennapod.ui.AllEpisodesFilterDialog;\n@@ -31,6 +33,7 @@\n public class AllEpisodesFragment extends EpisodesListFragment {\n     public static final String TAG = \"EpisodesFragment\";\n     public static final String PREF_NAME = \"PrefAllEpisodesFragment\";\n+    private static Pair<Integer, Integer> scrollPosition = null;\n \n     @NonNull\n     @Override\n@@ -85,8 +88,14 @@ protected String getFragmentTag() {\n     }\n \n     @Override\n-    protected String getPrefName() {\n-        return PREF_NAME;\n+    public void onPause() {\n+        super.onPause();\n+        scrollPosition = recyclerView.getScrollPosition();\n+    }\n+\n+    @Override\n+    protected void onItemsFirstLoaded() {\n+        recyclerView.restoreScrollPosition(scrollPosition);\n     }\n \n     @Override\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/InboxFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/InboxFragment.java\nindex 74e1bd3443..43b410bc4b 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/InboxFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/InboxFragment.java\n@@ -10,6 +10,8 @@\n import android.widget.CheckBox;\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n+import androidx.core.util.Pair;\n+\n import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.event.MessageEvent;\n@@ -35,6 +37,7 @@ public class InboxFragment extends EpisodesListFragment {\n     private static final String PREF_NAME = \"PrefNewEpisodesFragment\";\n     private static final String PREF_DO_NOT_PROMPT_REMOVE_ALL_FROM_INBOX = \"prefDoNotPromptRemovalAllFromInbox\";\n     private SharedPreferences prefs;\n+    private static Pair<Integer, Integer> scrollPosition = null;\n \n     @NonNull\n     @Override\n@@ -61,8 +64,14 @@ protected String getFragmentTag() {\n     }\n \n     @Override\n-    protected String getPrefName() {\n-        return PREF_NAME;\n+    public void onPause() {\n+        super.onPause();\n+        scrollPosition = recyclerView.getScrollPosition();\n+    }\n+\n+    @Override\n+    protected void onItemsFirstLoaded() {\n+        recyclerView.restoreScrollPosition(scrollPosition);\n     }\n \n     @Override\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/PlaybackHistoryFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/PlaybackHistoryFragment.java\nindex abdf043b1e..e3f75d8958 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/PlaybackHistoryFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/PlaybackHistoryFragment.java\n@@ -7,6 +7,8 @@\n import android.view.View;\n import android.view.ViewGroup;\n import androidx.annotation.NonNull;\n+import androidx.core.util.Pair;\n+\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.ui.common.ConfirmationDialog;\n import de.danoeh.antennapod.storage.database.DBReader;\n@@ -25,6 +27,7 @@ public class PlaybackHistoryFragment extends EpisodesListFragment {\n     public static final String TAG = \"PlaybackHistoryFragment\";\n     private static final FeedItemFilter FILTER_HISTORY = new FeedItemFilter(\n             FeedItemFilter.IS_IN_HISTORY, FeedItemFilter.INCLUDE_NOT_SUBSCRIBED);\n+    private static Pair<Integer, Integer> scrollPosition = null;\n \n     @NonNull\n     @Override\n@@ -50,8 +53,14 @@ protected String getFragmentTag() {\n     }\n \n     @Override\n-    protected String getPrefName() {\n-        return TAG;\n+    public void onPause() {\n+        super.onPause();\n+        scrollPosition = recyclerView.getScrollPosition();\n+    }\n+\n+    @Override\n+    protected void onItemsFirstLoaded() {\n+        recyclerView.restoreScrollPosition(scrollPosition);\n     }\n \n     @Override\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java\nindex a04e10eb79..2fba47f494 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java\n@@ -81,6 +81,8 @@ public class QueueFragment extends Fragment implements MaterialToolbar.OnMenuIte\n         EpisodeItemListAdapter.OnSelectModeListener {\n     public static final String TAG = \"QueueFragment\";\n     private static final String KEY_UP_ARROW = \"up_arrow\";\n+    private static final String SCROLL_POSITION_KEY = \"scroll_position\";\n+    private static final String SCROLL_OFFSET_KEY = \"scroll_offset\";\n \n     private TextView infoBar;\n     private EpisodeItemListRecyclerView recyclerView;\n@@ -111,17 +113,16 @@ public void onCreate(Bundle savedInstanceState) {\n     @Override\n     public void onStart() {\n         super.onStart();\n-        if (queue != null) {\n-            recyclerView.restoreScrollPosition(QueueFragment.TAG);\n-        }\n-        loadItems(true);\n+        loadItems();\n         EventBus.getDefault().register(this);\n     }\n \n     @Override\n     public void onPause() {\n         super.onPause();\n-        recyclerView.saveScrollPosition(QueueFragment.TAG);\n+        Pair<Integer, Integer> scrollPosition = recyclerView.getScrollPosition();\n+        prefs.edit().putInt(SCROLL_POSITION_KEY, scrollPosition.first)\n+                .putInt(SCROLL_OFFSET_KEY, scrollPosition.second).apply();\n     }\n \n     @Override\n@@ -139,7 +140,7 @@ public void onEventMainThread(QueueEvent event) {\n         if (queue == null) {\n             return;\n         } else if (recyclerAdapter == null) {\n-            loadItems(true);\n+            loadItems();\n             return;\n         }\n         int position;\n@@ -173,7 +174,6 @@ public void onEventMainThread(QueueEvent event) {\n         }\n         recyclerAdapter.updateDragDropEnabled();\n         refreshToolbarState();\n-        recyclerView.saveScrollPosition(QueueFragment.TAG);\n         refreshInfoBar();\n     }\n \n@@ -183,7 +183,7 @@ public void onEventMainThread(FeedItemEvent event) {\n         if (queue == null) {\n             return;\n         } else if (recyclerAdapter == null) {\n-            loadItems(true);\n+            loadItems();\n             return;\n         }\n         for (int i = 0, size = event.items.size(); i < size; i++) {\n@@ -227,14 +227,14 @@ public void onEventMainThread(PlaybackPositionEvent event) {\n \n     @Subscribe(threadMode = ThreadMode.MAIN)\n     public void onPlayerStatusChanged(PlayerStatusEvent event) {\n-        loadItems(false);\n+        loadItems();\n         refreshToolbarState();\n     }\n \n     @Subscribe(threadMode = ThreadMode.MAIN)\n     public void onUnreadItemsChanged(UnreadItemsUpdateEvent event) {\n         // Sent when playback position is reset\n-        loadItems(false);\n+        loadItems();\n         refreshToolbarState();\n     }\n \n@@ -521,7 +521,7 @@ private void refreshInfoBar() {\n         }\n     }\n \n-    private void loadItems(final boolean restoreScrollPosition) {\n+    private void loadItems() {\n         Log.d(TAG, \"loadItems()\");\n         if (disposable != null) {\n             disposable.dispose();\n@@ -536,6 +536,7 @@ private void loadItems(final boolean restoreScrollPosition) {\n                 .subscribeOn(Schedulers.io())\n                 .observeOn(AndroidSchedulers.mainThread())\n                 .subscribe(itemsAndDisplayButton -> {\n+                    final boolean restoreScrollPosition = queue == null || queue.isEmpty();\n                     queue = itemsAndDisplayButton.first;\n                     if (itemsAndDisplayButton.second) {\n                         emptyView.setMessage(R.string.no_queue_items_inbox_has_items_label);\n@@ -548,7 +549,9 @@ private void loadItems(final boolean restoreScrollPosition) {\n                     recyclerAdapter.setDummyViews(0);\n                     recyclerAdapter.updateItems(queue);\n                     if (restoreScrollPosition) {\n-                        recyclerView.restoreScrollPosition(QueueFragment.TAG);\n+                        Pair<Integer, Integer> scrollPosition = new Pair<>(\n+                                prefs.getInt(SCROLL_POSITION_KEY, 0), prefs.getInt(SCROLL_OFFSET_KEY, 0));\n+                        recyclerView.restoreScrollPosition(scrollPosition);\n                     }\n                     refreshInfoBar();\n                 }, error -> Log.e(TAG, Log.getStackTraceString(error)));\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/SubscriptionFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/SubscriptionFragment.java\nindex 342e0588cc..513adf758c 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/SubscriptionFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/SubscriptionFragment.java\n@@ -13,8 +13,10 @@\n import android.widget.ProgressBar;\n \n import androidx.annotation.NonNull;\n+import androidx.core.util.Pair;\n import androidx.fragment.app.Fragment;\n import androidx.recyclerview.widget.GridLayoutManager;\n+import androidx.recyclerview.widget.LinearLayoutManager;\n import androidx.recyclerview.widget.RecyclerView;\n import androidx.swiperefreshlayout.widget.SwipeRefreshLayout;\n \n@@ -87,6 +89,7 @@ public class SubscriptionFragment extends Fragment\n \n     private Disposable disposable;\n     private SharedPreferences prefs;\n+    private static Pair<Integer, Integer> scrollPosition = null;\n \n     private FloatingActionButton subscriptionAddButton;\n     private FloatingSelectMenu floatingSelectMenu;\n@@ -282,6 +285,12 @@ public void onStart() {\n         loadSubscriptions();\n     }\n \n+    @Override\n+    public void onPause() {\n+        super.onPause();\n+        scrollPosition = getScrollPosition();\n+    }\n+\n     @Override\n     public void onStop() {\n         super.onStop();\n@@ -316,6 +325,7 @@ private void loadSubscriptions() {\n                 .observeOn(AndroidSchedulers.mainThread())\n                 .subscribe(\n                     result -> {\n+                        final boolean firstLoaded = listItems == null || listItems.isEmpty();\n                         if (listItems != null && listItems.size() > result.size()) {\n                             // We have fewer items. This can result in items being selected that are no longer visible.\n                             subscriptionAdapter.endSelectMode();\n@@ -323,6 +333,9 @@ private void loadSubscriptions() {\n                         listItems = result;\n                         progressBar.setVisibility(View.GONE);\n                         subscriptionAdapter.setItems(result);\n+                        if (firstLoaded) {\n+                            restoreScrollPosition(scrollPosition);\n+                        }\n                         emptyView.updateVisibility();\n                     }, error -> {\n                         Log.e(TAG, Log.getStackTraceString(error));\n@@ -416,4 +429,20 @@ public void onStartSelectMode() {\n         subscriptionAddButton.setVisibility(View.GONE);\n         updateFilterVisibility();\n     }\n+\n+    public Pair<Integer, Integer> getScrollPosition() {\n+        LinearLayoutManager layoutManager = (LinearLayoutManager) subscriptionRecycler.getLayoutManager();\n+        int firstItem = layoutManager.findFirstVisibleItemPosition();\n+        View firstItemView = layoutManager.findViewByPosition(firstItem);\n+        int topOffset = firstItemView == null ? 0 : firstItemView.getTop();\n+        return new Pair<>(firstItem, topOffset);\n+    }\n+\n+    public void restoreScrollPosition(Pair<Integer, Integer> scrollPosition) {\n+        if (scrollPosition == null || (scrollPosition.first == 0 && scrollPosition.second == 0)) {\n+            return;\n+        }\n+        LinearLayoutManager layoutManager = (LinearLayoutManager) subscriptionRecycler.getLayoutManager();\n+        layoutManager.scrollToPositionWithOffset(scrollPosition.first, scrollPosition.second);\n+    }\n }\n", "test_patch": "", "problem_statement": "Remember last position of the Subscriptions screen\n### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [x] I will describe the problem with as much detail as possible.\n- [x] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.6.1\n\n### Feature or improvement you want\n\nFor Bottom Navigation, add the function/feature for Subscription Tab to remember the last location where last left it at be it a Tag/Group or App subscription. And double tap the Subscription Tab button to reset back top level/the full list of subscriptions showing tags/groups. \n\n### Why should this be added?\n\nAs a long time AntennaPod user, I became used to the Side-panel Subscription list. This list when organized by Tags/Groups these groups stayed open thus saving the users from having to re-navigate (open panel, open tag).\n\nI think that adding the requested feature will bring that ease of multi-tasking podcast management that the side-panel navigation experienced offers to the modern Bottom Navigation experience.\n\nI have my Bottom Navigation set as followed: Home - Queue - Subscription - Episodes - More\n\nCentering the AntennaPod experience on Subscription Tab where users have several podcast subscription organized by Tags/Groups. Open a group, do some podcast management, then navigate to Queue to make some arrangement. Selecting Subscription Tab again, this resets its location back to the top level showing all subscriptions and tag/groups.  It would be best if the Subscription Tab remembers the last location it was left it at before selecting another tab like Queue or Episodes. This would make the user experience more multitasking accessible. User can navigate between Subscription, Queue, episodes to setup their podcasts listening experience. Organize The queue, go over your subscription under the subscription tab and keep up with new episodes and ongoing listens via Episodes.\n\nIf and when the user needs to once again access the full list of subscriptions tags/groups, double tab the Subscription Tab.\n\n### Screenshots / Drawings / Technical details\n\n| \u2139\ufe0f | **Implementation instructions**|\n|---|:---|\n| | This request has been discussed further below. If you're interested in implementing this, please see the  [conclusions relevant for implementation below](https://github.com/AntennaPod/AntennaPod/issues/7697#issuecomment-2755884766).<br><sub>The original post has been edited by the project maintainers to add this link.</sub> |\n\n![Image](https://github.com/user-attachments/assets/5a87b91e-43ce-49a0-9115-56a3020bfdbc)\n", "hints_text": "Hi @SevenFactors \nThanks for chipping in with this suggestion. We discussed this in the [Needs: Decision meeting](https://antennapod.org/events/needs-decision), and:\n* Agree that the scroll position should be remembered\n* Think that it should not be remembered forever but until the app is closed (this can be done by using static variable)\n* Think that the Episodes screen should be aligned with this (it currently remembers the position forever, but when new episodes arrive to the top of the list, this effectively shifts the position to some seemingly random place)\n* Don't want to have the double-tap in the app, because it adds code complexity while it's not discoverable\nThis sounds great.  Thank you for taking my suggestions into account during your decision making process. Thank you for AntennaPod.\n\n@keunes \nHi, currently the Queue screen also remembers the scroll position forever. Do you want to change this too, so that the scroll position resets after the app closes?\nI think for the queue it is good to remember forever :) Some users listen from the middle to the bottom I think\nIt would be great if we could cover the podcast preview screen too (currently, each time one goes back after previewing a specific episode, the position in the list is lost).", "created_at": "2025-05-04T17:39:59Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7792, "instance_id": "AntennaPod__AntennaPod-7792", "issue_numbers": ["7777"], "base_commit": "560321cfd6a935b931c096ea7e472f9b0c3725b9", "patch": "diff --git a/ui/preferences/build.gradle b/ui/preferences/build.gradle\nindex 77045107119..d3e81b33814 100644\n--- a/ui/preferences/build.gradle\n+++ b/ui/preferences/build.gradle\n@@ -46,5 +46,5 @@ dependencies {\n     implementation \"com.squareup.okhttp3:okhttp:$okhttpVersion\"\n     implementation \"com.squareup.okhttp3:okhttp-urlconnection:$okhttpVersion\"\n     implementation \"org.greenrobot:eventbus:$eventbusVersion\"\n-    implementation 'com.github.ByteHamster:SearchPreference:2.7.1'\n+    implementation 'com.github.ByteHamster:SearchPreference:2.7.3'\n }\n", "test_patch": "", "problem_statement": "Crash after setting a sync server offline\n### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [x] I will describe the problem with as much detail as possible.\n- [x] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.8.0f (0d3643148)\n\n### Android version\n\n14\n\n### Device model\n\nPixel 8\n\n### First occurred\n\n2 days ago\n\n### Steps to reproduce\n\nI have tried to reproduce, one way is like the following:\n1. Open the app\n2. More - Settings\n3. Search \"sync\"\n4. Choose \"Synchronization - You can choose ...\"\n5. \"Choose sync ...\"\n6. \"Gpodder.net\"\n7. Open \"Airplane mode\" (to cut off the network)\n8. Enter any \"Server address\" (e.g., 1)\n9. Enter anything too\n10. Cancel\n11. Go back\n12. Click \"Synchronization - You can choose ...\" again\nThe app crashes\n\nhttps://github.com/user-attachments/assets/6cd3cae2-83ad-44f8-81c8-593a51dcefa6\n\n### Expected behaviour\n\nI think there are some possible things that could be done:\n1. Maybe check the connectivity of the server address?\n2. Maybe the data should be completely cleaned after cancellation?\n\n### Current behaviour\n\nThe app crashes\n\n### Logs\n\nThe corresponding crash log to the screen record\n```\n2025-04-26 15:30:38.522 11833-11833 AndroidRuntime          de.danoeh.antennapod.debug           E  FATAL EXCEPTION: main\n                                                                                                    Process: de.danoeh.antennapod.debug, PID: 11833\n                                                                                                    java.lang.NullPointerException: Attempt to invoke virtual method 'boolean java.lang.String.equals(java.lang.Object)' on a null object reference\n                                                                                                    \tat com.bytehamster.lib.preferencesearch.HistoryItem.equals(HistoryItem.java:24)\n                                                                                                    \tat java.util.ArrayList.indexOfRange(ArrayList.java:306)\n                                                                                                    \tat java.util.ArrayList.indexOf(ArrayList.java:293)\n                                                                                                    \tat java.util.ArrayList.contains(ArrayList.java:282)\n                                                                                                    \tat com.bytehamster.lib.preferencesearch.SearchPreferenceFragment.addHistoryEntry(SearchPreferenceFragment.java:184)\n                                                                                                    \tat com.bytehamster.lib.preferencesearch.SearchPreferenceFragment.onItemClicked(SearchPreferenceFragment.java:276)\n                                                                                                    \tat com.bytehamster.lib.preferencesearch.SearchPreferenceAdapter.lambda$onBindViewHolder$0$com-bytehamster-lib-preferencesearch-SearchPreferenceAdapter(SearchPreferenceAdapter.java:70)\n                                                                                                    \tat com.bytehamster.lib.preferencesearch.SearchPreferenceAdapter$$ExternalSyntheticLambda0.onClick(D8$$SyntheticClass:0)\n                                                                                                    \tat android.view.View.performClick(View.java:7659)\n                                                                                                    \tat android.view.View.performClickInternal(View.java:7636)\n                                                                                                    \tat android.view.View.-$$Nest$mperformClickInternal(Unknown Source:0)\n                                                                                                    \tat android.view.View$PerformClick.run(View.java:30156)\n                                                                                                    \tat android.os.Handler.handleCallback(Handler.java:958)\n                                                                                                    \tat android.os.Handler.dispatchMessage(Handler.java:99)\n                                                                                                    \tat android.os.Looper.loopOnce(Looper.java:205)\n                                                                                                    \tat android.os.Looper.loop(Looper.java:294)\n                                                                                                    \tat android.app.ActivityThread.main(ActivityThread.java:8177)\n                                                                                                    \tat java.lang.reflect.Method.invoke(Native Method)\n                                                                                                    \tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:552)\n                                                                                                    \tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:971)\n```\n", "hints_text": "", "created_at": "2025-04-30T20:47:05Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7791, "instance_id": "AntennaPod__AntennaPod-7791", "issue_numbers": ["7783"], "base_commit": "560321cfd6a935b931c096ea7e472f9b0c3725b9", "patch": "diff --git a/net/sync/gpoddernet/src/main/java/de/danoeh/antennapod/net/sync/HostnameParser.java b/net/sync/gpoddernet/src/main/java/de/danoeh/antennapod/net/sync/HostnameParser.java\nindex 8decf7feaa3..74c5008856f 100644\n--- a/net/sync/gpoddernet/src/main/java/de/danoeh/antennapod/net/sync/HostnameParser.java\n+++ b/net/sync/gpoddernet/src/main/java/de/danoeh/antennapod/net/sync/HostnameParser.java\n@@ -19,7 +19,11 @@ public HostnameParser(String hosturl) {\n         Matcher m = URLSPLIT_REGEX.matcher(hosturl);\n         if (m.matches()) {\n             scheme = m.group(1);\n-            host = IDN.toASCII(m.group(2));\n+            try {\n+                host = IDN.toASCII(m.group(2));\n+            } catch (IllegalArgumentException e) {\n+                host = \"invalid-hostname\";\n+            }\n             if (m.group(3) == null) {\n                 port = -1;\n             } else {\n@@ -33,7 +37,11 @@ public HostnameParser(String hosturl) {\n         } else {\n             // URL does not match regex: use it anyway -> this will cause an exception on connect\n             scheme = \"https\";\n-            host = IDN.toASCII(hosturl);\n+            try {\n+                host = IDN.toASCII(hosturl);\n+            } catch (IllegalArgumentException e) {\n+                host = \"invalid-hostname\";\n+            }\n             port = 443;\n         }\n \n", "test_patch": "", "problem_statement": "App crashes with java.lang.IllegalArgumentException while entering special characters in the address server under synchronization\n### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [x] I will describe the problem with as much detail as possible.\n- [x] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.8.0 from fdroid\n\n### Android version\n\nandroid11\n\n### Device model\n\ngoogle nexus4\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. click More\n2. click settings\n3. click synchronization\n4. click choose synchronization provider\n5. choose Gpodder.net\n6. enter an address with special characters, including emojis or punctuation marks.\n7. click Proceed to login\n8. found that the app is unresponsive or crashing.\n\n### Expected behaviour\n\n_No response_\n\n### Current behaviour\n\nhttps://github.com/user-attachments/assets/77bcd9f4-af81-4c04-9310-2a8787de2d81\n\n### Logs\n\n_No response_\n", "hints_text": "logs:\n03-06 07:01:21.374  5187  5187 E AndroidRuntime: FATAL EXCEPTION: main\n03-06 07:01:21.374  5187  5187 E AndroidRuntime: Process: de.danoeh.antennapod.debug, PID: 5187\n03-06 07:01:21.374  5187  5187 E AndroidRuntime: java.lang.IllegalArgumentException: Invalid input to toASCII: .p,\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at [java.net](http://java.net/).IDN.toASCII(IDN.java:115)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at [java.net](http://java.net/).IDN.toASCII(IDN.java:138)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at [de.danoeh.antennapod.net](http://de.danoeh.antennapod.net/).sync.HostnameParser.<init>(HostnameParser.java:22)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at [de.danoeh.antennapod.net](http://de.danoeh.antennapod.net/).sync.nextcloud.NextcloudLoginFlow.<init>(NextcloudLoginFlow.java:44)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at de.danoeh.antennapod.ui.preferences.screen.synchronization.NextcloudAuthenticationFragment.lambda$onCreateDialog$0(NextcloudAuthenticationFragment.java:49)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at de.danoeh.antennapod.ui.preferences.screen.synchronization.NextcloudAuthenticationFragment.$r8$lambda$2nygqGZquYMXYt4ldLT9EYPY358(Unknown Source:0)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at de.danoeh.antennapod.ui.preferences.screen.synchronization.NextcloudAuthenticationFragment$$ExternalSyntheticLambda1.onClick(Unknown Source:2)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at android.view.View.performClick(View.java:7448)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at com.google.android.material.button.MaterialButton.performClick(MaterialButton.java:1218)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at android.view.View.performClickInternal(View.java:7425)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at android.view.View.access$3600(View.java:810)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at android.view.View$PerformClick.run(View.java:28305)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at android.os.Handler.handleCallback(Handler.java:938)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at android.os.Handler.dispatchMessage(Handler.java:99)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at android.os.Looper.loop(Looper.java:223)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at android.app.ActivityThread.main(ActivityThread.java:7656)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at java.lang.reflect.Method.invoke(Native Method)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:592)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:947)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime: Caused by: Found zero length lable after NamePrep.. line:  0. preContext:  . postContext: \n03-06 07:01:21.374  5187  5187 E AndroidRuntime: \n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at android.icu.impl.IDNA2003.convertToASCII(IDNA2003.java:186)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at android.icu.impl.IDNA2003.convertIDNToASCII(IDNA2003.java:276)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at android.icu.text.IDNA.convertIDNToASCII(IDNA.java:655)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at [java.net](http://java.net/).IDN.toASCII(IDN.java:108)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         ... 18 more\n\nlog2:\n03-04 18:21:57.961  2828  2828 E AndroidRuntime: FATAL EXCEPTION: main\n03-04 18:21:57.961  2828  2828 E AndroidRuntime: Process: de.danoeh.antennapod.debug, PID: 2828\n03-04 18:21:57.961  2828  2828 E AndroidRuntime: java.lang.IllegalArgumentException: Invalid input to toASCII: 2,#5n[h\ud83d\udd25\ud83d\udc95\ud83d\udc9e]\ud83d\ude3b4buu rtspgaf\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at [java.net](http://java.net/).IDN.toASCII(IDN.java:115)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at [java.net](http://java.net/).IDN.toASCII(IDN.java:138)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at [de.danoeh.antennapod.net](http://de.danoeh.antennapod.net/).sync.HostnameParser.<init>(HostnameParser.java:22)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at [de.danoeh.antennapod.net](http://de.danoeh.antennapod.net/).sync.nextcloud.NextcloudLoginFlow.<init>(NextcloudLoginFlow.java:44)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at de.danoeh.antennapod.ui.preferences.screen.synchronization.NextcloudAuthenticationFragment.lambda$onCreateDialog$0(NextcloudAuthenticationFragment.java:49)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at de.danoeh.antennapod.ui.preferences.screen.synchronization.NextcloudAuthenticationFragment.$r8$lambda$2nygqGZquYMXYt4ldLT9EYPY358(Unknown Source:0)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at de.danoeh.antennapod.ui.preferences.screen.synchronization.NextcloudAuthenticationFragment$$ExternalSyntheticLambda1.onClick(Unknown Source:2)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at android.view.View.performClick(View.java:7448)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at com.google.android.material.button.MaterialButton.performClick(MaterialButton.java:1218)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at android.view.View.performClickInternal(View.java:7425)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at android.view.View.access$3600(View.java:810)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at android.view.View$PerformClick.run(View.java:28305)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at android.os.Handler.handleCallback(Handler.java:938)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at android.os.Handler.dispatchMessage(Handler.java:99)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at android.os.Looper.loop(Looper.java:223)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at android.app.ActivityThread.main(ActivityThread.java:7656)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at java.lang.reflect.Method.invoke(Native Method)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:592)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:947)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime: Caused by: An unassigned code point was found in the input. line:  0. preContext:  . postContext: \ud83d\udc95\ud83d\udc9e]\ud83d\ude3b4buu rtspgaf\n03-04 18:21:57.961  2828  2828 E AndroidRuntime: \n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at android.icu.text.StringPrep.map(StringPrep.java:396)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at android.icu.text.StringPrep.prepare(StringPrep.java:506)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at android.icu.impl.IDNA2003.convertToASCII(IDNA2003.java:179)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at android.icu.impl.IDNA2003.convertIDNToASCII(IDNA2003.java:276)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at android.icu.text.IDNA.convertIDNToASCII(IDNA.java:655)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at [java.net](http://java.net/).IDN.toASCII(IDN.java:108)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         ... 18 more\nHi @buluu97 \nCould I ask you to please update your post to put the logs in between three backticks (```) so that it becomes a bit more readable?\nMany thanks in advance!\n```03-06 07:01:21.374  5187  5187 E AndroidRuntime: FATAL EXCEPTION: main\n03-06 07:01:21.374  5187  5187 E AndroidRuntime: Process: de.danoeh.antennapod.debug, PID: 5187\n03-06 07:01:21.374  5187  5187 E AndroidRuntime: java.lang.IllegalArgumentException: Invalid input to toASCII: .p,\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at [java.net](http://java.net/).IDN.toASCII(IDN.java:115)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at [java.net](http://java.net/).IDN.toASCII(IDN.java:138)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at [de.danoeh.antennapod.net](http://de.danoeh.antennapod.net/).sync.HostnameParser.<init>(HostnameParser.java:22)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at [de.danoeh.antennapod.net](http://de.danoeh.antennapod.net/).sync.nextcloud.NextcloudLoginFlow.<init>(NextcloudLoginFlow.java:44)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at de.danoeh.antennapod.ui.preferences.screen.synchronization.NextcloudAuthenticationFragment.lambda$onCreateDialog$0(NextcloudAuthenticationFragment.java:49)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at de.danoeh.antennapod.ui.preferences.screen.synchronization.NextcloudAuthenticationFragment.$r8$lambda$2nygqGZquYMXYt4ldLT9EYPY358(Unknown Source:0)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at de.danoeh.antennapod.ui.preferences.screen.synchronization.NextcloudAuthenticationFragment$$ExternalSyntheticLambda1.onClick(Unknown Source:2)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at android.view.View.performClick(View.java:7448)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at com.google.android.material.button.MaterialButton.performClick(MaterialButton.java:1218)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at android.view.View.performClickInternal(View.java:7425)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at android.view.View.access$3600(View.java:810)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at android.view.View$PerformClick.run(View.java:28305)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at android.os.Handler.handleCallback(Handler.java:938)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at android.os.Handler.dispatchMessage(Handler.java:99)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at android.os.Looper.loop(Looper.java:223)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at android.app.ActivityThread.main(ActivityThread.java:7656)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at java.lang.reflect.Method.invoke(Native Method)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:592)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:947)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime: Caused by: Found zero length lable after NamePrep.. line:  0. preContext:  . postContext: \n03-06 07:01:21.374  5187  5187 E AndroidRuntime: \n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at android.icu.impl.IDNA2003.convertToASCII(IDNA2003.java:186)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at android.icu.impl.IDNA2003.convertIDNToASCII(IDNA2003.java:276)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at android.icu.text.IDNA.convertIDNToASCII(IDNA.java:655)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         at [java.net](http://java.net/).IDN.toASCII(IDN.java:108)\n03-06 07:01:21.374  5187  5187 E AndroidRuntime:         ... 18 more```\n```03-04 18:21:57.961  2828  2828 E AndroidRuntime: FATAL EXCEPTION: main\n03-04 18:21:57.961  2828  2828 E AndroidRuntime: Process: de.danoeh.antennapod.debug, PID: 2828\n03-04 18:21:57.961  2828  2828 E AndroidRuntime: java.lang.IllegalArgumentException: Invalid input to toASCII: 2,#5n[h\ud83d\udd25\ud83d\udc95\ud83d\udc9e]\ud83d\ude3b4buu rtspgaf\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at [java.net](http://java.net/).IDN.toASCII(IDN.java:115)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at [java.net](http://java.net/).IDN.toASCII(IDN.java:138)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at [de.danoeh.antennapod.net](http://de.danoeh.antennapod.net/).sync.HostnameParser.<init>(HostnameParser.java:22)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at [de.danoeh.antennapod.net](http://de.danoeh.antennapod.net/).sync.nextcloud.NextcloudLoginFlow.<init>(NextcloudLoginFlow.java:44)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at de.danoeh.antennapod.ui.preferences.screen.synchronization.NextcloudAuthenticationFragment.lambda$onCreateDialog$0(NextcloudAuthenticationFragment.java:49)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at de.danoeh.antennapod.ui.preferences.screen.synchronization.NextcloudAuthenticationFragment.$r8$lambda$2nygqGZquYMXYt4ldLT9EYPY358(Unknown Source:0)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at de.danoeh.antennapod.ui.preferences.screen.synchronization.NextcloudAuthenticationFragment$$ExternalSyntheticLambda1.onClick(Unknown Source:2)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at android.view.View.performClick(View.java:7448)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at com.google.android.material.button.MaterialButton.performClick(MaterialButton.java:1218)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at android.view.View.performClickInternal(View.java:7425)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at android.view.View.access$3600(View.java:810)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at android.view.View$PerformClick.run(View.java:28305)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at android.os.Handler.handleCallback(Handler.java:938)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at android.os.Handler.dispatchMessage(Handler.java:99)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at android.os.Looper.loop(Looper.java:223)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at android.app.ActivityThread.main(ActivityThread.java:7656)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at java.lang.reflect.Method.invoke(Native Method)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:592)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:947)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime: Caused by: An unassigned code point was found in the input. line:  0. preContext:  . postContext: \ud83d\udc95\ud83d\udc9e]\ud83d\ude3b4buu rtspgaf\n03-04 18:21:57.961  2828  2828 E AndroidRuntime: \n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at android.icu.text.StringPrep.map(StringPrep.java:396)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at android.icu.text.StringPrep.prepare(StringPrep.java:506)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at android.icu.impl.IDNA2003.convertToASCII(IDNA2003.java:179)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at android.icu.impl.IDNA2003.convertIDNToASCII(IDNA2003.java:276)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at android.icu.text.IDNA.convertIDNToASCII(IDNA.java:655)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         at [java.net](http://java.net/).IDN.toASCII(IDN.java:108)\n03-04 18:21:57.961  2828  2828 E AndroidRuntime:         ... 18 more```", "created_at": "2025-04-30T20:32:38Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7790, "instance_id": "AntennaPod__AntennaPod-7790", "issue_numbers": ["7787", "7786"], "base_commit": "560321cfd6a935b931c096ea7e472f9b0c3725b9", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java\nindex a171ef571b..7169ce8e70 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java\n@@ -55,7 +55,7 @@ private FeedItemMenuHandler() {\n      * @return Returns true if selectedItem is not null.\n      */\n     public static boolean onPrepareMenu(Menu menu, List<FeedItem> selectedItems, int... excludeIds) {\n-        if (menu == null || selectedItems == null) {\n+        if (menu == null || selectedItems == null || selectedItems.isEmpty() || selectedItems.get(0) == null) {\n             return false;\n         }\n         boolean canSkip = false;\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\nindex 19b359b71e..41d36f53f5 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\n@@ -533,6 +533,9 @@ private void setupHeaderView() {\n         viewBinding.header.imgvCover.setOnClickListener(v -> showFeedInfo());\n         viewBinding.header.headerDescriptionLabel.setOnClickListener(v -> showFeedInfo());\n         viewBinding.header.butSubscribe.setOnClickListener(view -> {\n+            if (feed == null) {\n+                return;\n+            }\n             DBWriter.setFeedState(getContext(), feed, Feed.STATE_SUBSCRIBED);\n             MainActivityStarter mainActivityStarter = new MainActivityStarter(getContext());\n             mainActivityStarter.withOpenFeed(feed.getId());\n@@ -540,13 +543,18 @@ private void setupHeaderView() {\n             startActivity(mainActivityStarter.getIntent());\n         });\n         viewBinding.header.butShowSettings.setOnClickListener(v -> {\n-            if (feed != null) {\n-                FeedSettingsFragment fragment = FeedSettingsFragment.newInstance(feed);\n-                ((MainActivity) getActivity()).loadChildFragment(fragment, TransitionEffect.SLIDE);\n+            if (feed == null) {\n+                return;\n+            }\n+            FeedSettingsFragment fragment = FeedSettingsFragment.newInstance(feed);\n+            ((MainActivity) getActivity()).loadChildFragment(fragment, TransitionEffect.SLIDE);\n+        });\n+        viewBinding.header.butFilter.setOnClickListener(v -> {\n+            if (feed == null) {\n+                return;\n             }\n+            FeedItemFilterDialog.newInstance(feed).show(getChildFragmentManager(), null);\n         });\n-        viewBinding.header.butFilter.setOnClickListener(v ->\n-                FeedItemFilterDialog.newInstance(feed).show(getChildFragmentManager(), null));\n         viewBinding.header.txtvFailure.setOnClickListener(v -> showErrorDetails());\n     }\n \n", "test_patch": "", "problem_statement": "streaming different epidoses in s short time makes the app into a wierd state and crash\n### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [x] I will describe the problem with as much detail as possible.\n- [x] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.8.0 \n\n### Android version\n\nandroid 11\n\n### Device model\n\ngoogle nexus 4\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. streaming different episodes\n2. when app is in a blank page, click earth button\n3. app crashes\n\nIt may be a regression bug?  I found this bug appears earlier in #7371.\n\n\n### Expected behaviour\n\n_No response_\n\n### Current behaviour\n\nhttps://github.com/user-attachments/assets/be9f9fe3-1985-4e2c-a2ce-101d1708cf37\n\n### Logs\n\n_No response_\nregression bug: when the podcast is loading,  click filter button can cause app crash\n### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [x] I will describe the problem with as much detail as possible.\n- [x] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.8.0 from Fdroid\n\n### Android version\n\nandriod 11\n\n### Device model\n\ngoogle nexus\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. click any episode \n2. click stream  to play the  episode\n3. click more option and select open podcast\n4. the app is  loading podcast ,  if we click the filter button or  info button ,the app  will crash.\n\nI have searched in the closed issues, and I find that this is a regression bug , same as #7350 .\n\n### Expected behaviour\n\n_No response_\n\n### Current behaviour\n\nhttps://github.com/user-attachments/assets/04966714-4841-4c98-9f80-db5353588880\n\n### Logs\n\n```\n04-12 07:09:51.802  9565  9565 E AndroidRuntime: FATAL EXCEPTION: main\n04-12 07:09:51.802  9565  9565 E AndroidRuntime: Process: de.danoeh.antennapod.debug, PID: 9565\n04-12 07:09:51.802  9565  9565 E AndroidRuntime: java.lang.NullPointerException: Attempt to invoke virtual method 'de.danoeh.antennapod.model.feed.FeedItemFilter de.danoeh.antennapod.model.feed.Feed.getItemFilter()' on a null object reference\n04-12 07:09:51.802  9565  9565 E AndroidRuntime:         at de.danoeh.antennapod.ui.FeedItemFilterDialog.newInstance(FeedItemFilterDialog.java:16)\n04-12 07:09:51.802  9565  9565 E AndroidRuntime:         at de.danoeh.antennapod.ui.screen.feed.FeedItemlistFragment.lambda$setupHeaderView$15(FeedItemlistFragment.java:525)\n04-12 07:09:51.802  9565  9565 E AndroidRuntime:         at de.danoeh.antennapod.ui.screen.feed.FeedItemlistFragment.$r8$lambda$NJLnDtWfw9YDCB1GZqG9XrCgZ_c(Unknown Source:0)\n04-12 07:09:51.802  9565  9565 E AndroidRuntime:         at de.danoeh.antennapod.ui.screen.feed.FeedItemlistFragment$$ExternalSyntheticLambda20.onClick(Unknown Source:2)\n04-12 07:09:51.802  9565  9565 E AndroidRuntime:         at android.view.View.performClick(View.java:7448)\n04-12 07:09:51.802  9565  9565 E AndroidRuntime:         at android.view.View.performClickInternal(View.java:7425)\n04-12 07:09:51.802  9565  9565 E AndroidRuntime:         at android.view.View.access$3600(View.java:810)\n04-12 07:09:51.802  9565  9565 E AndroidRuntime:         at android.view.View$PerformClick.run(View.java:28305)\n04-12 07:09:51.802  9565  9565 E AndroidRuntime:         at android.os.Handler.handleCallback(Handler.java:938)\n04-12 07:09:51.802  9565  9565 E AndroidRuntime:         at android.os.Handler.dispatchMessage(Handler.java:99)\n04-12 07:09:51.802  9565  9565 E AndroidRuntime:         at android.os.Looper.loop(Looper.java:223)\n04-12 07:09:51.802  9565  9565 E AndroidRuntime:         at android.app.ActivityThread.main(ActivityThread.java:7656)\n04-12 07:09:51.802  9565  9565 E AndroidRuntime:         at java.lang.reflect.Method.invoke(Native Method)\n04-12 07:09:51.802  9565  9565 E AndroidRuntime:         at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:592)\n04-12 07:09:51.802  9565  9565 E AndroidRuntime:         at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:947)\n```\n", "hints_text": "```\n04-30 12:52:22.778  2736  2736 E AndroidRuntime: FATAL EXCEPTION: main\n04-30 12:52:22.778  2736  2736 E AndroidRuntime: Process: de.danoeh.antennapod, PID: 2736\n04-30 12:52:22.778  2736  2736 E AndroidRuntime: java.lang.NullPointerException: Attempt to invoke virtual method 'java.lang.String de.danoeh.antennapod.model.feed.FeedItem.getLinkWithFallback()' on a null object reference\n04-30 12:52:22.778  2736  2736 E AndroidRuntime:        at de.danoeh.antennapod.ui.episodeslist.FeedItemMenuHandler.onMenuItemClicked(SourceFile:232)\n04-30 12:52:22.778  2736  2736 E AndroidRuntime:        at de.danoeh.antennapod.ui.screen.episode.ItemPagerFragment.onMenuItemClick(SourceFile:162)\n04-30 12:52:22.778  2736  2736 E AndroidRuntime:        at androidx.appcompat.widget.Toolbar$1.onMenuItemClick(SourceFile:225)\n04-30 12:52:22.778  2736  2736 E AndroidRuntime:        at androidx.appcompat.widget.ActionMenuView$MenuBuilderCallback.onMenuItemSelected(SourceFile:781)\n04-30 12:52:22.778  2736  2736 E AndroidRuntime:        at androidx.appcompat.view.menu.MenuBuilder.dispatchMenuItemSelected(SourceFile:836)\n04-30 12:52:22.778  2736  2736 E AndroidRuntime:        at androidx.appcompat.view.menu.MenuItemImpl.invoke(SourceFile:159)\n04-30 12:52:22.778  2736  2736 E AndroidRuntime:        at androidx.appcompat.view.menu.MenuBuilder.performItemAction(SourceFile:987)\n04-30 12:52:22.778  2736  2736 E AndroidRuntime:        at androidx.appcompat.view.menu.MenuBuilder.performItemAction(SourceFile:977)\n04-30 12:52:22.778  2736  2736 E AndroidRuntime:        at androidx.appcompat.widget.ActionMenuView.invokeItem(SourceFile:625)\n04-30 12:52:22.778  2736  2736 E AndroidRuntime:        at androidx.appcompat.view.menu.ActionMenuItemView.onClick(SourceFile:156)\n04-30 12:52:22.778  2736  2736 E AndroidRuntime:        at android.view.View.performClick(View.java:7448)\n04-30 12:52:22.778  2736  2736 E AndroidRuntime:        at android.view.View.performClickInternal(View.java:7425)\n04-30 12:52:22.778  2736  2736 E AndroidRuntime:        at android.view.View.access$3600(View.java:810)\n04-30 12:52:22.778  2736  2736 E AndroidRuntime:        at android.view.View$PerformClick.run(View.java:28305)\n04-30 12:52:22.778  2736  2736 E AndroidRuntime:        at android.os.Handler.handleCallback(Handler.java:938)\n04-30 12:52:22.778  2736  2736 E AndroidRuntime:        at android.os.Handler.dispatchMessage(Handler.java:99)\n04-30 12:52:22.778  2736  2736 E AndroidRuntime:        at android.os.Looper.loop(Looper.java:223)\n04-30 12:52:22.778  2736  2736 E AndroidRuntime:        at android.app.ActivityThread.main(ActivityThread.java:7656)\n04-30 12:52:22.778  2736  2736 E AndroidRuntime:        at java.lang.reflect.Method.invoke(Native Method)\n04-30 12:52:22.778  2736  2736 E AndroidRuntime:        at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:592)\n04-30 12:52:22.778  2736  2736 E AndroidRuntime:        at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:947)\n04-30 12:52:22.780  2736  2736 D UserPreferences: User data folder not writable or not set. Trying default.\n04-30 12:52:22.787   475  1108 W ActivityTaskManager:   Force finishing activity de.danoeh.antennapod/.activity.MainActivity\n```\n", "created_at": "2025-04-30T20:27:54Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7772, "instance_id": "AntennaPod__AntennaPod-7772", "issue_numbers": ["6891"], "base_commit": "49e6da67271dead9d0a574c9ecbd70c35da18d36", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\nindex d1f625b326..6dbf76c0ed 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n@@ -19,6 +19,7 @@\n import androidx.annotation.IdRes;\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n+import androidx.annotation.StyleRes;\n import androidx.appcompat.app.ActionBarDrawerToggle;\n import androidx.core.graphics.Insets;\n import androidx.core.view.ViewCompat;\n@@ -513,6 +514,11 @@ protected void onPostCreate(Bundle savedInstanceState) {\n         }\n     }\n \n+    private void restartActivity() {\n+        finish();\n+        startActivity(new Intent(this, MainActivity.class));\n+    }\n+\n     @Override\n     public void onConfigurationChanged(Configuration newConfig) {\n         super.onConfigurationChanged(newConfig);\n@@ -520,6 +526,11 @@ public void onConfigurationChanged(Configuration newConfig) {\n             drawerToggle.onConfigurationChanged(newConfig);\n         }\n         setNavDrawerSize();\n+\n+        @StyleRes int requiredTheme = ThemeSwitcher.getNoTitleTheme(this);\n+        if (requiredTheme != lastTheme) {\n+            restartActivity();\n+        }\n     }\n \n     private void setNavDrawerSize() {\n@@ -568,8 +579,7 @@ protected void onResume() {\n         boolean hasBottomNavigation = bottomNavigation != null;\n         if (lastTheme != ThemeSwitcher.getNoTitleTheme(this)\n                 || hasBottomNavigation != UserPreferences.isBottomNavigationEnabled()) {\n-            finish();\n-            startActivity(new Intent(this, MainActivity.class));\n+            restartActivity();\n         }\n         if (UserPreferences.getHiddenDrawerItems().contains(NavDrawerFragment.getLastNavFragment(this))) {\n             loadFragment(UserPreferences.getDefaultPage(), null);\n", "test_patch": "", "problem_statement": "App doesn't change to dark mode unless it is reopened\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n### App version\r\n\r\n3.2.0\r\n\r\n### Where did you get the app from\r\n\r\nF-Droid\r\n\r\n### Android version\r\n\r\n12\r\n\r\n### Device model\r\n\r\nAGT-AN00\r\n\r\n### First occurred\r\n\r\nAlways\r\n\r\n### Steps to reproduce\r\n\r\n1. open the app\r\n2. Open the control center (swipe down at the top of the phone)\r\n3. Enable or Disable \"dark mode\"\r\n4. Back to the app\r\n\r\n### Expected behaviour\r\n\r\nApp changes to dark mode immediately.\r\n\r\n### Current behaviour\r\n\r\nNothing happens unless you close and reopen the app\r\n\r\nPS: As shown in the video, the app can change to dark mode immediately in the setting pages. But in the main pages, it needs to be reopened.\r\nhttps://github.com/AntennaPod/AntennaPod/assets/149387586/5bb50bb1-5187-4ad7-85e8-9da49cb326aa\r\n\r\n\r\n\r\n### Logs\r\n\r\n_No response_\n", "hints_text": "This is a hard one to solve properly. We have to rewrite large parts of the data handling to ViewModels \nMaybe the simpler option of checking the theme in `MainActivity.onConfigurationChanged` would be the easier option for now\nHey all,\nTaking a look at this bug based on the suggestion from ByteHamster\nI have a simple fix for this which is different from @ByteHamster 's suggestion. \n\nThe issue is that MainActivity entry in manifest file prevents activity from restarting on theme changes. See the configChanges entry below. Removing the `uiMode` will fix the issue and let the system handle it. \n\nAny possible issues if I remove the `uiMode` from it?\n\n```\n        <activity\n            android:name=\".activity.MainActivity\"\n            android:configChanges=\"keyboardHidden|orientation|screenSize|smallestScreenSize|screenLayout|density|uiMode|keyboard|navigation\"\n```\nThe uiMode was added for samsung DEX support: https://github.com/AntennaPod/AntennaPod/pull/4343", "created_at": "2025-04-24T23:22:06Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7768, "instance_id": "AntennaPod__AntennaPod-7768", "issue_numbers": ["7570"], "base_commit": "0d3643148eb13d3f5342fa4a9cacd25fae96702a", "patch": "diff --git a/net/sync/service/src/main/java/de/danoeh/antennapod/net/sync/service/SyncService.java b/net/sync/service/src/main/java/de/danoeh/antennapod/net/sync/service/SyncService.java\nindex 2da3aa6c1e3..3c3723694b8 100644\n--- a/net/sync/service/src/main/java/de/danoeh/antennapod/net/sync/service/SyncService.java\n+++ b/net/sync/service/src/main/java/de/danoeh/antennapod/net/sync/service/SyncService.java\n@@ -201,6 +201,9 @@ private void syncSubscriptions(ISyncService syncServiceImpl) throws SyncServiceE\n                         .uploadSubscriptionChanges(queuedAddedFeeds, queuedRemovedFeeds);\n                 synchronizationQueueStorage.clearFeedQueues();\n                 newTimeStamp = uploadResponse.timestamp;\n+            } catch (SyncServiceException exception) {\n+                synchronizationQueueStorage.removeLegacyConflictingFeedEntries(localSubscriptions);\n+                throw exception;\n             } finally {\n                 LockingAsyncExecutor.unlock();\n             }\ndiff --git a/net/sync/service/src/main/java/de/danoeh/antennapod/net/sync/service/SynchronizationQueueStorage.java b/net/sync/service/src/main/java/de/danoeh/antennapod/net/sync/service/SynchronizationQueueStorage.java\nindex 3e722e25fa7..86ace73ace8 100644\n--- a/net/sync/service/src/main/java/de/danoeh/antennapod/net/sync/service/SynchronizationQueueStorage.java\n+++ b/net/sync/service/src/main/java/de/danoeh/antennapod/net/sync/service/SynchronizationQueueStorage.java\n@@ -8,6 +8,8 @@\n import org.json.JSONException;\n \n import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n \n import de.danoeh.antennapod.storage.preferences.SynchronizationSettings;\n \n@@ -109,6 +111,22 @@ protected void enqueueFeedAdded(String downloadUrl) {\n         }\n     }\n \n+    /** Remove feed entries that conflict with the given list of current local subscriptions.\n+     * <>\n+     * This is only relevant for old clients that have legacy data. In newer versions, `enqueueFeedAdded`\n+     * and `enqueueFeedAdded` already take care of removing conflicting entries.\n+     * */\n+    protected void removeLegacyConflictingFeedEntries(Collection<String> currentLocalSubscriptions) {\n+        List<String> removedQueue = this.getQueuedRemovedFeeds();\n+        List<String> addedQueue = this.getQueuedAddedFeeds();\n+        removedQueue.removeAll(currentLocalSubscriptions);\n+        addedQueue.removeAll(removedQueue);\n+        sharedPreferences.edit()\n+                .putString(QUEUED_FEEDS_ADDED, addedQueue.toString())\n+                .putString(QUEUED_FEEDS_REMOVED, removedQueue.toString())\n+                .apply();\n+    }\n+\n     protected void enqueueFeedRemoved(String downloadUrl) {\n         SharedPreferences sharedPreferences = getSharedPreferences();\n         try {\n", "test_patch": "", "problem_statement": "fix urls both added and removed before sending to the sync server\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.5.0\n\n### Android version\n\n-\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. A client added and removed a podcast between syncs to gpodder.net, before #6404 was released (eg last sync was 2023-03-02)\r\n   (The fix is welcome, and it makes sense to correct the subscription lists when modifying them)\r\n2. They tried to sync anytime since then\n\n### Expected behaviour\n\nA complete fix could be to check added and removed lists for intersection, and then choose based on current subscriptions.\n\n### Current behaviour\n\nLooking at gpodder.net logs, a few users post subscription changes containing both added and removed subscription urls.\r\nThey seem to have a very old last successful subscription (eg. 2023-02).\r\nFrom the server there is no way to decide and deciding wrong will have consequences on the client: if we count subscriptions as added when a user added then removed a podcast we will make them re-subscribe to podcasts they removed. If we count as removed, it will purge it from user device.\n\n### Logs\n\nI have only server logs:\r\n\r\nreverse-proxy:\r\n```\r\n[25/Dec/2024:18:08:28 +0000] \"GET /api/2/subscriptions/USER/DEVICE.json?since=1677783179 HTTP/1.1\" 303B 200 50 0.424s \"-\" \"AntennaPod/3.5.0\"\r\n[25/Dec/2024:18:08:29 +0000] \"POST /api/2/subscriptions/USER/DEVICE.json HTTP/1.1\" 1644B 400 196 0.289s \"-\" \"AntennaPod/3.5.0\"\r\n```\r\n\r\nweb application:\r\n```\r\n2024-12-25 18:08:28,183 mygpo.subscriptions INFO Subscription History for USER\r\n2024-12-25 18:08:28,184 mygpo.subscriptions INFO ... client DEVICE\r\n2024-12-25 18:08:28,185 mygpo.subscriptions INFO ... since 2023-03-02 18:52:59\r\n2024-12-25 18:08:28,186 mygpo.subscriptions INFO ... until 2024-12-25 18:08:28.179997\r\n2024-12-25 18:08:28,189 mygpo.api.subscriptions INFO Subscription History: 0\r\n2024-12-25 18:08:28,190 mygpo.api.subscriptions INFO Subscription Diff: +0/-0\r\n2024-12-25 18:08:29,044 mygpo.api.subscriptions INFO Subscription Upload @USER/DEVICE\r\n2024-12-25 18:08:29,055 mygpo.api.subscriptions INFO Subscription Upload @USER/DEVICE: add 14, remove 10\r\n2024-12-25 18:08:29,055 mygpo.api.subscriptions WARNING can not add and remove '['https://anchor.fm/s/PODCAST1/podcast/rss', 'https://anchor.fm/s/PODCAST2/podcast/rss', 'https://cdn.julephosting.de/podcasts/PODCAST3/feed.rss']' at the same time.\r\n```\r\n\r\nI've checked on server: the device id doesn't have any subscription or history, so I'm not sure how it got the 2023-03-02 last sync date.\r\nThe user doesn't have existing subscriptions to PODCAST1, PODCAST2, PODCAST3.\r\n\r\n\n", "hints_text": "Looking at [SyncService.syncSubscriptions()](https://github.com/AntennaPod/AntennaPod/blob/develop/net/sync/service/src/main/java/de/danoeh/antennapod/net/sync/service/SyncService.java#L136) maybe removing from queuedRemovedFeeds any url that is present in both queuedAddedFeeds and localSubscriptions would resolve the issue.\r\n\r\nFurthermore, maybe any url that is still in localSubscriptions should be purged from queuedRemovedFeeds anyway?\nI'm interested in taking a look at this issue. Will start by taking a look at the code and trying to reproduce the issue.\nI am testing this with a local instance of gpodder, and can confirm the problem.\n\n1. Reverted the changes in https://github.com/AntennaPod/AntennaPod/pull/6404 so we can get to the error state where a podcast is in both `queuedAddedFeeds`and `queuedRemovedFeeds`\n2. While gpodder is not connected, add and remove a podcast\n3. Start gpodder and try to sync by swiping down\n\nSyncing now does not work (unless I force a full sync from settings), and I get the `can not add and remove` line @elelay  mentioned in the logs . There is no indication in the AntennaPod UI that syncing has failed. The problem persists after trying to sync multiple times.\n\nI tried @elelay ' s suggested approach, which fixes the problem.\n\n\n```java\n// net/sync/service/src/main/java/de/danoeh/antennapod/net/sync/service/SyncService.java\n\n private void syncSubscriptions(ISyncService syncServiceImpl) throws SyncServiceException {\n        final long lastSync = SynchronizationSettings.getLastSubscriptionSynchronizationTimestamp();\n        EventBus.getDefault().postSticky(new SyncServiceEvent(R.string.sync_status_subscriptions));\n        final List<String> localSubscriptions = DBReader.getFeedListDownloadUrls();\n        SubscriptionChanges subscriptionChanges = syncServiceImpl.getSubscriptionChanges(lastSync);\n        long newTimeStamp = subscriptionChanges.getTimestamp();\n\n        List<String> queuedRemovedFeeds = synchronizationQueueStorage.getQueuedRemovedFeeds();\n        List<String> queuedAddedFeeds = synchronizationQueueStorage.getQueuedAddedFeeds();\n        \n\n        for (String added: queuedAddedFeeds) {\n            if (queuedRemovedFeeds.contains(added)) {\n                // With old versions it is possible that the same feed got inserted in both\n                // queuedRemovedFeeds and queueAddedFeeds and is still present in the\n                // synchronization queue storage.\n                // In this case, remove it from one of the queues based on local subscription\n                // status to make sure the pushed update unambiguously reflects the current\n                // status in the app.\n                Log.d(TAG, \"Feed both added and removed: \" + subscriptionChanges);\n                if (localSubscriptions.contains(added)) {\n                    queuedRemovedFeeds.remove(added);\n                }\n                else {\n                    queuedAddedFeeds.remove(added);\n                }\n            }\n        }\n\n...\n}\n\n```\n", "created_at": "2025-04-21T11:50:32Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7760, "instance_id": "AntennaPod__AntennaPod-7760", "issue_numbers": ["7721"], "base_commit": "74def18a48ba3c6ec197eead91840db6f714fb6d", "patch": "diff --git a/storage/importexport/src/main/java/de/danoeh/antennapod/storage/importexport/DatabaseExporter.java b/storage/importexport/src/main/java/de/danoeh/antennapod/storage/importexport/DatabaseExporter.java\nindex d152ba34ab6..56b792df5b5 100644\n--- a/storage/importexport/src/main/java/de/danoeh/antennapod/storage/importexport/DatabaseExporter.java\n+++ b/storage/importexport/src/main/java/de/danoeh/antennapod/storage/importexport/DatabaseExporter.java\n@@ -16,63 +16,42 @@\n import java.io.FileOutputStream;\n import java.io.IOException;\n import java.io.InputStream;\n-import java.nio.channels.FileChannel;\n \n public class DatabaseExporter {\n     private static final String TAG = \"DatabaseExporter\";\n     private static final String TEMP_DB_NAME = PodDBAdapter.DATABASE_NAME + \"_tmp\";\n \n     public static void exportToDocument(Uri uri, Context context) throws IOException {\n-        ParcelFileDescriptor pfd = null;\n-        FileOutputStream fileOutputStream = null;\n-        try {\n-            pfd = context.getContentResolver().openFileDescriptor(uri, \"wt\");\n-            fileOutputStream = new FileOutputStream(pfd.getFileDescriptor());\n-            exportToStream(fileOutputStream, context);\n+        ParcelFileDescriptor pfd = context.getContentResolver().openFileDescriptor(uri, \"wt\");\n+        int bytesCopied = -1;\n+        int resultingFileSize = 0;\n+        try (FileOutputStream fileOutputStream = new FileOutputStream(pfd.getFileDescriptor())) {\n+            bytesCopied = exportToStream(fileOutputStream, context);\n         } catch (IOException e) {\n             Log.e(TAG, Log.getStackTraceString(e));\n             throw e;\n         } finally {\n-            IOUtils.closeQuietly(fileOutputStream);\n-\n-            if (pfd != null) {\n-                try {\n-                    pfd.close();\n-                } catch (IOException e) {\n-                    Log.d(TAG, \"Unable to close ParcelFileDescriptor\");\n-                }\n-            }\n+            resultingFileSize = (int) pfd.getStatSize();\n+            IOUtils.closeQuietly(pfd);\n+        }\n+        if (resultingFileSize != bytesCopied) {\n+            throw new IOException(String.format(\n+                    \"Unable to write entire database. Expected to write %s, but wrote %s.\",\n+                    Formatter.formatShortFileSize(context, bytesCopied),\n+                    Formatter.formatShortFileSize(context, resultingFileSize)));\n         }\n     }\n \n-    public static void exportToStream(FileOutputStream outFileStream, Context context) throws IOException {\n-        FileChannel src = null;\n-        FileChannel dst = null;\n-        try {\n-            File currentDB = context.getDatabasePath(PodDBAdapter.DATABASE_NAME);\n-\n-            if (currentDB.exists()) {\n-                src = new FileInputStream(currentDB).getChannel();\n-                dst = outFileStream.getChannel();\n-                long srcSize = src.size();\n-                dst.transferFrom(src, 0, srcSize);\n-\n-                long newDstSize = dst.size();\n-                if (newDstSize != srcSize) {\n-                    throw new IOException(String.format(\n-                            \"Unable to write entire database. Expected to write %s, but wrote %s.\",\n-                            Formatter.formatShortFileSize(context, srcSize),\n-                            Formatter.formatShortFileSize(context, newDstSize)));\n-                }\n-            } else {\n-                throw new IOException(\"Can not access current database\");\n-            }\n+    public static int exportToStream(FileOutputStream outFileStream, Context context) throws IOException {\n+        File currentDB = context.getDatabasePath(PodDBAdapter.DATABASE_NAME);\n+        if (!currentDB.exists()) {\n+            throw new IOException(\"Cannot access current database\");\n+        }\n+        try (InputStream src = new FileInputStream(currentDB)) {\n+            return IOUtils.copy(src, outFileStream);\n         } catch (IOException e) {\n             Log.e(TAG, Log.getStackTraceString(e));\n             throw e;\n-        } finally {\n-            IOUtils.closeQuietly(src);\n-            IOUtils.closeQuietly(dst);\n         }\n     }\n \n", "test_patch": "", "problem_statement": "Backup fails if selecting DAVx5 WebDAV target\n### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [x] I will describe the problem with as much detail as possible.\n- [x] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.7.0\n\n### Android version\n\n15 (GrapheneOS)\n\n### Device model\n\nGoogle Pixel 6\n\n### First occurred\n\nAbout 2 days ago\n\n### Steps to reproduce\n\n1. Install DAVx5 from e.g. F-Droid\n2. Obtain a WebDAV service somewhere\n3. Configure DAVx5 to use the WebDAV server\n4. The WebDAV server is now available through Android SAF\n5. In AntennaPod > Settings > Import/Export > Database export > Select WebDAV target through SAF > Hit Safe\n\n### Expected behaviour\n\nSuccessfully create the backup.\n\n### Current behaviour\n\nThrows an error:\n\n> Export error\n>\n> Illegal seek\n\nand saves a backup file with 0 B to the target.\n\n### Logs\n\n```\ntype: logcat\nosVersion: google/oriole/oriole:15/AP4A.250205.002/2025020500:user/release-keys\nflags: dev options enabled\npackage: de.danoeh.antennapod:3070095, targetSdk 35\nbuffers: main,system,crash,events,kernel\nlevel: verbose\n\n[...]\n\n--------- switch to main\n03-26 23:25:14.325 15692 16553 E DatabaseExporter: java.io.IOException: Illegal seek\n03-26 23:25:14.325 15692 16553 E DatabaseExporter: \tat sun.nio.ch.FileDispatcherImpl.pwrite0(Native Method)\n03-26 23:25:14.325 15692 16553 E DatabaseExporter: \tat sun.nio.ch.FileDispatcherImpl.pwrite(FileDispatcherImpl.java:77)\n03-26 23:25:14.325 15692 16553 E DatabaseExporter: \tat sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:89)\n03-26 23:25:14.325 15692 16553 E DatabaseExporter: \tat sun.nio.ch.IOUtil.write(IOUtil.java:51)\n03-26 23:25:14.325 15692 16553 E DatabaseExporter: \tat sun.nio.ch.FileChannelImpl.writeInternal(FileChannelImpl.java:827)\n03-26 23:25:14.325 15692 16553 E DatabaseExporter: \tat sun.nio.ch.FileChannelImpl.write(FileChannelImpl.java:813)\n03-26 23:25:14.325 15692 16553 E DatabaseExporter: \tat sun.nio.ch.FileChannelImpl.transferFromFileChannel(FileChannelImpl.java:685)\n03-26 23:25:14.325 15692 16553 E DatabaseExporter: \tat sun.nio.ch.FileChannelImpl.transferFrom(FileChannelImpl.java:757)\n03-26 23:25:14.325 15692 16553 E DatabaseExporter: \tat de.danoeh.antennapod.storage.importexport.DatabaseExporter.exportToStream(SourceFile:58)\n03-26 23:25:14.325 15692 16553 E DatabaseExporter: \tat de.danoeh.antennapod.storage.importexport.DatabaseExporter.exportToDocument(SourceFile:31)\n03-26 23:25:14.325 15692 16553 E DatabaseExporter: \tat de.danoeh.antennapod.ui.screen.preferences.ImportExportPreferencesFragment.lambda$backupDatabaseResult$17(SourceFile:261)\n03-26 23:25:14.325 15692 16553 E DatabaseExporter: \tat de.danoeh.antennapod.ui.screen.preferences.ImportExportPreferencesFragment.$r8$lambda$_Qqhsx7E-gxuESWZs1dEv6MZ94k(SourceFile:0)\n03-26 23:25:14.325 15692 16553 E DatabaseExporter: \tat de.danoeh.antennapod.ui.screen.preferences.ImportExportPreferencesFragment$$ExternalSyntheticLambda3.run(SourceFile:0)\n03-26 23:25:14.325 15692 16553 E DatabaseExporter: \tat io.reactivex.internal.operators.completable.CompletableFromAction.subscribeActual(SourceFile:34)\n03-26 23:25:14.325 15692 16553 E DatabaseExporter: \tat io.reactivex.Completable.subscribe(SourceFile:2302)\n03-26 23:25:14.325 15692 16553 E DatabaseExporter: \tat io.reactivex.internal.operators.completable.CompletableSubscribeOn$SubscribeOnObserver.run(SourceFile:64)\n03-26 23:25:14.325 15692 16553 E DatabaseExporter: \tat io.reactivex.Scheduler$DisposeTask.run(SourceFile:578)\n03-26 23:25:14.325 15692 16553 E DatabaseExporter: \tat io.reactivex.internal.schedulers.ScheduledRunnable.run(SourceFile:66)\n03-26 23:25:14.325 15692 16553 E DatabaseExporter: \tat io.reactivex.internal.schedulers.ScheduledRunnable.call(SourceFile:57)\n03-26 23:25:14.325 15692 16553 E DatabaseExporter: \tat java.util.concurrent.FutureTask.run(FutureTask.java:264)\n03-26 23:25:14.325 15692 16553 E DatabaseExporter: \tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:347)\n03-26 23:25:14.325 15692 16553 E DatabaseExporter: \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n03-26 23:25:14.325 15692 16553 E DatabaseExporter: \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:644)\n03-26 23:25:14.325 15692 16553 E DatabaseExporter: \tat java.lang.Thread.run(Thread.java:1117)\n```\n\n### Other\n\nI could find other people with different apps and the same \"Illegal seek\" problem here:\n\n- https://github.com/UweTrottmann/SeriesGuide/issues/1089\n- https://github.com/PhilippC/keepass2android/issues/1768\n\nDAVx5 mentions something about the 0 B here:\n\nhttps://manual.davx5.com/webdav_mounts.html\n\nOther apps, including e.g. Aegis work well with this setup.\n", "hints_text": "", "created_at": "2025-04-13T19:47:19Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7733, "instance_id": "AntennaPod__AntennaPod-7733", "issue_numbers": ["6864"], "base_commit": "a01573523c3e971bb60ca4b90eb29af10b006e7e", "patch": "diff --git a/ui/common/src/main/res/drawable/scrollbar_thumb_default.xml b/ui/common/src/main/res/drawable/scrollbar_thumb_default.xml\nindex 5e8a98b44f..306cd7d0a9 100644\n--- a/ui/common/src/main/res/drawable/scrollbar_thumb_default.xml\n+++ b/ui/common/src/main/res/drawable/scrollbar_thumb_default.xml\n@@ -5,10 +5,11 @@\n             <size android:height=\"24dp\" android:width=\"24dp\"/>\n         </shape>\n     </item>\n-    <item android:gravity=\"end\">\n+    <item android:gravity=\"end\" android:right=\"4dp\">\n         <shape android:shape=\"rectangle\">\n             <solid android:color=\"#99666666\"/>\n-            <size android:height=\"4dp\" android:width=\"4dp\"/>\n+            <corners android:radius=\"4dp\"/>\n+            <size android:height=\"4dp\" android:width=\"8dp\"/>\n         </shape>\n     </item>\n </layer-list>\ndiff --git a/ui/common/src/main/res/drawable/scrollbar_thumb_pressed_dark.xml b/ui/common/src/main/res/drawable/scrollbar_thumb_pressed_dark.xml\nindex a1618c5b69..27745404bc 100644\n--- a/ui/common/src/main/res/drawable/scrollbar_thumb_pressed_dark.xml\n+++ b/ui/common/src/main/res/drawable/scrollbar_thumb_pressed_dark.xml\n@@ -5,10 +5,11 @@\n             <size android:height=\"24dp\" android:width=\"24dp\"/>\n         </shape>\n     </item>\n-    <item android:gravity=\"end\">\n+    <item android:gravity=\"end\" android:right=\"4dp\">\n         <shape android:shape=\"rectangle\">\n             <solid android:color=\"@color/accent_dark\"/>\n-            <size android:height=\"4dp\" android:width=\"4dp\"/>\n+            <corners android:radius=\"4dp\"/>\n+            <size android:height=\"4dp\" android:width=\"8dp\"/>\n         </shape>\n     </item>\n </layer-list>\ndiff --git a/ui/common/src/main/res/drawable/scrollbar_thumb_pressed_light.xml b/ui/common/src/main/res/drawable/scrollbar_thumb_pressed_light.xml\nindex be684541a4..e075582b45 100644\n--- a/ui/common/src/main/res/drawable/scrollbar_thumb_pressed_light.xml\n+++ b/ui/common/src/main/res/drawable/scrollbar_thumb_pressed_light.xml\n@@ -5,10 +5,11 @@\n             <size android:height=\"24dp\" android:width=\"24dp\"/>\n         </shape>\n     </item>\n-    <item android:gravity=\"end\">\n+    <item android:gravity=\"end\" android:right=\"4dp\">\n         <shape android:shape=\"rectangle\">\n             <solid android:color=\"@color/accent_light\"/>\n-            <size android:height=\"4dp\" android:width=\"4dp\"/>\n+            <corners android:radius=\"4dp\"/>\n+            <size android:height=\"4dp\" android:width=\"8dp\"/>\n         </shape>\n     </item>\n </layer-list>\ndiff --git a/ui/common/src/main/res/drawable/scrollbar_track.xml b/ui/common/src/main/res/drawable/scrollbar_track.xml\nindex ce838abe94..c8c626eed8 100644\n--- a/ui/common/src/main/res/drawable/scrollbar_track.xml\n+++ b/ui/common/src/main/res/drawable/scrollbar_track.xml\n@@ -1,4 +1,15 @@\n <?xml version=\"1.0\" encoding=\"utf-8\"?>\n-<selector xmlns:android=\"http://schemas.android.com/apk/res/android\">\n-    <item android:drawable=\"@android:color/transparent\"/>\n-</selector>\n+<layer-list xmlns:android=\"http://schemas.android.com/apk/res/android\">\n+    <item>\n+        <shape android:shape=\"rectangle\">\n+            <size android:height=\"24dp\" android:width=\"24dp\"/>\n+        </shape>\n+    </item>\n+    <item android:gravity=\"end\" android:right=\"4dp\" android:top=\"4dp\" android:bottom=\"4dp\">\n+        <shape android:shape=\"rectangle\">\n+            <solid android:color=\"#22666666\"/>\n+            <corners android:radius=\"4dp\"/>\n+            <size android:height=\"4dp\" android:width=\"8dp\"/>\n+        </shape>\n+    </item>\n+</layer-list>\n", "test_patch": "", "problem_statement": "Make scrollbar more visible & handle easier to grab\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.2.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Problem you may be having, or feature you want\n\nGrabbing the scroll bar is a bit hard, especially for long lists.\r\n\r\nAlso, from a [review](https://play.google.com/console/u/0/developers/8008695526664634386/app/4974638472012894302/user-feedback/review-details?reviewId=6d3cf040-c37f-4662-8e93-e197e2171b97&corpus=PUBLIC_REVIEWS) it seems that it's not visible enough:\r\n> Simple and clutter-free interface. Its the best replacement for Google Podcasts. The best feature is it's ability to run in background when you press the \"Close All\" option and just want to keep listening to podcasts. Only way it can get better is if they include a scroll bar to browse through list instead of flipping through the entire list.\n\n### Suggested solution\n\nMake the scroll bar handle slightly wider, potentially make it longer than it actually is.\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "We cannot make it wider. Otherwise one would touch the scroll bar when trying to touch the download button. The touchable area already is very close to the download button (note that the touchable area is larger than the scroll bar). We already had it wider at some point, I think, and reverted because it caused problems. See also https://github.com/AntennaPod/AntennaPod/issues/3400\r\n\r\nWe also cannot make it higher because that is not supported by Google: https://issuetracker.google.com/issues/64729576\nThe width already follows the defaults from Android. Just because one person didn't see it, I don't think we should make it more prominent (and more ugly) for everyone \nI find the scrollbar hard to grab on devices with a curved edge and usually resort to scrolling, would widening it for such devices be considered?\nRelated: #6784", "created_at": "2025-04-02T21:44:39Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7730, "instance_id": "AntennaPod__AntennaPod-7730", "issue_numbers": ["7707"], "base_commit": "5b2648393ab223f0c461c7d96016a8b7afcd6956", "patch": "diff --git a/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterface.java b/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterface.java\nindex a04c24ee45..ecb5f0573e 100644\n--- a/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterface.java\n+++ b/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterface.java\n@@ -56,4 +56,6 @@ public boolean isEpisodeQueued(String url) {\n     public int getProgress(String url) {\n         return isDownloadingEpisode(url) ? currentDownloads.get(url).getProgress() : -1;\n     }\n+\n+    public abstract int getNumberOfActiveDownloads(Context context);\n }\ndiff --git a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/autodownload/AutomaticDownloadAlgorithm.java b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/autodownload/AutomaticDownloadAlgorithm.java\nindex 1371d3a440..bd2360fa7e 100644\n--- a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/autodownload/AutomaticDownloadAlgorithm.java\n+++ b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/autodownload/AutomaticDownloadAlgorithm.java\n@@ -85,6 +85,7 @@ public Runnable autoDownloadUndownloadedItems(final Context context) {\n \n                 int autoDownloadableEpisodes = candidates.size();\n                 int downloadedEpisodes = DBReader.getTotalEpisodeCount(new FeedItemFilter(FeedItemFilter.DOWNLOADED));\n+                downloadedEpisodes += DownloadServiceInterface.get().getNumberOfActiveDownloads(context);\n                 int deletedEpisodes = EpisodeCleanupAlgorithmFactory.build()\n                         .makeRoomForEpisodes(context, autoDownloadableEpisodes);\n                 boolean cacheIsUnlimited =\n@@ -99,7 +100,7 @@ public Runnable autoDownloadUndownloadedItems(final Context context) {\n                 }\n \n                 List<FeedItem> itemsToDownload = candidates.subList(0, episodeSpaceLeft);\n-                if (itemsToDownload.size() > 0) {\n+                if (!itemsToDownload.isEmpty()) {\n                     Log.d(TAG, \"Enqueueing \" + itemsToDownload.size() + \" items for download\");\n \n                     for (FeedItem episode : itemsToDownload) {\ndiff --git a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/DownloadServiceInterfaceImpl.java b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/DownloadServiceInterfaceImpl.java\nindex 9348eaa8de..8581b72811 100644\n--- a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/DownloadServiceInterfaceImpl.java\n+++ b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/DownloadServiceInterfaceImpl.java\n@@ -19,6 +19,7 @@\n import io.reactivex.schedulers.Schedulers;\n \n import java.util.List;\n+import java.util.concurrent.ExecutionException;\n import java.util.concurrent.Future;\n import java.util.concurrent.TimeUnit;\n \n@@ -97,4 +98,23 @@ public void cancel(Context context, FeedMedia media) {\n     public void cancelAll(Context context) {\n         WorkManager.getInstance(context).cancelAllWorkByTag(WORK_TAG);\n     }\n+\n+    @Override\n+    public int getNumberOfActiveDownloads(Context context) {\n+        try {\n+            List<WorkInfo> workInfos = WorkManager.getInstance(context)\n+                    .getWorkInfosByTag(DownloadServiceInterface.WORK_TAG).get();\n+            int count = 0;\n+            for (WorkInfo info : workInfos) {\n+                if (info.getState() == WorkInfo.State.RUNNING\n+                        || info.getState() == WorkInfo.State.ENQUEUED\n+                        || info.getState() == WorkInfo.State.BLOCKED) {\n+                    count++;\n+                }\n+            }\n+            return count;\n+        } catch (ExecutionException | InterruptedException e) {\n+            return 0;\n+        }\n+    }\n }\n", "test_patch": "diff --git a/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterfaceStub.java b/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterfaceStub.java\nindex 70f551a9c8..506d3b2c32 100644\n--- a/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterfaceStub.java\n+++ b/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterfaceStub.java\n@@ -21,4 +21,9 @@ public void cancel(Context context, FeedMedia media) {\n     @Override\n     public void cancelAll(Context context) {\n     }\n+\n+    @Override\n+    public int getNumberOfActiveDownloads(Context context) {\n+        return 0;\n+    }\n }\n", "problem_statement": "Automatic episode download: limit no longer observed\n### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [x] I will describe the problem with as much detail as possible.\n- [x] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.7.0\n\n### Android version\n\n12\n\n### Device model\n\nPixel 3a\n\n### First occurred\n\nDays ago / since 3.7.0\n\n### Steps to reproduce\n\n1. Setup automatic download with 10 episode limit\n2. typically auto download happens after podcast feed refresh, (based on my setup of refreshing twice a day and auto deletion after 12 hours).\n\n### Expected behaviour\n\nDownload (and enqueue) up to 10 episodes.\n\n### Current behaviour\n\nIntermittently (twice since upgraded to 3.7.0 via Google Play less than a week ago), the auto download ended up downloading a lot more episodes (30+ and 20+). I can't tell if there is a pattern.\n\n### Logs\n\n_No response_\n", "hints_text": "My auto-download just queued the *entire* inbox. I now have a queue of over 200 episodes.\n![full-logs.txt](https://github.com/user-attachments/files/19413366/full-logs.txt)\n\n\nI just had to uninstall the app after it has already downloaded 35GB of podcasts. The download queue was still hundreds of podcasts back, with no way to cancel them all (only multi select delete of successfully downloaded episodes is possible). \nI was able to cancel downloads via the downloads menu, you should have been able to do the same.\nAt a guess, I would imagine the regression was caused by the ongoing autodownload rewrite, possibly in #7627. Also related: #7666, #7662\n\n(I see the bug also - inbox is added to the queue, newly added episodes are then downloaded, both without user interaction)", "created_at": "2025-03-31T19:12:31Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7720, "instance_id": "AntennaPod__AntennaPod-7720", "issue_numbers": ["7718"], "base_commit": "4b725e8aea4eda6b7017b1588c2dc0379d5d708e", "patch": "diff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java\nindex b781148308..9daa1c137c 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java\n@@ -352,6 +352,8 @@ static void upgrade(final SQLiteDatabase db, final int oldVersion, final int new\n         if (oldVersion < 3080000) {\n             db.execSQL(\"ALTER TABLE \" + PodDBAdapter.TABLE_NAME_FEED_ITEMS\n                     + \" ADD COLUMN \" + PodDBAdapter.KEY_SOCIAL_INTERACT_URL + \" TEXT\");\n+            db.execSQL(\"DELETE FROM \" + PodDBAdapter.TABLE_NAME_FAVORITES + \" WHERE \" + PodDBAdapter.KEY_FEEDITEM\n+                    + \" NOT IN (SELECT \" + PodDBAdapter.KEY_ID + \" FROM \" + PodDBAdapter.TABLE_NAME_FEED_ITEMS + \")\");\n         }\n     }\n \ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\nindex 84bfe6a7c8..84e62a759e 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n@@ -858,11 +858,7 @@ public void addFavoriteItem(FeedItem item) {\n     }\n \n     public void removeFavoriteItem(FeedItem item) {\n-        String deleteClause = String.format(\"DELETE FROM %s WHERE %s=%s AND %s=%s\",\n-                TABLE_NAME_FAVORITES,\n-                KEY_FEEDITEM, item.getId(),\n-                KEY_FEED, item.getFeedId());\n-        db.execSQL(deleteClause);\n+        db.execSQL(\"DELETE FROM \" + TABLE_NAME_FAVORITES + \" WHERE \" + KEY_FEEDITEM + \"=\" + item.getId());\n     }\n \n     private boolean isItemInFavorites(FeedItem item) {\n@@ -924,6 +920,7 @@ public void removeFeedItems(@NonNull List<FeedItem> items) {\n                             + \" AND \" + KEY_FEEDFILE + \" IN (\" + mediaIds + \")\", null);\n             db.delete(TABLE_NAME_FEED_MEDIA, KEY_ID + \" IN (\" + mediaIds + \")\", null);\n             db.delete(TABLE_NAME_FEED_ITEMS, KEY_ID + \" IN (\" + itemIds + \")\", null);\n+            db.delete(TABLE_NAME_FAVORITES, KEY_FEEDITEM + \" IN (\" + itemIds + \")\", null);\n             db.setTransactionSuccessful();\n         } catch (SQLException e) {\n             Log.e(TAG, Log.getStackTraceString(e));\n", "test_patch": "", "problem_statement": "Cannot Unfavorite Some Episodes\n### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [x] I will describe the problem with as much detail as possible.\n- [x] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.7.0\n\n### Android version\n\n15\n\n### Device model\n\nMoto G Power 5G 2024\n\n### First occurred\n\n2025-03-25\n\n### Steps to reproduce\n\n1. Favorite undownloaded episode\n2. Download it\n3. Unfavorite it\n\n### Expected behaviour\n\nThe episode is unfavorited and its star disappears.\n\n### Current behaviour\n\nUnfavoriting in the queue whether by swipe action or long press menu causes it to appear unfavorited, but leaving the queue and returning shows it is still favorited. Unfavoriting these episodes in their subscription feed causes the favorite star to flicker off for a moment before returning. \nSo far two episodes from different podcasts are stuck in a permanently favorited state. I cannot figure out what causes the episodes to get stuck. Most episodes act normally.\n\n### Logs\n\n_No response_\n", "hints_text": "Huh, that sounds like a weird issue. It does work for me, and you say that it works for most podcasts for you as well. Would it be possible that you send me a database export and tell me which episodes this is about? Then I can try if I can find the root cause. My email address is `info@<my username>.com`.", "created_at": "2025-03-26T22:04:48Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7709, "instance_id": "AntennaPod__AntennaPod-7709", "issue_numbers": ["7246"], "base_commit": "3cfb1d73c73a72d37e29000f1faa5346e7829cba", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/SleepTimerDialog.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/SleepTimerDialog.java\nindex 911460d58b..43c3be6483 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/SleepTimerDialog.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/SleepTimerDialog.java\n@@ -20,6 +20,7 @@\n import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import com.google.android.material.snackbar.Snackbar;\n \n+import de.danoeh.antennapod.playback.base.PlayerStatus;\n import de.danoeh.antennapod.playback.service.PlaybackController;\n import de.danoeh.antennapod.playback.service.PlaybackService;\n import org.greenrobot.eventbus.EventBus;\n@@ -145,7 +146,8 @@ public Dialog onCreateDialog(Bundle savedInstanceState) {\n         });\n         Button setButton = content.findViewById(R.id.setSleeptimerButton);\n         setButton.setOnClickListener(v -> {\n-            if (!PlaybackService.isRunning) {\n+            if (!PlaybackService.isRunning\n+                    || (controller != null && controller.getStatus() != PlayerStatus.PLAYING)) {\n                 Snackbar.make(content, R.string.no_media_playing_label, Snackbar.LENGTH_LONG).show();\n                 return;\n             }\n", "test_patch": "", "problem_statement": "It's possible to start a sleep timer without media actually playing\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.4.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\nAndroid 14\n\n### Device model\n\nbitra\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\nWhen you first want to add a new sleep timer without any media playing there will be a message saying that you cannot add a sleep timer because no media is playing.\r\n\r\nHowever, if you click play, then pause afterwards you can configure sleep timers even though no media is actually playing.\n\n### Expected behaviour\n\nYou shouldn't be able to configure sleep timers if no media is currently playing.\n\n### Current behaviour\n\n_No response_\n\n### Logs\n\n_No response_\n", "hints_text": "I have a pull request (#7247) that addresses this issue plus some other issues as well, and also adds ability to create sleep timers based on episode count.\r\n\r\nI would really prefer for that PR to be accepted at one point and all issues addressed by it to be fixed when it's merged.\r\nIf this issue is resolved separately it will most definitely generate conflicts with my PR which addresses all these issues.\r\n\r\nAs I see that - even though the ability to have sleep timers based on episode count is **highly requested** and multiple PRs have been made to address it - pull requests dealing with sleep timers aren't readily accepted I will probably not invest the time to fix the conflicts that will arise if each of these issues is fixed separately, independently.\r\n\r\nI am using my own version of the app to have the ability to create sleep timers based on episode count (as well as see the remaining time I have before the sleep timer is hit), so I personally have everything I need.", "created_at": "2025-03-23T19:17:26Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7708, "instance_id": "AntennaPod__AntennaPod-7708", "issue_numbers": ["7245"], "base_commit": "3cfb1d73c73a72d37e29000f1faa5346e7829cba", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java\nindex 269de7d6e0..a5e94b8bf6 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java\n@@ -306,7 +306,7 @@ private void updateUi(Playable media) {\n     @Subscribe(threadMode = ThreadMode.MAIN)\n     @SuppressWarnings(\"unused\")\n     public void sleepTimerUpdate(SleepTimerUpdatedEvent event) {\n-        if (event.isCancelled() || event.wasJustEnabled()) {\n+        if (event.isCancelled() || event.wasJustEnabled() || event.isOver()) {\n             AudioPlayerFragment.this.loadMediaInfo(false);\n         }\n     }\n", "test_patch": "", "problem_statement": "Sleep button doesn't reset after sleep limit is reached\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.4.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\nAndroid 14\n\n### Device model\n\nbitra\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\nAfter sleep timer is hit the `zzz` icon at the end remains crossed out, suggesting that a sleep timer is still active, when in fact it is not.\n\n### Expected behaviour\n\nThe sleep icon should reset so it's not crossed out anymore.\n\n### Current behaviour\n\n_No response_\n\n### Logs\n\n_No response_\n", "hints_text": "I have a pull request (#7247) that addresses this issue plus some other issues as well, and also adds ability to create sleep timers based on episode count.\r\n\r\nI would really prefer for that PR to be accepted at one point and all issues addressed by it to be fixed when it's merged.\r\nIf this issue is resolved separately it will most definitely generate conflicts with my PR which addresses all these issues.\r\n\r\nAs I see that - even though the ability to have sleep timers based on episode count is **highly requested** and multiple PRs have been made to address it - pull requests dealing with sleep timers aren't readily accepted I will probably not invest the time to fix the conflicts that will arise if each of these issues is fixed separately, independently.\r\n\r\nI am using my own version of the app to have the ability to create sleep timers based on episode count (as well as see the remaining time I have before the sleep timer is hit), so I personally have everything I need.", "created_at": "2025-03-23T19:07:58Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7671, "instance_id": "AntennaPod__AntennaPod-7671", "issue_numbers": ["2214"], "base_commit": "ba56f5c76eb4078ec37d6307904d6f4a6aee4ecb", "patch": "diff --git a/net/common/src/main/java/de/danoeh/antennapod/net/common/RedirectChecker.java b/net/common/src/main/java/de/danoeh/antennapod/net/common/RedirectChecker.java\nnew file mode 100644\nindex 0000000000..6c5da8628d\n--- /dev/null\n+++ b/net/common/src/main/java/de/danoeh/antennapod/net/common/RedirectChecker.java\n@@ -0,0 +1,53 @@\n+package de.danoeh.antennapod.net.common;\n+\n+import android.util.Log;\n+import androidx.annotation.Nullable;\n+import okhttp3.Request;\n+import okhttp3.Response;\n+import okhttp3.internal.http.StatusLine;\n+\n+import java.io.IOException;\n+import java.net.HttpURLConnection;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+\n+public abstract class RedirectChecker {\n+    private static final String TAG = \"RedirectChecker\";\n+\n+    @Nullable\n+    public static String getNewUrlIfPermanentRedirect(Response response) {\n+        // detect 301 Moved permanently and 308 Permanent Redirect\n+        ArrayList<Response> responses = new ArrayList<>();\n+        while (response != null) {\n+            responses.add(response);\n+            response = response.priorResponse();\n+        }\n+        if (responses.size() < 2) {\n+            return null;\n+        }\n+        Collections.reverse(responses);\n+        int firstCode = responses.get(0).code();\n+        String firstUrl = responses.get(0).request().url().toString();\n+        String secondUrl = responses.get(1).request().url().toString();\n+        if (firstCode == HttpURLConnection.HTTP_MOVED_PERM || firstCode == StatusLine.HTTP_PERM_REDIRECT) {\n+            Log.d(TAG, \"Detected permanent redirect from \" + firstUrl + \" to \" + secondUrl);\n+            return secondUrl;\n+        } else if (secondUrl.equals(firstUrl.replace(\"http://\", \"https://\"))) {\n+            Log.d(TAG, \"Treating http->https non-permanent redirect as permanent: \" + firstUrl);\n+            return secondUrl;\n+        }\n+        return null;\n+    }\n+\n+    @Nullable\n+    public static String getNewUrlIfPermanentRedirect(String downloadUrl) {\n+        try {\n+            Request httpReq = new Request.Builder().url(downloadUrl).head().build();\n+            Response response = AntennapodHttpClient.getHttpClient().newCall(httpReq).execute();\n+            return RedirectChecker.getNewUrlIfPermanentRedirect(response);\n+        } catch (IOException e) {\n+            e.printStackTrace();\n+        }\n+        return null;\n+    }\n+}\ndiff --git a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/remote/HttpDownloader.java b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/remote/HttpDownloader.java\nindex 2e983d88e5..d741854a30 100644\n--- a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/remote/HttpDownloader.java\n+++ b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/remote/HttpDownloader.java\n@@ -9,10 +9,10 @@\n import de.danoeh.antennapod.model.download.DownloadResult;\n import de.danoeh.antennapod.model.download.DownloadRequest;\n import de.danoeh.antennapod.net.common.AntennapodHttpClient;\n+import de.danoeh.antennapod.net.common.RedirectChecker;\n import de.danoeh.antennapod.net.download.service.R;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import okhttp3.CacheControl;\n-import okhttp3.internal.http.StatusLine;\n import org.apache.commons.io.IOUtils;\n \n import java.io.BufferedInputStream;\n@@ -24,7 +24,6 @@\n import java.net.SocketTimeoutException;\n import java.net.URI;\n import java.net.UnknownHostException;\n-import java.util.ArrayList;\n import java.util.Collections;\n import java.util.Date;\n import java.util.Locale;\n@@ -116,7 +115,10 @@ && isContentTypeTextAndSmallerThan100kb(response)) {\n                 onFail(DownloadError.ERROR_FILE_TYPE, null);\n                 return;\n             }\n-            checkIfRedirect(response);\n+            String redirect = RedirectChecker.getNewUrlIfPermanentRedirect(response);\n+            if (redirect != null) {\n+                permanentRedirectUrl = redirect;\n+            }\n \n             connection = new BufferedInputStream(responseBody.byteStream());\n \n@@ -275,29 +277,6 @@ private void callOnFailByResponseCode(Response response) {\n         onFail(error, details);\n     }\n \n-    private void checkIfRedirect(Response response) {\n-        // detect 301 Moved permanently and 308 Permanent Redirect\n-        ArrayList<Response> responses = new ArrayList<>();\n-        while (response != null) {\n-            responses.add(response);\n-            response = response.priorResponse();\n-        }\n-        if (responses.size() < 2) {\n-            return;\n-        }\n-        Collections.reverse(responses);\n-        int firstCode = responses.get(0).code();\n-        String firstUrl = responses.get(0).request().url().toString();\n-        String secondUrl = responses.get(1).request().url().toString();\n-        if (firstCode == HttpURLConnection.HTTP_MOVED_PERM || firstCode == StatusLine.HTTP_PERM_REDIRECT) {\n-            Log.d(TAG, \"Detected permanent redirect from \" + request.getSource() + \" to \" + secondUrl);\n-            permanentRedirectUrl = secondUrl;\n-        } else if (secondUrl.equals(firstUrl.replace(\"http://\", \"https://\"))) {\n-            Log.d(TAG, \"Treating http->https non-permanent redirect as permanent: \" + firstUrl);\n-            permanentRedirectUrl = secondUrl;\n-        }\n-    }\n-\n     private static long getFreeSpaceAvailable() {\n         File dataFolder = UserPreferences.getDataFolder(null);\n         if (dataFolder != null) {\ndiff --git a/net/sync/service/src/main/java/de/danoeh/antennapod/net/sync/service/SyncService.java b/net/sync/service/src/main/java/de/danoeh/antennapod/net/sync/service/SyncService.java\nindex a1892ec38b..2da3aa6c1e 100644\n--- a/net/sync/service/src/main/java/de/danoeh/antennapod/net/sync/service/SyncService.java\n+++ b/net/sync/service/src/main/java/de/danoeh/antennapod/net/sync/service/SyncService.java\n@@ -24,6 +24,7 @@\n import de.danoeh.antennapod.model.feed.FeedMedia;\n import de.danoeh.antennapod.model.feed.SortOrder;\n import de.danoeh.antennapod.net.common.AntennapodHttpClient;\n+import de.danoeh.antennapod.net.common.RedirectChecker;\n import de.danoeh.antennapod.net.common.UrlChecker;\n import de.danoeh.antennapod.net.download.serviceinterface.FeedUpdateManager;\n import de.danoeh.antennapod.net.sync.gpoddernet.GpodnetService;\n@@ -156,12 +157,20 @@ private void syncSubscriptions(ISyncService syncServiceImpl) throws SyncServiceE\n             if (!downloadUrl.startsWith(\"http\")) { // Also matches https\n                 Log.d(TAG, \"Skipping url: \" + downloadUrl);\n                 continue;\n+            } else if (UrlChecker.containsUrl(localSubscriptions, downloadUrl)\n+                    || queuedRemovedFeeds.contains(downloadUrl)) {\n+                continue;\n             }\n-            if (!UrlChecker.containsUrl(localSubscriptions, downloadUrl) && !queuedRemovedFeeds.contains(downloadUrl)) {\n-                Feed feed = new Feed(downloadUrl, null, \"Unknown podcast\");\n-                feed.setItems(Collections.emptyList());\n-                FeedDatabaseWriter.updateFeed(getApplicationContext(), feed, false);\n+            String redirectedUrl = RedirectChecker.getNewUrlIfPermanentRedirect(downloadUrl);\n+            if (redirectedUrl != null\n+                    && (UrlChecker.containsUrl(localSubscriptions, redirectedUrl)\n+                        || queuedRemovedFeeds.contains(redirectedUrl))) {\n+                continue;\n             }\n+\n+            Feed feed = new Feed(downloadUrl, null, \"Unknown podcast\");\n+            feed.setItems(Collections.emptyList());\n+            FeedDatabaseWriter.updateFeed(getApplicationContext(), feed, false);\n         }\n \n         // remove subscription if not just subscribed (again)\n", "test_patch": "", "problem_statement": "gpodder full sync duplicates podcast subscriptions\n\r\n**Expected behaviour**: gpodder full sync syncs the local subscriptions with the ones on gpodder.net\r\n\r\n**Current behaviour**: full sync results in duplicated subscriptions for some but not all podcasts (in my case, 29 out my ~100 podcasts). Another full sync results in duplicated subscriptions (all 29 but one) having three entries.\r\n\r\n----\r\n**App version**: 1.6.2.2 (from F-Store)\r\n\r\n**Android version**: 5.1.1\r\n\r\n**Device model**: Samsung Galaxy S5 mini (SM-G800F)\n", "hints_text": "Is it possible those subscriptions have different URLs? e.g. the device subscription was for MP3, but gpodder for MP4/OGG?\r\nOr the subscription moved and gpodder still had the old url?\r\n\r\nWe use the the url to detect podcasts, so if that is not the same, we add it as a new podcast.\n@mfietz Interesting. I checked four of these triplicated subscriptions and looks like the URL was indeed moved (eg http://feeds.thisamericanlife.org/talpodcast became http://feed.thisamericanlife.org/talpodcast). I only ever subscribe using gpodder, so I guess they updated their records of these podcasts since I subscribed.\r\n\r\nThe third subscription is the same as the second one though \u2212 not sure where that would come from?\r\n\r\nUsing the URL to detect podcasts makes sense to me too, so I\u2019m not sure what AntennaPod should do better in this situation ; but the result is quite unexpected.\r\n(Any advice on the best course of action? Clearing all local subscriptions and re-syncing? I\u2019m a bit wary of losing episode state...)\nI got this and the number of podcasts kept proliferating each time I synced ; I was only doing manual. Had to wipe data and disable gpodder\nMaybe add an option to antennapod to just remove all podcasts before the new sync is a (temporary) solution? I now have some podcasts that are listed 6 times....\nI am currently experimenting with only syncing a single device to gpodder at a time in hopes it works around this bug. This way gpodder can only be used for backing up - better than nothing. A few days out and no duplicated items, will report any changes.\nI created a new gpodder account, and synced podcasts from my tablet to it, no problem.\r\n\r\nI installed AntennaPod on my phone, and set up gpodder, and then told gpodder to sync my phone with what was installed on the tablet.\r\n\r\nNow both devices are getting duplicate podcasts. Some of which have different URLs, but many of which have identical URLs. When you delete one from AntennaPod of them both are removed.\r\n\r\nOne the podcast that I tested this on I re-subscribed to the podcast via the gpodder web UI, (assigned it to the tablet) and so far I only have one copy on the tablet.\r\n\r\nHowever for some other podcasts I'm now up to three copies on the tablet. These do not appear to be related to #2267 as they have no special characters in the URL. (Several have a \"?\", but otherwise it's http://site.com/feed)\r\n\r\nIf there is anything I can try to help gather information about this issue please let me know! (I'd very much like to get this working in a stable fashion, multi-device sync is a feature I'm very interested in!)\nadding my confirmation, the 301 redirects seem to be part of the problem. i found this same quirky behavior after all the night vale feeds updated around 06-22.\r\n\r\nmaybe have antennapod check feed urls for at least 301 redirect before doing the full sync request, so it will be ready to match up with gpodder.\r\n\r\n**_tl;dr for fuzzily remembered details below:_** full sync with gpodder just seems like a problematic thing to use, as it can break multiple things, but kinda better than nothing sometimes, maybe add caution tape.\r\n\r\ni had been getting sync errors rather often with some streaming shows as i travel around, maybe due to spotty internet connections. being bored and curious, i think i decided to try full sync, and then the duplication and more issues started.\r\n\r\ni ended up with odd duplicates of all those shows with redirects, with no episodes marked complete in the new entries at first. i noticed the new entries had different feeds from original libsyn, so i just deleted and tried again, same duplication.\r\n\r\nafter i did a global feed refresh i noticed the original entries with episode history updated feeds from libsyn to new address and after removing the other duplicate feeds without history, a full sync no longer created duplicates.\r\n\r\nalso the full sync left a lot of previously streamed episodes marked as done but with progress bar rounding error showing not quite finished, apparently, separate issue, fixed with manual sqlite cleanup. so maybe put a warning to use full sync with caution, or examples of when it actually should be used.\nIs there any news on this? \r\n\r\nSo far I have been removing all my podcast subscriptions in Antennapod every few months before cleaning out my gpodder subscriptions manually on the gpodder website. \r\nIt works, but is very cumbersome especially since Gpodder doesn't recognize all subscriptions (\"Unknown podcast from...\").\r\n\r\nKind regards,\r\n\r\nNigel \nI'll add that it seems to duplicate shows from https://site.com/rss to http://site.com/rss. AntennaPod should probably ignore the scheme (and the query?) from the URI when evaluating whether a show is a duplicate.\nThank you for reoopening, @ByteHamster. :pray: \r\n\r\n> To deal with the problem, I currently have two ideas (which I both do not like):\r\n> \r\n> * When detecting a redirect, not only update the URL in the database but also delete the old URL on gpodder and add the new one. This deletes all state of that feed on Gpodder.\r\n\r\nPersonally I'm against this variant because it's not AntennaPods \"fault\" that gpodder has exactly the same bug. Also AntennaPod shouldn't be _destructive_ for external services.\r\n\r\n> * When synchronizing with Gpodder (step 1), do a network request to all servers and see if they have a redirect. This means that AntennaPod would basically do a full refresh (but without actually refreshing the items) every time it syncs with Gpodder.\r\n\r\nWhen [I did those exports](https://github.com/AntennaPod/AntennaPod/issues/1642#issuecomment-603750887) all of the exported feeds had only the \"new\" URL, right? Is the new URL also persisted on one point in time or is AntennaPod _during the export_ checking for it as well?\r\nBecause it should be possible to \"merge\" feeds if the new URL is persisted earlier, right? Or am I thinking into a wrong direction here?\n> gpodder has exactly the same bug.\r\n\r\nActually, https://github.com/gpodder/mygpo/issues/45 is a different thing. It is about feeds in the general, public feed database.\r\n\r\n> Is the new URL also persisted on one point in time or is AntennaPod during the export checking for it as well?\r\n\r\nThe url is persisted when refreshing the subscriptions. This is independent from the gpodder synchronization. Different service, different time.\r\n\r\n> Because it should be possible to \"merge\" feeds if the new URL is persisted earlier, right?\r\n\r\nThis means AntennaPod would create a new feed and then delete it later when refreshing. Users could see the duplicates until the refresh service is executed. Additionally, the refresh service, at this point, can not be 100% sure which one of the feeds contains the actual data.\r\n\r\n---\r\n\r\nBy the way, this should only happen if you do a full sync. The normal (delta) sync should not create duplicates because it only downloads the newly added feeds.\n> The url is persisted when refreshing the subscriptions. This is independent from the gpodder synchronization. Different service, different time.\r\n\r\nSo in that case\r\n\r\n> > Because it should be possible to \"merge\" feeds if the new URL is persisted earlier, right?\r\n> \r\n> This means AntennaPod would create a new feed and then delete it later when refreshing.\r\n\r\nAt which point in time?\r\n\r\n> Users could see the duplicates until the refresh service is executed.\r\n\r\nI guess the scenarios are a bit complicated:\r\n\r\n1. AntennaPod has an outdated URL & gpodder sends just the new one\r\n2. AntennaPod has a new URL & gpodder sends just the old one\r\n3. AntennaPod has an outdated URL & gpodder sends both\r\n4. AntennaPod has a new URL & gpodder sends both\r\n5. AntennaPod has both (doesn't matter what gpodder sends here)\r\n\r\nIMHO the only _relevant_ date is the _new_ URL, though.\r\nIf all _known_ Podcasts will be checked for Redirects before a sync and if AntennaPod checks _new_ URLs (from gpodder or elsewhere) for redirects _when adding_ \"new\" subscriptions, the gpodder bug is not too relevant anymore. This would leave us _just_ with two cases left:\r\n\r\n1. Everything is fine because we never have an outdated URL for newly added or synced feeds anymore :tada: \r\n2. AntennaPod still has an old and a new URL persisted and has to merge them :disappointed: \r\n\r\nHaving to merge an old and a new feed seems like a final boss level to me though. Because episode information (what's seen and what's not) is probably exclusive in one feed.\r\n\r\nI also believe that it would make sense persist redirect rules on full syncs and make a lookup on delta syncs.\r\n\r\nThis bug sounds _very_ complicated to me. I'm very sorry that I brought it up again. :disappointed: \n> At which point in time?\r\n\r\nWhen refreshing the feeds. This might be some minutes later.\r\n\r\n> AntennaPod has a new URL & gpodder sends just the old one\r\n\r\nThis is the case that causes trouble. The other cases just occur because that one happens first. Gpodder does not update its urls automatically. They keep the old url.\r\n\r\n> I also believe that it would make sense persist redirect rules on full syncs and make a lookup on delta syncs.\r\n\r\nThis issue does not apply to delta syncs. Gpodder does not send us the url again, even if we update  to the new url on our end.\r\n\r\n---\r\n\r\nI just noticed another issue: If we upload the episode status, we push it to the new URL (because that's what's in the database). For gpodder, the new url is a completely different podcast, which means that all playback events are only sent to the new feed. That renders the old feed unused. Would kind of make sense to delete the old feed on gpodder and add the new one.\nHi, I have reinstalled app to get `2.0.0-alpha1`, so I had to connect to gpodder again (as an existing device). \r\n\r\nSome of my podcasts got duplicated. \r\n\r\nWhat I can see (plus some more): \r\nhttps://gpodder.net/podcast/6-minute-english/\r\nhttps://gpodder.net/podcast/6-minute-english-4 \r\n\r\nhttps://gpodder.net/podcast/dark-tome\r\nhttps://gpodder.net/podcast/dark-tome-1\r\n\r\nThey look a bit different on Gpodder but same in AtennaPod. \r\nThe first ones are usually me subscribing in 2019 (from gPodder history) and the second ones are from yesterday when I installed AntennaPod again and added it as an existing device. \nI have up on gpodder sync on my phone, when it created dup's. Was not worth it for me anymore\n~~[Here's a corresponding bountysource issue](https://www.bountysource.com/issues/40116991-gpodder-full-sync-duplicates-podcast-subscriptions) in case someone wants to sponsor at least a coffee or so for solving this.~~\r\n\r\nOkay, I try to get my money back from BountySource then [since this isn't wanted](https://github.com/AntennaPod/AntennaPod/issues/2214#issuecomment-674701025).\n~~I'm very sorry but I wasn't aware that BountySource became evil (i.e. [stealing unclaimed money](https://blog.elementary.io/goodbye-bountysource-hello-github-sponsors/) and [10% for each charge](https://www.bountysource.com/fees)).\r\nIs there anything better & AntennaPod compatible way of sponsoring this bugfix?\r\nOr any other advice?~~\r\n\r\nOkay, I try to get my money back from BountySource then [since this isn't wanted](https://github.com/AntennaPod/AntennaPod/issues/2214#issuecomment-674701025).\nActually, given that there's not issue over at Gpodder's repository yet, and that there's a new maintainer, wouldn't it make sense to create one over there? One could make the (semantic) argument that Gpodder isn't storing the latest url, and that this should be corrected.\nThis is not really a bug in Gpodder. The problem is that we handle URL redirects differently to Gpodder. They keep the old URL and follow the redirect every time they refresh the feed. This ensures consistency when synchronizing (where the feed is identified by the URL). We follow the redirect one single time and update the URL in the database. This has the advantage of not requiring an additional request each time we update the feeds.\r\n\r\nWhile our method might be a bit more stable when the old server is turned off at some point, theirs also has advantages. I do not think that either one of us should significantly change their data model just because the two projects do not directly fit in this case. We need another approach.\n> While our method might be a bit more stable when the old server is turned off at some point, theirs also has advantages. I do not think that either one of us should significantly change their data model just because the two projects do not directly fit in this case. We need another approach.\r\n\r\nIf you described Gpodder correctly, that means it's guaranteed to break and its model should be changed to use a unique identifier instead.\nI'm sorry, I have the feeling that we discussed this earlier already but what again was the disadvantage of checking the HTTP header for redirect states (i.e. `3XX`) on Gpodder syncs except that it will take a bit longer?\r\n\r\n~~**PS:** and is there any way I could buy you a coffee or so? I have the feeling that I should take away the money from BountySource because of their recent policies.~~\r\n\r\n**EDIT:** Okay, then I try to get my money back from BountySource since [it isn't wanted](https://github.com/AntennaPod/AntennaPod/issues/2214#issuecomment-674701025)\n> While our method might be a bit more stable when the old server is turned off at some point, theirs also has advantages.\r\n\r\nI would agree with @Frenzie there. If their implementation is slower and indeed will break if the old server goes off-line, it sounds like there's room for improvement :)\r\n\r\n>I do not think that either one of us should significantly change their data model just because the two projects do not directly fit in this case. We need another approach.\r\n\r\nI don't see an issue in at least bringing up a proposal - whether they want to change is fully their decision of course, and if they don't it'll hopefully lead to a common ground both projects agree on. With my very limited understanding of the technical side, I would say that in any case it wouldn't really be a change of the data model (database architecture) as such - just the url that they store would change.\r\nPlus, I think close collaboration & integration with gpodder.net is important as it has the potential to be a great (server-client) combination that is privacy-friendly and open source.\r\n\r\n> I'm sorry, I have the feeling that we discussed this earlier already but what again was the disadvantage of checking the HTTP header for redirect states (i.e. 3XX) on Gpodder syncs except that it will take a bit longer?\r\n\r\nNot sure what you were thinking of, but some related issues: #1393 #3733 #2232 \r\n\r\n> PS: and is there any way I could buy you a coffee or so? I have the feeling that I should take away the money from BountySource because of their recent policies.\r\n\r\nCurrent maintainer doesn't want donations, see #2935. But thanks for considering :)\n> If you described Gpodder correctly, that means it's guaranteed to break and its model should be changed to use a unique identifier instead.\r\n\r\nInternally, they use a unique identifier - but one for each URL, independently of the redirects. The synchronization API is only based on URLs: [docs](https://gpoddernet.readthedocs.io/en/latest/api/reference/subscriptions.html#upload-subscription-changes)\r\n\r\n> was the disadvantage of checking the HTTP header for redirect states (i.e. 3XX) on Gpodder syncs except that it will take a bit longer?\r\n\r\nIt will break synchronization of episode state. Gpodder always identifies podcasts by their original URL, AntennaPod by the new URL. \r\n\r\n> If their implementation is slower and indeed will break if the old server goes off-line, it sounds like there's room for improvement :)\r\n\r\nI do not think they handle duplicates of the same feed very well. If you look at [an API call for the search term `methodisch inkorrekt`](https://gpodder.net/search.json?q=methodisch+inkorrekt), you get many duplicates with different spelling of the same url (listed below). The problem is known to them (https://github.com/gpodder/mygpo/issues/45 https://github.com/gpodder/mygpo/issues/63 https://github.com/gpodder/mygpo/issues/77 https://github.com/gpodder/mygpo/pull/60) and apparently not easy to fix. Also, it does not look like the project is really active, currently. If someone has the time to help fix their database scheme, please do. I am busy with AntennaPod, so I can not do it.\r\n\r\n```\r\nDuplicates:\r\nhttp://minkorrekt.de/feed/m4a/\r\nhttp://minkorrekt.de/feed/m4a\r\nhttp://minkorrekt.de/feed/\r\nhttp://minkorrekt.de/feed/mp3/\r\nhttp://minkorrekt.de/feed/opus/\r\nhttp://minkorrekt.de/feed/ogg/\r\nhttp://minkorrekt.de/feed/mp3\r\nhttp://minkorrekt.de/feed\r\nhttps://minkorrekt.de/feed/m4a/\r\nhttp://feeds.feedburner.com/Methodischinkorrekt\r\nhttp://feeds.feedburner.com/methodischinkorrekt\r\n\r\nBroken results:\r\nhttp://bitlove.org/methodischinkorrekt/minkorrekt/feed\r\nhttp://methodischinkorrekt.wordpress.com/feed/\r\nhttp://241568.website.snafu.de/wordpress/?cat=4&feed=rss2\r\nhttp://241568.website.snafu.de/wordpress/?feed=rss2\r\n```\n> It will break synchronization of episode state. Gpodder always identifies podcasts by their original URL, AntennaPod by the new URL.\r\n\r\nBut if AntennaPod _knows_ that \"original URLs\" are leading to \"new URLs\" it should be able to map the synchronisation state accordingly anyway, right? :thinking: \nThis issue has also occurred to my device after performing (unknowingly) a full sync. A workaround to avoid it in the future would be appreciated. Removing duplicates causes issues with removal of all episodes from \"both\" subscriptions and requires a new subscription and redownloading the appropriate episodes every time, which is not ideal. \nDo we have data around how many users use gpodder and AntennaPod?  I am just trying to weigh how much effort  I personally want to invest into looking at this since I don't use it.\n\nI used gpodder once and I also saw the duplicate issue and it caused a lot of pain to fix for 111 subscription\nSame here. The first time I (unknowingly) made the mistake of a full sync which caused duplication. A couple days ago a regular sync (strangely) also presented the issue. It is fairly annoying removing duplicates as it also removes the original subscription loosing any data on played/downloaded/queued episodes.\n> Do we have data around how many users use gpodder and AntennaPod?\r\n\r\nAntennaPod does not collect any analytics. I have no idea how many people use it.\r\n\r\n> I am just trying to weigh how much effort I personally want to invest into looking at this since I don't use it.\r\n\r\nI am not sure if we can cleanly fix this on our end. Gpodder still uses the old URLs, so redirects are a completely different subscriptions for them (meaning that the played state of episodes is also tied to the old URL).\nI've also had a full sync readd some deleted subscriptions.\r\n\r\nAnd once, deleting a duplicate also deleted the original, but it usually doesn't.\r\n\r\n> I am not sure if we can cleanly fix this on our end.\r\n\r\nBest idea I can come up is for AntennaPod to keep track of both the original URL and the new URL for each feed, using the former when syncing to gPodder, and the latter when fetching the feed.\n> Removing duplicates causes issues with removal of all episodes from \"both\" subscriptions and requires a new subscription and redownloading the appropriate episodes every time, which is not ideal.\r\n\r\nYeah, this turns an otherwise mildly annoying bug into a really bad experience. \ud83d\ude25\nIs it time for AntennaPod sync service?  :)\nA bit of a late reply @hovancik \nAn AntennaPod sync service would be cool, and has been discussed briefly, but is only feasible if there's a (small) group of people we can find available with the expertise and drive to (help) develop and maintain it :)\n> Is it time for AntennaPod sync service? :)\r\n\r\nYes, please! I don't know how to build it though...\nI don\u2019t think the problem are duplicates. Sometimes gpodder.net just doesn't unsubscribe at all (I have two such podcasts) https://github.com/gpodder/mygpo/issues/520\n> I don\u2019t think the problem are duplicates. Sometimes gpodder.net just doesn't unsubscribe at all (I have two such podcasts) [gpodder/mygpo#520](https://github.com/gpodder/mygpo/issues/520)\r\n\r\nI agree that you've a different issue than the people of this issue. :+1: \r\nBut the cause could basically be the same: since AntennaPod isn't keeping track of former/redirected URLs (so it doesn't remember more than exactly one URL for a single podcast and its episodes) it will most likely only unsubscribe you from the only URL it is storing.\r\n\r\nSee [ByteHamster's description](https://github.com/AntennaPod/AntennaPod/issues/2214#issuecomment-678632031) above:\r\n\r\n> Internally, they use a unique identifier - but _one_ for each URL, independently of the redirects.\n> > I don\u2019t think the problem are duplicates. Sometimes gpodder.net just doesn't unsubscribe at all (I have two such podcasts) [gpodder/mygpo#520](https://github.com/gpodder/mygpo/issues/520)\r\n\r\nThe point of gpodder/mygpo#520 is that I cannot remove some podcasts from the gpodder.net account even using the web interface.\n> The point of [gpodder/mygpo#520](https://github.com/gpodder/mygpo/issues/520) is that I cannot remove some podcasts from the gpodder.net account even using the web interface.\r\n\r\nI see, in that case you simply have a totally different issue. :man_shrugging: \nSubscriptions still duplicate in 2.2.1:\n\nhttps://twitter.com/pschwede/status/1415618002419163137?s=19\n\nAlso, unsubscribing them takes ages and sometimes the app crashes.\n@pschwede Do you use gpodder? Subscriptions should only duplicate if you manually press the \"full sync\" button, which is usually not needed. Do they duplicate without pressing the button?\n> @pschwede Do you use gpodder? Subscriptions should only duplicate if you manually press the \"full sync\" button, which is usually not needed. Do they duplicate without pressing the button?\n\nSo it probably is a new issue?\nIf you do not use gpodder or you do not use the \"full sync\" button, it is a different issue.\nMy task #6709 was closed as a duplicate of this one: Every sync (NOT only if I manually press the \"full sync\" button) resulted in a new duplicated version of the Nature podcast. If I deleted all copies (which I regularly had to do) from all devices the Nature podcast still came back from the dead on the next sync. There was one other podcast affected, but at least it did not come back after deletion. \nI created #7225\r\n\r\nI encountered this error. But I never used full sync, and I get the problem even when the sync is not successful! \nIn addition I removed all podcasts that caused that problem completely from within Antennapod, but one (Breitband) keeps returning and with several dousends of copies each day. \nWhat is the best way of getting rid of duplicated subscriptions? \nIs there an automated way to do it? \nDoes anyone know a script or is there nowadays even an integrated solution in AntennaPod?\nAnd how do you usually identify the \"newest\"/\"correct\" subscription?\n\nIt looks like one third of my subscriptions are duplicated again.\n\n\n![Screenshot_20240909-161439.png](https://github.com/user-attachments/assets/138c8678-2273-4907-b69a-79b20af33ac3)\n\n\n> and how do you usually identify the \"newest\"/\"correct\" subscription?\r\n\r\nAll of them are new. The one that is old is the one on the Gpodder server. That's the problem. The only way I currently know how to fix this is to disconnect from the sync server, delete all content on the sync server, and connect again. However, that is quite risky: If the sync server remembers these deletions, they might propagate to the app.\r\n\r\nTo have proper sync, we need to wait for the OpenPodcastAPI specification to be complete and implemented. That specification includes support for feed redirects.\r\n\r\nTo find out which duplicate you probably want to keep, you could sort the subscriptions by the number of episodes played. The one with played episodes is probably the one you want to keep.\n\n> The only way I currently know how to fix this is to disconnect from the sync server, delete all content on the sync server, and connect again. However, that is quite risky: If the sync server remembers these deletions, they might propagate to the app.\n\nI'm not syncing with gPodder anymore but I want to clean the current state efficiently.\n\n> To find out which duplicate you probably want to keep, you could sort the subscriptions by the number of episodes played. The one with played episodes is probably the one you want to keep.\n\nI just did it like that. \nI wasn't aware the subscription view has a multi select. That helped a lot!\n> Some of them I haven't listened to yet. \r\n\r\nIf you haven't listened to any episode, it does not matter which duplicate you delete", "created_at": "2025-02-21T22:32:24Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7666, "instance_id": "AntennaPod__AntennaPod-7666", "issue_numbers": ["7655"], "base_commit": "da53b8b9d4da5df6fed877a9ca3914c0cead6411", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/FeedMultiSelectActionHandler.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/FeedMultiSelectActionHandler.java\nindex d441423b26..3cbde2d3e7 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/FeedMultiSelectActionHandler.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/FeedMultiSelectActionHandler.java\n@@ -63,14 +63,18 @@ private void notifyNewEpisodesPrefHandler() {\n     }\n \n     private void autoDownloadPrefHandler() {\n-        PreferenceSwitchDialog preferenceSwitchDialog = new PreferenceSwitchDialog(activity,\n-                activity.getString(R.string.auto_download_settings_label),\n+        PreferenceListDialog preferenceListDialog = new PreferenceListDialog(activity,\n                 activity.getString(R.string.auto_download_label));\n-        preferenceSwitchDialog.setOnPreferenceChangedListener(enabled ->\n-                saveFeedPreferences(feedPreferences ->\n-                        feedPreferences.setAutoDownload(FeedPreferences.AutoDownloadSetting.fromBoolean(enabled))\n-                ));\n-        preferenceSwitchDialog.openDialog();\n+        String[] items = activity.getResources().getStringArray(R.array.spnEnableAutoDownloadItems);\n+        preferenceListDialog.openDialog(items);\n+        preferenceListDialog.setOnPreferenceChangedListener(which -> {\n+            FeedPreferences.AutoDownloadSetting autoDownloadSetting = switch (which) {\n+                case 1 -> FeedPreferences.AutoDownloadSetting.ENABLED;\n+                case 2 -> FeedPreferences.AutoDownloadSetting.DISABLED;\n+                default -> FeedPreferences.AutoDownloadSetting.GLOBAL;\n+            };\n+            saveFeedPreferences(feedPreferences -> feedPreferences.setAutoDownload(autoDownloadSetting));\n+        });\n     }\n \n     private void playbackSpeedPrefHandler() {\n", "test_patch": "", "problem_statement": "Multi select and changing automatic download setting\n### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [x] I will describe the problem with as much detail as possible.\n- [x] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.7.0-beta2\n\n### Feature or improvement you want\n\nAutomatic download has been changed and now it's no longer an on/off toggle. Additionally it can be set to use default setting.\nWhen managing settings for multiple subscriptions at once it's not possible to set it to default.\n\n### Why should this be added?\n\nSo it's possible to change to default behavior for multiple subscriptions at once.\nIt would be good to do it before final release. For those me who had turned it on for multiple podcast then globally disabled automatic download it will trigger download.\n\nWhat I did is set all subscription to disable since I couldn't choose default behavior. As a side note filtering should probably also be updated.\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "> For those me who had turned it on for multiple podcast then globally disabled automatic download it will trigger download.\n\nHmm, weird. We actually migrated the per-podcast value \"on\" to \"global default\", so that AntennaPod does not start downloading automatically after the upgrade. Are you sure that it actually started to download before you touched any settings?\nI think so.\n\nI follow a podcast and I am catching up on it. The podcast is still publishing every week and release a full episode and an excerpt. I always mark as read excerpt and dismiss full episode. They are not released the same day.\nBut this morning I noticed in my queue the newest episode and an excerpt\nI can't be 100 percent sure but I don't think I would have mistakenly download both. One was 2 day ago, the other 4 days ago. Too bad download log don't log if download was triggered manually or automatically.\n\nBeside when I checked settings for this podcast automatic download was on. Yet global is set to off.\n\nCould it be possible settings was messed up when I tried a go to settings? Before fixing screen wanting to load a variable that was no longer a boolean one?\nI am sure it one of the podcast I tried to go to specific settings when it crashed.\nI don't think the crash caused a setting to change. Do you, by any chance, have a database export from before the upgrade to 2.7.x? Did you enable \"auto-download episodes in queue\"?\nI have one on the 6th. I am sending it to you on Matrix. Tell me if it's not OK.\nAnd no download episodes in queue is off", "created_at": "2025-02-21T19:46:35Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7656, "instance_id": "AntennaPod__AntennaPod-7656", "issue_numbers": ["7654"], "base_commit": "f4f7dc716c5de1f2fc2c9e5dd3c7682a2c899e25", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\nindex 431f721d42..c3afc746ce 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n@@ -535,7 +535,7 @@ private void buildBottomNavigationMenu() {\n                     0, getString(NavigationNames.getShortLabel(tag)));\n             item.setIcon(NavigationNames.getDrawable(tag));\n         }\n-        MenuItem moreItem = menu.add(0, R.id.bottom_navigation_more, 0, getString(R.string.searchpreference_more));\n+        MenuItem moreItem = menu.add(0, R.id.bottom_navigation_more, 0, getString(R.string.overflow_more));\n         moreItem.setIcon(R.drawable.dots_vertical);\n         bottomNavigationView.setOnItemSelectedListener(bottomItemSelectedListener);\n         updateBottomNavigationBadgeIfNeeded();\ndiff --git a/settings.gradle b/settings.gradle\nindex 9f1d16fa44..7a949998df 100644\n--- a/settings.gradle\n+++ b/settings.gradle\n@@ -3,6 +3,7 @@ pluginManagement {\n         google()\n         mavenCentral()\n         gradlePluginPortal()\n+        mavenLocal()\n     }\n }\n \n@@ -12,6 +13,7 @@ dependencyResolutionManagement {\n         google()\n         mavenCentral()\n         maven { url \"https://jitpack.io\" }\n+        mavenLocal()\n     }\n }\n \ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 4dd36af089..329572a6bf 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -411,6 +411,8 @@\n     <string name=\"preference_search_hint\">Search\u2026</string>\n     <string name=\"preference_search_no_results\">No results</string>\n     <string name=\"preference_search_clear_history\">Clear history</string>\n+    <string name=\"preference_search_clear_input\">Clear</string>\n+    <string name=\"overflow_more\">More</string>\n     <string name=\"pref_episode_cleanup_title\">Delete before auto download</string>\n     <string name=\"pref_episode_cleanup_summary\">Episodes that should be eligible for removal if Auto Download needs space for new episodes</string>\n     <string name=\"pref_pauseOnDisconnect_sum\">Pause playback when headphones or bluetooth are disconnected</string>\ndiff --git a/ui/preferences/build.gradle b/ui/preferences/build.gradle\nindex 1a76f4c640..7704510711 100644\n--- a/ui/preferences/build.gradle\n+++ b/ui/preferences/build.gradle\n@@ -46,5 +46,5 @@ dependencies {\n     implementation \"com.squareup.okhttp3:okhttp:$okhttpVersion\"\n     implementation \"com.squareup.okhttp3:okhttp-urlconnection:$okhttpVersion\"\n     implementation \"org.greenrobot:eventbus:$eventbusVersion\"\n-    implementation 'com.github.ByteHamster:SearchPreference:v2.5.0'\n+    implementation 'com.github.ByteHamster:SearchPreference:2.7.1'\n }\ndiff --git a/ui/preferences/src/main/res/xml/preferences.xml b/ui/preferences/src/main/res/xml/preferences.xml\nindex 8f3851c091..3b97889fe1 100644\n--- a/ui/preferences/src/main/res/xml/preferences.xml\n+++ b/ui/preferences/src/main/res/xml/preferences.xml\n@@ -7,7 +7,9 @@\n             android:key=\"searchPreference\"\n             search:textHint=\"@string/preference_search_hint\"\n             search:textNoResults=\"@string/preference_search_no_results\"\n-            search:textClearHistory=\"@string/preference_search_clear_history\" />\n+            search:textClearHistory=\"@string/preference_search_clear_history\"\n+            search:textClearInput=\"@string/preference_search_clear_input\"\n+            search:textMore=\"@string/overflow_more\" />\n \n     <Preference\n             android:key=\"prefScreenInterface\"\n", "test_patch": "", "problem_statement": "Bottom navigation, add string to translate more button\n### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [x] I will describe the problem with as much detail as possible.\n- [x] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.7.0-beta2\n\n### Feature or improvement you want\n\nIn bottom navigation it seems the \"more\" button can't be translated. Make it so it can be !\n\n### Why should this be added?\n\nTo fully localize app\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "", "created_at": "2025-02-15T11:04:12Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7650, "instance_id": "AntennaPod__AntennaPod-7650", "issue_numbers": ["7649"], "base_commit": "a1dec4b62e063da619ed2863016d46e60eebc91a", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/preferences/FeedSettingsFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/preferences/FeedSettingsFragment.java\nindex 1f390f1092..d8d2093ab9 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/preferences/FeedSettingsFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/preferences/FeedSettingsFragment.java\n@@ -108,7 +108,7 @@ public void onDestroy() {\n \n     public static class FeedSettingsPreferenceFragment extends PreferenceFragmentCompat {\n         private static final String PREF_EPISODE_FILTER = \"episodeFilter\";\n-        private static final String PREF_AUTODOWNLOAD = \"autoDownload\";\n+        private static final String PREF_AUTODOWNLOAD = \"includeAutoDownload\";\n         private static final String PREF_SCREEN = \"feedSettingsScreen\";\n         private static final String PREF_AUTHENTICATION = \"authentication\";\n         private static final String PREF_AUTO_DELETE = \"autoDelete\";\ndiff --git a/app/src/main/res/xml/feed_settings.xml b/app/src/main/res/xml/feed_settings.xml\nindex accd341f20..15d05f7869 100644\n--- a/app/src/main/res/xml/feed_settings.xml\n+++ b/app/src/main/res/xml/feed_settings.xml\n@@ -73,7 +73,7 @@\n             android:entries=\"@array/spnEnableAutoDownloadItems\"\n             android:entryValues=\"@array/spnEnableAutoDownloadValues\"\n             android:icon=\"@drawable/ic_download\"\n-            android:key=\"autoDownload\"\n+            android:key=\"includeAutoDownload\"\n             android:title=\"@string/auto_download_label\" />\n \n         <Preference\n", "test_patch": "", "problem_statement": "Crash when going to podcast settings\n### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [x] I will describe the problem with as much detail as possible.\n- [x] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.7.0-beta1\n\n### Android version\n\n15\n\n### Device model\n\nOneplus 12\n\n### First occurred\n\nSince updating to beta\n\n### Steps to reproduce\n\n1. Open a podcast screen\n2. Tap on gear to go to settings\n\n### Expected behaviour\n\nNo crashing\n\n### Current behaviour\n\nAntennaPod crashes\n\n### Logs\n\nLast message is about not being able to convert a boolean to a string\n[full-logs.txt](https://github.com/user-attachments/files/18724682/full-logs.txt)\n", "hints_text": "", "created_at": "2025-02-11T20:46:59Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7639, "instance_id": "AntennaPod__AntennaPod-7639", "issue_numbers": ["7609"], "base_commit": "3ed5b0bfa430a4e3d25f77d6780f61434bf173f0", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/SearchFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/SearchFragment.java\nindex f9a9a4e81e..c9a0cf1706 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/SearchFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/SearchFragment.java\n@@ -178,6 +178,14 @@ public void onCreateContextMenu(ContextMenu contextMenu, View view,\n                 super.onCreateContextMenu(contextMenu, view, contextMenuInfo);\n                 MenuItemUtils.setOnClickListeners(contextMenu, SearchFragment.this::onContextItemSelected);\n             }\n+\n+            @Override\n+            protected void onClick(Feed feed) {\n+                if (adapter != null && adapter.inActionMode()) {\n+                    adapter.endSelectMode();\n+                }\n+                super.onClick(feed);\n+            }\n         };\n         recyclerViewFeeds.setAdapter(adapterFeeds);\n \n@@ -418,6 +426,9 @@ private void showInputMethod(View view) {\n     }\n \n     private void searchOnline() {\n+        if (adapter != null && adapter.inActionMode()) {\n+            adapter.endSelectMode();\n+        }\n         searchView.clearFocus();\n         InputMethodManager in = (InputMethodManager) getActivity().getSystemService(Context.INPUT_METHOD_SERVICE);\n         in.hideSoftInputFromWindow(searchView.getWindowToken(), 0);\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/HorizontalFeedListAdapter.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/HorizontalFeedListAdapter.java\nindex e66b447f82..f074e249e8 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/HorizontalFeedListAdapter.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/HorizontalFeedListAdapter.java\n@@ -74,8 +74,7 @@ public void onBindViewHolder(@NonNull Holder holder, int position) {\n         holder.itemView.setAlpha(1.0f);\n         final Feed podcast = data.get(position);\n         holder.imageView.setContentDescription(podcast.getTitle());\n-        holder.imageView.setOnClickListener(v ->\n-                mainActivityRef.get().loadChildFragment(FeedItemlistFragment.newInstance(podcast.getId())));\n+        holder.imageView.setOnClickListener(v -> onClick(podcast));\n \n         holder.imageView.setOnCreateContextMenuListener(this);\n         holder.imageView.setOnLongClickListener(v -> {\n@@ -93,6 +92,10 @@ public void onBindViewHolder(@NonNull Holder holder, int position) {\n                 .into(holder.imageView);\n     }\n \n+    protected void onClick(Feed feed) {\n+        mainActivityRef.get().loadChildFragment(FeedItemlistFragment.newInstance(feed.getId()));\n+    }\n+\n     @Nullable\n     public Feed getLongPressedItem() {\n         return longPressedItem;\n", "test_patch": "", "problem_statement": "App crashes when go back from podcast info page under multi selected mode\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.6.1f (8171ecb)\n\n### Android version\n\n11\n\n### Device model\n\nGoogle Nexus 4\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. select a podcast and enter it \r\n2. click \"search\" button\r\n3. input whatever you want, eg: he\r\n4. long click an episode item and choose \"multi select\" button\r\n5. click \"search online\" button and wait for the result\r\n6. click an unsubscribed podcast and subscribe it. \r\n7. click \"i\" button ,then app enter the info page.\r\n8. go back\n\n### Expected behaviour\n\napp returns the list page of the podcast\n\n### Current behaviour\n\napp crashs\n\n### Logs\n\n\r\n<details>\r\n<summary>crash log</summary>\r\n\r\n```\r\n java.lang.NullPointerException: Attempt to invoke virtual method 'java.lang.Object androidx.fragment.app.FragmentActivity.getSystemService(java.lang.String)' on a null object reference\r\n     at de.danoeh.antennapod.ui.screen.SearchFragment.showInputMethod(SearchFragment.java:414)\r\n     at de.danoeh.antennapod.ui.screen.SearchFragment.lambda$onCreateView$1(SearchFragment.java:202)\r\n     at de.danoeh.antennapod.ui.screen.SearchFragment.$r8$lambda$-nLJhNC5CaQfNIY9sOw3Zqe2G3c(Unknown Source:0)\r\n     at de.danoeh.antennapod.ui.screen.SearchFragment$$ExternalSyntheticLambda1.onFocusChange(D8$$SyntheticClass:0)\r\n     at androidx.appcompat.widget.SearchView$3.onFocusChange(SearchView.java:342)\r\n     at android.view.View.onFocusChanged(View.java:8116)\r\n     at android.widget.TextView.onFocusChanged(TextView.java:10839)\r\n     at android.widget.AutoCompleteTextView.onFocusChanged(AutoCompleteTextView.java:1173)\r\n     at androidx.appcompat.widget.SearchView$SearchAutoComplete.onFocusChanged(SearchView.java:1938)\r\n     at android.view.View.handleFocusGainInternal(View.java:7786)\r\n     at android.view.View.requestFocusNoSearch(View.java:13320)\r\n     at android.view.View.requestFocus(View.java:13294)\r\n     at androidx.appcompat.widget.SearchView.requestFocus(SearchView.java:493)\r\n     at android.view.View.requestFocus(View.java:13261)\r\n     at android.view.View.requestFocus(View.java:13203)\r\n     at de.danoeh.antennapod.ui.screen.SearchFragment.searchViewFocusOn(SearchFragment.java:457)\r\n     at de.danoeh.antennapod.ui.screen.SearchFragment.onEndSelectMode(SearchFragment.java:447)\r\n     at de.danoeh.antennapod.ui.SelectableAdapter.callOnEndSelectMode(SelectableAdapter.java:180)\r\n     at de.danoeh.antennapod.ui.SelectableAdapter.-$$Nest$mcallOnEndSelectMode(Unknown Source:0)\r\n     at de.danoeh.antennapod.ui.SelectableAdapter$1.onDestroyActionMode(SelectableAdapter.java:73)\r\n     at com.android.internal.policy.DecorView$ActionModeCallback2Wrapper.onDestroyActionMode(DecorView.java:2662)\r\n     at androidx.appcompat.view.SupportActionModeWrapper$CallbackWrapper.onDestroyActionMode(SupportActionModeWrapper.java:178)\r\n     at androidx.appcompat.app.AppCompatDelegateImpl$ActionModeCallbackWrapperV9.onDestroyActionMode(AppCompatDelegateImpl.java:3027)\r\n     at androidx.appcompat.view.StandaloneActionMode.finish(StandaloneActionMode.java:110)\r\n     at androidx.appcompat.app.AppCompatDelegateImpl.onBackPressed(AppCompatDelegateImpl.java:1527)\r\n     at androidx.appcompat.app.AppCompatDelegateImpl.onKeyUp(AppCompatDelegateImpl.java:1607)\r\n     at androidx.appcompat.app.AppCompatDelegateImpl.dispatchKeyEvent(AppCompatDelegateImpl.java:1598)\r\n     at androidx.appcompat.app.AppCompatDelegateImpl$AppCompatWindowCallback.dispatchKeyEvent(AppCompatDelegateImpl.java:3412)\r\n     at com.android.internal.policy.DecorView.dispatchKeyEvent(DecorView.java:390)\r\n     at android.view.ViewRootImpl$ViewPostImeInputStage.processKeyEvent(ViewRootImpl.java:5947)\r\n     at android.view.ViewRootImpl$ViewPostImeInputStage.onProcess(ViewRootImpl.java:5815)\r\n     at android.view.ViewRootImpl$InputStage.deliver(ViewRootImpl.java:5310)\r\n     at android.view.ViewRootImpl$InputStage.onDeliverToNext(ViewRootImpl.java:5367)\r\n     at android.view.ViewRootImpl$InputStage.forward(ViewRootImpl.java:5333)\r\n     at android.view.ViewRootImpl$AsyncInputStage.forward(ViewRootImpl.java:5485)\r\n     at android.view.ViewRootImpl$InputStage.apply(ViewRootImpl.java:5341)\r\n     at android.view.ViewRootImpl$AsyncInputStage.apply(ViewRootImpl.java:5542)\r\n     at android.view.ViewRootImpl$InputStage.deliver(ViewRootImpl.java:5314)\r\n     at android.view.ViewRootImpl$InputStage.onDeliverToNext(ViewRootImpl.java:5367)\r\n     at android.view.ViewRootImpl$InputStage.forward(ViewRootImpl.java:5333)\r\n     at android.view.ViewRootImpl$InputStage.apply(ViewRootImpl.java:5341)\r\n     at android.view.ViewRootImpl$InputStage.deliver(ViewRootImpl.java:5314)\r\n     at android.view.ViewRootImpl$InputStage.onDeliverToNext(ViewRootImpl.java:5367)\r\n     at android.view.ViewRootImpl$InputStage.forward(ViewRootImpl.java:5333)\r\n     at android.view.ViewRootImpl$AsyncInputStage.forward(ViewRootImpl.java:5518)\r\n     at android.view.ViewRootImpl$ImeInputStage.onFinishedInputEvent(ViewRootImpl.java:5676)\r\n     at android.view.inputmethod.InputMethodManager$PendingEvent.run(InputMethodManager.java:3179)\r\n     at android.view.inputmethod.InputMethodManager.invokeFinishedInputEventCallback(InputMethodManager.java:2721)\r\n     at android.view.inputmethod.InputMethodManager.finishedInputEvent(InputMethodManager.java:2712)\r\n     at android.view.inputmethod.InputMethodManager$ImeInputEventSender.onInputEventFinished(InputMethodManager.java:3156)\r\n     at android.view.InputEventSender.dispatchInputEventFinished(InputEventSender.java:143)\r\n     at android.os.MessageQueue.nativePollOnce(Native Method)\r\n     at android.os.MessageQueue.next(MessageQueue.java:335)\r\n     at android.os.Looper.loop(Looper.java:183)\r\n     at android.app.ActivityThread.main(ActivityThread.java:7656)\r\n     at java.lang.reflect.Method.invoke(Native Method)\r\n     at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:592)\r\n     at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:947)\r\n```\r\n</details>\r\n\n", "hints_text": "Here is the bug video.\r\nhttps://github.com/user-attachments/assets/fff1d3b3-45eb-4917-9255-09d324d7b27c\r\n\r\n", "created_at": "2025-02-02T19:33:35Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7634, "instance_id": "AntennaPod__AntennaPod-7634", "issue_numbers": ["7630"], "base_commit": "9ac85bb6e505eaa42860fe995515cba891f485a6", "patch": "diff --git a/ui/common/src/main/res/values/styles.xml b/ui/common/src/main/res/values/styles.xml\nindex 62acd8ebfc..ce5c019c04 100644\n--- a/ui/common/src/main/res/values/styles.xml\n+++ b/ui/common/src/main/res/values/styles.xml\n@@ -100,7 +100,6 @@\n         <item name=\"colorSurface\">@color/black</item>\n         <item name=\"background_color\">@color/black</item>\n         <item name=\"background_elevated\">@color/black</item>\n-        <item name=\"android:navigationBarColor\">@color/black</item>\n     </style>\n \n     <style name=\"Theme.AntennaPod.TrueBlack\" parent=\"Theme.AntennaPod.Dark\">\n@@ -110,7 +109,6 @@\n         <item name=\"colorSurface\">@color/black</item>\n         <item name=\"background_color\">@color/black</item>\n         <item name=\"background_elevated\">@color/black</item>\n-        <item name=\"android:navigationBarColor\">@color/black</item>\n         <item name=\"colorPrimaryContainer\">#0D182B</item>\n         <item name=\"colorOnPrimaryContainer\">@color/white</item>\n     </style>\n", "test_patch": "", "problem_statement": "System navigation bar does not match the app in Full Black mode\n### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [x] I will describe the problem with as much detail as possible.\n- [x] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.6.1f\n\n### Android version\n\nAndroid: 14, OneUI: 6.1\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n_No response_\n\n### Expected behaviour\n\nThe system navigation bar colour should match the colour of the bottom navigation bar.\n\n### Current behaviour\n\nThe system navigation bar colour does not match the colour of the bottom navigation bar when Full Black mode is enabled.\n\n![Image](https://github.com/user-attachments/assets/8a59c6fd-904a-4ca1-ac39-da1c4cee8e27)\n![Image](https://github.com/user-attachments/assets/43ec764c-4914-40a1-aa73-dc7d6de73ab4)\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2025-01-30T18:43:59Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7633, "instance_id": "AntennaPod__AntennaPod-7633", "issue_numbers": ["7632"], "base_commit": "9ac85bb6e505eaa42860fe995515cba891f485a6", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/actionbutton/DownloadActionButton.java b/app/src/main/java/de/danoeh/antennapod/actionbutton/DownloadActionButton.java\nindex 5413d63694..21e7510164 100644\n--- a/app/src/main/java/de/danoeh/antennapod/actionbutton/DownloadActionButton.java\n+++ b/app/src/main/java/de/danoeh/antennapod/actionbutton/DownloadActionButton.java\n@@ -79,7 +79,8 @@ public void onClick(Context context) {\n                             })\n                     .setNegativeButton(R.string.cancel_label, null);\n             if (NetworkUtils.isNetworkRestricted() && NetworkUtils.isVpnOverWifi()) {\n-                builder.setMessage(R.string.confirm_mobile_download_dialog_message_vpn);\n+                builder.setMessage(context.getString(R.string.confirm_mobile_download_dialog_message)\n+                        + \"\\n\\n\" + context.getString(R.string.confirm_mobile_download_dialog_message_vpn));\n             } else {\n                 builder.setMessage(R.string.confirm_mobile_download_dialog_message);\n             }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/StreamingConfirmationDialog.java b/app/src/main/java/de/danoeh/antennapod/ui/StreamingConfirmationDialog.java\nindex 6199aa0fd6..cf27a15b35 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/StreamingConfirmationDialog.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/StreamingConfirmationDialog.java\n@@ -3,6 +3,7 @@\n import android.content.Context;\n import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import de.danoeh.antennapod.R;\n+import de.danoeh.antennapod.net.common.NetworkUtils;\n import de.danoeh.antennapod.playback.service.PlaybackServiceStarter;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import de.danoeh.antennapod.model.playback.Playable;\n@@ -17,16 +18,21 @@ public StreamingConfirmationDialog(Context context, Playable playable) {\n     }\n \n     public void show() {\n-        new MaterialAlertDialogBuilder(context)\n+        MaterialAlertDialogBuilder builder = new MaterialAlertDialogBuilder(context)\n                 .setTitle(R.string.stream_label)\n-                .setMessage(R.string.confirm_mobile_streaming_notification_message)\n                 .setPositiveButton(R.string.confirm_mobile_streaming_button_once, (dialog, which) -> stream())\n                 .setNegativeButton(R.string.confirm_mobile_streaming_button_always, (dialog, which) -> {\n                     UserPreferences.setAllowMobileStreaming(true);\n                     stream();\n                 })\n-                .setNeutralButton(R.string.cancel_label, null)\n-                .show();\n+                .setNeutralButton(R.string.cancel_label, null);\n+        if (NetworkUtils.isNetworkRestricted() && NetworkUtils.isVpnOverWifi()) {\n+            builder.setMessage(context.getString(R.string.confirm_mobile_streaming_notification_message)\n+                    + \"\\n\\n\" + context.getString(R.string.confirm_mobile_download_dialog_message_vpn));\n+        } else {\n+            builder.setMessage(R.string.confirm_mobile_streaming_notification_message);\n+        }\n+        builder.show();\n     }\n \n     private void stream() {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/onlinefeedview/OnlineFeedViewActivity.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/onlinefeedview/OnlineFeedViewActivity.java\nindex 72b9ba6832..ad2fffcd53 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/onlinefeedview/OnlineFeedViewActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/onlinefeedview/OnlineFeedViewActivity.java\n@@ -295,6 +295,16 @@ private void parseFeed(String destination) {\n         .observeOn(AndroidSchedulers.mainThread())\n         .subscribe(this::showFeedFragment, error -> {\n             error.printStackTrace();\n+            if (error instanceof UnsupportedFeedtypeException\n+                    && \"html\".equalsIgnoreCase(((UnsupportedFeedtypeException) error).getRootElement())) {\n+                if (getIntent().getBooleanExtra(ARG_WAS_MANUAL_URL, false)) {\n+                    showErrorDialog(getString(R.string.download_error_unsupported_type_html_manual),\n+                            error.getMessage());\n+                } else {\n+                    showErrorDialog(getString(R.string.download_error_unsupported_type_html), error.getMessage());\n+                }\n+                return;\n+            }\n             showErrorDialog(getString(R.string.download_error_parser_exception), error.getMessage());\n         });\n     }\n@@ -319,9 +329,6 @@ private FeedHandlerResult doParseFeed(String destination) throws Exception {\n                 boolean dialogShown = showFeedDiscoveryDialog(destinationFile, selectedDownloadUrl);\n                 if (dialogShown) {\n                     return null; // We handled the problem\n-                } else {\n-                    throw new UnsupportedFeedtypeException(\n-                            getString(R.string.download_error_unsupported_type_html) + \"\\n\" + e.getMessage());\n                 }\n             }\n             throw e;\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex e79d6f4fc7..6c59ef1fe9 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -301,6 +301,7 @@\n     <string name=\"download_error_parser_exception\">The podcast host\\'s server sent a broken podcast feed. We recommend checking with a podcast validator such as castfeedvalidator.com and contacting the podcast creator to let them know.</string>\n     <string name=\"download_error_unsupported_type\">Unsupported feed type</string>\n     <string name=\"download_error_unsupported_type_html\">The podcast host\\'s server sent a website, not a podcast.</string>\n+    <string name=\"download_error_unsupported_type_html_manual\">The address you entered is a website address, not a podcast RSS address.</string>\n     <string name=\"download_error_not_found\">The podcast host\\'s server does not know where to find the file. It may have been deleted.</string>\n     <string name=\"download_error_connection_error\">Connection error</string>\n     <string name=\"download_error_no_connection\">No network connection</string>\n@@ -330,7 +331,7 @@\n     <string name=\"authentication_notification_title\">Authentication required</string>\n     <string name=\"confirm_mobile_download_dialog_title\">Confirm mobile download</string>\n     <string name=\"confirm_mobile_download_dialog_message\">Downloading over mobile data connection is disabled in the settings. AntennaPod can download the episode later automatically when Wi-Fi is available.</string>\n-    <string name=\"confirm_mobile_download_dialog_message_vpn\">Your VPN app pretends to be a mobile network (metered connection). Downloading over mobile data connection is disabled in the settings. If you want this problem to be fixed, contact the creators of your VPN app.</string>\n+    <string name=\"confirm_mobile_download_dialog_message_vpn\">- Using a VPN? Your VPN app pretends to be a mobile network (metered connection). If you want this problem fixed, contact the creators of your VPN app.\\n- Not using a VPN? Open the Android Wi-Fi settings and change the type of your Wi-Fi to not be metered.</string>\n     <string name=\"confirm_mobile_download_dialog_download_later\">Download later</string>\n     <string name=\"confirm_mobile_download_dialog_allow_this_time\">Download anyway</string>\n     <plurals name=\"mobile_download_notice\">\n", "test_patch": "", "problem_statement": "App says VPN ist on, but it isn't\n### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [x] I will describe the problem with as much detail as possible.\n- [x] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\nAntennaPod version: 3.6.1\n\n### Android version\n\nAndroid version: 14\n\n### Device model\n\nModel: SM-S908B\n\n### First occurred\n\n2025-01-29\n\n### Steps to reproduce\n\nApps says \"VPN is on and mobile download will cause additional Costs\", but I am at home, mobile data is off and VPN is deactivated\n\n## Environment\nAndroid version: 14\nOS version: 5.10.223-android12-9-29544049-abS908BXXUDEXK5\nAntennaPod version: 3.6.1\nModel: SM-S908B\nDevice: b0s\nProduct: b0sxeea\n\nNo crash report recorded\n\n### Expected behaviour\n\nDownload at home\n\nIt worked since since beginning of january perfect, but now it ist broken\n\n### Current behaviour\n\n_No response_\n\n### Logs\n\n_No response_\n", "hints_text": "> VPN is on and mobile download will cause additional Costs\n\nWhere does it say that? Could you take a screenshot please?\n![Image](https://github.com/user-attachments/assets/e10337ac-811a-4200-969a-088e6fcf6ae0)\n![Image](https://github.com/user-attachments/assets/3794a1ee-88ac-4f13-8556-613e013ec8b4)\n", "created_at": "2025-01-30T18:34:45Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7627, "instance_id": "AntennaPod__AntennaPod-7627", "issue_numbers": ["7172", "7619", "5849", "7275"], "base_commit": "0d85e33d66bf4583f4c7579698144368fc42aa81", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeMultiSelectActionHandler.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeMultiSelectActionHandler.java\nindex cc098053b3..a3ef938ffd 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeMultiSelectActionHandler.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeMultiSelectActionHandler.java\n@@ -5,6 +5,7 @@\n \n import androidx.annotation.PluralsRes;\n \n+import java.util.ArrayList;\n import java.util.List;\n \n import de.danoeh.antennapod.R;\n@@ -48,14 +49,14 @@ public void handleAction(List<FeedItem> items) {\n     }\n \n     private void queueChecked(List<FeedItem> items) {\n-        // Check if an episode actually contains any media files before adding it to queue\n-        LongList toQueue = new LongList(items.size());\n+        // Count here to give accurate number in snackbar\n+        List<FeedItem> toQueue = new ArrayList<>();\n         for (FeedItem episode : items) {\n-            if (episode.hasMedia()) {\n-                toQueue.add(episode.getId());\n+            if (episode.hasMedia() && !episode.isTagged(FeedItem.TAG_QUEUE)) {\n+                toQueue.add(episode);\n             }\n         }\n-        DBWriter.addQueueItem(activity, true, toQueue.toArray());\n+        DBWriter.addQueueItem(activity, toQueue.toArray(new FeedItem[0]));\n         showMessage(R.plurals.added_to_queue_batch_label, toQueue.size());\n     }\n \ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/swipeactions/RemoveFromQueueSwipeAction.java b/app/src/main/java/de/danoeh/antennapod/ui/swipeactions/RemoveFromQueueSwipeAction.java\nindex dbdc3126bb..ac715b0ccc 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/swipeactions/RemoveFromQueueSwipeAction.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/swipeactions/RemoveFromQueueSwipeAction.java\n@@ -46,7 +46,7 @@ public void performAction(FeedItem item, Fragment fragment, FeedItemFilter filte\n                     fragment.getResources().getQuantityString(R.plurals.removed_from_queue_batch_label, 1, 1),\n                     Snackbar.LENGTH_LONG)\n                     .setAction(fragment.getString(R.string.undo), v ->\n-                            DBWriter.addQueueItemAt(fragment.requireActivity(), item.getId(), position, false));\n+                            DBWriter.addQueueItemAt(fragment.requireActivity(), item.getId(), position));\n         }\n     }\n \ndiff --git a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/autodownload/AutomaticDownloadAlgorithm.java b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/autodownload/AutomaticDownloadAlgorithm.java\nindex 468fb60aff..1371d3a440 100644\n--- a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/autodownload/AutomaticDownloadAlgorithm.java\n+++ b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/autodownload/AutomaticDownloadAlgorithm.java\n@@ -50,12 +50,9 @@ public Runnable autoDownloadUndownloadedItems(final Context context) {\n \n                 Log.d(TAG, \"Performing auto-dl of undownloaded episodes\");\n \n-                List<FeedItem> candidates;\n-                final List<FeedItem> queue = DBReader.getQueue();\n                 final List<FeedItem> newItems = DBReader.getEpisodes(0, Integer.MAX_VALUE,\n                         new FeedItemFilter(FeedItemFilter.NEW), SortOrder.DATE_NEW_OLD);\n-                candidates = new ArrayList<>(queue.size() + newItems.size());\n-                candidates.addAll(queue);\n+                final List<FeedItem> candidates = new ArrayList<>();\n                 for (FeedItem newItem : newItems) {\n                     FeedPreferences feedPrefs = newItem.getFeed().getPreferences();\n                     if (feedPrefs.isAutoDownload(UserPreferences.isEnableAutodownloadGlobal())\n@@ -65,6 +62,15 @@ public Runnable autoDownloadUndownloadedItems(final Context context) {\n                     }\n                 }\n \n+                if (UserPreferences.isEnableAutodownloadQueue()) {\n+                    final List<FeedItem> queue = DBReader.getQueue();\n+                    for (FeedItem item : queue) {\n+                        if (!candidates.contains(item)) {\n+                            candidates.add(item);\n+                        }\n+                    }\n+                }\n+\n                 // filter items that are not auto downloadable\n                 Iterator<FeedItem> it = candidates.iterator();\n                 while (it.hasNext()) {\ndiff --git a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/DownloadServiceInterfaceImpl.java b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/DownloadServiceInterfaceImpl.java\nindex 0b5be92b85..9348eaa8de 100644\n--- a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/DownloadServiceInterfaceImpl.java\n+++ b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/DownloadServiceInterfaceImpl.java\n@@ -51,7 +51,7 @@ private static OneTimeWorkRequest.Builder getRequest(Context context, FeedItem i\n                 .addTag(DownloadServiceInterface.WORK_TAG)\n                 .addTag(DownloadServiceInterface.WORK_TAG_EPISODE_URL + item.getMedia().getDownloadUrl());\n         if (!item.isTagged(FeedItem.TAG_QUEUE) && UserPreferences.enqueueDownloadedEpisodes()) {\n-            DBWriter.addQueueItem(context, false, item.getId());\n+            DBWriter.addQueueItem(context, item);\n             workRequest.addTag(DownloadServiceInterface.WORK_DATA_WAS_QUEUED);\n         }\n         workRequest.setInputData(new Data.Builder().putLong(WORK_DATA_MEDIA_ID, item.getMedia().getId()).build());\ndiff --git a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\nindex d2939c21bc..5c9125f0cd 100644\n--- a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\n+++ b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\n@@ -1801,8 +1801,7 @@ private void cancelPositionObserver() {\n \n     private void addPlayableToQueue(Playable playable) {\n         if (playable instanceof FeedMedia) {\n-            long itemId = ((FeedMedia) playable).getItem().getId();\n-            DBWriter.addQueueItem(this, false, true, itemId);\n+            DBWriter.addQueueItem(this, ((FeedMedia) playable).getItem());\n             notifyChildrenChanged(getString(R.string.queue_label));\n         }\n     }\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBWriter.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBWriter.java\nindex b8e114c15c..1bf8c4900c 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBWriter.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBWriter.java\n@@ -334,84 +334,43 @@ public static Future<?> addDownloadStatus(final DownloadResult status) {\n      * @param context             A context that is used for opening a database connection.\n      * @param itemId              ID of the FeedItem that should be added to the queue.\n      * @param index               Destination index. Must be in range 0..queue.size()\n-     * @param performAutoDownload True if an auto-download process should be started after the operation\n      * @throws IndexOutOfBoundsException if index < 0 || index >= queue.size()\n      */\n-    public static Future<?> addQueueItemAt(final Context context, final long itemId,\n-                                           final int index, final boolean performAutoDownload) {\n+    public static Future<?> addQueueItemAt(final Context context, final long itemId, final int index) {\n         return runOnDbThread(() -> {\n             final PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n             final List<FeedItem> queue = DBReader.getQueue();\n-            FeedItem item;\n-\n-            if (queue != null) {\n-                if (!itemListContains(queue, itemId)) {\n-                    item = DBReader.getFeedItem(itemId);\n-                    if (item != null) {\n-                        queue.add(index, item);\n-                        adapter.setQueue(queue);\n-                        item.addTag(FeedItem.TAG_QUEUE);\n-                        EventBus.getDefault().post(QueueEvent.added(item, index));\n-                        EventBus.getDefault().post(FeedItemEvent.updated(item));\n-                        if (item.isNew()) {\n-                            DBWriter.markItemPlayed(FeedItem.UNPLAYED, item.getId());\n-                        }\n+\n+            if (!itemListContains(queue, itemId)) {\n+                FeedItem item = DBReader.getFeedItem(itemId);\n+                if (item != null) {\n+                    queue.add(index, item);\n+                    adapter.setQueue(queue);\n+                    item.addTag(FeedItem.TAG_QUEUE);\n+                    EventBus.getDefault().post(QueueEvent.added(item, index));\n+                    EventBus.getDefault().post(FeedItemEvent.updated(item));\n+                    if (item.isNew()) {\n+                        DBWriter.markItemPlayed(FeedItem.UNPLAYED, item.getId());\n                     }\n                 }\n             }\n \n             adapter.close();\n-            if (performAutoDownload) {\n-                AutoDownloadManager.getInstance().autodownloadUndownloadedItems(context);\n-            }\n-\n+            AutoDownloadManager.getInstance().autodownloadUndownloadedItems(context);\n         });\n-\n-    }\n-\n-    public static Future<?> addQueueItem(final Context context, final FeedItem... items) {\n-        return addQueueItem(context, true, items);\n-    }\n-\n-    public static Future<?> addQueueItem(final Context context, boolean markAsUnplayed, final FeedItem... items) {\n-        LongList itemIds = new LongList(items.length);\n-        for (FeedItem item : items) {\n-            if (!item.hasMedia()) {\n-                continue;\n-            }\n-            itemIds.add(item.getId());\n-            item.addTag(FeedItem.TAG_QUEUE);\n-        }\n-        return addQueueItem(context, false, markAsUnplayed, itemIds.toArray());\n     }\n \n     /**\n      * Appends FeedItem objects to the end of the queue. The 'read'-attribute of all items will be set to true.\n      * If a FeedItem is already in the queue, the FeedItem will not change its position in the queue.\n      *\n-     * @param context             A context that is used for opening a database connection.\n-     * @param performAutoDownload true if an auto-download process should be started after the operation.\n-     * @param itemIds             IDs of the FeedItem objects that should be added to the queue.\n+     * @param context  A context that is used for opening a database connection.\n+     * @param items    FeedItem objects that should be added to the queue.\n      */\n-    public static Future<?> addQueueItem(final Context context, final boolean performAutoDownload,\n-                                         final long... itemIds) {\n-        return addQueueItem(context, performAutoDownload, true, itemIds);\n-    }\n-\n-    /**\n-     * Appends FeedItem objects to the end of the queue. The 'read'-attribute of all items will be set to true.\n-     * If a FeedItem is already in the queue, the FeedItem will not change its position in the queue.\n-     *\n-     * @param context             A context that is used for opening a database connection.\n-     * @param performAutoDownload true if an auto-download process should be started after the operation.\n-     * @param markAsUnplayed      true if the items should be marked as unplayed when enqueueing\n-     * @param itemIds             IDs of the FeedItem objects that should be added to the queue.\n-     */\n-    public static Future<?> addQueueItem(final Context context, final boolean performAutoDownload,\n-                                         final boolean markAsUnplayed, final long... itemIds) {\n+    public static Future<?> addQueueItem(final Context context, final FeedItem... items) {\n         return runOnDbThread(() -> {\n-            if (itemIds.length < 1) {\n+            if (items.length < 1) {\n                 return;\n             }\n \n@@ -419,7 +378,6 @@ public static Future<?> addQueueItem(final Context context, final boolean perfor\n             adapter.open();\n             final List<FeedItem> queue = DBReader.getQueue();\n \n-            boolean queueModified = false;\n             LongList markAsUnplayedIds = new LongList();\n             List<QueueEvent> events = new ArrayList<>();\n             List<FeedItem> updatedItems = new ArrayList<>();\n@@ -427,38 +385,35 @@ public static Future<?> addQueueItem(final Context context, final boolean perfor\n                     new ItemEnqueuePositionCalculator(UserPreferences.getEnqueueLocation());\n             Playable currentlyPlaying = DBReader.getFeedMedia(PlaybackPreferences.getCurrentlyPlayingFeedMediaId());\n             int insertPosition = positionCalculator.calcPosition(queue, currentlyPlaying);\n-            for (long itemId : itemIds) {\n-                if (!itemListContains(queue, itemId)) {\n-                    final FeedItem item = DBReader.getFeedItem(itemId);\n-                    if (item != null) {\n-                        queue.add(insertPosition, item);\n-                        events.add(QueueEvent.added(item, insertPosition));\n-\n-                        item.addTag(FeedItem.TAG_QUEUE);\n-                        updatedItems.add(item);\n-                        queueModified = true;\n-                        if (item.isNew()) {\n-                            markAsUnplayedIds.add(item.getId());\n-                        }\n-                        insertPosition++;\n-                    }\n+            for (FeedItem item : items) {\n+                if (itemListContains(queue, item.getId())) {\n+                    continue;\n+                } else if (!item.hasMedia()) {\n+                    continue;\n+                }\n+                queue.add(insertPosition, item);\n+                events.add(QueueEvent.added(item, insertPosition));\n+\n+                item.addTag(FeedItem.TAG_QUEUE);\n+                updatedItems.add(item);\n+                if (item.isNew()) {\n+                    markAsUnplayedIds.add(item.getId());\n                 }\n+                insertPosition++;\n             }\n-            if (queueModified) {\n+            if (!updatedItems.isEmpty()) {\n                 applySortOrder(queue, events);\n                 adapter.setQueue(queue);\n                 for (QueueEvent event : events) {\n                     EventBus.getDefault().post(event);\n                 }\n                 EventBus.getDefault().post(FeedItemEvent.updated(updatedItems));\n-                if (markAsUnplayed && markAsUnplayedIds.size() > 0) {\n+                if (markAsUnplayedIds.size() > 0) {\n                     DBWriter.markItemPlayed(FeedItem.UNPLAYED, markAsUnplayedIds.toArray());\n                 }\n             }\n             adapter.close();\n-            if (performAutoDownload) {\n-                AutoDownloadManager.getInstance().autodownloadUndownloadedItems(context);\n-            }\n+            AutoDownloadManager.getInstance().autodownloadUndownloadedItems(context);\n         });\n     }\n \ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/ItemEnqueuePositionCalculator.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/ItemEnqueuePositionCalculator.java\nindex 3163567159..7504043c59 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/ItemEnqueuePositionCalculator.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/ItemEnqueuePositionCalculator.java\n@@ -13,9 +13,7 @@\n import de.danoeh.antennapod.model.playback.Playable;\n \n /**\n- * @see de.danoeh.antennapod.storage.database.DBWriter#addQueueItem(android.content.Context, boolean, long...)\n- * it uses the class to determine\n- * the positions of the {@link FeedItem} in the queue.\n+ * Determine the positions of the new {@link FeedItem} in the queue.\n  */\n public class ItemEnqueuePositionCalculator {\n \ndiff --git a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\nindex 9e49de4eef..cbbedd92b2 100644\n--- a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n+++ b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n@@ -99,6 +99,7 @@ public abstract class UserPreferences {\n     public static final String PREF_EPISODE_CLEANUP = \"prefEpisodeCleanup\";\n     public static final String PREF_EPISODE_CACHE_SIZE = \"prefEpisodeCacheSize\";\n     public static final String PREF_AUTODL_GLOBAL = \"prefEnableAutoDl\";\n+    public static final String PREF_AUTODL_QUEUE = \"prefEnableAutoDlQueue\";\n     public static final String PREF_ENABLE_AUTODL_ON_BATTERY = \"prefEnableAutoDownloadOnBattery\";\n     private static final String PREF_PROXY_TYPE = \"prefProxyType\";\n     private static final String PREF_PROXY_HOST = \"prefProxyHost\";\n@@ -539,6 +540,10 @@ public static boolean isEnableAutodownloadGlobal() {\n         return prefs.getBoolean(PREF_AUTODL_GLOBAL, false);\n     }\n \n+    public static boolean isEnableAutodownloadQueue() {\n+        return prefs.getBoolean(PREF_AUTODL_QUEUE, false);\n+    }\n+\n     public static boolean isEnableAutodownloadOnBattery() {\n         return prefs.getBoolean(PREF_ENABLE_AUTODL_ON_BATTERY, true);\n     }\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex ab204db811..b14863b3aa 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -473,6 +473,8 @@\n     <string name=\"pref_nav_drawer_feed_counter_sum\">Change the information displayed by the subscription counter. Also affects the sorting of subscriptions if \\'Subscription Order\\' is set to \\'Counter\\'.</string>\n     <string name=\"pref_automatic_download_title\">Automatic download</string>\n     <string name=\"pref_automatic_download_global_description\">Automatically download new episodes. Can be overridden per podcast.</string>\n+    <string name=\"pref_automatic_download_queue_title\">Download queued</string>\n+    <string name=\"pref_automatic_download_queue_description\">Automatically download queued episodes</string>\n     <string name=\"pref_automatic_download_sum\">Configure the automatic download of episodes</string>\n     <string name=\"pref_automatic_download_on_battery_title\">Download when not charging</string>\n     <string name=\"pref_automatic_download_on_battery_sum\">Allow automatic download when the battery is not charging</string>\ndiff --git a/ui/preferences/src/main/res/xml/preferences_autodownload.xml b/ui/preferences/src/main/res/xml/preferences_autodownload.xml\nindex 5c1c43d301..456da18f34 100644\n--- a/ui/preferences/src/main/res/xml/preferences_autodownload.xml\n+++ b/ui/preferences/src/main/res/xml/preferences_autodownload.xml\n@@ -6,6 +6,11 @@\n             android:key=\"prefEnableAutoDl\"\n             android:title=\"@string/pref_automatic_download_title\"\n             android:summary=\"@string/pref_automatic_download_global_description\"/>\n+    <SwitchPreferenceCompat\n+            android:defaultValue=\"false\"\n+            android:key=\"prefEnableAutoDlQueue\"\n+            android:title=\"@string/pref_automatic_download_queue_title\"\n+            android:summary=\"@string/pref_automatic_download_queue_description\"/>\n     <de.danoeh.antennapod.ui.preferences.preference.MaterialListPreference\n             android:defaultValue=\"25\"\n             android:entries=\"@array/episode_cache_size_entries\"\n", "test_patch": "", "problem_statement": "Auto-download episode added to queue (option)\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.3.2\n\n### Where did you get the app from\n\nGoogle Play\n\n### Problem you may be having, or feature you want\n\nAs a user I want episode I add to my queue to be downloaded right away.\n\n### Suggested solution\n\nThere should be an option to make a newly enqueued \u00e9pisode downloaded. \r\nMaybe also an option to only download X episodes in the top of the queue.\n\n### Screenshots / Drawings / Technical details\n\n_No response_\nEpisode filter does not work\n### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [x] I will describe the problem with as much detail as possible.\n- [x] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.6.1\n\n### Android version\n\n15\n\n### Device model\n\nPixel 9 Pro\n\n### First occurred\n\nEvery time since 6 months ago\n\n### Steps to reproduce\n\n1. Find settings for a subscribed show\n2. Enable auto download \n3. Enter an episode filter term to exclude from auto download, eg \"Talking\" (quotes not entered in the app)\n4. Observe that a new episode with title that starts with the word \"Talking\" is indeed downloaded and added to the queue despite step 3\n\n\n### Expected behaviour\n\nEpisodes whose titles contain the text provided in the exclusion filter should not be downloaded\n\n### Current behaviour\n\nAs described above\n\n### Logs\n\n_No response_\nQueued episodes auto-download when \"auto download\" is turned off for feed\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n2.5.1\n\n### Where did you get the app from\n\nF-Droid\n\n### Android version\n\n11 - LineageOS 18.1\n\n### Device model\n\nGoogle Pixel 4a\n\n### First occurred\n\nseveral months ago\n\n### Steps to reproduce\n\nturn on auto download at the global level\r\nturn off auto download for a given feed\r\nadd a new episode from that feed to the queue\r\nThe download doesnt start right away.  in only starts when an episode is removed by swiping left, or is removed when finished.\r\nThis happens to all podcasts: new, unplayed and played.\r\nIf download is cancelled it wont try to download again.\r\n\r\n\r\n\n\n### Expected behaviour\n\nauto download is turned off for the feed, so episodes from that feed shouldnt auto download.\n\n### Current behaviour\n\nepisode downloads\n\n### Logs\n\n_No response_\nImplement queue autodownload\n### Description\r\nThis PR implements auto download of queued items. The first 5 items are always downloaded, if enabled.\r\nAfter an episode is finished, this is checked, and if nessessary, a download is triggered.\r\n\r\nThis has the following benefits:\r\n- The user can \"entirely\" prevent mobile data usage.\r\n- Issues with stream-caching are prevented\r\n- Content is available when internet is not, regardless of user interaction. (to be precise: regardless of user inaction, where they forgot to download the next episode)\r\n\r\nCloses #7273\r\nCloses #6829\r\nImplements #7171\r\nImplements #7172\r\n\r\n\r\n### Todo: \r\n\r\n- [ ] Add setting to import/export (if applicable)\r\n- [ ] Find good naming for setting\r\n- [ ] Put the setting in the correct place\r\n- [ ] Is the `DownloadServiceInterfaceImpl` the correct way to handle this?\r\n\r\n\r\nP.S.:\r\n\r\nI _really_ like the debug-app-icon. It is great!\r\n\r\n### Checklist\r\n<!-- \r\n  To help us keep the issue tracker clean and work as efficient as possible,\r\n  please make sure that you have done all of the following.\r\n  You can tick the boxes below by placing an x inside the brackets like this: [x]\r\n-->\r\n- [x] I have read the contribution guidelines: https://github.com/AntennaPod/AntennaPod/blob/develop/CONTRIBUTING.md#submit-a-pull-request\r\n- [x] I have performed a self-review of my code\r\n- [x] I have run the automated code checks using `./gradlew checkstyle spotbugsPlayDebug spotbugsDebug :app:lintPlayDebug`\r\n- [x] My code follows the style guidelines of the AntennaPod project: https://github.com/AntennaPod/AntennaPod/wiki/Code-style\r\n- [x] I have mentioned the corresponding issue and the relevant keyword (e.g., \"Closes: #xy\") in the description (see https://docs.github.com/en/issues/tracking-your-work-with-issues/linking-a-pull-request-to-an-issue)\r\n- [x] If it is a core feature, I have added automated tests\r\n\n", "hints_text": "There already is an option \"enqueue downloaded\" which does exactly what you request. You just need to press the \"download\" button instead of the \"add to queue\" button.\nI'm sorry Bytehamster, but this is exactly the opposite of what OP and [also previously myself](https://github.com/AntennaPod/AntennaPod/issues/6829) ask for. Your solution requires downloading _in order_ to enqueue, which is not always possible, for example on metered data.\n\nOur suggestion is that when you move an episode from Inbox to Queue (decide that you want to listen to it at some point as oppose to dismissing it) then Antennapod would download it to storage at next possible occasion \u2014 immediately, if possible, or later when on WiFi or unmetered data. If, however, you don't get an occasion to download it, it will simply stream when it gets to the top of the queue.\n\nAnd in fact this is exactly how Pocket Casts implemented this. There are separate toggles under auto-download settings. One for downloading every new episode, and one for only downloading the ones which are in the queue (Up Next):\n\n![Screenshot_20240609-141355_Pocket_Casts.png](https://github.com/AntennaPod/AntennaPod/assets/60844668/caeec560-a75e-4b1f-838c-25c968b4f5ac)\n\n\n\n\nThis was a feature, not a bug in old AntennaPod versions. New AntennaPod versions no longer do that.\r\n\r\nEdit: It still is intended behavior.\nIm still seeing this behaviour in the latest version on FDroid, 2.7.1\nSorry for the late reply.\r\n\r\n> Add setting to import/export (if applicable)\r\n\r\nNot necessary, we currently don't import/export settings\r\n\r\n> Is the DownloadServiceInterfaceImpl the correct way to handle this?\r\n\r\nHmm, I'm not really convinced. The way you set it up currently is that the UI starts the downloads, ignoring the other auto-download logic. Instead, I would combine this with `AutomaticDownloadAlgorithm.java`, so it uses the same background service. This also ensures that it works reliably even when adding it to the queue using possible other code paths than the ones you used here.\n@ByteHamster \r\n\r\nI have migrated this feature to the auto downloader.\r\n\r\nThis has a considerable drawback: \r\nSince the episode limit is applied, the queue might not get updated if the limit is reached by other means. This will fail silently, without the user clearly knowing why. \r\n\r\nHowerver: At the moment i am questioning the whole auto-download implementation. My understanding of the UX is as follows:\r\n\r\n\r\n1. The user subscribes to 10 podcasts.\r\n2. The user adds 5 of these to be added to the queue automatically\r\n3. The user leaves home, and does not have internet access\r\n4. The subscribed podcasts are downloaded by the automatic rules. All 10 podcasts get their newest episode downloaded.\r\n\r\nFrom this i would say that it is only required to auto download from the queue anyway, because it is save to assume that the user will not need unqueued feed items, or items from feeds that are not added to the queue automatically. If a user plans on listening such a podcast, a manual download would be triggered anyway.\r\n\r\nMy suggestion:\r\n\r\n1. Remove the autodownload (as is) from podcasts alltogether and only use it on the queue. That means the \"episode \r\nlimit\" only applies to the queue, nothing else.\r\n2. Re-introduce autodownload per podcast, but name it \"Automatically Download new Episodes\" and decouple it from the queue.\r\n\r\nAlternatively it is possible to keep the queue downloads a fixed size, and make the episode limit apply to the podcast auto-downloads, but then it needs to be renamed to clearly communicate to what it applies.\r\n\r\nOn a technical side: It might make sense to make the `KEY_AUTO_DOWNLOAD_ENABLED` type an integer to communicate what kind of autodownload it is (Queue/Podcast). This way we can include/exclude limitations fitting to the usecase.\r\n\r\nLet me know what you think!\nI did implement the last change i proposed. This allows the autodownloader to bypass the episode limit for the queue. If you'd like me to push it, just say so! \n<table><tr>\r\n<td>\r\n<img src=\"https://github.com/user-attachments/assets/48ca07cb-d831-4ccc-9704-f281eebe5056\">\r\n</td>\r\n<td>\r\n<img src=\"https://github.com/user-attachments/assets/ec0c76cf-847a-4ce6-9780-0ec7d00a659a\">\r\n</td>\r\n</tr></table>\r\n\r\nI have been experimenting with the settings a bit. The above screenshots are a test version and mock-ups.\r\nIt works as follows:\r\n- The global \"Enable Autodownload-toggle\" is gone. It is not needed.\r\n- \"Keep Queue Up to date\" is newly introduced\r\n- \"Auto Download new Episode\" \"replaces\" the old \"Enable Autodownload-toggle\"\r\n- The \"Auto download new Episodes\" per feed works similar to before, except now they initially take on the value of the default-switch. If the default is used, a summary with the used default is shown. If the user toggled it, the summary is removed and it ignores any changes to the default.\r\n\r\nThe last part does not work at the moment. There is currently no way of knowing whether or not a user manually toggled the switch or not. \r\n\r\nAs far as i can tell, those changes adress a lot of the requests users had for autodownloads.\r\n\r\n### Why?\r\nTo me this makes everything a little bit less cluttered. There is no need to \"enable\" an entire feature anymore. This has been replaced by sensible defaults (that we need to agree on). That allows the user to _always_ use the autodl-feature, without having to jump through hoops if it wasn't enabled before. It also allows the user more fine-grained control of what gets downloaded, and when. \r\n\r\nHowever, there is one extremely important thing that i have not yet solved fully. The wording of any switch and summary needs to be rather precise, otherwise it might create confusion about what the switches are doing, and when.\r\n\r\n### Why not three state?\r\nI don't think that dropdown-menus would be a good UX here. The settings are ON/OFF/DEFAULT, and a switch seems perfect for that. We only need to communicate the DEFAULT properly. Also there is no three-state toggle used in the app, so introducing one does not seem good.\nThis is starting to become a much more general rewrite of the auto-download functionality. That is something that should be evaluated thoroughly before starting the implementation. There are many different use-cases for auto-download, some users might prefer the old way.\r\n\r\nIn any case, I would separate the changes. The queue auto-download itself can be merged rather quickly. The other changes need a lot more discussion, which would then also delay the queue feature. Please keep this PR focused on the queue only for now. Happy to discuss the auto-download changes as well, but probably not here in this PR. I think the monthly community call would be a better fit for that \n> This is starting to become a much more general rewrite of the auto-download functionality.\r\n\r\nIt's not *that* much work, i already did quite a bit of the required changes as a proof of concept. Though i agree that it changes how it works quite a bit. But what i understand from #7064, those changes are very close to what was proposed there.\r\n\r\nThe queue-feature is done as is. Though it's use is pretty much debatable now, since it is very likely it won't work as expected since the autodownload-algorithm does obey the episode-limit and will therefore not update the queue if the limit would be exceeded. Though i can add that, since i already did so in my experiment.\nShouldn't the following code already auto-download queued items? https://github.com/AntennaPod/AntennaPod/blob/develop/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/autodownload/AutomaticDownloadAlgorithm.java#L59\r\n\r\nI think we need to figure out why it doesn't, instead of adding similar code in different locations of the app. That would make maintenance a lot harder in the future.\nAs far as i can tell, the linked code does not generally download the queue, but only items that have autodownloading enabled (like new episodes)\r\n\r\nThis means that old episodes or non downloaded next queue items, would not be downloaded.\r\n\r\nNew items get marked for autodownload upon beeing created, so it works for them\r\n\r\nMy PR basically adds this 'marking' to the next queue items, and triggers the algorithm.\ni have pushed my other changes in this branch if you want to check it out:\r\nhttps://github.com/newhinton/AntennaPod/tree/feature/noid/autodl-rework\r\n\r\nit implements most of the basics from my above suggestions, and in my opinion, they work better than the current implementation due to smarter defaults.\nI have thought a bit more about this PR and your use-case (especially the fact that you prefer it to ignore the episode limit). You already add the episodes to the queue. For you, pressing \"download\" instead of \"add to queue\" would have the same number of clicks for the same result. The only problem there is mobile data. So wouldn't starting the manual download as soon as WiFi is available solve your use-case even better?\nNot really.\r\n\r\nI dont manually add new elements. I find an existing podcast with, lets say a hundred episodes. Then i add the entire podcast to the queue.\r\n\r\nNow, nothing is downloaded at all, because none of the episodes are \"new\". I have to manually download each episode. (Or, select a subset, or all, and then download them)  All of the options are a manual process and require huge amounts of local free space.\r\n\r\n\r\nMy pr looks into the queue after any kind of change happened to it (usually finishing an episode) and then checks the next five episodes of the queue if they are downloaded or not. (This applies to any podcast, regardless of it's own setting)\r\n\r\n\r\nThe assumption i am (imho reasonably) making is that the user wants to listen to the next episode in the queue. If said user does not want to stream, antennapod then makes it's best effort to keep the queue available on device, without the user intervening.\nI generally got the feeling that antennapod handles downloads very episode-centric.\r\n\r\nIt is always about the _state_ of the _episode_. Is it new? Was it added somewhere? Is there space for _this_ episode?\r\n\r\nI feel that this misses the _intent_ of the user. It doesn't really matter where or when the episode was added, just that it is (likely) the next in line to be played.\r\n\r\nA lot of that is already covered with the existing functionality, but that largely applies to truly new content, not older content. It also becomes a bit of work when podcasts were previously only subscribed to, but not downloaded or added to the inbox/queue. Then it would be treated again as old content, and the manual interaction becomes required again\nI agree that the general auto-download logic is not optimal. We do have it on our wish-list to rewrite the logic at some point, to be more predictable, reliable, and easier to understand.\r\n\r\nWould you be interested in discussing the auto-download feature at our community call? https://antennapod.org/events/community-meeting The next call is this Saturday the 14th at 18:00 CEST (see https://time.is/Berlin).\nThis weekend? Sure!\r\n\r\n(Thank you so much for providing an .ics!)\r\n\r\nI'll try to prepare a more kondensed an clean proposal than i did here. Any preferred way? (Do you want a short presentation, or maybe just a written text?)\nAwesome! Having a few bullet points would be great to base the discussion on (especially for others who haven't read this thread). I don't think you need to spend a lot of time on preparing a presentation :) We're basically just hanging out, it's not a super serious meeting (usually about 3-5 people join).\n@newhinton in case you are interested, the call is ongoing now :) https://meet.antennapod.org/CommunityCall It seems that it is just @keunes and me this time.\n@ByteHamster @keunes Hey, i have finished my initial written proposal. However, i never recieved a confirmation email adress from your forum. Could you take a look at that? Thank you!\n[main.pdf](https://github.com/user-attachments/files/17212681/main.pdf)\r\n\nHi @ByteHamster @newhinton,\r\n\r\nWhere were we at with this one? I remember that we had a call (or two?) about the approach to autodownloads, and kinda landed on a conclusion for the approach to take (_after_ the last message in this PR). Did we take notes?\r\n\r\nThis forum post made me think of this effort: https://forum.antennapod.org/t/automatic-download-limit-override-for-select-series/5668\nI don't think we had a final result.\r\n\r\n@ByteHamster needed to think about the current approach (why it was choosen in the first place).\r\n\r\nAlso the final idea we had was close to the current implementation. The main difference was that each download got assigned a tag or similar so that it is possible to differentiate the source, and then apply rules to it (or not)\r\n\r\nAt least that is what i took from that meeting and remembered.\n@keunes for the auto-download feature, your opinion in  #7458 would be appreciated before we move on with this PR here", "created_at": "2025-01-24T18:23:55Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7614, "instance_id": "AntennaPod__AntennaPod-7614", "issue_numbers": ["7461"], "base_commit": "e4ac872b74f738b01cfc584d727d7326de10b892", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\nindex 6e1dfa56e1..10a002a717 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\n@@ -64,6 +64,7 @@\n import de.danoeh.antennapod.ui.screen.feed.preferences.FeedSettingsFragment;\n import de.danoeh.antennapod.ui.screen.subscriptions.FeedMenuHandler;\n import de.danoeh.antennapod.ui.swipeactions.SwipeActions;\n+import io.reactivex.Completable;\n import io.reactivex.Maybe;\n import io.reactivex.Observable;\n import io.reactivex.android.schedulers.AndroidSchedulers;\n@@ -201,14 +202,36 @@ public void onScrolled(@NonNull RecyclerView view, int deltaX, int deltaY) {\n                         Snackbar.LENGTH_SHORT);\n                 return false;\n             }\n-            new EpisodeMultiSelectActionHandler(getActivity(), menuItem.getItemId())\n-                    .handleAction(adapter.getSelectedItems());\n-            adapter.endSelectMode();\n+            EpisodeMultiSelectActionHandler handler\n+                    = new EpisodeMultiSelectActionHandler(getActivity(), menuItem.getItemId());\n+            Completable.fromAction(() -> handleActionForAllSelectedItems(handler))\n+                    .subscribeOn(Schedulers.io())\n+                    .observeOn(AndroidSchedulers.mainThread())\n+                    .subscribe(() -> adapter.endSelectMode(),\n+                            error -> Log.e(TAG, Log.getStackTraceString(error)));\n             return true;\n         });\n         return viewBinding.getRoot();\n     }\n \n+    private void handleActionForAllSelectedItems(EpisodeMultiSelectActionHandler handler) {\n+        handler.handleAction(adapter.getSelectedItems());\n+        if (adapter.shouldSelectLazyLoadedItems()) {\n+            int applyPage = page + 1;\n+            List<FeedItem> nextPage;\n+            do {\n+                nextPage = loadMoreData(applyPage);\n+                handler.handleAction(nextPage);\n+                applyPage++;\n+            } while (nextPage.size() == EPISODES_PER_PAGE);\n+        }\n+    }\n+\n+    private List<FeedItem> loadMoreData(int page) {\n+        Feed feed = DBReader.getFeed(feedID, true, (page - 1) * EPISODES_PER_PAGE, EPISODES_PER_PAGE);\n+        return feed != null ? feed.getItems() : Collections.emptyList();\n+    }\n+\n     private void updateRecyclerPadding() {\n         boolean hasMorePages = feed != null && feed.isPaged() && feed.getNextPageLink() != null;\n         boolean pageLoaderVisible = viewBinding.recyclerView.isScrolledToBottom() && hasMorePages;\n@@ -619,20 +642,19 @@ private void loadMoreItems() {\n         isLoadingMore = true;\n         adapter.setDummyViews(1);\n         adapter.notifyItemInserted(adapter.getItemCount() - 1);\n-        disposable = Observable.fromCallable(() -> DBReader.getFeed(feedID, true,\n-                        (page - 1) * EPISODES_PER_PAGE, EPISODES_PER_PAGE))\n+        disposable = Observable.fromCallable(() -> loadMoreData(page))\n                 .subscribeOn(Schedulers.io())\n                 .observeOn(AndroidSchedulers.mainThread())\n                 .subscribe(\n-                        data -> {\n-                            if (data.getItems().size() < EPISODES_PER_PAGE) {\n+                        items -> {\n+                            if (items.size() < EPISODES_PER_PAGE) {\n                                 hasMoreItems = false;\n                             }\n-                            feed.getItems().addAll(data.getItems());\n+                            feed.getItems().addAll(items);\n                             adapter.setDummyViews(0);\n                             adapter.updateItems(feed.getItems());\n                             if (adapter.shouldSelectLazyLoadedItems()) {\n-                                adapter.setSelected(feed.getItems().size() - data.getItems().size(),\n+                                adapter.setSelected(feed.getItems().size() - items.size(),\n                                         feed.getItems().size(), true);\n                             }\n                         }, error -> {\n", "test_patch": "", "problem_statement": "Multi-select all below does not work on podcast page\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.5.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n14\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Open podcast page\r\n1. Multi-select all below\r\n2. Press \"mark as played\"\n\n### Expected behaviour\n\nAll get marked as played\n\n### Current behaviour\n\nOnly the ones that are already loaded get marked as played. The lazy loading on the podcast page should use a similar approach as the lazy loading on the \"all episodes\" or \"inbox\" page.\n\n### Logs\n\n_No response_\n", "hints_text": "This issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/back-to-the-same-podcast/5541/11\n", "created_at": "2025-01-15T20:00:17Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7613, "instance_id": "AntennaPod__AntennaPod-7613", "issue_numbers": ["7469"], "base_commit": "99a6c9628e4a8783665084fdffbe8253d485185a", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/SubscriptionsSection.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/SubscriptionsSection.java\nindex 04db12b2c0..80885b5ef7 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/SubscriptionsSection.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/SubscriptionsSection.java\n@@ -93,8 +93,10 @@ private void loadItems() {\n         }\n         SharedPreferences prefs = getContext().getSharedPreferences(StatisticsFragment.PREF_NAME, Context.MODE_PRIVATE);\n         boolean includeMarkedAsPlayed = prefs.getBoolean(StatisticsFragment.PREF_INCLUDE_MARKED_PLAYED, false);\n+\n+        long threeYearsAgo = System.currentTimeMillis() - 3L * 365L * 24L * 60L * 60L * 1000L;\n         disposable = Observable.fromCallable(() ->\n-                        DBReader.getStatistics(includeMarkedAsPlayed, 0, Long.MAX_VALUE).feedTime)\n+                        DBReader.getStatistics(includeMarkedAsPlayed, threeYearsAgo, Long.MAX_VALUE).feedTime)\n                 .subscribeOn(Schedulers.io())\n                 .observeOn(AndroidSchedulers.mainThread())\n                 .subscribe(statisticsData -> {\n", "test_patch": "", "problem_statement": "Make \"check your classics\" use recent plays only\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\r\n\r\n### App version\r\n\r\n3.5.0\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Feature or improvement you want\r\n\r\nLimit the \"check your classics\" section to the last 3 years\r\n\r\n### Why should this be added?\r\n\r\nI have a podcast that I listened to a lot. This podcast did not release any new episodes in the last 2\u00bd years. It can be considered dead. Still, it is shown prominently on the home screen. Maybe only taking into account the recent playbacks will make the section more relevant and also less \"static\", always looking the same \r\n\r\n### Screenshots / Drawings / Technical details\r\n\r\n_No response_\n", "hints_text": "This issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/needs-decision-meeting-updates/4169/12\n\nHi, I\u2019d like to work on this issue! I\u2019ll begin by implementing a filter to limit the \"Check Your Classics\" section to podcasts played in the last 3 years. If you have any additional suggestions or specific requirements, please let me know.\nThere already is a filter. You just need to adapt the start date from 0 to 3 years ago\nMaybe I'm missing something, but isn't the filter already set for containing only the last *2* years? https://github.com/AntennaPod/AntennaPod/blob/develop/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java#L1129\nThat's for random episodes, not for the classics section ", "created_at": "2025-01-15T19:47:14Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7610, "instance_id": "AntennaPod__AntennaPod-7610", "issue_numbers": ["7079"], "base_commit": "99a6c9628e4a8783665084fdffbe8253d485185a", "patch": "diff --git a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/FeedUpdateWorker.java b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/FeedUpdateWorker.java\nindex a62ded3a39..cd6954ac82 100644\n--- a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/FeedUpdateWorker.java\n+++ b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/FeedUpdateWorker.java\n@@ -123,7 +123,7 @@ private Notification createNotification(@Nullable List<Feed> toUpdate) {\n                 }\n             }\n         }\n-        return new NotificationCompat.Builder(context, NotificationUtils.CHANNEL_ID_DOWNLOADING)\n+        return new NotificationCompat.Builder(context, NotificationUtils.CHANNEL_ID_REFRESHING)\n                 .setContentTitle(context.getString(R.string.download_notification_title_feeds))\n                 .setContentText(contentText)\n                 .setStyle(new NotificationCompat.BigTextStyle().bigText(bigText))\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex ab23c0e47b..b04ba04da2 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -860,8 +860,10 @@\n     <string name=\"notification_group_news\">News</string>\n     <string name=\"notification_channel_user_action\">Action required</string>\n     <string name=\"notification_channel_user_action_description\">Shown if your action is required, for example if you need to enter a password.</string>\n-    <string name=\"notification_channel_downloading\">Downloading</string>\n-    <string name=\"notification_channel_downloading_description\">Shown while currently downloading.</string>\n+    <string name=\"notification_channel_downloading\">Downloading episodes</string>\n+    <string name=\"notification_channel_downloading_description\">Shown while currently downloading episodes.</string>\n+    <string name=\"notification_channel_refreshing\">Refreshing podcasts</string>\n+    <string name=\"notification_channel_refreshing_description\">Shown while checking for new episodes.</string>\n     <string name=\"notification_channel_playing\">Currently playing</string>\n     <string name=\"notification_channel_playing_description\">Allows to control playback. This is the main notification you see while playing a podcast.</string>\n     <string name=\"notification_channel_download_error\">Download failed</string>\ndiff --git a/ui/notifications/src/main/java/de/danoeh/antennapod/ui/notifications/NotificationUtils.java b/ui/notifications/src/main/java/de/danoeh/antennapod/ui/notifications/NotificationUtils.java\nindex 93cf6baf11..f16296d7b4 100644\n--- a/ui/notifications/src/main/java/de/danoeh/antennapod/ui/notifications/NotificationUtils.java\n+++ b/ui/notifications/src/main/java/de/danoeh/antennapod/ui/notifications/NotificationUtils.java\n@@ -14,6 +14,7 @@\n public class NotificationUtils {\n     public static final String CHANNEL_ID_USER_ACTION = \"user_action\";\n     public static final String CHANNEL_ID_DOWNLOADING = \"downloading\";\n+    public static final String CHANNEL_ID_REFRESHING = \"refreshing\";\n     public static final String CHANNEL_ID_PLAYING = \"playing\";\n     public static final String CHANNEL_ID_DOWNLOAD_ERROR = \"error\";\n     public static final String CHANNEL_ID_SYNC_ERROR = \"sync_error\";\n@@ -33,6 +34,7 @@ public static void createChannels(final Context context) {\n         final List<NotificationChannelCompat> channels = Arrays.asList(\n                 createChannelUserAction(context),\n                 createChannelDownloading(context),\n+                createChannelRefreshing(context),\n                 createChannelPlaying(context),\n                 createChannelError(context),\n                 createChannelSyncError(context),\n@@ -58,6 +60,15 @@ private static NotificationChannelCompat createChannelDownloading(final Context\n                 .build();\n     }\n \n+    private static NotificationChannelCompat createChannelRefreshing(final Context c) {\n+        return new NotificationChannelCompat.Builder(\n+                        CHANNEL_ID_REFRESHING, NotificationManagerCompat.IMPORTANCE_LOW)\n+                .setName(c.getString(R.string.notification_channel_refreshing))\n+                .setDescription(c.getString(R.string.notification_channel_refreshing_description))\n+                .setShowBadge(false)\n+                .build();\n+    }\n+\n     private static NotificationChannelCompat createChannelPlaying(final Context c) {\n         return new NotificationChannelCompat.Builder(\n                         CHANNEL_ID_PLAYING, NotificationManagerCompat.IMPORTANCE_LOW)\n", "test_patch": "", "problem_statement": "Separate 'Downloading' notification category into 'Downloading' (episodes) and 'Refreshing' (podcasts)\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\r\n\r\n### App version\r\n\r\n3.3\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Problem you may be having, or feature you want\r\n\r\nI don't care about seeing a notification about episode downloading because there's an in-app visual indicator for that, while I do care about feed refresh notifications. Also, the current notification category isn't clear about it covering also feed refreshes.\r\n\r\n### Suggested solution\r\n\r\nSplit 'Downloading' notification category into 'Downloading' (episodes) and 'Refreshing' (podcasts)\r\n\r\n| \u2139\ufe0f | **Implementation instructions**|\r\n|---|:---|\r\n| | This request has been discussed further below. If you're interested in implementing this, please see the  [conclusions relevant for implementation below](https://github.com/AntennaPod/AntennaPod/issues/7079#issuecomment-2124064775).<br><sub>The original post has been edited by the project maintainers to add this link.</sub> |\r\n\r\n### Screenshots / Drawings / Technical details\r\n\r\n_No response_\n", "hints_text": "I would have expected this to be used the other way around: to disable notifications for feed refresh but keep them for episodes. Why do you need to see the ones for feed refresh? The app also indicates that a feed refresh is ongoing \nReasoning:\r\n* discussion in #7070, although we would announce both episode downloads & feed refreshes, so both Android notifications can be/stay disabled together.\r\n* presence of in-app indicators, although such indicators exist in-app both for episode downloads & feed refreshes, so both notifications can be turned off in one go.\r\n\r\nAfter all the need isn't very big.\r\n\r\nThis can be implemented be considered if we drop the section headings also. Contributors are encouraged to build on #6387. (If not separating, we should at least adjust the title to say 'Downloading & refreshing\".)\nHello :) as i have gone through this issue . It seems there is a contributor who implemented talkback announcement for start and end episode downloads, but still we need to implement an in-app announcement notification for refresh of podcast right ? \r\n\r\nif so can i take this issue? :)\r\n\nThis issue is about separating the notification categories, not about the TalkBack announcements", "created_at": "2025-01-14T20:21:03Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7600, "instance_id": "AntennaPod__AntennaPod-7600", "issue_numbers": ["7591"], "base_commit": "93993c94ba4d9364d4d5d95638771a596fb7d29f", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\nindex 6daec087dc..7eb3600703 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n@@ -562,11 +562,11 @@ private void updateBottomNavigationBadgeIfNeeded() {\n     }\n \n     private final NavigationBarView.OnItemSelectedListener bottomItemSelectedListener = item -> {\n-        sheetBehavior.setState(BottomSheetBehavior.STATE_COLLAPSED);\n         if (item.getItemId() == R.id.bottom_navigation_more) {\n             showBottomNavigationMorePopup();\n             return false;\n         } else {\n+            sheetBehavior.setState(BottomSheetBehavior.STATE_COLLAPSED);\n             loadFragment(NavigationNames.getBottomNavigationFragmentTag(item.getItemId()), null);\n             return true;\n         }\n@@ -599,6 +599,7 @@ private void showBottomNavigationMorePopup() {\n         listPopupWindow.setAnchorView(bottomNavigationView);\n         listPopupWindow.setAdapter(new BottomNavigationMoreAdapter(this, popupMenuItems));\n         listPopupWindow.setOnItemClickListener((parent, view, position, id) -> {\n+            sheetBehavior.setState(BottomSheetBehavior.STATE_COLLAPSED);\n             if (position == popupMenuItems.size() - 1) {\n                 startActivity(new Intent(this, PreferenceActivity.class));\n             } else if (position == popupMenuItems.size() - 2) {\n", "test_patch": "", "problem_statement": "Opening bottom nav \"more\" menu collapses player\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.6.0\n\n### Android version\n\n13\n\n### Device model\n\nFP4\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Enable bottom navigation\r\n2. open expanded playback screen\r\n3. click to open the \"more\" menu in bottom navigation\n\n### Expected behaviour\n\nmenu overlays over expanded playback screen\n\n### Current behaviour\n\nplayback is collapsed to bottom view\r\n\r\n\r\nhttps://github.com/user-attachments/assets/8f86c33f-3c0e-4de0-a3f6-14ba26c17fa2\r\n\r\n\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2025-01-05T15:09:29Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7598, "instance_id": "AntennaPod__AntennaPod-7598", "issue_numbers": ["7276"], "base_commit": "93993c94ba4d9364d4d5d95638771a596fb7d29f", "patch": "diff --git a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\nindex 44044e84f0..a21e61e7af 100644\n--- a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\n+++ b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\n@@ -1862,7 +1862,9 @@ public void onPause() {\n         @Override\n         public void onStop() {\n             Log.d(TAG, \"onStop()\");\n-            mediaPlayer.stopPlayback(true);\n+            if (!mediaPlayer.isCasting()) {\n+                mediaPlayer.stopPlayback(true);\n+            }\n         }\n \n         @Override\n", "test_patch": "", "problem_statement": "Casting requires app restart\nEdit:\r\nI think I am able to consistently reproduce this issue. It may be related to dynamic advertisements.\r\nhttps://github.com/AntennaPod/AntennaPod/issues/7276#issuecomment-2352852693\r\n\r\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n### App version\r\n\r\n3.4.0\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Android version\r\n\r\n14 stock Build number AP2A.240605.024\r\n\r\n### Device model\r\n\r\nPixel 7\r\n\r\n### First occurred\r\n\r\nSeveral months or more ago\r\n\r\n### Steps to reproduce\r\n\r\n0. Do not use AntennaPod for several hours. I believe this happens once for the morning set of podcasts and once for the evening set of podcasts. Somewhat difficult to reproduce, but I believe I captured the correct logs.\r\n1. Have Pixel 7 and Pixel Tablet (and NVIDIA Shield) on the same WIFI network.\r\n2. Open AntennaPod, navigate to Queue.\r\n3. Tap the play icon on any podcast.\r\n4. Open the player by tapping on the bottom banner\r\n5. Tap on the cast icon.\r\n6. Select Pixel Tablet.\r\n\r\n### Expected behaviour\r\n\r\nPlayback stops on Pixel 7 AntennaPod app. Playback resumes on Pixel Tablet via casting feature.\r\n\r\n### Current behaviour\r\n\r\nPlayback stops on Pixel 7. Maybe a short burst of sound comes from the Pixel Tablet with the casting screen on, but playback immediately pauses. Playback cannot be resumed from the Pixel 7 AntennaPod app or Pixel Tablet casting screen. AntennaPod must be restarted.\r\n\r\nI only cast to my Pixel Tablet, I haven't tried with other casting devices. My NVIDIA Shield takes so long to turn on due to the TV setup and I'm not sure it would be useful to reproduce. \r\n\r\n### Logs\r\n[full-logs.txt](https://github.com/user-attachments/files/16090594/full-logs.txt)\r\n\r\n## Environment\r\nAndroid version: 14\r\nOS version: 5.10.198-android13-4-00047-g7a2aa337ab82-ab11664978\r\nAntennaPod version: 3.4.0\r\nModel: Pixel 7\r\nDevice: panther\r\nProduct: panther\r\n\r\n## Crash info\r\nTime: 28-05-2024 09:54:06\r\nAntennaPod version: 3.4.0\r\n\r\n## StackTrace\r\n```\r\njava.lang.NullPointerException: Attempt to invoke interface method 'void de.danoeh.antennapod.model.playback.Playable.onPlaybackPause(android.content.Context)' on a null object reference\r\n\tat de.danoeh.antennapod.playback.service.PlaybackService$3.onPlaybackPause(SourceFile:950)\r\n\tat de.danoeh.antennapod.playback.cast.CastPsmp.onRemoteMediaPlayerStatusUpdated(SourceFile:179)\r\n\tat de.danoeh.antennapod.playback.cast.CastPsmp.-$$Nest$monRemoteMediaPlayerStatusUpdated(SourceFile:0)\r\n\tat de.danoeh.antennapod.playback.cast.CastPsmp$1.onStatusUpdated(SourceFile:101)\r\n\tat com.google.android.gms.cast.framework.media.zzbp.zzm(SourceFile:6)\r\n\tat com.google.android.gms.cast.internal.zzas.zzaa(SourceFile:1)\r\n\tat com.google.android.gms.cast.internal.zzas.zzQ(SourceFile:63)\r\n\tat com.google.android.gms.cast.framework.media.RemoteMediaClient.onMessageReceived(SourceFile:1)\r\n\tat com.google.android.gms.cast.zzbq.run(SourceFile:4)\r\n\tat android.os.Handler.handleCallback(Handler.java:959)\r\n\tat android.os.Handler.dispatchMessage(Handler.java:100)\r\n\tat android.os.Looper.loopOnce(Looper.java:232)\r\n\tat android.os.Looper.loop(Looper.java:317)\r\n\tat android.app.ActivityThread.main(ActivityThread.java:8501)\r\n\tat java.lang.reflect.Method.invoke(Native Method)\r\n\tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:552)\r\n\tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:878)\r\n```\r\n\n", "hints_text": "Can echo this exact situation, only difference being that I cast to a Google Home Hub in my kitchen. Exactly the same results re: maybe a short burst of immediately stopped podcast, followed by a need to restart the app.\n\nPixel 7a here.\nI think this could be the result of dynamic advertisements at the start of the podcast episode.\r\n\r\nIn order to get to the casting button, I need to start the episode. After the episode is started, I can get to the player screen. In the brief moment before I can get to the cast button, I hear advertisement A. After casting (and restarting the app) advertisement B starts playing in the same spot.\r\n\r\nI can reproduce this consistently with the same podcast episode by starting and stopping casting.\nI had this bug as well and I noticed it was fixed for me by updating some relevant libraries. See #7428.\r\n\r\n@MicahParks @ckempo can you check if this fixes this bug for you as well?\n@Jesse-Bakker I can do that today or tomorrow. I've done some side loading before, but not with this project. Is there a set of instructions I can follow?\nI think I found an automated APK build here:\r\nhttps://github.com/AntennaPod/AntennaPod/actions/runs/11083537752?pr=7428\r\n\r\nI followed instructions from the wiki. I'll give it a try now.\r\nhttps://github.com/AntennaPod/AntennaPod/wiki/Getting-test-builds\n@Jesse-Bakker I installed the linked APK file and gave it a test. It seems the bug persists for me when the PR changes are included. \r\n\r\nThe podcast episode I used to test was:\r\nhttps://www.wsj.com/podcasts/opinion-potomac-watch/volodymyr-zelensky-visits-the-white-house-and-trump-tower/658681BA-733C-47BB-A853-BE94B4FAFB79\r\n\r\nIf anyone is curious, I did get different ads at the start of the episode when switching devices. When it started playing on my Pixel 7, it was an ad for Viking Cruises. When I switched to my Pixel Tablet, it switched to Claude from Anthropic. \nI cannot reproduce your problem. For me, the podcast you linked works fine now. I guess there's another bug in there somewhere\nI had started a new bug report as I missed this one. I also have this issue. I am casting to a Google Nest speaker. It happens for me on podcasts without adverts. Pixel 5. \nI thought I'd left a comment here but it seems not. The build @Jesse-Bakker produced worked for me - it was noticeable immediately upon trying to cast with the debug apk.\n\nI've opted to continue with the apk from the Play store, but the bug definitely persists there.\nOn my device, casting works perfectly fine. No need to restart the app. Could anyone maybe create a video showing the crash? Maybe I'm doing something in some slightly different order.\r\n\r\n> @Jesse-Bakker wrote in the PR: I got the idea that the problem might be in the androidx libraries because the containing fragment would just crash without an exception and without calling any lifecycle methods.\r\n\r\nThis seems very unusual. Crashes in the androidx libraries usually do generate a proper stack trace.\r\n\r\nTo be honest, I'm not fully convinced that upgrading the libraries really fixes anything. The first step \"Do not use AntennaPod for several hours\" was probably not followed after installing the build with upgraded dependencies. Is there anything in the library changelog that would indicate that there is a fix for something related? Usually upgrading dependencies opens several new bugs that are super hard to track down. So before we upgrade anything, we need to be really sure that the upgrade actually does fix something.\nHere you go:\r\n\r\nhttps://youtube.com/shorts/7x_tyuA5Nuk?si=wN6mr3aDvq2UiDXG\r\n\r\nI press play, cast to Chromecast, the active playing part disappears, reopen the app and it's back. \r\n\r\nDoes that help? \r\n\r\nIt happens every time without fail for me. I love with it because AntennaPod is so good otherwise \ud83d\ude00\nWow, your Chromecast connects so much faster than mine. Mine takes like 15 seconds before the icon in the toolbar gets filled.\r\n\r\nNow that I see your screen recording, I think I got this behavior one time after setting up the Chromecast again (only using it for AntennaPod testing). But it never happened again.\r\n\r\n> It happens every time without fail for me\r\n\r\nSo does it happen again if you just disconnect and reconnect? No waiting or restarting between attempts?\nActually, you are right. It doesn't happen if I disconnect and connect again straight away and without closing the app. \r\n\r\nIt does if I swipe away the app though. I managed to recreate it several times just now. \r\n\r\nAnd yes, it happens when I return to the app after several hours, but I presume this is similar to swiping the app away. \r\n\r\nYeah, it feels faster to connect than it used to be! Who knows!\nOnly other thought I had is that sometimes I can change the volume on the speaker (it is a nest audio speaker) with the rocker on the phone and sometimes I can't. Don't know if it is related but thought I would mention it. ", "created_at": "2025-01-05T14:54:40Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7597, "instance_id": "AntennaPod__AntennaPod-7597", "issue_numbers": ["7360"], "base_commit": "e4ac872b74f738b01cfc584d727d7326de10b892", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\nindex 6daec087dc..0d802da015 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n@@ -55,12 +55,15 @@\n import de.danoeh.antennapod.net.download.serviceinterface.FeedUpdateManager;\n import de.danoeh.antennapod.net.sync.serviceinterface.SynchronizationQueue;\n import de.danoeh.antennapod.playback.cast.CastEnabledActivity;\n+import de.danoeh.antennapod.playback.service.PlaybackServiceInterface;\n import de.danoeh.antennapod.storage.database.DBReader;\n import de.danoeh.antennapod.storage.importexport.AutomaticDatabaseExportWorker;\n+import de.danoeh.antennapod.storage.preferences.PlaybackPreferences;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import de.danoeh.antennapod.ui.TransitionEffect;\n import de.danoeh.antennapod.ui.appstartintent.MainActivityStarter;\n import de.danoeh.antennapod.ui.appstartintent.MediaButtonStarter;\n+import de.danoeh.antennapod.ui.common.IntentUtils;\n import de.danoeh.antennapod.ui.common.ThemeSwitcher;\n import de.danoeh.antennapod.ui.common.ThemeUtils;\n import de.danoeh.antennapod.ui.discovery.DiscoveryFragment;\n@@ -294,6 +297,11 @@ public void onStateChanged(@NonNull View view, int state) {\n                 onSlide(view, 0.0f);\n             } else if (state == BottomSheetBehavior.STATE_EXPANDED) {\n                 onSlide(view, 1.0f);\n+            } else if (state == BottomSheetBehavior.STATE_HIDDEN) {\n+                IntentUtils.sendLocalBroadcast(MainActivity.this,\n+                        PlaybackServiceInterface.ACTION_SHUTDOWN_PLAYBACK_SERVICE);\n+                PlaybackPreferences.writeNoMediaPlaying();\n+                setPlayerVisible(false);\n             }\n         }\n \n@@ -386,6 +394,7 @@ public void setPlayerVisible(boolean visible) {\n         params.setMargins(systemBarInsets.left, 0, systemBarInsets.right, (visible ? externalPlayerHeight : 0));\n         mainView.setLayoutParams(params);\n         sheetBehavior.setPeekHeight(externalPlayerHeight);\n+        sheetBehavior.setHideable(true);\n         sheetBehavior.setGestureInsetBottomIgnored(true);\n \n         FragmentContainerView playerView = findViewById(R.id.playerFragment);\n", "test_patch": "", "problem_statement": "A way to stop playback\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.4.1\n\n### Where did you get the app from\n\nGoogle Play\n\n### Feature or improvement you want\n\nI would really appreciate a way to fully stop playback. Currently, if an episode is in-progress, there's no way to remove it from the UI without clearing the queue and deleting the episode - which also removes it from the history.\r\n\r\n\r\n\r\nI would be happy with a dedicated stop button, but I realize there are people who wouldn't appreciate that. Plexamp's solution is that pressing and holding on the pause button stops playback; I think that could work nicely.\n\n### Why should this be added?\n\nSome of my devices like to issue \"start playback\" commands when they power up, and I have no control over that. Some of the things I listen to require very different volume settings, so it's important to avoid being deafened by my favorite podcast hosts.\r\n\r\nA separate reason is that some topics are triggering, and users may appreciate the ability to remove something from their view that they may find disturbing later on.\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "", "created_at": "2025-01-05T11:03:38Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7595, "instance_id": "AntennaPod__AntennaPod-7595", "issue_numbers": ["7585"], "base_commit": "fa10cb491db8de7088a728b0c37804cbb2514625", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/UserInterfacePreferencesFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/UserInterfacePreferencesFragment.java\nindex 1b1bd7d87e..e1e3e4a153 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/UserInterfacePreferencesFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/UserInterfacePreferencesFragment.java\n@@ -34,6 +34,7 @@ public class UserInterfacePreferencesFragment extends AnimatedPreferenceFragment\n     public void onCreatePreferences(Bundle savedInstanceState, String rootKey) {\n         addPreferencesFromResource(R.xml.preferences_user_interface);\n         setupInterfaceScreen();\n+        backOpensDrawerToggle(UserPreferences.isBottomNavigationEnabled());\n     }\n \n     @Override\n@@ -94,6 +95,17 @@ private void setupInterfaceScreen() {\n         if (Build.VERSION.SDK_INT >= 26) {\n             findPreference(UserPreferences.PREF_EXPANDED_NOTIFICATION).setVisible(false);\n         }\n+\n+        findPreference(UserPreferences.PREF_BOTTOM_NAVIGATION).setOnPreferenceChangeListener((preference, newValue) -> {\n+            if (newValue instanceof Boolean) {\n+                backOpensDrawerToggle((Boolean) newValue);\n+            }\n+            return true;\n+        });\n+    }\n+\n+    private void backOpensDrawerToggle(boolean bottomNavigationEnabled) {\n+        findPreference(UserPreferences.PREF_BACK_OPENS_DRAWER).setEnabled(!bottomNavigationEnabled);\n     }\n \n     private void showFullNotificationButtonsDialog() {\n", "test_patch": "", "problem_statement": "Disable 'Back button opens drawer' if Bottom menu is enabled\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.6.0\n\n### Feature or improvement you want\n\nIf the setting 'Bottom navigation' is enabled, the setting 'Back button opens drawer' should be greyed out.\n\n### Why should this be added?\n\nIf 'Bottom navigation' is enabled, the side menu doesn't open when pressing the back button, even if the other setting is enabled. That's a little confusing.\n\n### Screenshots / Drawings / Technical details\n\nAs shared here: https://chaos.social/@Schaarsen/113753113136219459\n", "hints_text": "", "created_at": "2025-01-04T21:32:02Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7587, "instance_id": "AntennaPod__AntennaPod-7587", "issue_numbers": ["7576"], "base_commit": "fe7d13f53c67dc627a87d1cdcb18fb6689a0b886", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedInfoFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedInfoFragment.java\nindex a2cda28d88..d5f2d852ce 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedInfoFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedInfoFragment.java\n@@ -30,9 +30,11 @@\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n import de.danoeh.antennapod.databinding.FeedinfoBinding;\n+import de.danoeh.antennapod.storage.database.DBWriter;\n import de.danoeh.antennapod.ui.TransitionEffect;\n import de.danoeh.antennapod.storage.database.DBReader;\n import de.danoeh.antennapod.storage.database.FeedDatabaseWriter;\n+import de.danoeh.antennapod.ui.appstartintent.MainActivityStarter;\n import de.danoeh.antennapod.ui.common.IntentUtils;\n import de.danoeh.antennapod.ui.share.ShareUtils;\n import de.danoeh.antennapod.ui.cleaner.HtmlToPlainText;\n@@ -247,6 +249,14 @@ private void showFeed() {\n             viewBinding.statisticsFragmentContainer.setVisibility(View.GONE);\n             viewBinding.supportHeadingLabel.setVisibility(View.GONE);\n             viewBinding.supportUrl.setVisibility(View.GONE);\n+            viewBinding.header.butSubscribe.setVisibility(View.VISIBLE);\n+            viewBinding.header.butSubscribe.setOnClickListener(view -> {\n+                DBWriter.setFeedState(getContext(), feed, Feed.STATE_SUBSCRIBED);\n+                MainActivityStarter mainActivityStarter = new MainActivityStarter(getContext());\n+                mainActivityStarter.withOpenFeed(feed.getId());\n+                getActivity().finish();\n+                startActivity(mainActivityStarter.getIntent());\n+            });\n         }\n \n         refreshToolbarState();\ndiff --git a/app/src/main/res/layout/feedinfo.xml b/app/src/main/res/layout/feedinfo.xml\nindex 5ff462fa9f..ec5f9367a9 100644\n--- a/app/src/main/res/layout/feedinfo.xml\n+++ b/app/src/main/res/layout/feedinfo.xml\n@@ -16,10 +16,9 @@\n             android:id=\"@+id/collapsing_toolbar\"\n             android:layout_width=\"match_parent\"\n             android:layout_height=\"match_parent\"\n-            android:background=\"?android:attr/colorBackground\"\n-            app:contentScrim=\"?android:attr/colorBackground\"\n-            app:layout_scrollFlags=\"scroll|exitUntilCollapsed\"\n-            app:scrimAnimationDuration=\"200\">\n+            app:scrimAnimationDuration=\"200\"\n+            app:titleEnabled=\"false\"\n+            app:layout_scrollFlags=\"scroll|exitUntilCollapsed\">\n \n             <ImageView\n                 android:id=\"@+id/imgvBackground\"\ndiff --git a/app/src/main/res/layout/feeditemlist_header.xml b/app/src/main/res/layout/feeditemlist_header.xml\nindex 8fa5aebc12..b5efafc175 100644\n--- a/app/src/main/res/layout/feeditemlist_header.xml\n+++ b/app/src/main/res/layout/feeditemlist_header.xml\n@@ -220,7 +220,7 @@\n         <TextView\n             android:layout_width=\"wrap_content\"\n             android:layout_height=\"wrap_content\"\n-            android:layout_marginBottom=\"8dp\"\n+            android:layout_marginBottom=\"4dp\"\n             android:text=\"@string/description_label\"\n             style=\"@style/TextAppearance.Material3.TitleMedium\" />\n \n@@ -233,14 +233,14 @@\n             android:maxLines=\"3\"\n             android:layout_marginBottom=\"16dp\"\n             android:background=\"?android:attr/selectableItemBackground\"\n-            style=\"@style/AntennaPod.TextView.ListItemBody\"\n+            style=\"@style/TextAppearance.Material3.BodyMedium\"\n             tools:text=\"@string/design_time_lorem_ipsum\" />\n \n         <TextView\n             android:layout_width=\"wrap_content\"\n             android:layout_height=\"wrap_content\"\n             android:text=\"@string/preview_episodes\"\n-            android:layout_marginBottom=\"8dp\"\n+            android:layout_marginBottom=\"4dp\"\n             style=\"@style/TextAppearance.Material3.TitleMedium\" />\n \n     </LinearLayout>\ndiff --git a/ui/common/src/main/res/values/styles.xml b/ui/common/src/main/res/values/styles.xml\nindex 3026ba7042..a015522ead 100644\n--- a/ui/common/src/main/res/values/styles.xml\n+++ b/ui/common/src/main/res/values/styles.xml\n@@ -271,12 +271,6 @@\n         <item name=\"android:ellipsize\">end</item>\n     </style>\n \n-    <style name=\"AntennaPod.TextView.ListItemBody\" parent=\"@style/TextAppearance.Material3.BodyMedium\">\n-        <item name=\"android:textColor\">?attr/colorOnSurfaceVariant</item>\n-        <item name=\"lineHeight\">18sp</item>\n-        <item name=\"android:lineHeight\" tools:targetApi=\"p\">18sp</item>\n-    </style>\n-\n     <style name=\"OutlinedButtonBetterContrast\" parent=\"Widget.Material3.Button.OutlinedButton\">\n         <item name=\"backgroundTint\">@color/button_bg_selector</item>\n     </style>\n", "test_patch": "", "problem_statement": "Unexpected difference in text formatting/spacing when moving between podcast preview screens\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.6.0\n\n### Android version\n\n12\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Open the podcast preview screen (i.e. the screen from where you can subscribe to new podcasts): notice that the text under \"Description\" is in grey font and with a certain line/paragraph spacing.\r\n2. Tap on the description to expand the text.\n\n### Expected behaviour\n\n3. Font colour and line/paragraph spacing remain as on the previous screen - only the amount of text available is expanded.\n\n### Current behaviour\n\n3. The text of the expanded description is in white font and the line/paragraph spacing is different, causing the text to \"jump\".\n\n### Logs\n\n_No response_\n", "hints_text": "We recently decided to remove the \"description\" heading from the feed info page. If we stick to that decision, there is no way to make it not jump.", "created_at": "2025-01-01T16:43:36Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7569, "instance_id": "AntennaPod__AntennaPod-7569", "issue_numbers": ["7012"], "base_commit": "fd72f8641761b696227e49a34fa6eae5a93f2fcc", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java\nindex 27bd0ccb42..f8e2bc2f26 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java\n@@ -370,7 +370,8 @@ public CompletedDownloadsListAdapter(MainActivity mainActivity) {\n         @Override\n         public void afterBindViewHolder(EpisodeItemViewHolder holder, int pos) {\n             if (!inActionMode()) {\n-                if (holder.getFeedItem().isDownloaded()) {\n+                if (holder.getFeedItem().isDownloaded()\n+                        && !UserPreferences.shouldDownloadsButtonActionPlay()) {\n                     DeleteActionButton actionButton = new DeleteActionButton(getItem(pos));\n                     actionButton.configure(holder.secondaryActionButton, holder.secondaryActionIcon, getActivity());\n                 }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/PlaybackPreferencesFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/PlaybackPreferencesFragment.java\nindex 5f67e82831..b84a37a80d 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/PlaybackPreferencesFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/PlaybackPreferencesFragment.java\n@@ -9,20 +9,17 @@\n import androidx.preference.ListPreference;\n import androidx.preference.Preference;\n import de.danoeh.antennapod.R;\n-import de.danoeh.antennapod.event.UnreadItemsUpdateEvent;\n-import de.danoeh.antennapod.storage.preferences.UsageStatistics;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import de.danoeh.antennapod.ui.preferences.screen.AnimatedPreferenceFragment;\n import de.danoeh.antennapod.ui.screen.feed.preferences.SkipPreferenceDialog;\n import de.danoeh.antennapod.ui.screen.playback.VariableSpeedDialog;\n+\n import java.util.Map;\n-import org.greenrobot.eventbus.EventBus;\n \n public class PlaybackPreferencesFragment extends AnimatedPreferenceFragment {\n     private static final String PREF_PLAYBACK_SPEED_LAUNCHER = \"prefPlaybackSpeedLauncher\";\n     private static final String PREF_PLAYBACK_REWIND_DELTA_LAUNCHER = \"prefPlaybackRewindDeltaLauncher\";\n     private static final String PREF_PLAYBACK_FAST_FORWARD_DELTA_LAUNCHER = \"prefPlaybackFastForwardDeltaLauncher\";\n-    private static final String PREF_PLAYBACK_PREFER_STREAMING = \"prefStreamOverDownload\";\n \n     @Override\n     public void onCreatePreferences(Bundle savedInstanceState, String rootKey) {\n@@ -53,13 +50,6 @@ private void setupPlaybackScreen() {\n             SkipPreferenceDialog.showSkipPreference(activity, SkipPreferenceDialog.SkipDirection.SKIP_FORWARD, null);\n             return true;\n         });\n-        findPreference(PREF_PLAYBACK_PREFER_STREAMING).setOnPreferenceChangeListener((preference, newValue) -> {\n-            // Update all visible lists to reflect new streaming action button\n-            EventBus.getDefault().post(new UnreadItemsUpdateEvent());\n-            // User consciously decided whether to prefer the streaming button, disable suggestion to change that\n-            UsageStatistics.doNotAskAgain(UsageStatistics.ACTION_STREAM);\n-            return true;\n-        });\n         if (Build.VERSION.SDK_INT >= 31) {\n             findPreference(UserPreferences.PREF_UNPAUSE_ON_HEADSET_RECONNECT).setVisible(false);\n             findPreference(UserPreferences.PREF_UNPAUSE_ON_BLUETOOTH_RECONNECT).setVisible(false);\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/UserInterfacePreferencesFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/UserInterfacePreferencesFragment.java\nindex 1b1bd7d87e..6c0f94abce 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/UserInterfacePreferencesFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/UserInterfacePreferencesFragment.java\n@@ -14,6 +14,7 @@\n import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import com.google.android.material.snackbar.Snackbar;\n \n+import de.danoeh.antennapod.storage.preferences.UsageStatistics;\n import de.danoeh.antennapod.ui.preferences.screen.AnimatedPreferenceFragment;\n import de.danoeh.antennapod.ui.screen.subscriptions.FeedSortDialog;\n import org.greenrobot.eventbus.EventBus;\n@@ -90,6 +91,14 @@ private void setupInterfaceScreen() {\n                     ((PreferenceActivity) getActivity()).openScreen(R.xml.preferences_swipe);\n                     return true;\n                 });\n+        findPreference(UserPreferences.PREF_STREAM_OVER_DOWNLOAD)\n+                .setOnPreferenceChangeListener((preference, newValue) -> {\n+                    // Update all visible lists to reflect new streaming action button\n+                    EventBus.getDefault().post(new UnreadItemsUpdateEvent());\n+                    // User consciously decided whether to prefer the streaming button, disable suggestion\n+                    UsageStatistics.doNotAskAgain(UsageStatistics.ACTION_STREAM);\n+                    return true;\n+                });\n \n         if (Build.VERSION.SDK_INT >= 26) {\n             findPreference(UserPreferences.PREF_EXPANDED_NOTIFICATION).setVisible(false);\ndiff --git a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\nindex 0162f52bcc..7bbfdf9448 100644\n--- a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n+++ b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n@@ -112,6 +112,7 @@ public abstract class UserPreferences {\n     // Other\n     private static final String PREF_DATA_FOLDER = \"prefDataFolder\";\n     public static final String PREF_DELETE_REMOVES_FROM_QUEUE = \"prefDeleteRemovesFromQueue\";\n+    public static final String PREF_DOWNLOADS_BUTTON_ACTION = \"prefDownloadsButtonAction\";\n     private static final String PREF_AUTOMATIC_EXPORT_FOLDER = \"prefAutomaticExportFolder\";\n \n     // Mediaplayer\n@@ -423,6 +424,10 @@ public static boolean shouldDeleteRemoveFromQueue() {\n         return prefs.getBoolean(PREF_DELETE_REMOVES_FROM_QUEUE, false);\n     }\n \n+    public static boolean shouldDownloadsButtonActionPlay() {\n+        return prefs.getBoolean(PREF_DOWNLOADS_BUTTON_ACTION, false);\n+    }\n+\n     public static float getPlaybackSpeed() {\n         try {\n             return Float.parseFloat(prefs.getString(PREF_PLAYBACK_SPEED, \"1.00\"));\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 691267f1f0..0d4f0d81c6 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -521,6 +521,7 @@\n     <string name=\"pref_enqueue_downloaded_summary\">Add downloaded episodes to the queue</string>\n     <string name=\"pref_skip_silence_title\">Skip silence in audio</string>\n     <string name=\"behavior\">Behavior</string>\n+    <string name=\"episode_lists\">Episode lists</string>\n     <string name=\"pref_default_page\">Default page</string>\n     <string name=\"pref_default_page_sum\">Screen that is opened when starting AntennaPod</string>\n     <string name=\"pref_back_button_opens_drawer\">Back button opens drawer</string>\n@@ -528,6 +529,8 @@\n     <string name=\"remember_last_page\">Remember last page</string>\n     <string name=\"pref_delete_removes_from_queue_title\">Delete removes from queue</string>\n     <string name=\"pref_delete_removes_from_queue_sum\">Automatically remove an episode from the queue when it is deleted</string>\n+    <string name=\"pref_downloads_button_action_title\">Play from downloads screen</string>\n+    <string name=\"pref_downloads_button_action_sum\">Display play button instead of delete button on downloads screen</string>\n     <string name=\"pref_filter_feed_title\">Subscription filter</string>\n     <string name=\"pref_filter_feed_sum\">Filter your subscriptions in navigation drawer and subscriptions screen</string>\n     <string name=\"subscriptions_counter_greater_zero\">Counter greater than zero</string>\ndiff --git a/ui/preferences/src/main/res/xml/preferences_playback.xml b/ui/preferences/src/main/res/xml/preferences_playback.xml\nindex 4cf65b3eb4..b97bc6e78b 100644\n--- a/ui/preferences/src/main/res/xml/preferences_playback.xml\n+++ b/ui/preferences/src/main/res/xml/preferences_playback.xml\n@@ -43,11 +43,6 @@\n                 android:key=\"prefPlaybackSpeedLauncher\"\n                 android:summary=\"@string/pref_playback_speed_sum\"\n                 android:title=\"@string/playback_speed\"/>\n-        <SwitchPreferenceCompat\n-                android:defaultValue=\"false\"\n-                android:key=\"prefStreamOverDownload\"\n-                android:summary=\"@string/pref_stream_over_download_sum\"\n-                android:title=\"@string/pref_stream_over_download_title\"/>\n     </PreferenceCategory>\n \n     <PreferenceCategory android:title=\"@string/reassign_hardware_buttons\">\ndiff --git a/ui/preferences/src/main/res/xml/preferences_user_interface.xml b/ui/preferences/src/main/res/xml/preferences_user_interface.xml\nindex 1b3aad4765..e00bc0d13d 100644\n--- a/ui/preferences/src/main/res/xml/preferences_user_interface.xml\n+++ b/ui/preferences/src/main/res/xml/preferences_user_interface.xml\n@@ -93,9 +93,22 @@\n                 android:title=\"@string/pref_back_button_opens_drawer\"\n                 android:summary=\"@string/pref_back_button_opens_drawer_summary\"\n                 android:defaultValue=\"false\"/>\n+    </PreferenceCategory>\n+    <PreferenceCategory android:title=\"@string/episode_lists\">\n         <Preference\n                 android:key=\"prefSwipe\"\n                 android:summary=\"@string/swipeactions_summary\"\n                 android:title=\"@string/swipeactions_label\"/>\n+        <SwitchPreferenceCompat\n+                android:defaultValue=\"false\"\n+                android:key=\"prefStreamOverDownload\"\n+                android:summary=\"@string/pref_stream_over_download_sum\"\n+                android:title=\"@string/pref_stream_over_download_title\"/>\n+        <SwitchPreferenceCompat\n+                android:defaultValue=\"false\"\n+                android:enabled=\"true\"\n+                android:key=\"prefDownloadsButtonAction\"\n+                android:summary=\"@string/pref_downloads_button_action_sum\"\n+                android:title=\"@string/pref_downloads_button_action_title\"/>\n     </PreferenceCategory>\n </PreferenceScreen>\n", "test_patch": "", "problem_statement": "Allow customization of button on downloaded podcast\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\r\n\r\n### App version\r\n\r\n3.2.0\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Problem you may be having, or feature you want\r\n\r\nIt is cumbersome to play downloaded podcasts from the Downloads screen.  I find it ergonomic to interact with my podcasts from the Downloads page, since the list is shorter, and they are the episodes that have already been selected from the much longer list of all episodes.  But I have to descend into the episode detail view to play it, which adds extra taps.  It's also very easy to accidentally delete podcasts from downloads.  The queue isn't a viable solution for me, since I use it to curate a list of multiple episodes for continuous play; playing an episode from Downloads plays a single episode and stops (which is desirable for me).\r\n\r\n### Suggested solution\r\n\r\nAllow the button on the right side of each downloaded item to be optionally configured to be a play button, rather than a delete button.  Deletion is still available from the long-press menu, and this makes it harder to delete downloaded podcasts by accident, given the lack of a deletion confirmation modal.  This should maintain the behavior of playing a single episode (as if played from the episode detail view) and not leading into queued episodes.\r\n\r\n| \u2139\ufe0f | **Implementation instructions**|\r\n|---|:---|\r\n| | This request has been discussed further below. If you're interested in implementing this, please see the  [conclusions relevant for implementation below](https://github.com/AntennaPod/AntennaPod/issues/7012#issuecomment-2552220347).<br><sub>The original post has been edited by the project maintainers to add this link.</sub> |\r\n\r\n### Screenshots / Drawings / Technical details\r\n\r\n_No response_\n", "hints_text": "Yeah grave usability fail, lol.\r\nAlso, downloaded episodes are barely distinguishable from the queue or episode lists..\nWe discussed at the `Needs: Decision` meeting. We don't think it's high priority, because it's manage the episodes on the device and the queue and episode screens are intended for initiating playback.\r\n\r\nHowever, **what we're open to** is adapting Setting > Playback > Prefer streaming, such that it is similar to the swipe actions setting:\r\n* sub-setting per screen\r\n* for each of the screens allow the user to pick between Download/Play (depending on episode status), Stream, Delete\nA few months later, I'm not sure about this anymore. I think we should discuss again. Using just \"play/download/stream\" everywhere would need fewer settings, and people could still configure the swipe actions accordingly.", "created_at": "2024-12-23T11:36:08Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7565, "instance_id": "AntennaPod__AntennaPod-7565", "issue_numbers": ["7498"], "base_commit": "8285cafa6315d26f824c65da74fb5c845139401d", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/drawer/NavDrawerFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/drawer/NavDrawerFragment.java\nindex 81d58c5145b..9dc11464cdb 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/drawer/NavDrawerFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/drawer/NavDrawerFragment.java\n@@ -2,6 +2,7 @@\n \n import android.app.Activity;\n import android.content.Context;\n+import android.content.DialogInterface;\n import android.content.Intent;\n import android.content.SharedPreferences;\n import android.content.res.ColorStateList;\n@@ -32,7 +33,10 @@\n import com.google.android.material.shape.MaterialShapeDrawable;\n import com.google.android.material.shape.ShapeAppearanceModel;\n \n+import de.danoeh.antennapod.model.feed.FeedPreferences;\n import de.danoeh.antennapod.net.download.service.episode.autodownload.EpisodeCleanupAlgorithmFactory;\n+import de.danoeh.antennapod.storage.database.DBWriter;\n+import de.danoeh.antennapod.ui.common.ConfirmationDialog;\n import de.danoeh.antennapod.ui.screen.subscriptions.FeedMenuHandler;\n import org.apache.commons.lang3.StringUtils;\n import org.greenrobot.eventbus.EventBus;\n@@ -204,6 +208,25 @@ private boolean onTagContextMenuClicked(NavDrawerData.DrawerItem drawerItem, Men\n         final int itemId = item.getItemId();\n         if (itemId == R.id.rename_folder_item) {\n             new RenameFeedDialog(getActivity(), drawerItem).show();\n+            return true;\n+        } else if (itemId == R.id.delete_folder_item) {\n+            ConfirmationDialog dialog = new ConfirmationDialog(\n+                    getContext(), R.string.delete_tag_label,\n+                    getString(R.string.delete_tag_confirmation, drawerItem.getTitle())) {\n+\n+                @Override\n+                public void onConfirmButtonPressed(DialogInterface dialog) {\n+                    List<NavDrawerData.DrawerItem> feeds = ((NavDrawerData.TagDrawerItem) drawerItem).getChildren();\n+\n+                    for (NavDrawerData.DrawerItem feed : feeds) {\n+                        FeedPreferences preferences = ((NavDrawerData.FeedDrawerItem) feed).feed.getPreferences();\n+                        preferences.getTags().remove(drawerItem.getTitle());\n+                        DBWriter.setFeedPreferences(preferences);\n+                    }\n+                }\n+            };\n+            dialog.createNewDialog().show();\n+\n             return true;\n         }\n         return super.onContextItemSelected(item);\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/SubscriptionFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/SubscriptionFragment.java\nindex 68c98ce0dbd..261723d0557 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/SubscriptionFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/SubscriptionFragment.java\n@@ -1,6 +1,7 @@\n package de.danoeh.antennapod.ui.screen.subscriptions;\n \n import android.content.Context;\n+import android.content.DialogInterface;\n import android.content.SharedPreferences;\n import android.os.Bundle;\n import android.util.Log;\n@@ -20,6 +21,9 @@\n import com.google.android.material.appbar.MaterialToolbar;\n import com.google.android.material.floatingactionbutton.FloatingActionButton;\n \n+import de.danoeh.antennapod.model.feed.FeedPreferences;\n+import de.danoeh.antennapod.storage.database.DBWriter;\n+import de.danoeh.antennapod.ui.common.ConfirmationDialog;\n import de.danoeh.antennapod.ui.screen.AddFeedFragment;\n import de.danoeh.antennapod.ui.screen.SearchFragment;\n import de.danoeh.antennapod.net.download.serviceinterface.FeedUpdateManager;\n@@ -348,9 +352,30 @@ public boolean onContextItemSelected(MenuItem item) {\n             return false;\n         }\n         int itemId = item.getItemId();\n-        if (drawerItem.type == NavDrawerData.DrawerItem.Type.TAG && itemId == R.id.rename_folder_item) {\n-            new RenameFeedDialog(getActivity(), drawerItem).show();\n-            return true;\n+        if (drawerItem.type == NavDrawerData.DrawerItem.Type.TAG) {\n+            if (itemId == R.id.rename_folder_item) {\n+                new RenameFeedDialog(getActivity(), drawerItem).show();\n+                return true;\n+            } else if (itemId == R.id.delete_folder_item) {\n+                ConfirmationDialog dialog = new ConfirmationDialog(\n+                        getContext(), R.string.delete_tag_label,\n+                        getString(R.string.delete_tag_confirmation, drawerItem.getTitle())) {\n+\n+                    @Override\n+                    public void onConfirmButtonPressed(DialogInterface dialog) {\n+                        List<NavDrawerData.DrawerItem> feeds = ((NavDrawerData.TagDrawerItem) drawerItem).getChildren();\n+\n+                        for (NavDrawerData.DrawerItem feed : feeds) {\n+                            FeedPreferences preferences = ((NavDrawerData.FeedDrawerItem) feed).feed.getPreferences();\n+                            preferences.getTags().remove(drawerItem.getTitle());\n+                            DBWriter.setFeedPreferences(preferences);\n+                        }\n+                    }\n+                };\n+                dialog.createNewDialog().show();\n+\n+                return true;\n+            }\n         }\n \n         Feed feed = ((NavDrawerData.FeedDrawerItem) drawerItem).feed;\ndiff --git a/app/src/main/res/menu/nav_folder_context.xml b/app/src/main/res/menu/nav_folder_context.xml\nindex eb6515bed8f..a3136d6eb3c 100644\n--- a/app/src/main/res/menu/nav_folder_context.xml\n+++ b/app/src/main/res/menu/nav_folder_context.xml\n@@ -4,4 +4,8 @@\n         android:id=\"@+id/rename_folder_item\"\n         android:menuCategory=\"container\"\n         android:title=\"@string/rename_tag_label\" />\n+    <item\n+        android:id=\"@+id/delete_folder_item\"\n+        android:menuCategory=\"container\"\n+        android:title=\"@string/delete_tag_label\" />\n </menu>\n\\ No newline at end of file\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 8d72e1c239b..ccdd96a807e 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -213,6 +213,8 @@\n     <string name=\"edit_tags\">Edit tags</string>\n     <string name=\"add_tag\">Add tag</string>\n     <string name=\"rename_tag_label\">Rename tag</string>\n+    <string name=\"delete_tag_label\">Delete tag</string>\n+    <string name=\"delete_tag_confirmation\">Please confirm that you want to delete the tag \\\"%1$s\\\".</string>\n     <string name=\"confirm_mobile_feed_refresh_dialog_message\">Refreshing podcasts over mobile data connection is disabled in the settings.\\n\\nDo you want to refresh anyway?</string>\n     <string name=\"confirm_mobile_feed_refresh_dialog_message_vpn\">Your VPN app pretends to be a mobile network (metered connection). Refreshing podcasts over mobile data connection is disabled in the settings.\\n\\nDo you want to refresh anyway? If you want this problem to be fixed, contact the creators of your VPN app.</string>\n     <string name=\"delete_downloads_played\">Delete played</string>\n", "test_patch": "", "problem_statement": "Allow deleting tags by long-pressing\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.5.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Feature or improvement you want\n\nLong-pressing can already rename tags. It would be consistent to also allow deleting them.\n\n### Why should this be added?\n\nMulti-select to delete tags from their subscriptions is a bit harder to find: https://forum.antennapod.org/t/cant-delete-tags/5685 \n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "This issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/cant-delete-tags/5685/8\n\nIf a person wants to delete a tag, do we have to offer an option to merge the subscription with another tag?\n\nI can see wanting to delete tag XYZ and wanting every subscription to move over to tag ABC (ABC already exists)\nYou already have two options to do that:\r\n- multi-select all in the tag and add the new one\r\n- rename the tag to the name of the existing tag (tags are not actually things that exist on their own - they are just strings associated to a subscription)\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/needs-decision-meeting-updates/4169/12\n", "created_at": "2024-12-17T20:34:23Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7562, "instance_id": "AntennaPod__AntennaPod-7562", "issue_numbers": ["6493"], "base_commit": "575173e022f536acad7ad8ed037f355d8b9f483b", "patch": "diff --git a/playback/cast/build.gradle b/playback/cast/build.gradle\nindex ac5de0e6b56..199c9ec6d37 100644\n--- a/playback/cast/build.gradle\n+++ b/playback/cast/build.gradle\n@@ -12,6 +12,7 @@ dependencies {\n     implementation project(':event')\n     implementation project(':model')\n     implementation project(':playback:base')\n+    implementation project(':ui:episodes')\n \n     annotationProcessor \"androidx.annotation:annotation:$annotationVersion\"\n     implementation \"androidx.appcompat:appcompat:$appcompatVersion\"\ndiff --git a/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastPsmp.java b/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastPsmp.java\nindex fd70fa18cf1..07a3639d962 100644\n--- a/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastPsmp.java\n+++ b/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastPsmp.java\n@@ -25,6 +25,7 @@\n import com.google.android.gms.common.GoogleApiAvailability;\n import de.danoeh.antennapod.event.PlayerErrorEvent;\n import de.danoeh.antennapod.event.playback.BufferUpdateEvent;\n+import de.danoeh.antennapod.event.playback.SpeedChangedEvent;\n import de.danoeh.antennapod.model.feed.FeedMedia;\n import de.danoeh.antennapod.model.playback.MediaType;\n import de.danoeh.antennapod.model.playback.Playable;\n@@ -32,6 +33,7 @@\n import de.danoeh.antennapod.playback.base.PlaybackServiceMediaPlayer;\n import de.danoeh.antennapod.playback.base.PlayerStatus;\n import de.danoeh.antennapod.playback.base.RewindAfterPauseUtils;\n+import de.danoeh.antennapod.ui.episodes.PlaybackSpeedUtils;\n import org.greenrobot.eventbus.EventBus;\n \n /**\n@@ -103,7 +105,7 @@ public void onStatusUpdated() {\n \n         @Override\n         public void onMediaError(@NonNull MediaError mediaError) {\n-            EventBus.getDefault().post(new PlayerErrorEvent(mediaError.getReason()));\n+            EventBus.getDefault().postSticky(new PlayerErrorEvent(mediaError.getReason()));\n         }\n     };\n \n@@ -182,6 +184,7 @@ private void onRemoteMediaPlayerStatusUpdated() {\n         }\n \n         setBuffering(state == MediaStatus.PLAYER_STATE_BUFFERING);\n+        setPlaybackParams(PlaybackSpeedUtils.getCurrentPlaybackSpeed(currentMedia), false);\n \n         switch (state) {\n             case MediaStatus.PLAYER_STATE_PLAYING:\n@@ -240,7 +243,7 @@ private void onRemoteMediaPlayerStatusUpdated() {\n                     case MediaStatus.IDLE_REASON_ERROR:\n                         Log.w(TAG, \"Got an error status from the Chromecast. \"\n                                 + \"Skipping, if possible, to the next episode...\");\n-                        EventBus.getDefault().post(new PlayerErrorEvent(\"Chromecast error code 1\"));\n+                        EventBus.getDefault().postSticky(new PlayerErrorEvent(\"Chromecast error code 1\"));\n                         endPlayback(false, false, true, true);\n                         return;\n                     default:\n@@ -281,7 +284,7 @@ private void playMediaObject(@NonNull final Playable playable, final boolean for\n                          final boolean stream, final boolean startWhenPrepared, final boolean prepareImmediately) {\n         if (!CastUtils.isCastable(playable, castContext.getSessionManager().getCurrentCastSession())) {\n             Log.d(TAG, \"media provided is not compatible with cast device\");\n-            EventBus.getDefault().post(new PlayerErrorEvent(\"Media not compatible with cast device\"));\n+            EventBus.getDefault().postSticky(new PlayerErrorEvent(\"Media not compatible with cast device\"));\n             Playable nextPlayable = playable;\n             do {\n                 nextPlayable = callback.getNextInQueue(nextPlayable);\n@@ -418,6 +421,7 @@ public void setStartWhenPrepared(boolean startWhenPrepared) {\n     public void setPlaybackParams(float speed, boolean skipSilence) {\n         double playbackRate = (float) Math.max(MediaLoadOptions.PLAYBACK_RATE_MIN,\n                 Math.min(MediaLoadOptions.PLAYBACK_RATE_MAX, speed));\n+        EventBus.getDefault().post(new SpeedChangedEvent((float) playbackRate));\n         remoteMediaClient.setPlaybackRate(playbackRate);\n     }\n \n", "test_patch": "", "problem_statement": "Playback speed not restored when using Chromecast\n### Checklist\r\n\r\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n### App version\r\n\r\n3.0.2\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Android version\r\n\r\n11\r\n\r\n### Device model\r\n\r\nOnePlus 7 pro\r\n\r\n### First occurred\r\n\r\nunknown\r\n\r\n### Steps to reproduce\r\n\r\nPlay podcast\r\nChange playback speed (preferably very fast to hear the difference immediately)\r\nConnect to Chromecast\r\n\r\n### Expected behaviour\r\n\r\nPlayback speed should be remembered and reapplied every time.\r\n\r\n### Current behaviour\r\n\r\nCorrect playback speed is shown but it always plays at 1x speed until another speed is selected. Then it is played at the right speed but the wrong (last selected) speed is shown.\r\n\r\n### Logs\r\n\r\n_No response_\n", "hints_text": "Same here. I don't know how other podcast apps do this but I think it is possible to instruct Chromecast to play at a particular speed when you _start_ playing the stream.\r\n\r\n## Environment\r\nAndroid version: 13\r\nOS version: 5.10.157-android13-4-00001-g914e947b041d-ab10144456\r\nAntennaPod version: 3.0.2\r\nModel: Pixel 6\r\nDevice: oriole\r\nProduct: oriole\r\nNo crash report recorded\nWhen speed is set to x1.5 and one episode is done, speed on the next episode is reverted to x1 on the chromecast\r\nYou need to manually re-apply the speed setting on the start of each new episode in the playlist\r\n\r\n## Environment\r\nAndroid version: 11\r\nOS version: 4.19.125-perf+\r\nAntennaPod version: 3.4.0\r\nModel: BE2029\r\nDevice: OnePlusN10\r\nProduct: OnePlusN10_EEA\r\n\r\nNo crash report recorded", "created_at": "2024-12-15T18:41:57Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7560, "instance_id": "AntennaPod__AntennaPod-7560", "issue_numbers": ["7518"], "base_commit": "24f09aa7ceb9b19e69a49d6e195d3b7d1d7774c9", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java\nindex ae469de0bf..296ab4c8c0 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java\n@@ -548,6 +548,8 @@ public void onEndSelectMode() {\n     }\n \n     public static class QueueSortDialog extends ItemSortDialog {\n+        boolean turnedOffKeepSortedForRandom = false;\n+\n         @Nullable\n         @Override\n         public View onCreateView(@NonNull LayoutInflater inflater,\n@@ -573,9 +575,16 @@ protected void onAddItem(int title, SortOrder ascending, SortOrder descending, b\n         @Override\n         protected void onSelectionChanged() {\n             super.onSelectionChanged();\n-            viewBinding.keepSortedCheckbox.setEnabled(sortOrder != SortOrder.RANDOM);\n             if (sortOrder == SortOrder.RANDOM) {\n+                turnedOffKeepSortedForRandom |= viewBinding.keepSortedCheckbox.isChecked();\n                 viewBinding.keepSortedCheckbox.setChecked(false);\n+                viewBinding.keepSortedCheckbox.setEnabled(false);\n+            } else {\n+                if (turnedOffKeepSortedForRandom) {\n+                    viewBinding.keepSortedCheckbox.setChecked(true);\n+                    turnedOffKeepSortedForRandom = false;\n+                }\n+                viewBinding.keepSortedCheckbox.setEnabled(true);\n             }\n             UserPreferences.setQueueKeepSorted(viewBinding.keepSortedCheckbox.isChecked());\n             UserPreferences.setQueueKeepSortedOrder(sortOrder);\n", "test_patch": "", "problem_statement": "Keep \"Keep sorted\" checkbox active when switching between 'Random' and other sort orders\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n### App version\r\n\r\n3.6.0-beta1\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Android version\r\n\r\n14\r\n\r\n### Device model\r\n\r\n_No response_\r\n\r\n### First occurred\r\n\r\n_No response_\r\n\r\n### Steps to reproduce\r\n\r\n1. Go to the queue\r\n2. Tap 'Sort'\r\n3. Activate 'Keep sorted' on whatever sort mechanism you have selected (except Random)\r\n4. Set the Random mechanism\r\n5. Go back to the sort mechanism you previously had active\r\n\r\n### Expected behaviour\r\n\r\nThe 'Keep sorted' setting is active again/still. It is fine to show it as disabled & off in the interface, but in the background the original setting should be kept.\r\n\r\n### Current behaviour\r\n\r\nThe 'Keep sorted' setting is turned off.\n", "hints_text": "", "created_at": "2024-12-15T12:05:45Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7556, "instance_id": "AntennaPod__AntennaPod-7556", "issue_numbers": ["7497"], "base_commit": "f835c5adae66c64fa0e885462b7637cc75701c63", "patch": "diff --git a/app/src/main/res/layout/external_player_fragment.xml b/app/src/main/res/layout/external_player_fragment.xml\nindex 233d060775..37f3c5d11d 100644\n--- a/app/src/main/res/layout/external_player_fragment.xml\n+++ b/app/src/main/res/layout/external_player_fragment.xml\n@@ -36,7 +36,7 @@\n \n             <TextView\n                 android:id=\"@+id/txtvTitle\"\n-                android:layout_width=\"wrap_content\"\n+                android:layout_width=\"match_parent\"\n                 android:layout_height=\"wrap_content\"\n                 android:ellipsize=\"end\"\n                 android:maxLines=\"1\"\n@@ -45,7 +45,7 @@\n \n             <TextView\n                 android:id=\"@+id/txtvAuthor\"\n-                android:layout_width=\"wrap_content\"\n+                android:layout_width=\"match_parent\"\n                 android:layout_height=\"wrap_content\"\n                 android:textColor=\"?android:attr/textColorSecondary\"\n                 android:ellipsize=\"end\"\ndiff --git a/app/src/main/res/layout/feeditem_fragment.xml b/app/src/main/res/layout/feeditem_fragment.xml\nindex df95b8c157..f70518e626 100644\n--- a/app/src/main/res/layout/feeditem_fragment.xml\n+++ b/app/src/main/res/layout/feeditem_fragment.xml\n@@ -40,7 +40,7 @@\n \n                 <TextView\n                     android:id=\"@+id/txtvPodcast\"\n-                    android:layout_width=\"wrap_content\"\n+                    android:layout_width=\"match_parent\"\n                     android:layout_height=\"wrap_content\"\n                     android:foreground=\"?attr/selectableItemBackground\"\n                     android:importantForAccessibility=\"no\"\n@@ -49,7 +49,7 @@\n \n                 <TextView\n                     android:id=\"@+id/txtvTitle\"\n-                    android:layout_width=\"wrap_content\"\n+                    android:layout_width=\"match_parent\"\n                     android:layout_height=\"wrap_content\"\n                     android:textSize=\"16sp\"\n                     android:textColor=\"?android:attr/textColorPrimary\"\ndiff --git a/app/src/main/res/layout/feeditemlist_item.xml b/app/src/main/res/layout/feeditemlist_item.xml\nindex a5246265a2..fc83b04aed 100644\n--- a/app/src/main/res/layout/feeditemlist_item.xml\n+++ b/app/src/main/res/layout/feeditemlist_item.xml\n@@ -19,9 +19,7 @@\n         android:gravity=\"center_vertical\"\n         android:baselineAligned=\"false\"\n         android:paddingStart=\"12dp\"\n-        android:paddingLeft=\"12dp\"\n         android:paddingEnd=\"0dp\"\n-        android:paddingRight=\"0dp\"\n         tools:ignore=\"UselessParent\">\n \n         <LinearLayout\n@@ -37,12 +35,8 @@\n                 android:importantForAccessibility=\"no\"\n                 android:scaleType=\"fitCenter\"\n                 android:paddingStart=\"0dp\"\n-                android:paddingLeft=\"0dp\"\n                 android:paddingEnd=\"4dp\"\n-                android:paddingRight=\"4dp\"\n-                app:srcCompat=\"?attr/dragview_background\"\n-                tools:src=\"@drawable/ic_drag_darktheme\"\n-                tools:background=\"@android:color/holo_green_dark\" />\n+                app:srcCompat=\"?attr/dragview_background\" />\n \n         </LinearLayout>\n \n@@ -52,7 +46,6 @@\n             android:layout_height=\"@dimen/thumbnail_length_queue_item\"\n             android:layout_marginBottom=\"@dimen/listitem_threeline_verticalpadding\"\n             android:layout_marginTop=\"@dimen/listitem_threeline_verticalpadding\"\n-            android:layout_marginRight=\"@dimen/listitem_threeline_textleftpadding\"\n             android:layout_marginEnd=\"@dimen/listitem_threeline_textleftpadding\"\n             app:cardBackgroundColor=\"@color/non_square_icon_background\"\n             app:cardCornerRadius=\"4dp\"\n@@ -90,12 +83,10 @@\n             android:layout_width=\"0dp\"\n             android:layout_height=\"wrap_content\"\n             android:layout_marginBottom=\"@dimen/listitem_threeline_verticalpadding\"\n-            android:layout_marginRight=\"@dimen/listitem_threeline_textrightpadding\"\n             android:layout_marginEnd=\"@dimen/listitem_threeline_textrightpadding\"\n             android:layout_marginTop=\"@dimen/listitem_threeline_verticalpadding\"\n             android:layout_weight=\"1\"\n-            android:orientation=\"vertical\"\n-            tools:background=\"@android:color/holo_red_dark\">\n+            android:orientation=\"vertical\">\n \n             <LinearLayout\n                 android:id=\"@+id/status\"\n@@ -136,20 +127,16 @@\n                     android:id=\"@+id/separatorIcons\"\n                     android:layout_width=\"wrap_content\"\n                     android:layout_height=\"wrap_content\"\n-                    android:layout_marginLeft=\"4dp\"\n                     android:layout_marginStart=\"4dp\"\n-                    android:layout_marginRight=\"4dp\"\n                     android:layout_marginEnd=\"4dp\"\n                     android:text=\"\u00b7\"\n                     android:importantForAccessibility=\"no\"\n-                    style=\"@style/AntennaPod.TextView.ListItemSecondaryTitle\"\n-                    tools:background=\"@android:color/holo_blue_light\" />\n+                    style=\"@style/AntennaPod.TextView.ListItemSecondaryTitle\" />\n \n                 <TextView\n                     android:id=\"@+id/txtvPubDate\"\n                     android:layout_width=\"wrap_content\"\n                     android:layout_height=\"wrap_content\"\n-                    android:layout_marginRight=\"4dp\"\n                     android:layout_marginEnd=\"4dp\"\n                     style=\"@style/AntennaPod.TextView.ListItemSecondaryTitle\"\n                     tools:text=\"@sample/episodes.json/data/published_at\" />\n@@ -157,18 +144,15 @@\n                 <TextView\n                     android:layout_width=\"wrap_content\"\n                     android:layout_height=\"wrap_content\"\n-                    android:layout_marginRight=\"4dp\"\n                     android:layout_marginEnd=\"4dp\"\n                     android:text=\"\u00b7\"\n                     android:importantForAccessibility=\"no\"\n-                    style=\"@style/AntennaPod.TextView.ListItemSecondaryTitle\"\n-                    tools:background=\"@android:color/holo_blue_light\" />\n+                    style=\"@style/AntennaPod.TextView.ListItemSecondaryTitle\" />\n \n                 <TextView\n                     android:id=\"@+id/size\"\n                     android:layout_width=\"wrap_content\"\n                     android:layout_height=\"wrap_content\"\n-                    android:layout_marginRight=\"4dp\"\n                     android:layout_marginEnd=\"4dp\"\n                     style=\"@style/AntennaPod.TextView.ListItemSecondaryTitle\"\n                     tools:text=\"10 MB\" />\n@@ -182,13 +166,13 @@\n             -->\n             <TextView\n                 android:id=\"@+id/txtvTitle\"\n-                android:layout_width=\"match_parent\"\n+                android:layout_width=\"wrap_content\"\n                 android:layout_height=\"wrap_content\"\n                 android:importantForAccessibility=\"no\"\n                 android:ellipsize=\"end\"\n+                android:textAlignment=\"viewStart\"\n                 style=\"@style/AntennaPod.TextView.ListItemPrimaryTitle\"\n-                tools:text=\"@sample/episodes.json/data/title\"\n-                tools:background=\"@android:color/holo_blue_light\" />\n+                tools:text=\"@sample/episodes.json/data/title\" />\n \n             <LinearLayout\n                 android:id=\"@+id/progress\"\n@@ -203,8 +187,7 @@\n                     android:layout_height=\"wrap_content\"\n                     android:layout_marginBottom=\"0dp\"\n                     style=\"@style/AntennaPod.TextView.ListItemSecondaryTitle\"\n-                    tools:text=\"00:42:23\"\n-                    tools:background=\"@android:color/holo_blue_light\" />\n+                    tools:text=\"00:42:23\" />\n \n                 <ProgressBar\n                     android:id=\"@+id/progressBar\"\n@@ -213,8 +196,7 @@\n                     android:layout_weight=\"1\"\n                     android:max=\"100\"\n                     android:layout_margin=\"4dp\"\n-                    style=\"?android:attr/progressBarStyleHorizontal\"\n-                    tools:background=\"@android:color/holo_blue_light\" />\n+                    style=\"?android:attr/progressBarStyleHorizontal\" />\n \n                 <TextView\n                     android:id=\"@+id/txtvDuration\"\n@@ -222,8 +204,7 @@\n                     android:layout_height=\"wrap_content\"\n                     android:layout_marginBottom=\"0dp\"\n                     style=\"@style/AntennaPod.TextView.ListItemSecondaryTitle\"\n-                    tools:text=\"@sample/episodes.json/data/duration\"\n-                    tools:background=\"@android:color/holo_blue_light\" />\n+                    tools:text=\"@sample/episodes.json/data/duration\" />\n \n             </LinearLayout>\n \n", "test_patch": "", "problem_statement": "improve display of episode descriptions in RTL languages\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.5.0\n\n### Where did you get the app from\n\nF-Droid\n\n### Feature or improvement you want\n\nI would like to request an improvement to the display of episode descriptions in RTL languages. Currently, the descriptions do not render correctly. I have also checked the podcast source, and the descriptions are not displayed properly there either, but I believe this issue can be corrected within the app. Thank you!\n\n### Why should this be added?\n\nIt is totally readable as it is right now, but improving it could enhance the user experience for speakers of RTL languages.\n\n### Screenshots / Drawings / Technical details\n\n![photo_2024-11-13_17-38-48](https://github.com/user-attachments/assets/34704b3d-c286-4209-b2e4-19bf24ac26e8)\r\nscreenshot of an episode description displaying a RTL language incorrectly as LTR.\r\n\r\n![photo_2024-11-13_17-38-42](https://github.com/user-attachments/assets/21297cba-ac8e-4d5f-97cb-4334a4a15257)\r\nWhereas it is displayed correctly on the podcast page.\n", "hints_text": "Thanks for reporting this @muctebanesiri. It seems like there's two issues:\n* Episode title & author, which should be right-aligned together with the image\n* Episode description, idem\n\nIs that right? For the second, the data is coming from the RSS feed, and I'm wondering if it contains any indication what language the feed is in or that the text is RTL. (Relevant info: https://core.trac.wordpress.org/ticket/6425). We should probably do both.\n\nWould you mind sharing the feed URL @muctebanesiri, so we have an example?\n> Episode title & author, which should be right-aligned together with the image\r\n\r\nThe episode image already gets right-aligned when setting the device language to a language that is RTL. This screenshot is from a device language that is LTR but shows a podcast that is RTL. So the image being left-aligned is correct (the position of layout elements shouldn't jump between different podcasts).\r\n\r\n> I have also checked the podcast source, and the descriptions are not displayed properly there either, but I believe this issue can be corrected within the app.\r\n\r\nI don't think we should try to work around problems caused by podcast creators (and potentially break valid feeds). Instead, the creators should fix their feed.\n> I don't think we should try to work around problems caused by podcast creators (and potentially break valid feeds). Instead, the creators should fix their feed.\n\nMaybe the feed is already correct. Do we display RTL if the feed language is set to Arabic? Or do we expect a RTL indication in the description tag in the feed? (See also link to Wordpress discussion.)\nWe hand the episode description over to webview, which then prepares the display. If the feed language is set, this info is not passed to webview, which may cause the issue.\r\nWe did some investigations:\r\n* Changing the app language turned the app UI right-to-left, except for the descriptions.\r\n* Episode description: Wrapping the description in an html tag with the [`direction attribute`](https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/dir) works. Just adding the [`lang`](https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/lang) attribute does not work. We can rely android to determine the text direction based on the languge, which we take from the feed & store in the database.\r\n  * In `ShownotesCleaner`, this could be something along the lines of:\r\n    ```\r\n    int d = TextUtils.getLayoutDirectionFromLocale(Locale.getDefault()); // TODO: Use Feed.getLanguage() with fallback to device language\r\n    document.body().attr(\"dir\", d == View.LAYOUT_DIRECTION_RTL ? \"RTL\" : \"LTR\");\r\n    ```\r\n* Episode title in the episode detail screen: we can change this also so that it's right-aligned. However, it seems it creates for a bit of a restless/incoherent UI, with 'gaps':\r\n  (first an episode in Arabic in an English app, second an episode in English in an Arabic app, and in the last screenshot where we don't 'correctly' align)\r\n  <img width=250px src=https://github.com/user-attachments/assets/09d565c0-86f3-4ee6-8ef7-c8d85d024238> <img width=250px src=https://github.com/user-attachments/assets/36b2e65e-b131-4f90-9f1c-fc67b1509fae> <img width=250px src=https://github.com/user-attachments/assets/80028b7e-b0a9-4f59-a6b8-3a12b5afc999>\r\n  What do you think @muctebanesiri - isn't it better to keep the aesthetics nice, rather than correcting the text aligning? \r\n* Episode titles in lists are already correct, as are podcast titles & descriptions:\r\n  <img width=250px src=https://github.com/user-attachments/assets/abe66d4b-a960-4213-a5a2-3f6c88deb198>\r\n\r\nNote: we just took high-rated podcasts from Apple Podcasts, and haven't checked what these podcasts are about.\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/needs-decision-meeting-updates/4169/12\n\n@ebraminio You have worked on RTL support in AntennaPod before, so I assume you are using AntennaPod in an RTL language. Considering that a lot of programming resources are in English, I assume you probably also have a mix between RTL and LTR texts inside the app. What is your opinion on this?\r\n\r\n(In the following, I'm using English and Arabic as an example. Of course, this holds for all LTR and RTL languages)\r\n\r\n- Option 1: If there is a mix, align everything like the native device language. So if you set your phone to Arabic and some episode title is in English, the English text gets right-aligned as well. Similarly, if you set your phone to English and some episode title is Arabic, it gets left-aligned.\r\n  - Advantage: The layout looks visually more consistent, no large white gaps like in the screenshot above. This makes it easier to visually grasp the layout (less back-and-forth between different alignments).\r\n  - Disadvantage: Episodes using English titles might be right-aligned and Arabic ones might be left-aligned if your phone is set to the other language. This is less common and might be harder to read.\r\n- Option 2: If there is a mix, align each individual text according to its native direction.\r\n  - Advantage: Each text is displayed in its native direction. \r\n  - Disadvantage: A screen might jump around between left-aligned and right-aligned text. Especially if you have both English and Arabic episode titles in the same list, some titles will be left-aligned and some right-aligned. If you set the phone language to English but still listen to Arabic podcasts, the titles are aligned to the opposite end of other UI elements (dates, icons, buttons, etc). See also the screenshot above.\r\n\r\n---\r\n\r\nNote that all this is only a problem if you have a mix of languages. If you use the app in Arabic and listen to Arabic podcasts, everything is fine. If you use the app in English and listen to English podcasts, everything is fine as well. This is just relevant if you listen to podcasts that use a different direction than your app language.\r\n\r\n---\r\n\r\nSome data points:\r\n\r\n- The Apple developer documentation says that list items should use consistent alignment even if this uses the \"wrong\" direction for some of them. Only paragraphs with 3 or more lines should always follow the language of the text: https://developer.apple.com/design/human-interface-guidelines/right-to-left\r\n- The Google documentation does not explicitly state what direction to use, but their screenshots show \"wrong\" right-aligned English text when displayed on a RTL phone: https://m2.material.io/design/usability/bidirectionality.html#mirroring-layout\r\n- This Stackoverflow answer says that single-line text should follow the alignment of the context it is embedded in because this makes it easier to scan: https://ux.stackexchange.com/questions/119565/mixed-alignment-ltr-and-rtl-in-language-selection-list/119601#119601\r\n- Microsoft seems to prefer consistency as well: \"To preserve a consistent UI flow, content on tiles retain a right-to-left layout, meaning that the app name and logo are positioned at the bottom right corner of the tile regardless of the app UI language.\" https://learn.microsoft.com/en-us/windows/apps/design/globalizing/design-for-bidi-text\r\n- Setting the phone language to English, WhatsApp left-aligns Arabic preview text. Signal right-aligns it. Setting the phone language to Arabic, WhatsApp right-aligns English text in the preview and Signal left-aligns it. Both always right-align the contact names, no matter their content.\n> We hand the episode description over to webview, which then prepares the display. [..]\r\n\r\nSo this might just need a `dir=\"auto\"`, it matches what Android does more or less.\nFix uploaded at #7517\r\n\r\n<img width=\"258\" alt=\"image\" src=\"https://github.com/user-attachments/assets/093a2ded-7aa3-46dd-afec-6554a4ea80b3\">\r\n\nThanks for working on the description @ebraminio! The solution using \"auto\" is much more clean than our idea of parsing the feed language explicitly.\r\n\r\nThis issue has two aspects to it. One is the description and one is the alignment in lists/titles. I'm curious to hear your opinion on the alignment of list items and titles (see my post above). \n> I don't think we should try to work around problems caused by podcast creators\r\n\r\nThis is the ideal case but not the reality with feeds, years ago I fixed a similar issue on a feed reader https://github.com/Athou/commafeed/issues/205 because it's not usual for feed authors to add dir=\"rtl\" to their RTL content.\r\n\r\n> The solution using \"auto\" is much more clean than our idea of parsing the feed language explicitly.\r\n\r\nI should note that dir=\"auto\" is not perfect but is what usually used, for example I did that for gitlab markdown engine https://gitlab.com/gitlab-org/gitlab-foss/-/merge_requests/6296 and that ended up in GitHub's also years later AFAICS.\r\n\r\n> I'm curious to hear your opinion on the alignment of list items and titles (see my post above).\r\n\r\n> isn't it better to keep the aesthetics nice, rather than correcting the text aligning?\r\n\r\nI don't have strong opinion on it tbh but others may have. viewStart vs textStart https://stackoverflow.com/a/66758668/ exists for the reason. Sometimes one is better sometimes the other. I feel usually on web viewStart is more popular and on Android textStart is more popular, both have some advantages as you noticed. When text is small both can be acceptable but when it's more than one sentence and more than one line sure textStart is better. Sure consistency does matter so if it's done one way for a category of ui inputs, it's better to have it consistent on rest of them also and I think going with textStart wherever possible can be better.\nSo I guess we should do the following:\r\n\r\n- Shownotes: `dir=auto`\r\n- Episode description screen: Right-align (for RTL) the title. Here the title might have many lines. Also there is the feed title below, so we have at least 2 lines in total. No need for a consistent layout because the screen only shows one episode at a time.\r\n- Feed details screen: Keep the title right-aligned (for RTL) as it already is. Same argument as above, many lines\r\n- Feed details description: Keep right-aligned like it already is because it contains many lines\r\n- Episodes lists: Align title together with the duration and date, for visual consistency and less white space within the list\r\n\r\n@keunes what do you think?", "created_at": "2024-12-15T10:35:11Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7555, "instance_id": "AntennaPod__AntennaPod-7555", "issue_numbers": ["7543"], "base_commit": "f835c5adae66c64fa0e885462b7637cc75701c63", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/HomeFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/HomeFragment.java\nindex be07932901..bb3f03dec0 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/HomeFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/HomeFragment.java\n@@ -39,7 +39,6 @@\n import org.greenrobot.eventbus.Subscribe;\n import org.greenrobot.eventbus.ThreadMode;\n \n-import java.util.Calendar;\n import java.util.List;\n \n /**\n@@ -82,10 +81,7 @@ private void populateSectionList() {\n         viewBinding.homeContainer.removeAllViews();\n \n         SharedPreferences prefs = getContext().getSharedPreferences(HomeFragment.PREF_NAME, Context.MODE_PRIVATE);\n-        if (Calendar.getInstance().get(Calendar.YEAR) == EchoConfig.RELEASE_YEAR\n-                && Calendar.getInstance().get(Calendar.MONTH) == Calendar.DECEMBER\n-                && Calendar.getInstance().get(Calendar.DAY_OF_MONTH) >= 10\n-                && prefs.getInt(PREF_HIDE_ECHO, 0) != EchoConfig.RELEASE_YEAR) {\n+        if (EchoConfig.isCurrentlyVisible() && prefs.getInt(PREF_HIDE_ECHO, 0) != EchoConfig.RELEASE_YEAR) {\n             addSection(new EchoSection());\n         }\n \ndiff --git a/ui/echo/src/main/java/de/danoeh/antennapod/ui/echo/EchoConfig.java b/ui/echo/src/main/java/de/danoeh/antennapod/ui/echo/EchoConfig.java\nindex d7bca4c9c1..529419367f 100644\n--- a/ui/echo/src/main/java/de/danoeh/antennapod/ui/echo/EchoConfig.java\n+++ b/ui/echo/src/main/java/de/danoeh/antennapod/ui/echo/EchoConfig.java\n@@ -16,4 +16,10 @@ public static long jan1() {\n         date.set(Calendar.YEAR, RELEASE_YEAR);\n         return date.getTimeInMillis();\n     }\n+\n+    public static boolean isCurrentlyVisible() {\n+        return Calendar.getInstance().get(Calendar.YEAR) == RELEASE_YEAR\n+                && Calendar.getInstance().get(Calendar.MONTH) == Calendar.DECEMBER\n+                && Calendar.getInstance().get(Calendar.DAY_OF_MONTH) >= 10;\n+    }\n }\ndiff --git a/ui/echo/src/main/res/values/echo-strings.xml b/ui/echo/src/main/res/values/echo-strings.xml\nindex 161fe363e4..09a64f1e45 100644\n--- a/ui/echo/src/main/res/values/echo-strings.xml\n+++ b/ui/echo/src/main/res/values/echo-strings.xml\n@@ -1,6 +1,5 @@\n <?xml version=\"1.0\" encoding=\"utf-8\"?>\n <resources xmlns:tools=\"http://schemas.android.com/tools\" tools:ignore=\"MissingTranslation,PluralsCandidate\">\n-    <string name=\"debug_echo\" translatable=\"false\">[Debug] Echo</string>\n     <string name=\"echo_home_header\">Review the year</string>\n     <string name=\"echo_home_subtitle\">Your top podcasts and stats from the past year. Exclusively on your phone.</string>\n \ndiff --git a/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/StatisticsFragment.java b/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/StatisticsFragment.java\nindex 74a0eaa5f2..ef3cc4ef5e 100644\n--- a/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/StatisticsFragment.java\n+++ b/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/StatisticsFragment.java\n@@ -23,6 +23,7 @@\n import de.danoeh.antennapod.event.StatisticsEvent;\n import de.danoeh.antennapod.ui.common.PagedToolbarFragment;\n import de.danoeh.antennapod.ui.echo.EchoActivity;\n+import de.danoeh.antennapod.ui.echo.EchoConfig;\n import de.danoeh.antennapod.ui.statistics.downloads.DownloadStatisticsFragment;\n import de.danoeh.antennapod.ui.statistics.subscriptions.SubscriptionStatisticsFragment;\n import de.danoeh.antennapod.ui.statistics.years.YearsStatisticsFragment;\n@@ -63,8 +64,8 @@ public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container,\n         toolbar = rootView.findViewById(R.id.toolbar);\n         toolbar.setTitle(getString(R.string.statistics_label));\n         toolbar.inflateMenu(R.menu.statistics);\n-        if (BuildConfig.DEBUG) {\n-            toolbar.getMenu().findItem(R.id.debug_echo).setVisible(true);\n+        if (BuildConfig.DEBUG || EchoConfig.isCurrentlyVisible()) {\n+            toolbar.getMenu().findItem(R.id.show_echo).setVisible(true);\n         }\n         toolbar.setNavigationOnClickListener(v -> getParentFragmentManager().popBackStack());\n         viewPager.setAdapter(new StatisticsPagerAdapter(this));\n@@ -94,7 +95,7 @@ public boolean onOptionsItemSelected(@NonNull MenuItem item) {\n         if (item.getItemId() == R.id.statistics_reset) {\n             confirmResetStatistics();\n             return true;\n-        } else if (item.getItemId() == R.id.debug_echo) {\n+        } else if (item.getItemId() == R.id.show_echo) {\n             startActivity(new Intent(getContext(), EchoActivity.class));\n         }\n         return super.onOptionsItemSelected(item);\ndiff --git a/ui/statistics/src/main/res/menu/statistics.xml b/ui/statistics/src/main/res/menu/statistics.xml\nindex 9720e6880a..00f6362cca 100644\n--- a/ui/statistics/src/main/res/menu/statistics.xml\n+++ b/ui/statistics/src/main/res/menu/statistics.xml\n@@ -14,8 +14,8 @@\n         custom:showAsAction=\"ifRoom\" />\n \n     <item\n-        android:id=\"@+id/debug_echo\"\n-        android:title=\"@string/debug_echo\"\n+        android:id=\"@+id/show_echo\"\n+        android:title=\"@string/antennapod_echo\"\n         custom:showAsAction=\"never\"\n         android:visible=\"false\" />\n \n", "test_patch": "", "problem_statement": "Add a method to bring back the AntennaPod Echo screen if it had been closed\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\r\n\r\n### App version\r\n\r\n3.5.0f\r\n\r\n### Feature or improvement you want\r\n\r\nI viewed the AntennaPod Echo screens, then clicked the X button in the top-right to close the banner. I then couldn't find a way to bring back AntennaPod echo if I wanted to check it again.\r\n\r\n### Why should this be added?\r\n\r\nI wanted to get it back to report a bug I noticed, but someone else might want to bring it back to share an image or similar.\r\n\r\nI did have a good look round so hopefully I haven't missed an already existing way to make it re-appear! Thanks.\n", "hints_text": "We have discussed this in the last and decided then that we don't want to have this as a clear option because it's not worth a setting. We did discuss the idea of making it available through an Easter egg-like mechanism, but not worth the effort.\n\nNot sure we'd change that; we'll discuss.\n\nIn the meantime, if you remember the issue roughly, feel free to create an issue for it; we can make screenshots if need be.\nThanks. I agree a setting to bring it back would be overkill. I was thinking it could maybe appear as a temporary entry in the navigation list. I suppose wherever it was put, though, someone will complain that they can't hide it!\r\n\r\nIn any case, I have made a new issue based on my memory and from looking at the source code!\nMaybe instead of an option to bring it back, the close button could have a confirmation popup?", "created_at": "2024-12-15T10:01:40Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7545, "instance_id": "AntennaPod__AntennaPod-7545", "issue_numbers": ["7540"], "base_commit": "1dc1849a5146ed2ed561cc1a073dd8ed199f0b0f", "patch": "diff --git a/app/src/main/res/layout/share_episode_dialog.xml b/app/src/main/res/layout/share_episode_dialog.xml\nindex 02d17a8f83..9f7e89b49b 100644\n--- a/app/src/main/res/layout/share_episode_dialog.xml\n+++ b/app/src/main/res/layout/share_episode_dialog.xml\n@@ -55,6 +55,7 @@\n                         android:id=\"@+id/socialMessageText\"\n                         android:layout_width=\"match_parent\"\n                         android:layout_height=\"wrap_content\"\n+                        android:maxLines=\"7\"\n                         android:text=\"@string/share_dialog_for_social\"\n                         style=\"@style/TextAppearance.Material3.BodyMedium\" />\n \n", "test_patch": "", "problem_statement": "File option invisible when sharing episode on device with small screen/big font size\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.6.0-beta3\n\n### Android version\n\n14\n\n### Device model\n\nSamsung A52S (with 6.5\", 2400 x 1080 display)\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Open an episode\r\n2. Tap on Share\n\n### Expected behaviour\n\nAll three share options are visible\n\n### Current behaviour\n\nThe 'file' option is not visible, because the other two take the full space:\r\n![f3065c866e1d625b9bf4290a20c5cce92d806279_2_337x750](https://github.com/user-attachments/assets/c69062d5-ce7f-427a-9ff7-b9a33a98efba)\n\n### Logs\n\n_No response_\n", "hints_text": "This issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/3-6-0-beta3-share-file/5782/2\n\nWondering how to best address this. We can make it scrollable, truncate the URLs more in the social media message, and/or maybe move the share icon to the top-right of each block or just remove the icons altogether since it's quite clear they're buttons (to create more horizontal space).", "created_at": "2024-12-10T19:54:36Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7542, "instance_id": "AntennaPod__AntennaPod-7542", "issue_numbers": ["7541"], "base_commit": "b76c0a2d2a09114d169cf111bfc4b1da892fde0e", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java\nindex fc00165c35..4f46faf567 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java\n@@ -60,8 +60,8 @@ public static boolean onPrepareMenu(Menu menu, List<FeedItem> selectedItems, int\n         boolean canSkip = false;\n         boolean canRemoveFromQueue = false;\n         boolean canAddToQueue = false;\n-        boolean canVisitWebsite = selectedItems.size() == 1;\n-        boolean canShare = selectedItems.size() == 1;\n+        boolean canVisitWebsite = false;\n+        boolean canShare = false;\n         boolean canRemoveFromInbox = false;\n         boolean canMarkPlayed = false;\n         boolean canMarkUnplayed = false;\n@@ -70,7 +70,7 @@ public static boolean onPrepareMenu(Menu menu, List<FeedItem> selectedItems, int\n         boolean canDownload = false;\n         boolean canAddFavorite = false;\n         boolean canRemoveFavorite = false;\n-        boolean canShowTranscript = selectedItems.size() == 1;\n+        boolean canShowTranscript = false;\n \n         for (FeedItem item : selectedItems) {\n             boolean hasMedia = item.getMedia() != null;\n", "test_patch": "", "problem_statement": "Show transcript menu is showing for all podcast episode even when there is not transcript URL\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.6.0-beta3 (b76c0a2d2)\n\n### Android version\n\nAndroid 14\n\n### Device model\n\nMoto G5\n\n### First occurred\n\nSept 26, 2024\n\n### Steps to reproduce\n\n1. Subscribe to \"The Daily\" from New York Times\r\n2. This podcast does not have transcripts based on the RSS feed https://feeds.simplecast.com/Sl5CSM3S\r\n3. Download or stream an episode\r\n4. Click 3 dots and you will see the 'Show transcript' menu even though this feed does not have transcripts\n\n### Expected behaviour\n\n'Show transcript' should not show \n\n### Current behaviour\n\n'Show transcript' show for all episodes \n\n### Logs\n\nI think the bug was introduced here when @ByteHamster was working on not showing multi-select pop up menus.\r\n\r\nhttps://github.com/AntennaPod/AntennaPod/pull/7424/files#diff-1803f12e08b2c1db9bef32bf1368e6c8d1e6202234c417eef1d135351e093992R122\r\n\r\napp/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java\r\n`        setItemVisibility(menu, R.id.transcript_item, canShowTranscript);`\n", "hints_text": "", "created_at": "2024-12-09T20:02:08Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7537, "instance_id": "AntennaPod__AntennaPod-7537", "issue_numbers": ["7431"], "base_commit": "310ce203cea26cf14dc8514ab72d028e545640ab", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/TranscriptAdapter.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/TranscriptAdapter.java\nindex ffb3b7bdae5..7ce8b0964e3 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/TranscriptAdapter.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/TranscriptAdapter.java\n@@ -78,6 +78,8 @@ public void onBindViewHolder(@NonNull TranscriptViewholder holder, int position)\n             if (speakers.isEmpty() && (position % 5 == 0)) {\n                 holder.viewTimecode.setVisibility(View.VISIBLE);\n                 holder.viewTimecode.setText(timecode);\n+            } else {\n+                holder.viewTimecode.setVisibility(View.GONE);\n             }\n             holder.viewContent.setText(seg.getWords());\n         }\ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItem.java b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItem.java\nindex 603c6666774..f10871992a7 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItem.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItem.java\n@@ -45,7 +45,6 @@ public class FeedItem implements Serializable {\n     private String socialInteractUrl;\n     private String podcastIndexTranscriptUrl;\n     private String podcastIndexTranscriptType;\n-    private String podcastIndexTranscriptText;\n     private Transcript transcript;\n \n     private int state;\n@@ -456,29 +455,15 @@ public String getTranscriptType() {\n         return podcastIndexTranscriptType;\n     }\n \n-    public void updateTranscriptPreferredFormat(String type, String url) {\n-        if (StringUtils.isEmpty(type) || StringUtils.isEmpty(url)) {\n+    public void updateTranscriptPreferredFormat(String typeStr, String url) {\n+        if (StringUtils.isEmpty(typeStr) || StringUtils.isEmpty(url)) {\n             return;\n         }\n-\n-        String canonicalSrr = \"application/srr\";\n-        String jsonType = \"application/json\";\n-\n-        switch (type) {\n-            case \"application/json\":\n-                podcastIndexTranscriptUrl = url;\n-                podcastIndexTranscriptType = type;\n-                break;\n-            case \"application/srr\":\n-            case \"application/srt\":\n-            case \"application/x-subrip\":\n-                if (podcastIndexTranscriptUrl == null || !podcastIndexTranscriptType.equals(jsonType)) {\n-                    podcastIndexTranscriptUrl = url;\n-                    podcastIndexTranscriptType = canonicalSrr;\n-                }\n-                break;\n-            default:\n-                break;\n+        TranscriptType type = TranscriptType.fromMime(typeStr);\n+        TranscriptType previousType = TranscriptType.fromMime(podcastIndexTranscriptType);\n+        if (type.priority > previousType.priority) {\n+            podcastIndexTranscriptUrl = url;\n+            podcastIndexTranscriptType = type.canonicalMime;\n         }\n     }\n \n@@ -490,14 +475,6 @@ public void setTranscript(Transcript t) {\n         transcript = t;\n     }\n \n-    public String getPodcastIndexTranscriptText() {\n-        return podcastIndexTranscriptText;\n-    }\n-\n-    public String setPodcastIndexTranscriptText(String str) {\n-        return podcastIndexTranscriptText = str;\n-    }\n-\n     public boolean hasTranscript() {\n         return (podcastIndexTranscriptUrl != null);\n     }\ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/TranscriptSegment.java b/model/src/main/java/de/danoeh/antennapod/model/feed/TranscriptSegment.java\nindex 0101bb8ed51..6f3401c3bd4 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/feed/TranscriptSegment.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/TranscriptSegment.java\n@@ -2,8 +2,8 @@\n \n public class TranscriptSegment {\n     private final long startTime;\n-    private final long endTime;\n-    private final String words;\n+    private long endTime;\n+    private String words;\n     private final String speaker;\n \n     public TranscriptSegment(long start, long end, String w, String s) {\n@@ -13,6 +13,11 @@ public TranscriptSegment(long start, long end, String w, String s) {\n         speaker = s;\n     }\n \n+    public void append(long newEndTime, String wordsToAppend) {\n+        endTime = newEndTime;\n+        words += \" \" + wordsToAppend;\n+    }\n+\n     public long getStartTime() {\n         return startTime;\n     }\ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/TranscriptType.java b/model/src/main/java/de/danoeh/antennapod/model/feed/TranscriptType.java\nnew file mode 100644\nindex 00000000000..4a9d1315326\n--- /dev/null\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/TranscriptType.java\n@@ -0,0 +1,28 @@\n+package de.danoeh.antennapod.model.feed;\n+\n+public enum TranscriptType {\n+    JSON(4, \"application/json\"),\n+    VTT(3, \"text/vtt\"),\n+    SRT(2, \"application/srt\"),\n+    NONE(0, \"\");\n+\n+    public final int priority;\n+    public final String canonicalMime;\n+\n+    TranscriptType(int priority, String canonicalMime) {\n+        this.priority = priority;\n+        this.canonicalMime = canonicalMime;\n+    }\n+\n+    public static TranscriptType fromMime(String type) {\n+        if (type == null) {\n+            return NONE;\n+        }\n+        return switch (type) {\n+            case \"application/json\" -> JSON;\n+            case \"text/vtt\" -> VTT;\n+            case \"application/srt\", \"application/srr\", \"application/x-subrip\" -> SRT;\n+            default -> NONE;\n+        };\n+    }\n+}\ndiff --git a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/MediaDownloadedHandler.java b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/MediaDownloadedHandler.java\nindex 4958ba529b7..293f3065219 100644\n--- a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/MediaDownloadedHandler.java\n+++ b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/MediaDownloadedHandler.java\n@@ -70,7 +70,6 @@ public void run() {\n             if (item != null && item.getTranscriptUrl() != null) {\n                 String transcript = TranscriptUtils.loadTranscriptFromUrl(item.getTranscriptUrl(), true);\n                 if (!StringUtils.isEmpty(transcript)) {\n-                    item.setPodcastIndexTranscriptText(transcript);\n                     TranscriptUtils.storeTranscript(media, transcript);\n                 }\n             }\ndiff --git a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/FeedUpdateWorker.java b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/FeedUpdateWorker.java\nindex cd6954ac822..1b7ffffec34 100644\n--- a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/FeedUpdateWorker.java\n+++ b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/FeedUpdateWorker.java\n@@ -167,6 +167,7 @@ private void refreshFeeds(List<Feed> toUpdate, boolean force) {\n                         newEpisodesNotification.showIfNeeded(getApplicationContext(), savedFeed);\n                     }\n                 } catch (Exception e) {\n+                    e.printStackTrace();\n                     DBWriter.setFeedLastUpdateFailed(feed.getId(), true);\n                     DownloadResult status = new DownloadResult(feed.getTitle(),\n                             feed.getId(), Feed.FEEDFILETYPE_FEED, false,\ndiff --git a/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/TranscriptParser.java b/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/TranscriptParser.java\nindex 4049b2c8f85..e428a3ce105 100644\n--- a/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/TranscriptParser.java\n+++ b/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/TranscriptParser.java\n@@ -1,5 +1,6 @@\n package de.danoeh.antennapod.parser.transcript;\n \n+import de.danoeh.antennapod.model.feed.TranscriptType;\n import org.apache.commons.lang3.StringUtils;\n \n import de.danoeh.antennapod.model.feed.Transcript;\n@@ -8,18 +9,16 @@ public class TranscriptParser {\n     static final long MIN_SPAN = 5000L; // Merge short segments together to form a span of 5 seconds\n     static final long MAX_SPAN = 8000L; // Don't go beyond 10 seconds when merging\n \n-    public static Transcript parse(String str, String type) {\n+    public static Transcript parse(String str, String typeStr) {\n         if (str == null || StringUtils.isBlank(str)) {\n             return null;\n         }\n-\n-        if (\"application/json\".equals(type)) {\n-            return JsonTranscriptParser.parse(str);\n-        }\n-\n-        if (\"application/srt\".equals(type) || \"application/srr\".equals(type) || \"application/x-subrip\".equals(type)) {\n-            return SrtTranscriptParser.parse(str);\n-        }\n-        return null;\n+        TranscriptType type = TranscriptType.fromMime(typeStr);\n+        return switch (type) {\n+            case JSON -> JsonTranscriptParser.parse(str);\n+            case VTT -> VttTranscriptParser.parse(str);\n+            case SRT -> SrtTranscriptParser.parse(str);\n+            default -> null;\n+        };\n     }\n }\ndiff --git a/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/VttTranscriptParser.java b/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/VttTranscriptParser.java\nnew file mode 100644\nindex 00000000000..33d7071a506\n--- /dev/null\n+++ b/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/VttTranscriptParser.java\n@@ -0,0 +1,144 @@\n+package de.danoeh.antennapod.parser.transcript;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.jsoup.Jsoup;\n+\n+import java.util.Arrays;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+import de.danoeh.antennapod.model.feed.Transcript;\n+import de.danoeh.antennapod.model.feed.TranscriptSegment;\n+\n+public class VttTranscriptParser {\n+    private static final Pattern TIMESTAMP_PATTERN =\n+            Pattern.compile(\"^(?:([0-9]{2}):)?([0-9]{2}):([0-9]{2})\\\\.([0-9]{3})$\");\n+\n+    private static final Pattern VOICE_SPAN =\n+            Pattern.compile(\"<v(?:\\\\.[^\\\\t\\\\n\\\\r &<>.]+)*[ \\\\t]([^\\\\n\\\\r&>]+)>\");\n+\n+    private record Timings(long start, long end) {}\n+\n+    public static Transcript parse(String str) {\n+        // This is basically a very light WebVTT parser.\n+        // It uses WebVTT properties to be both exact and very light.\n+        // We will only be parsing the WebVTT cue blocks.\n+\n+        if (StringUtils.isBlank(str)) {\n+            return null;\n+        }\n+\n+        // WebVTT line terminator can be \\r\\n, \\n or \\n, let's use only one\n+        str = str.replaceAll(\"\\r\\n?\", \"\\n\");\n+        List<String> lines = Arrays.asList(str.split(\"\\n\"));\n+\n+        Transcript transcript = new Transcript();\n+        Iterator<String> iterator = lines.iterator();\n+        Set<String> speakers = new HashSet<>();\n+        String speaker = \"\";\n+        TranscriptSegment segment = null;\n+\n+        // Iterate through cue blocks\n+        while (iterator.hasNext()) {\n+            String line = iterator.next();\n+\n+            if (!line.contains(\"-->\")) {\n+                continue;\n+            }\n+\n+            Timings timings = parseCueTimings(line);\n+            if (timings == null) {\n+                return null; // Input is broken\n+            }\n+\n+            String payload = parseCuePayload(iterator);\n+\n+            Matcher matcher = VOICE_SPAN.matcher(payload);\n+            if (matcher.find()) {\n+                speaker = matcher.group(1);\n+                speakers.add(speaker);\n+            }\n+\n+            payload = Jsoup.parse(payload).text(); // remove all HTML tags\n+\n+            // should we merge this segment with the previous one?\n+            if (segment != null && segment.getSpeaker().equals(speaker)\n+                    && timings.end - segment.getStartTime() < TranscriptParser.MAX_SPAN) {\n+                segment.append(timings.end, payload);\n+            } else {\n+                if (segment != null) {\n+                    transcript.addSegment(segment);\n+                }\n+                segment = new TranscriptSegment(timings.start, timings.end, payload, speaker);\n+            }\n+\n+            // do we have a candidate segment long enough to add it without trying to add more\n+            if (segment.getEndTime() - segment.getStartTime() >= TranscriptParser.MIN_SPAN) {\n+                transcript.addSegment(segment);\n+                segment = null;\n+            }\n+        }\n+\n+        if (segment != null) {\n+            transcript.addSegment(segment);\n+        }\n+\n+        if (transcript.getSegmentCount() == 0) {\n+            return null;\n+        }\n+        transcript.setSpeakers(speakers);\n+        return transcript;\n+    }\n+\n+    private static long parseIntOrNull(@Nullable String s) {\n+        return StringUtils.isEmpty(s) ? 0 : Integer.parseInt(s);\n+    }\n+\n+    private static long parseTimestamp(@NonNull String timestamp) {\n+        Matcher matcher = TIMESTAMP_PATTERN.matcher(timestamp);\n+        if (!matcher.matches()) {\n+            return -1;\n+        }\n+        long hours = parseIntOrNull(matcher.group(1));\n+        long minutes = parseIntOrNull(matcher.group(2));\n+        long seconds = parseIntOrNull(matcher.group(3));\n+        long milliseconds = parseIntOrNull(matcher.group(4));\n+        return (hours * 60 * 60 * 1000) + (minutes * 60 * 1000) + (seconds * 1000) + milliseconds;\n+    }\n+\n+    @Nullable\n+    private static Timings parseCueTimings(@NonNull String line) {\n+        String[] timestamps = line.split(\"-->\");\n+        if (timestamps.length < 2) {\n+            return null;\n+        }\n+        long start = parseTimestamp(timestamps[0].trim());\n+        long end = parseTimestamp(timestamps[1].trim().split(\"[ \\\\t]\")[0]);\n+        if (start == -1 || end == -1) {\n+            return null;\n+        }\n+        return new Timings(start, end);\n+    }\n+\n+    @NonNull\n+    private static String parseCuePayload(@NonNull Iterator<String> iterator) {\n+        StringBuilder body = new StringBuilder();\n+        while (iterator.hasNext()) {\n+            String line = iterator.next();\n+            if (line.isEmpty()) {\n+                break;\n+            }\n+            body.append(line.strip());\n+            body.append(\" \");\n+        }\n+        return body.toString().strip();\n+    }\n+\n+}\n", "test_patch": "diff --git a/parser/transcript/src/test/java/de/danoeh/antennapod/parser/transcript/VttTranscriptParserTest.java b/parser/transcript/src/test/java/de/danoeh/antennapod/parser/transcript/VttTranscriptParserTest.java\nnew file mode 100644\nindex 00000000000..ed9a506e330\n--- /dev/null\n+++ b/parser/transcript/src/test/java/de/danoeh/antennapod/parser/transcript/VttTranscriptParserTest.java\n@@ -0,0 +1,172 @@\n+package de.danoeh.antennapod.parser.transcript;\n+\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.robolectric.RobolectricTestRunner;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import de.danoeh.antennapod.model.feed.Transcript;\n+\n+@RunWith(RobolectricTestRunner.class)\n+public class VttTranscriptParserTest {\n+\n+    private static String vttStrSimple = \"\"\"\n+        WEBVTT\n+\n+        00:00.000 --> 00:02.000\n+        Intro without speaker\n+\n+        00:00:02.000 --> 00:03.000\n+        Still no speaker\n+\n+        00:03.389 --> 00:00:09.000\n+        <v Speaker 1>This is the first speaker.\n+\n+        00:09.150 --> 00:12.123\n+        Let's assume it's still the first speaker.\n+\n+        00:13.000 --> 00:15.000\n+        <v Speaker 2>And this is the second.\n+\n+        00:15.000 --> 00:16.000\n+        <v Speaker 2>Still talking.\n+\n+        00:16.000 --> 00:18.000\n+        <v Speaker 2>Still same line.\n+\n+        00:18.000 --> 00:19.000\n+        <v Speaker 2>New line.\n+\n+        00:22.000 --> 00:26.500\n+        <v Speaker 2> Too long to collapse with previous.\n+\n+        00:36.000 --> 00:38.000\n+        <v Speaker 1>And again.\n+        Je suis speaker 1.\n+\n+        01:00:00.000 --> 01:00:01.000\n+        <v Speaker 1>Still talking after one hour.\"\"\";\n+\n+    // This is the same content as above, but with lots more WEBVTT features\n+    private static String vttStrComplex = \"\"\"\n+        WEBVTT\n+\n+        NOTE This is a note\n+\n+        00:00.000 --> 00:02.000\n+        Intro without speaker\n+\n+        00:00:02.000 --> 00:03.000\n+        Still no speaker\n+\n+        NOTE Here is an other note\n+\n+        First block with a speaker\n+        00:03.389 --> 00:00:09.000\n+        <v.first Speaker 1>This is the first speaker.\n+\n+        00:09.150 --> 00:12.123\n+        Let's assume it's still the first speaker.\n+\n+        00:13.000 --> 00:15.000\\tposition:90% align:right size:35%\n+        <v.second.loud Speaker 2>And this is the second.</v>\n+\n+        00:15.000 --> 00:16.000 position:10%,line-left align:left size:35%\n+        <v Speaker 2>Still talking.\n+\n+        00:16.000 --> 00:18.000\n+        <v Speaker 2>Still same line.\n+\n+        00:18.000 --> 00:19.000\n+        <v Speaker 2>New line.\n+\n+        00:22.000 --> 00:26.500\n+        <v Speaker 2> Too long to collapse with previous.\n+\n+        00:36.000 --> 00:38.000\n+        <v Speaker 1>And again.\n+        <i.foreignphrase><lang fr>Je suis</lang></i> speaker 1.\n+\n+        After one hour\n+        01:00:00.000 --> 01:00:01.000\n+        <v Speaker 1>Still talking after one hour.\"\"\";\n+\n+    private void checkResults(Transcript result) {\n+        assertEquals(\"Intro without speaker Still no speaker\", result.getSegmentAtTime(0L).getWords());\n+        assertEquals(\"\", result.getSegmentAtTime(0L).getSpeaker());\n+        assertEquals(3000L, result.getSegmentAtTime(0L).getEndTime());\n+\n+        assertEquals(\"This is the first speaker.\", result.getSegmentAtTime(3389L).getWords());\n+        assertEquals(\"Speaker 1\", result.getSegmentAtTime(3389L).getSpeaker());\n+        assertEquals(9000L, result.getSegmentAtTime(3389L).getEndTime());\n+\n+        assertEquals(\"Let's assume it's still the first speaker.\", result.getSegmentAtTime(9150L).getWords());\n+        assertEquals(\"Speaker 1\", result.getSegmentAtTime(9150L).getSpeaker());\n+        assertEquals(12123L, result.getSegmentAtTime(9150L).getEndTime());\n+\n+        assertEquals(\"And this is the second. Still talking. Still same line.\",\n+                result.getSegmentAtTime(13000L).getWords());\n+        assertEquals(\"Speaker 2\", result.getSegmentAtTime(13000L).getSpeaker());\n+        assertEquals(18000L, result.getSegmentAtTime(13000L).getEndTime());\n+\n+        assertEquals(\"New line.\", result.getSegmentAtTime(18000L).getWords());\n+        assertEquals(\"Speaker 2\", result.getSegmentAtTime(18000L).getSpeaker());\n+        assertEquals(19000L, result.getSegmentAtTime(18000L).getEndTime());\n+\n+        assertEquals(\"Too long to collapse with previous.\", result.getSegmentAtTime(22000L).getWords());\n+        assertEquals(\"Speaker 2\", result.getSegmentAtTime(22000L).getSpeaker());\n+        assertEquals(26500L, result.getSegmentAtTime(22000L).getEndTime());\n+\n+        assertEquals(\"And again. Je suis speaker 1.\", result.getSegmentAtTime(36000L).getWords());\n+        assertEquals(\"Speaker 1\", result.getSegmentAtTime(36000L).getSpeaker());\n+        assertEquals(38000L, result.getSegmentAtTime(36000L).getEndTime());\n+\n+        assertEquals(\"Still talking after one hour.\", result.getSegmentAtTime(10000000L).getWords());\n+        assertEquals(\"Speaker 1\", result.getSegmentAtTime(3600000L).getSpeaker());\n+        assertEquals(3601000L, result.getSegmentAtTime(3600000L).getEndTime());\n+    }\n+\n+    @Test\n+    public void testParseVttSimple() {\n+        Transcript result = VttTranscriptParser.parse(vttStrSimple);\n+        checkResults(result);\n+    }\n+\n+    @Test\n+    public void testParseVttComplex() {\n+        Transcript result = VttTranscriptParser.parse(vttStrComplex);\n+        checkResults(result);\n+    }\n+\n+    @Test\n+    public void testParse() {\n+        String type = \"text/vtt\";\n+        Transcript result;\n+\n+        result = TranscriptParser.parse(vttStrSimple, type);\n+        // There isn't a segment at 800L, so go backwards and get the segment at 0L\n+        assertEquals(\"Intro without speaker Still no speaker\", result.getSegmentAtTime(800L).getWords());\n+\n+        result = TranscriptParser.parse(null, type);\n+        assertNull(result);\n+\n+        // blank string\n+        result = TranscriptParser.parse(\"\", type);\n+        assertNull(result);\n+\n+        // All empty lines\n+        result = TranscriptParser.parse(\"\\r\\n\\r\\n\\r\\n\\r\\n\", type);\n+        assertNull(result);\n+\n+        // Just plain text\n+        result = TranscriptParser.parse(\"<v Speaker 1> Just text\", type);\n+        assertNull(result);\n+\n+        // passing the wrong type\n+        result = TranscriptParser.parse(vttStrSimple, \"application/srr\");\n+        assertNull(result);\n+        result = TranscriptParser.parse(vttStrSimple, \"unknown\");\n+        assertNull(result);\n+    }\n+}\n+\n", "problem_statement": "Support WebVTT transcript format\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.5.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Feature or improvement you want\n\nWe currently support SRT, JSON transcript.   We should add support for WebVTT as well.  Detailed reasons why certain podcast hosts are only supporting WebVTT here https://github.com/jamescridland/podnews/issues/2\n\n### Why should this be added?\n\nWider support of transcript\n\n### Screenshots / Drawings / Technical details\n\n```\r\ncurl https://podnews.net/rss > ~/Downloads/podnews.rss\r\n```\r\n\r\n```\r\n<podcast:transcript url=\"https://podnews.net/audio/podnews240927.mp3.vtt\" type=\"text/vtt\" rel=\"captions\"/>\r\n```\r\n\r\n```\r\ncurl https://podnews.net/audio/podnews240926.mp3.vtt | less\r\n\r\nWEBVTT\r\n\r\n00:00:00.000 --> 00:00:05.900\r\n<v James Cridland>Paid New York Times podcasts go to Apple and Spotify - from the Pacific Island of Niue,\r\n\r\n00:00:05.900 --> 00:00:13.100\r\nthe latest from Podnews.net with Podpage: making SEO-optimized podcast websites.\r\n\r\n00:00:13.100 --> 00:00:16.900\r\n<v Sabrina Tavernise>From the New York Times, I'm Sabrina Tavernise, and this is The Daily.\r\n\r\n00:00:16.900 --> 00:00:21.640\r\n<v James Cridland>The New York Times is to make its premium paid podcasts available for New York Times subscribers\r\n\r\n```\n", "hints_text": ":)\r\n\r\nThis is a good VTT to show, in that it has the speaker identification in it.\nHello,\r\nThanks a lot for the work already done on transcripts!\r\n\r\nI\u2019d very much like to see VTT support happening, and to that end I volunteer to try and add the feature.\r\n\r\nBut I see that @tonytamsf you already assigned yourself to that feature. Are you already working on this, or should I start an implementation on my end?\n@Shaac go ahead and start working on it. I will assign to you\nGreat!\r\n\r\nSo I started working on it and here is my progress so far [(you can look at the current work here)](https://github.com/AntennaPod/AntennaPod/compare/develop...Shaac:AntennaPod:vtt?expand=1).\r\n\r\nI added a third supported transcript format and used the following preference if several are present: JSON > VTT > SRT. Previously it was JSON > SRT, I inserted VTT in the middle, that is what made the most sense to me, but I guess it could be anything.\r\n\r\nFor the parser, I mostly copy-pasted the SRT one, since VTT is very similar. The issue with VTT is that there a many tags, that can add italics, bold, or other metadata. There a basically 3 options of what we can do with those tags. For instance, if the text is `<b>Hello</b> <i>you</i>`, we can either:\r\n\r\n- do nothing (and the text shown on screen will be ugly: \u201c`<b>Hello</b> <i>you</i>`\u201d)\r\n- properly ignore them (\u201cHello you\u201d)\r\n- show them in the final text (\u201c**Hello** _you_\u201d)\r\n\r\nOf course the third is the best, but it is the most work. I don\u2019t know if there are many podcast that use them. Maybe for now the first option will be enough. What do you think?\r\n\r\nThe only tag that is often used is the one identifying the speaker. I parsed it, but only if it is at the beginning of the text (if not it would be complex for us, because we would not have the timestamp for the change of speaker). I did not handle the fact that the tag could be closed (`</v>`), because I\u2019m not sure people use it.\nOne big issue I encountered though, and it seems to be more of architecture problem on the existing codebase, is that my feature only works for new episodes. If the podcast is already loaded with a version of AntennaPod on the branch `develop`, using my branch without uninstalling the app with not work for those episodes already present in the local DB.\r\n\r\nI did not manage to understand how the feed DB works just yet, but somehow, if a new `podcastIndexTranscriptType` is set, it will be overridden with the previous value (`null`) before it has time to write the new value into the database. The result is that if an episode has no transcript initially (or not supported transcript), AntennaPod will never be able to change that state in the future!\nMy vote for formatting is to store all the tags as is and strip it when we display (when you return the string/text)\n\nMaybe add a function to return the raw text for future use \n\n\n> So I started working on it and here is my progress so far\r\n\r\nNice! Could you please open a PR? That makes it easier to discuss the code by commenting on it.\r\n\r\n> For the parser, I mostly copy-pasted the SRT one\r\n\r\nAny chance for re-using parts of the code instead of copy-pasting? That ensures that in case we find a bug in one of them in the future, we cannot forget to apply the fix to the other one as well.\r\n\r\n> My vote for formatting is to store all the tags as is\r\n\r\nShowing the formatting should be quite easy: `textView.setText(Html.fromHtml(xy))`. What could be difficult is to make sure that the re-formatting step we do while displaying does not make the html invalid. Because of that, I think it might be easier to strip it already while parsing. Then one does not have to modify the re-formatting for now. I think we already have a function somewhere that strips the html of a feed's description.\r\n\r\n> my feature only works for new episodes\r\n\r\nDid you try force-refreshing? Swipe to refresh on the podcast screen performs a force-refresh even if the rss feed did not change (in contrast to refreshing on any other screen).\r\n\r\n> if a new podcastIndexTranscriptType is set, it will be overridden with the previous value\r\n\r\nHmm. If that's really the case, we should fix this :) But first please make sure to try force-refresh :)\nAll right, I wished I had time to work on this sooner, but I finally managed to find some. :smile: \r\n\r\n> Nice! Could you please open a PR? That makes it easier to discuss the code by commenting on it.\r\n\r\nDone\r\n\r\n> Any chance for re-using parts of the code instead of copy-pasting? That ensures that in case we find a bug in one of them in the future, we cannot forget to apply the fix to the other one as well.\r\n\r\nMy first reaction when reading this comment was \u201csure, of course, code duplication is awful; code should always be factorized\u201d. But then looking closely at the code I\u2019m not so sure. We\u2019re taking about parsing 2 different specs. Sure there are very close, but I\u2019ve seen in some other projects how factorizing parts of 2 slightly different, but still two independents things, can do more harm than wrong. Because then the code on both parts is complex, with lots of functions, and it becomes very hard to update one part without harming the other.\r\n\r\nThey are definitely some functions that should be factorize, like `parseTimecode`, which is the same for both. But apart from that, I\u2019m not so sure. Maybe it will be easier to make a decision when the feature is completed.\r\n\r\n> I think it might be easier to strip it already while parsing. Then one does not have to modify the re-formatting for now. I think we already have a function somewhere that strips the html of a feed's description.\r\n\r\nI found the `HtmlToPlainText` class in the codebase. But it\u2019s VTT spec here, it\u2019s not really HTML. I guess it should work because the tags look the same. I should probably write a test VTT file with all the features and either make a fake podcast with it or add some integration tests with it.\r\n\r\n> Did you try force-refreshing? Swipe to refresh on the podcast screen performs a force-refresh even if the rss feed did not change (in contrast to refreshing on any other screen).\r\n\r\nI think I tried it all. Going on the podcast view (with the list of episodes). Swiping down, or clicking on the 3 dots and hitting \u201crefresh\u201d. It will trigger a reprocessing of the data, but it fails with the following:\r\n- `FeedItem::setTranscriptUrl` is called, with the correct type (`text/vtt`) and URL\r\n- then for some reason `PodDBAdapter::updateOrInsertFeedItem` is called, but the type here is `null`\r\n- And then the `FeedItem` constructor used by DBReader will get called, with `transcriptType = null`\r\n\r\nI\u2019ve added some logs in my branch. It\u2019s easy to reproduce: without my branch, subscribe to podnews daily, launch an episode, there will be now transcript working (because it\u2019s VTT). Then checkout my branch, refresh and it still won\u2019t work. But clearing app data and starting over will.", "created_at": "2024-12-02T20:56:48Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7533, "instance_id": "AntennaPod__AntennaPod-7533", "issue_numbers": ["7531"], "base_commit": "41d4d9d7e11cb8c9d9c2b7a062b8bbb87621fa3e", "patch": "diff --git a/net/sync/service/src/main/java/de/danoeh/antennapod/net/sync/service/SyncService.java b/net/sync/service/src/main/java/de/danoeh/antennapod/net/sync/service/SyncService.java\nindex fd8ed94a4c..ba411327a8 100644\n--- a/net/sync/service/src/main/java/de/danoeh/antennapod/net/sync/service/SyncService.java\n+++ b/net/sync/service/src/main/java/de/danoeh/antennapod/net/sync/service/SyncService.java\n@@ -112,7 +112,7 @@ public Result doWork() {\n \n     private boolean someFeedWasNotRefreshedYet() {\n         for (Feed feed : DBReader.getFeedList()) {\n-            if (feed.getLastRefreshAttempt() == 0) {\n+            if (feed.getPreferences().getKeepUpdated() && feed.getLastRefreshAttempt() == 0) {\n                 return true;\n             }\n         }\n", "test_patch": "", "problem_statement": "Podcasts constantly update in background on 3.6.0-beta1\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.6.0-beta1\n\n### Android version\n\n15\n\n### Device model\n\nPixel 7\n\n### First occurred\n\nUnsure, noticed it today\n\n### Steps to reproduce\n\n1. Set an automatic background update interval \r\n2. Have some podcasts that should be kept up to date\n\n### Expected behaviour\n\nPodcasts should refresh once in each interval\n\n### Current behaviour\n\nPodcasts refresh repeatedly, seemingly indefinitely, causing lots of network traffic and battery drainage.\r\n\r\n**More detailed description:**\r\nIn my notifications, I can see how all my subscriptions get updated (the number of downloads left decrements). After reaching 1, the notification disappears. However, after a few seconds, the notification re-appears and again begins with updating all subscriptions.\r\nSometimes it seems like the update is cancelled while there are ~30 downloads left. The notification then also disappears and a new download starts after a few seconds.\r\nThis leads to high battery and network usage. Android tells me that AntennaPod used 66% of my battery today, while I only listened to podcasts for about 2 hours.\n\n### Logs\n\nI can send them if needed\n", "hints_text": "Do you use synchronization? Does this stop if you (make a backup and) log out from the sync server?\nYes and yes, it seems to stop if sync is turned off.\r\n\r\nedit: I turned sync back on and the problem was back directly. So it's definitely connected to that.\nAh, thanks! I was having the same issue and disabling sync fixed it for me as well. \n\n- Android version: 14\n- OS version: 6.1.75-android14-11\n- AntennaPod version: 3.6.0-beta1\n- Model: SM-S921B\n- Sync: Nextcloud\nNote to self: I think this could be caused by subscriptions having updates disabled. Then the service never detects them as up-to-date and starts a refresh. We should probably skip the check for those.", "created_at": "2024-11-28T16:02:03Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7529, "instance_id": "AntennaPod__AntennaPod-7529", "issue_numbers": ["7499"], "base_commit": "f8b058871c9045c42a46436c2696022c566d5bb2", "patch": "diff --git a/app/src/main/AndroidManifest.xml b/app/src/main/AndroidManifest.xml\nindex 55b1eaeb96..bd4a4260b1 100644\n--- a/app/src/main/AndroidManifest.xml\n+++ b/app/src/main/AndroidManifest.xml\n@@ -178,7 +178,8 @@\n             android:configChanges=\"keyboardHidden|orientation|screenSize|screenLayout|smallestScreenSize\"\n             android:supportsPictureInPicture=\"true\"\n             android:screenOrientation=\"sensorLandscape\"\n-            android:exported=\"false\">\n+            android:exported=\"false\"\n+            tools:ignore=\"DiscouragedApi\">\n             <meta-data\n                 android:name=\"android.support.PARENT_ACTIVITY\"\n                 android:value=\"de.danoeh.antennapod.activity.MainActivity\"/>\ndiff --git a/build.gradle b/build.gradle\nindex 6eaf7c0feb..6be956e2fc 100644\n--- a/build.gradle\n+++ b/build.gradle\n@@ -1,5 +1,5 @@\n buildscript {\n-    ext.agpVersion = \"8.1.1\"\n+    ext.agpVersion = \"8.5.2\"\n }\n plugins {\n     id 'com.android.application' version \"$agpVersion\" apply false\ndiff --git a/common.gradle b/common.gradle\nindex a2cd80852f..8cb35acb56 100644\n--- a/common.gradle\n+++ b/common.gradle\n@@ -54,6 +54,7 @@ android {\n \n     buildFeatures {\n         viewBinding true\n+        buildConfig true\n     }\n }\n \ndiff --git a/gradle.properties b/gradle.properties\nindex 15553a59c4..19058640ca 100644\n--- a/gradle.properties\n+++ b/gradle.properties\n@@ -1,4 +1,3 @@\n android.useAndroidX=true\n org.gradle.jvmargs=-Xmx4096m\n-android.defaults.buildfeatures.buildconfig=true\n android.nonTransitiveRClass=false\ndiff --git a/gradle/wrapper/gradle-wrapper.properties b/gradle/wrapper/gradle-wrapper.properties\nindex a80b22ce5c..9355b41557 100644\n--- a/gradle/wrapper/gradle-wrapper.properties\n+++ b/gradle/wrapper/gradle-wrapper.properties\n@@ -1,6 +1,6 @@\n distributionBase=GRADLE_USER_HOME\n distributionPath=wrapper/dists\n-distributionUrl=https\\://services.gradle.org/distributions/gradle-8.6-bin.zip\n+distributionUrl=https\\://services.gradle.org/distributions/gradle-8.10-bin.zip\n networkTimeout=10000\n validateDistributionUrl=true\n zipStoreBase=GRADLE_USER_HOME\ndiff --git a/ui/i18n/src/main/res/values-ja/strings.xml b/ui/i18n/src/main/res/values-ja/strings.xml\nindex ef03312cb1..efcd434f9a 100644\n--- a/ui/i18n/src/main/res/values-ja/strings.xml\n+++ b/ui/i18n/src/main/res/values-ja/strings.xml\n@@ -217,8 +217,6 @@\n     <string name=\"download_running\">\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5b9f\u884c\u4e2d</string>\n     <string name=\"download_error_details\">\u8a73\u7d30</string>\n     <string name=\"download_log_details_message\">%1$s \\n\\n\u6280\u8853\u7684\u306a\u7406\u7531: \\n%2$s \\n\\n\u30d5\u30a1\u30a4\u30eb URL:\\n%3$s</string>\n-    <string name=\"download_error_retrying\">\\\\%1$s\\\\ \u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u5f8c\u307b\u3069\u518d\u5ea6\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3092\u8a66\u307f\u307e\u3059\u3002</string>\n-    <string name=\"download_error_not_retrying\">\\\\%1$s\\\\ \u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002</string>\n     <string name=\"download_error_tap_for_details\">\u30bf\u30c3\u30d7\u3057\u3066\u8a73\u7d30\u3092\u8868\u793a\u3057\u307e\u3059\u3002</string>\n     <string name=\"download_error_device_not_found\">\u30b9\u30c8\u30ec\u30fc\u30b8 \u30c7\u30d0\u30a4\u30b9\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093</string>\n     <string name=\"download_error_insufficient_space\">\u30c7\u30d0\u30a4\u30b9\u306b\u5341\u5206\u306a\u7a7a\u304d\u30b9\u30da\u30fc\u30b9\u304c\u3042\u308a\u307e\u305b\u3093\u3002</string>\n@@ -465,7 +463,6 @@\n   <string name=\"search_status_no_results\">\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f</string>\n     <string name=\"type_to_search\">\u691c\u7d22\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044</string>\n     <string name=\"search_label\">\u691c\u7d22</string>\n-    <string name=\"no_results_for_query\">\\\\%1$s\\\\ \u306e\u7d50\u679c\u306f\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f</string>\n     <string name=\"search_online\">\u30aa\u30f3\u30e9\u30a4\u30f3\u3067\u691c\u7d22</string>\n     <!--Synchronization-->\n   <string name=\"sync_status_started\">\u540c\u671f\u958b\u59cb</string>\n", "test_patch": "", "problem_statement": "Build fails in Android Studio (Gradle 8.1.1 and JDK 21)\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\nNA\n\n### Where did you get the app from\n\nOther\n\n### Android version\n\nNA\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\nThe debug build (both in the develop and master branch) fails with the current Android Studio:\r\n\r\n    Android Studio Ladybug | 2024.2.1 Patch 2\r\n    Build #AI-242.23339.11.2421.12550806, built on October 24, 2024\r\n    Runtime version: 21.0.3+-12282718-b509.11 amd64\r\n\r\nSee build errors below.\r\n\r\nThe reason could be some JDK 17 / JDK 21 incompatibility.\r\n\r\nAndroid Studio suggests running the \"AGP Upgrade Assistant\" to migrate from Gradle 8.1.1 to 8.7.2.\r\nThis solves the build problem with JDK 21. I have not tested it with JDK 17.\r\n\r\n\r\n\r\nBuild fails with errors:\r\n\r\n    FAILURE: Build completed with 4 failures.\r\n\r\n    1: Task failed with an exception.\r\n    -----------\r\n    * What went wrong:\r\n    Execution failed for task ':model:compileDebugJavaWithJavac'.\r\n    > Could not resolve all files for configuration ':model:androidJdkImage'.\r\n       > Failed to transform core-for-system-modules.jar to match attributes {artifactType=_internal_android_jdk_image, org.gradle.libraryelements=jar, org.gradle.usage=java-runtime}.\r\n          > Execution failed for JdkImageTransform: /home/willem/opt/android-sdk-linux/platforms/android-34/core-for-system-modules.jar.\r\n             > Error while executing process /home/willem/opt/android-studio/jbr/bin/jlink with arguments {--module-path /home/willem/.gradle/caches/transforms-4/9a7ee21472c198d770ae60685527dcce-324af383-23dc-4a33-be1b-155c2ccba6b9/transformed/output/temp/jmod --add-modules java.base --output /home/willem/.gradle/caches/transforms-4/9a7ee21472c198d770ae60685527dcce-324af383-23dc-4a33-be1b-155c2ccba6b9/transformed/output/jdkImage --disable-plugin system-modules}\r\n\r\n    * Try:\r\n    > Run with --stacktrace option to get the stack trace.\r\n    > Run with --info or --debug option to get more log output.\r\n    > Run with --scan to get full insights.\r\n    > Get more help at https://help.gradle.org.\r\n    ==============================================================================\r\n\r\n    2: Task failed with an exception.\r\n    -----------\r\n    * What went wrong:\r\n    Execution failed for task ':net:ssl:compileFreeDebugJavaWithJavac'.\r\n    > Could not resolve all files for configuration ':net:ssl:androidJdkImage'.\r\n       > Failed to transform core-for-system-modules.jar to match attributes {artifactType=_internal_android_jdk_image, org.gradle.libraryelements=jar, org.gradle.usage=java-runtime}.\r\n          > Execution failed for JdkImageTransform: /home/willem/opt/android-sdk-linux/platforms/android-34/core-for-system-modules.jar.\r\n             > Error while executing process /home/willem/opt/android-studio/jbr/bin/jlink with arguments {--module-path /home/willem/.gradle/caches/transforms-4/9a7ee21472c198d770ae60685527dcce-324af383-23dc-4a33-be1b-155c2ccba6b9/transformed/output/temp/jmod --add-modules java.base --output /home/willem/.gradle/caches/transforms-4/9a7ee21472c198d770ae60685527dcce-324af383-23dc-4a33-be1b-155c2ccba6b9/transformed/output/jdkImage --disable-plugin system-modules}\r\n\r\n    * Try:\r\n    > Run with --stacktrace option to get the stack trace.\r\n    > Run with --info or --debug option to get more log output.\r\n    > Run with --scan to get full insights.\r\n    > Get more help at https://help.gradle.org.\r\n    ==============================================================================\r\n\r\n    3: Task failed with an exception.\r\n    -----------\r\n    * What went wrong:\r\n    Execution failed for task ':ui:i18n:compileDebugJavaWithJavac'.\r\n    > Could not resolve all files for configuration ':ui:i18n:androidJdkImage'.\r\n       > Failed to transform core-for-system-modules.jar to match attributes {artifactType=_internal_android_jdk_image, org.gradle.libraryelements=jar, org.gradle.usage=java-runtime}.\r\n          > Execution failed for JdkImageTransform: /home/willem/opt/android-sdk-linux/platforms/android-34/core-for-system-modules.jar.\r\n             > Error while executing process /home/willem/opt/android-studio/jbr/bin/jlink with arguments {--module-path /home/willem/.gradle/caches/transforms-4/9a7ee21472c198d770ae60685527dcce-324af383-23dc-4a33-be1b-155c2ccba6b9/transformed/output/temp/jmod --add-modules java.base --output /home/willem/.gradle/caches/transforms-4/9a7ee21472c198d770ae60685527dcce-324af383-23dc-4a33-be1b-155c2ccba6b9/transformed/output/jdkImage --disable-plugin system-modules}\r\n\r\n    * Try:\r\n    > Run with --stacktrace option to get the stack trace.\r\n    > Run with --info or --debug option to get more log output.\r\n    > Run with --scan to get full insights.\r\n    > Get more help at https://help.gradle.org.\r\n    ==============================================================================\r\n\r\n    4: Task failed with an exception.\r\n    -----------\r\n    * What went wrong:\r\n    Execution failed for task ':ui:app-start-intent:compileDebugJavaWithJavac'.\r\n    > Could not resolve all files for configuration ':ui:app-start-intent:androidJdkImage'.\r\n       > Failed to transform core-for-system-modules.jar to match attributes {artifactType=_internal_android_jdk_image, org.gradle.libraryelements=jar, org.gradle.usage=java-runtime}.\r\n          > Execution failed for JdkImageTransform: /home/willem/opt/android-sdk-linux/platforms/android-34/core-for-system-modules.jar.\r\n             > Error while executing process /home/willem/opt/android-studio/jbr/bin/jlink with arguments {--module-path /home/willem/.gradle/caches/transforms-4/9a7ee21472c198d770ae60685527dcce-324af383-23dc-4a33-be1b-155c2ccba6b9/transformed/output/temp/jmod --add-modules java.base --output /home/willem/.gradle/caches/transforms-4/9a7ee21472c198d770ae60685527dcce-324af383-23dc-4a33-be1b-155c2ccba6b9/transformed/output/jdkImage --disable-plugin system-modules}\r\n\r\n    * Try:\r\n    > Run with --stacktrace option to get the stack trace.\r\n    > Run with --info or --debug option to get more log output.\r\n    > Run with --scan to get full insights.\r\n    > Get more help at https://help.gradle.org.\r\n    ==============================================================================\r\n\r\n    Deprecated Gradle features were used in this build, making it incompatible with Gradle 9.0.\r\n\r\n    You can use '--warning-mode all' to show the individual deprecation warnings and determine if they come from your own scripts or plugins.\r\n\r\n    For more on this, please refer to https://docs.gradle.org/8.6/userguide/command_line_interface.html#sec:command_line_warnings in the Gradle documentation.\r\n\r\n    BUILD FAILED in 41s\r\n\n\n### Expected behaviour\n\n_No response_\n\n### Current behaviour\n\n_No response_\n\n### Logs\n\n_No response_\n", "hints_text": "Different versions of Gradle need different versions of Java. Try with Java 17. See also https://docs.gradle.org/current/userguide/compatibility.html", "created_at": "2024-11-27T21:07:11Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7526, "instance_id": "AntennaPod__AntennaPod-7526", "issue_numbers": ["7514", "7513"], "base_commit": "addef8bcc3d644904f0201d2cabf3b8453850981", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\nindex 6cdf6885f8..6e1dfa56e1 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\n@@ -411,6 +411,7 @@ public void onQueueChanged(QueueEvent event) {\n \n     @Override\n     public void onStartSelectMode() {\n+        viewBinding.floatingSelectMenu.setVisibility(View.VISIBLE);\n         swipeActions.detach();\n         updateRecyclerPadding();\n         updateToolbar();\ndiff --git a/ui/common/src/main/res/drawable/ic_delete_auto.xml b/ui/common/src/main/res/drawable/ic_delete_auto.xml\nindex 9ed6abd247..f329861626 100644\n--- a/ui/common/src/main/res/drawable/ic_delete_auto.xml\n+++ b/ui/common/src/main/res/drawable/ic_delete_auto.xml\n@@ -5,11 +5,11 @@\n     android:viewportHeight=\"24\">\n   <path\n       android:pathData=\"M15,2l-3.5,0l-1,-1l-5,0l-1,1l-3.5,0l0,2l14,0z\"\n-      android:fillColor=\"#000000\"/>\n+      android:fillColor=\"?attr/action_icon_color\"/>\n   <path\n       android:pathData=\"M16,9c-0.7,0 -1.37,0.1 -2,0.29V5H2v12c0,1.1 0.9,2 2,2h5.68c1.12,2.36 3.53,4 6.32,4c3.87,0 7,-3.13 7,-7C23,12.13 19.87,9 16,9zM9,16c0,0.34 0.03,0.67 0.08,1H4V7h8v3.26C10.19,11.53 9,13.62 9,16zM16,21c-2.76,0 -5,-2.24 -5,-5s2.24,-5 5,-5s5,2.24 5,5S18.76,21 16,21z\"\n-      android:fillColor=\"#000000\"/>\n+      android:fillColor=\"?attr/action_icon_color\"/>\n   <path\n       android:pathData=\"M16.5,12l-1.5,0l0,5l3.6,2.1l0.8,-1.2l-2.9,-1.7z\"\n-      android:fillColor=\"#000000\"/>\n+      android:fillColor=\"?attr/action_icon_color\"/>\n </vector>\n", "test_patch": "", "problem_statement": "Icon of 'Delete after playing' multiselect option is black in dark theme\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.6.0-beta1\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n14\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Go to the subscriptions screen\r\n2. Long-press a podcast\r\n3. Tap 'Multi select'\n\n### Expected behaviour\n\nThe option 'Delete after playing' has a legeble icon, also in the dark theme.\n\n### Current behaviour\n\nThe option has a black icon in the dark theme:\r\n![picturecache_0](https://github.com/user-attachments/assets/2c8639d0-0e2f-4f32-bdd7-6fd53075d48b)\n\n### Logs\n\n_No response_\nMulti select bar not displayed on podcast screen\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.6.0-beta1\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n14\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Go to a podcast detail screen\r\n2. Long-press an episode\r\n3. Tap 'Multi select'\n\n### Expected behaviour\n\nShow the multi select bar (like for the Inbox)\n\n### Current behaviour\n\nThe multi select bar is not shown\r\n![picturecache_0](https://github.com/user-attachments/assets/af85d598-e1a8-4df0-9d1d-2ae3d79993e3)\n\n### Logs\n\n_No response_\n", "hints_text": "\nI can also reproduce this. Thanks @keunes for pinpointing the issue, my quick testing was taking me in the wrong direction on this. ", "created_at": "2024-11-26T23:13:59Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7525, "instance_id": "AntennaPod__AntennaPod-7525", "issue_numbers": ["7515"], "base_commit": "addef8bcc3d644904f0201d2cabf3b8453850981", "patch": "diff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 6784ab66f1..c4be3ab667 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -19,7 +19,7 @@\n     <string name=\"open_autodownload_settings\">Open settings</string>\n     <string name=\"downloads_log_label\">Download log</string>\n     <string name=\"subscriptions_label\">Subscriptions</string>\n-    <string name=\"subscriptions_list_label\">Subscriptions list</string>\n+    <string name=\"subscriptions_list_label\">Subscriptions list (side menu only)</string>\n     <string name=\"cancel_download_label\">Cancel download</string>\n     <string name=\"playback_history_label\">Playback history</string>\n     <string name=\"episode_cache_full_title\">Episode cache full</string>\n", "test_patch": "", "problem_statement": "Clarify \"Subscriptions list\" in bottom navigation settings\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n### App version\r\n\r\n3.6.0-beta1\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Android version\r\n\r\n12\r\n\r\n### Device model\r\n\r\n_No response_\r\n\r\n### First occurred\r\n\r\n_No response_\r\n\r\n### Steps to reproduce\r\n\r\n1. Enable bottom navigation\r\n2. Tap on More, then Customize navigation\r\n3. If the Subscriptions list is hidden, drag it to an early position in the Shown section\r\n\r\n### Expected behaviour\r\n\r\n4. Something happens - e.g. the user is prevented from showing this specific screen, and/or a toast message is displayed\r\n\r\n| \u2139\ufe0f | **Implementation instructions**|\r\n|---|:---|\r\n| | This request has been discussed further below. If you're interested in implementing this, please see the  [conclusions relevant for implementation below](https://github.com/AntennaPod/AntennaPod/issues/7515#issuecomment-2492223782).<br><sub>The original post has been edited by the project maintainers to add this link.</sub> |\r\n\r\n### Current behaviour\r\n\r\n4. The setting is saved, but the UI doesn't change.\r\n\r\nI imagine this might be due to the drawer and the bottom navigation sharing some code for the time being.\r\n\r\n### Logs\r\n\r\n_No response_\n", "hints_text": "Yeah, it is a bit confusing. It's not a bug; the 'Subscription list' is the list that's visible only in the side menu and can't work in the bottom menu.\n\nNot sure a modal is needed, but we can clarify in the settings directly, by changing the label: \"Subscriptions list (side menu only)\"\n> we can clarify in the settings directly, by changing the label: \"Subscriptions list (side menu only)\"\r\n\r\nGood idea!", "created_at": "2024-11-26T22:53:08Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7524, "instance_id": "AntennaPod__AntennaPod-7524", "issue_numbers": ["7516"], "base_commit": "addef8bcc3d644904f0201d2cabf3b8453850981", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\nindex 240e21b58d..5ec0c9d89d 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n@@ -44,6 +44,7 @@\n import com.google.android.material.snackbar.Snackbar;\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n+import de.danoeh.antennapod.event.FeedListUpdateEvent;\n import de.danoeh.antennapod.event.FeedUpdateRunningEvent;\n import de.danoeh.antennapod.event.MessageEvent;\n import de.danoeh.antennapod.event.UnreadItemsUpdateEvent;\n@@ -524,11 +525,20 @@ private void buildBottomNavigationMenu() {\n         MenuItem moreItem = menu.add(0, R.id.bottom_navigation_more, 0, getString(R.string.searchpreference_more));\n         moreItem.setIcon(R.drawable.dots_vertical);\n         bottomNavigationView.setOnItemSelectedListener(bottomItemSelectedListener);\n-        updateBottomNavigationBadgeIfNeeded(null);\n+        updateBottomNavigationBadgeIfNeeded();\n     }\n \n-    @Subscribe\n-    public void updateBottomNavigationBadgeIfNeeded(@Nullable UnreadItemsUpdateEvent ignore) {\n+    @Subscribe(threadMode = ThreadMode.MAIN)\n+    public void onUnreadItemsChanged(UnreadItemsUpdateEvent event) {\n+        updateBottomNavigationBadgeIfNeeded();\n+    }\n+\n+    @Subscribe(threadMode = ThreadMode.MAIN)\n+    public void onFeedListChanged(FeedListUpdateEvent event) {\n+        updateBottomNavigationBadgeIfNeeded();\n+    }\n+\n+    private void updateBottomNavigationBadgeIfNeeded() {\n         if (bottomNavigationView == null) {\n             return;\n         } else if (bottomNavigationView.getMenu().findItem(R.id.bottom_navigation_inbox) == null) {\n", "test_patch": "", "problem_statement": "Bottom navigation: Inbox item counter is only populated after reopening the app\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.6.0-beta1\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Open the app\r\n2. Manually refresh feeds (e.g. from the queue screen) and have episodes land in the inbox\n\n### Expected behaviour\n\n3. The inbox immediately displays an item counter, to make it evident to the user that episodes have landed there\n\n### Current behaviour\n\n3. The inbox does not immediately display an item counter. It displays one only if the user reopens the app.\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2024-11-26T22:50:24Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7520, "instance_id": "AntennaPod__AntennaPod-7520", "issue_numbers": ["7510"], "base_commit": "addef8bcc3d644904f0201d2cabf3b8453850981", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodesListFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodesListFragment.java\nindex bd4a085bb4..a6bddc2fa3 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodesListFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodesListFragment.java\n@@ -67,7 +67,7 @@ public abstract class EpisodesListFragment extends Fragment\n     protected int page = 1;\n     protected boolean isLoadingMore = false;\n     protected boolean hasMoreItems = false;\n-    private boolean displayUpArrow;\n+    protected boolean displayUpArrow;\n \n     protected EpisodeItemListRecyclerView recyclerView;\n     protected EpisodeItemListAdapter listAdapter;\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/AllEpisodesFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/AllEpisodesFragment.java\nindex f555a91372..eee2657c28 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/AllEpisodesFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/AllEpisodesFragment.java\n@@ -42,6 +42,11 @@ public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container,\n         updateFilterUi();\n         txtvInformation.setOnClickListener(\n                 v -> AllEpisodesFilterDialog.newInstance(getFilter()).show(getChildFragmentManager(), null));\n+\n+        boolean largePadding = displayUpArrow || !UserPreferences.isBottomNavigationEnabled();\n+        int paddingHorizontal = (int) (getResources().getDisplayMetrics().density * (largePadding ? 60 : 16));\n+        int paddingVertical = (int) (getResources().getDisplayMetrics().density * 4);\n+        txtvInformation.setPadding(paddingHorizontal, paddingVertical, paddingHorizontal, paddingVertical);\n         return root;\n     }\n \ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java\nindex 7832007b3f..ae469de0bf 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java\n@@ -408,6 +408,10 @@ public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle sa\n         progressBar.setVisibility(View.VISIBLE);\n \n         infoBar = root.findViewById(R.id.info_bar);\n+        boolean largePadding = displayUpArrow || !UserPreferences.isBottomNavigationEnabled();\n+        int paddingHorizontal = (int) (getResources().getDisplayMetrics().density * (largePadding ? 60 : 16));\n+        infoBar.setPadding(paddingHorizontal, 0, paddingHorizontal, 0);\n+\n         recyclerView = root.findViewById(R.id.recyclerView);\n         RecyclerView.ItemAnimator animator = recyclerView.getItemAnimator();\n         if (animator instanceof SimpleItemAnimator) {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/SubscriptionFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/SubscriptionFragment.java\nindex 31b1e7d26d..68c98ce0db 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/SubscriptionFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/SubscriptionFragment.java\n@@ -9,7 +9,6 @@\n import android.view.MenuItem;\n import android.view.View;\n import android.view.ViewGroup;\n-import android.widget.LinearLayout;\n import android.widget.ProgressBar;\n \n import androidx.annotation.NonNull;\n@@ -75,7 +74,7 @@ public class SubscriptionFragment extends Fragment\n     private RecyclerView subscriptionRecycler;\n     private SubscriptionsRecyclerAdapter subscriptionAdapter;\n     private EmptyViewHandler emptyView;\n-    private LinearLayout feedsFilteredMsg;\n+    private View feedsFilteredMsg;\n     private MaterialToolbar toolbar;\n     private SwipeRefreshLayout swipeRefreshLayout;\n     private ProgressBar progressBar;\n@@ -163,6 +162,10 @@ public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMen\n         feedsFilteredMsg = root.findViewById(R.id.feeds_filtered_message);\n         feedsFilteredMsg.setOnClickListener((l) ->\n                 new SubscriptionsFilterDialog().show(getChildFragmentManager(), \"filter\"));\n+        boolean largePadding = displayUpArrow || !UserPreferences.isBottomNavigationEnabled();\n+        int paddingHorizontal = (int) (getResources().getDisplayMetrics().density * (largePadding ? 60 : 16));\n+        int paddingVertical = (int) (getResources().getDisplayMetrics().density * 4);\n+        feedsFilteredMsg.setPadding(paddingHorizontal, paddingVertical, paddingHorizontal, paddingVertical);\n \n         swipeRefreshLayout = root.findViewById(R.id.swipeRefresh);\n         swipeRefreshLayout.setDistanceToTriggerSync(getResources().getInteger(R.integer.swipe_refresh_distance));\ndiff --git a/app/src/main/res/layout/episodes_list_fragment.xml b/app/src/main/res/layout/episodes_list_fragment.xml\nindex b88e677372..34e0ba0982 100644\n--- a/app/src/main/res/layout/episodes_list_fragment.xml\n+++ b/app/src/main/res/layout/episodes_list_fragment.xml\n@@ -24,11 +24,10 @@\n             android:layout_width=\"match_parent\"\n             android:layout_height=\"wrap_content\"\n             android:background=\"?attr/selectableItemBackground\"\n-            android:paddingBottom=\"8dp\"\n             android:text=\"@string/filtered_label\"\n-            android:layout_marginTop=\"-12dp\"\n-            android:layout_marginLeft=\"60dp\"\n-            android:layout_marginStart=\"60dp\"\n+            android:layout_marginTop=\"-16dp\"\n+            android:paddingVertical=\"4dp\"\n+            android:paddingHorizontal=\"16dp\"\n             android:visibility=\"gone\"\n             tools:visibility=\"visible\" />\n \ndiff --git a/app/src/main/res/layout/fragment_subscriptions.xml b/app/src/main/res/layout/fragment_subscriptions.xml\nindex dc8b24e41d..16c69bd0cb 100644\n--- a/app/src/main/res/layout/fragment_subscriptions.xml\n+++ b/app/src/main/res/layout/fragment_subscriptions.xml\n@@ -20,30 +20,15 @@\n             app:navigationContentDescription=\"@string/toolbar_back_button_content_description\"\n             app:navigationIcon=\"?homeAsUpIndicator\" />\n \n-        <LinearLayout\n+        <TextView\n             android:id=\"@+id/feeds_filtered_message\"\n             android:layout_width=\"match_parent\"\n             android:layout_height=\"wrap_content\"\n-            android:paddingStart=\"60dp\"\n-            android:paddingEnd=\"0dp\"\n+            android:paddingHorizontal=\"16dp\"\n             android:paddingVertical=\"4dp\"\n-            android:layout_marginTop=\"-12dp\"\n+            android:layout_marginTop=\"-16dp\"\n             android:background=\"?android:attr/selectableItemBackground\"\n-            android:gravity=\"center_vertical\"\n-            android:orientation=\"horizontal\">\n-\n-            <ImageView\n-                android:layout_width=\"20dp\"\n-                android:layout_height=\"20dp\"\n-                android:src=\"@drawable/ic_info\" />\n-\n-            <TextView\n-                android:layout_width=\"match_parent\"\n-                android:layout_height=\"wrap_content\"\n-                android:layout_marginLeft=\"4dp\"\n-                android:text=\"@string/subscriptions_are_filtered\" />\n-\n-        </LinearLayout>\n+            android:text=\"@string/filtered_label\" />\n \n     </com.google.android.material.appbar.AppBarLayout>\n \ndiff --git a/app/src/main/res/layout/nav_section_item.xml b/app/src/main/res/layout/nav_section_item.xml\nindex 8596ad80a2..12f2bc091d 100644\n--- a/app/src/main/res/layout/nav_section_item.xml\n+++ b/app/src/main/res/layout/nav_section_item.xml\n@@ -36,7 +36,7 @@\n             android:layout_marginStart=\"4dp\"\n             android:gravity=\"start\"\n             android:paddingTop=\"4dp\"\n-            android:text=\"@string/subscriptions_are_filtered\"\n+            android:text=\"@string/filtered_label\"\n             android:textColor=\"?android:attr/textColorSecondary\"\n             android:textSize=\"@dimen/text_size_small\" />\n \ndiff --git a/app/src/main/res/layout/queue_fragment.xml b/app/src/main/res/layout/queue_fragment.xml\nindex f42df9f9b8..e92c2b1d94 100644\n--- a/app/src/main/res/layout/queue_fragment.xml\n+++ b/app/src/main/res/layout/queue_fragment.xml\n@@ -28,8 +28,7 @@\n             android:layout_below=\"@id/toolbar\"\n             android:textSize=\"12sp\"\n             android:layout_marginTop=\"-12dp\"\n-            android:layout_marginLeft=\"60dp\"\n-            android:layout_marginStart=\"60dp\"\n+            android:paddingHorizontal=\"16dp\"\n             android:layout_marginBottom=\"8dp\"\n             tools:text=\"12 Episodes - Time remaining: 12 hours\" />\n \ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 6784ab66f1..55af60dd71 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -527,7 +527,6 @@\n     <string name=\"pref_delete_removes_from_queue_sum\">Automatically remove an episode from the queue when it is deleted</string>\n     <string name=\"pref_filter_feed_title\">Subscription filter</string>\n     <string name=\"pref_filter_feed_sum\">Filter your subscriptions in navigation drawer and subscriptions screen</string>\n-    <string name=\"subscriptions_are_filtered\">Subscriptions are filtered.</string>\n     <string name=\"subscriptions_counter_greater_zero\">Counter greater than zero</string>\n     <string name=\"auto_downloaded\">Auto downloaded</string>\n     <string name=\"not_auto_downloaded\">Not auto downloaded</string>\n", "test_patch": "", "problem_statement": "Misaligned text on queue screen with bottom navigation on\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.6.0-beta1\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. With the default settings, notice that the \"Queue\" screen title and the line immediately below are aligned\r\n2. Turn bottom navigation on\n\n### Expected behaviour\n\n3. The \"Queue\" screen title and the line below are still aligned (to the left, in an English locale)\n\n### Current behaviour\n\n3. The \"Queue\" title is now aligned to the left, but the line below is still indented (as if the hamburger menu icon was present).\n\n### Logs\n\n_No response_\n", "hints_text": "Instructions for someone implementing: Remove the spacing, no matter what navigation type was selected. That's easier and should still look acceptable with side navigation. Also, we want to remove side navigation at some point in the future.\r\n\r\nScreens to adapt:\r\n- Subscriptions filter\r\n- All episodes filter\r\n- Queue statistics\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/needs-decision-meeting-updates/4169/12\n\n> Instructions for someone implementing: Remove the spacing, no matter what navigation type was selected. That's easier and should still look acceptable with side navigation. Also, we want to remove side navigation at some point in the future.\r\n> \r\n> Screens to adapt:\r\n> \r\n>     * Subscriptions filter\r\n> \r\n>     * All episodes filter\r\n> \r\n>     * Queue statistics\r\n\r\nThanks for the detailed instructions! I\u2019m currently working on removing the extra spacing between the \"Queue\" title and the line below. I\u2019ll be applying this fix across the Subscriptions filter, All episodes filter, and Queue statistics screens. Once done, I\u2019ll make sure the layout remains consistent and looks good with both side and bottom navigation. I'll keep you updated on my progress!\nNote that this is about the horizontal spacing, not the vertical spacing between the title and the subtitle. Your message sounds like you are working on vertical spacing. If that's the case, we should discuss this first before you work on all screens \n> Note that this is about the horizontal spacing, not the vertical spacing between the title and the subtitle. Your message sounds like you are working on vertical spacing. If that's the case, we should discuss this first before you work on all screens \n\nYes i have understood the issue and am working on the horizontal spacing only. If you want, we can discuss after I have solved on the first screen, i.e., subscription filter screen.\n", "created_at": "2024-11-24T18:26:44Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7466, "instance_id": "AntennaPod__AntennaPod-7466", "issue_numbers": ["7451"], "base_commit": "5c47fd24688c2c54db45302ac8ad8a0a9c000445", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/onlinefeedview/OnlineFeedViewActivity.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/onlinefeedview/OnlineFeedViewActivity.java\nindex 952c4f1572..f0fe13cbc2 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/onlinefeedview/OnlineFeedViewActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/onlinefeedview/OnlineFeedViewActivity.java\n@@ -102,15 +102,11 @@ protected void onCreate(Bundle savedInstanceState) {\n             feedUrl = getIntent().getDataString();\n         }\n \n-        if (feedUrl == null) {\n+        if (feedUrl == null || UrlChecker.isDeeplinkWithoutUrl(feedUrl)) {\n             Log.e(TAG, \"feedUrl is null.\");\n             showNoPodcastFoundError();\n         } else {\n             Log.d(TAG, \"Activity was started with url \" + feedUrl);\n-            // Remove subscribeonandroid.com from feed URL in order to subscribe to the actual feed URL\n-            if (feedUrl.contains(\"subscribeonandroid.com\")) {\n-                feedUrl = feedUrl.replaceFirst(\"((www.)?(subscribeonandroid.com/))\", \"\");\n-            }\n             if (savedInstanceState != null) {\n                 username = savedInstanceState.getString(\"username\");\n                 password = savedInstanceState.getString(\"password\");\ndiff --git a/net/common/src/main/java/de/danoeh/antennapod/net/common/UrlChecker.java b/net/common/src/main/java/de/danoeh/antennapod/net/common/UrlChecker.java\nindex 79116f00d7..c52720bbc9 100644\n--- a/net/common/src/main/java/de/danoeh/antennapod/net/common/UrlChecker.java\n+++ b/net/common/src/main/java/de/danoeh/antennapod/net/common/UrlChecker.java\n@@ -62,6 +62,8 @@ public static String prepareUrl(@NonNull String url) {\n             } catch (UnsupportedEncodingException e) {\n                 return prepareUrl(query);\n             }\n+        } else if (lowerCaseUrl.contains(\"subscribeonandroid.com\")) {\n+            return prepareUrl(url.replaceFirst(\"((www.)?(subscribeonandroid.com/))\", \"\"));\n         } else if (!(lowerCaseUrl.startsWith(\"http://\") || lowerCaseUrl.startsWith(\"https://\"))) {\n             Log.d(TAG, \"Adding http:// at the beginning of the URL\");\n             return \"http://\" + url;\n@@ -70,6 +72,11 @@ public static String prepareUrl(@NonNull String url) {\n         }\n     }\n \n+    public static boolean isDeeplinkWithoutUrl(String url) {\n+        return url.toLowerCase(Locale.ROOT).contains(AP_SUBSCRIBE_DEEPLINK)\n+                && Uri.parse(url).getQueryParameter(\"url\") == null;\n+    }\n+\n     /**\n      * Checks if URL is valid and modifies it if necessary.\n      * This method also handles protocol relative URLs.\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 924421df85..bfdd5ae993 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -317,7 +317,7 @@\n     <string name=\"download_log_title_unknown\">Unknown title</string>\n     <string name=\"download_type_feed\">Feed</string>\n     <string name=\"download_type_media\">Media file</string>\n-    <string name=\"null_value_podcast_error\">No podcast was provided that could be shown.</string>\n+    <string name=\"null_value_podcast_error\">The link you tapped does not contain a valid podcast URL. Please verify the link and try again, or search for the podcast manually.</string>\n     <string name=\"no_feed_url_podcast_found_by_search\">The suggested podcast did not have an RSS link, AntennaPod found a podcast that could match</string>\n     <string name=\"authentication_notification_title\">Authentication required</string>\n     <string name=\"confirm_mobile_download_dialog_title\">Confirm mobile download</string>\n", "test_patch": "", "problem_statement": "Crash when trying to open deeplink\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.5.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n14\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Open the deeplink  https://antennapod.org/deeplink/subscribe/?url=%68%74%74ps%3A%2F%2Ffeeds.megaphone.fm%2FASD7453520464&title=Ralphs+Relevante+R%C3%A4tsel+%E2%80%93+Wissen+mit+Ralph+Caspers OR https://antennapod.org/deeplink/subscribe/ (I opened the link from Fedilab link card, which might strip parameters for privacy reasons)\n\n### Expected behaviour\n\nOpen relevant podcast of if not possible, show a warning:\n**Can't open podcast**\nThe link you tapped doesn't contain a valid podcast URL. Please verify the link and try again, or search for the podcast in AntennaPod.\nCLOSE     OPEN SEARCH\n\n### Current behaviour\n\nApp crash\n\n### Logs\n\n## Environment\r\nAndroid version: 14\r\nOS version: 5.4.242-qgki-g07bc4ccc612b\r\nAntennaPod version: 3.5.0\r\nModel: FP5\r\nDevice: FP5\r\nProduct: FP5\r\n\r\n## Crash info\r\nTime: 11-10-2024 07:53:05\r\nAntennaPod version: 3.5.0\r\n\r\n## StackTrace\r\n```\r\njava.lang.RuntimeException: Unable to start activity ComponentInfo{de.danoeh.antennapod/de.danoeh.antennapod.ui.screen.onlinefeedview.OnlineFeedViewActivity}: java.lang.NullPointerException: Attempt to invoke virtual method 'int java.lang.String.length()' on a null object reference\r\n\tat android.app.ActivityThread.performLaunchActivity(ActivityThread.java:3783)\r\n\tat android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:3923)\r\n\tat android.app.servertransaction.LaunchActivityItem.execute(LaunchActivityItem.java:103)\r\n\tat android.app.servertransaction.TransactionExecutor.executeCallbacks(TransactionExecutor.java:139)\r\n\tat android.app.servertransaction.TransactionExecutor.execute(TransactionExecutor.java:96)\r\n\tat android.app.ActivityThread$H.handleMessage(ActivityThread.java:2444)\r\n\tat android.os.Handler.dispatchMessage(Handler.java:106)\r\n\tat android.os.Looper.loopOnce(Looper.java:205)\r\n\tat android.os.Looper.loop(Looper.java:294)\r\n\tat android.app.ActivityThread.main(ActivityThread.java:8223)\r\n\tat java.lang.reflect.Method.invoke(Native Method)\r\n\tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:552)\r\n\tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:977)\r\nCaused by: java.lang.NullPointerException: Attempt to invoke virtual method 'int java.lang.String.length()' on a null object reference\r\n\tat java.net.URLDecoder.decode(URLDecoder.java:177)\r\n\tat java.net.URLDecoder.decode(URLDecoder.java:143)\r\n\tat de.danoeh.antennapod.net.common.UrlChecker.prepareUrl(SourceFile:61)\r\n\tat de.danoeh.antennapod.ui.screen.onlinefeedview.OnlineFeedViewActivity.onCreate(SourceFile:118)\r\n\tat android.app.Activity.performCreate(Activity.java:8595)\r\n\tat android.app.Activity.performCreate(Activity.java:8573)\r\n\tat android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1457)\r\n\tat android.app.ActivityThread.performLaunchActivity(ActivityThread.java:3765)\r\n\t... 12 more\r\n```\n", "hints_text": "", "created_at": "2024-10-20T18:07:01Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7456, "instance_id": "AntennaPod__AntennaPod-7456", "issue_numbers": ["7455"], "base_commit": "361c754eb92e020303f31ca4c75fa881e0f68131", "patch": "diff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemSortQuery.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemSortQuery.java\nindex 7db9a0f562..236e9cbcf9 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemSortQuery.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemSortQuery.java\n@@ -26,6 +26,10 @@ public static String generateFrom(SortOrder sortOrder) {\n                         + PodDBAdapter.KEY_PLAYBACK_COMPLETION_DATE + \" \" + \"DESC\";\n             case DATE_OLD_NEW:\n                 return PodDBAdapter.TABLE_NAME_FEED_ITEMS + \".\" + PodDBAdapter.KEY_PUBDATE + \" \" + \"ASC\";\n+            case EPISODE_FILENAME_A_Z:\n+                return PodDBAdapter.KEY_LINK + \" \" + \"ASC\";\n+            case EPISODE_FILENAME_Z_A:\n+                return PodDBAdapter.KEY_LINK + \" \" + \"DESC\";\n             case DATE_NEW_OLD:\n             default:\n                 return PodDBAdapter.TABLE_NAME_FEED_ITEMS + \".\" + PodDBAdapter.KEY_PUBDATE + \" \" + \"DESC\";\n", "test_patch": "", "problem_statement": "Sorting episodes by file name doesn't work\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n### App version\r\n\r\n3.5.0f\r\n\r\n### Where did you get the app from\r\n\r\nF-Droid\r\n\r\n### Android version\r\n\r\n8.0.0, Samsung\r\n\r\n### Device model\r\n\r\nSamsung Galaxy S7\r\n\r\n### First occurred\r\n\r\nAbout 2 days ago, after updating from AntennaPod 3.4.1.\r\n\r\n### Steps to reproduce\r\n\r\n1. Add a podcast from the file system. *Add podcast* > *Add local folder*.\r\n2. Navigate to the podcast in the GUI.\r\n3. Select *tree dots* > *Sort*.\r\n4. Tab the *File name* button.\r\n\r\n### Expected behaviour\r\n\r\nThe list of episodes of the podcast should be sorted according to the name of the episode file on disk. If the *File name* button is tapped again the episodes should be sorted in descending file name order.\r\n\r\n### Current behaviour\r\n\r\nThe episodes are sorted in some other, unknown order, that does not correspond to the file name order. If the *File name* button is tapped again nothing changes, the episodes remain in exactly the same order.\r\n\r\n### Logs\r\n\r\n_No response_\n", "hints_text": "hi, I am working on this issue.", "created_at": "2024-10-13T07:22:03Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7454, "instance_id": "AntennaPod__AntennaPod-7454", "issue_numbers": ["7217"], "base_commit": "4a92a5e01979c7fa095b29a39dc2e0d11176431b", "patch": "diff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex bfdd5ae993..9ed466d550 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -751,6 +751,7 @@\n     <string name=\"statistics_expected_next_episode_any_day\">Any day now</string>\n     <string name=\"statistics_expected_next_episode_unknown\">Unknown</string>\n     <string name=\"statistics_view_all\">All podcasts \u00bb</string>\n+    <string name=\"statistics_years_barchart_description\">Time played per month</string>\n     <string name=\"wait_icon\" translatable=\"false\">\u2026</string>\n     <string name=\"edit_url_menu\">Edit feed URL</string>\n     <string name=\"edit_url_confirmation_msg\">Changing the RSS address can easily break the playback state and episode listings of the podcast. We do NOT recommend changing it and will NOT provide support if anything goes wrong. This cannot be undone. The broken subscription CANNOT be repaired by simply changing the address back. We recommend creating a backup before continuing.</string>\ndiff --git a/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/years/BarChartView.java b/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/years/BarChartView.java\nindex 510bcb8e1f..44e33ba21c 100644\n--- a/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/years/BarChartView.java\n+++ b/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/years/BarChartView.java\n@@ -89,18 +89,25 @@ public void draw(@NonNull Canvas canvas) {\n             paintBars.setStrokeWidth(height * 0.015f);\n             paintBars.setColor(colors[0]);\n             int colorIndex = 0;\n-            int lastYear = data.size() > 0 ? data.get(0).getYear() : 0;\n+            int prevYear = data.isEmpty() ? 0 : data.get(0).getYear();\n+            int monthsInFirstYear = 0;\n+            while (monthsInFirstYear < data.size() && data.get(monthsInFirstYear).getYear() == data.get(0).getYear()) {\n+                monthsInFirstYear++;\n+            }\n+\n             for (int i = 0; i < data.size(); i++) {\n                 float x = textPadding + (i + 1) * stepSize;\n-                if (lastYear != data.get(i).getYear()) {\n-                    lastYear = data.get(i).getYear();\n+                if (prevYear != data.get(i).getYear() || (i == 0 && monthsInFirstYear > 4)) {\n+                    prevYear = data.get(i).getYear();\n                     colorIndex++;\n                     paintBars.setColor(colors[colorIndex % 2]);\n-                    if (i < data.size() - 2) {\n+                    if (i < data.size() - 4) {\n                         canvas.drawText(String.valueOf(data.get(i).getYear()), x + stepSize,\n                                 barHeight + (height - barHeight + textSize) / 2, paintGridText);\n                     }\n-                    canvas.drawLine(x, height, x, barHeight, paintGridText);\n+                    if (data.get(i).getMonth() == 1) {\n+                        canvas.drawLine(x, height, x, barHeight, paintGridText);\n+                    }\n                 }\n \n                 float valuePercentage = (float) Math.max(0.005, (float) data.get(i).getTimePlayed() / maxValue);\ndiff --git a/ui/statistics/src/main/res/layout/statistics_listitem_barchart.xml b/ui/statistics/src/main/res/layout/statistics_listitem_barchart.xml\nindex d70e1da075..8830a812b6 100644\n--- a/ui/statistics/src/main/res/layout/statistics_listitem_barchart.xml\n+++ b/ui/statistics/src/main/res/layout/statistics_listitem_barchart.xml\n@@ -11,6 +11,14 @@\n         android:layout_width=\"match_parent\"\n         android:layout_height=\"200dp\" />\n \n+    <TextView\n+        android:id=\"@+id/barchart_description\"\n+        android:layout_width=\"wrap_content\"\n+        android:layout_height=\"wrap_content\"\n+        android:textAlignment=\"center\"\n+        android:text=\"@string/statistics_years_barchart_description\"\n+        android:layout_gravity=\"center\" />\n+\n     <View\n         android:layout_width=\"match_parent\"\n         android:layout_height=\"1dp\"\n", "test_patch": "", "problem_statement": "Statistics screen improvement: add a legend on the statistics \"years\" diagram\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\r\n\r\n### App version\r\n\r\n3.3.2f\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Problem you may be having, or feature you want\r\n\r\nDiagrams in the \"Years\" section on the statistics lack information. It appears to be just a Chart Bar with no further explanation, and therefore can be deemed as incomplete and even confusing for the user. There is no information about what the bars represent.\r\n\r\n### Suggested solution\r\n\r\n| \u2139\ufe0f | **Implementation instructions**|\r\n|---|:---|\r\n| | This request has been discussed further below. If you're interested in implementing this, please see the  [conclusions relevant for implementation below](https://github.com/AntennaPod/AntennaPod/issues/7217#issuecomment-2184012213).<br><sub>The original post has been edited by the project maintainers to add this link.</sub> |\r\n\r\nMy impementation just introduces a simple legend on the right of the Bar Chart with a title \"Time Played by Month\" and then below the colors for each month. My only hesitation is about the visualization if there are many months, but I cannot test this since I cannot simulate the months of listening. \r\n\r\n### Screenshots / Drawings / Technical details\r\n![\u03a3\u03c4\u03b9\u03b3\u03bc\u03b9\u03cc\u03c4\u03c5\u03c0\u03bf \u03bf\u03b8\u03cc\u03bd\u03b7\u03c2 2024-05-28 125937](https://github.com/AntennaPod/AntennaPod/assets/117775196/4ffeb43e-074d-445e-9640-204c6ffe998c)\r\n\r\n_No response_\n", "hints_text": "Hi there,\n\nThanks for chipping in.\n\nThis is what it'll look like after you've used AntennaPod some time:\n![Imagepipe_0.jpg](https://github.com/AntennaPod/AntennaPod/assets/11229646/1e794769-088a-4de6-9272-48322b58ae03)\n\nThere's no space to have a legend, and also we don't distinguish the months (all months of a year are the same colour) so a legend would be useless.\n\nThat said, it probably would be good to\n* introduce a chart title/explanation: \"Time played per month\" (we do have something similar on the other chart tabs)\n* display the year for the first year (it only for the second and subsequent years the year is displayed)\nCurrently don't display the start year because it doesn't fit (if the bars don't start in January).\r\n\r\nDecision:\r\n* We display the first year if the total timespan is < 2 or 3 years.\r\n* Introduce a chart title/explanation: \"Time played per month\" (we do have something similar on the other chart tabs)\nHi, I was wondering if this issue still needs to be worked on. If so, I would be happy to pick it up!\nThe issue is still open, so go ahead :) No need to ask when the issue is still open", "created_at": "2024-10-12T05:45:27Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7442, "instance_id": "AntennaPod__AntennaPod-7442", "issue_numbers": ["7441"], "base_commit": "361c754eb92e020303f31ca4c75fa881e0f68131", "patch": "diff --git a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/internal/LocalPSMP.java b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/internal/LocalPSMP.java\nindex c1d55c8e81..37cacd262f 100644\n--- a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/internal/LocalPSMP.java\n+++ b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/internal/LocalPSMP.java\n@@ -1,8 +1,6 @@\n package de.danoeh.antennapod.playback.service.internal;\n \n-import android.app.UiModeManager;\n import android.content.Context;\n-import android.content.res.Configuration;\n import android.media.AudioManager;\n import android.os.Handler;\n import android.os.Looper;\n@@ -10,6 +8,9 @@\n import android.util.Pair;\n import android.view.SurfaceHolder;\n import androidx.annotation.NonNull;\n+import androidx.car.app.connection.CarConnection;\n+import androidx.lifecycle.LiveData;\n+import androidx.lifecycle.Observer;\n import androidx.media.AudioAttributesCompat;\n import androidx.media.AudioFocusRequestCompat;\n import androidx.media.AudioManagerCompat;\n@@ -58,6 +59,9 @@ public class LocalPSMP extends PlaybackServiceMediaPlayer {\n     private final Handler audioFocusCanceller;\n     private boolean isShutDown = false;\n     private CountDownLatch seekLatch;\n+    private LiveData<Integer> androidAutoConnectionState;\n+    private boolean androidAutoConnected;\n+    private Observer<Integer> androidAutoConnectionObserver;\n \n     public LocalPSMP(@NonNull Context context,\n                      @NonNull PlaybackServiceMediaPlayer.PSMPCallback callback) {\n@@ -71,6 +75,12 @@ public LocalPSMP(@NonNull Context context,\n         mediaType = MediaType.UNKNOWN;\n         videoSize = null;\n \n+        androidAutoConnectionState = new CarConnection(context).getType();\n+        androidAutoConnectionObserver = connectionState -> {\n+            androidAutoConnected = connectionState == CarConnection.CONNECTION_TYPE_PROJECTION;\n+        };\n+        androidAutoConnectionState.observeForever(androidAutoConnectionObserver);\n+\n         AudioAttributesCompat audioAttributes = new AudioAttributesCompat.Builder()\n                 .setUsage(AudioAttributesCompat.USAGE_MEDIA)\n                 .setContentType(AudioAttributesCompat.CONTENT_TYPE_SPEECH)\n@@ -182,8 +192,8 @@ private void playMediaObject(@NonNull final Playable playable, final boolean for\n             } else {\n                 throw new IOException(\"Unable to read local file \" + media.getLocalFileUrl());\n             }\n-            UiModeManager uiModeManager = (UiModeManager) context.getSystemService(Context.UI_MODE_SERVICE);\n-            if (uiModeManager.getCurrentModeType() != Configuration.UI_MODE_TYPE_CAR) {\n+            \n+            if (!androidAutoConnected) {\n                 setPlayerStatus(PlayerStatus.INITIALIZED, media);\n             }\n \n@@ -525,6 +535,7 @@ public void shutdown() {\n             mediaPlayer = null;\n             playerStatus = PlayerStatus.STOPPED;\n         }\n+        androidAutoConnectionState.removeObserver(androidAutoConnectionObserver);\n         isShutDown = true;\n         abandonAudioFocus();\n         releaseWifiLockIfNecessary();\n", "test_patch": "", "problem_statement": "Playback on Android Auto goes to Queue screen when playback continues to next episode\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n### App version\r\n\r\n3.5.0\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Android version\r\n\r\nAndroid 14\r\n\r\n### Device model\r\n\r\nPixel 4A\r\n\r\n### First occurred\r\n\r\nJan 8, 2024\r\n\r\n### Steps to reproduce\r\n\r\n1. Listen to an episode in Android Auto (now playing screen appears)\r\n1. End of episode (The queue appears, while the next episode plays, I expect the now playing screen to appear\r\n1. If I skip to the next episode, the queue appears instead of the now playing screen of the next episode\r\n1. Click the now playing icon in bottom right to open the now playing screen\r\n\r\n\r\n### Expected behaviour\r\n\r\nWhen the current episode is finished and continuing to the next, the screen will show the new now-playing episode\r\n\r\n\r\n### Current behaviour\r\n\r\nWhen the current episode is finished and continuing to the next, the screen switches to the Queue and continues playing\r\n\r\n### Reported on forum\r\n- https://forum.antennapod.org/t/playback-on-android-auto-goes-to-queue-screen-when-playback-continues-to-next-episode/5492/1\r\n- https://forum.antennapod.org/t/android-auto-end-of-episode-opens-queue/3923\r\n\r\n### Logs\r\n\r\n_No response_\n", "hints_text": "This issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/android-auto-end-of-episode-opens-queue/3923/3\n\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/playback-on-android-auto-goes-to-queue-screen-when-playback-continues-to-next-episode/5492/4\n", "created_at": "2024-10-05T01:40:16Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7440, "instance_id": "AntennaPod__AntennaPod-7440", "issue_numbers": ["7438"], "base_commit": "0220aab53a321136f02e17e6202b7d49be6b1e74", "patch": "diff --git a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/local/LocalFeedUpdater.java b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/local/LocalFeedUpdater.java\nindex e5c4fea081..5c70ba39ae 100644\n--- a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/local/LocalFeedUpdater.java\n+++ b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/local/LocalFeedUpdater.java\n@@ -194,6 +194,7 @@ private static FeedItem createFeedItem(Feed feed, FastDocumentFile file, Context\n         try {\n             loadMetadata(item, file, context);\n         } catch (Exception e) {\n+            e.printStackTrace();\n             item.setDescriptionIfLonger(e.getMessage());\n         }\n         return item;\n@@ -222,7 +223,9 @@ private static void loadMetadata(FeedItem item, FastDocumentFile file, Context c\n             }\n \n             String durationStr = mediaMetadataRetriever.extractMetadata(MediaMetadataRetriever.METADATA_KEY_DURATION);\n-            item.getMedia().setDuration((int) Long.parseLong(durationStr));\n+            if (durationStr != null && !durationStr.equals(\"null\")) {\n+                item.getMedia().setDuration((int) Long.parseLong(durationStr));\n+            }\n \n             item.getMedia().setHasEmbeddedPicture(mediaMetadataRetriever.getEmbeddedPicture() != null);\n \n", "test_patch": "", "problem_statement": "Shownotes: `Invalid long: \"null\"` in .opus files (vorbis tags) on Android 5.1.1\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n### App version\r\n\r\n3.4.1f (8c2d641ba)\r\n\r\n### Where did you get the app from\r\n\r\nF-Droid\r\n\r\n### Android version\r\n\r\n5.1.1\r\n\r\n### Device model\r\n\r\nGalaxy J2\r\n\r\n### First occurred\r\n\r\nlast week\r\n\r\n### Steps to reproduce\r\n\r\n1. Transfer the file to a folder on device\r\n2. Add it as local folder\r\n3. Try to view the Shownotes\r\n\r\n### Expected behaviour\r\n\r\nViewing Shownotes text.\r\n\r\n### Current behaviour\r\n\r\nThis is what is shown as Shownotes:\r\n```\r\nInvalid long: \"null\"\r\n```\r\n\r\n\r\n\r\n### Logs\r\n\r\n_No response_\r\n\r\n\r\n### Mediainfo output\r\n\r\n<details>\r\n    <summary>Click</summary>\r\n\r\n  ```\r\nGeneral\r\nComplete name                            : Shortest Video on Youtube Part 122 [Of7lZYXpEGY].opus\r\nFormat                                   : Ogg\r\nFile size                                : 213 KiB\r\nDuration                                 : 1 s 20 ms\r\nOverall bit rate                         : 1 707 kb/s\r\nTrack name                               : Shortest Video on Youtube Part 122\r\nPerformer                                : Mylo the Cat\r\nDescription                              : shownotes in description tag\r\nRecorded date                            : 20210416\r\nWriting application                      : Lavf58.76.100\r\nCover                                    : Yes\r\nLyrics                                   : shownotes in lyrics tag\r\nComment                                  : shownotes in comment tag\r\nPURL                                     : https://www.youtube.com/watch?v=Of7lZYXpEGY\r\nSUBTITLE                                 : shownotes in subtitle tag\r\nSYNOPSIS                                 : In the 122nd episode of the Shortest Video on Youtube series, Mylo the Cat continues running to his Papa.  /  /  /  / Join this channel to get access to perks: / https://www.youtube.com/channel/UC9kN-ROrTY81zH856AxXuGQ/join\r\n\r\nAudio\r\nID                                       : 996782779 (0x3B69B2BB)\r\nFormat                                   : Opus\r\nDuration                                 : 1 s 20 ms\r\nChannel(s)                               : 2 channels\r\nChannel layout                           : L R\r\nSampling rate                            : 48.0 kHz\r\nCompression mode                         : Lossy\r\nWriting library                          : Lavf58.76.100\r\nLanguage                                 : Spanish\r\n\r\n```\r\n_I've used kid3 audio tag editor on the file for adding the shownotes text._\r\n\r\n\r\n~~Unfortunately github doesn't allow me to upload the .opus file:~~\r\n\r\n![image](https://github.com/user-attachments/assets/203591f8-195d-497c-954a-5c47d31e561c)\r\n\r\nBut it's been downloaded from https://www.youtube.com/watch?v=Of7lZYXpEGY using `yt-dlp` with this command:\r\n\r\n```\r\n yt-dlp \\\r\n        --cookies ./cookie.txt \\\r\n        --download-archive ./0.dld \\\r\n        -i \\\r\n        -x \\\r\n        --audio-format opus \\\r\n        --audio-quality 0 \\\r\n        --write-description \\\r\n        --write-thumbnail \\\r\n        --embed-chapters \\\r\n        --embed-thumbnail \\\r\n        --add-metadata \\\r\n        -k \\\r\n        \"$@\"\r\n\r\n```\r\n\r\n**Update:** I manged to trick github into accepting my upload by changing the file extension to `.jpg`. Please change it back to `.opus` after download.\r\n\r\n\r\n![Shortest Video on Youtube Part 122  Of7lZYXpEGY](https://github.com/user-attachments/assets/479405e5-e7bc-4958-ada6-93d93a51cbf4)\r\n\r\n\r\n</details>\r\n\r\n\n", "hints_text": "I managed to upload the file.\nCould you please check with AntennaPod 3.5.0 again? Your file does work on my device.\n@ByteHamster I updated the app to 3.5.0f (300baf6dd) from f-droid and it's still the same as before.\r\n\r\n**Edit:** FWIW I've tested the .mp3 version of the same file and I can report that ID3v2.3.0 `Comment` tag is working as it should as the Shownotes.\nThen my guess would be that something else goes wrong, not actually parsing of the shownotes. I think it might be that your phone does not support retrieving all file attributes from the file. Could you please refresh that podcast and immediately afterwards export the full logs from the \"report bug\" screen?\n~~AFAIK~~ I've heard that .opus files aren't as natively supported on android 5 as the newer versions of android.\r\nAnd please also check back on my now updated previous comment, I want to make sure that you've read it.\r\n\r\nHere the full log exported while the folder containing the file is my only subscription:\r\n[full-logs.txt](https://github.com/user-attachments/files/17244670/full-logs.txt)\r\n", "created_at": "2024-10-03T16:16:21Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7437, "instance_id": "AntennaPod__AntennaPod-7437", "issue_numbers": ["7254"], "base_commit": "0220aab53a321136f02e17e6202b7d49be6b1e74", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java\nindex cd7681bf9b..27bd0ccb42 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java\n@@ -1,5 +1,6 @@\n package de.danoeh.antennapod.ui.screen.download;\n \n+import android.content.DialogInterface;\n import android.os.Bundle;\n import android.util.Log;\n import android.view.ContextMenu;\n@@ -18,6 +19,7 @@\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n import de.danoeh.antennapod.event.FeedUpdateRunningEvent;\n+import de.danoeh.antennapod.ui.common.ConfirmationDialog;\n import de.danoeh.antennapod.ui.episodeslist.EpisodeItemListAdapter;\n import de.danoeh.antennapod.actionbutton.DeleteActionButton;\n import de.danoeh.antennapod.event.DownloadLogEvent;\n@@ -182,6 +184,23 @@ public boolean onMenuItemClick(MenuItem item) {\n         } else if (item.getItemId() == R.id.downloads_sort) {\n             new DownloadsSortDialog().show(getChildFragmentManager(), \"SortDialog\");\n             return true;\n+        } else if (item.getItemId() == R.id.action_delete_downloads_played) {\n+            ConfirmationDialog dialog = new ConfirmationDialog(getActivity(),\n+                    R.string.delete_downloads_played,  R.string.delete_downloads_played_confirmation) {\n+                @Override\n+                public void onConfirmButtonPressed(DialogInterface clickedDialog) {\n+                    clickedDialog.dismiss();\n+                    Observable.fromCallable(() -> DBReader.getEpisodes(0, Integer.MAX_VALUE,\n+                                    new FeedItemFilter(FeedItemFilter.DOWNLOADED, FeedItemFilter.INCLUDE_NOT_SUBSCRIBED,\n+                                            FeedItemFilter.PLAYED), SortOrder.DATE_OLD_NEW))\n+                            .subscribeOn(Schedulers.io())\n+                            .observeOn(AndroidSchedulers.mainThread())\n+                            .subscribe(items -> new EpisodeMultiSelectActionHandler(getActivity(), R.id.remove_item)\n+                                    .handleAction(items), error -> Log.e(TAG, Log.getStackTraceString(error)));\n+                }\n+            };\n+            dialog.createNewDialog().show();\n+            return true;\n         }\n         return false;\n     }\ndiff --git a/app/src/main/res/menu/downloads_completed.xml b/app/src/main/res/menu/downloads_completed.xml\nindex a7753d0805..c2c08f75a9 100644\n--- a/app/src/main/res/menu/downloads_completed.xml\n+++ b/app/src/main/res/menu/downloads_completed.xml\n@@ -16,6 +16,11 @@\n         android:title=\"@string/downloads_log_label\"\n         custom:showAsAction=\"always\" />\n \n+    <item\n+        android:id=\"@+id/action_delete_downloads_played\"\n+        android:title=\"@string/delete_downloads_played\"\n+        custom:showAsAction=\"never\" />\n+\n     <item\n         android:id=\"@+id/refresh_item\"\n         android:title=\"@string/refresh_label\"\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 42cab5f25e..b0da5eeff9 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -213,6 +213,8 @@\n     <string name=\"rename_tag_label\">Rename tag</string>\n     <string name=\"confirm_mobile_feed_refresh_dialog_message\">Refreshing podcasts over mobile data connection is disabled in the settings.\\n\\nDo you want to refresh anyway?</string>\n     <string name=\"confirm_mobile_feed_refresh_dialog_message_vpn\">Your VPN app pretends to be a mobile network (metered connection). Refreshing podcasts over mobile data connection is disabled in the settings.\\n\\nDo you want to refresh anyway? If you want this problem to be fixed, contact the creators of your VPN app.</string>\n+    <string name=\"delete_downloads_played\">Delete played</string>\n+    <string name=\"delete_downloads_played_confirmation\">Please confirm that you want to delete all played downloads.</string>\n \n     <!-- actions on feeditems -->\n     <string name=\"download_label\">Download</string>\n", "test_patch": "", "problem_statement": "Delete completed episodes from downloads\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.4.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Feature or improvement you want\n\nIn the \"Downloads\" view, under the three-dot-menu should offer a \"Delete Completed\" option, which deletes all completed downloads.\n\n### Why should this be added?\n\nIt is much more convenient, than going to the playback history, selecting everything, and then deleting it. Also, it offers more control than auto deletion.\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "Hi! I would like to work on this \r\n\r\n\r\n\nAwesome! Feel free to open a PR when you are ready :)\n@sathyagb4 \n\nDo you still intend to work on this?\nJust so I understand the ask @luleyleo \r\n- Is this to 'Delete Completed' to remove episodes that have been listened to?\n@tonytamsf exactly :)", "created_at": "2024-10-02T19:29:41Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7436, "instance_id": "AntennaPod__AntennaPod-7436", "issue_numbers": ["6686"], "base_commit": "751c358337b5fbb5b8e9eacbfc85007abc733205", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/actionbutton/DownloadActionButton.java b/app/src/main/java/de/danoeh/antennapod/actionbutton/DownloadActionButton.java\nindex 15f07d207e..4a3545f214 100644\n--- a/app/src/main/java/de/danoeh/antennapod/actionbutton/DownloadActionButton.java\n+++ b/app/src/main/java/de/danoeh/antennapod/actionbutton/DownloadActionButton.java\n@@ -2,6 +2,7 @@\n \n import android.content.Context;\n import android.view.View;\n+import android.widget.Toast;\n \n import androidx.annotation.DrawableRes;\n import androidx.annotation.NonNull;\n@@ -16,6 +17,12 @@\n import de.danoeh.antennapod.net.common.NetworkUtils;\n \n public class DownloadActionButton extends ItemActionButton {\n+    private static final int TIMEOUT_NETWORK_WARN_SECONDS = 300;\n+    private static final int BYPASS_TYPE_NOW = 1;\n+    private static final int BYPASS_TYPE_LATER = 2;\n+\n+    private static int bypassCellularNetworkType = 0;\n+    private static long bypassCellularNetworkWarningTimer = 0;\n \n     public DownloadActionButton(FeedItem item) {\n         super(item);\n@@ -47,15 +54,29 @@ public void onClick(Context context) {\n \n         UsageStatistics.logAction(UsageStatistics.ACTION_DOWNLOAD);\n \n-        if (NetworkUtils.isEpisodeDownloadAllowed()) {\n-            DownloadServiceInterface.get().downloadNow(context, item, false);\n+        long timeSinceBypass = System.currentTimeMillis() / 1000 - bypassCellularNetworkWarningTimer;\n+        boolean shouldBypass = timeSinceBypass < TIMEOUT_NETWORK_WARN_SECONDS;\n+        if (shouldBypass && bypassCellularNetworkType == BYPASS_TYPE_NOW) {\n+            Toast.makeText(context, context.getString(\n+                    R.string.mobile_download_notice, TIMEOUT_NETWORK_WARN_SECONDS / 60), Toast.LENGTH_LONG).show();\n+        }\n+        if (NetworkUtils.isEpisodeDownloadAllowed() || shouldBypass) {\n+            DownloadServiceInterface.get().downloadNow(context, item, bypassCellularNetworkType == BYPASS_TYPE_NOW);\n         } else {\n             MaterialAlertDialogBuilder builder = new MaterialAlertDialogBuilder(context)\n                     .setTitle(R.string.confirm_mobile_download_dialog_title)\n                     .setPositiveButton(R.string.confirm_mobile_download_dialog_download_later,\n-                            (d, w) -> DownloadServiceInterface.get().downloadNow(context, item, false))\n+                            (d, w) -> {\n+                                bypassCellularNetworkType = BYPASS_TYPE_LATER;\n+                                bypassCellularNetworkWarningTimer = System.currentTimeMillis() / 1000;\n+                                DownloadServiceInterface.get().downloadNow(context, item, false);\n+                            })\n                     .setNeutralButton(R.string.confirm_mobile_download_dialog_allow_this_time,\n-                            (d, w) -> DownloadServiceInterface.get().downloadNow(context, item, true))\n+                            (d, w) -> {\n+                                bypassCellularNetworkType = BYPASS_TYPE_NOW;\n+                                bypassCellularNetworkWarningTimer = System.currentTimeMillis() / 1000;\n+                                DownloadServiceInterface.get().downloadNow(context, item, true);\n+                            })\n                     .setNegativeButton(R.string.cancel_label, null);\n             if (NetworkUtils.isNetworkRestricted() && NetworkUtils.isVpnOverWifi()) {\n                 builder.setMessage(R.string.confirm_mobile_download_dialog_message_vpn);\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 42cab5f25e..968037c39b 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -320,6 +320,7 @@\n     <string name=\"confirm_mobile_download_dialog_message_vpn\">Your VPN app pretends to be a mobile network (metered connection). Downloading over mobile data connection is disabled in the settings. If you want this problem to be fixed, contact the creators of your VPN app.</string>\n     <string name=\"confirm_mobile_download_dialog_download_later\">Download later</string>\n     <string name=\"confirm_mobile_download_dialog_allow_this_time\">Download anyway</string>\n+    <string name=\"mobile_download_notice\">Downloading over mobile data connection for the next %d minutes</string>\n     <string name=\"confirm_mobile_streaming_notification_title\">Confirm mobile streaming</string>\n     <string name=\"confirm_mobile_streaming_notification_message\">Streaming over mobile data connection is disabled in the settings. Tap to stream anyway.</string>\n     <string name=\"confirm_mobile_streaming_button_always\">Always</string>\n", "test_patch": "", "problem_statement": "Mobile Download anyway prompt: remember the Choice\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.1.1\n\n### Where did you get the app from\n\nF-Droid\n\n### Android version\n\n13 LOS\n\n### Device model\n\nOP6\n\n### First occurred\n\nabout 2-3 Weeks\n\n### Steps to reproduce\n\n1. Have settings to not allow downlaod while on Mobile data\r\n2. Be on Mobile data, and attemt to Download something\r\n3. Choose Download Anyway\r\n4. attempt do download something else\r\n5. Choose Download Anyway\r\n6. 4. attempt do download something else\r\n7. Choose Download Anyway\r\n8. ....\n\n### Expected behaviour\n\nAfter Step 3\r\nIt should / did remember that it can download stuff for the Moment and not ask on every download again.\n\n### Current behaviour\n\nIt asks every time\r\n\r\nReasoning:\r\nI have it set this way, since i normally download my stuff over my cellular (at home only) and when i am on a restricted wlan/hotspot i do not want to accidentally download over that network.\r\nAFAIK Antennapod does not distinguish between cellular and \"ratetdWifis\"\n\n### Logs\n\n_No response_\n", "hints_text": "This issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/confirm-mobile-download-option-to-remember-preference/4616/11\n", "created_at": "2024-10-02T18:21:49Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7435, "instance_id": "AntennaPod__AntennaPod-7435", "issue_numbers": ["5987"], "base_commit": "751c358337b5fbb5b8e9eacbfc85007abc733205", "patch": "diff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 42cab5f25e..70628a1981 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -77,7 +77,10 @@\n     <string name=\"section_shown\">Shown</string>\n \n     <!-- Download Statistics fragment -->\n-    <string name=\"total_size_downloaded_podcasts\">Total size of episodes on the device</string>\n+    <plurals name=\"total_size_downloaded_podcasts\">\n+        <item quantity=\"one\">Total size of %d episode on the device</item>\n+        <item quantity=\"other\">Total size of %d episodes on the device</item>\n+    </plurals>\n \n     <!-- Main activity -->\n     <string name=\"drawer_open\">Open menu</string>\ndiff --git a/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/downloads/DownloadStatisticsListAdapter.java b/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/downloads/DownloadStatisticsListAdapter.java\nindex 2af3f0bf7c..4ab6f3a139 100644\n--- a/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/downloads/DownloadStatisticsListAdapter.java\n+++ b/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/downloads/DownloadStatisticsListAdapter.java\n@@ -16,6 +16,7 @@\n  */\n public class DownloadStatisticsListAdapter extends StatisticsListAdapter {\n     private final Fragment fragment;\n+    private int cacheEpisodes;\n \n     public DownloadStatisticsListAdapter(Context context, Fragment fragment) {\n         super(context);\n@@ -24,7 +25,8 @@ public DownloadStatisticsListAdapter(Context context, Fragment fragment) {\n \n     @Override\n     protected String getHeaderCaption() {\n-        return context.getString(R.string.total_size_downloaded_podcasts);\n+        return context.getResources().getQuantityString(\n+                R.plurals.total_size_downloaded_podcasts, cacheEpisodes, cacheEpisodes);\n     }\n \n     @Override\n@@ -35,9 +37,11 @@ protected String getHeaderValue() {\n     @Override\n     protected PieChartView.PieChartData generateChartData(List<StatisticsItem> statisticsData) {\n         float[] dataValues = new float[statisticsData.size()];\n+        cacheEpisodes = 0;\n         for (int i = 0; i < statisticsData.size(); i++) {\n             StatisticsItem item = statisticsData.get(i);\n             dataValues[i] = item.totalDownloadSize;\n+            cacheEpisodes += item.episodesDownloadCount;\n         }\n         return new PieChartView.PieChartData(dataValues);\n     }\n", "test_patch": "", "problem_statement": "Statistics: Display total number of Episodes downloaded\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n2.6.1\n\n### Where did you get the app from\n\nF-Droid\n\n### Problem you may be having, or feature you want\n\nThe maximum size of the Episode Cache is set in number of episodes, rather than space currently occupied.\r\n\r\nHowever, only space taken up by the episodes seems to be exposed in the UI.\n\n### Suggested solution\n\nUnder Statistics > Downloads, display the number of episodes currently in the Cache, as well as space currently taken up.\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "The info is actually already presented:\n![Screenshot_20220731-231448.png](https://user-images.githubusercontent.com/11229646/182045679-3ed90496-2a9a-45c6-b22b-2287983b4a63.png)\n\nBut maybe we could introduce a 'sort' option, to allow you to sort based on nr of episodes or MBs taken up. The sort could then also affect the main number displayed in the graph (& the explanation text just below).\nEmphasis on 'total' ...which I have made explicit in the issue's title, but left implicit in the description - my bad.\r\n\r\nI didn't miss the individual counts, naturally, however summing up those figures is only feasible when few downloads are stored in the cache.\r\n\r\nOn my device, I have downloads scattered over dozens of different podcasts. Stopped counting after 30.\nIs this really something that belongs to the statistics screen? Note that you can determine the total number of downloaded episodes by going to the \"downloads\" screen and entering multi-select. The top bar then shows the total number\n> Is this really something that belongs to the statistics screen?\r\n\r\nAre there better options? The only alternative I can think of is in the Settings near the relevant Cache Size option, however this sounds less intuitive and convenient than having this piece of information in the same place where its friends are already hanging out.\r\n\r\nOf course I can only provide my n=1 suggestions, but speaking of locations, I personally find that many weeks after the move (so I had plenty of time to adapt) having Stats go from Settings to Subs was a net negative for me, and if I didn't have previous knowledge about the change, I might have not found out easily, because I almost don't use Subscriptions, and IMO it's not immediately obvious that I'm looking at what's supposed to be a chart - in my mind that exists as \"the weird looking icon they've added to Subs\".\r\n\r\nIt's not like having Stats in Settings was great, I'll readily acknowledge that, but it was more convenient than entering Subscriptions, if nothing else because Setttings is always immediately accessible whenever you open the drawer, unlike the other options that can scroll up.\r\n\r\nOn this subject I would welcome having Queue and its siblings pinned to the top of the drawer on large screens, so they cannot be scrolled up and out of view. The current behavior seems only fitting for older devices that don't have the now customary 6.5+\" tall screen \n> Is this really something that belongs to the statistics screen?\n\nTo be honest I have this question for the Downloads overview as a whole. They're not really statistics as much of an overview of disk space use per podcast. But having the number of episodes fits well with this overview of number of MBs on the device.\nA solution could be to have a counter for downloads entry or / and when in downloads screen next to downloads at the top number of episodes could be added. Something like : \"Downloads (7)\"\r\n\r\nFor the future, second solution would be good for bottom navigation.\nThe number of episodes in storage in itself is meaningless, it only works to prune the cache whose size AP regulates through this otherwise useless number.\r\n\r\nUltimately the user is most likely interested in how much space is taken up on their device, for the most part, since space is a meaningful metric in a setting of finite resources.\r\n\r\nIn fact, this might be a compelling argument in favor of setting the cache size based on space, rather than number of episodes.\r\n\r\nTake for example podcast A which is super-long (let's say 2 to 3 hours) and podcast B which is super-short (make it 5 minutes or less).\r\n\r\nUser Alice only listens to A and has her cache set to a low number in order to control resource hogging. Then she subscribes to B, thus tons of episodes from A disappear to \"make room\" for B.\r\n\r\nUser B only listens to B and can live with a cache set to a high number. Then he subscribes to A: give it enough time and the high cache number will turn into space hogging and possibly space running out.\r\n\r\nThis is of course a matter for another issue - I simply suggested a basic QoL improvement that has the advantage of being basically almost trivial to implement while making the current logic easier to work with.\r\n\r\nIn fact it might take less time for someone who already has a suitable development machine already set up, to submit a PR for a change this small, than it took me to argue in favor of it.\n> In fact it might take less time for someone who already has a suitable development machine already set up, to submit a PR for a change this small, than it took me to argue in favor of it.\n\nThen again, the volunteers you've been in discussing with don't have the development skills and bring other contributions to the project \ud83d\ude09\n> In fact it might take less time for someone who already has a suitable development machine already set up, to submit a PR for a change this small\r\n\r\nDoing a PR is easy, but if we just added every single feature that someone requested, the app would be entirely unusable. Deciding what features to add and how to present them to users is the hard part, and that's exactly what we are doing here by discussing :)\nHey, I would like to work on this.", "created_at": "2024-10-02T03:20:27Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7432, "instance_id": "AntennaPod__AntennaPod-7432", "issue_numbers": ["7200"], "base_commit": "751c358337b5fbb5b8e9eacbfc85007abc733205", "patch": "diff --git a/ui/preferences/src/main/res/xml/preferences_playback.xml b/ui/preferences/src/main/res/xml/preferences_playback.xml\nindex c6ae85f569..4cf65b3eb4 100644\n--- a/ui/preferences/src/main/res/xml/preferences_playback.xml\n+++ b/ui/preferences/src/main/res/xml/preferences_playback.xml\n@@ -68,18 +68,18 @@\n     </PreferenceCategory>\n \n     <PreferenceCategory android:title=\"@string/queue_label\">\n-        <SwitchPreferenceCompat\n-                android:defaultValue=\"true\"\n-                android:enabled=\"true\"\n-                android:key=\"prefEnqueueDownloaded\"\n-                android:summary=\"@string/pref_enqueue_downloaded_summary\"\n-                android:title=\"@string/pref_enqueue_downloaded_title\" />\n         <de.danoeh.antennapod.ui.preferences.preference.MaterialListPreference\n                 android:defaultValue=\"BACK\"\n                 android:entries=\"@array/enqueue_location_options\"\n                 android:entryValues=\"@array/enqueue_location_values\"\n                 android:key=\"prefEnqueueLocation\"\n                 android:title=\"@string/pref_enqueue_location_title\"/>\n+        <SwitchPreferenceCompat\n+                android:defaultValue=\"true\"\n+                android:enabled=\"true\"\n+                android:key=\"prefEnqueueDownloaded\"\n+                android:summary=\"@string/pref_enqueue_downloaded_summary\"\n+                android:title=\"@string/pref_enqueue_downloaded_title\" />\n         <SwitchPreferenceCompat\n                 android:defaultValue=\"true\"\n                 android:enabled=\"true\"\n", "test_patch": "", "problem_statement": "Make enqueue location setting easier to understand\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\r\n\r\n### App version\r\n\r\n3.4.0\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Problem you may be having, or feature you want\r\n\r\nI have few preferred podcasts I want to listen before any other potcasts.\r\n\r\nThere is already option, how to add downloaded episodes to the queue, but there is no similar for new episode action, there is only add to queue.\r\n\r\n### Suggested solution\r\n\r\nAdd new config option (general) and specific for each podcasts inside \"new action episode\".\r\n\r\nInstead only \"add to queue\" to have\r\n\r\n- add to queue back\r\n- add to queue front\r\n- add to queue after current\r\n- add to queue at random position\r\n\r\n| \u2139\ufe0f | **Implementation instructions**|\r\n|---|:---|\r\n| | This request has been discussed further below. If you're interested in implementing this, please see the  [conclusions relevant for implementation below](https://github.com/AntennaPod/AntennaPod/issues/7200#issuecomment-2184016908). Note: the original request (to add a new setting, which is covered in #7292 and is not part of this issue).<br><sub>The original post has been edited by the project maintainers to add this link.</sub> |\r\n\r\n### Screenshots / Drawings / Technical details\r\n\r\n_No response_\n", "hints_text": "Hi @xdml,\r\n\r\nThanks for chipping in with your suggestion. Actually the 'Enqueue location' setting already applies both to downloads that get added to the queue and episodes that get added to the queue through the new episodes action. We don't want to add another setting to do it differently. We should improve the setting, though, to make this clear.\r\n\r\nDecision:\r\n* Move the 'Enqueue location' setting to the top of the Queue group (to help avoid a seeming hierarchical link with 'Enqueue downloaded' setting)\r\n* Change the description\r\n  * From:\"Add episodes to: xxxx\"\r\n  * To: \"Location when automatically or manually adding an episode to the queue: xxxx\"\nMaybe your suggestion to change labels and descriptions of global configurations will be more precise and descriptive (I do not see any issue with current wording), but user will not be able to set automatic listening preference and user will be forced to manually reorder queue each time his preferred episode comes out...\r\n\r\nMy feature request is about to allow user to configure AntenaPod to automatically queue preferred episodes after current one, so user is not forced to do it manually.\nHi @xdml\nIs this what you're looking for?\n![Imagepipe_0.jpg](https://github.com/AntennaPod/AntennaPod/assets/11229646/a0e8a325-a6de-4301-8209-da60afe6336a)\n\n> specific for each podcast\n\nFor me this doesn't make much sense. For this goal, I think #2437 is better suited because it's more flexible.\nYes, but not in global configs but for specific podcast settings.\r\n\r\n![obrazek](https://github.com/AntennaPod/AntennaPod/assets/1033684/7baf69b1-5a7a-4147-9774-fa69fb1d63bc)\r\n\r\nThere I see only:\r\n\r\n![Screenshot_20240625_092630](https://github.com/AntennaPod/AntennaPod/assets/1033684/ede2ba4e-bc64-449c-9213-dc4e204cecc0)\r\n\nHi @xdml\nOk. Please note that the 'New episode action' already exists at podcast level. So if at podcast level you select the the option \"Add to queue\" it will do that in the global \"Enqueue location\".\n\nSo you want a new \"Enqueue location\" setting _at podcast level_. I'll adapt the ticket again to reflect this.\n\nAgain: I'm not convinced by this request, as more flexible requests exist. But this request we have not yet so should still be discussed.\nSorry for delay. Yes, you are right:\r\n\r\nOn podcast level is action \"Add to queue\" and it will follow global rule of \"Enqueue location\", but how I can set it so:\r\n\r\nAll podcasts goes to end of the queue, but only one favourite is enqueue after current? I do not see option to set \"higher\" listening priority for specific podcast.\n> All podcasts goes to end of the queue, but only one favourite is enqueue after current? I do not see option to set \"higher\" listening priority for specific podcast.\n\nIndeed. This is currently not possible. So your feature request is to have a new \"Enqueue location\" setting\u00a0at podcast level.\nHi @xdml,\r\nI created a seperate issue for the feature request, because that was easier than updating this issue :)\r\nPlease follow & give thumbs-up to that one.", "created_at": "2024-10-01T20:09:31Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7424, "instance_id": "AntennaPod__AntennaPod-7424", "issue_numbers": ["7157"], "base_commit": "a4bc5a64423730088e23f870b76a47e79a2c047a", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/SelectableAdapter.java b/app/src/main/java/de/danoeh/antennapod/ui/SelectableAdapter.java\nindex 4f1317a318..7e67c1e2a6 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/SelectableAdapter.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/SelectableAdapter.java\n@@ -47,7 +47,7 @@ public boolean onCreateActionMode(ActionMode mode, Menu menu) {\n \n             @Override\n             public boolean onPrepareActionMode(ActionMode mode, Menu menu) {\n-                updateTitle();\n+                onSelectedItemsUpdated();\n                 toggleSelectAllIcon(menu.findItem(R.id.select_toggle), false);\n                 return false;\n             }\n@@ -59,7 +59,7 @@ public boolean onActionItemClicked(ActionMode mode, MenuItem item) {\n                     shouldSelectLazyLoadedItems = selectAll;\n                     setSelected(0, getItemCount(), selectAll);\n                     toggleSelectAllIcon(item, selectAll);\n-                    updateTitle();\n+                    onSelectedItemsUpdated();\n                     return true;\n                 }\n                 return false;\n@@ -74,7 +74,7 @@ public void onDestroyActionMode(ActionMode mode) {\n                 notifyDataSetChanged();\n             }\n         });\n-        updateTitle();\n+        onSelectedItemsUpdated();\n \n         if (onSelectModeListener != null) {\n             onSelectModeListener.onStartSelectMode();\n@@ -109,7 +109,7 @@ public void setSelected(int pos, boolean selected) {\n         } else {\n             selectedIds.remove(getItemId(pos));\n         }\n-        updateTitle();\n+        onSelectedItemsUpdated();\n     }\n \n     /**\n@@ -154,7 +154,7 @@ private void toggleSelectAllIcon(MenuItem selectAllItem, boolean allSelected) {\n         }\n     }\n \n-    protected void updateTitle() {\n+    protected void onSelectedItemsUpdated() {\n         if (actionMode == null) {\n             return;\n         }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemListAdapter.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemListAdapter.java\nindex db79912611..9e2b964d48 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemListAdapter.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemListAdapter.java\n@@ -20,6 +20,7 @@\n \n import java.lang.ref.WeakReference;\n import java.util.ArrayList;\n+import java.util.Collections;\n import java.util.List;\n \n import de.danoeh.antennapod.R;\n@@ -53,7 +54,7 @@ public void setDummyViews(int dummyViews) {\n     public void updateItems(List<FeedItem> items) {\n         episodes = items;\n         notifyDataSetChanged();\n-        updateTitle();\n+        onSelectedItemsUpdated();\n     }\n \n     @Override\n@@ -209,7 +210,7 @@ public void onCreateContextMenu(final ContextMenu menu, View v, ContextMenu.Cont\n             }\n             inflater.inflate(R.menu.feeditemlist_context, menu);\n             menu.setHeaderTitle(longPressedItem.getTitle());\n-            FeedItemMenuHandler.onPrepareMenu(menu, longPressedItem, R.id.skip_episode_item);\n+            FeedItemMenuHandler.onPrepareMenu(menu, Collections.singletonList(longPressedItem), R.id.skip_episode_item);\n         }\n     }\n \ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeMultiSelectActionHandler.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeMultiSelectActionHandler.java\nindex a655982cbb..07f1a8cbc2 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeMultiSelectActionHandler.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeMultiSelectActionHandler.java\n@@ -28,19 +28,19 @@ public EpisodeMultiSelectActionHandler(Activity activity, int actionId) {\n     }\n \n     public void handleAction(List<FeedItem> items) {\n-        if (actionId == R.id.add_to_queue_batch) {\n+        if (actionId == R.id.add_to_queue_item) {\n             queueChecked(items);\n-        } else if (actionId == R.id.remove_from_queue_batch) {\n+        } else if (actionId == R.id.remove_from_queue_item) {\n             removeFromQueueChecked(items);\n-        }  else if (actionId == R.id.remove_from_inbox_batch) {\n+        }  else if (actionId == R.id.remove_inbox_item) {\n             removeFromInboxChecked(items);\n-        } else if (actionId == R.id.mark_read_batch) {\n+        } else if (actionId == R.id.mark_read_item) {\n             markedCheckedPlayed(items);\n-        } else if (actionId == R.id.mark_unread_batch) {\n+        } else if (actionId == R.id.mark_unread_item) {\n             markedCheckedUnplayed(items);\n-        } else if (actionId == R.id.download_batch) {\n+        } else if (actionId == R.id.download_item) {\n             downloadChecked(items);\n-        } else if (actionId == R.id.delete_batch) {\n+        } else if (actionId == R.id.remove_item) {\n             LocalDeleteModal.showLocalFeedDeleteWarningIfNecessary(activity, items, () -> deleteChecked(items));\n         } else {\n             Log.e(TAG, \"Unrecognized speed dial action item. Do nothing. id=\" + actionId);\n@@ -112,6 +112,9 @@ private void deleteChecked(List<FeedItem> items) {\n     }\n \n     private void showMessage(@PluralsRes int msgId, int numItems) {\n+        if (numItems == 1) {\n+            return;\n+        }\n         totalNumItems += numItems;\n         activity.runOnUiThread(() -> {\n             String text = activity.getResources().getQuantityString(msgId, totalNumItems, totalNumItems);\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodesListFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodesListFragment.java\nindex 08ec14ec09..bd4a085bb4 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodesListFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodesListFragment.java\n@@ -177,7 +177,7 @@ public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container,\n         swipeRefreshLayout.setDistanceToTriggerSync(getResources().getInteger(R.integer.swipe_refresh_distance));\n         swipeRefreshLayout.setOnRefreshListener(() -> FeedUpdateManager.getInstance().runOnceOrAsk(requireContext()));\n \n-        listAdapter = new EpisodeItemListAdapter((MainActivity) getActivity()) {\n+        listAdapter = new EpisodeItemListAdapter(getActivity()) {\n             @Override\n             public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMenuInfo menuInfo) {\n                 super.onCreateContextMenu(menu, v, menuInfo);\n@@ -186,6 +186,13 @@ public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMen\n                 }\n                 MenuItemUtils.setOnClickListeners(menu, EpisodesListFragment.this::onContextItemSelected);\n             }\n+\n+            @Override\n+            protected void onSelectedItemsUpdated() {\n+                super.onSelectedItemsUpdated();\n+                FeedItemMenuHandler.onPrepareMenu(floatingSelectMenu.getMenu(), getSelectedItems());\n+                floatingSelectMenu.updateItemVisibility();\n+            }\n         };\n         listAdapter.setOnSelectModeListener(this);\n         recyclerView.setAdapter(listAdapter);\n@@ -211,9 +218,9 @@ public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMen\n             int confirmationString = 0;\n             if (listAdapter.getSelectedItems().size() >= 25 || listAdapter.shouldSelectLazyLoadedItems()) {\n                 // Should ask for confirmation\n-                if (menuItem.getItemId() == R.id.mark_read_batch) {\n+                if (menuItem.getItemId() == R.id.mark_read_item) {\n                     confirmationString = R.string.multi_select_mark_played_confirmation;\n-                } else if (menuItem.getItemId() == R.id.mark_unread_batch) {\n+                } else if (menuItem.getItemId() == R.id.mark_unread_item) {\n                     confirmationString = R.string.multi_select_mark_unplayed_confirmation;\n                 }\n             }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java\nindex b03a23d100..8742990745 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java\n@@ -13,6 +13,7 @@\n import com.google.android.material.snackbar.Snackbar;\n \n import java.util.Arrays;\n+import java.util.List;\n \n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n@@ -47,50 +48,88 @@ private FeedItemMenuHandler() {\n      * This method should be called in the prepare-methods of menus. It changes\n      * the visibility of the menu items depending on a FeedItem's attributes.\n      *\n-     * @param menu               An instance of Menu\n-     * @param selectedItem     The FeedItem for which the menu is supposed to be prepared\n+     * @param menu          An instance of Menu\n+     * @param selectedItems The FeedItem for which the menu is supposed to be prepared\n+     * @param excludeIds Menu item that should be excluded\n      * @return Returns true if selectedItem is not null.\n      */\n-    public static boolean onPrepareMenu(Menu menu, FeedItem selectedItem) {\n-        if (menu == null || selectedItem == null) {\n+    public static boolean onPrepareMenu(Menu menu, List<FeedItem> selectedItems, int... excludeIds) {\n+        if (menu == null || selectedItems == null) {\n             return false;\n         }\n-        final boolean hasMedia = selectedItem.getMedia() != null;\n-        final boolean isPlaying = hasMedia && PlaybackStatus.isPlaying(selectedItem.getMedia());\n-        final boolean isInQueue = selectedItem.isTagged(FeedItem.TAG_QUEUE);\n-        final boolean fileDownloaded = hasMedia && selectedItem.getMedia().fileExists();\n-        final boolean isLocalFile = hasMedia && selectedItem.getFeed().isLocalFeed();\n-        final boolean isFavorite = selectedItem.isTagged(FeedItem.TAG_FAVORITE);\n-        final boolean hasTranscript = selectedItem.hasTranscript();\n+        boolean canSkip = false;\n+        boolean canRemoveFromQueue = false;\n+        boolean canAddToQueue = false;\n+        boolean canVisitWebsite = selectedItems.size() == 1;\n+        boolean canShare = selectedItems.size() == 1;\n+        boolean canRemoveFromInbox = false;\n+        boolean canMarkPlayed = false;\n+        boolean canMarkUnplayed = false;\n+        boolean canResetPosition = false;\n+        boolean canDelete = false;\n+        boolean canDownload = false;\n+        boolean canAddFavorite = false;\n+        boolean canRemoveFavorite = false;\n+        boolean canShowTranscript = selectedItems.size() == 1;\n+\n+        for (FeedItem item : selectedItems) {\n+            boolean hasMedia = item.getMedia() != null;\n+            canSkip |= hasMedia && PlaybackStatus.isPlaying(item.getMedia());\n+            canRemoveFromQueue |= item.isTagged(FeedItem.TAG_QUEUE);\n+            canAddToQueue |= hasMedia && !item.isTagged(FeedItem.TAG_QUEUE);\n+            canVisitWebsite |= !item.getFeed().isLocalFeed() && ShareUtils.hasLinkToShare(item);\n+            canShare |= !item.getFeed().isLocalFeed();\n+            canRemoveFromInbox |= item.isNew();\n+            canMarkPlayed |= !item.isPlayed();\n+            canMarkUnplayed |= item.isPlayed();\n+            canResetPosition |= hasMedia && item.getMedia().getPosition() != 0;\n+            canDelete |= hasMedia && item.getMedia().isDownloaded();\n+            canDownload |= hasMedia && !item.getMedia().isDownloaded() && !item.getFeed().isLocalFeed();\n+            canAddFavorite |= !item.isTagged(FeedItem.TAG_FAVORITE);\n+            canRemoveFavorite |= item.isTagged(FeedItem.TAG_FAVORITE);\n+            canShowTranscript |= item.hasTranscript();\n+        }\n \n-        setItemVisibility(menu, R.id.skip_episode_item, isPlaying);\n-        setItemVisibility(menu, R.id.remove_from_queue_item, isInQueue);\n-        setItemVisibility(menu, R.id.add_to_queue_item, !isInQueue && selectedItem.getMedia() != null);\n-        setItemVisibility(menu, R.id.visit_website_item, !selectedItem.getFeed().isLocalFeed()\n-                && ShareUtils.hasLinkToShare(selectedItem));\n-        setItemVisibility(menu, R.id.share_item, !selectedItem.getFeed().isLocalFeed());\n-        setItemVisibility(menu, R.id.remove_inbox_item, selectedItem.isNew());\n-        setItemVisibility(menu, R.id.mark_read_item, !selectedItem.isPlayed());\n-        setItemVisibility(menu, R.id.mark_unread_item, selectedItem.isPlayed());\n-        setItemVisibility(menu, R.id.reset_position, hasMedia && selectedItem.getMedia().getPosition() != 0);\n+        if (selectedItems.size() > 1) {\n+            canVisitWebsite = false;\n+            canShare = false;\n+            canShowTranscript = false;\n+        }\n+\n+        setItemVisibility(menu, R.id.skip_episode_item, canSkip);\n+        setItemVisibility(menu, R.id.remove_from_queue_item, canRemoveFromQueue);\n+        setItemVisibility(menu, R.id.add_to_queue_item, canAddToQueue);\n+        setItemVisibility(menu, R.id.visit_website_item, canVisitWebsite);\n+        setItemVisibility(menu, R.id.share_item, canShare);\n+        setItemVisibility(menu, R.id.remove_inbox_item, canRemoveFromInbox);\n+        setItemVisibility(menu, R.id.mark_read_item, canMarkPlayed);\n+        setItemVisibility(menu, R.id.mark_unread_item, canMarkUnplayed);\n+        setItemVisibility(menu, R.id.reset_position, canResetPosition);\n \n         // Display proper strings when item has no media\n-        if (hasMedia) {\n-            setItemTitle(menu, R.id.mark_read_item, R.string.mark_read_label);\n-            setItemTitle(menu, R.id.mark_unread_item, R.string.mark_unread_label);\n-        } else {\n+        if (selectedItems.size() == 1 && selectedItems.get(0).getMedia() == null) {\n             setItemTitle(menu, R.id.mark_read_item, R.string.mark_read_no_media_label);\n             setItemTitle(menu, R.id.mark_unread_item, R.string.mark_unread_label_no_media);\n+        } else {\n+            setItemTitle(menu, R.id.mark_read_item, R.string.mark_read_label);\n+            setItemTitle(menu, R.id.mark_unread_item, R.string.mark_unread_label);\n         }\n \n-        setItemVisibility(menu, R.id.add_to_favorites_item, !isFavorite);\n-        setItemVisibility(menu, R.id.remove_from_favorites_item, isFavorite);\n-        setItemVisibility(menu, R.id.remove_item, fileDownloaded || isLocalFile);\n-        setItemVisibility(menu, R.id.transcript_item, hasTranscript);\n+        setItemVisibility(menu, R.id.add_to_favorites_item, canAddFavorite);\n+        setItemVisibility(menu, R.id.remove_from_favorites_item, canRemoveFavorite);\n+        setItemVisibility(menu, R.id.remove_item, canDelete);\n+        setItemVisibility(menu, R.id.download_item, canDownload);\n+        setItemVisibility(menu, R.id.transcript_item, canShowTranscript);\n \n-        if (selectedItem.getFeed().getState() != Feed.STATE_SUBSCRIBED) {\n+        if (selectedItems.size() == 1 && selectedItems.get(0).getFeed().getState() != Feed.STATE_SUBSCRIBED) {\n             setItemVisibility(menu, R.id.mark_read_item, false);\n         }\n+\n+        if (excludeIds != null) {\n+            for (int id : excludeIds) {\n+                setItemVisibility(menu, id, false);\n+            }\n+        }\n         return true;\n     }\n \n@@ -125,26 +164,6 @@ public static void setItemTitle(Menu menu, int id, int noMedia) {\n         }\n     }\n \n-    /**\n-     * The same method as {@link #onPrepareMenu(Menu, FeedItem)}, but lets the\n-     * caller also specify a list of menu items that should not be shown.\n-     *\n-     * @param excludeIds Menu item that should be excluded\n-     * @return true if selectedItem is not null.\n-     */\n-    public static boolean onPrepareMenu(Menu menu, FeedItem selectedItem, int... excludeIds) {\n-        if (menu == null || selectedItem == null) {\n-            return false;\n-        }\n-        boolean rc = onPrepareMenu(menu, selectedItem);\n-        if (rc && excludeIds != null) {\n-            for (int id : excludeIds) {\n-                setItemVisibility(menu, id, false);\n-            }\n-        }\n-        return rc;\n-    }\n-\n     /**\n      * Default menu handling for the given FeedItem.\n      *\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/HorizontalItemListAdapter.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/HorizontalItemListAdapter.java\nindex d4407bf865..df121799fa 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/HorizontalItemListAdapter.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/HorizontalItemListAdapter.java\n@@ -14,6 +14,7 @@\n \n import java.lang.ref.WeakReference;\n import java.util.ArrayList;\n+import java.util.Collections;\n import java.util.List;\n \n public class HorizontalItemListAdapter extends RecyclerView.Adapter<HorizontalItemViewHolder>\n@@ -125,7 +126,7 @@ public void onCreateContextMenu(final ContextMenu menu, View v, ContextMenu.Cont\n         menu.clear();\n         inflater.inflate(R.menu.feeditemlist_context, menu);\n         menu.setHeaderTitle(longPressedItem.getTitle());\n-        FeedItemMenuHandler.onPrepareMenu(menu, longPressedItem, R.id.skip_episode_item);\n+        FeedItemMenuHandler.onPrepareMenu(menu, Collections.singletonList(longPressedItem), R.id.skip_episode_item);\n     }\n \n \ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/InboxFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/InboxFragment.java\nindex 68d7accf6c..efad446991 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/InboxFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/InboxFragment.java\n@@ -48,9 +48,6 @@ public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container,\n         emptyView.setIcon(R.drawable.ic_inbox);\n         emptyView.setTitle(R.string.no_inbox_head_label);\n         emptyView.setMessage(R.string.no_inbox_label);\n-        floatingSelectMenu.getMenu().findItem(R.id.mark_unread_batch).setVisible(false);\n-        floatingSelectMenu.getMenu().findItem(R.id.remove_from_queue_batch).setVisible(false);\n-        floatingSelectMenu.getMenu().findItem(R.id.delete_batch).setVisible(false);\n         return root;\n     }\n \ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java\nindex fa35b57ed6..cd7681bf9b 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java\n@@ -117,17 +117,13 @@ public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup c\n \n         floatingSelectMenu = root.findViewById(R.id.floatingSelectMenu);\n         floatingSelectMenu.inflate(R.menu.episodes_apply_action_speeddial);\n-        floatingSelectMenu.getMenu().findItem(R.id.download_batch).setVisible(false);\n-        floatingSelectMenu.getMenu().findItem(R.id.mark_read_batch).setVisible(false);\n-        floatingSelectMenu.getMenu().findItem(R.id.mark_unread_batch).setVisible(false);\n-        floatingSelectMenu.getMenu().findItem(R.id.remove_from_inbox_batch).setVisible(false);\n         floatingSelectMenu.setOnMenuItemClickListener(menuItem -> {\n             if (adapter.getSelectedCount() == 0) {\n                 ((MainActivity) getActivity()).showSnackbarAbovePlayer(R.string.no_items_selected,\n                         Snackbar.LENGTH_SHORT);\n                 return false;\n             }\n-            new EpisodeMultiSelectActionHandler(((MainActivity) getActivity()), menuItem.getItemId())\n+            new EpisodeMultiSelectActionHandler(getActivity(), menuItem.getItemId())\n                     .handleAction(adapter.getSelectedItems());\n             adapter.endSelectMode();\n             return true;\n@@ -370,6 +366,13 @@ public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMen\n             }\n             MenuItemUtils.setOnClickListeners(menu, CompletedDownloadsFragment.this::onContextItemSelected);\n         }\n+\n+        @Override\n+        protected void onSelectedItemsUpdated() {\n+            super.onSelectedItemsUpdated();\n+            FeedItemMenuHandler.onPrepareMenu(floatingSelectMenu.getMenu(), getSelectedItems());\n+            floatingSelectMenu.updateItemVisibility();\n+        }\n     }\n \n     public static class DownloadsSortDialog extends ItemSortDialog {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/episode/ItemPagerFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/episode/ItemPagerFragment.java\nindex d474b108d9..e53f664c9c 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/episode/ItemPagerFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/episode/ItemPagerFragment.java\n@@ -32,6 +32,7 @@\n import io.reactivex.disposables.Disposable;\n import io.reactivex.schedulers.Schedulers;\n \n+import java.util.Collections;\n import java.util.List;\n \n /**\n@@ -144,10 +145,10 @@ public void refreshToolbarState() {\n             return;\n         }\n         if (item.hasMedia()) {\n-            FeedItemMenuHandler.onPrepareMenu(toolbar.getMenu(), item);\n+            FeedItemMenuHandler.onPrepareMenu(toolbar.getMenu(), Collections.singletonList(item));\n         } else {\n             // these are already available via button1 and button2\n-            FeedItemMenuHandler.onPrepareMenu(toolbar.getMenu(), item,\n+            FeedItemMenuHandler.onPrepareMenu(toolbar.getMenu(), Collections.singletonList(item),\n                     R.id.mark_read_item, R.id.visit_website_item);\n         }\n     }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\nindex e4e64ffc53..f047632d84 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\n@@ -412,8 +412,6 @@ public void onQueueChanged(QueueEvent event) {\n     @Override\n     public void onStartSelectMode() {\n         swipeActions.detach();\n-        viewBinding.floatingSelectMenu.getMenu().findItem(R.id.download_batch).setVisible(!feed.isLocalFeed());\n-        viewBinding.floatingSelectMenu.setVisibility(View.VISIBLE);\n         updateRecyclerPadding();\n         updateToolbar();\n     }\n@@ -709,5 +707,12 @@ public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMen\n             }\n             MenuItemUtils.setOnClickListeners(menu, FeedItemlistFragment.this::onContextItemSelected);\n         }\n+\n+        @Override\n+        protected void onSelectedItemsUpdated() {\n+            super.onSelectedItemsUpdated();\n+            FeedItemMenuHandler.onPrepareMenu(viewBinding.floatingSelectMenu.getMenu(), getSelectedItems());\n+            viewBinding.floatingSelectMenu.updateItemVisibility();\n+        }\n     }\n }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java\nindex 36df4bcf36..269de7d6e0 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java\n@@ -42,6 +42,7 @@\n \n import java.text.DecimalFormat;\n import java.text.NumberFormat;\n+import java.util.Collections;\n import java.util.List;\n \n import de.danoeh.antennapod.R;\n@@ -467,7 +468,8 @@ public void setupOptionsMenu(Playable media) {\n         boolean isFeedMedia = media instanceof FeedMedia;\n         toolbar.getMenu().findItem(R.id.open_feed_item).setVisible(isFeedMedia);\n         if (isFeedMedia) {\n-            FeedItemMenuHandler.onPrepareMenu(toolbar.getMenu(), ((FeedMedia) media).getItem());\n+            FeedItemMenuHandler.onPrepareMenu(toolbar.getMenu(),\n+                    Collections.singletonList(((FeedMedia) media).getItem()));\n         }\n \n         toolbar.getMenu().findItem(R.id.set_sleeptimer_item).setVisible(!controller.sleepTimerActive());\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/video/VideoplayerActivity.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/video/VideoplayerActivity.java\nindex 2c3c335f94..834bffa5dc 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/video/VideoplayerActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/video/VideoplayerActivity.java\n@@ -74,6 +74,8 @@\n import org.greenrobot.eventbus.Subscribe;\n import org.greenrobot.eventbus.ThreadMode;\n \n+import java.util.Collections;\n+\n /**\n  * Activity for playing video files.\n  */\n@@ -549,7 +551,7 @@ public boolean onPrepareOptionsMenu(Menu menu) {\n \n         menu.findItem(R.id.open_feed_item).setVisible(isFeedMedia); // FeedMedia implies it belongs to a Feed\n         if (isFeedMedia) {\n-            FeedItemMenuHandler.onPrepareMenu(menu, ((FeedMedia) media).getItem());\n+            FeedItemMenuHandler.onPrepareMenu(menu, Collections.singletonList(((FeedMedia) media).getItem()));\n         }\n \n         menu.findItem(R.id.set_sleeptimer_item).setVisible(!controller.sleepTimerActive());\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java\nindex 2d5f8f6293..7832007b3f 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java\n@@ -427,6 +427,14 @@ public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMen\n                 super.onCreateContextMenu(menu, v, menuInfo);\n                 MenuItemUtils.setOnClickListeners(menu, QueueFragment.this::onContextItemSelected);\n             }\n+\n+            @Override\n+            protected void onSelectedItemsUpdated() {\n+                super.onSelectedItemsUpdated();\n+                FeedItemMenuHandler.onPrepareMenu(floatingSelectMenu.getMenu(), getSelectedItems(),\n+                        R.id.add_to_queue_item, R.id.remove_inbox_item);\n+                floatingSelectMenu.updateItemVisibility();\n+            }\n         };\n         recyclerAdapter.setOnSelectModeListener(this);\n         recyclerView.setAdapter(recyclerAdapter);\n@@ -444,15 +452,13 @@ public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMen\n \n         floatingSelectMenu = root.findViewById(R.id.floatingSelectMenu);\n         floatingSelectMenu.inflate(R.menu.episodes_apply_action_speeddial);\n-        floatingSelectMenu.getMenu().findItem(R.id.add_to_queue_batch).setVisible(false);\n-        floatingSelectMenu.getMenu().findItem(R.id.remove_from_inbox_batch).setVisible(false);\n         floatingSelectMenu.setOnMenuItemClickListener(menuItem -> {\n             if (recyclerAdapter.getSelectedCount() == 0) {\n                 ((MainActivity) getActivity()).showSnackbarAbovePlayer(R.string.no_items_selected,\n                         Snackbar.LENGTH_SHORT);\n                 return false;\n             }\n-            new EpisodeMultiSelectActionHandler(((MainActivity) getActivity()), menuItem.getItemId())\n+            new EpisodeMultiSelectActionHandler(getActivity(), menuItem.getItemId())\n                     .handleAction(recyclerAdapter.getSelectedItems());\n             recyclerAdapter.endSelectMode();\n             return true;\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/swipeactions/DeleteSwipeAction.java b/app/src/main/java/de/danoeh/antennapod/ui/swipeactions/DeleteSwipeAction.java\nindex 1ecfd11e0a..affcfbb4bd 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/swipeactions/DeleteSwipeAction.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/swipeactions/DeleteSwipeAction.java\n@@ -30,7 +30,7 @@ public int getActionColor() {\n \n     @Override\n     public String getTitle(Context context) {\n-        return context.getString(R.string.delete_episode_label);\n+        return context.getString(R.string.delete_label);\n     }\n \n     @Override\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/view/LocalDeleteModal.java b/app/src/main/java/de/danoeh/antennapod/ui/view/LocalDeleteModal.java\nindex f0a1105c18..1bc2107338 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/view/LocalDeleteModal.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/view/LocalDeleteModal.java\n@@ -23,7 +23,7 @@ public static void showLocalFeedDeleteWarningIfNecessary(Context context, Iterab\n         }\n \n         new MaterialAlertDialogBuilder(context)\n-                .setTitle(R.string.delete_episode_label)\n+                .setTitle(R.string.delete_label)\n                 .setMessage(R.string.delete_local_feed_warning_body)\n                 .setPositiveButton(R.string.delete_label, (dialog, which) -> deleteCommand.run())\n                 .setNegativeButton(R.string.cancel_label, null)\ndiff --git a/app/src/main/res/layout/floating_select_menu.xml b/app/src/main/res/layout/floating_select_menu.xml\nindex 4a72de0f7a..5b422028e6 100644\n--- a/app/src/main/res/layout/floating_select_menu.xml\n+++ b/app/src/main/res/layout/floating_select_menu.xml\n@@ -11,7 +11,7 @@\n         android:layout_height=\"match_parent\"\n         android:layout_marginHorizontal=\"16dp\"\n         android:layout_marginBottom=\"16dp\"\n-        app:cardCornerRadius=\"16dp\">\n+        app:cardCornerRadius=\"8dp\">\n \n         <HorizontalScrollView\n             android:id=\"@+id/scrollView\"\ndiff --git a/app/src/main/res/layout/floating_select_menu_item.xml b/app/src/main/res/layout/floating_select_menu_item.xml\nindex e84acde586..2972794c38 100644\n--- a/app/src/main/res/layout/floating_select_menu_item.xml\n+++ b/app/src/main/res/layout/floating_select_menu_item.xml\n@@ -21,8 +21,9 @@\n         android:layout_height=\"wrap_content\"\n         android:layout_marginTop=\"8dp\"\n         android:textColor=\"?android:attr/textColorPrimary\"\n-        android:lines=\"2\"\n+        android:maxLines=\"2\"\n         android:textAlignment=\"center\"\n-        android:ellipsize=\"end\" />\n+        android:ellipsize=\"end\"\n+        style=\"@style/TextAppearance.Material3.BodySmall\" />\n \n </LinearLayout>\ndiff --git a/app/src/main/res/menu/episodes_apply_action_speeddial.xml b/app/src/main/res/menu/episodes_apply_action_speeddial.xml\nindex 944d2e7c9a..fe48c60972 100644\n--- a/app/src/main/res/menu/episodes_apply_action_speeddial.xml\n+++ b/app/src/main/res/menu/episodes_apply_action_speeddial.xml\n@@ -8,37 +8,37 @@\n          visually it will be shown at the bottom of the list of actions.\n       -->\n     <item\n-        android:id=\"@+id/delete_batch\"\n+        android:id=\"@+id/remove_item\"\n         android:icon=\"@drawable/ic_delete\"\n-        android:title=\"@string/delete_episode_label\" />\n+        android:title=\"@string/delete_label\" />\n \n     <item\n-        android:id=\"@+id/download_batch\"\n+        android:id=\"@+id/download_item\"\n         android:icon=\"@drawable/ic_download\"\n         android:title=\"@string/download_label\" />\n \n     <item\n-        android:id=\"@+id/mark_unread_batch\"\n+        android:id=\"@+id/mark_unread_item\"\n         android:icon=\"@drawable/ic_mark_unplayed\"\n         android:title=\"@string/mark_unread_label\" />\n \n     <item\n-        android:id=\"@+id/mark_read_batch\"\n+        android:id=\"@+id/mark_read_item\"\n         android:icon=\"@drawable/ic_mark_played\"\n         android:title=\"@string/mark_read_label\" />\n \n     <item\n-        android:id=\"@+id/remove_from_queue_batch\"\n+        android:id=\"@+id/remove_from_queue_item\"\n         android:icon=\"@drawable/ic_playlist_remove\"\n         android:title=\"@string/remove_from_queue_label\" />\n \n     <item\n-        android:id=\"@+id/add_to_queue_batch\"\n+        android:id=\"@+id/add_to_queue_item\"\n         android:icon=\"@drawable/ic_playlist_play\"\n         android:title=\"@string/add_to_queue_label\" />\n \n     <item\n-        android:id=\"@+id/remove_from_inbox_batch\"\n+        android:id=\"@+id/remove_inbox_item\"\n         android:icon=\"@drawable/ic_check\"\n         android:title=\"@string/remove_inbox_label\" />\n \ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex da7261498a..42cab5f25e 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -224,7 +224,6 @@\n     <string name=\"pause_label\">Pause</string>\n     <string name=\"stream_label\">Stream</string>\n     <string name=\"delete_label\">Delete</string>\n-    <string name=\"delete_episode_label\">Delete episode</string>\n     <plurals name=\"deleted_multi_episode_batch_label\">\n         <item quantity=\"one\">%d downloaded episode deleted.</item>\n         <item quantity=\"other\">%d downloaded episodes deleted.</item>\n", "test_patch": "", "problem_statement": "Hide multi-select actions not applicable to the current selection\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\ndevelop\n\n### Where did you get the app from\n\nGoogle Play\n\n### Problem you may be having, or feature you want\n\nWhen starting multi-select, AntennaPod shows both \"mark as played\" and \"mark as unplayed\" even if all selected episodes are unplayed. This looks a bit weird. Especially if we want to use that menu even for single-select at some point.\n\n### Suggested solution\n\nHide the actions that are not relevant to the current selection\n\n### Screenshots / Drawings / Technical details\n\nNote that the current selection might be very large, especially with lazy loading. When \"select all\" or \"select all below\" was pressed (see `SelectableAdapter.shouldSelectLazyLoadedItems`), we should show all actions. Maybe even when a large number of items is selected, so that we don't need to loop over a huge number of items checking their attributes.\n", "hints_text": "", "created_at": "2024-09-23T21:20:05Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7403, "instance_id": "AntennaPod__AntennaPod-7403", "issue_numbers": ["7244"], "base_commit": "6efecd56b5989751a9727acb0d1529b8f199429a", "patch": "diff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 268cd6ed38..6b070cb0aa 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -676,6 +676,7 @@\n     <string name=\"gpodnetsync_pref_report_successful\">Successful</string>\n     <string name=\"gpodnetsync_pref_report_failed\">Failed</string>\n     <string name=\"gpodnetsync_username_characters_error\">Usernames may only contain letters, digits, hyphens and underscores.</string>\n+    <string name=\"nextcloud_login_error_generic\"><![CDATA[Unable to log into your Nextcloud.\\n\\n- Check your network connection.\\n- Confirm that you are using the correct server address.\\n- Make sure that the gpoddersync Nextcloud plugin is installed.]]></string>\n \n     <!-- Directory chooser -->\n     <string name=\"choose_data_directory\">Choose data folder</string>\ndiff --git a/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/synchronization/NextcloudAuthenticationFragment.java b/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/synchronization/NextcloudAuthenticationFragment.java\nindex 5df85efe21..26cc08a514 100644\n--- a/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/synchronization/NextcloudAuthenticationFragment.java\n+++ b/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/synchronization/NextcloudAuthenticationFragment.java\n@@ -3,6 +3,9 @@\n import android.app.Dialog;\n import android.content.DialogInterface;\n import android.os.Bundle;\n+import android.text.Spannable;\n+import android.text.SpannableString;\n+import android.text.style.ForegroundColorSpan;\n import android.view.View;\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n@@ -55,7 +58,6 @@ public Dialog onCreateDialog(@Nullable Bundle savedInstanceState) {\n     }\n \n     private void startLoginFlow() {\n-        viewBinding.errorText.setVisibility(View.GONE);\n         viewBinding.chooseHostButton.setVisibility(View.GONE);\n         viewBinding.loginProgressContainer.setVisibility(View.VISIBLE);\n         viewBinding.serverUrlText.setEnabled(false);\n@@ -106,9 +108,17 @@ public void onNextcloudAuthenticated(String server, String username, String pass\n     @Override\n     public void onNextcloudAuthError(String errorMessage) {\n         viewBinding.loginProgressContainer.setVisibility(View.GONE);\n-        viewBinding.errorText.setVisibility(View.VISIBLE);\n-        viewBinding.errorText.setText(errorMessage);\n         viewBinding.chooseHostButton.setVisibility(View.VISIBLE);\n         viewBinding.serverUrlText.setEnabled(true);\n+\n+        final MaterialAlertDialogBuilder errorDialog = new MaterialAlertDialogBuilder(getContext());\n+        errorDialog.setTitle(R.string.error_label);\n+        String genericMessage = getString(R.string.nextcloud_login_error_generic);\n+        SpannableString combinedMessage = new SpannableString(genericMessage + \"\\n\\n\" + errorMessage);\n+        combinedMessage.setSpan(new ForegroundColorSpan(0x88888888),\n+                genericMessage.length(), combinedMessage.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);\n+        errorDialog.setMessage(combinedMessage);\n+        errorDialog.setPositiveButton(android.R.string.ok, null);\n+        errorDialog.show();\n     }\n }\ndiff --git a/ui/preferences/src/main/res/layout/nextcloud_auth_dialog.xml b/ui/preferences/src/main/res/layout/nextcloud_auth_dialog.xml\nindex 0f25a271f5..8a8ba6a829 100644\n--- a/ui/preferences/src/main/res/layout/nextcloud_auth_dialog.xml\n+++ b/ui/preferences/src/main/res/layout/nextcloud_auth_dialog.xml\n@@ -56,14 +56,6 @@\n \n         </LinearLayout>\n \n-        <TextView\n-            android:id=\"@+id/errorText\"\n-            android:layout_width=\"wrap_content\"\n-            android:layout_height=\"wrap_content\"\n-            android:visibility=\"gone\"\n-            android:textColor=\"?attr/icon_red\"\n-            android:layout_marginBottom=\"16dp\" />\n-\n         <Button\n             android:id=\"@+id/chooseHostButton\"\n             android:layout_width=\"match_parent\"\n", "test_patch": "", "problem_statement": "Better error message if relevant app for Nextcloud is not installed\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n### App version\r\n\r\nVersion 3.4.0 de.danoeh.antennapod\r\n\r\n### Where did you get the app from\r\n\r\nF-Droid\r\n\r\n### Android version\r\n\r\nAndroid 14, CalyxOS 5.7.3\r\n\r\n### Device model\r\n\r\nFairphone 4 (FP4)  \r\n\r\n### First occurred\r\n\r\ntoday? One minute ago? \r\n\r\n### Steps to reproduce\r\n\r\n1. Freshly install app from fdroid\r\n2. Go to settings\r\n3. Syncronisation\r\n4. Select nextcloud there\r\n5. Enter a valid, existing host name. Optionally prefix with `https:`.\r\n\r\nAs I am not the one who would enter arbitrary URLs there, I also tried it with my real nextcloud instance/server first, obviously. Now that no godder app or so is installed there, as I could not find or which I am supposed to install (https://apps.nextcloud.com/?search=Gpodder or nextcloud podcasts?) respectively which are compatible. \r\n\r\n### Expected behaviour\r\n\r\nAnyway, well at the very least the error is wrong. It shows a dnd error, but I may expect an error like \"no podcast app y installed, please install y\". After all, that's why I chose to go this way, to maybe get a recommending what I am supposed to install.\r\n\r\nIMHO I however actually expect the login to work and the credentials/login being done (maybe via the nextcloud app sso after all) and only afterwqqrds it maybe can make me aware of a potential app missing on my server. \r\n\r\n### Current behaviour\r\n\r\nThe split view with Firefox at the bottom here proofs the site is reachable via other apps on the device. \r\n\r\nReal nextcloud:\r\n![Screenshot_20240613-231708_1_1](https://github.com/AntennaPod/AntennaPod/assets/11966684/d1c52872-1f3b-4523-ab37-1d8fb364d2a9)\r\n\r\nAny other host:\r\n![Screenshot_20240613-232219_1](https://github.com/AntennaPod/AntennaPod/assets/11966684/5f96388f-f89b-4ed2-9c99-431cfa58d0b4)\r\n\r\n\"no address associated with hostname\" and \"unable to resolve\" also weirdly sound like dns errors?\r\n\r\n### Logs\r\n\r\nNo logs provided. But here is a logcat reproducing the issue: \r\n[logcat_06-13-2024_23-35-36_antennapod.txt](https://github.com/user-attachments/files/15828958/logcat_06-13-2024_23-35-36_antennapod.txt)\r\n\r\nI.e. just pressing that button for resolving/continuing 3 times. Domain was antennapod.org for testing. \r\n\r\nInteresting maybe the 1000:\r\n```\r\nJobScheduler.JobStatus]\r\nExempted app com.nextcloud.client considered buggy\r\n```\r\n\r\nAnd whatever this is:\r\n```\r\nonStartInput event aborted\r\nXj.w: could not obtain extracted text\r\n\tat Xj.M.H(SourceFile:344)\r\n\tat Xj.A.d0(SourceFile:108)\r\n\tat Xg.A.v(SourceFile:197)\r\n\tat Xg.Y0.v(SourceFile:3)\r\n\tat com.touchtype.KeyboardService.onStartInput(SourceFile:7)\r\n\tat android.inputmethodservice.InputMethodService.doStartInput(InputMethodService.java:3119)\r\n\tat android.inputmethodservice.InputMethodService$InputMethodImpl.startInput(InputMethodService.java:831)\r\n\tat android.inputmethodservice.InputMethodService$InputMethodImpl.dispatchStartInput(InputMethodService.java:860)\r\n\tat android.inputmethodservice.IInputMethodWrapper.executeMessage(IInputMethodWrapper.java:197)\r\n\tat com.android.internal.os.HandlerCaller$MyHandler.handleMessage(HandlerCaller.java:44)\r\n\tat android.os.Handler.dispatchMessage(Handler.java:107)\r\n\tat android.os.Looper.loopOnce(Looper.java:232)\r\n\tat android.os.Looper.loop(Looper.java:317)\r\n\tat android.app.ActivityThread.main(ActivityThread.java:8501)\r\n\tat java.lang.reflect.Method.invoke(Native Method)\r\n\tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:552)\r\n\tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:878)\r\n```\r\n\r\nThough it's both probably unrelated and the last some Android thingy. \r\n\r\n## Environment\r\nAndroid version: 14\r\nOS version: 4.19.312-perf\r\nAntennaPod version: 3.4.0\r\nModel: FP4\r\nDevice: FP4\r\nProduct: FP4eea\r\n\r\nNextcloud 28\r\n\r\nNo crash report recorded\r\n\r\nAh and in case it's relevant the nextcloud app is also from F-Droid: Version 3.29.0\r\ncom.nextcloud.client\r\n\r\nEdit: also just to confirm, I now tried to load and play a podcast and it works flawlessly. So the app has no general Internet connectivity issues. \ud83d\ude09\n", "hints_text": "FYI I've installed the GPodder-API plugin and then it works flawlessly. So it seems the error message is incorrect and should be like \"XY plugin is not installed, please install it\".\n\"unable to resolve host\" means something was wrong with your network connection. \nNo, it does not! It is very reproducible, it likely just reports a 500 error or so (wrongly) as such a network error.\r\n\r\nAs said, the Nextcloud server was reachable. I even included a screenshot doing both at the same time.\r\nAs such, please re-open this.", "created_at": "2024-09-13T19:41:21Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7402, "instance_id": "AntennaPod__AntennaPod-7402", "issue_numbers": ["6677"], "base_commit": "43902d72343ca9e98b0ce2b2ab1fb40d31d6f39f", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedInfoFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedInfoFragment.java\nindex 87636f5332..a2cda28d88 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedInfoFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedInfoFragment.java\n@@ -41,6 +41,7 @@\n import de.danoeh.antennapod.ui.glide.FastBlurTransformation;\n import de.danoeh.antennapod.ui.screen.feed.preferences.EditUrlSettingsDialog;\n import de.danoeh.antennapod.ui.statistics.StatisticsFragment;\n+import de.danoeh.antennapod.ui.statistics.feed.FeedStatisticsDialogFragment;\n import de.danoeh.antennapod.ui.statistics.feed.FeedStatisticsFragment;\n import io.reactivex.Completable;\n import io.reactivex.Maybe;\n@@ -120,6 +121,9 @@ public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup c\n         getParentFragmentManager().beginTransaction().replace(R.id.statisticsFragmentContainer,\n                         FeedStatisticsFragment.newInstance(feedId, false), \"feed_statistics_fragment\")\n                 .commitAllowingStateLoss();\n+        viewBinding.statisticsFragmentContainer.setOnClickListener(v ->\n+                FeedStatisticsDialogFragment.newInstance(feedId, feed.getTitle())\n+                        .show(getChildFragmentManager().beginTransaction(), \"FeedStatistics\"));\n \n         viewBinding.statisticsButton.setOnClickListener(view -> {\n             StatisticsFragment fragment = new StatisticsFragment();\n@@ -239,12 +243,10 @@ private void showFeed() {\n                 ((MainActivity) getActivity()).loadChildFragment(fragment, TransitionEffect.SLIDE);\n             });\n         } else {\n-            viewBinding.statisticsButton.setVisibility(View.GONE);\n+            viewBinding.statisticsHeading.setVisibility(View.GONE);\n             viewBinding.statisticsFragmentContainer.setVisibility(View.GONE);\n-            viewBinding.statisticsHeadingLabel.setVisibility(View.GONE);\n             viewBinding.supportHeadingLabel.setVisibility(View.GONE);\n             viewBinding.supportUrl.setVisibility(View.GONE);\n-            viewBinding.descriptionHeadingLabel.setVisibility(View.GONE);\n         }\n \n         refreshToolbarState();\ndiff --git a/app/src/main/res/layout/feedinfo.xml b/app/src/main/res/layout/feedinfo.xml\nindex 7c7afa4256..5ff462fa9f 100644\n--- a/app/src/main/res/layout/feedinfo.xml\n+++ b/app/src/main/res/layout/feedinfo.xml\n@@ -54,8 +54,7 @@\n         android:layout_width=\"match_parent\"\n         android:layout_height=\"match_parent\"\n         android:clipToPadding=\"false\"\n-        android:paddingLeft=\"16dp\"\n-        android:paddingRight=\"16dp\"\n+        android:paddingHorizontal=\"8dp\"\n         android:paddingBottom=\"8dp\"\n         android:scrollbarStyle=\"outsideOverlay\"\n         app:layout_behavior=\"@string/appbar_scrolling_view_behavior\">\n@@ -65,82 +64,93 @@\n             android:layout_width=\"match_parent\"\n             android:layout_height=\"wrap_content\"\n             android:orientation=\"vertical\"\n-            android:paddingTop=\"16dp\"\n             android:paddingHorizontal=\"@dimen/additional_horizontal_spacing\">\n \n-            <TextView\n-                android:id=\"@+id/statisticsHeadingLabel\"\n-                android:layout_width=\"wrap_content\"\n+            <LinearLayout\n+                android:id=\"@+id/statisticsHeading\"\n+                android:layout_width=\"match_parent\"\n                 android:layout_height=\"wrap_content\"\n-                android:textSize=\"18sp\"\n-                android:layout_marginBottom=\"8dp\"\n-                android:text=\"@string/statistics_label\"\n-                android:textColor=\"?android:attr/textColorPrimary\"\n-                tools:background=\"@android:color/holo_red_light\" />\n+                android:paddingHorizontal=\"8dp\"\n+                android:layout_marginTop=\"16dp\"\n+                android:orientation=\"horizontal\">\n+\n+                <TextView\n+                    android:id=\"@+id/statisticsHeadingLabel\"\n+                    android:layout_width=\"0dp\"\n+                    android:layout_height=\"wrap_content\"\n+                    android:layout_gravity=\"center_vertical\"\n+                    android:text=\"@string/statistics_label\"\n+                    android:layout_weight=\"1\"\n+                    style=\"@style/TextAppearance.Material3.TitleMedium\" />\n+\n+                <Button\n+                    android:id=\"@+id/statisticsButton\"\n+                    android:layout_width=\"wrap_content\"\n+                    android:layout_height=\"wrap_content\"\n+                    android:layout_gravity=\"center_vertical\"\n+                    android:minWidth=\"0dp\"\n+                    android:minHeight=\"0dp\"\n+                    android:text=\"@string/statistics_view_all\"\n+                    style=\"@style/Widget.MaterialComponents.Button.TextButton\" />\n+\n+            </LinearLayout>\n \n             <androidx.fragment.app.FragmentContainerView\n                 android:id=\"@+id/statisticsFragmentContainer\"\n                 android:layout_width=\"match_parent\"\n-                android:layout_height=\"wrap_content\" />\n-\n-            <Button\n-                android:id=\"@+id/statisticsButton\"\n-                android:layout_width=\"wrap_content\"\n                 android:layout_height=\"wrap_content\"\n-                android:minWidth=\"0dp\"\n-                android:minHeight=\"0dp\"\n-                android:layout_marginBottom=\"16dp\"\n-                android:text=\"@string/statistics_view_all\"\n-                style=\"@style/Widget.MaterialComponents.Button.TextButton\" />\n+                android:paddingHorizontal=\"4dp\"\n+                tools:layout_height=\"20dp\"\n+                tools:background=\"@color/image_readability_tint\" />\n \n             <TextView\n                 android:id=\"@+id/supportHeadingLabel\"\n                 android:layout_width=\"match_parent\"\n                 android:layout_height=\"wrap_content\"\n+                android:layout_marginTop=\"16dp\"\n                 android:layout_marginBottom=\"4dp\"\n+                android:paddingHorizontal=\"8dp\"\n                 android:text=\"@string/support_funding_label\"\n-                android:textColor=\"?android:attr/textColorPrimary\"\n-                android:textSize=\"18sp\"\n-                tools:background=\"@android:color/holo_red_light\" />\n+                style=\"@style/TextAppearance.Material3.TitleMedium\" />\n \n             <TextView\n                 android:id=\"@+id/supportUrl\"\n                 android:layout_width=\"match_parent\"\n                 android:layout_height=\"wrap_content\"\n                 android:maxLines=\"8\"\n-                android:paddingTop=\"4dp\"\n-                android:paddingBottom=\"4dp\"\n+                android:paddingHorizontal=\"8dp\"\n                 android:linksClickable=\"true\"\n                 android:autoLink=\"web\"\n-                tools:background=\"@android:color/holo_green_dark\" />\n+                style=\"@style/TextAppearance.Material3.BodyMedium\"\n+                tools:text=\"Support this podcast\" />\n \n             <TextView\n                 android:id=\"@+id/descriptionHeadingLabel\"\n                 android:layout_width=\"wrap_content\"\n                 android:layout_height=\"wrap_content\"\n-                android:textSize=\"18sp\"\n+                android:layout_marginTop=\"16dp\"\n+                android:paddingHorizontal=\"8dp\"\n                 android:layout_marginBottom=\"4dp\"\n                 android:text=\"@string/description_label\"\n-                android:textColor=\"?android:attr/textColorPrimary\"\n-                tools:background=\"@android:color/holo_red_light\" />\n+                style=\"@style/TextAppearance.Material3.TitleMedium\" />\n \n             <TextView\n                 android:id=\"@+id/descriptionLabel\"\n                 android:layout_width=\"match_parent\"\n                 android:layout_height=\"wrap_content\"\n                 android:textIsSelectable=\"true\"\n-                tools:background=\"@android:color/holo_green_dark\" />\n+                android:paddingHorizontal=\"8dp\"\n+                style=\"@style/TextAppearance.Material3.BodyMedium\"\n+                tools:text=\"Description\" />\n \n             <TextView\n                 android:id=\"@+id/urlHeadingLabel\"\n                 android:layout_width=\"wrap_content\"\n                 android:layout_height=\"wrap_content\"\n-                android:textSize=\"18sp\"\n                 android:layout_marginTop=\"16dp\"\n-                android:layout_marginBottom=\"4dp\"\n+                android:paddingHorizontal=\"8dp\"\n                 android:text=\"@string/url_label\"\n-                android:textColor=\"?android:attr/textColorPrimary\"\n-                tools:background=\"@android:color/holo_red_light\" />\n+                style=\"@style/TextAppearance.Material3.TitleMedium\" />\n \n             <TextView\n                 android:id=\"@+id/urlLabel\"\n@@ -150,8 +160,9 @@\n                 android:maxLines=\"4\"\n                 android:paddingTop=\"4dp\"\n                 android:paddingBottom=\"4dp\"\n+                android:paddingHorizontal=\"8dp\"\n                 android:drawablePadding=\"4dp\"\n-                tools:background=\"@android:color/holo_green_dark\"\n+                style=\"@style/TextAppearance.Material3.BodyMedium\"\n                 tools:text=\"http://www.example.com/feed\" />\n \n         </LinearLayout>\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 268cd6ed38..0364641291 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -737,15 +737,16 @@\n     <string name=\"keep_updated\">Keep updated</string>\n     <string name=\"keep_updated_summary\">Include this podcast when (auto-)refreshing all podcasts</string>\n     <string name=\"auto_download_disabled_globally\">Auto download is disabled in the main AntennaPod settings</string>\n-    <string name=\"statistics_time_played\">Time played:</string>\n-    <string name=\"statistics_total_duration\">Total duration (estimate):</string>\n-    <string name=\"statistics_episodes_on_device\">Episodes on the device:</string>\n-    <string name=\"statistics_space_used\">Space used:</string>\n-    <string name=\"statistics_episodes_started_total\">Episodes started/total:</string>\n-    <string name=\"statistics_expected_next_episode\">Expected next episode:</string>\n+    <string name=\"statistics_episodes_started\">started</string>\n+    <string name=\"statistics_episodes_total\">total</string>\n+    <string name=\"statistics_episodes_played\">played</string>\n+    <string name=\"statistics_episodes_downloaded\">downloaded</string>\n+    <string name=\"statistics_episodes_space\">space taken</string>\n+    <string name=\"statistics_release_schedule\">release schedule</string>\n+    <string name=\"statistics_release_next\">next episode (estimate)</string>\n     <string name=\"statistics_expected_next_episode_any_day\">Any day now</string>\n     <string name=\"statistics_expected_next_episode_unknown\">Unknown</string>\n-    <string name=\"statistics_view_all\">View for all podcasts \u00bb</string>\n+    <string name=\"statistics_view_all\">All podcasts \u00bb</string>\n     <string name=\"wait_icon\" translatable=\"false\">\u2026</string>\n     <string name=\"edit_url_menu\">Edit feed URL</string>\n     <string name=\"edit_url_confirmation_msg\">Changing the RSS address can easily break the playback state and episode listings of the podcast. We do NOT recommend changing it and will NOT provide support if anything goes wrong. This cannot be undone. The broken subscription CANNOT be repaired by simply changing the address back. We recommend creating a backup before continuing.</string>\ndiff --git a/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/downloads/DownloadStatisticsListAdapter.java b/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/downloads/DownloadStatisticsListAdapter.java\nindex 8f1d51cf20..2af3f0bf7c 100644\n--- a/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/downloads/DownloadStatisticsListAdapter.java\n+++ b/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/downloads/DownloadStatisticsListAdapter.java\n@@ -49,11 +49,9 @@ protected void onBindFeedViewHolder(StatisticsHolder holder, StatisticsItem item\n         text += \" \u2022 \" + context.getResources().getQuantityString(R.plurals.num_episodes, numEpisodes, numEpisodes);\n         holder.value.setText(text);\n \n-        holder.itemView.setOnClickListener(v -> {\n-            FeedStatisticsDialogFragment yourDialogFragment = FeedStatisticsDialogFragment.newInstance(\n-                    item.feed.getId(), item.feed.getTitle());\n-            yourDialogFragment.show(fragment.getChildFragmentManager().beginTransaction(), \"DialogFragment\");\n-        });\n+        holder.itemView.setOnClickListener(v ->\n+                FeedStatisticsDialogFragment.newInstance(item.feed.getId(), item.feed.getTitle())\n+                        .show(fragment.getChildFragmentManager().beginTransaction(), \"FeedStatistics\"));\n     }\n \n }\ndiff --git a/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/feed/FeedStatisticsFragment.java b/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/feed/FeedStatisticsFragment.java\nindex c35c411f71..1948c60828 100644\n--- a/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/feed/FeedStatisticsFragment.java\n+++ b/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/feed/FeedStatisticsFragment.java\n@@ -17,6 +17,7 @@\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n import de.danoeh.antennapod.model.feed.SortOrder;\n+import de.danoeh.antennapod.ui.common.ThemeUtils;\n import de.danoeh.antennapod.ui.statistics.R;\n import de.danoeh.antennapod.ui.statistics.databinding.FeedStatisticsBinding;\n import io.reactivex.Observable;\n@@ -29,7 +30,6 @@\n import java.util.Collections;\n import java.util.Date;\n import java.util.List;\n-import java.util.Locale;\n \n public class FeedStatisticsFragment extends Fragment {\n     private static final String EXTRA_FEED_ID = \"de.danoeh.antennapod.extra.feedId\";\n@@ -54,17 +54,20 @@ public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup c\n                              @Nullable Bundle savedInstanceState) {\n         feedId = getArguments().getLong(EXTRA_FEED_ID);\n         viewBinding = FeedStatisticsBinding.inflate(inflater);\n+        loadStatistics();\n \n-        if (!getArguments().getBoolean(EXTRA_DETAILED)) {\n-            for (int i = 0; i < viewBinding.getRoot().getChildCount(); i++) {\n-                View child = viewBinding.getRoot().getChildAt(i);\n-                if (\"detailed\".equals(child.getTag())) {\n-                    child.setVisibility(View.GONE);\n-                }\n-            }\n+        if (getArguments().getBoolean(EXTRA_DETAILED)) {\n+            viewBinding.secondRowContainer.setVisibility(View.VISIBLE);\n+            int color = ThemeUtils.getColorFromAttr(getContext(), R.attr.colorSurface);\n+            viewBinding.playbackTime.getRoot().setBackgroundColor(color);\n+            viewBinding.episodesStarted.getRoot().setBackgroundColor(color);\n+            viewBinding.spaceDownloaded.getRoot().setBackgroundColor(color);\n+            viewBinding.episodesTotal.getRoot().setBackgroundColor(color);\n+            viewBinding.durationTotal.getRoot().setBackgroundColor(color);\n+            viewBinding.episodesDownloaded.getRoot().setBackgroundColor(color);\n+            viewBinding.expectedNextEpisode.getRoot().setBackgroundColor(color);\n+            viewBinding.episodeSchedule.getRoot().setBackgroundColor(color);\n         }\n-\n-        loadStatistics();\n         return viewBinding.getRoot();\n     }\n \n@@ -148,28 +151,49 @@ private String getReadableSchedule(ReleaseScheduleGuesser.Guess guess) {\n \n     private void showStats(Pair<StatisticsItem, ReleaseScheduleGuesser.Guess> p) {\n         StatisticsItem s = p.first;\n-        viewBinding.startedTotalLabel.setText(String.format(Locale.getDefault(), \"%d / %d\",\n-                s.episodesStarted, s.episodes));\n-        viewBinding.timePlayedLabel.setText(Converter.shortLocalizedDuration(getContext(), s.timePlayed));\n-        viewBinding.totalDurationLabel.setText(Converter.shortLocalizedDuration(getContext(), s.time));\n-        viewBinding.onDeviceLabel.setText(String.format(Locale.getDefault(), \"%d\", s.episodesDownloadCount));\n-        viewBinding.spaceUsedLabel.setText(Formatter.formatShortFileSize(getContext(), s.totalDownloadSize));\n+        viewBinding.episodesStarted.mainLabel.setText(getResources()\n+                .getQuantityString(R.plurals.num_episodes, (int) s.episodesStarted, s.episodesStarted));\n+        viewBinding.episodesStarted.subtitleLabel.setText(R.string.statistics_episodes_started);\n+\n+        viewBinding.episodesTotal.mainLabel.setText(getResources()\n+                .getQuantityString(R.plurals.num_episodes, (int) s.episodes, s.episodes));\n+        viewBinding.episodesTotal.subtitleLabel.setText(R.string.statistics_episodes_total);\n+\n+        viewBinding.playbackTime.mainLabel.setText(Converter.shortLocalizedDuration(getContext(), s.timePlayed));\n+        viewBinding.playbackTime.subtitleLabel.setText(R.string.statistics_episodes_played);\n+\n+        viewBinding.durationTotal.mainLabel.setText(Converter.shortLocalizedDuration(getContext(), s.time));\n+        viewBinding.durationTotal.subtitleLabel.setText(R.string.statistics_episodes_total);\n+\n+        viewBinding.episodesDownloaded.mainLabel.setText(getResources()\n+                .getQuantityString(R.plurals.num_episodes, (int) s.episodesDownloadCount, s.episodesDownloadCount));\n+        viewBinding.episodesDownloaded.subtitleLabel.setText(R.string.statistics_episodes_downloaded);\n+\n+        viewBinding.spaceDownloaded.mainLabel.setText(Formatter.formatShortFileSize(getContext(), s.totalDownloadSize));\n+        viewBinding.spaceDownloaded.subtitleLabel.setText(R.string.statistics_episodes_space);\n \n+        viewBinding.expectedNextEpisode.subtitleLabel.setText(R.string.statistics_release_next);\n+        viewBinding.episodeSchedule.subtitleLabel.setText(R.string.statistics_release_schedule);\n         ReleaseScheduleGuesser.Guess guess = p.second;\n         if (!s.feed.getPreferences().getKeepUpdated()) {\n-            viewBinding.expectedNextEpisodeLabel.setText(R.string.updates_disabled_label);\n+            viewBinding.expectedNextEpisode.subtitleLabel.setText(R.string.statistics_expected_next_episode_unknown);\n+            viewBinding.episodeSchedule.subtitleLabel.setText(R.string.updates_disabled_label);\n         } else if (guess == null || guess.nextExpectedDate.getTime() <= new Date().getTime() - 7 * 24 * 3600000L) {\n             // More than 30 days delayed\n-            viewBinding.expectedNextEpisodeLabel.setText(R.string.statistics_expected_next_episode_unknown);\n+            viewBinding.expectedNextEpisode.mainLabel.setText(R.string.statistics_expected_next_episode_unknown);\n+            viewBinding.episodeSchedule.mainLabel.setText(R.string.statistics_expected_next_episode_unknown);\n         } else {\n-            String text = DateFormatter.formatAbbrev(getContext(), guess.nextExpectedDate);\n             if (guess.nextExpectedDate.getTime() <= new Date().getTime()) {\n-                text = getString(R.string.statistics_expected_next_episode_any_day);\n+                viewBinding.expectedNextEpisode.mainLabel.setText(R.string.statistics_expected_next_episode_any_day);\n+            } else {\n+                viewBinding.expectedNextEpisode.mainLabel.setText(\n+                        DateFormatter.formatAbbrev(getContext(), guess.nextExpectedDate));\n             }\n-            if (guess.schedule != ReleaseScheduleGuesser.Schedule.UNKNOWN) {\n-                text += \" (\" + getReadableSchedule(guess) + \")\";\n+            if (guess.schedule == ReleaseScheduleGuesser.Schedule.UNKNOWN) {\n+                viewBinding.episodeSchedule.mainLabel.setText(R.string.statistics_expected_next_episode_unknown);\n+            } else {\n+                viewBinding.episodeSchedule.mainLabel.setText(getReadableSchedule(guess));\n             }\n-            viewBinding.expectedNextEpisodeLabel.setText(text);\n         }\n     }\n \ndiff --git a/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/subscriptions/PlaybackStatisticsListAdapter.java b/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/subscriptions/PlaybackStatisticsListAdapter.java\nindex c597e18bbb..c22c19737b 100644\n--- a/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/subscriptions/PlaybackStatisticsListAdapter.java\n+++ b/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/subscriptions/PlaybackStatisticsListAdapter.java\n@@ -68,10 +68,8 @@ protected void onBindFeedViewHolder(StatisticsHolder holder, StatisticsItem stat\n         long time = statsItem.timePlayed;\n         holder.value.setText(Converter.shortLocalizedDuration(context, time));\n \n-        holder.itemView.setOnClickListener(v -> {\n-            FeedStatisticsDialogFragment yourDialogFragment = FeedStatisticsDialogFragment.newInstance(\n-                    statsItem.feed.getId(), statsItem.feed.getTitle());\n-            yourDialogFragment.show(fragment.getChildFragmentManager().beginTransaction(), \"DialogFragment\");\n-        });\n+        holder.itemView.setOnClickListener(v ->\n+                FeedStatisticsDialogFragment.newInstance(statsItem.feed.getId(), statsItem.feed.getTitle())\n+                        .show(fragment.getChildFragmentManager().beginTransaction(), \"FeedStatistics\"));\n     }\n }\ndiff --git a/ui/statistics/src/main/res/layout/feed_statistics.xml b/ui/statistics/src/main/res/layout/feed_statistics.xml\nindex 02afb0161b..ccb0efbe08 100644\n--- a/ui/statistics/src/main/res/layout/feed_statistics.xml\n+++ b/ui/statistics/src/main/res/layout/feed_statistics.xml\n@@ -1,131 +1,65 @@\n <?xml version=\"1.0\" encoding=\"utf-8\"?>\n-<TableLayout\n+<LinearLayout\n     xmlns:android=\"http://schemas.android.com/apk/res/android\"\n     xmlns:tools=\"http://schemas.android.com/tools\"\n     android:layout_width=\"match_parent\"\n-    android:layout_height=\"wrap_content\">\n+    android:layout_height=\"wrap_content\"\n+    android:orientation=\"vertical\">\n \n-    <TableRow\n-        android:tag=\"detailed\">\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:orientation=\"horizontal\">\n \n-        <TextView\n-            android:layout_width=\"match_parent\"\n-            android:layout_height=\"wrap_content\"\n-            android:layout_weight=\"1\"\n-            android:text=\"@string/statistics_episodes_started_total\" />\n+        <include\n+            android:id=\"@+id/playbackTime\"\n+            layout=\"@layout/feed_statistics_card\" />\n \n-        <TextView\n-            android:id=\"@+id/startedTotalLabel\"\n-            android:layout_width=\"match_parent\"\n-            android:layout_height=\"wrap_content\"\n-            android:layout_weight=\"1\"\n-            android:layout_marginLeft=\"8dp\"\n-            android:layout_marginStart=\"8dp\"\n-            android:text=\"@string/wait_icon\"\n-            tools:text=\"0 / 0\" />\n+        <include\n+            android:id=\"@+id/episodesStarted\"\n+            layout=\"@layout/feed_statistics_card\" />\n \n-    </TableRow>\n+        <include\n+            android:id=\"@+id/spaceDownloaded\"\n+            layout=\"@layout/feed_statistics_card\" />\n \n-    <TableRow>\n+    </LinearLayout>\n \n-        <TextView\n-            android:layout_width=\"match_parent\"\n-            android:layout_height=\"wrap_content\"\n-            android:layout_weight=\"1\"\n-            android:text=\"@string/statistics_time_played\" />\n+    <LinearLayout\n+        android:id=\"@+id/secondRowContainer\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:visibility=\"gone\"\n+        android:orientation=\"horizontal\"\n+        tools:visibility=\"visible\">\n \n-        <TextView\n-            android:id=\"@+id/timePlayedLabel\"\n-            android:layout_width=\"match_parent\"\n-            android:layout_height=\"wrap_content\"\n-            android:layout_weight=\"1\"\n-            android:layout_marginLeft=\"8dp\"\n-            android:layout_marginStart=\"8dp\"\n-            android:text=\"@string/wait_icon\"\n-            tools:text=\"0 min\" />\n+        <include\n+            android:id=\"@+id/episodesTotal\"\n+            layout=\"@layout/feed_statistics_card\" />\n \n-    </TableRow>\n+        <include\n+            android:id=\"@+id/durationTotal\"\n+            layout=\"@layout/feed_statistics_card\" />\n \n-    <TableRow\n-        android:tag=\"detailed\">\n+        <include\n+            android:id=\"@+id/episodesDownloaded\"\n+            layout=\"@layout/feed_statistics_card\" />\n \n-        <TextView\n-            android:layout_width=\"match_parent\"\n-            android:layout_height=\"wrap_content\"\n-            android:layout_weight=\"1\"\n-            android:text=\"@string/statistics_total_duration\" />\n+    </LinearLayout>\n \n-        <TextView\n-            android:id=\"@+id/totalDurationLabel\"\n-            android:layout_width=\"match_parent\"\n-            android:layout_height=\"wrap_content\"\n-            android:layout_weight=\"1\"\n-            android:layout_marginLeft=\"8dp\"\n-            android:layout_marginStart=\"8dp\"\n-            android:text=\"@string/wait_icon\"\n-            tools:text=\"0 min\" />\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:orientation=\"horizontal\">\n \n-    </TableRow>\n+        <include\n+            android:id=\"@+id/expectedNextEpisode\"\n+            layout=\"@layout/feed_statistics_card\" />\n \n-    <TableRow>\n+        <include\n+            android:id=\"@+id/episodeSchedule\"\n+            layout=\"@layout/feed_statistics_card\" />\n \n-        <TextView\n-            android:layout_width=\"match_parent\"\n-            android:layout_height=\"wrap_content\"\n-            android:layout_weight=\"1\"\n-            android:text=\"@string/statistics_episodes_on_device\" />\n+    </LinearLayout>\n \n-        <TextView\n-            android:id=\"@+id/onDeviceLabel\"\n-            android:layout_width=\"match_parent\"\n-            android:layout_height=\"wrap_content\"\n-            android:layout_weight=\"1\"\n-            android:layout_marginLeft=\"8dp\"\n-            android:layout_marginStart=\"8dp\"\n-            android:text=\"@string/wait_icon\"\n-            tools:text=\"0\" />\n-\n-    </TableRow>\n-\n-    <TableRow>\n-\n-        <TextView\n-            android:layout_width=\"match_parent\"\n-            android:layout_height=\"wrap_content\"\n-            android:layout_weight=\"1\"\n-            android:text=\"@string/statistics_space_used\" />\n-\n-        <TextView\n-            android:id=\"@+id/spaceUsedLabel\"\n-            android:layout_width=\"match_parent\"\n-            android:layout_height=\"wrap_content\"\n-            android:layout_weight=\"1\"\n-            android:layout_marginLeft=\"8dp\"\n-            android:layout_marginStart=\"8dp\"\n-            android:text=\"@string/wait_icon\"\n-            tools:text=\"0 MB\" />\n-\n-    </TableRow>\n-\n-    <TableRow>\n-\n-        <TextView\n-            android:layout_width=\"match_parent\"\n-            android:layout_height=\"wrap_content\"\n-            android:layout_weight=\"1\"\n-            android:text=\"@string/statistics_expected_next_episode\" />\n-\n-        <TextView\n-            android:id=\"@+id/expectedNextEpisodeLabel\"\n-            android:layout_width=\"match_parent\"\n-            android:layout_height=\"wrap_content\"\n-            android:layout_weight=\"1\"\n-            android:layout_marginLeft=\"8dp\"\n-            android:layout_marginStart=\"8dp\"\n-            android:lines=\"2\"\n-            android:text=\"@string/wait_icon\"\n-            tools:text=\"Jan 1st (weekly)\" />\n-\n-    </TableRow>\n-\n-</TableLayout>\n+</LinearLayout>\ndiff --git a/ui/statistics/src/main/res/layout/feed_statistics_card.xml b/ui/statistics/src/main/res/layout/feed_statistics_card.xml\nnew file mode 100644\nindex 0000000000..8f728ea87c\n--- /dev/null\n+++ b/ui/statistics/src/main/res/layout/feed_statistics_card.xml\n@@ -0,0 +1,28 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<LinearLayout\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:tools=\"http://schemas.android.com/tools\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"match_parent\"\n+    android:layout_weight=\"1\"\n+    android:layout_margin=\"4dp\"\n+    android:padding=\"8dp\"\n+    android:background=\"?attr/colorSurfaceContainer\"\n+    android:orientation=\"vertical\">\n+\n+    <TextView\n+        android:id=\"@+id/mainLabel\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:text=\"@string/wait_icon\"\n+        style=\"@style/TextAppearance.Material3.TitleSmall\"\n+        tools:text=\"1 Episode\" />\n+\n+    <TextView\n+        android:id=\"@+id/subtitleLabel\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        style=\"@style/TextAppearance.Material3.BodySmall\"\n+        tools:text=\"on this device\" />\n+\n+</LinearLayout>\n", "test_patch": "", "problem_statement": "Improving the design of podcast information page\n### Checklist\r\n\r\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\r\n\r\n### App version\r\n\r\n3.1.1\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Problem you may be having, or feature you want\r\n\r\nHi there, so i was exploring the app to see where could be done more improvements to the design and i saw the about podcast screen and i felt this requires improvement, as same there is hierarchy issue, no proper difference between heading, sub heading and the design looks vague.\r\n\r\nThanks\r\n\r\n<img width=\"250\" src=\"https://github.com/AntennaPod/AntennaPod/assets/85757758/4ee2e06a-d9a3-48fa-a2b9-4d704decaceb\" />\r\n\r\n\r\n### Suggested solution\r\n\r\nI've redesigned it and yet kept it simple and easy to implement, this looks more fresh and good to interact with, kindly review this design and i hope this makes a good difference.\r\n\r\n### Screenshots / Drawings / Technical details\r\n\r\n<img width=\"250\" src=\"https://github.com/AntennaPod/AntennaPod/assets/85757758/4d3f9da1-0727-4cd0-8696-80cae4fb8f5e\" />\r\n\r\nHere's the redesigned one.\r\n\r\nThanks\n", "hints_text": "@keunes @ByteHamster Hi guys.\n\nAny feedbacks?\nHi @bhaskarblur\nNo, not yet. We both have full-time jobs, sometimes also other activities in the evening, and a bunch of other things to do as well for this project. Please be patient. Don't worry, we will get back to you.\nHi guys, I am really sorry for urgency. I won't hurry or make any new issues for sometime now. Let's take this slow and good.\n\nI will finish my PR today and get it merged first then you can let me know if there's anywhere else I can improve. \n\nPS: Apologies.\nHi guys @keunes @ByteHamster . Any feedbacks on this? So that we look further and i implement this\nHi @bhaskarblur, thanks for working on this. I like your mockup, but I have a couple of comments while waiting for the team's views:\r\n\r\n- On the use of icons (especially the 'information' one): would that not lead users to tapping them expecting a corresponding action to happen? At the moment, that is the case for the paper clip icon (see also comment below).\r\n- (A side comment - the feed URL is currently copied when tapping the paper clip, but no feedback (such as 'URL copied to clipboard') is provided to the user. If this is beyond scope and cannot be tackled at the same time as this, I will open a separate issue.)\r\n- On the term 'link': perhaps it should be made more obvious if we refer to the podcast's website or to the feed URL. \r\n- On the Statistics section: please use the correct capitalisation ('hr', 'MB', 'device', 'episode'), as we have recently harmonised strings to use sentence case throughout the app.\nHi. Thanks for your comments.  I didn't get the 1st MD 2nd point . Can you explain a bit more?\n> no feedback (such as 'URL copied to clipboard') is provided to the user.\r\n\r\nWe do show such a message for Android 12 and earlier. On Android 12L and later, Google no longer recommends showing such a message because the Android system shows a message when copying something. See #6468\n> I didn't get the 1st MD 2nd point . Can you explain a bit more?\r\n\r\nWhen you use the current screen, the paper clip icon indicates an action that users can perform (copying the feed URL to clipboard). If we decide to also have icons as decoration, that could be confusing (unless the distinction between the two types of icons - actionable and not - can be made clear). \r\n\r\n> We do show such a message for Android 12 and earlier.\r\n\r\nI see. I'm still on Android 12, but the snackbar is gone there too and I don't have any system message. Let me know if you think it's worth a separate issue.\nApparently I didn't pay enough attention when reviewing that PR. Fixed in #6745\nSo any inputs for me?\nHi guys, anything new on this @ByteHamster @keunes \nShould we keep the cover section on that screen consistent with the cover section on the episodes list? I'm not sure but using two different designs there could be a bit unexpected.\nHi, long time, how're you, yes we'll follow the same as episodes, i am referring towards the body design of the screen to be changed\nI like it :) I would still try to use the Google Material font types, but I guess there should be a choice that looks similar to what you designed here. Changing the statistics section is probably quite a bit of work because the same layout is used on other screens. So if you plan to work on a PR, I think it should be two independent ones (one for the page design and one for the statistics section design).\nGood to hear that, The final implementation will follow Google material design principles at every place.\r\nWhat can be the next steps? What should i do?\r\nPlease let me know, Thanks\n> What should i do?\r\n\r\nIf you want to, you could update the layout files to make it look like your design (except the statistics section, that one would be better in an independent PR). Note that we already have an icon for the statistics page that is a bit different to the one you used. The existing icon should be re-used there.\nOk then, i'll make changes to this section, then will make individual PR for Statistics later\nHello, I really like AntennaPod and am looking forward to seeing this improvement land in the App.\r\n\r\nHowever I have a question, will the new information page really use green(as in the second screenshot) as complementary colour? To me it feels kind of off, since the rest of the App uses blue as complementary colour(e.g. for Links(at least right now in the App) etc, see the first screenshot).\r\n\r\nAnd secondly I would like to float the idea that the statistics could also show a %age of the overall progress.\r\nSo for instance  \"0.5 hr played\" would instead show something like \"0.5 hr played of 20 hr; 2,5% played\" or/and show how many episodes have been played e.g. \"1/10 episodes played; 10% played\",...\r\nI think that could be a nice addition, a possible downsides I could imagine would be that the UI might be too bloated with them. And it might also be a good idea to implement a toggle to hide them, since some ppl might not want to see a progress report lets say of a news Podcast, and maybe only for Documentary Podcasts where it might be far more interesting how many hours are still left until completion.\nFor color, we'll use the Blue only, that's in the app, ignore this green color in screenshot design.\r\nThanks", "created_at": "2024-09-13T19:26:58Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7393, "instance_id": "AntennaPod__AntennaPod-7393", "issue_numbers": ["7368"], "base_commit": "1528cde0e012fb7a818fdc50d76981c137b64ca1", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/TimeRangeDialog.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/TimeRangeDialog.java\nindex 683c162fce..c962a455e7 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/TimeRangeDialog.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/TimeRangeDialog.java\n@@ -126,16 +126,20 @@ protected void onDraw(Canvas canvas) {\n             canvas.drawCircle(p2.x, p2.y, padding / 2, paintSelected);\n \n             paintText.setTextSize(0.6f * padding);\n-            String timeRange;\n+            float textBaseY = (size - paintText.descent() - paintText.ascent()) / 2;\n             if (from == to) {\n-                timeRange = getContext().getString(R.string.sleep_timer_always);\n+                String timeRange = getContext().getString(R.string.sleep_timer_always);\n+                canvas.drawText(timeRange, size / 2, textBaseY, paintText);\n             } else if (DateFormat.is24HourFormat(getContext())) {\n-                timeRange = String.format(Locale.getDefault(), \"%02d:00 - %02d:00\", from, to);\n+                String timeRange = String.format(Locale.getDefault(), \"%02d:00 - %02d:00\", from, to);\n+                canvas.drawText(timeRange, size / 2, textBaseY, paintText);\n             } else {\n-                timeRange = String.format(Locale.getDefault(), \"%02d:00 %s - %02d:00 %s\", from % 12,\n-                        from >= 12 ? \"PM\" : \"AM\", to % 12, to >= 12 ? \"PM\" : \"AM\");\n+                String timeFrom = String.format(Locale.getDefault(), \"%02d:00 %s\", from % 12, from >= 12 ? \"PM\" : \"AM\");\n+                String timeTo = String.format(Locale.getDefault(), \"%02d:00 %s\", to % 12, to >= 12 ? \"PM\" : \"AM\");\n+                canvas.drawText(timeFrom, size / 2, textBaseY - paintText.getTextSize(), paintText);\n+                canvas.drawText(\"-\", size / 2, textBaseY, paintText);\n+                canvas.drawText(timeTo, size / 2, textBaseY + paintText.getTextSize(), paintText);\n             }\n-            canvas.drawText(timeRange, size / 2, (size - paintText.descent() - paintText.ascent()) / 2, paintText);\n         }\n \n         protected Point radToPoint(float angle, float radius) {\n", "test_patch": "", "problem_statement": "The time period overlaps with the marks on the clock in 'Sleep timer'\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.5.0-beta1 (be3ad792b)\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\nGalaxy S21 5G\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Click an episode to see the details\r\n2. Click the 'Sleep timer' icon\r\n3. Tick the 'Automatically activate the sleep timer when pressing play between ...' checkbox\r\n4. Click the 'Setting' icon\n\n### Expected behaviour\n\nThe time period should be clearly represented on the clock without overlapping ambiguities.\n\n### Current behaviour\n\nThe time period, such as \"10:00 PM - 06:00 AM\", overlaps with both 18 and 6 on the clock.\r\n\r\n\r\nhttps://github.com/user-attachments/assets/b2a977c7-4791-4adb-9040-7e51aa8a23a5\r\n\r\n\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2024-09-08T13:36:59Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7392, "instance_id": "AntennaPod__AntennaPod-7392", "issue_numbers": ["7351"], "base_commit": "1528cde0e012fb7a818fdc50d76981c137b64ca1", "patch": "diff --git a/app/src/main/res/layout/home_section.xml b/app/src/main/res/layout/home_section.xml\nindex c1bac5e915..f8379b0ff2 100644\n--- a/app/src/main/res/layout/home_section.xml\n+++ b/app/src/main/res/layout/home_section.xml\n@@ -52,11 +52,12 @@\n         android:id=\"@+id/numNewItemsLabel\"\n         android:layout_width=\"wrap_content\"\n         android:layout_height=\"wrap_content\"\n-        android:layout_marginVertical=\"12dp\"\n         android:layout_marginStart=\"8dp\"\n+        android:layout_marginTop=\"12dp\"\n+        android:layout_marginBottom=\"10dp\"\n+        android:paddingBottom=\"1sp\"\n         android:background=\"@drawable/bg_pill\"\n         android:paddingHorizontal=\"8dp\"\n-        android:paddingBottom=\"1sp\"\n         android:textAlignment=\"center\"\n         android:textColor=\"?attr/colorPrimary\"\n         android:textSize=\"16sp\"\n", "test_patch": "", "problem_statement": "Misalignment of 'See what's new' counter with the text\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n### App version\r\n\r\n3.5.0-beta1 (be3ad792b)\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Android version\r\n\r\n12\r\n\r\n### Device model\r\n\r\nGalaxy S21 5G\r\n\r\n### First occurred\r\n\r\n_No response_\r\n\r\n### Steps to reproduce\r\n\r\n1. Open the home screen.\r\n2. Observe the placement of 'See what's new' counter.\r\n\r\n### Expected behaviour\r\n\r\nThe 'See what's new' counter should be vertically aligned with its text label.\r\n\r\n### Current behaviour\r\n\r\nThe 'See what's new' counter is slightly lower than its corresponding text, leading to visual misalignment.\r\n\r\n![SCREENSHOT_0](https://github.com/user-attachments/assets/f9d6409a-75e8-4e40-8084-d31c5963b119)\r\n\r\n\r\n### Logs\r\n\r\n_No response_\n", "hints_text": "", "created_at": "2024-09-08T13:27:10Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7388, "instance_id": "AntennaPod__AntennaPod-7388", "issue_numbers": ["7205"], "base_commit": "3fdc39f517e5fa1f39b3db4da8386668f93f2aa8", "patch": "diff --git a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/internal/LocalPSMP.java b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/internal/LocalPSMP.java\nindex e6f2668e66..c1d55c8e81 100644\n--- a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/internal/LocalPSMP.java\n+++ b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/internal/LocalPSMP.java\n@@ -31,6 +31,7 @@\n \n import java.io.File;\n import java.io.IOException;\n+import java.util.Collections;\n import java.util.List;\n import java.util.concurrent.CountDownLatch;\n import java.util.concurrent.TimeUnit;\n@@ -579,6 +580,9 @@ protected void setPlayable(Playable playable) {\n     }\n \n     public List<String> getAudioTracks() {\n+        if (mediaPlayer == null) {\n+            return Collections.emptyList();\n+        }\n         return mediaPlayer.getAudioTracks();\n     }\n \n@@ -587,6 +591,9 @@ public void setAudioTrack(int track) {\n     }\n \n     public int getSelectedAudioTrack() {\n+        if (mediaPlayer == null) {\n+            return -1;\n+        }\n         return mediaPlayer.getSelectedAudioTrack();\n     }\n \n", "test_patch": "", "problem_statement": "App Crashes When Playing A Video Podcast Episode\n### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.4.0 5f5d744e7\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\nLineageOS 13 (lineage_raven-userdebug 13 TQ3A.230901.001)\n\n### Device model\n\nGoogle Pixel 6 Pro\n\n### First occurred\n\n1 or 2 days ago\n\n### Steps to reproduce\n\n1. Press play on a video podcast episode\n\n### Expected behaviour\n\nPlay the video podcast in the in-app video player\n\n### Current behaviour\n\nAs soon as I hit the play button, the video interface pops up, but then the app crashes completely, without warning\n\n### Logs\n\n## Environment\r\nAndroid version: 13\r\nOS version: 5.10.157-gd6584346874f\r\nAntennaPod version: 3.4.0\r\nModel: Pixel 6 Pro\r\nDevice: raven\r\nProduct: raven\r\n\r\n## Crash info\r\nTime: 29-05-2024 09:26:31\r\nAntennaPod version: 3.4.0\r\n\r\n## StackTrace\r\n```\r\njava.lang.NullPointerException: Attempt to invoke virtual method 'java.util.List de.danoeh.antennapod.playback.service.internal.ExoPlayerWrapper.getAudioTracks()' on a null object reference\r\n\tat de.danoeh.antennapod.playback.service.internal.LocalPSMP.getAudioTracks(SourceFile:582)\r\n\tat de.danoeh.antennapod.playback.service.PlaybackService.getAudioTracks(SourceFile:1772)\r\n\tat de.danoeh.antennapod.playback.service.PlaybackController.getAudioTracks(SourceFile:437)\r\n\tat de.danoeh.antennapod.ui.screen.playback.video.VideoplayerActivity.onPrepareOptionsMenu(SourceFile:570)\r\n\tat android.app.Activity.onPreparePanel(Activity.java:4398)\r\n\tat androidx.activity.ComponentActivity.onPreparePanel(SourceFile:497)\r\n\tat androidx.appcompat.view.WindowCallbackWrapper.onPreparePanel(SourceFile:100)\r\n\tat androidx.appcompat.app.AppCompatDelegateImpl$AppCompatWindowCallback.onPreparePanel(SourceFile:3170)\r\n\tat androidx.appcompat.app.AppCompatDelegateImpl.preparePanel(SourceFile:1940)\r\n\tat androidx.appcompat.app.AppCompatDelegateImpl.doInvalidatePanelMenu(SourceFile:2194)\r\n\tat androidx.appcompat.app.AppCompatDelegateImpl$2.run(SourceFile:276)\r\n\tat android.os.Handler.handleCallback(Handler.java:942)\r\n\tat android.os.Handler.dispatchMessage(Handler.java:99)\r\n\tat android.os.Looper.loopOnce(Looper.java:201)\r\n\tat android.os.Looper.loop(Looper.java:288)\r\n\tat android.app.ActivityThread.main(ActivityThread.java:7924)\r\n\tat java.lang.reflect.Method.invoke(Native Method)\r\n\tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548)\r\n\tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:936)\r\n```\r\n\n", "hints_text": "This issue occurs with both downloaded and non-downloaded video files. It may have started a bit before two days ago but that's the first time I noticed this since I only watch video podcasts once a week or so. Previously, the app only crashed when playing videos if the video was partially downloaded.\nI'm having this same issue with all podcasts, video or no video. Exactly as described above. \n\nAndroid 14\nGoogle Pixel 7 Pro\nAntennaPod 3.4.0 (F-droid)\n\n```\n## Environment\nAndroid version: 14\nOS version: 5.10.189-android13-4-00012-g1217bb583cc5-ab11174560\nAntennaPod version: 3.4.0\nModel: Pixel 7 Pro\nDevice: cheetah\nProduct: cheetah\n\n## Crash info\nTime: 29-05-2024 13:37:55\nAntennaPod version: 3.4.0\n```\n\n```\n## StackTrace\njava.lang.RuntimeException: Unable to start service de.danoeh.antennapod.playback.service.PlaybackService@fb53169 with Intent { cmp=de.danoeh.antennapod/.playback.service.PlaybackService (has extras) }: android.app.ForegroundServiceStartNotAllowedException: Service.startForeground() not allowed due to mAllowStartForeground false: service de.danoeh.antennapod/.playback.service.PlaybackService\n\tat android.app.ActivityThread.handleServiceArgs(ActivityThread.java:5053)\n\tat android.app.ActivityThread.-$$Nest$mhandleServiceArgs(Unknown Source:0)\n\tat android.app.ActivityThread$H.handleMessage(ActivityThread.java:2390)\n\tat android.os.Handler.dispatchMessage(Handler.java:107)\n\tat android.os.Looper.loopOnce(Looper.java:232)\n\tat android.os.Looper.loop(Looper.java:317)\n\tat android.app.ActivityThread.main(ActivityThread.java:8501)\n\tat java.lang.reflect.Method.invoke(Native Method)\n\tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:552)\n\tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:878)\nCaused by: android.app.ForegroundServiceStartNotAllowedException: Service.startForeground() not allowed due to mAllowStartForeground false: service de.danoeh.antennapod/.playback.service.PlaybackService\n\tat android.app.ForegroundServiceStartNotAllowedException$1.createFromParcel(ForegroundServiceStartNotAllowedException.java:54)\n\tat android.app.ForegroundServiceStartNotAllowedException$1.createFromParcel(ForegroundServiceStartNotAllowedException.java:50)\n\tat android.os.Parcel.readParcelableInternal(Parcel.java:5015)\n\tat android.os.Parcel.readParcelable(Parcel.java:4997)\n\tat android.os.Parcel.createExceptionOrNull(Parcel.java:3177)\n\tat android.os.Parcel.createException(Parcel.java:3166)\n\tat android.os.Parcel.readException(Parcel.java:3149)\n\tat android.os.Parcel.readException(Parcel.java:3091)\n\tat android.app.IActivityManager$Stub$Proxy.setServiceForeground(IActivityManager.java:6861)\n\tat android.app.Service.startForeground(Service.java:775)\n\tat de.danoeh.antennapod.playback.service.internal.PlaybackServiceStateManager.startForeground(SourceFile:22)\n\tat de.danoeh.antennapod.playback.service.PlaybackService.onStartCommand(SourceFile:500)\n\tat android.app.ActivityThread.handleServiceArgs(ActivityThread.java:5035)\n\t... 9 more\n```\n\n> I'm having this same issue with all podcasts, video or no video. Exactly as described above.\r\n> \r\n> Android 14 Google Pixel 7 Pro AntennaPod 3.4.0 (F-droid)\r\n> \r\n> ```\r\n> ## Environment\r\n> Android version: 14\r\n> OS version: 5.10.189-android13-4-00012-g1217bb583cc5-ab11174560\r\n> AntennaPod version: 3.4.0\r\n> Model: Pixel 7 Pro\r\n> Device: cheetah\r\n> Product: cheetah\r\n> \r\n> ## Crash info\r\n> Time: 29-05-2024 13:37:55\r\n> AntennaPod version: 3.4.0\r\n> ```\r\n> \r\n> ```\r\n> ## StackTrace\r\n> java.lang.RuntimeException: Unable to start service de.danoeh.antennapod.playback.service.PlaybackService@fb53169 with Intent { cmp=de.danoeh.antennapod/.playback.service.PlaybackService (has extras) }: android.app.ForegroundServiceStartNotAllowedException: Service.startForeground() not allowed due to mAllowStartForeground false: service de.danoeh.antennapod/.playback.service.PlaybackService\r\n> \tat android.app.ActivityThread.handleServiceArgs(ActivityThread.java:5053)\r\n> \tat android.app.ActivityThread.-$$Nest$mhandleServiceArgs(Unknown Source:0)\r\n> \tat android.app.ActivityThread$H.handleMessage(ActivityThread.java:2390)\r\n> \tat android.os.Handler.dispatchMessage(Handler.java:107)\r\n> \tat android.os.Looper.loopOnce(Looper.java:232)\r\n> \tat android.os.Looper.loop(Looper.java:317)\r\n> \tat android.app.ActivityThread.main(ActivityThread.java:8501)\r\n> \tat java.lang.reflect.Method.invoke(Native Method)\r\n> \tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:552)\r\n> \tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:878)\r\n> Caused by: android.app.ForegroundServiceStartNotAllowedException: Service.startForeground() not allowed due to mAllowStartForeground false: service de.danoeh.antennapod/.playback.service.PlaybackService\r\n> \tat android.app.ForegroundServiceStartNotAllowedException$1.createFromParcel(ForegroundServiceStartNotAllowedException.java:54)\r\n> \tat android.app.ForegroundServiceStartNotAllowedException$1.createFromParcel(ForegroundServiceStartNotAllowedException.java:50)\r\n> \tat android.os.Parcel.readParcelableInternal(Parcel.java:5015)\r\n> \tat android.os.Parcel.readParcelable(Parcel.java:4997)\r\n> \tat android.os.Parcel.createExceptionOrNull(Parcel.java:3177)\r\n> \tat android.os.Parcel.createException(Parcel.java:3166)\r\n> \tat android.os.Parcel.readException(Parcel.java:3149)\r\n> \tat android.os.Parcel.readException(Parcel.java:3091)\r\n> \tat android.app.IActivityManager$Stub$Proxy.setServiceForeground(IActivityManager.java:6861)\r\n> \tat android.app.Service.startForeground(Service.java:775)\r\n> \tat de.danoeh.antennapod.playback.service.internal.PlaybackServiceStateManager.startForeground(SourceFile:22)\r\n> \tat de.danoeh.antennapod.playback.service.PlaybackService.onStartCommand(SourceFile:500)\r\n> \tat android.app.ActivityThread.handleServiceArgs(ActivityThread.java:5035)\r\n> \t... 9 more\r\n> ```\r\n\r\nLooks like what you found can be easily fixed using the following advice:\r\n\r\nhttps://stackoverflow.com/questions/77786169/service-startforeground-not-allowed-due-to-mallowstartforeground-false-when-tr\r\n\r\nI don't think it's the same as what I found though\nNot sure why but this issue stopped happening, I'll go ahead and close it\nThis issue came back and it's been happening for months, figured I'd reopen this because it's kind of a pain.", "created_at": "2024-09-08T09:36:42Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7387, "instance_id": "AntennaPod__AntennaPod-7387", "issue_numbers": ["7383"], "base_commit": "3fdc39f517e5fa1f39b3db4da8386668f93f2aa8", "patch": "diff --git a/app/src/main/res/layout/simple_list_fragment.xml b/app/src/main/res/layout/simple_list_fragment.xml\nindex 63c418d173..09421ab8f3 100644\n--- a/app/src/main/res/layout/simple_list_fragment.xml\n+++ b/app/src/main/res/layout/simple_list_fragment.xml\n@@ -38,7 +38,7 @@\n         android:id=\"@+id/progLoading\"\n         android:layout_width=\"wrap_content\"\n         android:layout_height=\"wrap_content\"\n-        android:layout_gravity=\"center\"\n+        android:layout_centerInParent=\"true\"\n         android:indeterminateOnly=\"true\"\n         android:visibility=\"gone\" />\n \n@@ -46,6 +46,6 @@\n         android:id=\"@+id/floatingSelectMenu\"\n         android:layout_width=\"match_parent\"\n         android:layout_height=\"wrap_content\"\n-        android:layout_gravity=\"bottom\" />\n+        android:layout_alignParentBottom=\"true\" />\n \n </RelativeLayout>\n", "test_patch": "", "problem_statement": "Multi-select on downloads page not shown\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.5.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n14\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\nStart multi-select on downloads screen\n\n### Expected behaviour\n\nShow popup like on other screens\n\n### Current behaviour\n\nNo popup\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2024-09-08T09:30:20Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7386, "instance_id": "AntennaPod__AntennaPod-7386", "issue_numbers": ["7385"], "base_commit": "462494964d6658f1552bca809f9b973ebe8d3a57", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/actionbutton/ItemActionButton.java b/app/src/main/java/de/danoeh/antennapod/actionbutton/ItemActionButton.java\nindex 54714be3d1..84b2461670 100644\n--- a/app/src/main/java/de/danoeh/antennapod/actionbutton/ItemActionButton.java\n+++ b/app/src/main/java/de/danoeh/antennapod/actionbutton/ItemActionButton.java\n@@ -7,7 +7,6 @@\n import androidx.annotation.StringRes;\n import android.view.View;\n \n-import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.playback.service.PlaybackStatus;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedMedia;\n@@ -49,8 +48,6 @@ public static ItemActionButton forItem(@NonNull FeedItem item) {\n             return new PlayActionButton(item);\n         } else if (isDownloadingMedia) {\n             return new CancelDownloadActionButton(item);\n-        } else if (item.getFeed().getState() != Feed.STATE_SUBSCRIBED) {\n-            return new StreamActionButton(item);\n         } else if (UserPreferences.isStreamOverDownload()) {\n             return new StreamActionButton(item);\n         } else {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\nindex f9c41496f4..e4e64ffc53 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\n@@ -696,6 +696,9 @@ protected void afterBindViewHolder(EpisodeItemViewHolder holder, int pos) {\n                     .withPlaceholderView(holder.placeholder)\n                     .withCoverView(holder.cover)\n                     .load();\n+            if (feed.getState() != Feed.STATE_SUBSCRIBED) {\n+                holder.secondaryActionButton.setVisibility(View.GONE);\n+            }\n         }\n \n         @Override\n", "test_patch": "", "problem_statement": "Episode preview do no respect preference to download vs stream\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n### App version\r\n\r\n3.5.0-beta3 (462494964)\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Android version\r\n\r\n14\r\n\r\n### Device model\r\n\r\nOne plus 12\r\n\r\n### First occurred\r\n\r\n_No response_\r\n\r\n### Steps to reproduce\r\n\r\nSet settings to disable prefer streaming over download\r\nSearch for a podcast\r\nOpen podcast to see description and episodes list\r\n\r\n### Expected behaviour\r\n\r\nButton next to episodes should be the one to download, or at least should trigger a download.\r\n\r\n| \u2139\ufe0f | **Implementation instructions**|\r\n|---|:---|\r\n| | This request has been discussed further below. If you're interested in implementing this, please see the  [conclusions relevant for implementation below](https://github.com/AntennaPod/AntennaPod/issues/7385#issuecomment-2334601950).<br><sub>The original post has been edited by the project maintainers to add this link.</sub> |\r\n\r\n### Current behaviour\r\n\r\nButton to episodes is to stream episodes\r\nI am not sure anymore but I think it wasn't so in previous beta.\r\n\r\n### Logs\r\n\r\n_No response_\n", "hints_text": "This is done on purpose because playing episodes that are not subscribed is supposed to be more like a preview, not like a full subscription \nIt seems weird to me as it does not respect settings to download and not to stream.\r\nYou could also end up not being able to continue to listen when leaving wifi or worse impact your mobile data when you didn't want to.\r\nAnd last con it makes it behave differently with interaction in any other episodes list.\r\n\r\nOf course it's my own opinion but I find it not logical at all to do it this way ! :-/\r\n\nThanks @Matth7878 for the feedback. I kinda agree with you. It discourages the usual download & play flow for those who normally download, but those who normally stream won't notice any difference (between preview & usual play).\r\n\r\nDiscussing this, @ByteHamster and I came to the conclusion that it's probably best to simply **hide the button altogether** on the preview screen. Then it's really clear that it's a preview, and both downloading & streaming are still possible from the episode detail view (and the swipe actions would also still work).", "created_at": "2024-09-06T18:56:11Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7379, "instance_id": "AntennaPod__AntennaPod-7379", "issue_numbers": ["7343"], "base_commit": "936bfa029ef5fd6cc85d9f0fd448c4c19e767822", "patch": "diff --git a/app/src/main/res/layout/feed_item_list_fragment.xml b/app/src/main/res/layout/feed_item_list_fragment.xml\nindex f697288cd4a..f2535bfbdef 100644\n--- a/app/src/main/res/layout/feed_item_list_fragment.xml\n+++ b/app/src/main/res/layout/feed_item_list_fragment.xml\n@@ -24,7 +24,7 @@\n                 android:layout_width=\"match_parent\"\n                 android:layout_height=\"match_parent\"\n                 android:background=\"@color/image_readability_tint\"\n-                android:scaleType=\"centerCrop\"\n+                android:scaleType=\"fitStart\"\n                 app:layout_collapseMode=\"parallax\"\n                 app:layout_collapseParallaxMultiplier=\"0.6\" />\n \ndiff --git a/app/src/main/res/layout/feedinfo.xml b/app/src/main/res/layout/feedinfo.xml\nindex 7b7937b9dcd..7c7afa42564 100644\n--- a/app/src/main/res/layout/feedinfo.xml\n+++ b/app/src/main/res/layout/feedinfo.xml\n@@ -26,7 +26,7 @@\n                 android:layout_width=\"match_parent\"\n                 android:layout_height=\"match_parent\"\n                 android:background=\"@color/image_readability_tint\"\n-                android:scaleType=\"centerCrop\"\n+                android:scaleType=\"fitStart\"\n                 app:layout_collapseMode=\"parallax\"\n                 app:layout_collapseParallaxMultiplier=\"0.6\" />\n \n", "test_patch": "", "problem_statement": "Unexpected difference in background images when moving between podcast preview screens\nThe background image changes when the user moves from the podcast preview screen to the podcast description preview screen.\r\n\r\nIt is not a big difference, but as it is another visual element that changes when the user would only expect the text to change, the fact that the zoom level and alignment change can be distracting.\r\n\r\n(1) Podcast preview screen:\r\n<img width=\"250\" src=\"https://github.com/user-attachments/assets/4bb7d18a-a38d-445f-840c-a55856e50b84\" />\r\n\r\n(2) Podcast description preview screen:\r\n<img width=\"250\" src=\"https://github.com/user-attachments/assets/660adeba-498d-4b38-a208-5a48074c8d6b\" />\r\n\r\n_Originally posted by @loucasal in https://github.com/AntennaPod/AntennaPod/issues/7330#issuecomment-2296874719_\n", "hints_text": "", "created_at": "2024-09-02T20:55:00Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7378, "instance_id": "AntennaPod__AntennaPod-7378", "issue_numbers": ["7341"], "base_commit": "936bfa029ef5fd6cc85d9f0fd448c4c19e767822", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\nindex 0a7b85eacc4..f9c41496f43 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\n@@ -87,7 +87,6 @@ public class FeedItemlistFragment extends Fragment implements AdapterView.OnItem\n         MaterialToolbar.OnMenuItemClickListener, EpisodeItemListAdapter.OnSelectModeListener {\n     public static final String TAG = \"ItemlistFragment\";\n     private static final String ARGUMENT_FEED_ID = \"argument.de.danoeh.antennapod.feed_id\";\n-    private static final String ARGUMENT_IS_FIRST_TIME = \"argument.de.danoeh.antennapod.first_time\";\n     private static final String KEY_UP_ARROW = \"up_arrow\";\n     protected static final int EPISODES_PER_PAGE = 150;\n     protected int page = 1;\n@@ -99,7 +98,6 @@ public class FeedItemlistFragment extends Fragment implements AdapterView.OnItem\n     private MoreContentListFooterUtil nextPageLoader;\n     private boolean displayUpArrow;\n     private long feedID;\n-    private boolean isFirstTime = false;\n     private Feed feed;\n     private Disposable disposable;\n     private FeedItemListFragmentBinding viewBinding;\n@@ -112,14 +110,9 @@ public class FeedItemlistFragment extends Fragment implements AdapterView.OnItem\n      * @return the newly created instance of an ItemlistFragment\n      */\n     public static FeedItemlistFragment newInstance(long feedId) {\n-        return newInstance(feedId, false);\n-    }\n-\n-    public static FeedItemlistFragment newInstance(long feedId, boolean isFirstTime) {\n         FeedItemlistFragment i = new FeedItemlistFragment();\n         Bundle b = new Bundle();\n         b.putLong(ARGUMENT_FEED_ID, feedId);\n-        b.putBoolean(ARGUMENT_IS_FIRST_TIME, isFirstTime);\n         i.setArguments(b);\n         return i;\n     }\n@@ -131,7 +124,6 @@ public void onCreate(Bundle savedInstanceState) {\n         Bundle args = getArguments();\n         Validate.notNull(args);\n         feedID = args.getLong(ARGUMENT_FEED_ID);\n-        isFirstTime = args.getBoolean(ARGUMENT_IS_FIRST_TIME, false);\n     }\n \n     @Nullable\n@@ -486,7 +478,8 @@ private void refreshHeaderView() {\n         if (feed.getState() != Feed.STATE_SUBSCRIBED) {\n             viewBinding.header.descriptionContainer.setVisibility(View.VISIBLE);\n             viewBinding.header.headerDescriptionLabel.setText(HtmlToPlainText.getPlainText(feed.getDescription()));\n-            viewBinding.header.subscribeNagLabel.setVisibility(isFirstTime ? View.GONE : View.VISIBLE);\n+            viewBinding.header.subscribeNagLabel.setVisibility(\n+                    feed.hasInteractedWithEpisode() ? View.VISIBLE : View.GONE);\n         } else if (feed.getItemFilter() != null) {\n             FeedItemFilter filter = feed.getItemFilter();\n             if (filter.getValues().length > 0) {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/onlinefeedview/OnlineFeedViewActivity.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/onlinefeedview/OnlineFeedViewActivity.java\nindex df32bcfb2b2..7e994b1edba 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/onlinefeedview/OnlineFeedViewActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/onlinefeedview/OnlineFeedViewActivity.java\n@@ -234,7 +234,7 @@ private Feed downloadIfNotAlreadySubscribed(String url) {\n             if (subscribedFeed.getState() == Feed.STATE_SUBSCRIBED) {\n                 openFeed(subscribedFeed.getId());\n             } else {\n-                showFeedFragment(subscribedFeed.getId(), false);\n+                showFeedFragment(subscribedFeed.getId());\n             }\n         }, error -> Log.e(TAG, Log.getStackTraceString(error)), () -> startFeedDownload(url));\n         return null;\n@@ -292,7 +292,7 @@ private void parseFeed(String destination) {\n         })\n         .subscribeOn(Schedulers.computation())\n         .observeOn(AndroidSchedulers.mainThread())\n-        .subscribe(id -> showFeedFragment(id, true), error -> {\n+        .subscribe(this::showFeedFragment, error -> {\n             error.printStackTrace();\n             showErrorDialog(error.getMessage(), \"\");\n         });\n@@ -333,13 +333,13 @@ private FeedHandlerResult doParseFeed(String destination) throws Exception {\n         }\n     }\n \n-    private void showFeedFragment(long id, boolean isFirstTime) {\n+    private void showFeedFragment(long id) {\n         if (isFeedFoundBySearch) {\n             Toast.makeText(this, R.string.no_feed_url_podcast_found_by_search, Toast.LENGTH_LONG).show();\n         }\n \n         viewBinding.progressBar.setVisibility(View.GONE);\n-        FeedItemlistFragment fragment = FeedItemlistFragment.newInstance(id, isFirstTime);\n+        FeedItemlistFragment fragment = FeedItemlistFragment.newInstance(id);\n         getSupportFragmentManager()\n                 .beginTransaction()\n                 .replace(R.id.fragmentContainer, fragment, FeedItemlistFragment.TAG)\ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/Feed.java b/model/src/main/java/de/danoeh/antennapod/model/feed/Feed.java\nindex 2bd06a350ac..bce31cdd961 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/feed/Feed.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/Feed.java\n@@ -483,6 +483,38 @@ public void setState(int state) {\n         this.state = state;\n     }\n \n+    public boolean hasEpisodeInApp() {\n+        if (items == null) {\n+            return false;\n+        }\n+        for (FeedItem item : items) {\n+            if (item.isTagged(FeedItem.TAG_FAVORITE)\n+                    || item.isTagged(FeedItem.TAG_QUEUE)\n+                    || item.isDownloaded()) {\n+                return true;\n+            }\n+        }\n+        return false;\n+    }\n+\n+    public boolean hasInteractedWithEpisode() {\n+        if (items == null) {\n+            return false;\n+        }\n+        for (FeedItem item : items) {\n+            if (item.isTagged(FeedItem.TAG_FAVORITE)\n+                    || item.isTagged(FeedItem.TAG_QUEUE)\n+                    || item.isDownloaded()\n+                    || item.isPlayed()) {\n+                return true;\n+            }\n+            if (item.getMedia() != null && item.getMedia().getPosition() > 0) {\n+                return true;\n+            }\n+        }\n+        return false;\n+    }\n+\n     @Override\n     public boolean equals(Object o) {\n         if (this == o) {\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/NonSubscribedFeedsCleaner.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/NonSubscribedFeedsCleaner.java\nindex 47a5a5aeef6..31d4c4d7f01 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/NonSubscribedFeedsCleaner.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/NonSubscribedFeedsCleaner.java\n@@ -3,7 +3,6 @@\n import android.content.Context;\n import android.util.Log;\n import de.danoeh.antennapod.model.feed.Feed;\n-import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n import de.danoeh.antennapod.model.feed.SortOrder;\n \n@@ -33,13 +32,8 @@ public static boolean shouldDelete(Feed feed) {\n             return false;\n         } else if (feed.getItems() == null) {\n             return false;\n-        }\n-        for (FeedItem item : feed.getItems()) {\n-            if (item.isTagged(FeedItem.TAG_FAVORITE)\n-                    || item.isTagged(FeedItem.TAG_QUEUE)\n-                    || item.isDownloaded()) {\n-                return false;\n-            }\n+        } else if (feed.hasEpisodeInApp()) {\n+            return false;\n         }\n         return feed.getLastRefreshAttempt() < System.currentTimeMillis() - TIME_TO_KEEP;\n     }\n", "test_patch": "", "problem_statement": "Don't show please subscribe for podcast not subscribed and with no previewed episodes\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.5.0-beta1 (be3ad792b)\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\nAndroid 14\n\n### Device model\n\nOneplus 12\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Search for podcasts\r\n2. Tap on a result to display description and episodes\r\n3. Go back\n\n### Expected behaviour\n\nSuggestions to subscribe shouldn't be shown if no episode has been previewed.\n\n### Current behaviour\n\nWhenever you display a podcast description you have already opened once it would suggest to subscribe even though no episode has been previewed.\r\n\r\nI guess when you open podcast description it is added to database. It should do so only when subscribing or previewing episodes.\n\n### Logs\n\n_No response_\n", "hints_text": "Should share logic with `NonSubscribedFeedsCleaner`", "created_at": "2024-09-02T20:37:07Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7377, "instance_id": "AntennaPod__AntennaPod-7377", "issue_numbers": ["7365", "7370", "7348"], "base_commit": "936bfa029ef5fd6cc85d9f0fd448c4c19e767822", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/episode/ItemPagerFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/episode/ItemPagerFragment.java\nindex 951e5affb59..d474b108d91 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/episode/ItemPagerFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/episode/ItemPagerFragment.java\n@@ -14,6 +14,7 @@\n import androidx.viewpager2.adapter.FragmentStateAdapter;\n import androidx.viewpager2.widget.ViewPager2;\n \n+import de.danoeh.antennapod.event.UnreadItemsUpdateEvent;\n import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.ui.appstartintent.OnlineFeedviewActivityStarter;\n import org.greenrobot.eventbus.EventBus;\n@@ -171,6 +172,11 @@ public void onEventMainThread(FeedItemEvent event) {\n         }\n     }\n \n+    @Subscribe(threadMode = ThreadMode.MAIN)\n+    public void onEventMainThread(UnreadItemsUpdateEvent event) {\n+        refreshToolbarState();\n+    }\n+\n     private void openPodcast() {\n         if (item == null) {\n             return;\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/DownloadsSection.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/DownloadsSection.java\nindex 06de7803a10..3d00bf39287 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/DownloadsSection.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/DownloadsSection.java\n@@ -12,6 +12,7 @@\n import androidx.recyclerview.widget.RecyclerView;\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n+import de.danoeh.antennapod.event.UnreadItemsUpdateEvent;\n import de.danoeh.antennapod.ui.episodeslist.EpisodeItemListAdapter;\n import de.danoeh.antennapod.event.DownloadLogEvent;\n import de.danoeh.antennapod.ui.MenuItemUtils;\n@@ -111,6 +112,11 @@ public void onPlayerStatusChanged(PlayerStatusEvent event) {\n         loadItems();\n     }\n \n+    @Subscribe(threadMode = ThreadMode.MAIN)\n+    public void onUnreadItemsUpdateEvent(UnreadItemsUpdateEvent event) {\n+        loadItems();\n+    }\n+\n     @Override\n     protected String getSectionTitle() {\n         return getString(R.string.home_downloads_title);\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/EpisodesSurpriseSection.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/EpisodesSurpriseSection.java\nindex 09f060f814a..e1d4051d242 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/EpisodesSurpriseSection.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/EpisodesSurpriseSection.java\n@@ -12,6 +12,7 @@\n import androidx.recyclerview.widget.RecyclerView;\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n+import de.danoeh.antennapod.event.FeedListUpdateEvent;\n import de.danoeh.antennapod.ui.episodeslist.HorizontalItemListAdapter;\n import de.danoeh.antennapod.ui.MenuItemUtils;\n import de.danoeh.antennapod.storage.database.DBReader;\n@@ -123,6 +124,11 @@ public void onEventMainThread(EpisodeDownloadEvent event) {\n         }\n     }\n \n+    @Subscribe(threadMode = ThreadMode.MAIN)\n+    public void onEventMainThread(FeedListUpdateEvent event) {\n+        loadItems();\n+    }\n+\n     @Subscribe(threadMode = ThreadMode.MAIN)\n     public void onEventMainThread(PlaybackPositionEvent event) {\n         if (listAdapter == null) {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java\nindex 634f1ecfe3d..4e1b49e03bd 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java\n@@ -362,7 +362,10 @@ public void updatePosition(PlaybackPositionEvent event) {\n         int currentPosition = converter.convert(event.getPosition());\n         int duration = converter.convert(event.getDuration());\n         int remainingTime = converter.convert(Math.max(event.getDuration() - event.getPosition(), 0));\n-        currentChapterIndex = Chapter.getAfterPosition(controller.getMedia().getChapters(), currentPosition);\n+        @Nullable Playable media = controller.getMedia();\n+        if (media != null) {\n+            currentChapterIndex = Chapter.getAfterPosition(media.getChapters(), currentPosition);\n+        }\n         Log.d(TAG, \"currentPosition \" + Converter.getDurationStringLong(currentPosition));\n         if (currentPosition == Playable.INVALID_TIME || duration == Playable.INVALID_TIME) {\n             Log.w(TAG, \"Could not react to position observer update because of invalid time\");\n", "test_patch": "", "problem_statement": "Marking the episode as unplayed in 'Manage downloads' does not update the contrast to its unplayed status\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.5.0-beta1 (be3ad792b)\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\nGalaxy S21 5G\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Scroll down to the 'Manage downloads' section.\r\n2. Long press the low-contrast episode.\r\n3. Click the 'Mark as unplayed' button.\r\n4. Long press the low-contrast episode.\n\n### Expected behaviour\n\nThe play button should have sufficient contrast with the background, making it easily visible.\r\nMarking an episode as unplayed should immediately update its appearance to reflect unplayed status, with appropriate contrast.\r\nAfter marking an episode as unplayed, it should show 'Mark as played' option.\n\n### Current behaviour\n\nIn Steps 1 and 2, the play button blends into the background due to low contrast for the played episode.\r\nIn Step 3, marking the episode as unplayed does not change its low-contrast appearance.\r\nIn Step 4, the 'Mark as unplayed' button is missing.\r\n\r\n### Notes\r\nAfter step 3, the episode only changes to the unplayed contrast after clicking the 'Play' icon.\r\n\r\n\r\nhttps://github.com/user-attachments/assets/db8816e8-308b-484d-bcc5-64d09e0ea351\r\n\r\n\n\n### Logs\n\n_No response_\nThe removed podcast still appears under 'Get surprised' after confirming removal and refreshing the 'Home' page\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.5.0-beta1 (be3ad792b)\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\nGalaxy S21 5G\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Open Menu\r\n2. Long Press on Podcast Title\r\n3. Select 'Remove Podcast'\r\n4. Click the 'Confirm'\r\n5. Pull to refresh the 'Home' page\r\n6. Click the 'Get surprised' icon \n\n### Expected behaviour\n\nAfter confirming the removal of a podcast, the podcast should no longer appear under 'Get surprised', just like the 'Check your classics' section.\n\n### Current behaviour\n\nIn Step 4, the removed podcast disappears immediately under 'Check your classics' section.\r\nIn Steps 4 and 5, the removed podcast still appears under 'Get surprised.' \r\nIn Step 6, the removed podcast disappears.\r\n\r\n### Notes\r\nThis issue also can be reproduced if long pressing and removing the podcast under 'Check your classics' section.\r\n\r\n\r\nhttps://github.com/user-attachments/assets/7e518bdb-d51b-4d36-ad81-ab3858380dd1\r\n\r\n\n\n### Logs\n\n_No response_\nAfter selecting 'Mark as played,' the option remains unchanged in the 'three-dot' menu\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.5.0-beta1 (be3ad79)\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\nGalaxy S21 5G\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Select an episode from the queue\r\n2. Click the 'three-dot' menu\r\n3. Click the 'Mark as played'\r\n4. Click the 'three-dot' menu\n\n### Expected behaviour\n\nAfter clicking 'Mark as played' from the 'three-dot' menu, the option should change to 'Mark as unplayed' when the menu is accessed again.\r\n\n\n### Current behaviour\n\nThe menu still shows 'Mark as played' button\r\n\r\n### Notes\r\nIf clicking 'Remove from queue', then clicking the 'three-dot' menu shows 'Add to queue'. The 'Mark as played' button should be consistent as the 'Remove from queue' button.\r\nAfter clicking 'Remove from queue' button, the 'Mark as played' button turns into 'Mark as unplayed'.\r\n\r\n\r\nhttps://github.com/user-attachments/assets/e7d86348-e48a-4d06-9733-094e29f16fc9\r\n\r\n \n\n### Logs\n\n_No response_\n", "hints_text": "\nI actually can replicate that bug on develop... \ud83e\udd14 \ud83d\udd0e \r\n\n", "created_at": "2024-09-02T20:10:36Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7374, "instance_id": "AntennaPod__AntennaPod-7374", "issue_numbers": ["7283"], "base_commit": "c008c08e4f648d69b34c1b7b96913fbc43481e1e", "patch": "diff --git a/app/src/main/res/layout/swipeactions_picker.xml b/app/src/main/res/layout/swipeactions_picker.xml\nindex e473888b2bc..3eddb89f05c 100644\n--- a/app/src/main/res/layout/swipeactions_picker.xml\n+++ b/app/src/main/res/layout/swipeactions_picker.xml\n@@ -1,10 +1,16 @@\n <?xml version=\"1.0\" encoding=\"utf-8\"?>\n-<androidx.gridlayout.widget.GridLayout\n+<ScrollView\n     xmlns:android=\"http://schemas.android.com/apk/res/android\"\n-    xmlns:grid=\"http://schemas.android.com/apk/res-auto\"\n-    android:id=\"@+id/pickerGridLayout\"\n-    android:layout_width=\"match_parent\"\n-    android:layout_height=\"match_parent\"\n-    android:padding=\"16dp\"\n-    grid:columnCount=\"2\"\n-    grid:alignmentMode=\"alignBounds\" />\n+    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    android:layout_width=\"wrap_content\"\n+    android:layout_height=\"wrap_content\">\n+\n+    <androidx.gridlayout.widget.GridLayout\n+        android:id=\"@+id/pickerGridLayout\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:padding=\"16dp\"\n+        app:columnCount=\"2\"\n+        app:alignmentMode=\"alignBounds\" />\n+\n+</ScrollView>\n", "test_patch": "", "problem_statement": "Unable to scroll \"swipe actions\" screen\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.4.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n14\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\nOpen the swipe actions settings screen \n\n### Expected behaviour\n\nIs usable on small screens\n\n### Current behaviour\n\nUnable to swipe, therefore unable to setup the second swipe action: https://forum.antennapod.org/t/swipe-gestures-configuration/3621\r\n\r\nSimilar problem with the dialog that can actually select the action \n\n### Logs\n\n_No response_\n", "hints_text": "I believe the issue is resolved as i see both left and right swipe options \r\n![WhatsApp Image 2024-08-19 at 11 34 33 AM](https://github.com/user-attachments/assets/851f49b9-c5fa-48db-bac4-d5aa0e63dc23)\r\n\r\nDo tell me if there are any beginner friendly issues.\r\nwould love solving those !\nIt is not resolved if you have a very small screen or use landscape mode \ni want to solve this issue\nI have solved this and created a PR.\r\n[This is the Pull Request](https://github.com/AntennaPod/AntennaPod/pull/7339).\r\nstill it is not merged \r\ncan anyone please tell the issue.\r\n(i am new to open source contributions)\nThe checks are failing. Click around in the PR to find the error message. Likely a code style violation. Fix it and push the changes to the same branch as an additional commit ", "created_at": "2024-08-30T04:12:29Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7363, "instance_id": "AntennaPod__AntennaPod-7363", "issue_numbers": ["7355"], "base_commit": "c008c08e4f648d69b34c1b7b96913fbc43481e1e", "patch": "diff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 0f394c792bb..ea9d23fb042 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -186,9 +186,9 @@\n     <string name=\"remove_feed_label\">Remove podcast</string>\n     <string name=\"share_label\">Share</string>\n     <string name=\"share_file_label\">Share file</string>\n-    <string name=\"feed_delete_confirmation_msg\">Please confirm that you want to delete the podcast \\\"%1$s\\\", ALL its episodes (including downloaded episodes), and its statistics.</string>\n-    <string name=\"feed_delete_confirmation_msg_batch\">Please confirm that you want to remove the selected podcasts, ALL their episodes (including downloaded episodes), and its statistics.</string>\n-    <string name=\"feed_delete_confirmation_local_msg\">Please confirm that you want to remove the podcast \\\"%1$s\\\" and its statistics. The files in the local source folder will not be deleted.</string>\n+    <string name=\"feed_delete_confirmation_msg\">Please confirm that you want to delete the podcast \\\"%1$s\\\", ALL its episodes (including downloaded episodes), playback history, and its statistics.</string>\n+    <string name=\"feed_delete_confirmation_msg_batch\">Please confirm that you want to remove the selected podcasts, ALL their episodes (including downloaded episodes), playback history, and its statistics.</string>\n+    <string name=\"feed_delete_confirmation_local_msg\">Please confirm that you want to remove the podcast \\\"%1$s\\\", its playback history, and its statistics. The files in the local source folder will not be deleted.</string>\n     <string name=\"feed_remover_msg\">Removing podcast</string>\n     <string name=\"load_complete_feed\">Refresh complete podcast</string>\n     <string name=\"multi_select\">Multi select</string>\n", "test_patch": "", "problem_statement": "Removing a podcast unexpectedly deletes its record from 'Playback history'\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.5.0-beta1 (be3ad792b)\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\nGalaxy S21 5G\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Click the menu to open the sidebar\r\n2. Click the 'Playback history'\r\n3. Click the menu to open the sidebar \r\n4. Go to 'Subscriptions'\r\n5. Click on the podcast to view the subscription episodes list\r\n6. Click on the menu icon\r\n7. Select 'Remove podcast'\r\n8. Confirm deletion\r\n9. Click the menu to open the sidebar\r\n10. Click the 'Playback history'\n\n### Expected behaviour\n\nRemoving podcast should not delete its record in the 'Playback history' section, as the 'Remove podcast' pop-up only shows 'Please confirm that you want to delete the podcast \"Steve Jobs\", ALL its episodes (including **downloaded episode**), and its **statistics**'.\r\n\r\nIf the intent is to also delete the record from the 'Playback history' section, please update the 'Remove podcast' pop-up to reflect this.\n\n### Current behaviour\n\nIn step 2, the episode is in the 'Playback history'\r\nIn step 10, the episode is removed from the 'Playback history'\r\n\r\n### Notes\r\nRemoving a podcast should not delete its record from the 'Playback history' section. Even after deleting a podcast, users may want to find previously listened episodes later, and playback history can serve this purpose.\r\n\r\nhttps://github.com/user-attachments/assets/f980cea2-f1ac-4ff9-8508-cc63095b3b27\r\n\r\n\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2024-08-28T19:41:39Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7361, "instance_id": "AntennaPod__AntennaPod-7361", "issue_numbers": ["7356"], "base_commit": "aa28a65222302a037da948da1adb974d83b85643", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedInfoFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedInfoFragment.java\nindex 6169e3888fb..87636f53323 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedInfoFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedInfoFragment.java\n@@ -84,9 +84,11 @@ public void onClick(View v) {\n                 android.content.ClipboardManager cm = (android.content.ClipboardManager) getContext()\n                         .getSystemService(Context.CLIPBOARD_SERVICE);\n                 cm.setPrimaryClip(clipData);\n-                if (Build.VERSION.SDK_INT <= 32) {\n+                if (Build.VERSION.SDK_INT <= 32 && getActivity() instanceof MainActivity) {\n                     ((MainActivity) getActivity()).showSnackbarAbovePlayer(R.string.copied_to_clipboard,\n                             Snackbar.LENGTH_SHORT);\n+                } else if (Build.VERSION.SDK_INT <= 32) {\n+                    Snackbar.make(getView(), R.string.copied_to_clipboard, Snackbar.LENGTH_SHORT).show();\n                 }\n             }\n         }\n", "test_patch": "", "problem_statement": "Tapping the 'Attachment' icon under 'URL' causes the app to crash\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.5.0-beta1 (be3ad792b)\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\nGalaxy S21 5G\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Tap on the hamburger menu icon to open the navigation drawer.\r\n2. Tap on 'Add podcast' from the navigation menu.\r\n3. Search 'podcast name' into the 'Search podcast...' bar.\r\n4. Click the '1 Year Daily Audio Bible'\r\n5. Click the 'Description' section to open the rest.\r\n6. Click the 'Attachment' icon Under 'URL'\r\n\n\n### Expected behaviour\n\nThe app should not crash when clicking the 'Attachment' icon under 'URL.'\n\n### Current behaviour\n\nThe app crashes.\r\n\r\n### Notes\r\nIn step 4 and 5, the text in the pop-up dialog should have proper padding or margin to avoid looking crowded near the border.\r\n\r\n\r\nhttps://github.com/user-attachments/assets/fd3028ab-5abe-43be-8eeb-2f27a1b1f3ff\r\n\r\n\n\n### Logs\n\n## Environment\r\nAndroid version: 12\r\nOS version: 5.4.147-24896147-abG991BXXS5CVIF\r\nAntennaPod version: 3.5.0-beta1\r\nModel: SM-G991B\r\nDevice: o1s\r\nProduct: o1sxxx\r\n\r\n## Crash info\r\nTime: 28-08-2024 22:52:43\r\nAntennaPod version: 3.5.0-beta1\r\n\r\n## StackTrace\r\n```\r\njava.lang.ClassCastException: de.danoeh.antennapod.ui.screen.onlinefeedview.OnlineFeedViewActivity cannot be cast to de.danoeh.antennapod.activity.MainActivity\r\n\tat de.danoeh.antennapod.ui.screen.feed.FeedInfoFragment$1.onClick(SourceFile:88)\r\n\tat android.view.View.performClick(View.java:7792)\r\n\tat android.widget.TextView.performClick(TextView.java:16112)\r\n\tat android.view.View.performClickInternal(View.java:7769)\r\n\tat android.view.View.access$3800(View.java:910)\r\n\tat android.view.View$PerformClick.run(View.java:30218)\r\n\tat android.os.Handler.handleCallback(Handler.java:938)\r\n\tat android.os.Handler.dispatchMessage(Handler.java:99)\r\n\tat android.os.Looper.loopOnce(Looper.java:226)\r\n\tat android.os.Looper.loop(Looper.java:313)\r\n\tat android.app.ActivityThread.main(ActivityThread.java:8751)\r\n\tat java.lang.reflect.Method.invoke(Native Method)\r\n\tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:571)\r\n\tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1135)\r\n```\r\n\n", "hints_text": "", "created_at": "2024-08-28T19:03:27Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7342, "instance_id": "AntennaPod__AntennaPod-7342", "issue_numbers": ["7330"], "base_commit": "251b17c7df17348a11c2c34a1a1d3a8570eb9603", "patch": "diff --git a/app/src/main/res/layout/onlinefeedview_activity.xml b/app/src/main/res/layout/onlinefeedview_activity.xml\nindex a121c9e0eda..11f65b87447 100644\n--- a/app/src/main/res/layout/onlinefeedview_activity.xml\n+++ b/app/src/main/res/layout/onlinefeedview_activity.xml\n@@ -4,7 +4,8 @@\n     xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n     android:id=\"@+id/transparentBackground\"\n     android:layout_width=\"match_parent\"\n-    android:layout_height=\"match_parent\">\n+    android:layout_height=\"match_parent\"\n+    android:fitsSystemWindows=\"true\">\n \n     <androidx.cardview.widget.CardView\n         android:id=\"@+id/card\"\ndiff --git a/ui/common/src/main/res/values/styles.xml b/ui/common/src/main/res/values/styles.xml\nindex 2cf3b39972b..0314aa3ffb3 100644\n--- a/ui/common/src/main/res/values/styles.xml\n+++ b/ui/common/src/main/res/values/styles.xml\n@@ -156,7 +156,6 @@\n         <item name=\"android:windowContentOverlay\">@null</item>\n         <item name=\"android:backgroundDimEnabled\">true</item>\n         <item name=\"android:windowAnimationStyle\">@style/AnimationFade</item>\n-        <item name=\"android:fitsSystemWindows\">true</item>\n     </style>\n \n     <style name=\"Theme.AntennaPod.Light.Translucent\" parent=\"Theme.AntennaPod.Light.NoTitle\">\n@@ -167,7 +166,6 @@\n         <item name=\"android:windowContentOverlay\">@null</item>\n         <item name=\"android:backgroundDimEnabled\">true</item>\n         <item name=\"android:windowAnimationStyle\">@style/AnimationFade</item>\n-        <item name=\"android:fitsSystemWindows\">true</item>\n     </style>\n \n     <style name=\"Theme.AntennaPod.Dynamic.Dark.Translucent\" parent=\"Theme.AntennaPod.Dynamic.Dark.NoTitle\">\n@@ -178,7 +176,6 @@\n         <item name=\"android:windowContentOverlay\">@null</item>\n         <item name=\"android:backgroundDimEnabled\">true</item>\n         <item name=\"android:windowAnimationStyle\">@style/AnimationFade</item>\n-        <item name=\"android:fitsSystemWindows\">true</item>\n     </style>\n \n     <style name=\"Theme.AntennaPod.Dark.Translucent\" parent=\"Theme.AntennaPod.Dark.NoTitle\">\n@@ -189,7 +186,6 @@\n         <item name=\"android:windowContentOverlay\">@null</item>\n         <item name=\"android:backgroundDimEnabled\">true</item>\n         <item name=\"android:windowAnimationStyle\">@style/AnimationFade</item>\n-        <item name=\"android:fitsSystemWindows\">true</item>\n     </style>\n \n     <style name=\"Theme.AntennaPod.Dynamic.TrueBlack.Translucent\" parent=\"Theme.AntennaPod.Dynamic.TrueBlack.NoTitle\">\n@@ -200,7 +196,6 @@\n         <item name=\"android:windowContentOverlay\">@null</item>\n         <item name=\"android:backgroundDimEnabled\">true</item>\n         <item name=\"android:windowAnimationStyle\">@style/AnimationFade</item>\n-        <item name=\"android:fitsSystemWindows\">true</item>\n     </style>\n \n     <style name=\"Theme.AntennaPod.TrueBlack.Translucent\" parent=\"Theme.AntennaPod.TrueBlack.NoTitle\">\n@@ -211,7 +206,6 @@\n         <item name=\"android:windowContentOverlay\">@null</item>\n         <item name=\"android:backgroundDimEnabled\">true</item>\n         <item name=\"android:windowAnimationStyle\">@style/AnimationFade</item>\n-        <item name=\"android:fitsSystemWindows\">true</item>\n     </style>\n \n     <style name=\"AnimationFade\">\n", "test_patch": "", "problem_statement": "Warning message for previewed episodes lacks padding\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.5.0-beta1 (be3ad792b)\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\nPixel 3a\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Search for any podcast\r\n2. Tap on a search result\r\n3. Tap on an episode\r\n4. Notice the circled warning message\r\n\r\nAlso, once the steps above have already been followed, the warning message is displayed after step 2, rather than after step 3 (compare the behaviour with a previously previewed podcast vs. a new one). Is that intended?\n\n### Expected behaviour\n\nThe warning message is padded inside the circle and well readable.\n\n### Current behaviour\n\nThe warning message overlaps with the circle (see screenshot).\r\n\r\n![Screenshot_20240818-091132](https://github.com/user-attachments/assets/79179ce0-b265-42e7-b904-7a13cd624f09)\n\n### Logs\n\n_No response_\n", "hints_text": "A few other related points, which all contribute to making these screens a bit less polished than they could be:\r\n\r\n1. The podcast & episode preview screens (steps 2 and 3 above) seem to use different spacing/padding than the podcast description preview screen.\r\n\r\n2. The background image changes when the user moves from the podcast preview screen to the podcast description preview screen.\r\n\r\n3. When moving back from the podcast description preview screen to the podcast preview screen, the info, filter and settings buttons are briefly visible before the Subscribe pill replaces them.\r\n\r\n4. As a whole, the preview screen doesn't look very tidy. This is especially the case when the warning message is always displayed (which might be a bug). I would perhaps consider replacing the Subscribe pill with a simpler icon.\r\n\r\nPlease let me know if I should file separate tickets for any of them.\nThere is indeed something off with the paddings/margins. However, it is not as broken on my device as on yours \r\n\r\n> The background image changes when the user moves from the podcast preview screen to the podcast description preview screen.\r\n\r\nWhat do you mean with that?\r\n\r\n> When moving back from the podcast description preview screen to the podcast preview screen, the info, filter and settings buttons are briefly visible before the Subscribe pill replaces them.\r\n\r\nThe alternative would basically be to show the pill by default, but then you see the pill on the normal subscribed screens \r\n\r\n> As a whole, the preview screen doesn't look very tidy. This is especially the case when the warning message is always displayed (which might be a bug)\r\n\r\nThe message is always shown on purpose to avoid people using the app without ever subscribing and then wondering why playback state gets deleted after some time \r\n\r\n> I would perhaps consider replacing the Subscribe pill with a simpler icon.\r\n\r\nWe really want to make it clear to users that they should subscribe. The feature to download without subscribing already blurs the lines quite a lot and could lead to confusion. I want to be extra careful to nudge people to subscribe ", "created_at": "2024-08-24T07:47:33Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7337, "instance_id": "AntennaPod__AntennaPod-7337", "issue_numbers": ["7307"], "base_commit": "eff3208b86f1bcad1a78e4b6e718d87302d703e0", "patch": "diff --git a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/FeedUpdateWorker.java b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/FeedUpdateWorker.java\nindex b5174dfcb8d..fb0cb7e401f 100644\n--- a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/FeedUpdateWorker.java\n+++ b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/FeedUpdateWorker.java\n@@ -155,10 +155,14 @@ private void refreshFeeds(List<Feed> toUpdate, boolean force) {\n                     return;\n                 }\n                 try {\n+                    Feed savedFeed;\n                     if (feed.isLocalFeed()) {\n-                        LocalFeedUpdater.updateFeed(feed, getApplicationContext(), null);\n+                        savedFeed = LocalFeedUpdater.updateFeed(feed, getApplicationContext(), null);\n                     } else {\n-                        refreshFeed(feed, force);\n+                        savedFeed = refreshFeed(feed, force);\n+                    }\n+                    if (savedFeed != null) {\n+                        newEpisodesNotification.showIfNeeded(getApplicationContext(), savedFeed);\n                     }\n                 } catch (Exception e) {\n                     DBWriter.setFeedLastUpdateFailed(feed.getId(), true);\n@@ -183,7 +187,7 @@ private void refreshFeeds(List<Feed> toUpdate, boolean force) {\n         }\n     }\n \n-    void refreshFeed(Feed feed, boolean force) throws Exception {\n+    Feed refreshFeed(Feed feed, boolean force) throws Exception {\n         boolean nextPage = getInputData().getBoolean(FeedUpdateManagerImpl.EXTRA_NEXT_PAGE, false)\n                 && feed.getNextPageLink() != null;\n         if (nextPage) {\n@@ -205,11 +209,11 @@ void refreshFeed(Feed feed, boolean force) throws Exception {\n \n         if (!downloader.getResult().isSuccessful()) {\n             if (downloader.cancelled || downloader.getResult().getReason() == DownloadError.ERROR_DOWNLOAD_CANCELLED) {\n-                return;\n+                return null;\n             }\n             DBWriter.setFeedLastUpdateFailed(request.getFeedfileId(), true);\n             DBWriter.addDownloadStatus(downloader.getResult());\n-            return;\n+            return null;\n         }\n \n         FeedParserTask parserTask = new FeedParserTask(request);\n@@ -217,25 +221,25 @@ void refreshFeed(Feed feed, boolean force) throws Exception {\n         if (!parserTask.isSuccessful()) {\n             DBWriter.setFeedLastUpdateFailed(request.getFeedfileId(), true);\n             DBWriter.addDownloadStatus(parserTask.getDownloadStatus());\n-            return;\n+            return null;\n         }\n         feedHandlerResult.feed.setLastRefreshAttempt(System.currentTimeMillis());\n         Feed savedFeed = FeedDatabaseWriter.updateFeed(getApplicationContext(), feedHandlerResult.feed, false);\n \n         if (request.getFeedfileId() == 0) {\n-            return; // No download logs for new subscriptions\n+            return savedFeed; // No download logs for new subscriptions\n         }\n         // we create a 'successful' download log if the feed's last refresh failed\n         List<DownloadResult> log = DBReader.getFeedDownloadLog(request.getFeedfileId());\n         if (!log.isEmpty() && !log.get(0).isSuccessful()) {\n             DBWriter.addDownloadStatus(parserTask.getDownloadStatus());\n         }\n-        newEpisodesNotification.showIfNeeded(getApplicationContext(), savedFeed);\n         if (downloader.permanentRedirectUrl != null) {\n             DBWriter.updateFeedDownloadURL(request.getSource(), downloader.permanentRedirectUrl);\n         } else if (feedHandlerResult.redirectUrl != null\n                 && !feedHandlerResult.redirectUrl.equals(request.getSource())) {\n             DBWriter.updateFeedDownloadURL(request.getSource(), feedHandlerResult.redirectUrl);\n         }\n+        return savedFeed;\n     }\n }\ndiff --git a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/local/LocalFeedUpdater.java b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/local/LocalFeedUpdater.java\nindex 8cffcfc82af..e5c4fea0811 100644\n--- a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/local/LocalFeedUpdater.java\n+++ b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/local/LocalFeedUpdater.java\n@@ -50,7 +50,7 @@ public class LocalFeedUpdater {\n \n     static final String[] PREFERRED_FEED_IMAGE_FILENAMES = {\"folder.jpg\", \"Folder.jpg\", \"folder.png\", \"Folder.png\"};\n \n-    public static void updateFeed(Feed feed, Context context,\n+    public static Feed updateFeed(Feed feed, Context context,\n                                   @Nullable UpdaterProgressListener updaterProgressListener) {\n         try {\n             String uriString = feed.getDownloadUrl().replace(Feed.PREFIX_LOCAL_FOLDER, \"\");\n@@ -63,24 +63,27 @@ public static void updateFeed(Feed feed, Context context,\n                 throw new IOException(\"Cannot read local directory. \"\n                         + \"Try re-connecting the folder on the podcast info page.\");\n             }\n-            tryUpdateFeed(feed, context, documentFolder.getUri(), updaterProgressListener);\n+            Feed updatedFeed = tryUpdateFeed(feed, context, documentFolder.getUri(), updaterProgressListener);\n \n             if (mustReportDownloadSuccessful(feed)) {\n                 reportSuccess(feed);\n             }\n+            return updatedFeed;\n         } catch (Exception e) {\n             e.printStackTrace();\n             reportError(feed, e.getMessage());\n         }\n+        return null;\n     }\n \n     @VisibleForTesting\n-    static void tryUpdateFeed(Feed feed, Context context, Uri folderUri,\n+    static Feed tryUpdateFeed(Feed feed, Context context, Uri folderUri,\n                               UpdaterProgressListener updaterProgressListener) throws IOException {\n         if (feed.getItems() == null) {\n             feed.setItems(new ArrayList<>());\n         }\n-        //make sure it is the latest 'version' of this feed from the db (all items etc)\n+        // make sure it is the latest 'version' of this feed from the db (all items etc)\n+        // and for new feeds, settings etc are set up properly.\n         feed = FeedDatabaseWriter.updateFeed(context, feed, false);\n \n         // list files in feed folder\n@@ -127,6 +130,8 @@ static void tryUpdateFeed(Feed feed, Context context, Uri folderUri,\n         feed.setAuthor(context.getString(R.string.local_folder));\n \n         FeedDatabaseWriter.updateFeed(context, feed, true);\n+\n+        return feed;\n     }\n \n     /**\n", "test_patch": "", "problem_statement": "no new episode notification for a folder podcast after a manual refresh\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.4.1\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n14 (pixel July update)\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. add a local folder podcast\r\n2. enable episode notifications in the folder podcast setting\r\n3. add an audio file to the folder\r\n4. pull down to refresh podcasts\r\n5. the new folder podcast \"episode\" is detected and added to the inbox\r\n6. but there's no notification\r\n\r\nnew episode notifications are enabled globally and the app has the notification permission\r\n\r\nhaven't checked feed based podcasts, so reporting specifically for folder\n\n### Expected behaviour\n\nthere should be a notification, as configured globally and for the podcast\n\n### Current behaviour\n\nno notification\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2024-08-18T13:25:50Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7335, "instance_id": "AntennaPod__AntennaPod-7335", "issue_numbers": ["7333"], "base_commit": "895987e5aac7f0b1154955f62559c5c398b16e4e", "patch": "diff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/FeedDatabaseWriter.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/FeedDatabaseWriter.java\nindex a62e18809ba..6e1ff730244 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/FeedDatabaseWriter.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/FeedDatabaseWriter.java\n@@ -182,10 +182,11 @@ public static synchronized Feed updateFeed(Context context, Feed newFeed, boolea\n                         savedFeed.getItems().add(idx, item);\n                     }\n \n-                    if (item.getPubDate() == null\n+                    boolean shouldPerformNewEpisodesAction = item.getPubDate() == null\n                             || priorMostRecentDate == null\n                             || priorMostRecentDate.before(item.getPubDate())\n-                            || priorMostRecentDate.equals(item.getPubDate())) {\n+                            || priorMostRecentDate.equals(item.getPubDate());\n+                    if (savedFeed.getState() == Feed.STATE_SUBSCRIBED && shouldPerformNewEpisodesAction) {\n                         Log.d(TAG, \"Performing new episode action for item published on \" + item.getPubDate()\n                                 + \", prior most recent date = \" + priorMostRecentDate);\n                         FeedPreferences.NewEpisodesAction action = savedFeed.getPreferences().getNewEpisodesAction();\n", "test_patch": "", "problem_statement": "Episodes of previewed podcasts sometimes get added to the inbox\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.5.0-beta1\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n14\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n- Preview an episode\r\n- Wait until next episode is released\r\n- Preview another episode\r\n- New episodes released in the meantime are in the inbox (inbox icon, counter. Not in the actual inbox episode list)\n\n### Expected behaviour\n\nEpisodes not in the inbox\n\n### Current behaviour\n\n_No response_\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2024-08-18T13:04:38Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7334, "instance_id": "AntennaPod__AntennaPod-7334", "issue_numbers": ["7331"], "base_commit": "251b17c7df17348a11c2c34a1a1d3a8570eb9603", "patch": "diff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\nindex fddee8d2e3c..1e019e0e918 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n@@ -1309,7 +1309,7 @@ public final Map<Long, Integer> getFeedCounters(FeedCounter setting, long... fee\n     }\n \n     private Map<Long, Integer> conditionalFeedCounterRead(String whereRead, long... feedIds) {\n-        String limitFeeds = \"\";\n+        String limitFeeds;\n         if (feedIds.length > 0) {\n             // work around TextUtils.join wanting only boxed items\n             // and StringUtils.join() causing NoSuchMethodErrors on MIUI\n@@ -1321,6 +1321,8 @@ private Map<Long, Integer> conditionalFeedCounterRead(String whereRead, long...\n             // there's an extra ',', get rid of it\n             builder.deleteCharAt(builder.length() - 1);\n             limitFeeds = KEY_FEED + \" IN (\" + builder.toString() + \") AND \";\n+        } else {\n+            limitFeeds = SELECT_WHERE_FEED_IS_SUBSCRIBED + \" AND \";\n         }\n \n         final String query = \"SELECT \" + KEY_FEED + \", COUNT(\" + TABLE_NAME_FEED_ITEMS + \".\" + KEY_ID + \") AS count \"\n", "test_patch": "", "problem_statement": "Unplayed episodes counter shot up after previewing podcasts\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.5.0-beta1 (be3ad79)\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\nPixel 3a\n\n### First occurred\n\ntoday\n\n### Steps to reproduce\n\nMy unplayed episodes counter has suddenly tripled today and the new value is not reflected in my actual unplayed episodes.\r\n\r\nI'm guessing this might be related to the new \"Add episodes without subscribing\" feature (#7098), as I previewed a bunch of podcasts while reporting #7330 (but I'm surprised this is the case, as I did not download/stream episodes).\n\n### Expected behaviour\n\nThe unplayed episodes counter should match the number of unplayed episodes. If the discrepancy is intentional, the user should have a way to revert to the actual value.\n\n### Current behaviour\n\nThe unplayed episodes counter doesn't match the number of unplayed episodes (likely because it also counts episodes from a number of random previewed podcasts).\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2024-08-18T12:59:30Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7319, "instance_id": "AntennaPod__AntennaPod-7319", "issue_numbers": ["7313"], "base_commit": "f7faf3c8c3fd1164ab0c6613aa895b1d50d7a7fb", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/ImportExportPreferencesFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/ImportExportPreferencesFragment.java\nindex 5ffa7e57a1a..81da9c1ae47 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/ImportExportPreferencesFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/ImportExportPreferencesFragment.java\n@@ -137,7 +137,8 @@ private void setupStorageScreen() {\n                     try {\n                         chooseOpmlImportPathLauncher.launch(\"*/*\");\n                     } catch (ActivityNotFoundException e) {\n-                        Log.e(TAG, \"No activity found. Should never happen...\");\n+                        Snackbar.make(getView(), R.string.unable_to_start_system_file_manager, Snackbar.LENGTH_LONG)\n+                                .show();\n                     }\n                     return true;\n                 });\n@@ -148,7 +149,12 @@ private void setupStorageScreen() {\n                 });\n         findPreference(PREF_DATABASE_EXPORT).setOnPreferenceClickListener(\n                 preference -> {\n-                    backupDatabaseLauncher.launch(dateStampFilename(DATABASE_EXPORT_FILENAME));\n+                    try {\n+                        backupDatabaseLauncher.launch(dateStampFilename(DATABASE_EXPORT_FILENAME));\n+                    } catch (ActivityNotFoundException e) {\n+                        Snackbar.make(getView(), R.string.unable_to_start_system_file_manager, Snackbar.LENGTH_LONG)\n+                                .show();\n+                    }\n                     return true;\n                 });\n         ((SwitchPreferenceCompat) findPreference(PREF_AUTOMATIC_DATABASE_EXPORT))\n@@ -159,7 +165,6 @@ private void setupStorageScreen() {\n                         try {\n                             automaticBackupLauncher.launch(null);\n                         } catch (ActivityNotFoundException e) {\n-                            e.printStackTrace();\n                             Snackbar.make(getView(), R.string.unable_to_start_system_file_manager, Snackbar.LENGTH_LONG)\n                                     .show();\n                         }\n@@ -192,7 +197,12 @@ private void importDatabase() {\n         builder.setPositiveButton(R.string.confirm_label, (dialog, which) -> {\n             Intent intent = new Intent(Intent.ACTION_OPEN_DOCUMENT);\n             intent.setType(\"*/*\");\n-            restoreDatabaseLauncher.launch(intent);\n+            try {\n+                restoreDatabaseLauncher.launch(intent);\n+            } catch (ActivityNotFoundException e) {\n+                Snackbar.make(getView(), R.string.unable_to_start_system_file_manager, Snackbar.LENGTH_LONG)\n+                        .show();\n+            }\n         });\n \n         // create and show the alert dialog\n@@ -271,7 +281,8 @@ private void openExportPathPicker(Export exportType, ActivityResultLauncher<Inte\n             result.launch(intentPickAction);\n             return;\n         } catch (ActivityNotFoundException e) {\n-            Log.e(TAG, \"No activity found. Should never happen...\");\n+            Snackbar.make(getView(), R.string.unable_to_start_system_file_manager, Snackbar.LENGTH_LONG)\n+                    .show();\n         }\n \n         // If we are using a SDK lower than API 21 or the implicit intent failed\n", "test_patch": "", "problem_statement": "database export fails with blank screen \n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.4.1\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n 4.14.180-perf+\n\n### Device model\n\nOnePlus 7T HD1900\n\n### First occurred\n\n3 months ago \n\n### Steps to reproduce\n\n## Environment\r\nAndroid version: 12\r\nI want to export my database to move to a new device.\r\n\r\nWhen selecting export database the screen turns white for some seconds and the I get thrown back to the app settings screen.\r\n\r\nThere is no file save dialogue or file picker dialogue.\r\n\r\n\r\nOS version: 4.14.180-perf+\r\nAntennaPod version: 3.4.1\r\nModel: HD1900\r\nDevice: OnePlus7T\r\nProduct: OnePlus7T\n\n### Expected behaviour\n\nAfter database export is selected a file save selection dialogue should show to enter a file name.\n\n### Current behaviour\n\nNo file save or file picker screen is showing after I select database export \n\n### Logs\n\n[antenna full-logs.txt](https://github.com/user-attachments/files/16450992/antenna.full-logs.txt)\r\n\n", "hints_text": "You probably disabled the system file picker app ", "created_at": "2024-08-09T16:47:33Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7312, "instance_id": "AntennaPod__AntennaPod-7312", "issue_numbers": ["7300"], "base_commit": "be3ad792b6b7416950d2459b8abeb2538a0801ec", "patch": "diff --git a/app/src/main/res/layout/empty_view_layout.xml b/app/src/main/res/layout/empty_view_layout.xml\nindex e02c5debebb..6ad0576a91a 100644\n--- a/app/src/main/res/layout/empty_view_layout.xml\n+++ b/app/src/main/res/layout/empty_view_layout.xml\n@@ -23,6 +23,7 @@\n         android:layout_width=\"wrap_content\"\n         android:layout_height=\"wrap_content\"\n         android:textSize=\"16sp\"\n+        android:textAlignment=\"center\"\n         android:textColor=\"?android:attr/textColorPrimary\"\n         tools:text=\"Title\" />\n \n", "test_patch": "", "problem_statement": "Empty download title not aligned centered\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.4.1\n\n### Where did you get the app from\n\nF-Droid\n\n### Android version\n\n12\n\n### Device model\n\nSmall Phone emulator API level 32\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Open the app\r\n2. Choose \"Download\" option\r\n3. Change the text scaling to 2.0\n\n### Expected behaviour\n\nThe title and description should be aligned center.\n\n### Current behaviour\n\n<img width=\"259\" alt=\"image\" src=\"https://github.com/user-attachments/assets/f74801b2-2419-4e14-ab72-287fd9337e05\">\r\n\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2024-07-31T11:27:37Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7298, "instance_id": "AntennaPod__AntennaPod-7298", "issue_numbers": ["7269"], "base_commit": "7d1509f8165a5acc9be3da6d22b41753cb6da2c3", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemViewHolder.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemViewHolder.java\nindex c5868a945fd..8f97bd5d74c 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemViewHolder.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemViewHolder.java\n@@ -18,6 +18,7 @@\n import com.google.android.material.elevation.SurfaceColors;\n \n import de.danoeh.antennapod.R;\n+import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.ui.CoverLoader;\n import de.danoeh.antennapod.actionbutton.ItemActionButton;\n import de.danoeh.antennapod.playback.service.PlaybackStatus;\n@@ -204,6 +205,7 @@ private void bind(FeedMedia media) {\n \n     public void bindDummy() {\n         item = new FeedItem();\n+        item.setFeed(new Feed(\"\", \"\"));\n         container.setAlpha(0.1f);\n         secondaryActionIcon.setImageDrawable(null);\n         isInbox.setVisibility(View.VISIBLE);\n", "test_patch": "", "problem_statement": "AntennaPod crashes when rapidly scrolling long feed on Android 13/Pixel 4a\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.4.0f (52117f35a)\n\n### Where did you get the app from\n\nOther\n\n### Android version\n\n13\n\n### Device model\n\nPixel 4\n\n### First occurred\n\nabout 30 days ago\n\n### Steps to reproduce\n\n1. Subscribe to https://anchor.fm/s/265d7c64/podcast/rss\r\n2. Use the hamburger button to select the podcast (\"Tech Lead Journal\")\r\n3. Immediately begin scrolling as fast as you can to the bottom.\r\n4. If you hit the bottom, scroll back to the top again and repeat until you get a crash.\n\n### Expected behaviour\n\nNo crash\n\n### Current behaviour\n\nAntennapod crashes with an error\n\n### Logs\n\n--------- beginning of crash\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: FATAL EXCEPTION: main\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: Process: de.danoeh.antennapod.debug, PID: 28045\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: java.lang.NullPointerException: Attempt to invoke virtual method 'java.lang.String de.danoeh.antennapod.model.feed.Feed.getImageUrl()' on a null object reference\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat de.danoeh.antennapod.ui.screen.feed.FeedItemlistFragment$FeedItemListAdapter.afterBindViewHolder(FeedItemlistFragment.java:684)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat de.danoeh.antennapod.ui.episodeslist.EpisodeItemListAdapter.onBindViewHolder(EpisodeItemListAdapter.java:75)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat de.danoeh.antennapod.ui.episodeslist.EpisodeItemListAdapter.onBindViewHolder(EpisodeItemListAdapter.java:33)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat androidx.recyclerview.widget.RecyclerView$Adapter.onBindViewHolder(RecyclerView.java:7678)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat androidx.recyclerview.widget.RecyclerView$Adapter.bindViewHolder(RecyclerView.java:7761)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat androidx.recyclerview.widget.RecyclerView$Recycler.tryBindViewHolderByDeadline(RecyclerView.java:6582)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat androidx.recyclerview.widget.RecyclerView$Recycler.tryGetViewHolderForPositionByDeadline(RecyclerView.java:6848)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat androidx.recyclerview.widget.RecyclerView$Recycler.getViewForPosition(RecyclerView.java:6688)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat androidx.recyclerview.widget.RecyclerView$Recycler.getViewForPosition(RecyclerView.java:6684)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat androidx.recyclerview.widget.LinearLayoutManager$LayoutState.next(LinearLayoutManager.java:2362)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat androidx.recyclerview.widget.LinearLayoutManager.layoutChunk(LinearLayoutManager.java:1662)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat androidx.recyclerview.widget.LinearLayoutManager.fill(LinearLayoutManager.java:1622)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat androidx.recyclerview.widget.LinearLayoutManager.scrollBy(LinearLayoutManager.java:1425)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat androidx.recyclerview.widget.LinearLayoutManager.scrollVerticallyBy(LinearLayoutManager.java:1158)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat androidx.recyclerview.widget.RecyclerView.scrollStep(RecyclerView.java:2009)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat androidx.recyclerview.widget.RecyclerView.scrollByInternal(RecyclerView.java:2108)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat androidx.recyclerview.widget.RecyclerView.onTouchEvent(RecyclerView.java:3826)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat android.view.View.dispatchTouchEvent(View.java:15050)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat android.view.ViewGroup.dispatchTransformedTouchEvent(ViewGroup.java:3115)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat android.view.ViewGroup.dispatchTouchEvent(ViewGroup.java:2788)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat android.view.ViewGroup.dispatchTransformedTouchEvent(ViewGroup.java:3121)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat android.view.ViewGroup.dispatchTouchEvent(ViewGroup.java:2802)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat android.view.ViewGroup.dispatchTransformedTouchEvent(ViewGroup.java:3121)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat android.view.ViewGroup.dispatchTouchEvent(ViewGroup.java:2802)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat android.view.ViewGroup.dispatchTransformedTouchEvent(ViewGroup.java:3121)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat android.view.ViewGroup.dispatchTouchEvent(ViewGroup.java:2802)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat android.view.ViewGroup.dispatchTransformedTouchEvent(ViewGroup.java:3121)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat android.view.ViewGroup.dispatchTouchEvent(ViewGroup.java:2802)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat android.view.ViewGroup.dispatchTransformedTouchEvent(ViewGroup.java:3121)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat android.view.ViewGroup.dispatchTouchEvent(ViewGroup.java:2802)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat android.view.ViewGroup.dispatchTransformedTouchEvent(ViewGroup.java:3121)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat android.view.ViewGroup.dispatchTouchEvent(ViewGroup.java:2802)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat android.view.ViewGroup.dispatchTransformedTouchEvent(ViewGroup.java:3121)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat android.view.ViewGroup.dispatchTouchEvent(ViewGroup.java:2802)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat android.view.ViewGroup.dispatchTransformedTouchEvent(ViewGroup.java:3121)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat android.view.ViewGroup.dispatchTouchEvent(ViewGroup.java:2802)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat android.view.ViewGroup.dispatchTransformedTouchEvent(ViewGroup.java:3121)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat android.view.ViewGroup.dispatchTouchEvent(ViewGroup.java:2802)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat android.view.ViewGroup.dispatchTransformedTouchEvent(ViewGroup.java:3121)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat android.view.ViewGroup.dispatchTouchEvent(ViewGroup.java:2802)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat com.android.internal.policy.DecorView.superDispatchTouchEvent(DecorView.java:500)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat com.android.internal.policy.PhoneWindow.superDispatchTouchEvent(PhoneWindow.java:1912)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat android.app.Activity.dispatchTouchEvent(Activity.java:4299)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat androidx.appcompat.view.WindowCallbackWrapper.dispatchTouchEvent(WindowCallbackWrapper.java:70)\r\n06-29 16:02:26.902 28045 28045 E AndroidRuntime: \tat com.android.internal.policy.DecorView.dispatchTouchEvent(DecorView.java:458)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat android.view.View.dispatchPointerEvent(View.java:15309)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat android.view.ViewRootImpl$ViewPostImeInputStage.processPointerEvent(ViewRootImpl.java:6778)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat android.view.ViewRootImpl$ViewPostImeInputStage.onProcess(ViewRootImpl.java:6578)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat android.view.ViewRootImpl$InputStage.deliver(ViewRootImpl.java:6034)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat android.view.ViewRootImpl$InputStage.onDeliverToNext(ViewRootImpl.java:6091)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat android.view.ViewRootImpl$InputStage.forward(ViewRootImpl.java:6057)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat android.view.ViewRootImpl$AsyncInputStage.forward(ViewRootImpl.java:6222)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat android.view.ViewRootImpl$InputStage.apply(ViewRootImpl.java:6065)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat android.view.ViewRootImpl$AsyncInputStage.apply(ViewRootImpl.java:6279)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat android.view.ViewRootImpl$InputStage.deliver(ViewRootImpl.java:6038)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat android.view.ViewRootImpl$InputStage.onDeliverToNext(ViewRootImpl.java:6091)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat android.view.ViewRootImpl$InputStage.forward(ViewRootImpl.java:6057)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat android.view.ViewRootImpl$InputStage.apply(ViewRootImpl.java:6065)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat android.view.ViewRootImpl$InputStage.deliver(ViewRootImpl.java:6038)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat android.view.ViewRootImpl.deliverInputEvent(ViewRootImpl.java:9206)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat android.view.ViewRootImpl.doProcessInputEvents(ViewRootImpl.java:9157)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat android.view.ViewRootImpl.enqueueInputEvent(ViewRootImpl.java:9126)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat android.view.ViewRootImpl$WindowInputEventReceiver.onInputEvent(ViewRootImpl.java:9329)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat android.view.InputEventReceiver.dispatchInputEvent(InputEventReceiver.java:267)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat android.os.MessageQueue.nativePollOnce(Native Method)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat android.os.MessageQueue.next(MessageQueue.java:335)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat android.os.Looper.loopOnce(Looper.java:161)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat android.os.Looper.loop(Looper.java:288)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat android.app.ActivityThread.main(ActivityThread.java:7918)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat java.lang.reflect.Method.invoke(Native Method)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548)\r\n06-29 16:02:26.904 28045 28045 E AndroidRuntime: \tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:936)\n", "hints_text": "Added a workaround (which is probably the wrong place to fix it) in PR #7271", "created_at": "2024-07-20T16:14:10Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7294, "instance_id": "AntennaPod__AntennaPod-7294", "issue_numbers": ["7290"], "base_commit": "600ad2af3d819b0556496f9b03ab07858718fba5", "patch": "diff --git a/app/src/main/AndroidManifest.xml b/app/src/main/AndroidManifest.xml\nindex 9b0415a5ee1..d4534e2ed9e 100644\n--- a/app/src/main/AndroidManifest.xml\n+++ b/app/src/main/AndroidManifest.xml\n@@ -48,7 +48,7 @@\n             android:noHistory=\"true\"\n             android:exported=\"false\"\n             android:excludeFromRecents=\"true\"\n-            android:theme=\"@style/Theme.AntennaPod.Light.Translucent\">\n+            android:theme=\"@style/Theme.AntennaPod.Splash.Translucent\">\n             <intent-filter>\n                 <action android:name=\"de.danoeh.antennapod.intents.PLAYBACK_SPEED\" />\n                 <category android:name=\"android.intent.category.DEFAULT\"/>\n@@ -192,7 +192,7 @@\n         <activity\n             android:name=\".ui.screen.onlinefeedview.OnlineFeedViewActivity\"\n             android:configChanges=\"orientation|screenSize\"\n-            android:theme=\"@style/Theme.AntennaPod.Dark.Translucent\"\n+            android:theme=\"@style/Theme.AntennaPod.Splash.Translucent\"\n             android:label=\"@string/add_feed_label\"\n             android:exported=\"true\">\n             <meta-data\n@@ -314,7 +314,7 @@\n         <activity android:name=\".activity.SelectSubscriptionActivity\"\n             android:label=\"@string/shortcut_subscription_label\"\n             android:icon=\"@drawable/ic_shortcut_subscriptions\"\n-            android:theme=\"@style/Theme.AntennaPod.Dark.Translucent\"\n+            android:theme=\"@style/Theme.AntennaPod.Splash.Translucent\"\n             android:exported=\"true\">\n             <intent-filter>\n                 <action android:name=\"android.intent.action.CREATE_SHORTCUT\" />\ndiff --git a/ui/common/src/main/res/values/styles.xml b/ui/common/src/main/res/values/styles.xml\nindex 4513d63744a..2cf3b39972b 100644\n--- a/ui/common/src/main/res/values/styles.xml\n+++ b/ui/common/src/main/res/values/styles.xml\n@@ -231,6 +231,14 @@\n         <item name=\"windowSplashScreenAnimatedIcon\">@drawable/launcher_animate</item>\n     </style>\n \n+    <style name=\"Theme.AntennaPod.Splash.Translucent\" parent=\"Theme.AntennaPod.Splash\">\n+        <item name=\"android:windowIsTranslucent\">true</item>\n+        <item name=\"android:windowBackground\">@android:color/transparent</item>\n+        <item name=\"android:windowContentOverlay\">@null</item>\n+        <item name=\"android:backgroundDimEnabled\">true</item>\n+        <item name=\"android:windowAnimationStyle\">@style/AnimationFade</item>\n+    </style>\n+\n     <style name=\"Style.AntennaPod.Toolbar\" parent=\"Widget.Material3.Toolbar\">\n         <item name=\"materialThemeOverlay\">@style/Theme.AntennaPod.Toolbar</item>\n     </style>\n", "test_patch": "", "problem_statement": "\"Not subscribed\" warning message sometimes has broken colors\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.5.x\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n-\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\nSelect dark theme, disable \"dynamic colors\", open preview screen\n\n### Expected behaviour\n\nSubscribe button and info message box are blue\n\n### Current behaviour\n\nThey use the dynamic color even if it should not be dynamic\r\n\r\n![grafik](https://github.com/user-attachments/assets/22aaae67-f0e2-4b9d-bc83-60b363720c13)\r\n\n\n### Logs\n\n_No response_\n", "hints_text": "Seems like dynamic colors are being used (to a lesser extent) for some UI elements even when disabled - causing it to look subpar. This is on LineageOS 28 (android 14)\r\n\r\nLooks fine with dynamic colors on (things are more yellow)\nHi @CactiChameleon9,\r\n\r\n> Looks fine with dynamic colors on (things are more yellow)\r\n\r\nWhat I don't quite understand: how come the interface is yellow when material you is _off_? If it's off, I'd expect the subscribe button and notice background to be blue-ish.\r\n\r\nI'm wondering; are there perhaps two settings at play? One at OS level, one within AntennaPod itself? (We have the setting \"Dynamic colors\" in the 'User interface' group.)\nI have no idea why my material you colors are being partially used when dynamic colors is disabled in antennapod. That is the issue.\nYeah, I have the same problem on my device. I think AntennaPod is not initializing the theme correctly on that screen", "created_at": "2024-07-18T20:39:07Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7252, "instance_id": "AntennaPod__AntennaPod-7252", "issue_numbers": ["7033"], "base_commit": "8da45100d400eb4fa14ae12f9806e971be02587c", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\nindex fbfb9fa0a45..2c8be5390b2 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\n@@ -12,6 +12,7 @@\n import android.view.View;\n import android.view.ViewGroup;\n import android.widget.AdapterView;\n+import android.widget.Toast;\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n import androidx.appcompat.content.res.AppCompatResources;\n@@ -22,6 +23,7 @@\n import com.bumptech.glide.Glide;\n import com.bumptech.glide.request.RequestOptions;\n import com.google.android.material.appbar.MaterialToolbar;\n+import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import com.google.android.material.snackbar.Snackbar;\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n@@ -257,6 +259,7 @@ private void updateToolbar() {\n             viewBinding.toolbar.getMenu().findItem(R.id.refresh_item).setVisible(false);\n             viewBinding.toolbar.getMenu().findItem(R.id.rename_item).setVisible(false);\n             viewBinding.toolbar.getMenu().findItem(R.id.remove_feed).setVisible(false);\n+            viewBinding.toolbar.getMenu().findItem(R.id.remove_all_inbox_item).setVisible(false);\n             viewBinding.toolbar.getMenu().findItem(R.id.action_search).setVisible(false);\n         }\n     }\n@@ -303,6 +306,8 @@ public boolean onMenuItemClick(MenuItem item) {\n                 // Make sure fragment is hidden before actually starting to delete\n                 getActivity().getSupportFragmentManager().executePendingTransactions();\n             });\n+        } else if (item.getItemId() == R.id.remove_all_inbox_item) {\n+            showRemoveAllDialog();\n         } else if (item.getItemId() == R.id.action_search) {\n             ((MainActivity) getActivity()).loadChildFragment(SearchFragment.newInstance(feed.getId(), feed.getTitle()));\n         } else {\n@@ -555,6 +560,20 @@ private void showFeedInfo() {\n         }\n     }\n \n+    private void showRemoveAllDialog() {\n+        MaterialAlertDialogBuilder builder = new MaterialAlertDialogBuilder(getContext());\n+        builder.setTitle(R.string.remove_all_inbox_label);\n+        builder.setMessage(R.string.remove_all_inbox_confirmation_msg);\n+\n+        builder.setPositiveButton(R.string.confirm_label, (dialog, which) -> {\n+            dialog.dismiss();\n+            DBWriter.removeFeedNewFlag(feedID);\n+            ((MainActivity) getActivity()).showSnackbarAbovePlayer(R.string.removed_all_inbox_msg, Toast.LENGTH_SHORT);\n+        });\n+        builder.setNegativeButton(R.string.cancel_label, null);\n+        builder.show();\n+    }\n+\n     private void loadFeedImage() {\n         Glide.with(this)\n                 .load(feed.getImageUrl())\ndiff --git a/app/src/main/res/menu/feedlist.xml b/app/src/main/res/menu/feedlist.xml\nindex 0baf434f15e..92a426b9074 100644\n--- a/app/src/main/res/menu/feedlist.xml\n+++ b/app/src/main/res/menu/feedlist.xml\n@@ -42,6 +42,13 @@\n         custom:showAsAction=\"never\"\n         android:title=\"@string/share_label\" />\n \n+    <item\n+        android:id=\"@+id/remove_all_inbox_item\"\n+        android:title=\"@string/remove_all_inbox_label\"\n+        android:menuCategory=\"container\"\n+        custom:showAsAction=\"collapseActionView\"\n+        android:icon=\"@drawable/ic_check\"/>\n+\n     <item\n         android:id=\"@+id/rename_item\"\n         android:menuCategory=\"container\"\n@@ -57,4 +64,4 @@\n         custom:showAsAction=\"collapseActionView\">\n     </item>\n \n-</menu>\n\\ No newline at end of file\n+</menu>\n", "test_patch": "", "problem_statement": "Add \"Remove All from Inbox\" to the overflow menu of the screen showing a single subscription\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\r\n\r\n### App version\r\n\r\n3.2\r\n\r\n### Where did you get the app from\r\n\r\nF-Droid\r\n\r\n### Problem you may be having, or feature you want\r\n\r\nFor a variety of reasons, I have podcasts that I keep disabled inside AP even though they keep pushing out new episodes.\r\n\r\nFrom time to time I will refresh one of those manually, this can cause the Inbox to be flooded with a potentially very high number of past episodes (this will be obvious if you're subscribed to podcasts with daily updates or even multiple updates per day, which I have a lot of), which I don't necessarily want to have there by that time.\r\n\r\nAt this point I will then \"Remove All from Inbox\", however it goes this way:\r\n\r\n- I'm in Inbox looking at the deluge\r\n- I will tap the episode\r\n- Tap on Podcast icon\r\n- Ok, podcast view\r\n- And there is no \"Remove All from Inbox\" option anywhere\r\n\r\nThis is jarring. But then I have to:\r\n\r\n- Open the Drawer\r\n- Locate the podcast\r\n- Long tap etc\r\n\r\nAnd you only need to have a large enough number of subscriptions before this becomes cumbersome.\r\n\r\nI've found two workarounds:\r\n\r\nNumber 1.\r\n\r\n- activate search function\r\n- start typing\r\n- tap'n'hold on the podcast icon > Remove All\r\n\r\nHowever, from Podcast View, if you long tap the Podcast icon, there is no chained menu. And no \"Remove All\" in the Hamburger menu.\r\n\r\nNumber 2. From Podcast View:\r\n\r\n- Tap and hold on any episode\r\n- Multi Select\r\n- Select All\r\n- Hit floating action button\r\n- Remove from Inbox\r\n\r\nThis takes even longer and is super cumbersome.\r\n\r\n### Suggested solution\r\n\r\n| \u2139\ufe0f | **Implementation instructions**|\r\n|---|:---|\r\n| | This request has been discussed further below. If you're interested in implementing this, please see the  [conclusions relevant for implementation below](https://github.com/AntennaPod/AntennaPod/issues/7033#issuecomment-2035446378).<br><sub>The original post has been edited by the project maintainers to add this link.</sub> |\r\n\r\nIntuitively, the first places I look for Remove All in the situation described above are:\r\n\r\n- Hamburger Menu\r\n- Podcast icon's chained menu (it works if you're Searching, why there but not here? seems weirdly inconsistent)\r\n\r\nI would think having Remove All in either place would be great..? Both probably even better (whichever comes to you).\r\n\r\n'pinions ?\r\n\r\n### Screenshots / Drawings / Technical details\r\n\r\n_No response_\n", "hints_text": "Hi @Mrnofish,\r\n\r\nWe discussed and agree that the UX can be improved here. We decided that we'd like to see the following implemented:\r\n* Add option 'Remove all from inbox' in the overflow menu of the podcast (detail) view\n@keunes but only all episodes of the podcast whose detailed view you are currently in?\n@andre-m-dev The idea is to add an item in this menu:\n![Imagepipe_0.jpg](https://github.com/AntennaPod/AntennaPod/assets/11229646/91627577-e584-4a4c-be3c-9149a8256ea7)\n\nAnd only there, indeed. Not in other menus of podcasts, e.g. on the subscriptions overview or the side menu.\n@keunes thanks for the quick reply. i'm not worried about the position, i understood that. the only question is whether you only delete the episodes of the podcast you've just opened and clicked on the three dots?\n@andre-m-dev Ah, yes, of course :-) If would be odd to affect episodes of podcast B when taking an action on podcast A.\n\n(Side note: it's not deleting episodes, only removing them from the Inbox. Deleting episodes from the database is not possible in AntennaPod.)\n@keunes absolutely right, I meant remove from inbox. Thank you for your patience.", "created_at": "2024-06-16T12:25:12Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7232, "instance_id": "AntennaPod__AntennaPod-7232", "issue_numbers": ["7000"], "base_commit": "46a409ad34025460db4ea813ff31ceeaeabae45d", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/swipeactions/SwipeActions.java b/app/src/main/java/de/danoeh/antennapod/ui/swipeactions/SwipeActions.java\nindex fdc22094eb3..9a91248aa27 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/swipeactions/SwipeActions.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/swipeactions/SwipeActions.java\n@@ -222,7 +222,7 @@ public float getSwipeVelocityThreshold(float defaultValue) {\n \n     @Override\n     public float getSwipeThreshold(@NonNull RecyclerView.ViewHolder viewHolder) {\n-        return swipeOutEnabled ? 0.6f : 1.0f;\n+        return swipeOutEnabled ? super.getSwipeThreshold(viewHolder) : 1.0f;\n     }\n \n     @Override\n", "test_patch": "", "problem_statement": "Swipe distance is too long\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n### App version\r\n\r\n3.2.0\r\n\r\n### Where did you get the app from\r\n\r\nF-Droid\r\n\r\n### Android version\r\n\r\nAndroid 14, GrapheneOS\r\n\r\n### Device model\r\n\r\nPixel 6a\r\n\r\n### First occurred\r\n\r\nA long time ago (in a galaxy far away)\r\n\r\n### Steps to reproduce\r\n\r\nIt may be just me, but I feel that the swipe distance threshold is too long, most of my swipes don't actually work. Certainly an element of it could be my laziness, but I would really appreciate if the swiping distance threshold could be reduced a bit.\r\n\r\n1. Open the Inbox (for instance)\r\n2. Swipe elements right or left\r\n\r\n\r\n### Expected behaviour\r\n\r\nSnappy behaviour, from a quick movement of my thumb the items go where they should as if AntennaPod could read my mind. Much rejoicing.\r\n\r\n| \u2139\ufe0f | **Implementation instructions**|\r\n|---|:---|\r\n| | This request has been discussed further below. If you're interested in implementing this, please see the  [conclusions relevant for implementation below](https://github.com/AntennaPod/AntennaPod/issues/7000#issuecomment-2124125009).<br><sub>The original post has been edited by the project maintainers to add this link.</sub> |\r\n\r\n### Current behaviour\r\n\r\nThe quick movement of my thumb is not considered sufficient to trigger the action. My thumb feels unappreciated.\r\n\r\n### Logs\r\n\r\n_No response_\n", "hints_text": "In my experience, the speed of swiping affects the minimum threshold. I.e. if you try swiping extremely slow, you need to swipe the download icon up to the duration in the episode above/below. But if you swipe fast, you can let go quite early on and it'll work.\n\nSo I guess that what we need to focus on is the slow swipe situation. Indeed if you swipe over half, I wouldn't expect it to bounce back.\nWe changed that at some point because users complained that they swiped out accidentally \nDo you think we could find a value in between the initial and current? Because I do agree that it's a bit hard currently when you don't swipe fast.\nI sympathise with the general point about improving the responsiveness of swipe actions, but my experience is different: for me it's not so much the distance nor the pace, but the fact that the swiped element doesn't feel like it has enough _friction_ - that is, it seems to slide in a way that exceeds my thumb movement, as if it was slippery.\r\n\r\nI notice it especially when compared to apps like Firefox or WhatsApp, where swiping (respectively on an open tab or on a message) definitely has more friction.\n> Do you think we could find a value in between the initial and current? Because I do agree that it's a bit hard currently when you don't swipe fast.\r\n\r\nThere is not too much in between. The default swipe distance is 50%, but we set it to 60% after your request here: #4844\r\n\r\n> for me it's not so much the distance nor the pace, but the fact that the swiped element doesn't feel like it has enough friction - that is, it seems to slide in a way that exceeds my thumb movement, as if it was slippery.\r\n\r\nThat should only happen for situations in which the episodes don't actually swipe out, right? (eg. marking as favorite when the list is not filtered by favorite, etc). For actually swiping out, we just follow the finger without any changes to the friction.\n> That should only happen for situations in which the episodes don't actually swipe out, right? (eg. marking as favorite when the list is not filtered by favorite, etc). For actually swiping out, we just follow the finger without any changes to the friction.\r\n\r\nYes, now that you mention it, there seems to be a difference between those two cases.\n100% this \u261d\ufe0f ... the interaction is jarringly different from how other swipe experiences feel and failure rate is 85%+ percent for me forcing dedicated focus on specifically swiping to accomplish the action. Not sure exactly how to satisfy everyone other than exposing some personalization settings to dial in preferred friction, distance, and speed settings which I know is a heavy ask.\nSingle hand swipe is hard on larger phones because we have to swipe from edge to edge, I think we should tweak the settings slightly.\nIs this mainly for actions that swipe completely off the screen (remove from inbox etc) or is this for actions that keep the episode on screen (favorite etc)?\nDiscussed in \"Needs: Decision\" meeting. There's two thresholds that we can set (from memory):\r\n* how far we need to go until (default: 50, us: 60% of the screen) - this would mainly affect slow swiping\r\n* something about the velocity; if you swipe fast and let go, how long will it still travel further - if this brings it above the threshold it's also a swipe.\r\n\r\nMaybe decreasing both would keep fast swiping as is while improving slow swiping.", "created_at": "2024-06-09T18:05:10Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7230, "instance_id": "AntennaPod__AntennaPod-7230", "issue_numbers": ["7066"], "base_commit": "e2ff09bd344e4c53ef40381f533fe26914604492", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java\nindex 0d82b713307..fa35b57ed6d 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java\n@@ -11,10 +11,13 @@\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n import androidx.fragment.app.Fragment;\n+import androidx.swiperefreshlayout.widget.SwipeRefreshLayout;\n+\n import com.google.android.material.appbar.MaterialToolbar;\n import com.google.android.material.snackbar.Snackbar;\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n+import de.danoeh.antennapod.event.FeedUpdateRunningEvent;\n import de.danoeh.antennapod.ui.episodeslist.EpisodeItemListAdapter;\n import de.danoeh.antennapod.actionbutton.DeleteActionButton;\n import de.danoeh.antennapod.event.DownloadLogEvent;\n@@ -75,6 +78,7 @@ public class CompletedDownloadsFragment extends Fragment\n     private SwipeActions swipeActions;\n     private ProgressBar progressBar;\n     private MaterialToolbar toolbar;\n+    private SwipeRefreshLayout swipeRefreshLayout;\n \n     @Override\n     public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container,\n@@ -95,6 +99,10 @@ public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup c\n         }\n         ((MainActivity) getActivity()).setupToolbarToggle(toolbar, displayUpArrow);\n \n+        swipeRefreshLayout = root.findViewById(R.id.swipeRefresh);\n+        swipeRefreshLayout.setDistanceToTriggerSync(getResources().getInteger(R.integer.swipe_refresh_distance));\n+        swipeRefreshLayout.setOnRefreshListener(() -> FeedUpdateManager.getInstance().runOnceOrAsk(requireContext()));\n+\n         recyclerView = root.findViewById(R.id.recyclerView);\n         recyclerView.setRecycledViewPool(((MainActivity) getActivity()).getRecycledViewPool());\n         adapter = new CompletedDownloadsListAdapter((MainActivity) getActivity());\n@@ -277,6 +285,11 @@ public void onUnreadItemsChanged(UnreadItemsUpdateEvent event) {\n         loadItems();\n     }\n \n+    @Subscribe(sticky = true, threadMode = ThreadMode.MAIN)\n+    public void onEventMainThread(FeedUpdateRunningEvent event) {\n+        swipeRefreshLayout.setRefreshing(event.isFeedUpdateRunning);\n+    }\n+\n     private void loadItems() {\n         if (disposable != null) {\n             disposable.dispose();\ndiff --git a/app/src/main/res/layout/simple_list_fragment.xml b/app/src/main/res/layout/simple_list_fragment.xml\nindex 3972e419e59..63c418d173a 100644\n--- a/app/src/main/res/layout/simple_list_fragment.xml\n+++ b/app/src/main/res/layout/simple_list_fragment.xml\n@@ -1,5 +1,5 @@\n <?xml version=\"1.0\" encoding=\"utf-8\"?>\n-<androidx.coordinatorlayout.widget.CoordinatorLayout\n+<RelativeLayout\n     xmlns:android=\"http://schemas.android.com/apk/res/android\"\n     xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n     android:layout_width=\"match_parent\"\n@@ -20,13 +20,19 @@\n \n     </com.google.android.material.appbar.AppBarLayout>\n \n-    <de.danoeh.antennapod.ui.episodeslist.EpisodeItemListRecyclerView\n-        android:id=\"@+id/recyclerView\"\n+    <androidx.swiperefreshlayout.widget.SwipeRefreshLayout\n+        android:id=\"@+id/swipeRefresh\"\n         android:layout_width=\"match_parent\"\n         android:layout_height=\"match_parent\"\n-        android:paddingHorizontal=\"@dimen/additional_horizontal_spacing\"\n-        android:layout_below=\"@id/appbar\"\n-        app:layout_behavior=\"@string/appbar_scrolling_view_behavior\" />\n+        android:layout_below=\"@id/appbar\">\n+\n+        <de.danoeh.antennapod.ui.episodeslist.EpisodeItemListRecyclerView\n+            android:id=\"@+id/recyclerView\"\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"match_parent\"\n+            android:paddingHorizontal=\"@dimen/additional_horizontal_spacing\" />\n+\n+    </androidx.swiperefreshlayout.widget.SwipeRefreshLayout>\n \n     <ProgressBar\n         android:id=\"@+id/progLoading\"\n@@ -42,4 +48,4 @@\n         android:layout_height=\"wrap_content\"\n         android:layout_gravity=\"bottom\" />\n \n-</androidx.coordinatorlayout.widget.CoordinatorLayout>\n+</RelativeLayout>\n", "test_patch": "", "problem_statement": "Add pull to refresh to Downloads screen\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.3\n\n### Where did you get the app from\n\nGoogle Play\n\n### Problem you may be having, or feature you want\n\nAs per https://forum.antennapod.org/t/changed-refresh/4325/23:\r\n> I mainly use the Downloads screen. No pull to refresh there.\n\n### Suggested solution\n\nAdd pull to refresh\n\n### Screenshots / Drawings / Technical details\n\nPull to refresh was added on the Home screen in #6199, which could serve as inspiration.\n", "hints_text": "Hello, I want to work on this issue\nHi @ApostolosKourpadakis,\n\nThat's great, thanks for the interest! If you need help with getting started, don't hesitate to have a look at the contributor info on [the wiki](https://github.com/AntennaPod/AntennaPod/wiki/Code-style) and on the [Contributors page](https://github.com/AntennaPod/AntennaPod/blob/develop/CONTRIBUTING.md) or let us know.\nhi, is this still being worked on? if not, I would like to work on this issue. :)\n@ApostolosKourpadakis indicated interest but that was 2 months ago. So I guess they are no longer actively working on it. Feel free to give it a try :)\r\n\r\nHave a look at the other screens with pull-to-refresh (for example the EpisodesListFragment) on how to implement this.", "created_at": "2024-06-08T06:22:38Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7228, "instance_id": "AntennaPod__AntennaPod-7228", "issue_numbers": ["7227"], "base_commit": "e2ff09bd344e4c53ef40381f533fe26914604492", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java\nindex bc70a06bb62..2d5f8f62930 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java\n@@ -27,6 +27,7 @@\n import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import com.google.android.material.snackbar.Snackbar;\n \n+import de.danoeh.antennapod.event.playback.SpeedChangedEvent;\n import de.danoeh.antennapod.ui.screen.SearchFragment;\n import de.danoeh.antennapod.net.download.serviceinterface.FeedUpdateManager;\n import de.danoeh.antennapod.ui.episodes.PlaybackSpeedUtils;\n@@ -268,6 +269,11 @@ public void onEventMainThread(FeedUpdateRunningEvent event) {\n         swipeRefreshLayout.setRefreshing(event.isFeedUpdateRunning);\n     }\n \n+    @Subscribe(threadMode = ThreadMode.MAIN)\n+    public void updateSpeed(SpeedChangedEvent event) {\n+        refreshInfoBar();\n+    }\n+\n     @Override\n     public boolean onMenuItemClick(MenuItem item) {\n         final int itemId = item.getItemId();\n@@ -482,10 +488,8 @@ private void refreshInfoBar() {\n \n         if (recyclerAdapter.inActionMode()) {\n             infoBar.setVisibility(View.INVISIBLE);\n-        } else if (UserPreferences.getSubscriptionsFilter().isEnabled()) {\n-            infoBar.setVisibility(View.VISIBLE);\n         } else {\n-            infoBar.setVisibility(View.GONE);\n+            infoBar.setVisibility(View.VISIBLE);\n         }\n     }\n \n", "test_patch": "", "problem_statement": "Time left in queue not updated upon changing playback speed\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.4.0f\n\n### Where did you get the app from\n\nF-Droid\n\n### Android version\n\n13\n\n### Device model\n\nGalaxy S20 FE 5G\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Add some episodes to the queue, note the \"time left\"\r\n2. Start playing an episode and adjust the speed\r\n3. See \"time left\"\r\n4. Navigate to a different screen, go back to queue, note \"time left\" has changed\n\n### Expected behaviour\n\nTime left should reflect current playback speed without reopening the queue\n\n### Current behaviour\n\nTime left doesn't update until queue is reopened \r\n\n\n### Logs\n\n_No response_\n", "hints_text": "This is probably related to #2829 and is similar to #3092. ", "created_at": "2024-06-07T19:08:24Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7221, "instance_id": "AntennaPod__AntennaPod-7221", "issue_numbers": ["7354", "7353"], "base_commit": "1528cde0e012fb7a818fdc50d76981c137b64ca1", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/DownloadsSection.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/DownloadsSection.java\nindex 06de7803a10..af497bbe83b 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/DownloadsSection.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/DownloadsSection.java\n@@ -6,35 +6,38 @@\n import android.view.LayoutInflater;\n import android.view.View;\n import android.view.ViewGroup;\n+\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n import androidx.recyclerview.widget.LinearLayoutManager;\n import androidx.recyclerview.widget.RecyclerView;\n+\n+import org.greenrobot.eventbus.Subscribe;\n+import org.greenrobot.eventbus.ThreadMode;\n+\n+import java.util.List;\n+\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n-import de.danoeh.antennapod.ui.episodeslist.EpisodeItemListAdapter;\n import de.danoeh.antennapod.event.DownloadLogEvent;\n-import de.danoeh.antennapod.ui.MenuItemUtils;\n-import de.danoeh.antennapod.storage.database.DBReader;\n import de.danoeh.antennapod.event.FeedItemEvent;\n import de.danoeh.antennapod.event.PlayerStatusEvent;\n import de.danoeh.antennapod.event.playback.PlaybackPositionEvent;\n-import de.danoeh.antennapod.ui.screen.download.CompletedDownloadsFragment;\n-import de.danoeh.antennapod.ui.swipeactions.SwipeActions;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n import de.danoeh.antennapod.model.feed.SortOrder;\n+import de.danoeh.antennapod.storage.database.DBReader;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n-import de.danoeh.antennapod.ui.screen.home.HomeSection;\n+import de.danoeh.antennapod.ui.MenuItemUtils;\n+import de.danoeh.antennapod.ui.episodeslist.EpisodeItemListAdapter;\n import de.danoeh.antennapod.ui.episodeslist.EpisodeItemViewHolder;\n+import de.danoeh.antennapod.ui.screen.download.CompletedDownloadsFragment;\n+import de.danoeh.antennapod.ui.screen.home.HomeSection;\n+import de.danoeh.antennapod.ui.swipeactions.SwipeActions;\n import io.reactivex.Observable;\n import io.reactivex.android.schedulers.AndroidSchedulers;\n import io.reactivex.disposables.Disposable;\n import io.reactivex.schedulers.Schedulers;\n-import org.greenrobot.eventbus.Subscribe;\n-import org.greenrobot.eventbus.ThreadMode;\n-\n-import java.util.List;\n \n public class DownloadsSection extends HomeSection {\n     public static final String TAG = \"DownloadsSection\";\n@@ -63,6 +66,7 @@ public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMen\n         };\n         adapter.setDummyViews(NUM_EPISODES);\n         viewBinding.recyclerView.setAdapter(adapter);\n+        viewBinding.emptyLabel.setText(R.string.home_downloads_empty_text);\n \n         SwipeActions swipeActions = new SwipeActions(this, CompletedDownloadsFragment.TAG);\n         swipeActions.attachTo(viewBinding.recyclerView);\n@@ -133,6 +137,7 @@ private void loadItems() {\n                     items = downloads;\n                     adapter.setDummyViews(0);\n                     adapter.updateItems(items);\n+                    viewBinding.emptyLabel.setVisibility(items.isEmpty() ? View.VISIBLE : View.GONE);\n                 }, error -> Log.e(TAG, Log.getStackTraceString(error)));\n     }\n }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/EpisodesSurpriseSection.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/EpisodesSurpriseSection.java\nindex 09f060f814a..1f1a633c704 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/EpisodesSurpriseSection.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/EpisodesSurpriseSection.java\n@@ -6,33 +6,36 @@\n import android.view.LayoutInflater;\n import android.view.View;\n import android.view.ViewGroup;\n+\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n import androidx.recyclerview.widget.LinearLayoutManager;\n import androidx.recyclerview.widget.RecyclerView;\n+\n+import org.greenrobot.eventbus.Subscribe;\n+import org.greenrobot.eventbus.ThreadMode;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Random;\n+\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n-import de.danoeh.antennapod.ui.episodeslist.HorizontalItemListAdapter;\n-import de.danoeh.antennapod.ui.MenuItemUtils;\n-import de.danoeh.antennapod.storage.database.DBReader;\n import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FeedItemEvent;\n import de.danoeh.antennapod.event.PlayerStatusEvent;\n import de.danoeh.antennapod.event.playback.PlaybackPositionEvent;\n-import de.danoeh.antennapod.ui.screen.AllEpisodesFragment;\n import de.danoeh.antennapod.model.feed.FeedItem;\n-import de.danoeh.antennapod.ui.screen.home.HomeSection;\n+import de.danoeh.antennapod.storage.database.DBReader;\n+import de.danoeh.antennapod.ui.MenuItemUtils;\n+import de.danoeh.antennapod.ui.episodeslist.HorizontalItemListAdapter;\n import de.danoeh.antennapod.ui.episodeslist.HorizontalItemViewHolder;\n+import de.danoeh.antennapod.ui.screen.AllEpisodesFragment;\n+import de.danoeh.antennapod.ui.screen.home.HomeSection;\n import io.reactivex.Observable;\n import io.reactivex.android.schedulers.AndroidSchedulers;\n import io.reactivex.disposables.Disposable;\n import io.reactivex.schedulers.Schedulers;\n-import org.greenrobot.eventbus.Subscribe;\n-import org.greenrobot.eventbus.ThreadMode;\n-\n-import java.util.ArrayList;\n-import java.util.List;\n-import java.util.Random;\n \n public class EpisodesSurpriseSection extends HomeSection {\n     public static final String TAG = \"EpisodesSurpriseSection\";\n@@ -69,6 +72,7 @@ public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMen\n         if (seed == 0) {\n             seed = new Random().nextInt();\n         }\n+        viewBinding.emptyLabel.setText(R.string.home_no_recent_unplayed_episodes_text);\n         return view;\n     }\n \n@@ -149,6 +153,11 @@ private void loadItems() {\n                     this.episodes = episodes;\n                     listAdapter.setDummyViews(0);\n                     listAdapter.updateData(episodes);\n+\n+                    boolean isShuffleable = !episodes.isEmpty();\n+                    viewBinding.shuffleButton.setVisibility(isShuffleable ? View.VISIBLE : View.GONE);\n+                    viewBinding.recyclerView.setVisibility(isShuffleable ? View.VISIBLE : View.GONE);\n+                    viewBinding.emptyLabel.setVisibility(!isShuffleable ? View.VISIBLE : View.GONE);\n                 }, error -> Log.e(TAG, Log.getStackTraceString(error)));\n     }\n }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/InboxSection.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/InboxSection.java\nindex d30fa85bcee..7bb7917469d 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/InboxSection.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/InboxSection.java\n@@ -6,36 +6,39 @@\n import android.view.LayoutInflater;\n import android.view.View;\n import android.view.ViewGroup;\n+\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n import androidx.core.util.Pair;\n import androidx.recyclerview.widget.LinearLayoutManager;\n import androidx.recyclerview.widget.RecyclerView;\n+\n+import org.greenrobot.eventbus.Subscribe;\n+import org.greenrobot.eventbus.ThreadMode;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Locale;\n+\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n-import de.danoeh.antennapod.ui.episodeslist.EpisodeItemListAdapter;\n-import de.danoeh.antennapod.ui.MenuItemUtils;\n-import de.danoeh.antennapod.storage.database.DBReader;\n import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FeedItemEvent;\n import de.danoeh.antennapod.event.FeedListUpdateEvent;\n import de.danoeh.antennapod.event.UnreadItemsUpdateEvent;\n-import de.danoeh.antennapod.ui.screen.InboxFragment;\n-import de.danoeh.antennapod.ui.swipeactions.SwipeActions;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n+import de.danoeh.antennapod.storage.database.DBReader;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n+import de.danoeh.antennapod.ui.MenuItemUtils;\n+import de.danoeh.antennapod.ui.episodeslist.EpisodeItemListAdapter;\n+import de.danoeh.antennapod.ui.screen.InboxFragment;\n import de.danoeh.antennapod.ui.screen.home.HomeSection;\n+import de.danoeh.antennapod.ui.swipeactions.SwipeActions;\n import io.reactivex.Observable;\n import io.reactivex.android.schedulers.AndroidSchedulers;\n import io.reactivex.disposables.Disposable;\n import io.reactivex.schedulers.Schedulers;\n-import org.greenrobot.eventbus.Subscribe;\n-import org.greenrobot.eventbus.ThreadMode;\n-\n-import java.util.ArrayList;\n-import java.util.List;\n-import java.util.Locale;\n \n public class InboxSection extends HomeSection {\n     public static final String TAG = \"InboxSection\";\n@@ -53,7 +56,7 @@ public View onCreateView(@NonNull LayoutInflater inflater,\n         viewBinding.recyclerView.setOverScrollMode(RecyclerView.OVER_SCROLL_NEVER);\n         viewBinding.recyclerView.setLayoutManager(new LinearLayoutManager(getContext(), RecyclerView.VERTICAL, false));\n         viewBinding.recyclerView.setRecycledViewPool(((MainActivity) requireActivity()).getRecycledViewPool());\n-        adapter = new EpisodeItemListAdapter((MainActivity) requireActivity()) {\n+        adapter = new EpisodeItemListAdapter(requireActivity()) {\n             @Override\n             public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMenuInfo menuInfo) {\n                 super.onCreateContextMenu(menu, v, menuInfo);\n@@ -62,6 +65,7 @@ public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMen\n         };\n         adapter.setDummyViews(NUM_EPISODES);\n         viewBinding.recyclerView.setAdapter(adapter);\n+        viewBinding.emptyLabel.setText(R.string.home_new_empty_text);\n \n         SwipeActions swipeActions = new SwipeActions(this, InboxFragment.TAG);\n         swipeActions.attachTo(viewBinding.recyclerView);\n@@ -129,7 +133,8 @@ private void loadItems() {\n                     items = data.first;\n                     adapter.setDummyViews(0);\n                     adapter.updateItems(items);\n-                    viewBinding.numNewItemsLabel.setVisibility(View.VISIBLE);\n+                    viewBinding.emptyLabel.setVisibility(items.isEmpty() ? View.VISIBLE : View.GONE);\n+                    viewBinding.numNewItemsLabel.setVisibility(!items.isEmpty() ? View.VISIBLE : View.GONE);\n                     if (data.second >= 100) {\n                         viewBinding.numNewItemsLabel.setText(String.format(Locale.getDefault(), \"%d+\", 99));\n                     } else {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/QueueSection.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/QueueSection.java\nindex 79099242096..a06f4babaaa 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/QueueSection.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/QueueSection.java\n@@ -59,6 +59,7 @@ public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMen\n         viewBinding.recyclerView.setAdapter(listAdapter);\n         int paddingHorizontal = (int) (12 * getResources().getDisplayMetrics().density);\n         viewBinding.recyclerView.setPadding(paddingHorizontal, 0, paddingHorizontal, 0);\n+        viewBinding.emptyLabel.setText(R.string.home_continue_empty_text);\n         return view;\n     }\n \n@@ -156,6 +157,7 @@ private void loadItems() {\n                     this.queue = queue;\n                     listAdapter.setDummyViews(0);\n                     listAdapter.updateData(queue);\n+                    viewBinding.emptyLabel.setVisibility(queue.isEmpty() ? View.VISIBLE : View.GONE);\n                 }, error -> Log.e(TAG, Log.getStackTraceString(error)));\n \n     }\ndiff --git a/app/src/main/res/layout/home_section.xml b/app/src/main/res/layout/home_section.xml\nindex c1bac5e915d..29bc0ce4110 100644\n--- a/app/src/main/res/layout/home_section.xml\n+++ b/app/src/main/res/layout/home_section.xml\n@@ -105,4 +105,14 @@\n         tools:listitem=\"@layout/horizontal_itemlist_item\"\n         tools:itemCount=\"1\" />\n \n+    <TextView\n+        android:id=\"@+id/emptyLabel\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:visibility=\"gone\"\n+        android:paddingHorizontal=\"32dp\"\n+        android:paddingVertical=\"8dp\"\n+        android:textAlignment=\"center\"\n+        app:layout_constraintTop_toBottomOf=\"@id/barrier\" />\n+\n </androidx.constraintlayout.widget.ConstraintLayout>\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 0f394c792bb..1f310a04eaf 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -61,6 +61,10 @@\n     <string name=\"home_continue_title\">Continue listening</string>\n     <string name=\"home_new_title\">See what\\'s new</string>\n     <string name=\"home_downloads_title\">Manage downloads</string>\n+    <string name=\"home_no_recent_unplayed_episodes_text\">You already played all recent episodes. Nothing to be surprised here ;)</string>\n+    <string name=\"home_continue_empty_text\">You can add episodes by downloading them or long-pressing them and selecting \\\"Add to queue\\\".</string>\n+    <string name=\"home_new_empty_text\">New episodes will show up here. You can then decide whether you are interested in them.</string>\n+    <string name=\"home_downloads_empty_text\">You can download any episode to listen to it offline.</string>\n     <string name=\"home_welcome_title\">Welcome to AntennaPod!</string>\n     <string name=\"home_welcome_text\">You are not subscribed to any podcasts yet. Open the side menu to add a podcast.</string>\n     <string name=\"notification_permission_text\">AntennaPod needs your permission to show notifications. By default, AntennaPod only shows notifications while something is being downloaded or when something goes wrong.</string>\n", "test_patch": "", "problem_statement": "Hide 'Get surprised' shuffle icon when section is empty\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.5.0-beta1 (be3ad792b)\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\nGalaxy S21 5G\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Open the app\r\n2. Click the 'Get surprised' icon\n\n### Expected behaviour\n\nClicking the 'Get surprised' icon should trigger a specific action or feature. \r\nIf no action is intended, the icon should be made non-clickable, similar to the 'See what's new' icon.\n\n### Current behaviour\n\n'Get surprised' icon is clickable without triggering any action.\r\n\r\n### Notes\r\nThe 'See what's new' icon is non-clickable.\r\n\r\n\r\nhttps://github.com/user-attachments/assets/42cdfafa-96ef-49db-ba7f-f3c517ea317d\r\n\r\n\n\n### Logs\n\n_No response_\nBetter explain what empty sections on home screen do\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.5.0-beta1 (be3ad792b)\n\n### Where did you get the app from\n\nGoogle Play\n\n### Feature or improvement you want\n\n1. Open the app.\r\n2. Locate the 'Get surprised' section.\r\n\r\nUser should understand what 'Get surprised' means.\r\nThe icon should intuitively represent the action it signifies.\n\n### Why should this be added?\n\n'Get surprised' lacks a clear description of functionality, which makes users, especially new users, feel confused.\r\n\r\nThe current icon is unconventional and may not clearly indicate its purpose, which cannot help users to understand the function of 'Get surprised'.\r\n\r\n![SCREENSHOT_0](https://github.com/user-attachments/assets/f95f6c66-359f-4c03-9f54-eba6b4db6d58)\r\n\r\n\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "\n", "created_at": "2024-06-03T15:22:14Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7215, "instance_id": "AntennaPod__AntennaPod-7215", "issue_numbers": ["7065"], "base_commit": "e2ff09bd344e4c53ef40381f533fe26914604492", "patch": "diff --git a/parser/media/src/main/java/de/danoeh/antennapod/parser/media/vorbis/VorbisCommentReader.java b/parser/media/src/main/java/de/danoeh/antennapod/parser/media/vorbis/VorbisCommentReader.java\nindex 7b907b969dc..607a6b1f174 100644\n--- a/parser/media/src/main/java/de/danoeh/antennapod/parser/media/vorbis/VorbisCommentReader.java\n+++ b/parser/media/src/main/java/de/danoeh/antennapod/parser/media/vorbis/VorbisCommentReader.java\n@@ -20,16 +20,14 @@ public abstract class VorbisCommentReader {\n     private static final int PACKET_TYPE_IDENTIFICATION = 1;\n     private static final int PACKET_TYPE_COMMENT = 3;\n \n-    private final InputStream input;\n+    private final VorbisInputStream input;\n \n     VorbisCommentReader(InputStream input) {\n-        this.input = input;\n+        this.input = new VorbisInputStream(input);\n     }\n \n     public void readInputStream() throws VorbisCommentReaderException {\n         try {\n-            findIdentificationHeader();\n-            findOggPage();\n             findCommentHeader();\n             VorbisCommentHeader commentHeader = readCommentHeader();\n             Log.d(TAG, commentHeader.toString());\n@@ -41,26 +39,6 @@ public void readInputStream() throws VorbisCommentReaderException {\n         }\n     }\n \n-    private void findOggPage() throws IOException {\n-        // find OggS\n-        byte[] buffer = new byte[4];\n-        final byte[] oggPageHeader = {'O', 'g', 'g', 'S'};\n-        for (int bytesRead = 0; bytesRead < SECOND_PAGE_MAX_LENGTH; bytesRead++) {\n-            int data = input.read();\n-            if (data == -1) {\n-                throw new IOException(\"EOF while trying to find vorbis page\");\n-            }\n-            buffer[bytesRead % buffer.length] = (byte) data;\n-            if (bufferMatches(buffer, oggPageHeader, bytesRead)) {\n-                break;\n-            }\n-        }\n-        // read segments\n-        IOUtils.skipFully(input, 22);\n-        int numSegments = input.read();\n-        IOUtils.skipFully(input, numSegments);\n-    }\n-\n     private void readUserComment() throws VorbisCommentReaderException {\n         try {\n             long vectorLength = EndianUtils.readSwappedUnsignedInteger(input);\n@@ -90,25 +68,6 @@ private String readUtf8String(long length) throws IOException {\n         return charset.newDecoder().decode(ByteBuffer.wrap(buffer)).toString();\n     }\n \n-    /**\n-     * Looks for an identification header in the first page of the file. If an\n-     * identification header is found, it will be skipped completely\n-     */\n-    private void findIdentificationHeader() throws IOException {\n-        byte[] buffer = new byte[FIRST_OPUS_PAGE_LENGTH];\n-        IOUtils.readFully(input, buffer);\n-        final byte[] oggIdentificationHeader = new byte[]{ PACKET_TYPE_IDENTIFICATION, 'v', 'o', 'r', 'b', 'i', 's' };\n-        for (int i = 6; i < buffer.length; i++) {\n-            if (bufferMatches(buffer, oggIdentificationHeader, i)) {\n-                IOUtils.skip(input, FIRST_OGG_PAGE_LENGTH - FIRST_OPUS_PAGE_LENGTH);\n-                return;\n-            } else if (bufferMatches(buffer, \"OpusHead\".getBytes(), i)) {\n-                return;\n-            }\n-        }\n-        throw new IOException(\"No vorbis identification header found\");\n-    }\n-\n     private void findCommentHeader() throws IOException {\n         byte[] buffer = new byte[64]; // Enough space for some bytes. Used circularly.\n         final byte[] oggCommentHeader = new byte[]{ PACKET_TYPE_COMMENT, 'v', 'o', 'r', 'b', 'i', 's' };\ndiff --git a/parser/media/src/main/java/de/danoeh/antennapod/parser/media/vorbis/VorbisInputStream.java b/parser/media/src/main/java/de/danoeh/antennapod/parser/media/vorbis/VorbisInputStream.java\nnew file mode 100644\nindex 00000000000..802813ab9a9\n--- /dev/null\n+++ b/parser/media/src/main/java/de/danoeh/antennapod/parser/media/vorbis/VorbisInputStream.java\n@@ -0,0 +1,69 @@\n+package de.danoeh.antennapod.parser.media.vorbis;\n+\n+import org.apache.commons.io.IOUtils;\n+\n+import java.io.BufferedInputStream;\n+import java.io.FilterInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.util.Arrays;\n+\n+\n+public class VorbisInputStream extends FilterInputStream {\n+    private static final byte[] CAPTURE_PATTERN = {'O', 'g', 'g', 'S'};\n+    private static final int HEADER_SKIP_LENGTH = 1 + 1 + 8 + 4 + 4 + 4;\n+\n+    private final BufferedInputStream inputStream;\n+    private int pageRemainBytes = 0;\n+\n+    protected VorbisInputStream(InputStream in) {\n+        super(in);\n+        inputStream = new BufferedInputStream(in);\n+    }\n+\n+    private int parsePageHeader(InputStream in) throws IOException {\n+        byte[] capturePattern = new byte[4];\n+\n+        IOUtils.readFully(in, capturePattern, 0, 4);\n+        if (!Arrays.equals(CAPTURE_PATTERN, capturePattern)) {\n+            throw new IOException(\"Invalid page header\");\n+        }\n+\n+        IOUtils.skipFully(in, HEADER_SKIP_LENGTH);\n+\n+        int pageSegments = in.read();\n+        byte[] segmentTable = new byte[pageSegments];\n+        int pageLength = 0;\n+        IOUtils.readFully(in, segmentTable);\n+        for (byte segment:segmentTable) {\n+            pageLength += (segment & 0xff);\n+        }\n+\n+        return pageLength;\n+    }\n+\n+    /** check and update remaining bytes **/\n+    private void updateRemainBytes() throws IOException {\n+        if (pageRemainBytes == 0) {\n+            pageRemainBytes = parsePageHeader(inputStream);\n+        } else if (pageRemainBytes < 0) {\n+            throw new IOException(\"Page remain bytes less than 0\");\n+        }\n+    }\n+\n+    @Override\n+    public int read() throws IOException {\n+        updateRemainBytes();\n+        pageRemainBytes--;\n+        return inputStream.read();\n+    }\n+\n+    @Override\n+    public int read(byte[] b, int off, int len) throws IOException {\n+        updateRemainBytes();\n+        int bytesToRead = Math.min(len, pageRemainBytes);\n+        IOUtils.readFully(inputStream, b, off, bytesToRead);\n+        this.pageRemainBytes -= bytesToRead;\n+        return bytesToRead;\n+    }\n+}\n", "test_patch": "diff --git a/parser/media/src/test/java/de/danoeh/antennapod/parser/media/vorbis/VorbisCommentMetadataReaderTest.java b/parser/media/src/test/java/de/danoeh/antennapod/parser/media/vorbis/VorbisCommentMetadataReaderTest.java\nindex 7f71c8fa927..6dab507a3ef 100644\n--- a/parser/media/src/test/java/de/danoeh/antennapod/parser/media/vorbis/VorbisCommentMetadataReaderTest.java\n+++ b/parser/media/src/test/java/de/danoeh/antennapod/parser/media/vorbis/VorbisCommentMetadataReaderTest.java\n@@ -16,6 +16,7 @@ public class VorbisCommentMetadataReaderTest {\n     public void testRealFilesAuphonic() throws IOException, VorbisCommentReaderException {\n         testRealFileAuphonic(\"auphonic.ogg\");\n         testRealFileAuphonic(\"auphonic.opus\");\n+        testRealFileAuphonic(\"opus-comment.opus\");\n     }\n \n     public void testRealFileAuphonic(String filename) throws IOException, VorbisCommentReaderException {\ndiff --git a/parser/media/src/test/resources/opus-comment.opus b/parser/media/src/test/resources/opus-comment.opus\nnew file mode 100644\nindex 00000000000..d636f2be684\nBinary files /dev/null and b/parser/media/src/test/resources/opus-comment.opus differ\n", "problem_statement": "Failed to parse vorbis comment spanning pages\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.3.2\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n14\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Prepare a mp3 file with embedded cover and `comment` ID3 tag\r\n2. Convert to opus: `ffmpeg -i file.mp3 -f flac - | opusenc - file.opus`\r\n3. Confirm `comment` tag exists in converted file\r\n```sh\r\n\u279c opusinfo file.opus\r\nProcessing file \"file.opus\"...\r\n\r\nNew logical stream (#1, serial: 4d363549): type opus\r\nEncoded with libopus 1.5.1, libopusenc 0.2.1\r\nUser comments section follows...\r\n\tENCODER=opusenc from opus-tools 0.2\r\n\tMETADATA_BLOCK_PICTURE=3|image/png||880x880x32|<346606 bytes of image data>\r\n\tcomment=Summary\r\n```\r\n4. Put file.opus into local folder\r\n5. Refresh\n\n### Expected behaviour\n\nComment \"Summary\" displayed in shownotes.\n\n### Current behaviour\n\nShownotes not showing up. And log reports `User comment unrealistically long. key=jKd2/zT71n, length=2004374095`.\r\n\r\nAfter digging into code and file content, I guess that's because  `VorbisCommentReader` expect that all comments fit within a single page. But the embedded cover `METADATA_BLOCK_PICTURE` was too big so it's divided into n pages. In result, `readUserComment()` failed to skip whole `METADATA_BLOCK_PICTURE` segment. Thus next time, `readUserComment()` will read from somewhere within `METADATA_BLOCK_PICTURE` rather than beginning of next field.\n\n### Logs\n\n```\r\n04-06 19:51:50.236 17733 21131 D LocalFeedUpdater: Unable to parse ID3 of content://com.android.externalstorage.documents/tree/primary%3AMusic%2F%E6%82%84%E6%82%84%E8%AF%9D/document/primary%3AMusic%2F%E6%82%84%E6%82%84%E8%AF%9D%2Ffile.opus: Expected I and got O\r\n04-06 19:51:50.240 17733 21131 D VorbisCommentReader: VorbisCommentHeader [vendorString=libopus 1.5.1, libopusenc 0.2.1, userCommentLength=3]\r\n04-06 19:51:50.240 17733 21131 D VorbisCommentReader: key=encoder, length=35, handles=false\r\n04-06 19:51:50.240 17733 21131 D VorbisCommentReader: key=metadata_block_picture, length=462219, handles=false\r\n04-06 19:51:50.240 17733 21131 D LocalFeedUpdater: Unable to parse vorbis comments of content://com.android.externalstorage.documents/tree/primary%3AMusic%2F%E6%82%84%E6%82%84%E8%AF%9D/document/primary%3AMusic%2F%E6%82%84%E6%82%84%E8%AF%9D%2Ffile.opus: User comment unrealistically long. key=jKd2/zT71n, length=2004374095\r\n```\n", "hints_text": "Could you please upload an example file (in the best case both the original mp3 and the converted opus file)?\nHere is is, both mp3 and opus file are included.\r\n[example.zip](https://github.com/AntennaPod/AntennaPod/files/14897123/example.zip)\nThanks for the files!\r\n\r\nI think we had that with other files as well, where AntennaPod thinks that the comment is over but it is actually in the middle of the image. I didn't know about ogg pages (or that the comments can span over multiple pages). As you say, it must be because the image overlaps a page border.\r\n\r\nGiven your comment, it looks like you have researched quite a bit before writing this issue. This means you likely know more about the file format than I do. Would you be interested in writing a PR that fixes this? If not, I'm not sure how soon I (or anyone else) would start working on this, given that there are so many other open issues.\r\n\r\nMaybe a solution would be to write a custom `Stream` subclass that basically \"unpacks\" the pages on the fly. So it would basically parse and skip the page headers and just leave the actual page content to the caller. Then we can feed that stream into our existing Vorbis comment reader.\r\n\r\nSome links (mainly for myself, so I can find them again):\r\nhttps://datatracker.ietf.org/doc/html/rfc7845#section-5.2\r\nhttps://github.com/xiph/opus-tools/blob/master/src/info_opus.c\nYes, I'm willing to write a PR. However, this may take some time, considering that I haven't written Android code for a while.\nFor development, it might help adding your test file as a unit test here: https://github.com/AntennaPod/AntennaPod/blob/develop/parser/media/src/test/java/de/danoeh/antennapod/parser/media/vorbis/VorbisCommentMetadataReaderTest.java Then the development can all be done using the test, no need to run the full app on an Android device or any manual testing.\r\n\r\nSecond advantage: Then we have a regression test :)\r\n\r\nLet me know if there is anything I can help you with when setting up the project\nThanks for the advice! \r\nEverything is going smoothly so far.  I will let you know if I need any further assistance.", "created_at": "2024-05-31T15:12:20Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7214, "instance_id": "AntennaPod__AntennaPod-7214", "issue_numbers": ["7117"], "base_commit": "43d487f7e96f76df6f2b7f04d3a24456b387300a", "patch": "diff --git a/app/build.gradle b/app/build.gradle\nindex 4f686a1fbae..da1a27d0842 100644\n--- a/app/build.gradle\n+++ b/app/build.gradle\n@@ -56,6 +56,7 @@ android {\n \n     androidResources {\n         additionalParameters += [\"--no-version-vectors\"]\n+        generateLocaleConfig true\n     }\n }\n \ndiff --git a/app/src/main/res/resources.properties b/app/src/main/res/resources.properties\nnew file mode 100644\nindex 00000000000..92481bb0b1f\n--- /dev/null\n+++ b/app/src/main/res/resources.properties\n@@ -0,0 +1,1 @@\n+unqualifiedResLocale=en\n", "test_patch": "", "problem_statement": "Option to change app language\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.3.2\n\n### Where did you get the app from\n\nGoogle Play\n\n### Problem you may be having, or feature you want\n\nSo I use the application for about a month now and when I first downloaded I am pretty sure it was by default in English. When I opened again the app after some weeks, it had automatically changed to Greek. So I searched in the settings if there is an option to change languages but I couldn't find one. I think that this could be a great feature because not everyone that lives in a country (e.g. Greece) is familiar with the native language. If this feature already exists please let me know!\n\n### Suggested solution\n\n_No response_\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "This was already requested in #113. I think, however, that things have changed since then. Android 13+ supports per-app language settings, which we can enable as follows: https://developer.android.com/guide/topics/resources/app-languages\r\n\r\nFor someone implementing this, first try the automatic version and see if it contains languages that we don't actually support. If that is the case, create a script to create the language config file from the list of actual AntennaPod languages (i18n/values directory)\r\n\r\n> not everyone that lives in a country (e.g. Greece) is familiar with the native language. \r\n\r\nThe language is not based on your location but on what language you select on the Android settings screen.\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/implement-android-13-per-app-language-setting/2287/2\n\n> If that is the case, create a script to create the language config file from the list of actual AntennaPod languages (i18n/values directory)\r\n\r\n@ByteHamster  You are suggesting to run the script on the device?\nNo, my idea was to have a script that we can run as part of creating a new release. We already have a bunch of scripts there (contributors list, website languages, etc). However, if AGP's automatic detection works well for us, we do not need a script (and should not create one).", "created_at": "2024-05-31T14:01:56Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7213, "instance_id": "AntennaPod__AntennaPod-7213", "issue_numbers": ["7146"], "base_commit": "0a768e6286347a6bdb32cf56f774ececf6a321f3", "patch": "diff --git a/net/sync/gpoddernet/src/main/java/de/danoeh/antennapod/net/sync/gpoddernet/GpodnetService.java b/net/sync/gpoddernet/src/main/java/de/danoeh/antennapod/net/sync/gpoddernet/GpodnetService.java\nindex b04e9bdc925..4b08c4b9ffb 100644\n--- a/net/sync/gpoddernet/src/main/java/de/danoeh/antennapod/net/sync/gpoddernet/GpodnetService.java\n+++ b/net/sync/gpoddernet/src/main/java/de/danoeh/antennapod/net/sync/gpoddernet/GpodnetService.java\n@@ -31,7 +31,6 @@\n import de.danoeh.antennapod.net.sync.gpoddernet.mapper.ResponseMapper;\n import de.danoeh.antennapod.net.sync.gpoddernet.model.GpodnetDevice;\n import de.danoeh.antennapod.net.sync.gpoddernet.model.GpodnetEpisodeActionPostResponse;\n-import de.danoeh.antennapod.net.sync.gpoddernet.model.GpodnetPodcast;\n import de.danoeh.antennapod.net.sync.gpoddernet.model.GpodnetUploadChangesResponse;\n import okhttp3.Credentials;\n import okhttp3.MediaType;\n@@ -60,13 +59,13 @@ public class GpodnetService implements ISyncService {\n \n     private final OkHttpClient httpClient;\n \n-    public GpodnetService(OkHttpClient httpClient, String baseHosturl,\n+    public GpodnetService(OkHttpClient httpClient, String baseHostUrl,\n                           String deviceId, String username, String password)  {\n         this.httpClient = httpClient;\n         this.deviceId = deviceId;\n         this.username = username;\n         this.password = password;\n-        HostnameParser hostname = new HostnameParser(baseHosturl == null ? DEFAULT_BASE_HOST : baseHosturl);\n+        HostnameParser hostname = new HostnameParser(baseHostUrl == null ? DEFAULT_BASE_HOST : baseHostUrl);\n         this.baseHost = hostname.host;\n         this.basePort = hostname.port;\n         this.baseScheme = hostname.scheme;\n@@ -373,69 +372,16 @@ private void checkStatusCode(@NonNull Response response) throws GpodnetServiceEx\n                     }\n                 }\n                 if (responseCode >= 500) {\n-                    throw new GpodnetServiceBadStatusCodeException(\"Gpodder.net is currently unavailable (code \"\n+                    throw new GpodnetServiceBadStatusCodeException(this.baseHost + \" is currently unavailable (code \"\n                             + responseCode + \")\", responseCode);\n                 } else {\n-                    throw new GpodnetServiceBadStatusCodeException(\"Unable to connect to Gpodder.net (code \"\n+                    throw new GpodnetServiceBadStatusCodeException(\"Unable to connect to \" + this.baseHost + \" (code \"\n                             + responseCode + \": \" + response.message() + \")\", responseCode);\n                 }\n             }\n         }\n     }\n \n-    private List<GpodnetPodcast> readPodcastListFromJsonArray(@NonNull JSONArray array) throws JSONException {\n-        List<GpodnetPodcast> result = new ArrayList<>(array.length());\n-        for (int i = 0; i < array.length(); i++) {\n-            result.add(readPodcastFromJsonObject(array.getJSONObject(i)));\n-        }\n-        return result;\n-    }\n-\n-    private GpodnetPodcast readPodcastFromJsonObject(JSONObject object) throws JSONException {\n-        String url = object.getString(\"url\");\n-\n-        String title;\n-        Object titleObj = object.opt(\"title\");\n-        if (titleObj instanceof String) {\n-            title = (String) titleObj;\n-        } else {\n-            title = url;\n-        }\n-\n-        String description;\n-        Object descriptionObj = object.opt(\"description\");\n-        if (descriptionObj instanceof String) {\n-            description = (String) descriptionObj;\n-        } else {\n-            description = \"\";\n-        }\n-\n-        int subscribers = object.getInt(\"subscribers\");\n-\n-        Object logoUrlObj = object.opt(\"logo_url\");\n-        String logoUrl = (logoUrlObj instanceof String) ? (String) logoUrlObj : null;\n-        if (logoUrl == null) {\n-            Object scaledLogoUrl = object.opt(\"scaled_logo_url\");\n-            if (scaledLogoUrl instanceof String) {\n-                logoUrl = (String) scaledLogoUrl;\n-            }\n-        }\n-\n-        String website = null;\n-        Object websiteObj = object.opt(\"website\");\n-        if (websiteObj instanceof String) {\n-            website = (String) websiteObj;\n-        }\n-        String mygpoLink = object.getString(\"mygpo_link\");\n-\n-        String author = null;\n-        Object authorObj = object.opt(\"author\");\n-        if (authorObj instanceof String) {\n-            author = (String) authorObj;\n-        }\n-        return new GpodnetPodcast(url, title, description, subscribers, logoUrl, website, mygpoLink, author);\n-    }\n-\n     private List<GpodnetDevice> readDeviceListFromJsonArray(@NonNull JSONArray array) throws JSONException {\n         List<GpodnetDevice> result = new ArrayList<>(array.length());\n         for (int i = 0; i < array.length(); i++) {\n", "test_patch": "", "problem_statement": "Use the name of the sync server in error messages\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.3.2\n\n### Where did you get the app from\n\nGoogle Play\n\n### Problem you may be having, or feature you want\n\nCurrently synchronisation errors when using the Gpodder.net service always say that there was an issue connecting to Gpodder.net, even when you are self-hosting gpodder and the app is actually trying to connect to a different server (say, gpodder.example.com).\n\n### Suggested solution\n\nIt would be nice for the message to read the name of the currently selected synchronisation server and use that in the message rather than only talking about Gpodder.net.\n\n### Screenshots / Drawings / Technical details\n\nThe code responsible for these messages is here: https://github.com/AntennaPod/AntennaPod/blob/c063c59af320e15204584ede3611478d880cc407/net/sync/gpoddernet/src/main/java/de/danoeh/antennapod/net/sync/gpoddernet/GpodnetService.java#L379 The name is hard-coded.\n", "hints_text": "", "created_at": "2024-05-30T20:09:43Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7207, "instance_id": "AntennaPod__AntennaPod-7207", "issue_numbers": ["7193"], "base_commit": "1fc212ee88a2ee0e99e889a8d93763562a690aed", "patch": "diff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 0cbeb64072f..85d0681901b 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -381,7 +381,7 @@\n     <string name=\"download_pref_details\">Details</string>\n     <string name=\"import_export_pref\">Import/Export</string>\n     <string name=\"import_export_search_keywords\">backup, restore</string>\n-    <string name=\"appearance\">Appearance</string>\n+    <string name=\"theming\">Theming</string>\n     <string name=\"external_elements\">External elements</string>\n     <string name=\"interruptions\">Interruptions</string>\n     <string name=\"playback_control\">Playback control</string>\n@@ -534,6 +534,7 @@\n     <string name=\"pref_show_subscription_title\">Show titles</string>\n     <string name=\"pref_new_episodes_action_title\">New episodes action</string>\n     <string name=\"pref_new_episodes_action_sum\">Action to take for new episodes</string>\n+    <string name=\"episode_information\">Episode information</string>\n \n     <!-- About screen -->\n     <string name=\"about_pref\">About</string>\ndiff --git a/ui/preferences/src/main/res/xml/preferences_playback.xml b/ui/preferences/src/main/res/xml/preferences_playback.xml\nindex 9fff85eba6c..c6ae85f5699 100644\n--- a/ui/preferences/src/main/res/xml/preferences_playback.xml\n+++ b/ui/preferences/src/main/res/xml/preferences_playback.xml\n@@ -43,11 +43,6 @@\n                 android:key=\"prefPlaybackSpeedLauncher\"\n                 android:summary=\"@string/pref_playback_speed_sum\"\n                 android:title=\"@string/playback_speed\"/>\n-        <SwitchPreferenceCompat\n-                android:defaultValue=\"false\"\n-                android:key=\"prefPlaybackTimeRespectsSpeed\"\n-                android:summary=\"@string/pref_playback_time_respects_speed_sum\"\n-                android:title=\"@string/pref_playback_time_respects_speed_title\"/>\n         <SwitchPreferenceCompat\n                 android:defaultValue=\"false\"\n                 android:key=\"prefStreamOverDownload\"\ndiff --git a/ui/preferences/src/main/res/xml/preferences_user_interface.xml b/ui/preferences/src/main/res/xml/preferences_user_interface.xml\nindex a8e276546c9..f61447b7776 100644\n--- a/ui/preferences/src/main/res/xml/preferences_user_interface.xml\n+++ b/ui/preferences/src/main/res/xml/preferences_user_interface.xml\n@@ -3,7 +3,7 @@\n         xmlns:android=\"http://schemas.android.com/apk/res/android\"\n         xmlns:search=\"http://schemas.android.com/apk/com.bytehamster.lib.preferencesearch\">\n \n-    <PreferenceCategory android:title=\"@string/appearance\">\n+    <PreferenceCategory android:title=\"@string/theming\">\n         <de.danoeh.antennapod.ui.preferences.preference.ThemePreference\n                 android:key=\"prefTheme\" />\n         <SwitchPreferenceCompat\n@@ -16,22 +16,6 @@\n                 android:key=\"prefTintedColors\"\n                 android:summary=\"@string/pref_tinted_theme_message\"\n                 android:defaultValue=\"false\" />\n-        <Preference\n-                android:key=\"prefHiddenDrawerItems\"\n-                android:summary=\"@string/pref_nav_drawer_items_sum\"\n-                android:title=\"@string/pref_nav_drawer_items_title\"/>\n-        <SwitchPreferenceCompat\n-                android:title=\"@string/pref_episode_cover_title\"\n-                android:key=\"prefEpisodeCover\"\n-                android:summary=\"@string/pref_episode_cover_summary\"\n-                android:defaultValue=\"true\"\n-                android:enabled=\"true\"/>\n-        <SwitchPreferenceCompat\n-                android:title=\"@string/pref_show_remain_time_title\"\n-                android:key=\"showTimeLeft\"\n-                android:summary=\"@string/pref_show_remain_time_summary\"\n-                android:defaultValue=\"false\"\n-                android:enabled=\"true\"/>\n     </PreferenceCategory>\n     <PreferenceCategory android:title=\"@string/subscriptions_label\">\n         <Preference\n@@ -50,6 +34,25 @@\n             android:key=\"prefSubscriptionsFilter\"\n             android:summary=\"@string/pref_filter_feed_sum\" />\n     </PreferenceCategory>\n+    <PreferenceCategory android:title=\"@string/episode_information\">\n+        <SwitchPreferenceCompat\n+            android:title=\"@string/pref_episode_cover_title\"\n+            android:key=\"prefEpisodeCover\"\n+            android:summary=\"@string/pref_episode_cover_summary\"\n+            android:defaultValue=\"true\"\n+            android:enabled=\"true\"/>\n+        <SwitchPreferenceCompat\n+            android:title=\"@string/pref_show_remain_time_title\"\n+            android:key=\"showTimeLeft\"\n+            android:summary=\"@string/pref_show_remain_time_summary\"\n+            android:defaultValue=\"false\"\n+            android:enabled=\"true\"/>\n+        <SwitchPreferenceCompat\n+            android:defaultValue=\"false\"\n+            android:key=\"prefPlaybackTimeRespectsSpeed\"\n+            android:summary=\"@string/pref_playback_time_respects_speed_sum\"\n+            android:title=\"@string/pref_playback_time_respects_speed_title\"/>\n+    </PreferenceCategory>\n     <PreferenceCategory android:title=\"@string/external_elements\">\n         <SwitchPreferenceCompat\n                 android:defaultValue=\"false\"\n@@ -77,6 +80,10 @@\n                 android:title=\"@string/pref_default_page\"\n                 android:summary=\"@string/pref_default_page_sum\"\n                 android:defaultValue=\"HomeFragment\"/>\n+        <Preference\n+            android:key=\"prefHiddenDrawerItems\"\n+            android:summary=\"@string/pref_nav_drawer_items_sum\"\n+            android:title=\"@string/pref_nav_drawer_items_title\"/>\n         <SwitchPreferenceCompat\n                 android:key=\"prefBackButtonOpensDrawer\"\n                 android:title=\"@string/pref_back_button_opens_drawer\"\n", "test_patch": "", "problem_statement": "Reorganise some settings\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\r\n\r\n### App version\r\n\r\n3.4\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Problem you may be having, or feature you want\r\n\r\nNot all settings seem to be in the right spot (following from discussion on #7008).\r\n\r\n### Suggested solution\r\n\r\nUnder Settings > User Interface:\r\n* Theming: change 'Appearance' title to 'Theming'\r\n* Appearance/Episode information (tbc; better suggestions welcome):\r\n  * Split 'Show remaining time' and 'Use episode covers' off into dedicated section\r\n  * Move the 'Adjust media info to playback speed' from Playback section to here\r\n* 'Set navigation drawer items' moved to bottom (under 'Behaviour', even though the title isn't quite right), the bottom navigation setting would go there as well.\r\n\r\n### Screenshots / Drawings / Technical details\r\n\n", "hints_text": "", "created_at": "2024-05-29T19:56:59Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7192, "instance_id": "AntennaPod__AntennaPod-7192", "issue_numbers": ["7188"], "base_commit": "5f5d744e71a920585609f46024d2ce6642266852", "patch": "diff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\nindex 19660fb77d2..15debd02933 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n@@ -693,7 +693,7 @@ public void setFeedItemRead(FeedItem item, int played, boolean resetMediaPositio\n             db.update(TABLE_NAME_FEED_ITEMS, values, KEY_ID + \"=?\", new String[]{String.valueOf(item.getId())});\n             item.setPlayed(played == FeedItem.PLAYED);\n \n-            if (resetMediaPosition) {\n+            if (resetMediaPosition && item.hasMedia()) {\n                 values.clear();\n                 values.put(KEY_POSITION, 0);\n                 db.update(TABLE_NAME_FEED_MEDIA, values, KEY_ID + \"=?\",\n", "test_patch": "diff --git a/app/src/androidTest/java/de/test/antennapod/EspressoTestUtils.java b/app/src/androidTest/java/de/test/antennapod/EspressoTestUtils.java\nindex c52df7f3e1d..a661eaffb92 100644\n--- a/app/src/androidTest/java/de/test/antennapod/EspressoTestUtils.java\n+++ b/app/src/androidTest/java/de/test/antennapod/EspressoTestUtils.java\n@@ -36,6 +36,7 @@\n \n import static androidx.test.espresso.Espresso.onView;\n import static androidx.test.espresso.action.ViewActions.click;\n+import static androidx.test.espresso.assertion.ViewAssertions.doesNotExist;\n import static androidx.test.espresso.assertion.ViewAssertions.matches;\n import static androidx.test.espresso.matcher.ViewMatchers.hasDescendant;\n import static androidx.test.espresso.matcher.ViewMatchers.isDisplayed;\n@@ -44,6 +45,7 @@\n import static androidx.test.espresso.matcher.ViewMatchers.withId;\n import static androidx.test.espresso.matcher.ViewMatchers.withText;\n import static org.hamcrest.Matchers.allOf;\n+import static org.hamcrest.Matchers.not;\n \n public class EspressoTestUtils {\n     /**\n@@ -143,6 +145,21 @@ public void perform(UiController uiController, View view) {\n         };\n     }\n \n+    public static void waitForViewToDisappear(Matcher<? super View> matcher, long maxWaitingTimeMs) {\n+        long endTime = System.currentTimeMillis() + maxWaitingTimeMs;\n+        while (System.currentTimeMillis() <= endTime) {\n+            try {\n+                onView(allOf(matcher, isDisplayed())).check(matches(not(doesNotExist())));\n+                Thread.sleep(100);\n+            } catch (NoMatchingViewException ex) {\n+                return; // view has disappeared\n+            } catch (InterruptedException e) {\n+                throw new RuntimeException(e);\n+            }\n+        }\n+        throw new RuntimeException(\"timeout exceeded\"); // or whatever exception you want\n+    }\n+    \n     /**\n      * Clear all app databases.\n      */\ndiff --git a/app/src/androidTest/java/de/test/antennapod/ui/TextOnlyFeedsTest.java b/app/src/androidTest/java/de/test/antennapod/ui/TextOnlyFeedsTest.java\nindex 69a8f98ce55..5f7e8e95910 100644\n--- a/app/src/androidTest/java/de/test/antennapod/ui/TextOnlyFeedsTest.java\n+++ b/app/src/androidTest/java/de/test/antennapod/ui/TextOnlyFeedsTest.java\n@@ -27,7 +27,6 @@\n import static de.test.antennapod.EspressoTestUtils.openNavDrawer;\n import static de.test.antennapod.EspressoTestUtils.waitForView;\n import static org.hamcrest.CoreMatchers.allOf;\n-import static org.hamcrest.CoreMatchers.not;\n \n /**\n  * Test UI for feeds that do not have media files\n@@ -67,7 +66,7 @@ public void testMarkAsPlayedList() throws Exception {\n         onView(withText(feed.getItemAtIndex(0).getTitle())).perform(click());\n         onView(isRoot()).perform(waitForView(withText(R.string.mark_read_no_media_label), 3000));\n         onView(allOf(withText(R.string.mark_read_no_media_label), isDisplayed())).perform(click());\n-        onView(isRoot()).perform(waitForView(allOf(withText(R.string.mark_read_no_media_label), not(isDisplayed())), 3000));\n+        EspressoTestUtils.waitForViewToDisappear(withText(R.string.mark_read_no_media_label), 3000);\n     }\n \n }\n", "problem_statement": "Can't mark feed items as read if the feed item doesn't have audio file on it\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.4.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\nDoogee V30T\n\n### First occurred\n\nFew minutes ago, it was working, then updated AntennaPod on PlayStore to latest version and that feature stopped working\n\n### Steps to reproduce\n\nhttps://remix.kwed.org/rss.xml\r\nFeed items don't have audio file associated to them\r\nTry mark feed item as Read\n\n### Expected behaviour\n\nFeed item should become read\n\n### Current behaviour\n\nNothing happens if you press Mark as Read\r\nIf you press and hold here, it is offering \"Mark as Unread\" even though the item is already in Unread state\r\n![Screenshot_20240519-163952](https://github.com/AntennaPod/AntennaPod/assets/170247323/2efe7d31-5f4a-4ad3-a31b-222a23e87dc7)\r\n\r\nFunnily feed items that were marked as Read in previous AntennaPod version can now be marked as Unread, but they cannot be marked as Read on the current version again.\r\n\r\nFeeds which have audio files associated with them don't seem to be affected by this bug.\n\n### Logs\n\n_No response_\n", "hints_text": "I'm experiencing the same issue, only noticed today. \r\n\r\n**App version**\r\n3.4.0\r\n\r\n**Where did you get the app from**\r\nGoogle Play\r\n\r\n**Android version**\r\n14\r\n\r\n**Device model**\r\nSamsung Galaxy S23 Ultra", "created_at": "2024-05-20T20:23:45Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7176, "instance_id": "AntennaPod__AntennaPod-7176", "issue_numbers": ["4376"], "base_commit": "94c5b8aea5180dacfa81e2e7aa91a861255d148b", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\nindex 15fa614a493..79ee013bfbb 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n@@ -10,14 +10,19 @@\n import android.os.Bundle;\n import android.util.DisplayMetrics;\n import android.util.Log;\n+import android.view.Gravity;\n import android.view.KeyEvent;\n+import android.view.Menu;\n import android.view.MenuItem;\n import android.view.View;\n import android.view.ViewGroup;\n import android.widget.EditText;\n+import android.widget.RelativeLayout;\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n import androidx.appcompat.app.ActionBarDrawerToggle;\n+import androidx.appcompat.view.menu.MenuBuilder;\n+import androidx.appcompat.widget.ListPopupWindow;\n import androidx.core.graphics.Insets;\n import androidx.core.view.ViewCompat;\n import androidx.core.view.WindowCompat;\n@@ -32,48 +37,62 @@\n import androidx.work.WorkManager;\n import com.bumptech.glide.Glide;\n import com.google.android.material.appbar.MaterialToolbar;\n+import com.google.android.material.bottomnavigation.BottomNavigationView;\n import com.google.android.material.bottomsheet.BottomSheetBehavior;\n+import com.google.android.material.navigation.NavigationBarView;\n import com.google.android.material.snackbar.Snackbar;\n import de.danoeh.antennapod.R;\n-import de.danoeh.antennapod.net.download.service.feed.FeedUpdateManagerImpl;\n-import de.danoeh.antennapod.net.download.serviceinterface.FeedUpdateManager;\n-import de.danoeh.antennapod.net.sync.serviceinterface.SynchronizationQueueSink;\n-import de.danoeh.antennapod.ui.appstartintent.MediaButtonStarter;\n-import de.danoeh.antennapod.ui.common.ThemeSwitcher;\n-import de.danoeh.antennapod.ui.screen.rating.RatingDialogManager;\n import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FeedUpdateRunningEvent;\n import de.danoeh.antennapod.event.MessageEvent;\n-import de.danoeh.antennapod.ui.screen.AddFeedFragment;\n-import de.danoeh.antennapod.ui.screen.AllEpisodesFragment;\n-import de.danoeh.antennapod.ui.screen.playback.audio.AudioPlayerFragment;\n-import de.danoeh.antennapod.ui.screen.download.CompletedDownloadsFragment;\n-import de.danoeh.antennapod.ui.screen.download.DownloadLogFragment;\n-import de.danoeh.antennapod.ui.screen.feed.FeedItemlistFragment;\n-import de.danoeh.antennapod.ui.screen.InboxFragment;\n-import de.danoeh.antennapod.ui.screen.drawer.NavDrawerFragment;\n-import de.danoeh.antennapod.ui.screen.PlaybackHistoryFragment;\n-import de.danoeh.antennapod.ui.screen.queue.QueueFragment;\n-import de.danoeh.antennapod.ui.screen.SearchFragment;\n-import de.danoeh.antennapod.ui.screen.subscriptions.SubscriptionFragment;\n-import de.danoeh.antennapod.ui.TransitionEffect;\n import de.danoeh.antennapod.model.download.DownloadStatus;\n+import de.danoeh.antennapod.model.feed.FeedItemFilter;\n+import de.danoeh.antennapod.net.download.service.feed.FeedUpdateManagerImpl;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n+import de.danoeh.antennapod.net.download.serviceinterface.FeedUpdateManager;\n+import de.danoeh.antennapod.net.sync.serviceinterface.SynchronizationQueueSink;\n import de.danoeh.antennapod.playback.cast.CastEnabledActivity;\n+import de.danoeh.antennapod.storage.database.DBReader;\n import de.danoeh.antennapod.storage.importexport.AutomaticDatabaseExportWorker;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n+import de.danoeh.antennapod.ui.TransitionEffect;\n import de.danoeh.antennapod.ui.appstartintent.MainActivityStarter;\n+import de.danoeh.antennapod.ui.appstartintent.MediaButtonStarter;\n+import de.danoeh.antennapod.ui.common.ThemeSwitcher;\n import de.danoeh.antennapod.ui.common.ThemeUtils;\n import de.danoeh.antennapod.ui.discovery.DiscoveryFragment;\n+import de.danoeh.antennapod.ui.screen.AddFeedFragment;\n+import de.danoeh.antennapod.ui.screen.AllEpisodesFragment;\n+import de.danoeh.antennapod.ui.screen.InboxFragment;\n+import de.danoeh.antennapod.ui.screen.PlaybackHistoryFragment;\n+import de.danoeh.antennapod.ui.screen.SearchFragment;\n+import de.danoeh.antennapod.ui.screen.download.CompletedDownloadsFragment;\n+import de.danoeh.antennapod.ui.screen.download.DownloadLogFragment;\n+import de.danoeh.antennapod.ui.screen.drawer.BottomNavigationMoreAdapter;\n+import de.danoeh.antennapod.ui.screen.drawer.DrawerPreferencesDialog;\n+import de.danoeh.antennapod.ui.screen.drawer.NavDrawerFragment;\n+import de.danoeh.antennapod.ui.screen.drawer.NavListAdapter;\n+import de.danoeh.antennapod.ui.screen.drawer.NavigationNames;\n+import de.danoeh.antennapod.ui.screen.feed.FeedItemlistFragment;\n import de.danoeh.antennapod.ui.screen.home.HomeFragment;\n+import de.danoeh.antennapod.ui.screen.playback.audio.AudioPlayerFragment;\n+import de.danoeh.antennapod.ui.screen.preferences.PreferenceActivity;\n+import de.danoeh.antennapod.ui.screen.queue.QueueFragment;\n+import de.danoeh.antennapod.ui.screen.rating.RatingDialogManager;\n+import de.danoeh.antennapod.ui.screen.subscriptions.SubscriptionFragment;\n import de.danoeh.antennapod.ui.view.LockableBottomSheetBehavior;\n+import io.reactivex.Observable;\n+import io.reactivex.android.schedulers.AndroidSchedulers;\n+import io.reactivex.schedulers.Schedulers;\n import org.apache.commons.lang3.ArrayUtils;\n import org.apache.commons.lang3.Validate;\n import org.greenrobot.eventbus.EventBus;\n import org.greenrobot.eventbus.Subscribe;\n import org.greenrobot.eventbus.ThreadMode;\n \n+import java.util.ArrayList;\n import java.util.HashMap;\n+import java.util.List;\n import java.util.Map;\n \n /**\n@@ -94,11 +113,12 @@ public class MainActivity extends CastEnabledActivity {\n \n     private @Nullable DrawerLayout drawerLayout;\n     private @Nullable ActionBarDrawerToggle drawerToggle;\n+    private BottomNavigationView bottomNavigationView;\n     private View navDrawer;\n     private LockableBottomSheetBehavior sheetBehavior;\n     private RecyclerView.RecycledViewPool recycledViewPool = new RecyclerView.RecycledViewPool();\n     private int lastTheme = 0;\n-    private Insets navigationBarInsets = Insets.NONE;\n+    private Insets systemBarInsets = Insets.NONE;\n \n     @NonNull\n     public static Intent getIntentToOpenFeed(@NonNull Context context, long feedId) {\n@@ -122,11 +142,24 @@ public void onCreate(Bundle savedInstanceState) {\n \n         drawerLayout = findViewById(R.id.drawer_layout);\n         navDrawer = findViewById(R.id.navDrawerFragment);\n-        setNavDrawerSize();\n+        bottomNavigationView = findViewById(R.id.bottomNavigationView);\n+        if (UserPreferences.isBottomNavigationEnabled()) {\n+            buildBottomNavigationMenu();\n+            if (drawerLayout == null) { // Tablet mode\n+                navDrawer.setVisibility(View.GONE);\n+            } else {\n+                drawerLayout.setDrawerLockMode(DrawerLayout.LOCK_MODE_LOCKED_CLOSED);\n+            }\n+            drawerLayout = null;\n+        } else {\n+            bottomNavigationView.setVisibility(View.GONE);\n+            bottomNavigationView = null;\n+            setNavDrawerSize();\n+        }\n \n         // Consume navigation bar insets - we apply them in setPlayerVisible()\n         ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.main_view), (v, insets) -> {\n-            navigationBarInsets = insets.getInsets(WindowInsetsCompat.Type.navigationBars());\n+            systemBarInsets = insets.getInsets(WindowInsetsCompat.Type.systemBars());\n             updateInsets();\n             return new WindowInsetsCompat.Builder(insets)\n                     .setInsets(WindowInsetsCompat.Type.navigationBars(), Insets.NONE)\n@@ -320,28 +353,35 @@ public LockableBottomSheetBehavior getBottomSheet() {\n \n     private void updateInsets() {\n         setPlayerVisible(findViewById(R.id.audioplayerFragment).getVisibility() == View.VISIBLE);\n-        int playerHeight = (int) getResources().getDimension(R.dimen.external_player_height);\n-        sheetBehavior.setPeekHeight(playerHeight + navigationBarInsets.bottom);\n     }\n \n     public void setPlayerVisible(boolean visible) {\n         getBottomSheet().setLocked(!visible);\n+        findViewById(R.id.audioplayerFragment).setVisibility(visible ? View.VISIBLE : View.GONE);\n         if (visible) {\n             bottomSheetCallback.onStateChanged(null, getBottomSheet().getState()); // Update toolbar visibility\n         } else {\n             getBottomSheet().setState(BottomSheetBehavior.STATE_COLLAPSED);\n         }\n-        FragmentContainerView mainView = findViewById(R.id.main_view);\n-        ViewGroup.MarginLayoutParams params = (ViewGroup.MarginLayoutParams) mainView.getLayoutParams();\n+        View bottomPaddingView = findViewById(R.id.bottom_padding);\n+        ViewGroup.MarginLayoutParams params = (ViewGroup.MarginLayoutParams) bottomPaddingView.getLayoutParams();\n+        params.height = systemBarInsets.bottom;\n+        bottomPaddingView.setLayoutParams(params);\n+\n         int externalPlayerHeight = (int) getResources().getDimension(R.dimen.external_player_height);\n-        params.setMargins(navigationBarInsets.left, 0, navigationBarInsets.right,\n-                navigationBarInsets.bottom + (visible ? externalPlayerHeight : 0));\n+        FragmentContainerView mainView = findViewById(R.id.main_content_view);\n+        params = (ViewGroup.MarginLayoutParams) mainView.getLayoutParams();\n+        params.setMargins(systemBarInsets.left, 0, systemBarInsets.right, (visible ? externalPlayerHeight : 0));\n         mainView.setLayoutParams(params);\n+        sheetBehavior.setPeekHeight(externalPlayerHeight);\n+        sheetBehavior.setGestureInsetBottomIgnored(true);\n+\n         FragmentContainerView playerView = findViewById(R.id.playerFragment);\n         ViewGroup.MarginLayoutParams playerParams = (ViewGroup.MarginLayoutParams) playerView.getLayoutParams();\n-        playerParams.setMargins(navigationBarInsets.left, 0, navigationBarInsets.right, 0);\n+        playerParams.setMargins(systemBarInsets.left, 0, systemBarInsets.right, 0);\n         playerView.setLayoutParams(playerParams);\n-        findViewById(R.id.audioplayerFragment).setVisibility(visible ? View.VISIBLE : View.GONE);\n+        RelativeLayout playerContent = findViewById(R.id.playerContent);\n+        playerContent.setPadding(systemBarInsets.left, systemBarInsets.top, systemBarInsets.right, 0);\n     }\n \n     public RecyclerView.RecycledViewPool getRecycledViewPool() {\n@@ -393,6 +433,15 @@ public Fragment createFragmentInstance(String tag, Bundle args) {\n \n     public void loadFragment(String tag, Bundle args) {\n         NavDrawerFragment.saveLastNavFragment(this, tag);\n+        if (bottomNavigationView != null) {\n+            int bottomSelectedItem = NavigationNames.getBottomNavigationItemId(tag);\n+            if (bottomNavigationView.getMenu().findItem(bottomSelectedItem) == null) {\n+                bottomSelectedItem = R.id.bottom_navigation_more;\n+            }\n+            bottomNavigationView.setOnItemSelectedListener(null);\n+            bottomNavigationView.setSelectedItemId(bottomSelectedItem);\n+            bottomNavigationView.setOnItemSelectedListener(bottomItemSelectedListener);\n+        }\n         loadFragment(createFragmentInstance(tag, args));\n     }\n \n@@ -412,7 +461,7 @@ public void loadFragment(Fragment fragment) {\n             fragmentManager.popBackStack();\n         }\n         FragmentTransaction t = fragmentManager.beginTransaction();\n-        t.replace(R.id.main_view, fragment, MAIN_FRAGMENT_TAG);\n+        t.replace(R.id.main_content_view, fragment, MAIN_FRAGMENT_TAG);\n         fragmentManager.popBackStack();\n         // TODO: we have to allow state loss here\n         // since this function can get called from an AsyncTask which\n@@ -443,7 +492,7 @@ public void loadChildFragment(Fragment fragment, TransitionEffect transition) {\n \n         transaction\n                 .hide(getSupportFragmentManager().findFragmentByTag(MAIN_FRAGMENT_TAG))\n-                .add(R.id.main_view, fragment, MAIN_FRAGMENT_TAG)\n+                .add(R.id.main_content_view, fragment, MAIN_FRAGMENT_TAG)\n                 .addToBackStack(null)\n                 .commit();\n     }\n@@ -452,6 +501,85 @@ public void loadChildFragment(Fragment fragment) {\n         loadChildFragment(fragment, TransitionEffect.NONE);\n     }\n \n+    private void buildBottomNavigationMenu() {\n+        List<String> drawerItems = UserPreferences.getVisibleDrawerItemOrder();\n+        drawerItems.remove(NavListAdapter.SUBSCRIPTION_LIST_TAG);\n+\n+        Menu menu = bottomNavigationView.getMenu();\n+        menu.clear();\n+        for (int i = 0; i < drawerItems.size() && i < bottomNavigationView.getMaxItemCount() - 1; i++) {\n+            String tag = drawerItems.get(i);\n+            MenuItem item = menu.add(0, NavigationNames.getBottomNavigationItemId(tag),\n+                    0, getString(NavigationNames.getLabel(tag)));\n+            item.setIcon(NavigationNames.getDrawable(tag));\n+        }\n+        MenuItem moreItem = menu.add(0, R.id.bottom_navigation_more, 0, getString(R.string.searchpreference_more));\n+        moreItem.setIcon(R.drawable.dots_vertical);\n+        bottomNavigationView.setOnItemSelectedListener(bottomItemSelectedListener);\n+\n+        if (bottomNavigationView.getMenu().findItem(R.id.bottom_navigation_inbox) != null) {\n+            Observable.fromCallable(() -> DBReader.getTotalEpisodeCount(new FeedItemFilter(FeedItemFilter.NEW)))\n+                    .subscribeOn(Schedulers.io())\n+                    .observeOn(AndroidSchedulers.mainThread())\n+                    .subscribe(result ->\n+                            bottomNavigationView.getOrCreateBadge(R.id.bottom_navigation_inbox).setNumber(result),\n+                        error -> Log.e(TAG, Log.getStackTraceString(error)));\n+        }\n+    }\n+\n+    private final NavigationBarView.OnItemSelectedListener bottomItemSelectedListener = item -> {\n+        sheetBehavior.setState(BottomSheetBehavior.STATE_COLLAPSED);\n+        if (item.getItemId() == R.id.bottom_navigation_more) {\n+            showBottomNavigationMorePopup();\n+            return false;\n+        } else {\n+            loadFragment(NavigationNames.getBottomNavigationFragmentTag(item.getItemId()), null);\n+            return true;\n+        }\n+    };\n+\n+    private void showBottomNavigationMorePopup() {\n+        List<String> drawerItems = UserPreferences.getVisibleDrawerItemOrder();\n+        drawerItems.remove(NavListAdapter.SUBSCRIPTION_LIST_TAG);\n+\n+        final List<MenuItem> popupMenuItems = new ArrayList<>();\n+        for (int i = bottomNavigationView.getMaxItemCount() - 1; i < drawerItems.size(); i++) {\n+            String tag = drawerItems.get(i);\n+            MenuItem item = new MenuBuilder(this).add(0, NavigationNames.getBottomNavigationItemId(tag),\n+                    0, getString(NavigationNames.getLabel(tag)));\n+            item.setIcon(NavigationNames.getDrawable(tag));\n+            popupMenuItems.add(item);\n+        }\n+        MenuItem customizeItem = new MenuBuilder(this).add(0, R.id.bottom_navigation_settings,\n+                0, getString(R.string.pref_nav_drawer_items_title));\n+        customizeItem.setIcon(R.drawable.ic_pencil);\n+        popupMenuItems.add(customizeItem);\n+\n+        MenuItem settingsItem = new MenuBuilder(this).add(0, R.id.bottom_navigation_settings,\n+                0, getString(R.string.settings_label));\n+        settingsItem.setIcon(R.drawable.ic_settings);\n+        popupMenuItems.add(settingsItem);\n+\n+        final ListPopupWindow listPopupWindow = new ListPopupWindow(this);\n+        listPopupWindow.setWidth((int) (250 * getResources().getDisplayMetrics().density));\n+        listPopupWindow.setAnchorView(bottomNavigationView);\n+        listPopupWindow.setAdapter(new BottomNavigationMoreAdapter(this, popupMenuItems));\n+        listPopupWindow.setOnItemClickListener((parent, view, position, id) -> {\n+            if (position == popupMenuItems.size() - 1) {\n+                startActivity(new Intent(this, PreferenceActivity.class));\n+            } else if (position == popupMenuItems.size() - 2) {\n+                new DrawerPreferencesDialog(this, this::buildBottomNavigationMenu).show();\n+            } else {\n+                loadFragment(NavigationNames.getBottomNavigationFragmentTag(\n+                        popupMenuItems.get(position).getItemId()), null);\n+            }\n+            listPopupWindow.dismiss();\n+        });\n+        listPopupWindow.setDropDownGravity(Gravity.END | Gravity.BOTTOM);\n+        listPopupWindow.setModal(true);\n+        listPopupWindow.show();\n+    }\n+\n     @Override\n     protected void onPostCreate(Bundle savedInstanceState) {\n         super.onPostCreate(savedInstanceState);\n@@ -507,7 +635,9 @@ protected void onResume() {\n         super.onResume();\n         handleNavIntent();\n \n-        if (lastTheme != ThemeSwitcher.getNoTitleTheme(this)) {\n+        boolean hasBottomNavigation = bottomNavigationView != null;\n+        if (lastTheme != ThemeSwitcher.getNoTitleTheme(this)\n+                || hasBottomNavigation != UserPreferences.isBottomNavigationEnabled()) {\n             finish();\n             startActivity(new Intent(this, MainActivity.class));\n         }\n@@ -566,7 +696,7 @@ public void onBackPressed() {\n             String toPage = UserPreferences.getDefaultPage();\n             if (NavDrawerFragment.getLastNavFragment(this).equals(toPage)\n                     || UserPreferences.DEFAULT_PAGE_REMEMBER.equals(toPage)) {\n-                if (UserPreferences.backButtonOpensDrawer() && drawerLayout != null) {\n+                if (UserPreferences.backButtonOpensDrawer() && drawerLayout != null && bottomNavigationView == null) {\n                     drawerLayout.openDrawer(navDrawer);\n                 } else {\n                     super.onBackPressed();\n@@ -644,7 +774,7 @@ protected void onNewIntent(Intent intent) {\n     public Snackbar showSnackbarAbovePlayer(CharSequence text, int duration) {\n         Snackbar s;\n         if (getBottomSheet().getState() == BottomSheetBehavior.STATE_COLLAPSED) {\n-            s = Snackbar.make(findViewById(R.id.main_view), text, duration);\n+            s = Snackbar.make(findViewById(R.id.main_content_view), text, duration);\n             if (findViewById(R.id.audioplayerFragment).getVisibility() == View.VISIBLE) {\n                 s.setAnchorView(findViewById(R.id.audioplayerFragment));\n             }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/HorizontalItemViewHolder.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/HorizontalItemViewHolder.java\nindex c297725b0b2..d6942fdbd89 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/HorizontalItemViewHolder.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/HorizontalItemViewHolder.java\n@@ -8,7 +8,6 @@\n import android.widget.TextView;\n import androidx.cardview.widget.CardView;\n import androidx.recyclerview.widget.RecyclerView;\n-import com.google.android.material.elevation.SurfaceColors;\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n import de.danoeh.antennapod.ui.CoverLoader;\n@@ -56,8 +55,7 @@ public void bind(FeedItem item) {\n         this.item = item;\n \n         card.setAlpha(1.0f);\n-        float density = activity.getResources().getDisplayMetrics().density;\n-        card.setCardBackgroundColor(SurfaceColors.getColorForElevation(activity, 1 * density));\n+        card.setCardBackgroundColor(ThemeUtils.getColorFromAttr(activity, R.attr.colorSurfaceContainer));\n         new CoverLoader()\n                 .withUri(ImageResourceUtils.getEpisodeListImageLocation(item))\n                 .withFallbackUri(item.getFeed().getImageUrl())\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/drawer/BottomNavigationMoreAdapter.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/drawer/BottomNavigationMoreAdapter.java\nnew file mode 100644\nindex 00000000000..f0553f0a981\n--- /dev/null\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/drawer/BottomNavigationMoreAdapter.java\n@@ -0,0 +1,35 @@\n+package de.danoeh.antennapod.ui.screen.drawer;\n+\n+import android.content.Context;\n+import android.view.MenuItem;\n+import android.view.View;\n+import android.view.ViewGroup;\n+import android.widget.ArrayAdapter;\n+import android.widget.ImageView;\n+import android.widget.TextView;\n+import de.danoeh.antennapod.R;\n+\n+import java.util.List;\n+\n+public class BottomNavigationMoreAdapter extends ArrayAdapter<MenuItem> {\n+    private final Context context;\n+    private final List<MenuItem> listItems;\n+\n+    public BottomNavigationMoreAdapter(Context context, List<MenuItem> listItems) {\n+        super(context, R.layout.bottom_navigation_more_listitem, listItems);\n+        this.context = context;\n+        this.listItems = listItems;\n+    }\n+\n+    @Override\n+    public View getView(int position, View view, ViewGroup parent) {\n+        if (view == null) {\n+            view = View.inflate(context, R.layout.bottom_navigation_more_listitem, null);\n+        }\n+\n+        MenuItem item = listItems.get(position);\n+        ((ImageView) view.findViewById(R.id.coverImage)).setImageDrawable(item.getIcon());\n+        ((TextView) view.findViewById(R.id.titleLabel)).setText(item.getTitle());\n+        return view;\n+    }\n+}\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/drawer/DrawerPreferencesDialog.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/drawer/DrawerPreferencesDialog.java\nindex 12bf673f63a..d738d8c8ccf 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/drawer/DrawerPreferencesDialog.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/drawer/DrawerPreferencesDialog.java\n@@ -35,7 +35,7 @@ protected List<ReorderDialogItem> getInitialItems() {\n         final List<String> drawerItemOrder = UserPreferences.getVisibleDrawerItemOrder();\n         for (String tag : drawerItemOrder) {\n             settingsDialogItems.add(new ReorderDialogItem(ReorderDialogItem.ViewType.Section,\n-                    tag, context.getString(NavListAdapter.getLabel(tag))));\n+                    tag, context.getString(NavigationNames.getLabel(tag))));\n         }\n \n         settingsDialogItems.add(new ReorderDialogItem(ReorderDialogItem.ViewType.Header,\n@@ -44,7 +44,7 @@ protected List<ReorderDialogItem> getInitialItems() {\n         final List<String> hiddenDrawerItems = UserPreferences.getHiddenDrawerItems();\n         for (String sectionTag : hiddenDrawerItems) {\n             settingsDialogItems.add(new ReorderDialogItem(ReorderDialogItem.ViewType.Section,\n-                    sectionTag, context.getString(NavListAdapter.getLabel(sectionTag))));\n+                    sectionTag, context.getString(NavigationNames.getLabel(sectionTag))));\n         }\n         return settingsDialogItems;\n     }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/drawer/NavListAdapter.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/drawer/NavListAdapter.java\nindex a4ffb7566b2..7eaebcdc5a4 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/drawer/NavListAdapter.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/drawer/NavListAdapter.java\n@@ -14,7 +14,6 @@\n import android.widget.LinearLayout;\n import android.widget.RelativeLayout;\n import android.widget.TextView;\n-import androidx.annotation.DrawableRes;\n import androidx.annotation.NonNull;\n import androidx.annotation.StringRes;\n import androidx.preference.PreferenceManager;\n@@ -29,12 +28,8 @@\n import de.danoeh.antennapod.storage.database.NavDrawerData;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import de.danoeh.antennapod.ui.common.ImagePlaceholder;\n-import de.danoeh.antennapod.ui.screen.AddFeedFragment;\n-import de.danoeh.antennapod.ui.screen.AllEpisodesFragment;\n import de.danoeh.antennapod.ui.screen.InboxFragment;\n-import de.danoeh.antennapod.ui.screen.PlaybackHistoryFragment;\n import de.danoeh.antennapod.ui.screen.download.CompletedDownloadsFragment;\n-import de.danoeh.antennapod.ui.screen.home.HomeFragment;\n import de.danoeh.antennapod.ui.screen.preferences.PreferenceActivity;\n import de.danoeh.antennapod.ui.screen.queue.QueueFragment;\n import de.danoeh.antennapod.ui.screen.subscriptions.SubscriptionFragment;\n@@ -100,54 +95,6 @@ private void loadItems() {\n         notifyDataSetChanged();\n     }\n \n-    public static @StringRes int getLabel(String tag) {\n-        switch (tag) {\n-            case HomeFragment.TAG:\n-                return R.string.home_label;\n-            case QueueFragment.TAG:\n-                return R.string.queue_label;\n-            case InboxFragment.TAG:\n-                return R.string.inbox_label;\n-            case AllEpisodesFragment.TAG:\n-                return R.string.episodes_label;\n-            case SubscriptionFragment.TAG:\n-                return R.string.subscriptions_label;\n-            case CompletedDownloadsFragment.TAG:\n-                return R.string.downloads_label;\n-            case PlaybackHistoryFragment.TAG:\n-                return R.string.playback_history_label;\n-            case AddFeedFragment.TAG:\n-                return R.string.add_feed_label;\n-            case NavListAdapter.SUBSCRIPTION_LIST_TAG:\n-                return R.string.subscriptions_list_label;\n-            default:\n-                return 0;\n-        }\n-    }\n-\n-    private static @DrawableRes int getDrawable(String tag) {\n-        switch (tag) {\n-            case HomeFragment.TAG:\n-                return R.drawable.ic_home;\n-            case QueueFragment.TAG:\n-                return R.drawable.ic_playlist_play;\n-            case InboxFragment.TAG:\n-                return R.drawable.ic_inbox;\n-            case AllEpisodesFragment.TAG:\n-                return R.drawable.ic_feed;\n-            case CompletedDownloadsFragment.TAG:\n-                return R.drawable.ic_download;\n-            case PlaybackHistoryFragment.TAG:\n-                return R.drawable.ic_history;\n-            case SubscriptionFragment.TAG:\n-                return R.drawable.ic_subscriptions;\n-            case AddFeedFragment.TAG:\n-                return R.drawable.ic_add;\n-            default:\n-                return 0;\n-        }\n-    }\n-\n     public List<String> getFragmentTags() {\n         return Collections.unmodifiableList(fragmentTags);\n     }\n@@ -207,7 +154,7 @@ public void onBindViewHolder(@NonNull Holder holder, int position) {\n \n         holder.itemView.setOnCreateContextMenuListener(null);\n         if (viewType == VIEW_TYPE_NAV) {\n-            bindNavView(getLabel(fragmentTags.get(position)), position, (NavHolder) holder);\n+            bindNavView(NavigationNames.getLabel(fragmentTags.get(position)), position, (NavHolder) holder);\n         } else if (viewType == VIEW_TYPE_SECTION_DIVIDER) {\n             bindSectionDivider((DividerHolder) holder);\n         } else {\n@@ -292,7 +239,7 @@ private void bindNavView(@StringRes int title, int position, NavHolder holder) {\n             }\n         }\n \n-        holder.image.setImageResource(getDrawable(fragmentTags.get(position)));\n+        holder.image.setImageResource(NavigationNames.getDrawable(fragmentTags.get(position)));\n     }\n \n     private void bindSectionDivider(DividerHolder holder) {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/drawer/NavigationNames.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/drawer/NavigationNames.java\nnew file mode 100644\nindex 00000000000..18a2fbb6b42\n--- /dev/null\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/drawer/NavigationNames.java\n@@ -0,0 +1,106 @@\n+package de.danoeh.antennapod.ui.screen.drawer;\n+\n+import androidx.annotation.DrawableRes;\n+import androidx.annotation.StringRes;\n+import de.danoeh.antennapod.R;\n+import de.danoeh.antennapod.ui.screen.AddFeedFragment;\n+import de.danoeh.antennapod.ui.screen.AllEpisodesFragment;\n+import de.danoeh.antennapod.ui.screen.InboxFragment;\n+import de.danoeh.antennapod.ui.screen.PlaybackHistoryFragment;\n+import de.danoeh.antennapod.ui.screen.download.CompletedDownloadsFragment;\n+import de.danoeh.antennapod.ui.screen.home.HomeFragment;\n+import de.danoeh.antennapod.ui.screen.queue.QueueFragment;\n+import de.danoeh.antennapod.ui.screen.subscriptions.SubscriptionFragment;\n+\n+public abstract class NavigationNames {\n+    public static @DrawableRes int getDrawable(String tag) {\n+        switch (tag) {\n+            case HomeFragment.TAG:\n+                return R.drawable.ic_home;\n+            case QueueFragment.TAG:\n+                return R.drawable.ic_playlist_play;\n+            case InboxFragment.TAG:\n+                return R.drawable.ic_inbox;\n+            case AllEpisodesFragment.TAG:\n+                return R.drawable.ic_feed;\n+            case CompletedDownloadsFragment.TAG:\n+                return R.drawable.ic_download;\n+            case PlaybackHistoryFragment.TAG:\n+                return R.drawable.ic_history;\n+            case SubscriptionFragment.TAG:\n+                return R.drawable.ic_subscriptions;\n+            case AddFeedFragment.TAG:\n+                return R.drawable.ic_add;\n+            default:\n+                return 0;\n+        }\n+    }\n+\n+    public static @StringRes int getLabel(String tag) {\n+        switch (tag) {\n+            case HomeFragment.TAG:\n+                return R.string.home_label;\n+            case QueueFragment.TAG:\n+                return R.string.queue_label;\n+            case InboxFragment.TAG:\n+                return R.string.inbox_label;\n+            case AllEpisodesFragment.TAG:\n+                return R.string.episodes_label;\n+            case SubscriptionFragment.TAG:\n+                return R.string.subscriptions_label;\n+            case CompletedDownloadsFragment.TAG:\n+                return R.string.downloads_label;\n+            case PlaybackHistoryFragment.TAG:\n+                return R.string.playback_history_label;\n+            case AddFeedFragment.TAG:\n+                return R.string.add_feed_label;\n+            case NavListAdapter.SUBSCRIPTION_LIST_TAG:\n+                return R.string.subscriptions_list_label;\n+            default:\n+                return 0;\n+        }\n+    }\n+\n+    public static int getBottomNavigationItemId(String tag) {\n+        switch (tag) {\n+            case QueueFragment.TAG:\n+                return R.id.bottom_navigation_queue;\n+            case InboxFragment.TAG:\n+                return R.id.bottom_navigation_inbox;\n+            case AllEpisodesFragment.TAG:\n+                return R.id.bottom_navigation_episodes;\n+            case CompletedDownloadsFragment.TAG:\n+                return R.id.bottom_navigation_downloads;\n+            case PlaybackHistoryFragment.TAG:\n+                return R.id.bottom_navigation_history;\n+            case AddFeedFragment.TAG:\n+                return R.id.bottom_navigation_addfeed;\n+            case SubscriptionFragment.TAG:\n+                return R.id.bottom_navigation_subscriptions;\n+            case HomeFragment.TAG: // fall-through\n+            default:\n+                return R.id.bottom_navigation_home;\n+        }\n+    }\n+\n+    public static String getBottomNavigationFragmentTag(int id) {\n+        if (id == R.id.bottom_navigation_queue) {\n+            return QueueFragment.TAG;\n+        } else if (id == R.id.bottom_navigation_inbox) {\n+            return InboxFragment.TAG;\n+        } else if (id == R.id.bottom_navigation_episodes) {\n+            return AllEpisodesFragment.TAG;\n+        } else if (id == R.id.bottom_navigation_downloads) {\n+            return CompletedDownloadsFragment.TAG;\n+        } else if (id == R.id.bottom_navigation_history) {\n+            return PlaybackHistoryFragment.TAG;\n+        } else if (id == R.id.bottom_navigation_addfeed) {\n+            return AddFeedFragment.TAG;\n+        } else if (id == R.id.bottom_navigation_subscriptions) {\n+            return SubscriptionFragment.TAG;\n+        } else if (id == R.id.bottom_navigation_home) {\n+            return HomeFragment.TAG;\n+        }\n+        return null;\n+    }\n+}\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java\nindex 634f1ecfe3d..5b561bd305c 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java\n@@ -23,7 +23,6 @@\n \n import com.google.android.material.appbar.MaterialToolbar;\n import com.google.android.material.bottomsheet.BottomSheetBehavior;\n-import com.google.android.material.elevation.SurfaceColors;\n \n import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.playback.service.PlaybackController;\n@@ -121,8 +120,6 @@ public View onCreateView(@NonNull LayoutInflater inflater,\n         getChildFragmentManager().beginTransaction()\n                 .replace(R.id.playerFragment, externalPlayerFragment, ExternalPlayerFragment.TAG)\n                 .commit();\n-        root.findViewById(R.id.playerFragment).setBackgroundColor(\n-                SurfaceColors.getColorForElevation(getContext(), 8 * getResources().getDisplayMetrics().density));\n \n         butPlaybackSpeed = root.findViewById(R.id.butPlaybackSpeed);\n         txtvPlaybackSpeed = root.findViewById(R.id.txtvPlaybackSpeed);\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/view/LiftOnScrollListener.java b/app/src/main/java/de/danoeh/antennapod/ui/view/LiftOnScrollListener.java\nindex e046dd43ec9..d328f77ed13 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/view/LiftOnScrollListener.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/view/LiftOnScrollListener.java\n@@ -6,6 +6,8 @@\n import androidx.core.widget.NestedScrollView;\n import androidx.recyclerview.widget.LinearLayoutManager;\n import androidx.recyclerview.widget.RecyclerView;\n+import de.danoeh.antennapod.R;\n+import de.danoeh.antennapod.ui.common.ThemeUtils;\n \n /**\n  * Workaround for app:liftOnScroll flickering when in SwipeRefreshLayout\n@@ -16,8 +18,9 @@ public class LiftOnScrollListener extends RecyclerView.OnScrollListener\n     private boolean animatingToScrolled = false;\n \n     public LiftOnScrollListener(View appBar) {\n-        animator = ValueAnimator.ofFloat(0, appBar.getContext().getResources().getDisplayMetrics().density * 8);\n-        animator.addUpdateListener(animation -> appBar.setElevation((float) animation.getAnimatedValue()));\n+        int colorLifted = ThemeUtils.getColorFromAttr(appBar.getContext(), R.attr.colorSurfaceContainer);\n+        animator = ValueAnimator.ofArgb(colorLifted & 0x00ffffff, colorLifted);\n+        animator.addUpdateListener(animation -> appBar.setBackgroundColor((int) animation.getAnimatedValue()));\n     }\n \n     @Override\ndiff --git a/app/src/main/res/layout-sw720dp/main.xml b/app/src/main/res/layout-sw720dp/main.xml\nindex e8edc260f57..a9984916ed7 100644\n--- a/app/src/main/res/layout-sw720dp/main.xml\n+++ b/app/src/main/res/layout-sw720dp/main.xml\n@@ -3,45 +3,66 @@\n     xmlns:android=\"http://schemas.android.com/apk/res/android\"\n     xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n     xmlns:tools=\"http://schemas.android.com/tools\"\n+    android:id=\"@+id/main_view\"\n     android:layout_width=\"match_parent\"\n     android:layout_height=\"match_parent\"\n-    android:orientation=\"horizontal\"\n+    android:orientation=\"vertical\"\n     tools:viewBindingIgnore=\"true\">\n \n-    <androidx.fragment.app.FragmentContainerView\n-        android:id=\"@+id/navDrawerFragment\"\n-        android:layout_width=\"300dp\"\n-        android:layout_height=\"match_parent\"\n-        android:layout_gravity=\"start\"\n-        android:orientation=\"vertical\" />\n-\n-    <View\n-        android:layout_width=\"1dp\"\n-        android:layout_height=\"match_parent\"\n-        android:background=\"?android:attr/listDivider\" />\n-\n-    <androidx.coordinatorlayout.widget.CoordinatorLayout\n-        android:id=\"@+id/overview_coordinator_layout\"\n+    <LinearLayout\n         android:layout_width=\"match_parent\"\n-        android:layout_height=\"match_parent\">\n+        android:layout_height=\"0dp\"\n+        android:orientation=\"horizontal\"\n+        android:layout_weight=\"1\">\n \n         <androidx.fragment.app.FragmentContainerView\n-            android:id=\"@+id/main_view\"\n-            android:layout_width=\"match_parent\"\n+            android:id=\"@+id/navDrawerFragment\"\n+            android:layout_width=\"300dp\"\n             android:layout_height=\"match_parent\"\n-            android:layout_alignParentTop=\"true\"\n-            android:foreground=\"?android:windowContentOverlay\"\n-            tools:background=\"@android:color/holo_red_dark\" />\n+            android:layout_gravity=\"start\"\n+            android:orientation=\"vertical\" />\n \n-        <androidx.fragment.app.FragmentContainerView\n-            android:id=\"@+id/audioplayerFragment\"\n-            android:layout_width=\"match_parent\"\n+        <View\n+            android:layout_width=\"1dp\"\n             android:layout_height=\"match_parent\"\n-            android:background=\"?android:attr/colorBackground\"\n-            android:elevation=\"8dp\"\n-            android:visibility=\"gone\"\n-            app:layout_behavior=\"de.danoeh.antennapod.ui.view.LockableBottomSheetBehavior\" />\n+            android:background=\"?android:attr/listDivider\" />\n+\n+        <androidx.coordinatorlayout.widget.CoordinatorLayout\n+            android:id=\"@+id/overview_coordinator_layout\"\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"match_parent\">\n \n-    </androidx.coordinatorlayout.widget.CoordinatorLayout>\n+            <androidx.fragment.app.FragmentContainerView\n+                android:id=\"@+id/main_content_view\"\n+                android:layout_width=\"match_parent\"\n+                android:layout_height=\"match_parent\"\n+                android:layout_alignParentTop=\"true\"\n+                android:foreground=\"?android:windowContentOverlay\"\n+                tools:background=\"@android:color/holo_red_dark\" />\n+\n+            <androidx.fragment.app.FragmentContainerView\n+                android:id=\"@+id/audioplayerFragment\"\n+                android:layout_width=\"match_parent\"\n+                android:layout_height=\"match_parent\"\n+                android:background=\"?android:attr/colorBackground\"\n+                android:elevation=\"8dp\"\n+                android:visibility=\"gone\"\n+                app:layout_behavior=\"de.danoeh.antennapod.ui.view.LockableBottomSheetBehavior\" />\n+\n+        </androidx.coordinatorlayout.widget.CoordinatorLayout>\n+\n+    </LinearLayout>\n+\n+    <com.google.android.material.bottomnavigation.BottomNavigationView\n+        android:id=\"@+id/bottomNavigationView\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        app:labelVisibilityMode=\"labeled\" />\n+\n+    <View\n+        android:id=\"@+id/bottom_padding\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"0dp\"\n+        android:background=\"?attr/colorSurfaceContainer\" />\n \n </LinearLayout>\ndiff --git a/app/src/main/res/layout/addfeed.xml b/app/src/main/res/layout/addfeed.xml\nindex bc42aba0534..15e44f2f9cf 100644\n--- a/app/src/main/res/layout/addfeed.xml\n+++ b/app/src/main/res/layout/addfeed.xml\n@@ -41,6 +41,7 @@\n                 android:layout_width=\"match_parent\"\n                 android:layout_height=\"56dp\"\n                 android:layout_marginTop=\"8dp\"\n+                android:layout_marginBottom=\"8dp\"\n                 app:cardCornerRadius=\"28dp\"\n                 app:cardElevation=\"0dp\">\n \n@@ -49,7 +50,7 @@\n                     android:layout_width=\"match_parent\"\n                     android:layout_height=\"wrap_content\"\n                     android:orientation=\"horizontal\"\n-                    android:background=\"?attr/colorPrimaryContainer\">\n+                    android:background=\"?attr/colorSurfaceContainer\">\n \n                     <ImageView\n                         android:id=\"@+id/searchButton\"\ndiff --git a/app/src/main/res/layout/audioplayer_fragment.xml b/app/src/main/res/layout/audioplayer_fragment.xml\nindex db109bbd38e..3c52daa944b 100644\n--- a/app/src/main/res/layout/audioplayer_fragment.xml\n+++ b/app/src/main/res/layout/audioplayer_fragment.xml\n@@ -13,12 +13,13 @@\n         android:layout_gravity=\"top\"\n         android:elevation=\"8dp\"\n         android:outlineProvider=\"none\"\n+        android:background=\"?attr/colorSurfaceContainer\"\n         tools:layout_height=\"@dimen/external_player_height\" />\n \n     <RelativeLayout\n+        android:id=\"@+id/playerContent\"\n         android:layout_width=\"match_parent\"\n-        android:layout_height=\"match_parent\"\n-        android:fitsSystemWindows=\"true\">\n+        android:layout_height=\"match_parent\">\n \n         <com.google.android.material.appbar.MaterialToolbar\n             android:id=\"@+id/toolbar\"\ndiff --git a/app/src/main/res/layout/bottom_navigation_more_listitem.xml b/app/src/main/res/layout/bottom_navigation_more_listitem.xml\nnew file mode 100644\nindex 00000000000..e85ecfce131\n--- /dev/null\n+++ b/app/src/main/res/layout/bottom_navigation_more_listitem.xml\n@@ -0,0 +1,33 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<LinearLayout\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:tools=\"http://schemas.android.com/tools\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"wrap_content\"\n+    android:orientation=\"horizontal\"\n+    android:paddingHorizontal=\"16dp\"\n+    android:paddingVertical=\"4dp\">\n+\n+    <ImageView\n+        android:id=\"@+id/coverImage\"\n+        android:layout_width=\"@dimen/thumbnail_length_navlist\"\n+        android:layout_height=\"@dimen/thumbnail_length_navlist\"\n+        android:importantForAccessibility=\"no\"\n+        android:layout_marginEnd=\"16dp\"\n+        android:layout_marginRight=\"16dp\"\n+        android:scaleType=\"centerInside\"\n+        tools:src=\"@drawable/ic_download_black\" />\n+\n+    <TextView\n+        android:id=\"@+id/titleLabel\"\n+        android:layout_width=\"wrap_content\"\n+        android:layout_height=\"wrap_content\"\n+        android:layout_gravity=\"center_vertical\"\n+        android:ellipsize=\"end\"\n+        android:lines=\"1\"\n+        android:singleLine=\"true\"\n+        android:textColor=\"?android:attr/textColorPrimary\"\n+        android:textSize=\"@dimen/text_size_navdrawer\"\n+        tools:text=\"Navigation item title\" />\n+\n+</LinearLayout>\ndiff --git a/app/src/main/res/layout/horizontal_itemlist_item.xml b/app/src/main/res/layout/horizontal_itemlist_item.xml\nindex 33840964763..edbf7b7246c 100644\n--- a/app/src/main/res/layout/horizontal_itemlist_item.xml\n+++ b/app/src/main/res/layout/horizontal_itemlist_item.xml\n@@ -6,8 +6,7 @@\n     xmlns:tools=\"http://schemas.android.com/tools\"\n     android:layout_width=\"wrap_content\"\n     android:layout_height=\"wrap_content\"\n-    android:clipToPadding=\"false\"\n-    android:padding=\"4dp\">\n+    android:clipToPadding=\"false\">\n \n     <androidx.cardview.widget.CardView\n         android:id=\"@+id/card\"\n@@ -15,8 +14,10 @@\n         android:layout_height=\"wrap_content\"\n         android:clickable=\"true\"\n         android:foreground=\"?android:attr/selectableItemBackground\"\n+        android:layout_margin=\"4dp\"\n+        app:cardBackgroundColor=\"?attr/colorSurfaceContainer\"\n         app:cardCornerRadius=\"12dp\"\n-        app:cardElevation=\"0dp\">\n+        app:cardElevation=\"1dp\">\n \n         <LinearLayout\n             android:layout_width=\"match_parent\"\ndiff --git a/app/src/main/res/layout/main.xml b/app/src/main/res/layout/main.xml\nindex e205707d542..1249eeaca33 100644\n--- a/app/src/main/res/layout/main.xml\n+++ b/app/src/main/res/layout/main.xml\n@@ -1,46 +1,68 @@\n <?xml version=\"1.0\" encoding=\"utf-8\"?>\n-<androidx.drawerlayout.widget.DrawerLayout\n+<LinearLayout\n     xmlns:android=\"http://schemas.android.com/apk/res/android\"\n     xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n     xmlns:tools=\"http://schemas.android.com/tools\"\n-    android:id=\"@+id/drawer_layout\"\n+    android:id=\"@+id/main_view\"\n     android:layout_width=\"match_parent\"\n     android:layout_height=\"match_parent\"\n+    android:orientation=\"vertical\"\n     tools:ignore=\"InconsistentLayout\"\n     tools:viewBindingIgnore=\"true\">\n \n     <!-- InconsistentLayout: Tablet layout does not have a drawer -->\n     <!-- viewBindingIgnore: Configurations for main.xml must\n             agree on the root element's ID -->\n-    <androidx.coordinatorlayout.widget.CoordinatorLayout\n-        android:id=\"@+id/overview_coordinator_layout\"\n+    <androidx.drawerlayout.widget.DrawerLayout\n+        android:id=\"@+id/drawer_layout\"\n         android:layout_width=\"match_parent\"\n-        android:layout_height=\"match_parent\">\n+        android:layout_height=\"0dp\"\n+        android:layout_weight=\"1\">\n \n-        <androidx.fragment.app.FragmentContainerView\n-            android:id=\"@+id/main_view\"\n+        <androidx.coordinatorlayout.widget.CoordinatorLayout\n+            android:id=\"@+id/overview_coordinator_layout\"\n             android:layout_width=\"match_parent\"\n-            android:layout_height=\"match_parent\"\n-            android:layout_alignParentTop=\"true\"\n-            android:foreground=\"?android:windowContentOverlay\"\n-            tools:background=\"@android:color/holo_red_dark\" />\n+            android:layout_height=\"match_parent\">\n+\n+            <androidx.fragment.app.FragmentContainerView\n+                android:id=\"@+id/main_content_view\"\n+                android:layout_width=\"match_parent\"\n+                android:layout_height=\"match_parent\"\n+                android:layout_alignParentTop=\"true\"\n+                android:foreground=\"?android:windowContentOverlay\"\n+                tools:background=\"@android:color/holo_red_dark\" />\n+\n+            <androidx.fragment.app.FragmentContainerView\n+                android:id=\"@+id/audioplayerFragment\"\n+                android:layout_width=\"match_parent\"\n+                android:layout_height=\"match_parent\"\n+                android:background=\"?android:attr/colorBackground\"\n+                android:elevation=\"8dp\"\n+                android:visibility=\"gone\"\n+                android:fitsSystemWindows=\"false\"\n+                app:layout_behavior=\"de.danoeh.antennapod.ui.view.LockableBottomSheetBehavior\" />\n+\n+        </androidx.coordinatorlayout.widget.CoordinatorLayout>\n \n         <androidx.fragment.app.FragmentContainerView\n-            android:id=\"@+id/audioplayerFragment\"\n+            android:id=\"@+id/navDrawerFragment\"\n             android:layout_width=\"match_parent\"\n             android:layout_height=\"match_parent\"\n-            android:background=\"?android:attr/colorBackground\"\n-            android:elevation=\"8dp\"\n-            android:visibility=\"gone\"\n-            app:layout_behavior=\"de.danoeh.antennapod.ui.view.LockableBottomSheetBehavior\" />\n+            android:layout_gravity=\"start\"\n+            android:orientation=\"vertical\" />\n+\n+    </androidx.drawerlayout.widget.DrawerLayout>\n \n-    </androidx.coordinatorlayout.widget.CoordinatorLayout>\n+    <com.google.android.material.bottomnavigation.BottomNavigationView\n+        android:id=\"@+id/bottomNavigationView\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        app:labelVisibilityMode=\"labeled\" />\n \n-    <androidx.fragment.app.FragmentContainerView\n-        android:id=\"@+id/navDrawerFragment\"\n+    <View\n+        android:id=\"@+id/bottom_padding\"\n         android:layout_width=\"match_parent\"\n-        android:layout_height=\"match_parent\"\n-        android:layout_gravity=\"start\"\n-        android:orientation=\"vertical\" />\n+        android:layout_height=\"0dp\"\n+        android:background=\"?attr/colorSurfaceContainer\" />\n \n-</androidx.drawerlayout.widget.DrawerLayout>\n+</LinearLayout>\ndiff --git a/app/src/main/res/values/ids.xml b/app/src/main/res/values/ids.xml\nindex 545e79da760..bdcbd6c0b2f 100644\n--- a/app/src/main/res/values/ids.xml\n+++ b/app/src/main/res/values/ids.xml\n@@ -17,4 +17,16 @@\n     <item name=\"view_type_subscription_grid_with_title\" type=\"id\"/>\n     <item name=\"view_type_subscription_grid_without_title\" type=\"id\"/>\n     <item name=\"view_type_subscription_list\" type=\"id\"/>\n+\n+    <!-- Bottom navigation -->\n+    <item name=\"bottom_navigation_home\" type=\"id\"/>\n+    <item name=\"bottom_navigation_queue\" type=\"id\"/>\n+    <item name=\"bottom_navigation_inbox\" type=\"id\"/>\n+    <item name=\"bottom_navigation_episodes\" type=\"id\"/>\n+    <item name=\"bottom_navigation_downloads\" type=\"id\"/>\n+    <item name=\"bottom_navigation_history\" type=\"id\"/>\n+    <item name=\"bottom_navigation_addfeed\" type=\"id\"/>\n+    <item name=\"bottom_navigation_subscriptions\" type=\"id\"/>\n+    <item name=\"bottom_navigation_more\" type=\"id\"/>\n+    <item name=\"bottom_navigation_settings\" type=\"id\"/>\n </resources>\ndiff --git a/build.gradle b/build.gradle\nindex 1e9c6e94612..69b9f85644f 100644\n--- a/build.gradle\n+++ b/build.gradle\n@@ -21,7 +21,7 @@ project.ext {\n     recyclerViewVersion = \"1.2.1\"\n     viewPager2Version = \"1.1.0-beta01\"\n     workManagerVersion = \"2.7.1\"\n-    googleMaterialVersion = \"1.7.0\"\n+    googleMaterialVersion = \"1.12.0\"\n \n     // Third-party\n     commonslangVersion = \"3.6\"\ndiff --git a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\nindex 771ad56328a..608998c0071 100644\n--- a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n+++ b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n@@ -62,6 +62,7 @@ public abstract class UserPreferences {\n     public static final String PREF_FILTER_FEED = \"prefSubscriptionsFilter\";\n     public static final String PREF_SUBSCRIPTION_TITLE = \"prefSubscriptionTitle\";\n     public static final String PREF_BACK_OPENS_DRAWER = \"prefBackButtonOpensDrawer\";\n+    public static final String PREF_BOTTOM_NAVIGATION = \"prefBottomNavigation\";\n \n     public static final String PREF_QUEUE_KEEP_SORTED = \"prefQueueKeepSorted\";\n     public static final String PREF_QUEUE_KEEP_SORTED_ORDER = \"prefQueueKeepSortedOrder\";\n@@ -758,6 +759,14 @@ public static boolean backButtonOpensDrawer() {\n         return prefs.getBoolean(PREF_BACK_OPENS_DRAWER, false);\n     }\n \n+    public static boolean isBottomNavigationEnabled() {\n+        return prefs.getBoolean(PREF_BOTTOM_NAVIGATION, false);\n+    }\n+\n+    public static void setBottomNavigationEnabled(boolean enabled) {\n+        prefs.edit().putBoolean(PREF_BOTTOM_NAVIGATION, enabled).apply();\n+    }\n+\n     public static boolean timeRespectsSpeed() {\n         return prefs.getBoolean(PREF_TIME_RESPECTS_SPEED, false);\n     }\ndiff --git a/ui/common/src/main/res/drawable/dots_vertical.xml b/ui/common/src/main/res/drawable/dots_vertical.xml\nnew file mode 100644\nindex 00000000000..4848dde4ef9\n--- /dev/null\n+++ b/ui/common/src/main/res/drawable/dots_vertical.xml\n@@ -0,0 +1,13 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<vector\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    android:height=\"24dp\"\n+    android:width=\"24dp\"\n+    android:viewportWidth=\"24\"\n+    android:viewportHeight=\"24\">\n+\n+    <path\n+        android:fillColor=\"#000000\"\n+        android:pathData=\"M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z\" />\n+\n+</vector>\ndiff --git a/ui/common/src/main/res/drawable/ic_pencil.xml b/ui/common/src/main/res/drawable/ic_pencil.xml\nnew file mode 100644\nindex 00000000000..5a4838da747\n--- /dev/null\n+++ b/ui/common/src/main/res/drawable/ic_pencil.xml\n@@ -0,0 +1,13 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<vector\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    android:height=\"24dp\"\n+    android:width=\"24dp\"\n+    android:viewportWidth=\"24\"\n+    android:viewportHeight=\"24\">\n+\n+    <path\n+        android:fillColor=\"?attr/action_icon_color\"\n+        android:pathData=\"M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z\" />\n+\n+</vector>\ndiff --git a/ui/common/src/main/res/values-v23/styles.xml b/ui/common/src/main/res/values-v23/styles.xml\nindex 95740f648e9..9475596dc06 100644\n--- a/ui/common/src/main/res/values-v23/styles.xml\n+++ b/ui/common/src/main/res/values-v23/styles.xml\n@@ -3,7 +3,5 @@\n     <style name=\"Theme.AntennaPod.Dynamic.Light\" parent=\"Theme.Base.AntennaPod.Dynamic.Light\">\n         <item name=\"android:statusBarColor\">@android:color/transparent</item>\n         <item name=\"android:windowLightStatusBar\">true</item>\n-        <!-- To make icons visible -->\n-        <item name=\"android:navigationBarColor\">@color/grey600</item>\n     </style>\n </resources>\ndiff --git a/ui/common/src/main/res/values-v27/styles.xml b/ui/common/src/main/res/values-v27/styles.xml\nindex df4d786be19..1266e901fa0 100644\n--- a/ui/common/src/main/res/values-v27/styles.xml\n+++ b/ui/common/src/main/res/values-v27/styles.xml\n@@ -3,8 +3,6 @@\n     <style name=\"Theme.AntennaPod.Dynamic.Light\" parent=\"Theme.Base.AntennaPod.Dynamic.Light\">\n         <item name=\"android:statusBarColor\">@android:color/transparent</item>\n         <item name=\"android:windowLightStatusBar\">true</item>\n-        <item name=\"android:navigationBarColor\">@color/background_light</item>\n-        <item name=\"android:navigationBarDividerColor\">@color/navigation_bar_divider_light</item>\n         <item name=\"android:windowLightNavigationBar\">true</item>\n     </style>\n </resources>\ndiff --git a/ui/common/src/main/res/values/colors.xml b/ui/common/src/main/res/values/colors.xml\nindex 55ba650e781..e3a3e1451c2 100644\n--- a/ui/common/src/main/res/values/colors.xml\n+++ b/ui/common/src/main/res/values/colors.xml\n@@ -11,14 +11,13 @@\n     <color name=\"feed_text_bg\">#55333333</color>\n \n     <!-- Theme colors -->\n-    <color name=\"background_light\">#FFFFFF</color>\n+    <color name=\"background_light\">#f9fcff</color>\n     <color name=\"background_elevated_light\">#EFEEEE</color>\n     <color name=\"background_darktheme\">#21272b</color>\n     <color name=\"background_elevated_darktheme\">#2D3337</color>\n     <color name=\"non_square_icon_background\">#22777777</color>\n     <color name=\"seek_background_light\">#90000000</color>\n     <color name=\"seek_background_dark\">#905B5B5B</color>\n-    <color name=\"navigation_bar_divider_light\">#1F000000</color>\n \n     <color name=\"accent_light\">#0078C2</color>\n     <color name=\"accent_dark\">#3D8BFF</color>\ndiff --git a/ui/common/src/main/res/values/styles.xml b/ui/common/src/main/res/values/styles.xml\nindex 2cf3b39972b..f2c9a1e2709 100644\n--- a/ui/common/src/main/res/values/styles.xml\n+++ b/ui/common/src/main/res/values/styles.xml\n@@ -27,6 +27,7 @@\n         <item name=\"android:splitMotionEvents\">false</item>\n         <item name=\"android:fitsSystemWindows\">false</item>\n         <item name=\"android:windowContentTransitions\">true</item>\n+        <item name=\"android:navigationBarColor\">@android:color/transparent</item>\n         <item name=\"toolbarStyle\">@style/Style.AntennaPod.Toolbar</item>\n         <item name=\"preferenceTheme\">@style/AppPreferenceThemeOverlay</item>\n     </style>\n@@ -44,6 +45,8 @@\n         <item name=\"android:colorBackground\">@color/background_light</item>\n         <item name=\"colorSurface\">@color/background_light</item>\n         <item name=\"colorSurfaceVariant\">#D3DCE0</item>\n+        <item name=\"colorSurfaceContainer\">#EBEEF3</item>\n+        <item name=\"colorSecondaryContainer\">#D3DCE0</item>\n     </style>\n \n     <style name=\"Theme.AntennaPod.Dynamic.Dark\" parent=\"Theme.Base.AntennaPod.Dynamic.Dark\">\n@@ -70,7 +73,7 @@\n         <item name=\"android:statusBarColor\">@android:color/transparent</item>\n         <item name=\"android:windowLightStatusBar\" tools:targetApi=\"m\">false</item>\n         <item name=\"android:windowContentTransitions\">true</item>\n-        <item name=\"android:navigationBarColor\">@color/background_darktheme</item>\n+        <item name=\"android:navigationBarColor\">@android:color/transparent</item>\n         <item name=\"toolbarStyle\">@style/Style.AntennaPod.Toolbar</item>\n         <item name=\"preferenceTheme\">@style/AppPreferenceThemeOverlay</item>\n     </style>\n@@ -88,6 +91,8 @@\n         <item name=\"android:colorBackground\">@color/background_darktheme</item>\n         <item name=\"colorSurface\">@color/background_darktheme</item>\n         <item name=\"colorSurfaceVariant\">#2F3B4F</item>\n+        <item name=\"colorSurfaceContainer\">#1C2024</item>\n+        <item name=\"colorSecondaryContainer\">#2F3B4F</item>\n     </style>\n \n     <style name=\"Theme.AntennaPod.Dynamic.TrueBlack\" parent=\"Theme.AntennaPod.Dynamic.Dark\">\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 0f394c792bb..89f6269d39c 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -450,8 +450,10 @@\n     <string name=\"pref_black_theme_message\">Use full black for the dark theme</string>\n     <string name=\"pref_tinted_theme_title\">Dynamic colors</string>\n     <string name=\"pref_tinted_theme_message\">Adapt app colors based on the wallpaper</string>\n-    <string name=\"pref_nav_drawer_items_title\">Set navigation drawer items</string>\n-    <string name=\"pref_nav_drawer_items_sum\">Change which items appear in the navigation drawer</string>\n+    <string name=\"bottom_navigation\">Bottom navigation</string>\n+    <string name=\"bottom_navigation_summary\">Beta feature: Access the most important screens from everywhere, in a single tap</string>\n+    <string name=\"pref_nav_drawer_items_title\">Customize navigation</string>\n+    <string name=\"pref_nav_drawer_items_sum\">Change which items appear in the navigation drawer or bottom navigation</string>\n     <string name=\"pref_nav_drawer_feed_order_title\">Set subscription order</string>\n     <string name=\"pref_nav_drawer_feed_order_sum\">Change the order of your subscriptions</string>\n     <string name=\"pref_nav_drawer_feed_counter_title\">Set subscription counter</string>\ndiff --git a/ui/preferences/src/main/res/xml/preferences_user_interface.xml b/ui/preferences/src/main/res/xml/preferences_user_interface.xml\nindex f61447b7776..1b3aad4765d 100644\n--- a/ui/preferences/src/main/res/xml/preferences_user_interface.xml\n+++ b/ui/preferences/src/main/res/xml/preferences_user_interface.xml\n@@ -80,10 +80,14 @@\n                 android:title=\"@string/pref_default_page\"\n                 android:summary=\"@string/pref_default_page_sum\"\n                 android:defaultValue=\"HomeFragment\"/>\n+        <SwitchPreferenceCompat\n+                android:title=\"@string/bottom_navigation\"\n+                android:summary=\"@string/bottom_navigation_summary\"\n+                android:key=\"prefBottomNavigation\" />\n         <Preference\n-            android:key=\"prefHiddenDrawerItems\"\n-            android:summary=\"@string/pref_nav_drawer_items_sum\"\n-            android:title=\"@string/pref_nav_drawer_items_title\"/>\n+                android:key=\"prefHiddenDrawerItems\"\n+                android:summary=\"@string/pref_nav_drawer_items_sum\"\n+                android:title=\"@string/pref_nav_drawer_items_title\"/>\n         <SwitchPreferenceCompat\n                 android:key=\"prefBackButtonOpensDrawer\"\n                 android:title=\"@string/pref_back_button_opens_drawer\"\n", "test_patch": "diff --git a/app/src/androidTest/java/de/test/antennapod/ui/NavigationDrawerTest.java b/app/src/androidTest/java/de/test/antennapod/ui/NavigationDrawerTest.java\nindex 57385f62a16..d9e1db18d61 100644\n--- a/app/src/androidTest/java/de/test/antennapod/ui/NavigationDrawerTest.java\n+++ b/app/src/androidTest/java/de/test/antennapod/ui/NavigationDrawerTest.java\n@@ -52,6 +52,7 @@ public void setUp() throws IOException {\n \n         EspressoTestUtils.clearPreferences();\n         EspressoTestUtils.clearDatabase();\n+        UserPreferences.setBottomNavigationEnabled(false);\n     }\n \n     @After\n", "problem_statement": "Bottom navigation\n# Checklist\r\n<!-- Place an x in the boxes to tick them: [x] -->\r\n\r\n- [x] I have used the search function to see if someone else has already submitted the same feature request.\r\n- [x] I will only create one feature request per issue.\r\n- [x] I will describe the problem with as much detail as possible.\r\n\r\n# System info\r\n\r\n**App version**: 2.0.0 RC7\r\n\r\n# Feature description\r\n\r\nWith the new interface standards on iOS and Android, bottom navigation bars are becoming common. It would be a good idea to place the common functions - Subscriptions, Episodes, Downloads, Playback History and Queue in the bottom navigation bar for faster access and less swipes/taps. \r\n\r\n---\r\n\r\n**[EDIT BY PROJECT MEMBER]**\r\nTo anyone interested in working on this: for implementation notes agreed upon by the team (through various calls) please [see this comment](https://github.com/AntennaPod/AntennaPod/issues/4376#issuecomment-1215145107).\n", "hints_text": "I am willing to give this a shot, if you would assign it to me.\nThis change needs some more discussion because it completely changes the way users interact with th app.\r\n\r\n@BeSanidhya If you want to help, I suggest to start with something labelled \"good first issue\". Those are self-contained and do not need discussion. Just leave a comment when you have started working on an issue - no need for assigning.\nThank you @icubyx for bringing this up. I just start using a Fairphone 3,which has a screen so big I can't easily reach the top(left). Moving things around could be a nice improvement for such devices. Firefox already implemented this.\n\nHowever, it wouldn't be enough to simply move the main menu items in a bottom bar - items like 'back' and 'filter' would still be hard to reach in the top bar. So to do it properly, I think we would need to revisit the whole navigation. This would indeed require quite some discussions, and probably also the involvement of a UI expert (we could ask folks of OpenSourceDesign again). (And, perhaps needless to say, this would be an 'experimental' feature, requiring an extra setting.)\n\nFor a start, we might create a thread on the forum to discuss ideas and collect other apps that have such bottom navigation. @icubyx, would you be interested in starting that thread?\n@keunes yes it will need just more than the icons at the bottom. As a UX designer, I can work on this unless @BeSanidhya has already started.\nUsers really do not like change. Especially if it changes their muscle memory. When developing version 2.0.0, I paid attention on the fact that everything still feels the same even if it looks a bit different. This proposal sounds like a pretty massive UI change. I fear that a big change like this could easily upset users. While 2.0.0 is not yet released, something like this change would then be version 3.0.0\n@ByteHamster I agree with you that we cannot make an abrupt change - it will need to be gradual. Having said that, most popular podcast readers that I checked have icons at the bottom. So if we are considering adoption, these adopters will be comfortable with this change. we can start with icons at the bottom and introduce more changes gradually. \n@icubyx Ah, a UX designer - that's great :) If I interpreted correctly, @BeSanidhya proposed to work on the code, so feel free to start a discussion on the forum.\r\n\r\n> Users really do not like change. Especially if it changes their muscle memory. When developing version 2.0.0, I paid attention on the fact that everything still feels the same even if it looks a bit different. This proposal sounds like a pretty massive UI change. I fear that a big change like this could easily upset users. While 2.0.0 is not yet released, something like this change would then be version 3.0.0\r\n\r\nWhich is why I proposed to introduce this first as an 'experimental' feature. Mozilla [also introduced a setting](https://support.mozilla.org/en-US/kb/move-navigation-bar) for this change. I enabled it directly because of my screen size. Other people comfortable/familiar with this approach could do the same.\r\n\r\nTo be honest 'gradual implementation' I think will be tricky. It does not allow testers to experience the new approach as a whole. I would rather have this thought out properly as a whole, get it implemented as an experimental feature, get thorough feedback from users. Then either we could still slowly introduce changes for everybody (moving them out of the 'experimental' phase).\nHave a design for the bottom navbar without changing anything else much. New to all this so can someone guide me how to share it? \nWhat do you have? Mock-ups? Code?\n> What do you have? Mock-ups? Code?\r\n\r\nMockup and the icon PNG files in various sizes.\nFeel free to post them here, so they can be discussed :)\nFirst design for the bottom nav bar. A few notes:\r\n1. I have used the lighter blue color from the AntennaPod logo for the backgrounds. \r\n2. The icons are for Subscriptions, Episodes, History, Downloads, Queue in that order. \r\n3. Experimented with the top bar colors too.\r\n4. Rearranged the tab order to \"New | Favorites | All\" to visually balance the screen. \r\nComments welcome :)\r\n\r\n[EDIT - uploaded more complete image]\r\n\r\n![Episodes](https://user-images.githubusercontent.com/36615794/92408189-61e57600-f15a-11ea-8912-bf55456df46c.png)\r\n\nUploading assets for miniplayer and bottom navigation bar...\r\n[antennapod_navbar_assets.zip](https://github.com/AntennaPod/AntennaPod/files/5249957/antennapod_navbar_assets.zip)\r\n\nThanks @icubyx for sharing that. I don't think we should implement a bottom navigation bar without reviewing also the drawer menu. What would be your view on this? We should avoid having two duplicate navigation systems. That would complicate code and interface.\n> Thanks @icubyx for sharing that. I don't think we should implement a bottom navigation bar without reviewing also the drawer menu. What would be your view on this? We should avoid having two duplicate navigation systems. That would complicate code and interface.\r\nI think to start with, we should have the frequently accessed sections on the bottom navigation bar - like downloads, queue and history. The others - like settings, subscriptions and episodes can go in the drawer menu. As @ByteHamster pointed out, users of this app are used to a certain interface and we should not shift abruptly - open to other suggestions...\r\n\nI don't see this often in apps, BUT instead of creating few versions of AP (normal and experimental) which will divide user-base keep both navigation. I don't see any problem with that if we are not adding any new menu items - since menu is just a reference to different AP pages, bottom and side navigation will direct to same pages (it will not cause additional mess in code). I do believe that bottom menu is immensely better than side menu, even on small phones its just more convenient to not have to move fingers and that's where smartphones direction heading - letting users do everything they want without moving fingers around whole screen (that's basically what for ex. Samsung OneUI 2.0 aims to do). So a solution could be adding a short message on top of side navigation saying \"this menu will be removed in version 2.5.0 please use bottom navigation menu.\" (version is random). THE only problem i see is that you cant fit all side nav menu items on bottom - where could other items go?\r\nOther solution would be simply to keep both nav bars.  Bottom one would contain items that are most used by users, and side nav bar would be ultimate menu where people go to only once in a while (when subscribing to new feed etc.). Does AP collect stats on which app parts are most clicked or used? That would be extremely useful for keeping most relevant things under user fingertips.\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/add-spacer-on-top-of-the-hamburger-menu-for-easier-access/127/9\n\n**A [discussion on bottom screen navigation](https://forum.antennapod.org/t/brainstorming-bottom-navigation-for-bigger-screens/774) is going on our forum. I'll lock this issue until a conclusion has been reached. Please feel free to add your comments there!**\nProposal in lign with Material design 3:\r\n[Interactive mock-up in PenPot](https://design.penpot.app/#/view/e357a320-7535-11eb-8a88-eb0147e048f5?page-id=339e1400-1a7f-11ed-ab8d-290a231b2267&section=interactions&index=0&share-id=e4d9dfe0-1b9e-11ed-817f-f940e3befd53)\r\n<details><summary>Non-interactive mock-ups</summary>\r\n\r\n![AP-BN_Home](https://user-images.githubusercontent.com/11229646/184663139-3c2ab8f9-d844-498b-82d0-fc16b6c5b970.png) ![AP-BN_More menu](https://user-images.githubusercontent.com/11229646/184663144-7506018b-39e7-4778-8e44-f8ee25889375.png)\r\nMore menu displayed in the bottom-right corner with small margin.\r\n![AP-BN_Navigation items](https://user-images.githubusercontent.com/11229646/184663146-f5dd95f3-6cf1-4a39-9363-0903aaa5fbf8.png)\r\n\r\n</details>\r\n\r\nDescription of UX and changed elements:\r\n\r\n* 4 items, and 'more' - as per the 'Navigation items' setting\r\n* Standard Material Design 3\r\n  * [Layout](https://m3.material.io/m3/pages/navigation-bar/specs/#6f329e0c-c278-4ac8-9b02-1afcb2790ac3)\r\n  * [Colours](https://m3.material.io/m3/pages/navigation-bar/specs/#1d62ff86-f860-4400-a681-5a856cdbca54)\r\n* Icons:\r\n  * [\"Material Symbols\", style: rounded](https://fonts.google.com/icons?icon.set=Material+Symbols&icon.style=Rounded)\r\n  * active: weight 400, not filled\r\n  * inactive: weight 300, not filled\r\n* Labels always visible (not only when active), as our icons alone aren't always as clear\r\n* 'Small Badge' for Inbox (colour: `primary`)\r\n* When tapping 'More' a customised [menu](https://m3.material.io/components/menus/specs) is displayed:\r\n  * Colour: `background` (not: `surface`)\r\n  * Icon & text colour: `on background` (not: `on surface`)\r\n  * List contains all items that are are set visible in the menu settings, including the mandatory Settings.\r\n\r\nA new setting is introduced: Settings > User Interface > Navigation location, with 2 options: \"Side\" and \"Bottom\". Existing users have the value 'Side', new installs will get the value 'Bottom'.\r\n\r\nSettings > User Interface > Navigation items is updated:\r\n* Full screen, listing all available navigation items\r\n* When bottom navigation is set:\r\n  * Displayed\r\n    * First four items visible in the navigation bar\r\n    * Visual separator of 6 dp with colour `background`\r\n    * Subsequent items (above the heading) displayed in the overflow ('More') menu\r\n    * The two blocks in this section are considered 1 list:\r\n      * It is not possible to have 2 items visible in the navigation bar, and 3 in the overflow menu (it would be: 4 in navigation bar, 1 in overflow menu)\r\n      * When there are 4 items in the navigation bar list, and another item is dragged into the list, the last item on the list gets pushed to the overflow menu\r\n  * Not displayed\r\n    * 'Not displayed' heading in style `body small` in a container with background colour `Surface-Variant`\r\n    * Items below the 'Not displayed' heading are not displayed in the (overflow) menu\r\n    * The 'Settings' item is fixed to be the last item in the overflow menu (is mandatory)\r\n* When sidebar navigation is set:\r\n  * All of the Displayed block are displayed, in the order as indicated\r\n  * The visual separator is still visible in the setting screen, but ignored\r\n* Existing users: the default navigation is used, and unticked navigation items are listed under 'not displayed'\r\n* New installs: the following order is applied: Home, Inbox, Queue, Subscriptions, Discover, Episodes, History, Statistics, Downloads", "created_at": "2024-05-09T13:22:41Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7159, "instance_id": "AntennaPod__AntennaPod-7159", "issue_numbers": ["4311"], "base_commit": "292a21f8f8a9aa1b389f27942730782ef451b6fa", "patch": "diff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/Chapter.java b/model/src/main/java/de/danoeh/antennapod/model/feed/Chapter.java\nindex 3683a2a4448..6c664788081 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/feed/Chapter.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/Chapter.java\n@@ -4,7 +4,7 @@\n \n public class Chapter {\n     private long id;\n-    /** Defines starting point in milliseconds. */\n+    /** The start time of the chapter in milliseconds */\n     private long start;\n     private String title;\n     private String link;\n@@ -66,7 +66,7 @@ public void setChapterId(String chapterId) {\n \n     @Override\n     public String toString() {\n-        return \"ID3Chapter [title=\" + getTitle() + \", start=\" + getStart() + \", url=\" + getLink() + \"]\";\n+        return \"Chapter [title=\" + getTitle() + \", start=\" + getStart() + \", url=\" + getLink() + \"]\";\n     }\n \n     public long getId() {\ndiff --git a/parser/media/src/main/java/de/danoeh/antennapod/parser/media/m4a/M4AChapterReader.java b/parser/media/src/main/java/de/danoeh/antennapod/parser/media/m4a/M4AChapterReader.java\nnew file mode 100644\nindex 00000000000..85a163fa78a\n--- /dev/null\n+++ b/parser/media/src/main/java/de/danoeh/antennapod/parser/media/m4a/M4AChapterReader.java\n@@ -0,0 +1,161 @@\n+package de.danoeh.antennapod.parser.media.m4a;\n+\n+import android.util.Log;\n+\n+import org.apache.commons.io.IOUtils;\n+\n+import java.io.InputStream;\n+import java.nio.charset.StandardCharsets;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import de.danoeh.antennapod.model.feed.Chapter;\n+\n+import java.io.IOException;\n+import java.nio.ByteBuffer;\n+import java.nio.ByteOrder;\n+\n+public class M4AChapterReader {\n+    private static final String TAG = \"M4AChapterReader\";\n+    private final List<Chapter> chapters = new ArrayList<>();\n+    private final InputStream inputStream;\n+    private static final int FTYP_CODE = 0x66747970; // \"ftyp\"\n+\n+    public M4AChapterReader(InputStream input) {\n+        inputStream = input;\n+    }\n+\n+    /**\n+     * Read the input stream populating the chapters list\n+     */\n+    public void readInputStream() {\n+        try {\n+            isM4A(inputStream);\n+            int dataSize = this.findAtom(\"moov.udta.chpl\");\n+            if (dataSize == -1) {\n+                Log.d(TAG, \"Nero Chapter Atom not found\");\n+            } else {\n+                Log.d(TAG, \"Nero Chapter Atom found. Data Size: \" + dataSize);\n+                this.parseNeroChapterAtom(dataSize);\n+            }\n+        } catch (Exception e) {\n+            Log.d(TAG, \"ERROR: \" + e.getMessage());\n+        }\n+    }\n+\n+    /**\n+     * Find the atom with the given name in the M4A file\n+     *\n+     * @param name the name of the atom to find, separated by dots\n+     * @return the size of the atom (minus the 8-byte header) if found\n+     * @throws IOException if an I/O error occurs or the atom is not found\n+     */\n+    public int findAtom(String name) throws IOException {\n+        // Split the name into parts encoded as UTF-8\n+        String[] parts = name.split(\"\\\\.\");\n+        int partIndex = 0;\n+        // Initialize remaining size to track the current part's size and check if it is exceeded\n+        int remainingSize = -1;\n+\n+        // Read the M4A file atom by atom\n+        ByteBuffer buffer = ByteBuffer.allocate(8).order(ByteOrder.BIG_ENDIAN);\n+        while (true) {\n+            // Read the atom header\n+            IOUtils.readFully(inputStream, buffer.array());\n+            // Get the size of the current atom\n+            int chunkSize = buffer.getInt();\n+            int dataSize = chunkSize - 8;\n+\n+            // Get the atom type\n+            String atomType = StandardCharsets.UTF_8.decode(buffer).toString();\n+\n+            // Reset the buffer for reading the atom data\n+            buffer.clear();\n+\n+            // Check if the current atom matches the current part of the name\n+            if (atomType.equals(parts[partIndex])) {\n+                if (partIndex == parts.length - 1) {\n+                    // If the current atom is the last part of the name return its size\n+                    return dataSize;\n+                } else {\n+                    // Else move to the next part of the name\n+                    partIndex++;\n+                    // Update the remaining size\n+                    remainingSize = dataSize;\n+                }\n+            } else {\n+                // Do not check the remaining size of top-level atoms\n+                if (partIndex > 0) {\n+                    // Update the remaining size\n+                    remainingSize -= dataSize;\n+                    // If the remaining size is exhausted, throw an exception\n+                    if (remainingSize <= 0) {\n+                        throw new IOException(\"Part size exceeded for part \\\"\" + parts[partIndex - 1]\n+                                + \"\\\" while searching atom. Remaining Size: \" + remainingSize);\n+                    }\n+                }\n+                // Skip the rest of the atom\n+                IOUtils.skipFully(inputStream, dataSize);\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Parse the Nero Chapter Atom in the M4A file\n+     * Assumes that the current position is at the start of the Nero Chapter Atom\n+     *\n+     * @param chunkSize the size of the Nero Chapter Atom\n+     * @throws IOException if an I/O error occurs\n+     * @see <a href=\"https://github.com/Zeugma440/atldotnet/wiki/Focus-on-Chapter-metadata#nero-chapters\">Nero Chapter</a>\n+     */\n+    private void parseNeroChapterAtom(long chunkSize) throws IOException {\n+        // Read the Nero Chapter Atom data into a buffer\n+        ByteBuffer byteBuffer = ByteBuffer.allocate((int) chunkSize).order(ByteOrder.BIG_ENDIAN);\n+        IOUtils.readFully(inputStream, byteBuffer.array());\n+        // Skip the 5-byte header\n+        // Nero Chapter Atom consists of a 5-byte header followed by chapter data\n+        // The first 4 bytes are the version and flags, the 5th byte is reserved\n+        byteBuffer.position(5);\n+        // Get the chapter count\n+        int chapterCount = byteBuffer.getInt();\n+        Log.d(TAG, \"Nero Chapter Count: \" + chapterCount);\n+\n+        // Parse each chapter\n+        for (int i = 0; i < chapterCount; i++) {\n+            long startTime = byteBuffer.getLong();\n+            int chapterNameSize = byteBuffer.get();\n+            byte[] chapterNameBytes = new byte[chapterNameSize];\n+            byteBuffer.get(chapterNameBytes, 0, chapterNameSize);\n+            String chapterName = new String(chapterNameBytes, StandardCharsets.UTF_8);\n+\n+            Chapter chapter = new Chapter();\n+            chapter.setStart(startTime / 10000);\n+            chapter.setTitle(chapterName);\n+            chapter.setChapterId(String.valueOf(i + 1));\n+            chapters.add(chapter);\n+\n+            Log.d(TAG, \"Nero Chapter \" + (i + 1) + \": \" + chapter);\n+        }\n+    }\n+\n+    public List<Chapter> getChapters() {\n+        return chapters;\n+    }\n+\n+    /**\n+     * Assert that the input stream is an M4A file by checking the signature\n+     *\n+     * @param inputStream the input stream to check\n+     * @throws IOException if an I/O error occurs\n+     */\n+    public static void isM4A(InputStream inputStream) throws IOException {\n+        ByteBuffer byteBuffer = ByteBuffer.allocate(8).order(ByteOrder.BIG_ENDIAN);\n+        IOUtils.readFully(inputStream, byteBuffer.array());\n+\n+        int ftypSize = byteBuffer.getInt();\n+        if (byteBuffer.getInt() != FTYP_CODE) {\n+            throw new IOException(\"Not an M4A file\");\n+        }\n+        IOUtils.skipFully(inputStream, ftypSize - 8);\n+    }\n+}\ndiff --git a/ui/chapters/src/main/java/de/danoeh/antennapod/ui/chapters/ChapterUtils.java b/ui/chapters/src/main/java/de/danoeh/antennapod/ui/chapters/ChapterUtils.java\nindex 5554890ed06..59317473a29 100644\n--- a/ui/chapters/src/main/java/de/danoeh/antennapod/ui/chapters/ChapterUtils.java\n+++ b/ui/chapters/src/main/java/de/danoeh/antennapod/ui/chapters/ChapterUtils.java\n@@ -16,6 +16,7 @@\n import de.danoeh.antennapod.model.playback.Playable;\n import de.danoeh.antennapod.parser.media.vorbis.VorbisCommentChapterReader;\n import de.danoeh.antennapod.parser.media.vorbis.VorbisCommentReaderException;\n+import de.danoeh.antennapod.parser.media.m4a.M4AChapterReader;\n import okhttp3.CacheControl;\n import okhttp3.Request;\n import okhttp3.Response;\n@@ -106,6 +107,19 @@ public static List<Chapter> loadChaptersFromMediaFile(Playable playable, Context\n         } catch (IOException | VorbisCommentReaderException e) {\n             Log.e(TAG, \"Unable to load vorbis chapters: \" + e.getMessage());\n         }\n+\n+        try (CountingInputStream in = openStream(playable, context)) {\n+            List<Chapter> chapters = readM4AChaptersFromInputStream(in);\n+            if (!chapters.isEmpty()) {\n+                Log.i(TAG, \"Chapters loaded\");\n+                return chapters;\n+            }\n+        } catch (InterruptedIOException e) {\n+            throw e;\n+        } catch (IOException e) {\n+            Log.e(TAG, \"Unable to open stream \" + e.getMessage());\n+        }\n+\n         return null;\n     }\n \n@@ -195,6 +209,22 @@ private static List<Chapter> readOggChaptersFromInputStream(InputStream input) t\n         return Collections.emptyList();\n     }\n \n+    @NonNull\n+    private static List<Chapter> readM4AChaptersFromInputStream(InputStream input) {\n+        M4AChapterReader reader = new M4AChapterReader(new BufferedInputStream(input));\n+        reader.readInputStream();\n+        List<Chapter> chapters = reader.getChapters();\n+        if (chapters == null) {\n+            return Collections.emptyList();\n+        }\n+        Collections.sort(chapters, new ChapterStartTimeComparator());\n+        enumerateEmptyChapterTitles(chapters);\n+        if (chaptersValid(chapters)) {\n+            return chapters;\n+        }\n+        return Collections.emptyList();\n+    }\n+\n     /**\n      * Makes sure that chapter does a title and an item attribute.\n      */\n", "test_patch": "diff --git a/parser/media/src/test/java/de/danoeh/antennapod/parser/media/m4a/M4AChapterReaderTest.java b/parser/media/src/test/java/de/danoeh/antennapod/parser/media/m4a/M4AChapterReaderTest.java\nnew file mode 100644\nindex 00000000000..9111f972721\n--- /dev/null\n+++ b/parser/media/src/test/java/de/danoeh/antennapod/parser/media/m4a/M4AChapterReaderTest.java\n@@ -0,0 +1,41 @@\n+package de.danoeh.antennapod.parser.media.m4a;\n+\n+import de.danoeh.antennapod.model.feed.Chapter;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.robolectric.RobolectricTestRunner;\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.util.List;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+@RunWith(RobolectricTestRunner.class)\n+public class M4AChapterReaderTest {\n+\n+    @Test\n+    public void testFiles() throws IOException {\n+        testFile();\n+    }\n+\n+    public void testFile() throws IOException {\n+        InputStream inputStream = getClass().getClassLoader()\n+                .getResource(\"nero-chapters.m4a\").openStream();\n+        M4AChapterReader reader = new M4AChapterReader(inputStream);\n+        reader.readInputStream();\n+        List<Chapter> chapters = reader.getChapters();\n+\n+        assertEquals(4, chapters.size());\n+\n+        assertEquals(0, chapters.get(0).getStart());\n+        assertEquals(3000, chapters.get(1).getStart());\n+        assertEquals(6000, chapters.get(2).getStart());\n+        assertEquals(9000, chapters.get(3).getStart());\n+\n+        assertEquals(\"Chapter 1 - \u2764\ufe0f\ud83d\ude0a\", chapters.get(0).getTitle());\n+        assertEquals(\"Chapter 2 - \u00df\u00f6\u00c4\", chapters.get(1).getTitle());\n+        assertEquals(\"Chapter 3 - \u7231\", chapters.get(2).getTitle());\n+        assertEquals(\"Chapter 4\", chapters.get(3).getTitle());\n+    }\n+}\ndiff --git a/parser/media/src/test/resources/nero-chapters.m4a b/parser/media/src/test/resources/nero-chapters.m4a\nnew file mode 100644\nindex 00000000000..99de2b66154\nBinary files /dev/null and b/parser/media/src/test/resources/nero-chapters.m4a differ\n", "problem_statement": "Support for parsing m4a chapters\n# Checklist\r\n<!-- Place an x in the boxes to tick them: [x] -->\r\n\r\n- [x ] I have used the search function to see if someone else has already submitted the same bug report.\r\n- [x ] I will describe the problem with as much detail as possible.\r\n- [x ] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n# System info\r\n<!-- The following information is very important to fill out because some bugs may only occur on certain devices or versions of Android. -->\r\n[ Environment ]\r\nAndroid version: 9\r\nOS version: 3.10.61-TeamNexus-flx-00210-g4cebbfb8cc42-dirty\r\nAntennaPod version: 1.8.1\r\nModel: SM-G920F\r\nDevice: zeroflte\r\nProduct: zerofltexx\r\nNo crash report recorded\r\n\r\n**App version**\r\n<!-- The latest version may be different depending on your device. You can find the version in AntennaPod's settings. -->\r\nAntennaPod 1.8.1 (6e6a64f50) ( tried versions from F-Droid and GooglePlayStore )\r\n\r\n**Android version**:\r\n9 ( Lineage OS 16.0 )\r\n\r\n**Device model**:\r\nSM-G920F\r\n\r\n# Bug description\r\nApp is unable to detect chapters/bookmarks in some podcast files (M4A) when chapter data is encoded at the end of audio file. \r\nThe app looks for chapter data in the beginning of the file, therefore is unable to detect chapters if \"chapter data\" is encoded at the end of the M4A. I have noted this issue with a few \"Apple Podcast M4A\" files, new apple non standard file shenanigans?\r\n\r\n**Steps to reproduce**:\r\nReplicate using this file http://audiocdn.economist.com/sites/default/files/AudioArchive/2020/20200725/Issue_9204_20200725_The_Economist_03_Leaders.m4a\r\nrun ffprobe to confirm that the file does contain chapter markers ffprobe -i Issue_9204_20200725_The_Economist_03_Leaders.m4a -show_chapters -loglevel error\r\n\r\nThis is how the Podcastaddict dev described the issue and fixed it, (devs feedback follows).**[...]** _The issue is that this specific podcast decided to move the chapter information at the end of the file instead of having them at the beginning which doesn't make any sense as it means that the app needs to get the whole file in order to just extract the metadata information. This podcast being especially long this would take a very long time and use a lot of data when streaming. I updated the app to be able to get those informations after the file gets downloaded as a workaround._ **[...]**\r\n\r\n**Expected behaviour**:\r\n<!-- After following the steps, what did you think AntennaPod would do? -->\r\nChapters/bookmarks in audio file should be detected and should be displayed\r\n\r\n**Current behaviour**:\r\n<!-- What did AntennaPod do instead? Screenshots might help. Usually, you can take a screenshot of your smartphone by pressing *Power* + *Volume down* for a few seconds. -->\r\nIs unable to detect chapters/bookmarks in some podcast files when \r\n**First occurred**: \r\nNew Install. Since install ( user migrated over from PodcastAddict ). \r\n**Environment**: \r\nNew install, default settings used.\r\n**Stacktrace/Logcat**:\r\n<!-- If you are experiencing a crash, including the stacktrace will likely get it fixed sooner. AntennaPod has an `export logs` feature for this. --> Not applicable, app did not crash\r\n```\r\n\r\n```\r\n\n", "hints_text": "Relevant lines from the log:\r\n\r\n```\r\n07-25 08:42:50.434 11014 11068 D ChapterUtils: Reading id3 chapters from item ...\r\n07-25 08:42:50.437 11014 11068 D ID3ChapterReader: No tag header found\r\n07-25 08:42:50.437 11014 11068 I ChapterUtils: ChapterReader could not find any ID3 chapters\r\n07-25 08:42:50.437 11014 11068 I ChapterUtils: Chapters loaded\r\n07-25 08:42:50.438 11014 11068 D ChapterUtils: Trying to read chapters from item with title ...\r\n07-25 08:42:50.440 11014 11068 I System.out: No vorbis comment found\r\n07-25 08:42:50.440 11014 11068 I ChapterUtils: ChapterReader could not find any Ogg vorbis chapters\r\n```\nThe file has chapters, but ID3ChapterReader does not see any. Not sure why :(\r\n\r\n`ffprobe -show_chapters http://audiocdn.economist.com/sites/default/files/AudioArchive/2020/20200725/Issue_9204_20200725_The_Economist_03_Leaders.m4a\r\n\r\n[mov,mp4,m4a,3gp,3g2,mj2 @ 0x555be7552ec0] Unknown cover type: 0x0.\r\n\r\nInput #0, mov,mp4,m4a,3gp,3g2,mj2, from 'http://audiocdn.economist.com/sites/default/files/AudioArchive/2020/20200725/Issue_9204_20200725_The_Economist_03_Leaders.m4a':\r\n\r\n  Metadata:\r\n    major_brand     : mp42\r\n    minor_version   : 0\r\n    compatible_brands: mp42isom\r\n    creation_time   : 2020-07-23T17:27:49.000000Z\r\n    title           : 03 Leaders\r\n    artist          : The Economist\r\n    album           : July 25th-31st 2020\r\n    genre           : Speech\r\n    track           : 3/21\r\n  Duration: 00:32:30.16, start: 0.000000, bitrate: 64 kb/s\r\n    Chapter #0:0: start 0.000000, end 30.537000\r\n    Metadata:\r\n      title           : 004 Leaders\r\n    Chapter #0:1: start 30.537000, end 530.612000\r\n    Metadata:\r\n      title           : 005 Leaders - Macroeconomics\r\n    Chapter #0:2: start 530.612000, end 848.703000\r\n    Metadata:\r\n      title           : 006 Leaders - Collective debt\r\n    Chapter #0:3: start 848.703000, end 1265.657000\r\n    Metadata:\r\n      title           : 007 Leaders - Regional development\r\n    Chapter #0:4: start 1265.657000, end 1598.170000\r\n    Metadata:\r\n      title           : 008 Leaders - Tanzania\r\n    Chapter #0:5: start 1598.170000, end 1950.162000\r\n    Metadata:\r\n      title           : 009 Leaders - Space exploration\r\n    Stream #0:0(eng): Audio: aac (LC) (mp4a / 0x6134706D), 44100 Hz, mono, fltp, 48 kb/s (default)\r\n    Metadata:\r\n      creation_time   : 2020-07-23T17:27:49.000000Z\r\n    Stream #0:1(und): Data: bin_data (text / 0x74786574)\r\n    Metadata:\r\n      creation_time   : 2020-07-23T17:27:49.000000Z\r\nUnsupported codec with id 100359 for input stream 1\r\n[CHAPTER]\r\nid=0\r\ntime_base=1/1000\r\nstart=0\r\nstart_time=0.000000\r\nend=30537\r\nend_time=30.537000\r\nTAG:title=004 Leaders\r\n[/CHAPTER]\r\n[CHAPTER]\r\nid=1\r\ntime_base=1/1000\r\nstart=30537\r\nstart_time=30.537000\r\nend=530612\r\nend_time=530.612000\r\nTAG:title=005 Leaders - Macroeconomics\r\n[/CHAPTER]\r\n[CHAPTER]\r\nid=2\r\ntime_base=1/1000\r\nstart=530612\r\nstart_time=530.612000\r\nend=848703\r\nend_time=848.703000\r\nTAG:title=006 Leaders - Collective debt\r\n[/CHAPTER]\r\n[CHAPTER]\r\nid=3\r\ntime_base=1/1000\r\nstart=848703\r\nstart_time=848.703000\r\nend=1265657\r\nend_time=1265.657000\r\nTAG:title=007 Leaders - Regional development\r\n[/CHAPTER]\r\n[CHAPTER]\r\nid=4\r\ntime_base=1/1000\r\nstart=1265657\r\nstart_time=1265.657000\r\nend=1598170\r\nend_time=1598.170000\r\nTAG:title=008 Leaders - Tanzania\r\n[/CHAPTER]\r\n[CHAPTER]\r\nid=5\r\ntime_base=1/1000\r\nstart=1598170\r\nstart_time=1598.170000\r\nend=1950162\r\nend_time=1950.162000\r\nTAG:title=009 Leaders - Space exploration\r\n[/CHAPTER]\r\n`\r\n\nAntennaPod currently does not support m4a chapters at all. If a podcast specifies the chapters in the RSS feed, they are shown independently from the media file, though. We already have [m4a test files](https://github.com/AntennaPod/AntennaPod/tree/develop/core/src/test/resources/media-parser), so the only thing missing is writing the parser (see this [m4a specification](http://atomicparsley.sourceforge.net/mpeg-4files.html))\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/ldn-no-pictures-for-chaptermarks-in-the-m4a-feed-ldn311/2489/3\n\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/show-notes-for-local-folder-podcasts/2589/5\n\nI'm so down for that. I listen to circa 20 podcasts and **none of them** provides chapters supported by AnthennaPod. Actually I found out about AnthennaPod supporting chapters from this issue tracker because my podcasts only have m4a chapters if any and only some of them provide timestamps via RSS.\r\n\r\nI want to add to this issue that chapter information can also be embedded into MP3 files. Maybe it's a good idea to extend this proposal by adding support for MP3 chapters alongside M4A.\nChapters in MP3, MP4, Ogg and Opus are already supported.\n@ByteHamster Well hard luck because they're not for me apparently. I can confirm that the whole episode is treated as one big chapter despite that ffprobe reads chapters with no problem.\nOf course I have the latest version of AnthennaPod (2.7.1)\nThis usually means that the podcast creator messed something up with the chapters (AntennaPod uses fewer workarounds than ffprobe), but feel free to create a new issue describing the problem in more detail.\nCan someone please clarify what the state of embedded M4A chapters is? This issue has two different positions: \r\n\r\n28 Feb 21: \"AntennaPod currently does not support m4a chapters at all.\"\r\nToday: \"Chapters in MP3, MP4, Ogg and Opus are already supported.\"\r\n\r\nWas support added in the meantime (just asking because the issue is still open). I have the same problem that for some of my podcasts, chapters are not visible, although I can see them in Pocket Casts, Apple Podcasts and also with ffprobe when checking the m4a file. Would be awesome to get that working.\r\n\r\nIf I can provide any information to help figure this out, please let me know.\n\r\n> 28 Feb 21: \"AntennaPod currently does not support m4a chapters at all.\" Today: \"Chapters in MP3, MP4, Ogg and Opus are already supported.\"\r\n\r\nCredit to @ByteHamster , AntenanPod does support m4a chapters now. Have seen chapters in multiple podcasts now. Here is an example 'https://www.bloomberg.com/news/audio/2023-04-06/imf-western-alliance-etfs-and-kurodanomics-podcast' , the chapters are recognized, they show up as a list and in the little blue timeline bar.\r\n\r\n![](https://i.imgur.com/XKRB6xg.jpg)\r\n\r\n>  I have the same problem that for some of my podcasts, chapters are not visible, although I can see them in Pocket Casts, Apple Podcasts and also with ffprobe when checking the m4a file.\r\n\r\nAs the hamster said above if the podcast creator / distributor uses software that creates [non-standard chapters](https://archive.ph/slQXM) AntennaPod cannot see them. \r\n\r\n## Lets use the Bloomberg podcast above as an example. \r\n( Tested with ffprobe & AntennaPod v2.7.1 )\r\n\r\nChapters show up when you grab the file from \r\n\r\n[Apple Podcasts](https://podcasts.apple.com/us/podcast/imf-western-alliance-etfs-and-kurodanomics/id326301337?i=1000607748771)\r\n[omny.fm](https://omny.fm/shows/the-tape/imf-western-alliance-etfs-and-kurodanomics)\r\nGoogle Podcasts\r\n\r\nBut not from \r\n\r\n[bloomberg.com](https://www.bloomberg.com/news/audio/2023-04-06/imfffprobe -v-western-alliance-etfs-and-kurodanomics-podcast)\r\nor [Sticher](https://www.stitcher.com/show/pl-with-pimm-fox-and-lisa-abramowicz/episode/imf-western-alliance-etfs-and-kurodanomics-301654938)\r\n\r\n**My hot take** : The advertising networks that insert custom adverts on the fly are mangling the file en-route to the listener. Sticher is a good example, when tested from my IP, got chapters, when tested from a vpn chapters disappeared, over tor chapters came back, tested from a second VPN provider chapters disappeared. \r\n\r\n@ByteHamster please feel free to close this issue as you have done your part, and the chapter mess is happening somewhere else\nWe support a bunch of chapter specifications, but not yet the one most commonly used in m4a files. If you can see chapters in m4a files, that's probably because the author encoded them with ID3 tags (which is apparently not recommended with m4a). So this issue is still open\nI did some digging and found sannies/mp4parser to fetch metadata from the container, as shown here. I assume this would also be usable for chapters (not exactly sure how they are encoded in the container though): https://github.com/sannies/mp4parser/blob/master/examples/src/main/java/org/mp4parser/examples/metadata/MetaDataRead.java.\r\n\r\nUnfortunately I'm not an Android dev so I didn't test that, but if if helps, once I find some more spare time, I can see if I can provide a PoC that works with the referenced files. \r\n\r\nThere's also an old issue for Voice, the guys there apparently implemented that by parsing the ffprobe output: https://github.com/PaulWoitaschek/Voice/issues/205 (see followup / PR at the end of the thread).\r\n\r\nMaybe the inclusion could be a feasible option if acceptable license/size wise?\nThat library feels a bit like an overkill, doing way more than we ever need. I think a small class that does the parsing should be enough.\n> This usually means that the podcast creator messed something up with the chapters (AntennaPod uses fewer workarounds than ffprobe), but feel free to create a new issue describing the problem in more detail.\r\n\r\n@ByteHamster I don't think it's a good attitude. Nobody actually does chapters by hand so some popular programs must create them like that since **none** of podcasts with chapters I listen is supported by AntennaPod (that's why I created a feature request). And they are supported by other players or by ffprobe itself. I don't negate that AntennaPod supports some kind of kosher chapter style but the thing is it doesn't support many other types of chapters that are out there in the wild. I think AntennaPod as a tool should support as much chapter styles as possible or use some kind of library specialized in this task. Please don't be so orthodox that AntennaPod supports few true chapter formats and whoever uses software that produces others is **wrong**. I know that lack of standardization can be frustrating but that's how the world works. You have to adopt. Even if you are a hobby project (which is awesome but mainly for checking updates and downloading episodes because I actually have to use separate player supporting chapters and rewinding tracks using headset button).   \r\n\n> We support a bunch of chapter specifications, but not yet the one most commonly used in m4a files. If you can see chapters in m4a files, that's probably because the author encoded them with ID3 tags (which is apparently not recommended with m4a). So this issue is still open\r\n\r\n@ByteHamster I hope it will be implemented soon because it looks like that's the most popular chapter format out there (which is odd that it's implemented as last)\nI'd like to second the support for this feature.  The podcasts I listen to are m4a with chapters, so lack of this feature prevents me from using AntennaPod as my podcast app.  I'd be happy to be a tester for this, if that's helpful to the developers.", "created_at": "2024-05-02T14:33:47Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7156, "instance_id": "AntennaPod__AntennaPod-7156", "issue_numbers": ["6698"], "base_commit": "292a21f8f8a9aa1b389f27942730782ef451b6fa", "patch": "diff --git a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\nindex 5fa89dd43d3..26798a1f19a 100644\n--- a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\n+++ b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\n@@ -238,8 +238,6 @@ public void onCreate() {\n         };\n         androidAutoConnectionState.observeForever(androidAutoConnectionObserver);\n \n-        ContextCompat.registerReceiver(this, autoStateUpdated,\n-                new IntentFilter(\"com.google.android.gms.car.media.STATUS\"), ContextCompat.RECEIVER_EXPORTED);\n         ContextCompat.registerReceiver(this, shutdownReceiver,\n                 new IntentFilter(PlaybackServiceInterface.ACTION_SHUTDOWN_PLAYBACK_SERVICE),\n                 ContextCompat.RECEIVER_NOT_EXPORTED);\n@@ -274,11 +272,11 @@ void recreateMediaSessionIfNeeded() {\n                 PendingIntent.FLAG_UPDATE_CURRENT | (Build.VERSION.SDK_INT >= 31 ? PendingIntent.FLAG_MUTABLE : 0));\n \n         mediaSession = new MediaSessionCompat(getApplicationContext(), TAG, eventReceiver, buttonReceiverIntent);\n-        setSessionToken(mediaSession.getSessionToken());\n         mediaSession.setCallback(sessionCallback);\n         mediaSession.setFlags(MediaSessionCompat.FLAG_HANDLES_MEDIA_BUTTONS | MediaSessionCompat.FLAG_HANDLES_TRANSPORT_CONTROLS);\n         recreateMediaPlayer();\n         mediaSession.setActive(true);\n+        setSessionToken(mediaSession.getSessionToken());\n     }\n \n     void recreateMediaPlayer() {\n@@ -298,6 +296,7 @@ void recreateMediaPlayer() {\n             mediaPlayer.playMediaObject(media, !media.localFileAvailable(), wasPlaying, true);\n         }\n         isCasting = mediaPlayer.isCasting();\n+        updateMediaSession(mediaPlayer.getPlayerStatus());\n     }\n \n     @Override\n@@ -324,7 +323,6 @@ public void onDestroy() {\n             mediaSession.release();\n             mediaSession = null;\n         }\n-        unregisterReceiver(autoStateUpdated);\n         unregisterReceiver(headsetDisconnected);\n         unregisterReceiver(shutdownReceiver);\n         unregisterReceiver(bluetoothStateUpdated);\n@@ -1489,28 +1487,6 @@ private void bluetoothNotifyChange(PlaybackServiceMediaPlayer.PSMPInfo info, Str\n         }\n     }\n \n-    private final BroadcastReceiver autoStateUpdated = new BroadcastReceiver() {\n-        @Override\n-        public void onReceive(Context context, Intent intent) {\n-            String status = intent.getStringExtra(\"media_connection_status\");\n-            boolean isConnectedToCar = \"media_connected\".equals(status);\n-            Log.d(TAG, \"Received Auto Connection update: \" + status);\n-            if (!isConnectedToCar) {\n-                Log.d(TAG, \"Car was unplugged during playback.\");\n-            } else {\n-                PlayerStatus playerStatus = mediaPlayer.getPlayerStatus();\n-                if (playerStatus == PlayerStatus.PAUSED || playerStatus == PlayerStatus.PREPARED) {\n-                    mediaPlayer.resume();\n-                } else if (playerStatus == PlayerStatus.PREPARING) {\n-                    mediaPlayer.setStartWhenPrepared(!mediaPlayer.isStartWhenPrepared());\n-                } else if (playerStatus == PlayerStatus.INITIALIZED) {\n-                    mediaPlayer.setStartWhenPrepared(true);\n-                    mediaPlayer.prepare();\n-                }\n-            }\n-        }\n-    };\n-\n     /**\n      * Pauses playback when the headset is disconnected and the preference is\n      * set\n", "test_patch": "", "problem_statement": "Inconsistent autoplay behavior when connected to Android Auto\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.1.1 (8073de55a)\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n13\n\n### Device model\n\nPixel 7 Pro\n\n### First occurred\n\nSince using the app\n\n### Steps to reproduce\n\nThis is difficult to reliably reproduce because it seems that it does this randomly and inconsistently, and I haven't figured out any sort of pattern to reproduce this.\r\n\r\nMost of the time, the intended behavior would be to simply resume my podcast in progress upon connecting to Android Auto. I already have AA setup to resume my media on connect. I would say about 80-90% of the time this is the observed behavior.\r\n\r\nI'm currently finding replacements for the soon-to-be-deprecated Google Podcasts app. This would pretty much be perfect if not for this bug. I will say that in the duration I've been using the app, I've always had at least something queued up, so the queue has never been empty.\n\n### Expected behaviour\n\nExpected it to always autoplay upon connecting to Android Auto.\n\n### Current behaviour\n\nWhat happens about 10-20% of the time is that it won't autoplay anything. The split-screen view will show 'For You', then I swipe that to view the AntennaPod session, and it says I have to tap to open it. At that point, I still have to go to the Queue tab and manually tap the topmost episode to continue playback.\n\n### Logs\n\nNext time I observe this happening, I will export logs and paste them.\n", "hints_text": "I doubt there's that much in the logs but here they are:\r\n\r\n```\r\n--------- beginning of main\r\n10-11 18:13:25.118 21429 21429 D PlaybackService: OnLoadChildren: parentMediaId=Queue\r\n10-11 18:13:25.118 21429 31131 D DBReader: getQueue() called\r\n10-11 18:13:25.118 21429 31131 D DBReader: getQueue()\r\n10-11 18:13:25.119 21429 31131 D DBReader: getFavoriteIDList() called\r\n10-11 18:13:25.119 21429 31131 D DBReader: getQueueIDList() called\r\n10-11 18:13:25.119 21429 31131 D DBReader: Extracting Feedlist\r\n10-11 18:13:25.126 21429 21429 D PlaybackService: OnLoadChildren: parentMediaId=Downloads\r\n10-11 18:13:25.126 21429 31142 D DBReader: getRecentlyPublishedEpisodes() called with: offset=0, limit=100\r\n10-11 18:13:25.127 21429 31142 D DBReader: getFavoriteIDList() called\r\n10-11 18:13:25.127 21429 31142 D DBReader: getQueueIDList() called\r\n10-11 18:13:25.127 21429 31142 D DBReader: Extracting Feedlist\r\n10-11 18:13:32.717 21429 21429 D TrafficStats: tagSocket(72) with statsTag=0xffffffff, statsUid=-1\r\n10-11 18:13:49.793 21429 21429 D TrafficStats: tagSocket(72) with statsTag=0xffffffff, statsUid=-1\r\n10-11 18:13:59.216 21429 21429 D TrafficStats: tagSocket(72) with statsTag=0xffffffff, statsUid=-1\r\n10-11 18:14:07.833 21429 21429 D TrafficStats: tagSocket(72) with statsTag=0xffffffff, statsUid=-1\r\n10-11 18:14:21.336 21429 21429 D TrafficStats: tagSocket(72) with statsTag=0xffffffff, statsUid=-1\r\n10-11 18:14:27.034 21429 21429 D TrafficStats: tagSocket(72) with statsTag=0xffffffff, statsUid=-1\r\n10-11 18:14:33.819 21429 21429 D TrafficStats: tagSocket(72) with statsTag=0xffffffff, statsUid=-1\r\n10-11 18:14:37.660 21429 21429 D TrafficStats: tagSocket(72) with statsTag=0xffffffff, statsUid=-1\r\n10-11 18:14:43.155 21429 21429 D TrafficStats: tagSocket(72) with statsTag=0xffffffff, statsUid=-1\r\n10-11 18:14:44.616 21429 21429 D TrafficStats: tagSocket(72) with statsTag=0xffffffff, statsUid=-1\r\n10-11 18:14:52.201 21429 21429 D TrafficStats: tagSocket(72) with statsTag=0xffffffff, statsUid=-1\r\n10-11 18:15:00.148 21429 21429 D TrafficStats: tagSocket(116) with statsTag=0xffffffff, statsUid=-1\r\n10-11 18:15:01.381 21429 21429 D UserPreferences: User data folder not writable or not set. Trying default.\r\n10-11 18:15:01.382 21429 21429 D BugReportActivity: No crash report recorded\r\n10-11 18:15:01.908 21429 21456 D OpenGLRenderer: endAllActiveAnimators on 0xb4000079b10b1d40 (RippleDrawable) with handle 0xb4000078c0df6ad0\r\n10-11 18:15:06.308 21429 21429 D TrafficStats: tagSocket(100) with statsTag=0xffffffff, statsUid=-1\r\n10-11 18:15:06.816 21429 21456 D OpenGLRenderer: endAllActiveAnimators on 0xb4000079b0f4c250 (MenuPopupWindow$MenuDropDownListView) with handle 0xb4000078c0ddc1c0\r\n10-11 18:15:10.495 21429 21429 D UserPreferences: User data folder not writable or not set. Trying default.\r\n10-11 18:15:10.518 21429 21456 D OpenGLRenderer: endAllActiveAnimators on 0xb4000079b0fd68d0 (RippleDrawable) with handle 0xb4000078c0defd50\r\n```\nUpon further testing, I noticed that:\r\n* If my car audio was last set to Android Auto - plugging my phone in will immediately start playing AntennaPod (assuming that was my last media app), and will continue off in my queue exactly where I left off. This is expected and desired.\r\n* If my car audio was *not* Android Auto - e.g. the radio - then I have to go through the \"tap to open\" and manually select my highest queue item to play. Keep in mind before this happens, the radio is still playing, which is expected.\r\n\r\nWith Google Podcasts in the below scenario, it would be ready to go with the player already open, set to resume my queue, and it was only awaiting me to manually tap play. Here, there's the extra step of tapping back into the app, then tapping the top of my queue to resume.\r\n\r\nSo it's a relatively minor setback in user workflow, and I'm partially willing to bet that it's because Google Podcasts was somehow more \"integrated\" with my phone (Pixel 7 Pro) than AntennaPod is.\r\n\r\nI would then just hope that AntennaPod knows by default to resume playback from the top of the queue without the extra intermediary manual step, but it's honestly a very minor issue in an otherwise excellent app.\nI can confirm that this is annoying 'bug' in Android Auto since I use AP frequently in my car and many others have chimed in https://forum.antennapod.org/t/android-auto-not-continuing-playback/3108?u=tonytamsf\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/android-auto-not-continuing-playback/3108/8\n\nIs anyone willing to test out a debug build that should address this bug\r\n\r\nThe apk is in the Checks tab here [Android auto resume by tonytamsf \u00b7 Pull Request #6766 \u00b7 AntennaPod/AntennaPod \u00b7 GitHub](https://github.com/AntennaPod/AntennaPod/pull/6766/checks)\r\n\r\ndownload it from https://github.com/AntennaPod/AntennaPod/suites/18235922573/artifacts/1053611078\n> Is anyone willing to test out a debug build that should address this bug\r\n> \r\n> The apk is in the Checks tab here [Android auto resume by tonytamsf \u00b7 Pull Request #6766 \u00b7 AntennaPod/AntennaPod \u00b7 GitHub](https://github.com/AntennaPod/AntennaPod/pull/6766/checks)\r\n> \r\n> download it from https://github.com/AntennaPod/AntennaPod/suites/18235922573/artifacts/1053611078\r\n\r\nApk is no longer available. \nI see this same behavior, but it is not inconsistent -- it is 100% consistent.  Every single time I use Antenna pod with Android Auto, I get the \"for you\" view, and nothing is playing.  Even if I was JUST playing a podcast on that vehicle, turned off the car (e.g. to refuel), and restarted the vehicle without ever disconnecting the USB cable to my phone.  \r\n\r\nI'd be happy to test a debug build.\n> I see this same behavior, but it is not inconsistent -- it is 100% consistent. Every single time I use Antenna pod with Android Auto, I get the \"for you\" view, and nothing is playing. Even if I was JUST playing a podcast on that vehicle, turned off the car (e.g. to refuel), and restarted the vehicle without ever disconnecting the USB cable to my phone.\r\n> \r\n> I'd be happy to test a debug build.\r\n\r\nThere is an apk to test in this pull request:\r\nhttps://github.com/AntennaPod/AntennaPod/pull/6766\n> There is an apk to test in this pull request: #6766\r\n\r\n@fakerli  - have you been able to use this APK in android auto?  I installed it to my phone, and of course, I then had two AntennaPod apps installed.  The android auto \"customize launcher\" only showed one, so I uninstalled my original play store AntennaPod, thinking maybe the customize tool didn't like two apps with the same name (although this debug APK does have \"Debug\" on the end of the name).  Now the customize launcher doesn't allow me to select AntennaPod.  I tried rebooting just in case, but still can't select AntennaPod for the AA launcher.  Is there something I need to do so I can add it to the launcher?\n@jpriebe My wife has my car at the moment. I'll get it back in about 24 hours :-D Will check then!\nI  can see it in the customization settings, but I have unknown sources enabled in AA developer settings. Try if this helps:\r\n\r\n1. Go to android auto settings\r\n2. Tap \"version\" 10 times\r\n3. Read the warning and enable developer settings\r\n4. Press the 3 dots in the top right corner\r\n5. Select \"developer settings\"\r\n6. Select \"unknown sources\".\r\n\r\nCheck if it works. Maybe you need to reinstall the apk.\r\n\r\nNote: I'm on a Dutch system, so names of options might not be exact, but you should be able to find them.\r\nNote 2: it's night over here, so I'll test it in the morning\n> I can see it in the customization settings, but I have unknown sources enabled in AA developer settings. Try if this helps:\r\n\r\nAhhh, developer mode -- that makes sense.  AA has its own safety mechanism to prevent sideloading.  Your steps worked perfectly.\r\n\r\nAfter I turned on unknown sources, I did have to uninstall and reinstall the apk for the launcher customizer to show the AntennaPod Debug application.\r\n\r\nThanks for such a useful comment!  Now to drive around with the new build and see what happens.\r\n\nI got the debug APK to show up in Android Auto, but it gives me an error when trying to open it. \nI did some tests with the debug APK and this is what I see:\r\nWhen android auto starts, the last played podcast always starts playing automatically, at the position it left of before. So this is good.\r\nHowever, the Android Auto setting that controls if music playing should be resumed automatically, is ignored completely. Even if this is set to off, the podcast starts playing.\r\nIn other apps, if this setting is of, the last track is loaded, but paused. This way, you only have to press \"play\" to start it. It would be nice if AntennaPod would respect this setting.\nSame experience.  To be transparent, I've only tested 2 times since getting the debug apk installed, so take that for what it's worth.\r\n\r\nI started the day by listening to a podcast on AntennaPod on my phone's speaker in the house.  I stopped the playback before leaving the house to get in the car.  I connected the phone to the car, and it immediately resumed playback (a little unexpected, but still better than showing the \"for you\" screen).\r\n\r\nAfter work, I connected the phone to the car again, and the playback started up again automatically.\r\n\r\nThis is an improvement, but I think it should honor the Android Auto setting for auto resume.\nFor the most part, my experience over a week or so with the debug build was pretty good.  Like I mentioned in my previous comment, it was not honoring the \"Start music automatically\" setting in Android Auto.  But auto playing is preferable to starting on the \"For You\" page and requiring a bunch of navigation to the episodes list to find your episode.\r\n\r\nI saw that https://github.com/AntennaPod/AntennaPod/pull/6766/files was closed.  Sounds like more investigation is required.  I hope that a fix will come soon.  The debug build doesn't seem to auto-download episodes (regardless of settings), so I'm back to the Play store version.\nThanks folks for testing it.  The PR fix I made was a bit hacky hence I closed it until I can figure out a better solution https://github.com/AntennaPod/AntennaPod/pull/6766\n> Thanks folks for testing it. The PR fix I made was a bit hacky hence I closed it until I can figure out a better solution #6766\r\n\r\nMy 2nd try to fix this issue https://github.com/AntennaPod/AntennaPod/pull/6816\r\n\r\nTo download the debug build, click on the *Checks* tab and download the Archives\nWhat does this \"for you\" screen show? Where does it come from? I don't think AntennaPod generates such a screen. Does it show AntennaPod episodes?\n\r\n\r\nI don't know where the \"for you\" screen comes from, but it is shown on the Android Auto interface if you are using the \"split screen\" mode (don't know the official name).\r\nFor reference, take a look at this: ![PXL_20231220_154336115](https://github.com/AntennaPod/AntennaPod/assets/948770/24ce145e-2b4e-4a1f-92d9-4cb870a4fd95)\r\nIn the picture frok my car, the right \"window\" shows the \"for you\" screen. This contains a variety of media, but it seems to be related to the last active media player. For example, if I played a lot of spotify music, it will contain spotify suggestions. If I used AntennaPod a lot, it will include episodes from podcasts I listen to in AntennaPod. Which episodes is still unclear to me, as it used to be a random mix from the queue and downloads, but nowadays, it's mostly all episodes from one specific podcast. Sometimes, there's also a mix of apps, so for example some music and some podcasts mixed together.\nI think \"for you\" is part of Google Maps? https://www.reddit.com/r/PodcastAddict/s/rCCfsh25DW\n> > Thanks folks for testing it. The PR fix I made was a bit hacky hence I closed it until I can figure out a better solution #6766\r\n> \r\n> My 2nd try to fix this issue #6816\r\n> \r\n> To download the debug build, click on the _Checks_ tab and download the Archives\r\n\r\nI tested this and the behavior of the \"current\" tab is as described.\n@bartlibert Thanks for testing.  Is it an acceptable fix for the issue? \nDoesn't your fix still require users to open the app, navigate to the \"current\" screen, and press the song? This doesn't sound very different from going to the queue and pressing play. Does the additional screen make it harder to access other screens?\n@ByteHamster The current problem with going to the queue is that if you are not playing the episode from the top of the queue, it is hard to scroll and find the previous episode.\n\nI don't think this makes it harder to use the other screens.. but other test users can speak up. we can also move the current screen after Queue, Downloads\nIt is already a huge improvement indeed, especially if you don't always play from the top of the queue (as I do).\r\nHowever, other apps have (IMHO) still better behaviour, but I don't know how easy it is to implement.\r\nIn the pictures, I use spotify as an example, but I've seen the same behaviour with i.e. Podcast Addict (which I used before I discovered AntennaPod).\r\n\r\nIf spotify was the last app used to play audio on android auto, it will behave in one of two ways:\r\n\r\n1. If android auto is in the \"tiled\" mode, it will show the last played/playing track instead of the \"for you\" screen, together with a \"play\" button:\r\n![PXL_20231221_083644001](https://github.com/AntennaPod/AntennaPod/assets/948770/cee20cf6-9a17-4d19-a67b-c292adc42ad8)\r\n\r\n2. If android auto is started with \"fullscreen navigation\", you will be able to start playing via the controls in the bottom of the screen.\r\n![PXL_20231221_083730994](https://github.com/AntennaPod/AntennaPod/assets/948770/4327f9a2-22fa-4f9e-bbea-b8fa13237610)\r\n\n> It is already a huge improvement indeed, especially if you don't always play from the top of the queue (as I do). However, other apps have (IMHO) still better behaviour, but I don't know how easy it is to implement. In the pictures, I use spotify as an example, but I've seen the same behaviour with i.e. Podcast Addict (which I used before I discovered AntennaPod).\r\n\r\nThank you @bartlibert for testing. I agree that my current quick fix is better than before, but I would rather have what Spotify is doing.   I'll continue to look for a 'right' fix.  I think my current quick fix is valuable to release until we can figure out the perfect fix since it's pretty painful right now.\r\n\r\nSee this recent review with 84 'likes' pointing out this issue\r\n\r\n<img width=\"1163\" alt=\"Screenshot 2023-12-21 at 5 51 26\u202fAM\" src=\"https://github.com/AntennaPod/AntennaPod/assets/149837/e00f5890-b983-44e4-8b26-01cb3cade7a3\">\r\n\r\n\r\n\nFYI, open source Ultrasonic app has the \"correct\" behavior, it might provide some inspiration: [Gitlab](https://gitlab.com/ultrasonic/ultrasonic)\nUsers mentioning this in Google Play reviews:\r\n\r\n[1](https://play.google.com/console/u/0/developers/8008695526664634386/app/4974638472012894302/user-feedback/review-details?reviewId=b1ef3108-0314-4007-a389-aa7a02299812&corpus=PUBLIC_REVIEWS)\r\n> I need this app for Android auto. In the app when I stop in the middle of a podcast in return, I can continue by pressing play. In Android Auto. I do not get that option. It does not retain the current podcast nor present the play button panel. It's great otherwise, but useless to Android auto users. I tried writing to support. I know it's the holidays, but I would have at least like an acknowledgment of the situation and did not get any response. If I get a solution I will change the review.\r\n\r\n[2](https://play.google.com/console/u/0/developers/8008695526664634386/app/4974638472012894302/user-feedback/review-details?reviewId=af25354a-cb18-41f3-9805-d0d5f31a5e5b&corpus=PUBLIC_REVIEWS)\r\n> Ich dachte, die App kann Google Podcasts ersetzen, aber einige essenzielle Dinge funktionieren nicht. Wenn z.B. w\u00e4hrend des H\u00f6rens jemand anruft, egal ob ich ran gehe oder nicht. Der Podcast stoppt und ich muss ihn manuell wieder starten. Bei Android Auto ist es \u00e4hnlich. Man verl\u00e4sst das Auto, steigt 10 Minuten sp\u00e4ter wieder ein, dann startet der Podcast zu 80 Prozent nicht von allein. Auch wird bei Android Auto nicht angezeigt, wann eine neue Folge erschienen ist.\r\n\r\n[3](https://play.google.com/console/u/0/developers/8008695526664634386/app/4974638472012894302/user-feedback/review-details?reviewId=7eb4fc38-8605-4ea2-80a3-be7859c72cba&corpus=PUBLIC_REVIEWS)\r\n> Basic functions work well but for some reason this app refuses to resume playing automatically when connecting to Android Auto. You have to start app, go to queue, remember which podcast you were listening to and click it... Certainly some weird behavior\r\n\r\n[4](https://play.google.com/console/u/0/developers/8008695526664634386/app/4974638472012894302/user-feedback/review-details?reviewId=c9ee6bf7-6334-433e-a3f4-0b1e1758ee9f&corpus=PUBLIC_REVIEWS)\r\n> Macht was er soll, ein Stern Abzug weil ich nicht mehrere Ger\u00e4te unkompliziert synchronisieren kann. Kein nahtloses Weiter h\u00f6ren \u00fcber Android Auto m\u00f6glich, sondern m\u00fchsames suchen.\r\n\r\n[5](https://play.google.com/console/u/0/developers/8008695526664634386/app/4974638472012894302/user-feedback/review-details?reviewId=948af30d-9cee-4388-8bb0-f19ff909a21f&corpus=PUBLIC_REVIEWS)\r\n> Mediocre at best. I have been trying to find a replacement for Google Podcasts and have this a shot. Unfortunately AntennaPod falls short in a couple of key areas. It will occasionally just lose a downloaded file making me redownload a podcast. I would say this happens at least once a week. A bigger issue is that it does not integrate well with Android Auto and I have to manually go into AntennaPod and select what I want to listen to rather than just playing whatever I was last listening to.\n\n[6](https://play.google.com/console/developers/8008695526664634386/app/4974638472012894302/user-feedback/review-details?reviewId=b513191d-b9a4-4c59-9248-99f4e06157b2&corpus=PUBLIC_REVIEWS)\n> The app itself is pretty good and definitely a contending alternative as Google Podcasts is being sunset. I've docked one last star because the AndroidAuto app is not a consistent experience. If you weren't listening to a podcast right before entering a car. It will not automatically resume in the vehicle. There's no \"playing now\" option either so you're left either searching for it through downloads or standard search or navigating back to the podcast itself. Quite frustrating.\n\n[7](https://play.google.com/console/developers/8008695526664634386/app/4974638472012894302/user-feedback/review-details?reviewId=9ccf1b84-a71f-4efb-9020-016a9cb55883&corpus=PUBLIC_REVIEWS)\n> Android Auto interface isn't great (hard to resume in progress podcasts), but best alternative to defunct Google Podcasts\n\n[8](https://play.google.com/console/developers/8008695526664634386/app/4974638472012894302/user-feedback/review-details?reviewId=96760240-8e37-48a6-8f58-9ca45fa40116&corpus=PUBLIC_REVIEWS)\n> This is a mostly fine replacement for Google Podcasts, except for a couple of very annoying things. 1. Not being able to download a single episode of a podcast without subscribing (and then being forced to listen to that episode before being able to unsubscribe). This has been requested as a feature for over 3 years with no fix. 2. Playback does not automatically resume the episode/location in Android Auto. You must open the app and navigate to the episode to resume.\n@tonytamsf Given that your 'desired' solution (like Spotify) isn't implemented yet, should we reopen this issue?\n> @tonytamsf Given that your 'desired' solution (like Spotify) isn't implemented yet, should we reopen this issue?\r\n\r\nI think this PR is the desired solution https://github.com/AntennaPod/AntennaPod/pull/6878\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/resume-podcast-between-drives-on-android-auto/3728/13\n\nCurrently there's some code in AntennaPod that attempts to resume playback automatically, but ideally this should be handled by Android Auto. It looks like AntennaPod doesn't fill out the MediaSessionCompat object correctly, which prevents Android Auto from restarting the playback automatically or presenting an option to the user to do so.\n\nI'll investigate this further.\n\n@hades Feel free to take on this issue from me since I hadn't made much progress\nTalking about MediaSession, we should probably update to androidx media3 MediaSessions. That seems to need quite a large number of non-trivial code changes, though. I tried it at some point and then gave up ", "created_at": "2024-05-01T11:13:44Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7147, "instance_id": "AntennaPod__AntennaPod-7147", "issue_numbers": ["7092"], "base_commit": "257c3bca5e57d3e692d5f8ee086432ec2b6edf82", "patch": "diff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBWriter.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBWriter.java\nindex a9c4f4dc39..7b4543a38a 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBWriter.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBWriter.java\n@@ -728,20 +728,10 @@ public static Future<?> markItemPlayed(final int played, final boolean broadcast\n      */\n     @NonNull\n     public static Future<?> markItemPlayed(FeedItem item, int played, boolean resetMediaPosition) {\n-        long mediaId = (item.hasMedia()) ? item.getMedia().getId() : 0;\n-        return markItemPlayed(item.getId(), played, mediaId, resetMediaPosition);\n-    }\n-\n-    @NonNull\n-    private static Future<?> markItemPlayed(final long itemId,\n-                                            final int played,\n-                                            final long mediaId,\n-                                            final boolean resetMediaPosition) {\n         return runOnDbThread(() -> {\n             final PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n-            adapter.setFeedItemRead(played, itemId, mediaId,\n-                    resetMediaPosition);\n+            adapter.setFeedItemRead(item, played, resetMediaPosition);\n             adapter.close();\n \n             EventBus.getDefault().post(new UnreadItemsUpdateEvent());\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\nindex b77cd06d20..19660fb77d 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n@@ -684,19 +684,21 @@ private long updateOrInsertFeedItem(FeedItem item, boolean saveFeed) {\n         return item.getId();\n     }\n \n-    public void setFeedItemRead(int played, long itemId, long mediaId,\n-                                boolean resetMediaPosition) {\n+    public void setFeedItemRead(FeedItem item, int played, boolean resetMediaPosition) {\n         try {\n             db.beginTransactionNonExclusive();\n             ContentValues values = new ContentValues();\n \n             values.put(KEY_READ, played);\n-            db.update(TABLE_NAME_FEED_ITEMS, values, KEY_ID + \"=?\", new String[]{String.valueOf(itemId)});\n+            db.update(TABLE_NAME_FEED_ITEMS, values, KEY_ID + \"=?\", new String[]{String.valueOf(item.getId())});\n+            item.setPlayed(played == FeedItem.PLAYED);\n \n             if (resetMediaPosition) {\n                 values.clear();\n                 values.put(KEY_POSITION, 0);\n-                db.update(TABLE_NAME_FEED_MEDIA, values, KEY_ID + \"=?\", new String[]{String.valueOf(mediaId)});\n+                db.update(TABLE_NAME_FEED_MEDIA, values, KEY_ID + \"=?\",\n+                        new String[]{String.valueOf(item.getMedia().getId())});\n+                item.getMedia().setPosition(0);\n             }\n \n             db.setTransactionSuccessful();\n", "test_patch": "", "problem_statement": "Played episodes still display progress upon completion\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.4.0-beta1 (58db8f103)\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\n_No response_\n\n### First occurred\n\nLast 1.5 days\n\n### Steps to reproduce\n\nThis looks like a recent regression, as it wasn't happening in 3.3.x. All episodes I have played so far on this version are affected.\r\nDespite the issue, auto-deletion and removal from queue both work correctly.\r\n\r\n1. Play an episode and reach the end (it doesn't seem to matter whether by playing or fast-forwarding)\n\n### Expected behaviour\n\n2. The episode is marked as played, with no progress bar visible\n\n### Current behaviour\n\n2. The episode still has a progress bar visible, as if it was paused\n\n### Logs\n\n_No response_\n", "hints_text": "Can confirm. Same here with Android 14.\nShould be fixed in beta2\nI can still reproduce the issue in beta 2.\nFor newly completed episodes or for the ones already completed on beta1?\nFor newly completed episodes played only with beta 2, indeed.\nHmm. Then I don't really understand why this is happening...\nMy settings, in case they help reproduce the issue:\r\nAuto delete: on\r\nDelete removes from queue: on\r\nSmart mark as played: 30 seconds\nI still sometimes see this as well but I can't reliably reproduce it. Every time I test this, it works. But some of my recently played episodes clearly still have progress.\r\n\r\nDo you let the episodes play to the very end or do you click another episode while it is still playing (relying on smart mark as played)?\nI usually let episodes play to the very end; sometimes, I ffwd past the end. I never end an episode by skipping or by directly starting another one.\r\n\r\nI can reproduce this for all played episodes on my device.\n> I usually let episodes play to the very end; sometimes, I ffwd past the end. I never end an episode by skipping or by directly starting another one.\r\n> \r\n> I can reproduce this for all played episodes on my device.\r\n\r\nSame for me\nSame", "created_at": "2024-04-28T14:15:22Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7129, "instance_id": "AntennaPod__AntennaPod-7129", "issue_numbers": ["7123", "7124"], "base_commit": "c56facd141a34d33ef38c0bdbee04a9944de8de7", "patch": "diff --git a/ui/preferences/src/main/assets/special_thanks.csv b/ui/preferences/src/main/assets/special_thanks.csv\nindex 5758d48c0a..9efa36eb4d 100644\n--- a/ui/preferences/src/main/assets/special_thanks.csv\n+++ b/ui/preferences/src/main/assets/special_thanks.csv\n@@ -1,6 +1,6 @@\n-ByteHamster;Project lead;https://avatars2.githubusercontent.com/u/5811634?s=60&v=4\n-Keunes;Project lead;https://avatars2.githubusercontent.com/u/11229646?s=60&v=4\n-Femmdi;Translations coordinator;https://avatars2.githubusercontent.com/u/47671383?s=60&v=4\n-Ryan Gorley (Freehive);2023 brand design;https://avatars2.githubusercontent.com/u/12849958?s=60&v=4\n-221 Pixels;2020 brand design;https://avatars2.githubusercontent.com/u/58243143?s=60&v=4\n-Anxhelo Lushka;2020 website design;https://avatars2.githubusercontent.com/u/25004151?s=60&v=4\n+ByteHamster;Project lead;https://avatars2.githubusercontent.com/u/5811634?s=60&v=4;ByteHamster\n+Keunes;Project lead;https://avatars2.githubusercontent.com/u/11229646?s=60&v=4;Keunes\n+Femmdi;Translations coordinator;https://avatars2.githubusercontent.com/u/47671383?s=60&v=4;Femmdi\n+Ryan Gorley (Freehive);2023 brand design;https://avatars2.githubusercontent.com/u/12849958?s=60&v=4;Freehive\n+221 Pixels;2020 brand design;https://avatars2.githubusercontent.com/u/58243143?s=60&v=4;221pxls\n+Anxhelo Lushka;2020 website design;https://avatars2.githubusercontent.com/u/25004151?s=60&v=4;AnXh3L0\ndiff --git a/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/about/DevelopersFragment.java b/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/about/DevelopersFragment.java\nindex de5a21bc00..c10ca42807 100644\n--- a/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/about/DevelopersFragment.java\n+++ b/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/about/DevelopersFragment.java\n@@ -2,10 +2,13 @@\n \n import android.os.Bundle;\n import android.view.View;\n+import android.widget.ListView;\n import android.widget.Toast;\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n import androidx.fragment.app.ListFragment;\n+\n+import de.danoeh.antennapod.ui.common.IntentUtils;\n import io.reactivex.Single;\n import io.reactivex.SingleOnSubscribe;\n import io.reactivex.android.schedulers.AndroidSchedulers;\n@@ -18,15 +21,15 @@\n \n public class DevelopersFragment extends ListFragment {\n     private Disposable developersLoader;\n+    private ArrayList<SimpleIconListAdapter.ListItem> developers = new ArrayList<>();\n \n     @Override\n     public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {\n         super.onViewCreated(view, savedInstanceState);\n         getListView().setDivider(null);\n-        getListView().setSelector(android.R.color.transparent);\n \n         developersLoader = Single.create((SingleOnSubscribe<ArrayList<SimpleIconListAdapter.ListItem>>) emitter -> {\n-            ArrayList<SimpleIconListAdapter.ListItem> developers = new ArrayList<>();\n+            developers.clear();\n             BufferedReader reader = new BufferedReader(new InputStreamReader(\n                     getContext().getAssets().open(\"developers.csv\"), \"UTF-8\"));\n             String line;\n@@ -43,7 +46,12 @@ public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceStat\n                 developers -> setListAdapter(new SimpleIconListAdapter<>(getContext(), developers)),\n                 error -> Toast.makeText(getContext(), error.getMessage(), Toast.LENGTH_LONG).show()\n         );\n+    }\n \n+    @Override\n+    public void onListItemClick(@NonNull ListView l, @NonNull View v, int position, long id) {\n+        super.onListItemClick(l, v, position, id);\n+        IntentUtils.openInBrowser(getContext(), \"https://github.com/\" + developers.get(position).title);\n     }\n \n     @Override\ndiff --git a/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/about/SimpleIconListAdapter.java b/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/about/SimpleIconListAdapter.java\nindex a63b54e5a4..450f84f78a 100644\n--- a/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/about/SimpleIconListAdapter.java\n+++ b/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/about/SimpleIconListAdapter.java\n@@ -6,9 +6,13 @@\n import android.widget.ArrayAdapter;\n import android.widget.ImageView;\n import android.widget.TextView;\n+\n import com.bumptech.glide.Glide;\n import com.bumptech.glide.load.engine.DiskCacheStrategy;\n+import com.bumptech.glide.load.resource.bitmap.FitCenter;\n+import com.bumptech.glide.load.resource.bitmap.RoundedCorners;\n import com.bumptech.glide.request.RequestOptions;\n+\n import de.danoeh.antennapod.ui.preferences.R;\n \n import java.util.List;\n@@ -35,13 +39,19 @@ public View getView(int position, View view, ViewGroup parent) {\n         ListItem item = listItems.get(position);\n         ((TextView) view.findViewById(R.id.title)).setText(item.title);\n         ((TextView) view.findViewById(R.id.subtitle)).setText(item.subtitle);\n-        Glide.with(context)\n-                .load(item.imageUrl)\n-                .apply(new RequestOptions()\n-                        .diskCacheStrategy(DiskCacheStrategy.NONE)\n-                        .fitCenter()\n-                        .dontAnimate())\n-                .into(((ImageView) view.findViewById(R.id.icon)));\n+\n+        if (item.imageUrl == null) {\n+            view.findViewById(R.id.icon).setVisibility(View.GONE);\n+        } else {\n+            Glide.with(context)\n+                    .load(item.imageUrl)\n+                    .apply(new RequestOptions()\n+                            .diskCacheStrategy(DiskCacheStrategy.NONE)\n+                            .transform(new FitCenter(), new RoundedCorners((int)\n+                                    (4 * context.getResources().getDisplayMetrics().density)))\n+                            .dontAnimate())\n+                    .into(((ImageView) view.findViewById(R.id.icon)));\n+        }\n         return view;\n     }\n \ndiff --git a/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/about/SpecialThanksFragment.java b/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/about/SpecialThanksFragment.java\nindex 7e9860036c..32335880c2 100644\n--- a/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/about/SpecialThanksFragment.java\n+++ b/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/about/SpecialThanksFragment.java\n@@ -2,10 +2,13 @@\n \n import android.os.Bundle;\n import android.view.View;\n+import android.widget.ListView;\n import android.widget.Toast;\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n import androidx.fragment.app.ListFragment;\n+\n+import de.danoeh.antennapod.ui.common.IntentUtils;\n import io.reactivex.Single;\n import io.reactivex.SingleOnSubscribe;\n import io.reactivex.android.schedulers.AndroidSchedulers;\n@@ -19,22 +22,23 @@\n public class SpecialThanksFragment extends ListFragment {\n     private Disposable translatorsLoader;\n \n+    private ArrayList<SpecialMemberItem> specialMembers = new ArrayList<>();\n+\n     @Override\n     public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {\n         super.onViewCreated(view, savedInstanceState);\n         getListView().setDivider(null);\n-        getListView().setSelector(android.R.color.transparent);\n \n-        translatorsLoader = Single.create((SingleOnSubscribe<ArrayList<SimpleIconListAdapter.ListItem>>) emitter -> {\n-            ArrayList<SimpleIconListAdapter.ListItem> translators = new ArrayList<>();\n+        translatorsLoader = Single.create((SingleOnSubscribe<ArrayList<SpecialMemberItem>>) emitter -> {\n+            specialMembers.clear();\n             BufferedReader reader = new BufferedReader(new InputStreamReader(\n                     getContext().getAssets().open(\"special_thanks.csv\"), \"UTF-8\"));\n             String line;\n             while ((line = reader.readLine()) != null) {\n                 String[] info = line.split(\";\");\n-                translators.add(new SimpleIconListAdapter.ListItem(info[0], info[1], info[2]));\n+                specialMembers.add(new SpecialMemberItem(info[0], info[1], info[2], info[3]));\n             }\n-            emitter.onSuccess(translators);\n+            emitter.onSuccess(specialMembers);\n         })\n         .subscribeOn(Schedulers.io())\n         .observeOn(AndroidSchedulers.mainThread())\n@@ -42,7 +46,22 @@ public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceStat\n                 translators -> setListAdapter(new SimpleIconListAdapter<>(getContext(), translators)),\n                 error -> Toast.makeText(getContext(), error.getMessage(), Toast.LENGTH_LONG).show()\n         );\n+    }\n+\n+    private static class SpecialMemberItem extends SimpleIconListAdapter.ListItem {\n+        final String githubUsername;\n+\n+        SpecialMemberItem(String title, String subtitle, String imageUrl, String gitHubUsername) {\n+            super(title, subtitle, imageUrl);\n+            this.githubUsername = gitHubUsername;\n+        }\n+    }\n+\n+    @Override\n+    public void onListItemClick(@NonNull ListView l, @NonNull View v, int position, long id) {\n+        super.onListItemClick(l, v, position, id);\n \n+        IntentUtils.openInBrowser(getContext(), \"https://github.com/\" + specialMembers.get(position).githubUsername);\n     }\n \n     @Override\n", "test_patch": "", "problem_statement": "Rounded corners for contributor avatars\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.3.2f (develop branch)\n\n### Where did you get the app from\n\nOther\n\n### Problem you may be having, or feature you want\n\nAll over the app we are using (somewhat) rounded corners on images.\r\nHowever, the avatars of contributors have sharp corners.\n\n### Suggested solution\n\nMake the avatars display with round corners.\n\n### Screenshots / Drawings / Technical details\n\n**Screenshots (before/after)**\r\n![IMAGE 2024-04-20 13:33:10](https://github.com/AntennaPod/AntennaPod/assets/21206831/c0b76f7c-6226-4e0c-8366-0adf8927a535)\r\n\r\n**Technical Details**\r\nCurrently I am using the follwing code to determine the roundness of the corners. I think it looks the best, but if you have suggestions for a different size please let me know.\r\n```Java\r\n new RoundedCorners((int) (6 * context.getResources().getDisplayMetrics().density))\r\n ```\r\n \r\n Also I already implemented the change and will open an PR as soon as this change is approved.\nFill empty space on translation and licences screen\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.3.2f (develop branch)\n\n### Where did you get the app from\n\nOther\n\n### Problem you may be having, or feature you want\n\nThe translation and licences screen both reserve empty space for an image but are never called with an URL to display such an image.\n\n### Suggested solution\n\nSince no image will be displayed we don't need to reserve space here.\n\n### Screenshots / Drawings / Technical details\n\n**Screenshots (before/after):**\r\n![image](https://github.com/AntennaPod/AntennaPod/assets/21206831/8a9281ca-2278-4d25-b10b-fe68b394d8bb)\r\n\r\n**Technical Details:**\r\nI already implemented the change in the `SimpleIconListAdapter` and will open the PR if the feature gets approved.\r\nThe image only is hidden if the `imageUrl` is `null`, which means that for the `Contributors` and the `Special thanks` screens nothing changes.\r\n\n", "hints_text": "\n", "created_at": "2024-04-21T21:03:41Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7127, "instance_id": "AntennaPod__AntennaPod-7127", "issue_numbers": ["7078"], "base_commit": "cf99a0e07e8f6ffba8551dda7791c5301c607a7a", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java\nindex 884472b8d4..30319c38b6 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java\n@@ -10,6 +10,7 @@\n import androidx.annotation.NonNull;\n import androidx.fragment.app.Fragment;\n \n+import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import com.google.android.material.snackbar.Snackbar;\n \n import java.util.Arrays;\n@@ -71,6 +72,7 @@ public static boolean onPrepareMenu(Menu menu, List<FeedItem> selectedItems, int\n         boolean canAddFavorite = false;\n         boolean canRemoveFavorite = false;\n         boolean canShowTranscript = false;\n+        boolean canShowSocialInteract = false;\n \n         for (FeedItem item : selectedItems) {\n             boolean hasMedia = item.getMedia() != null;\n@@ -88,12 +90,14 @@ public static boolean onPrepareMenu(Menu menu, List<FeedItem> selectedItems, int\n             canAddFavorite |= !item.isTagged(FeedItem.TAG_FAVORITE);\n             canRemoveFavorite |= item.isTagged(FeedItem.TAG_FAVORITE);\n             canShowTranscript |= item.hasTranscript();\n+            canShowSocialInteract |= item.getSocialInteractUrl() != null;\n         }\n \n         if (selectedItems.size() > 1) {\n             canVisitWebsite = false;\n             canShare = false;\n             canShowTranscript = false;\n+            canShowSocialInteract = false;\n         }\n \n         setItemVisibility(menu, R.id.skip_episode_item, canSkip);\n@@ -105,6 +109,7 @@ public static boolean onPrepareMenu(Menu menu, List<FeedItem> selectedItems, int\n         setItemVisibility(menu, R.id.mark_read_item, canMarkPlayed);\n         setItemVisibility(menu, R.id.mark_unread_item, canMarkUnplayed);\n         setItemVisibility(menu, R.id.reset_position, canResetPosition);\n+        setItemVisibility(menu, R.id.open_social_interact_url, canShowSocialInteract);\n \n         // Display proper strings when item has no media\n         if (selectedItems.size() == 1 && selectedItems.get(0).getMedia() == null) {\n@@ -225,6 +230,15 @@ public static boolean onMenuItemClicked(@NonNull Fragment fragment, int menuItem\n             DBWriter.markItemPlayed(selectedItem, FeedItem.UNPLAYED, true);\n         } else if (menuItemId == R.id.visit_website_item) {\n             IntentUtils.openInBrowser(context, selectedItem.getLinkWithFallback());\n+        } else if (menuItemId == R.id.open_social_interact_url) {\n+            new MaterialAlertDialogBuilder(context)\n+                    .setTitle(R.string.visit_social_interact_query_title)\n+                    .setMessage(context.getString(R.string.visit_social_interact_query_message,\n+                            selectedItem.getSocialInteractUrl()))\n+                    .setPositiveButton(R.string.confirm_label, (dialog, which) ->\n+                            IntentUtils.openInBrowser(context, selectedItem.getSocialInteractUrl()))\n+                    .setNegativeButton(R.string.cancel_label, null)\n+                    .show();\n         } else if (menuItemId == R.id.share_item) {\n             ShareDialog shareDialog = ShareDialog.newInstance(selectedItem);\n             shareDialog.show((fragment.getActivity().getSupportFragmentManager()), \"ShareEpisodeDialog\");\ndiff --git a/app/src/main/res/menu/mediaplayer.xml b/app/src/main/res/menu/mediaplayer.xml\nindex 85eef565b6..797cf1fdf4 100644\n--- a/app/src/main/res/menu/mediaplayer.xml\n+++ b/app/src/main/res/menu/mediaplayer.xml\n@@ -2,12 +2,6 @@\n <menu xmlns:android=\"http://schemas.android.com/apk/res/android\"\n       xmlns:custom=\"http://schemas.android.com/apk/res-auto\">\n \n-    <item\n-        android:id=\"@+id/transcript_item\"\n-        android:icon=\"@drawable/transcript\"\n-        android:title=\"@string/show_transcript\"\n-        custom:showAsAction=\"ifRoom\">\n-    </item>\n     <item\n         android:id=\"@+id/add_to_favorites_item\"\n         android:icon=\"@drawable/ic_star_border\"\n@@ -78,6 +72,20 @@\n         android:visible=\"false\">\n     </item>\n \n+    <item\n+        android:id=\"@+id/transcript_item\"\n+        android:icon=\"@drawable/transcript\"\n+        android:title=\"@string/show_transcript\"\n+        custom:showAsAction=\"never\">\n+    </item>\n+\n+    <item\n+        android:id=\"@+id/open_social_interact_url\"\n+        android:icon=\"@drawable/ic_chat\"\n+        custom:showAsAction=\"never\"\n+        android:title=\"@string/visit_social_interact_label\">\n+    </item>\n+\n     <item\n         android:id=\"@+id/share_item\"\n         android:icon=\"@drawable/ic_share\"\ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItem.java b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItem.java\nindex 5b704c095d..4e2a17e4d4 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItem.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItem.java\n@@ -44,6 +44,7 @@ public class FeedItem implements Serializable {\n     private transient Feed feed;\n     private long feedId;\n     private String podcastIndexChapterUrl;\n+    private String socialInteractUrl;\n     private String podcastIndexTranscriptUrl;\n     private String podcastIndexTranscriptType;\n     private String podcastIndexTranscriptText;\n@@ -89,7 +90,7 @@ public FeedItem() {\n     public FeedItem(long id, String title, String link, Date pubDate, String paymentLink, long feedId,\n                     boolean hasChapters, String imageUrl, int state,\n                     String itemIdentifier, boolean autoDownloadEnabled, String podcastIndexChapterUrl,\n-                    String transcriptType, String transcriptUrl) {\n+                    String transcriptType, String transcriptUrl, String socialInteractUrl) {\n         this.id = id;\n         this.title = title;\n         this.link = link;\n@@ -102,6 +103,7 @@ public FeedItem(long id, String title, String link, Date pubDate, String payment\n         this.itemIdentifier = itemIdentifier;\n         this.autoDownloadEnabled = autoDownloadEnabled;\n         this.podcastIndexChapterUrl = podcastIndexChapterUrl;\n+        this.socialInteractUrl = socialInteractUrl;\n         if (transcriptUrl != null) {\n             this.podcastIndexTranscriptUrl = transcriptUrl;\n             this.podcastIndexTranscriptType = transcriptType;\n@@ -172,6 +174,9 @@ public void updateFromOther(FeedItem other) {\n         if (other.podcastIndexChapterUrl != null) {\n             podcastIndexChapterUrl = other.podcastIndexChapterUrl;\n         }\n+        if (other.socialInteractUrl != null) {\n+            socialInteractUrl = other.socialInteractUrl;\n+        }\n         if (other.getTranscriptUrl() != null) {\n             podcastIndexTranscriptUrl = other.podcastIndexTranscriptUrl;\n         }\n@@ -429,6 +434,14 @@ public void setPodcastIndexChapterUrl(String url) {\n         podcastIndexChapterUrl = url;\n     }\n \n+    public void setSocialInteractUrl(String url) {\n+        socialInteractUrl = url;\n+    }\n+\n+    public String getSocialInteractUrl() {\n+        return socialInteractUrl;\n+    }\n+\n     public void setTranscriptUrl(String type, String url) {\n         updateTranscriptPreferredFormat(type, url);\n     }\ndiff --git a/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/namespace/PodcastIndex.java b/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/namespace/PodcastIndex.java\nindex 8b49831fe5..b38665e1e4 100644\n--- a/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/namespace/PodcastIndex.java\n+++ b/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/namespace/PodcastIndex.java\n@@ -12,8 +12,10 @@ public class PodcastIndex extends Namespace {\n     public static final String NSURI = \"https://github.com/Podcastindex-org/podcast-namespace/blob/main/docs/1.0.md\";\n     public static final String NSURI2 = \"https://podcastindex.org/namespace/1.0\";\n     private static final String URL = \"url\";\n+    private static final String URI = \"uri\";\n     private static final String FUNDING = \"funding\";\n     private static final String CHAPTERS = \"chapters\";\n+    private static final String SOCIAL_INTERACT = \"socialInteract\";\n     private static final String TRANSCRIPT = \"transcript\";\n     private static final String TYPE = \"type\";\n \n@@ -30,6 +32,11 @@ public SyndElement handleElementStart(String localName, HandlerState state,\n             if (!TextUtils.isEmpty(href)) {\n                 state.getCurrentItem().setPodcastIndexChapterUrl(href);\n             }\n+        } else if (SOCIAL_INTERACT.equals(localName)) {\n+            String href = attributes.getValue(URI);\n+            if (!TextUtils.isEmpty(href) && state.getCurrentItem() != null) {\n+                state.getCurrentItem().setSocialInteractUrl(href);\n+            }\n         } else if (TRANSCRIPT.equals(localName)) {\n             String href = attributes.getValue(URL);\n             String type = attributes.getValue(TYPE);\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java\nindex 5f5893124a..b781148308 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java\n@@ -349,6 +349,10 @@ static void upgrade(final SQLiteDatabase db, final int oldVersion, final int new\n             db.execSQL(\"ALTER TABLE \" + PodDBAdapter.TABLE_NAME_FEED_ITEMS\n                     + \" ADD COLUMN \" + PodDBAdapter.KEY_PODCASTINDEX_TRANSCRIPT_TYPE + \" TEXT\");\n         }\n+        if (oldVersion < 3080000) {\n+            db.execSQL(\"ALTER TABLE \" + PodDBAdapter.TABLE_NAME_FEED_ITEMS\n+                    + \" ADD COLUMN \" + PodDBAdapter.KEY_SOCIAL_INTERACT_URL + \" TEXT\");\n+        }\n     }\n \n }\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\nindex 8f8d03927c..3e7b5ac530 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n@@ -52,7 +52,7 @@ public class PodDBAdapter {\n \n     private static final String TAG = \"PodDBAdapter\";\n     public static final String DATABASE_NAME = \"Antennapod.db\";\n-    public static final int VERSION = 3050000;\n+    public static final int VERSION = 3080000;\n \n     /**\n      * Maximum number of arguments for IN-operator.\n@@ -121,6 +121,7 @@ public class PodDBAdapter {\n     public static final String KEY_EPISODE_NOTIFICATION = \"episode_notification\";\n     public static final String KEY_NEW_EPISODES_ACTION = \"new_episodes_action\";\n     public static final String KEY_PODCASTINDEX_CHAPTER_URL = \"podcastindex_chapter_url\";\n+    public static final String KEY_SOCIAL_INTERACT_URL = \"social_interact_url\";\n     public static final String KEY_STATE = \"state\";\n     public static final String KEY_PODCASTINDEX_TRANSCRIPT_URL = \"podcastindex_transcript_url\";\n     public static final String KEY_PODCASTINDEX_TRANSCRIPT_TYPE = \"podcastindex_transcript_type\";\n@@ -188,7 +189,8 @@ public class PodDBAdapter {\n             + KEY_AUTO_DOWNLOAD_ENABLED + \" INTEGER,\"\n             + KEY_PODCASTINDEX_CHAPTER_URL + \" TEXT,\"\n             + KEY_PODCASTINDEX_TRANSCRIPT_TYPE + \" TEXT,\"\n-            + KEY_PODCASTINDEX_TRANSCRIPT_URL + \" TEXT\" + \")\";\n+            + KEY_PODCASTINDEX_TRANSCRIPT_URL + \" TEXT,\"\n+            + KEY_SOCIAL_INTERACT_URL + \" TEXT)\";\n \n     private static final String CREATE_TABLE_FEED_MEDIA = \"CREATE TABLE \"\n             + TABLE_NAME_FEED_MEDIA + \" (\" + TABLE_PRIMARY_KEY + KEY_DURATION\n@@ -277,6 +279,7 @@ public class PodDBAdapter {\n             + TABLE_NAME_FEED_ITEMS + \".\" + KEY_IMAGE_URL + \", \"\n             + TABLE_NAME_FEED_ITEMS + \".\" + KEY_AUTO_DOWNLOAD_ENABLED + \", \"\n             + TABLE_NAME_FEED_ITEMS + \".\" + KEY_PODCASTINDEX_CHAPTER_URL + \", \"\n+            + TABLE_NAME_FEED_ITEMS + \".\" + KEY_SOCIAL_INTERACT_URL + \", \"\n             + TABLE_NAME_FEED_ITEMS + \".\" + KEY_PODCASTINDEX_TRANSCRIPT_TYPE + \", \"\n             + TABLE_NAME_FEED_ITEMS + \".\" + KEY_PODCASTINDEX_TRANSCRIPT_URL;\n \n@@ -680,6 +683,7 @@ private long updateOrInsertFeedItem(FeedItem item, boolean saveFeed) {\n         values.put(KEY_AUTO_DOWNLOAD_ENABLED, item.isAutoDownloadEnabled());\n         values.put(KEY_IMAGE_URL, item.getImageUrl());\n         values.put(KEY_PODCASTINDEX_CHAPTER_URL, item.getPodcastIndexChapterUrl());\n+        values.put(KEY_SOCIAL_INTERACT_URL, item.getSocialInteractUrl());\n \n         // We only store one transcript url, we prefer JSON if it exists\n         String type = item.getTranscriptType();\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemCursor.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemCursor.java\nindex e771133ffe..64f42306c3 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemCursor.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemCursor.java\n@@ -25,6 +25,7 @@ public class FeedItemCursor extends CursorWrapper {\n     private final int indexAutoDownload;\n     private final int indexImageUrl;\n     private final int indexPodcastIndexChapterUrl;\n+    private final int indexSocialInteractUrl;\n     private final int indexMediaId;\n     private final int indexPodcastIndexTranscriptType;\n     private final int indexPodcastIndexTranscriptUrl;\n@@ -45,6 +46,7 @@ public FeedItemCursor(Cursor cursor) {\n         indexImageUrl = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_IMAGE_URL);\n         indexPodcastIndexChapterUrl = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_PODCASTINDEX_CHAPTER_URL);\n         indexMediaId = cursor.getColumnIndexOrThrow(PodDBAdapter.SELECT_KEY_MEDIA_ID);\n+        indexSocialInteractUrl = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_SOCIAL_INTERACT_URL);\n         indexPodcastIndexTranscriptType = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_PODCASTINDEX_TRANSCRIPT_TYPE);\n         indexPodcastIndexTranscriptUrl = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_PODCASTINDEX_TRANSCRIPT_URL);\n     }\n@@ -68,7 +70,8 @@ public FeedItem getFeedItem() {\n                 getLong(indexAutoDownload) > 0,\n                 getString(indexPodcastIndexChapterUrl),\n                 getString(indexPodcastIndexTranscriptType),\n-                getString(indexPodcastIndexTranscriptUrl));\n+                getString(indexPodcastIndexTranscriptUrl),\n+                getString(indexSocialInteractUrl));\n         if (!isNull(indexMediaId)) {\n             item.setMedia(feedMediaCursor.getFeedMedia());\n         }\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex ab23c0e47b..542b4ffed4 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -273,6 +273,9 @@\n     <string name=\"no_transcript_label\">No transcript</string>\n     <string name=\"remove_from_favorite_label\">Remove from favorites</string>\n     <string name=\"visit_website_label\">Visit website</string>\n+    <string name=\"visit_social_interact_label\">Show comments</string>\n+    <string name=\"visit_social_interact_query_title\">You are leaving AntennaPod</string>\n+    <string name=\"visit_social_interact_query_message\">Please make sure that you trust the website \\\"%1$s\\\".</string>\n     <string name=\"skip_episode_label\">Skip episode</string>\n     <string name=\"reset_position\">Reset playback position</string>\n     <string name=\"no_items_selected\">No items selected</string>\n", "test_patch": "", "problem_statement": "Support for comments based on ActivityPub (`podcast:socialInteract`)\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\r\n\r\n### App version\r\n\r\n3.3.2\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Problem you may be having, or feature you want\r\n\r\nI would like be able to comments on podcast episodes and also see and reply to existing comments on podcast episodes.\r\n\r\n### Suggested solution\r\n\r\nThere are some existing support for comments on RSS 2.0[^rss20-comments] and RSS extension namespaces (reference needed). Most recently, the _Podcasting 2.0_ `podcast` namespace introduced the tag `podcast:socialInteract`[^podcast-socialInteract]. Among other things, the main function of this tag is to enable support for distributed comments for episodes through the ActivityPub protocol. This enables listeners to comment on episodes from any ActivityPub enabled instance, such as _Mastodon_ instances, meaning that podcast comments will be part of the so called Fediverse (https://fediverse.info/, https://axbom.com/fediverse/).\r\n\r\nAntennaPod could use this to show comments for podcast episodes and also allow, with different functional degrees, that users would also author comments and reply to existing comments.\r\n\r\n### Screenshots / Drawings / Technical details\r\n\r\n## Screenshots\r\n\r\nComments shown on podcastindex.org for one of the episodes of the Podcasting 2.0 podcast:\r\n![image](https://github.com/AntennaPod/AntennaPod/assets/260113/64c087b8-159d-4fb7-8637-c3980ac071a1)\r\n\r\nComments shown on Podverse for one of the episodes of the Podcasting 2.0 podcast:\r\n![image](https://github.com/AntennaPod/AntennaPod/assets/260113/53be3fd0-9d7e-427b-b4cc-cc2f0c3bce83)\r\n\r\n## Technical Details\r\n\r\nThe XML tag `podcasting:socialInteract` [^podcast-socialInteract] can be used under the RSS `<item>` tag as in the example:\r\n```xml\r\n<podcast:socialInteract \r\n        uri=\"https://podcastindex.social/web/@dave/108013847520053258\" \r\n        protocol=\"activitypub\"\r\n/>\r\n```\r\n\r\nAlthough there are other protocols that can be used, `activitypub` indicates that the URL indicated on the `uri` parameter points to an ActivityPub _Activity_, usually a _Note_. This _Activity_ is considered a _root comment_, and all the other comments will be either replies to this comment, or replies to replies, forming a (possibly deep) tree.\r\n\r\n**A brief word on ActivityPub**: It provides two **APIs**, a Client to Server (C2S) one and a Server to Server (S2S) one. The S2S one is predominantly more mature in the ecosystem, as it is required for interoperability between servers. The C2S is far less mature and, in certain aspects, underspecified.  The interoperability between Clients and Servers often falls back to the [Mastodon API](https://docs.joinmastodon.org/api/). Nevertheless, a combination of ActivityPub C2S and Mastodon APIs is currently the only known way in use to generally fetch comments for a cross-app comments. \r\n\r\n### Fetching the comments\r\n\r\nTo fetch comments, one can fetch the _Activity_ url of the _root post_, with the header `Accept: application/ld+json; profile=\"https://www.w3.org/ns/activitystreams\"`. Here is an example of a response body:\r\n\r\n```json\r\n{\r\n  \"@context\": [\r\n    \"https://www.w3.org/ns/activitystreams\",\r\n    {\r\n      \"ostatus\": \"http://ostatus.org#\",\r\n      \"atomUri\": \"ostatus:atomUri\",\r\n      \"inReplyToAtomUri\": \"ostatus:inReplyToAtomUri\",\r\n      \"conversation\": \"ostatus:conversation\",\r\n      \"sensitive\": \"as:sensitive\",\r\n      \"toot\": \"http://joinmastodon.org/ns#\",\r\n      \"votersCount\": \"toot:votersCount\"\r\n    }\r\n  ],\r\n  \"id\": \"https://podcastindex.social/users/dave/statuses/110634382833124876\",\r\n  \"type\": \"Note\",\r\n  \"summary\": null,\r\n  \"inReplyTo\": null,\r\n  \"published\": \"2023-06-30T17:38:30Z\",\r\n  \"url\": \"https://podcastindex.social/@dave/110634382833124876\",\r\n  \"attributedTo\": \"https://podcastindex.social/users/dave\",\r\n  \"to\": [\r\n    \"https://www.w3.org/ns/activitystreams#Public\"\r\n  ],\r\n  \"cc\": [\r\n    \"https://podcastindex.social/users/dave/followers\"\r\n  ],\r\n  \"sensitive\": false,\r\n  \"atomUri\": \"https://podcastindex.social/users/dave/statuses/110634382833124876\",\r\n  \"inReplyToAtomUri\": null,\r\n  \"conversation\": \"tag:podcastindex.social,2023-06-30:objectId=7365466:objectType=Conversation\",\r\n  \"content\": \"<omitted>\",\r\n  \"contentMap\": {\r\n    \"en\": \"<omitted>\"\r\n  },\r\n  \"attachment\": [],\r\n  \"tag\": [],\r\n  \"replies\": {\r\n    \"id\": \"https://podcastindex.social/users/dave/statuses/110634382833124876/replies\",\r\n    \"type\": \"Collection\",\r\n    \"first\": {\r\n      \"type\": \"CollectionPage\",\r\n      \"next\": \"https://podcastindex.social/users/dave/statuses/110634382833124876/replies?only_other_accounts=true&page=true\",\r\n      \"partOf\": \"https://podcastindex.social/users/dave/statuses/110634382833124876/replies\",\r\n      \"items\": []\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nFetching the `replies` recursively, it is possible to build the full tree of comments.\r\nThe comments are public and do not require authentication.\r\n\r\n**Known quirks:**\r\n- _Pleroma_ does not return replies with the AP C2S API, but it does with the Mastodon API[^pleroma-empty-replies-issue-3061]\r\n- Older versions of _Mastodon_ will \"loop\" around the responses, so it is necessary to have a stop criteria when it starts a new loop (back again to the first item)[^mastodon-replies-issue-12442]\r\n\r\n### References\r\n\r\n- example feed - https://feeds.podcastindex.org/pc20.xml\r\n- `podcasting:socialInteract` tag specification - https://github.com/Podcastindex-org/podcast-namespace/blob/main/docs/1.0.md#social-interact\r\n- ActivityPub W3C Recommendation - https://www.w3.org/TR/activitypub/\r\n- Activity Vocabulary W3C Recommendation - https://www.w3.org/TR/activitystreams-vocabulary/\r\n- https://activitypub.rocks/\r\n    - https://socialhub.activitypub.rocks/\r\n        - https://socialhub.activitypub.rocks/\r\n- https://github.com/Podcastindex-org/podcast-namespace/discussions/623 \r\n- https://github.com/podStation/podStation/issues/304 - research notes for the eventual implementation of this feature in podStation\r\n- https://www.npmjs.com/package/threadcap - a Javascript package that implements the logic for fetching comments, including several needed workarounds due to the current limitations to Client to Server (C2S) implementations of ActivityPub\r\n\r\n<!-- footnotes -->\r\n[^rss20-comments]: Embeddable comments defined in RSS 2.0: https://www.rssboard.org/rss-weblog-comments-use-case\r\n[^podcast-socialInteract]: `podcasting:socialInteract` tag specification - https://github.com/Podcastindex-org/podcast-namespace/blob/main/docs/1.0.md#social-interact\r\n[^mastodon-replies-issue-12442]: Mastodon issue https://github.com/mastodon/mastodon/issues/17442 (list item 4 describes the infinite loop)\r\n[^pleroma-empty-replies-issue-3061]: Pleroma issue about empty replies on ActivityPub C2S API Chttps://git.pleroma.social/pleroma/pleroma/-/issues/3061\n", "hints_text": "Please add the label \"Area: Podcast Index / Podcasting 2.0\" to this issue.\nThanks for posting this @dellagustin. Some discussions on the approach are to be had, I think. One approach is AntennaPod becoming an AP client, another is to recognise the existence of the tag and opening it in dedicated apps.\n\nAnd a key point is Google's requirements when UGC is concerned: https://github.com/Tunous/Dawn/issues/642\n> Thanks for posting this @dellagustin. Some discussions on the approach are to be had, I think. One approach is AntennaPod becoming an AP client, another is to recognise the existence of the tag and opening it in dedicated apps.\n> \n> And a key point is Google's requirements when UGC is concerned: https://github.com/Tunous/Dawn/issues/642\n\nThank you for the reply. Sure, I suppose we will need a lot of discussion on many aspects of this feature. I'm hoping that we will be able to enable Antennapod as a AP client, but let's see. I'll check the UGC topic, I need to learn more about that.\n@keunes I am interested in working on this feature.  \n\nWhat do you think of\n\nPhase 1:\n\n1. Displaying comments only threaded mode\n\nPhase 2: \n\n1. Allow to jump to an external website for posting comments, no need for auth inside of AP\n\nPhase 3:\n\n1. Allow for posting comments directly inside of AP, figure out a way to store login credentials in AP\nTo be honest, in order to hopefully get fewer problems with UGC things on Google Play, I would just open that URL in a web browser instead of showing user comments directly inside AntennaPod\n@tonytamsf , @keunes , @ByteHamster , I can't comment on the do's and don'ts of User Generated Content (UGC) at the moment due to lack of knowledge and experience with the topic, but I'm hoping to familiarize myself with it in the near future.\r\n\r\nThat said, and assuming we eventually conclude there is a safe way to show UGC in the app, my suggestion for the phased approach would be:\r\n\r\n1. **Phase 1**: Show the link to navigate to comments (no issue with UGC)\r\n    * For this phase we could support both `<podcast:socialInteract>` and the RSS 2.0 _native_ `<comments>`[^rss-elements-of-item]  tags. \r\n2. **Phase 2**: Show the comments thread in AntennaPod + a link to open the links and comment outside of AntennaPod\r\n    * There is an optional workflow here that would make easier to comment, but I'll need to elaborate how it works later\r\n3. **Phase 3** Allow posting comments directly from AntennaPod\r\n\r\nI'd be already happy with Phase 1, as it would raise awareness and curiosity towards ActivityPub based comments and the Fediverse, which I think resonates very well with the distributed and open nature of the podcasting ecosystem.\r\n\r\nNevertheless, I think it would be great if we could go beyond and also support Phase 2 and 3 eventually.\r\n\r\n[^rss-elements-of-item]: [RSS 2.0 Specification - Elements of <item>](https://www.rssboard.org/rss-specification#hrelementsOfLtitemgt)\n> To be honest, in order to hopefully get fewer problems with UGC things on Google Play, I would just open that URL in a web browser instead of showing user comments directly inside AntennaPod\r\n\r\nIf it's simply displaying a link to the commenting, I can work on this.  @keunes thoughts on where to put the link?  next to the Transcript and favorite icons on the player screen?  Or off to a menu drop down?\n> next to the Transcript and favorite icons on the player screen?\n\nSounds good. I think we should also add it to the podcast detail view, somehow. Maybe in the top app bar as well?\n\nWhat might be cool (but no idea how complex this is) is to show a bubble with a number, indicating the number of replies.\n\n> Sounds good. I think we should also add it to the podcast detail view, somehow. Maybe in the top app bar as well?\n> \n\nWhere would you place the link? I can show you a work in progress soon.\nI think the link should be:\r\n* On the player view, I don't know exactly where, without cramming it. Perhaps as a new icon on the top. Where is the transcript currently show? I could not find that.\r\n* AND On the episode view, ideally somewhat prominently, either an icon on the top or a new button together with Stream / Download?\r\n\r\nSorry, I'm not familiar yet with the terminology used in AntennaPod for the UI elements.\r\n\r\n>  I think we should also add it to the podcast detail view, somehow\r\n\r\nTo the podcast detail view? I'm not sure I understood, but comments are so far are on episode levels, not podcast level. Nevertheless, in the future I hope that there will be a tag pointing to the ActivityPub _Actor_ that represents the podcast.\r\n\r\n> What might be cool (but no idea how complex this is) is to show a bubble with a number, indicating the number of replies\r\n\r\nIt would be cool, but not practical to implement. To get the number of comments would mean fetching and counting all replies, that would require a good number of HTTP requests.\n> Where would you place the link? I can show you a work in progress soon.\n>\n> To the podcast detail view? I'm not sure I understood, but comments are so far are on episode levels, not podcast level.\n\nSorry, I meant episode detail view indeed. Same icon and placing as in the player.\n\n", "created_at": "2024-04-21T14:59:54Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7103, "instance_id": "AntennaPod__AntennaPod-7103", "issue_numbers": ["4935"], "base_commit": "1edceb1b977d9dbffe916ecc187edd67870e55ab", "patch": "diff --git a/.github/workflows/checks.yml b/.github/workflows/checks.yml\nindex 6431f31252..0d8ef46c13 100644\n--- a/.github/workflows/checks.yml\n+++ b/.github/workflows/checks.yml\n@@ -102,7 +102,7 @@ jobs:\n   emulator-test:\n     name: \"Emulator Test\"\n     needs: static-analysis\n-    runs-on: macOS-latest\n+    runs-on: ubuntu-latest\n     timeout-minutes: 45\n     env:\n       api-level: 30\n@@ -124,6 +124,11 @@ jobs:\n         run: echo \"org.gradle.parallel=true\" >> local.properties\n       - name: Build with Gradle\n         run: ./gradlew assemblePlayDebugAndroidTest\n+      - name: Enable KVM group perms\n+        run: |\n+          echo 'KERNEL==\"kvm\", GROUP=\"kvm\", MODE=\"0666\", OPTIONS+=\"static_node=kvm\"' | sudo tee /etc/udev/rules.d/99-kvm4all.rules\n+          sudo udevadm control --reload-rules\n+          sudo udevadm trigger --name-match=kvm\n       - name: Android Emulator test\n         uses: reactivecircus/android-emulator-runner@v2\n         with:\n@@ -133,7 +138,7 @@ jobs:\n           force-avd-creation: false\n           emulator-options: -no-snapshot-save -no-window -gpu swiftshader_indirect -noaudio -no-boot-anim -camera-back none\n           disable-animations: true\n-          script: zsh .github/workflows/runEmulatorTests.sh\n+          script: bash .github/workflows/runEmulatorTests.sh\n       - uses: actions/upload-artifact@v4\n         if: failure()\n         with:\ndiff --git a/app/build.gradle b/app/build.gradle\nindex 2abb66ccfd..bdfe9043bf 100644\n--- a/app/build.gradle\n+++ b/app/build.gradle\n@@ -69,6 +69,7 @@ dependencies {\n     implementation project(':net:ssl')\n     implementation project(':net:sync:service')\n     implementation project(':parser:feed')\n+    implementation project(':parser:transcript')\n     implementation project(':playback:base')\n     implementation project(':playback:cast')\n     implementation project(':storage:database')\n@@ -88,6 +89,7 @@ dependencies {\n     implementation project(':net:sync:service-interface')\n     implementation project(':playback:service')\n     implementation project(':ui:chapters')\n+    implementation project(':ui:transcript')\n \n     annotationProcessor \"androidx.annotation:annotation:$annotationVersion\"\n     implementation \"androidx.appcompat:appcompat:$appcompatVersion\"\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java\nindex e1974940c1..527b36b7b6 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java\n@@ -60,6 +60,7 @@ public static boolean onPrepareMenu(Menu menu, FeedItem selectedItem) {\n         final boolean fileDownloaded = hasMedia && selectedItem.getMedia().fileExists();\n         final boolean isLocalFile = hasMedia && selectedItem.getFeed().isLocalFeed();\n         final boolean isFavorite = selectedItem.isTagged(FeedItem.TAG_FAVORITE);\n+        final boolean hasTranscript = selectedItem.hasTranscript();\n \n         setItemVisibility(menu, R.id.skip_episode_item, isPlaying);\n         setItemVisibility(menu, R.id.remove_from_queue_item, isInQueue);\n@@ -84,6 +85,7 @@ public static boolean onPrepareMenu(Menu menu, FeedItem selectedItem) {\n         setItemVisibility(menu, R.id.add_to_favorites_item, !isFavorite);\n         setItemVisibility(menu, R.id.remove_from_favorites_item, isFavorite);\n         setItemVisibility(menu, R.id.remove_item, fileDownloaded || isLocalFile);\n+        setItemVisibility(menu, R.id.transcript_item, hasTranscript);\n         return true;\n     }\n \ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/TranscriptAdapter.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/TranscriptAdapter.java\nnew file mode 100644\nindex 0000000000..ffb3b7bdae\n--- /dev/null\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/TranscriptAdapter.java\n@@ -0,0 +1,145 @@\n+package de.danoeh.antennapod.ui.screen.playback;\n+\n+import android.content.Context;\n+import android.view.LayoutInflater;\n+import android.view.View;\n+import android.view.ViewGroup;\n+import androidx.annotation.NonNull;\n+import androidx.core.content.ContextCompat;\n+import androidx.recyclerview.widget.RecyclerView;\n+import com.google.android.material.elevation.SurfaceColors;\n+import de.danoeh.antennapod.databinding.TranscriptItemBinding;\n+import de.danoeh.antennapod.event.playback.PlaybackPositionEvent;\n+import de.danoeh.antennapod.model.feed.FeedMedia;\n+import de.danoeh.antennapod.model.feed.TranscriptSegment;\n+import de.danoeh.antennapod.model.playback.Playable;\n+import de.danoeh.antennapod.ui.common.Converter;\n+import de.danoeh.antennapod.ui.transcript.TranscriptViewholder;\n+import java.util.Set;\n+import org.greenrobot.eventbus.EventBus;\n+import org.greenrobot.eventbus.Subscribe;\n+import org.greenrobot.eventbus.ThreadMode;\n+import org.jsoup.internal.StringUtil;\n+\n+public class TranscriptAdapter extends RecyclerView.Adapter<TranscriptViewholder> {\n+\n+    public String tag = \"TranscriptAdapter\";\n+    private final SegmentClickListener segmentClickListener;\n+    private final Context context;\n+    private FeedMedia media;\n+    private int prevHighlightPosition = -1;\n+    private int highlightPosition = -1;\n+\n+    public TranscriptAdapter(Context context, SegmentClickListener segmentClickListener) {\n+        this.context = context;\n+        this.segmentClickListener = segmentClickListener;\n+    }\n+\n+    @NonNull\n+    @Override\n+    public TranscriptViewholder onCreateViewHolder(@NonNull ViewGroup viewGroup, int viewType) {\n+        return new TranscriptViewholder(TranscriptItemBinding.inflate(LayoutInflater.from(context), viewGroup, false));\n+    }\n+\n+    public void setMedia(Playable media) {\n+        if (!(media instanceof FeedMedia)) {\n+            return;\n+        }\n+        this.media = (FeedMedia) media;\n+        notifyDataSetChanged();\n+    }\n+\n+    @Override\n+    public void onBindViewHolder(@NonNull TranscriptViewholder holder, int position) {\n+        if (media == null || media.getTranscript() == null) {\n+            return;\n+        }\n+\n+        TranscriptSegment seg = media.getTranscript().getSegmentAt(position);\n+        holder.viewContent.setOnClickListener(v -> {\n+            if (segmentClickListener != null)  {\n+                segmentClickListener.onTranscriptClicked(position, seg);\n+            }\n+        });\n+\n+        String timecode = Converter.getDurationStringLong((int) seg.getStartTime());\n+        if (!StringUtil.isBlank(seg.getSpeaker())) {\n+            if (position > 0 && media.getTranscript()\n+                    .getSegmentAt(position - 1).getSpeaker().equals(seg.getSpeaker())) {\n+                holder.viewTimecode.setVisibility(View.GONE);\n+                holder.viewContent.setText(seg.getWords());\n+            } else {\n+                holder.viewTimecode.setVisibility(View.VISIBLE);\n+                holder.viewTimecode.setText(timecode + \" \u2022 \" + seg.getSpeaker());\n+                holder.viewContent.setText(seg.getWords());\n+            }\n+        } else {\n+            Set<String> speakers = media.getTranscript().getSpeakers();\n+            if (speakers.isEmpty() && (position % 5 == 0)) {\n+                holder.viewTimecode.setVisibility(View.VISIBLE);\n+                holder.viewTimecode.setText(timecode);\n+            }\n+            holder.viewContent.setText(seg.getWords());\n+        }\n+\n+        if (position == highlightPosition) {\n+            float density = context.getResources().getDisplayMetrics().density;\n+            holder.viewContent.setBackgroundColor(SurfaceColors.getColorForElevation(context, 32 * density));\n+            holder.viewContent.setAlpha(1.0f);\n+            holder.viewTimecode.setAlpha(1.0f);\n+            holder.viewContent.setAlpha(1.0f);\n+        } else {\n+            holder.viewContent.setBackgroundColor(ContextCompat.getColor(context, android.R.color.transparent));\n+            holder.viewContent.setAlpha(0.5f);\n+            holder.viewTimecode.setAlpha(0.5f);\n+        }\n+    }\n+\n+    @Subscribe(threadMode = ThreadMode.MAIN)\n+    public void onEventMainThread(PlaybackPositionEvent event) {\n+        if (media == null || media.getTranscript() == null) {\n+            return;\n+        }\n+        int index = media.getTranscript().findSegmentIndexBefore(event.getPosition());\n+        if (index < 0 || index > media.getTranscript().getSegmentCount()) {\n+            return;\n+        }\n+        if (prevHighlightPosition != highlightPosition) {\n+            prevHighlightPosition = highlightPosition;\n+        }\n+        if (index != highlightPosition) {\n+            highlightPosition = index;\n+            notifyItemChanged(prevHighlightPosition);\n+            notifyItemChanged(highlightPosition);\n+        }\n+    }\n+\n+    @Override\n+    public int getItemCount() {\n+        if (media == null) {\n+            return 0;\n+        }\n+\n+        if (media.getTranscript() == null) {\n+            return 0;\n+        }\n+        return media.getTranscript().getSegmentCount();\n+    }\n+\n+    @Override\n+    public void onAttachedToRecyclerView(@NonNull RecyclerView recyclerView) {\n+        super.onAttachedToRecyclerView(recyclerView);\n+        EventBus.getDefault().register(this);\n+    }\n+\n+    @Override\n+    public void onDetachedFromRecyclerView(@NonNull RecyclerView recyclerView) {\n+        super.onDetachedFromRecyclerView(recyclerView);\n+        EventBus.getDefault().unregister(this);\n+    }\n+\n+\n+    public interface SegmentClickListener {\n+        void onTranscriptClicked(int position, TranscriptSegment seg);\n+    }\n+}\n\\ No newline at end of file\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/TranscriptDialogFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/TranscriptDialogFragment.java\nnew file mode 100644\nindex 0000000000..c0c492d10d\n--- /dev/null\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/TranscriptDialogFragment.java\n@@ -0,0 +1,220 @@\n+package de.danoeh.antennapod.ui.screen.playback;\n+\n+import android.app.Dialog;\n+import android.content.DialogInterface;\n+import android.os.Bundle;\n+import android.text.TextUtils;\n+import android.util.DisplayMetrics;\n+import android.util.Log;\n+import android.view.View;\n+import android.view.ViewGroup;\n+import android.view.WindowManager;\n+import android.widget.Toast;\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import androidx.appcompat.app.AlertDialog;\n+import androidx.fragment.app.DialogFragment;\n+import androidx.recyclerview.widget.LinearLayoutManager;\n+import androidx.recyclerview.widget.LinearSmoothScroller;\n+import androidx.recyclerview.widget.RecyclerView;\n+import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n+import de.danoeh.antennapod.R;\n+import de.danoeh.antennapod.databinding.TranscriptDialogBinding;\n+import de.danoeh.antennapod.event.playback.PlaybackPositionEvent;\n+import de.danoeh.antennapod.model.feed.FeedMedia;\n+import de.danoeh.antennapod.model.feed.Transcript;\n+import de.danoeh.antennapod.model.feed.TranscriptSegment;\n+import de.danoeh.antennapod.model.playback.Playable;\n+import de.danoeh.antennapod.playback.service.PlaybackController;\n+import de.danoeh.antennapod.ui.transcript.TranscriptUtils;\n+import io.reactivex.Maybe;\n+import io.reactivex.android.schedulers.AndroidSchedulers;\n+import io.reactivex.disposables.Disposable;\n+import io.reactivex.schedulers.Schedulers;\n+import org.greenrobot.eventbus.EventBus;\n+import org.greenrobot.eventbus.Subscribe;\n+import org.greenrobot.eventbus.ThreadMode;\n+\n+public class TranscriptDialogFragment extends DialogFragment {\n+    public static final String TAG = \"TranscriptFragment\";\n+    private TranscriptDialogBinding viewBinding;\n+    private PlaybackController controller;\n+    private Disposable disposable;\n+    private Playable media;\n+    private Transcript transcript;\n+    private TranscriptAdapter adapter = null;\n+    private boolean doInitialScroll = true;\n+    private LinearLayoutManager layoutManager;\n+\n+    @Override\n+    public void onResume() {\n+        ViewGroup.LayoutParams params;\n+        params = getDialog().getWindow().getAttributes();\n+        params.width = WindowManager.LayoutParams.MATCH_PARENT;\n+        getDialog().getWindow().setAttributes((WindowManager.LayoutParams) params);\n+        super.onResume();\n+    }\n+\n+    @NonNull\n+    @Override\n+    public Dialog onCreateDialog(@Nullable Bundle savedInstanceState) {\n+        viewBinding = TranscriptDialogBinding.inflate(getLayoutInflater());\n+        layoutManager = new LinearLayoutManager(getContext());\n+        viewBinding.transcriptList.setLayoutManager(layoutManager);\n+\n+        adapter = new TranscriptAdapter(getContext(), this::transcriptClicked);\n+        viewBinding.transcriptList.setAdapter(adapter);\n+        viewBinding.transcriptList.addOnScrollListener(new RecyclerView.OnScrollListener() {\n+            @Override\n+            public void onScrollStateChanged(@NonNull RecyclerView recyclerView, int newState) {\n+                super.onScrollStateChanged(recyclerView, newState);\n+                if (newState == RecyclerView.SCROLL_STATE_DRAGGING) {\n+                    viewBinding.followAudioCheckbox.setChecked(false);\n+                }\n+            }\n+        });\n+\n+        AlertDialog dialog = new MaterialAlertDialogBuilder(requireContext())\n+                .setView(viewBinding.getRoot())\n+                .setPositiveButton(getString(R.string.close_label), null)\n+                .setNegativeButton(getString(R.string.refresh_label), null)\n+                .setTitle(R.string.transcript)\n+                .create();\n+        viewBinding.followAudioCheckbox.setChecked(true);\n+        dialog.setOnShowListener(dialog1 -> {\n+            dialog.getButton(DialogInterface.BUTTON_NEGATIVE).setOnClickListener(v -> {\n+                viewBinding.progLoading.setVisibility(View.VISIBLE);\n+                v.setClickable(false);\n+                v.setEnabled(false);\n+                loadMediaInfo(true);\n+            });\n+        });\n+        viewBinding.progLoading.setVisibility(View.VISIBLE);\n+        doInitialScroll = true;\n+\n+\n+        return dialog;\n+    }\n+\n+    private void transcriptClicked(int pos, TranscriptSegment segment) {\n+        long startTime = segment.getStartTime();\n+        long endTime = segment.getEndTime();\n+\n+        scrollToPosition(pos);\n+        if (!(controller.getPosition() >= startTime && controller.getPosition() <= endTime)) {\n+            controller.seekTo((int) startTime);\n+        } else {\n+            controller.playPause();\n+        }\n+        adapter.notifyItemChanged(pos);\n+        viewBinding.followAudioCheckbox.setChecked(true);\n+    }\n+\n+    @Override\n+    public void onStart() {\n+        super.onStart();\n+        controller = new PlaybackController(getActivity()) {\n+            @Override\n+            public void loadMediaInfo() {\n+                TranscriptDialogFragment.this.loadMediaInfo(false);\n+            }\n+        };\n+        controller.init();\n+        EventBus.getDefault().register(this);\n+        loadMediaInfo(false);\n+    }\n+\n+    @Subscribe(threadMode = ThreadMode.MAIN)\n+    public void onEventMainThread(PlaybackPositionEvent event) {\n+        if (transcript == null) {\n+            return;\n+        }\n+        int pos = transcript.findSegmentIndexBefore(event.getPosition());\n+        scrollToPosition(pos);\n+    }\n+\n+    private void loadMediaInfo(boolean forceRefresh) {\n+        if (disposable != null) {\n+            disposable.dispose();\n+        }\n+        disposable = Maybe.create(emitter -> {\n+            Playable media = controller.getMedia();\n+            if (media instanceof FeedMedia) {\n+                this.media = media;\n+\n+                transcript = TranscriptUtils.loadTranscript((FeedMedia) this.media, forceRefresh);\n+                doInitialScroll = true;\n+                ((FeedMedia) this.media).setTranscript(transcript);\n+                emitter.onSuccess(this.media);\n+            } else {\n+                emitter.onComplete();\n+            }\n+        })\n+        .subscribeOn(Schedulers.io())\n+        .observeOn(AndroidSchedulers.mainThread())\n+        .subscribe(media -> onMediaChanged((Playable) media),\n+                error -> Log.e(TAG, Log.getStackTraceString(error)));\n+    }\n+\n+    private void onMediaChanged(Playable media) {\n+        if (!(media instanceof FeedMedia)) {\n+            return;\n+        }\n+        this.media = media;\n+\n+        if (!((FeedMedia) media).hasTranscript()) {\n+            dismiss();\n+            Toast.makeText(getContext(), R.string.no_transcript_label, Toast.LENGTH_LONG).show();\n+            return;\n+        }\n+\n+        viewBinding.progLoading.setVisibility(View.GONE);\n+        adapter.setMedia(media);\n+        ((AlertDialog) getDialog()).getButton(DialogInterface.BUTTON_NEGATIVE).setVisibility(View.INVISIBLE);\n+        if (!TextUtils.isEmpty(((FeedMedia) media).getItem().getTranscriptUrl())) {\n+            ((AlertDialog) getDialog()).getButton(DialogInterface.BUTTON_NEGATIVE).setVisibility(View.VISIBLE);\n+            ((AlertDialog) getDialog()).getButton(DialogInterface.BUTTON_NEGATIVE).setEnabled(true);\n+            ((AlertDialog) getDialog()).getButton(DialogInterface.BUTTON_NEGATIVE).setClickable(true);\n+        }\n+    }\n+\n+    public void scrollToPosition(int pos) {\n+        if (pos <= 0) {\n+            return;\n+        }\n+        if (!viewBinding.followAudioCheckbox.isChecked() && !doInitialScroll) {\n+            return;\n+        }\n+        doInitialScroll = false;\n+\n+        boolean quickScroll = Math.abs(layoutManager.findFirstVisibleItemPosition() - pos) > 5;\n+        if (quickScroll) {\n+            viewBinding.transcriptList.scrollToPosition(pos - 1);\n+            // Additionally, smooth scroll, so that currently active segment is on top of screen\n+        }\n+        LinearSmoothScroller smoothScroller = new LinearSmoothScroller(getContext()) {\n+            @Override\n+            protected int getVerticalSnapPreference() {\n+                return LinearSmoothScroller.SNAP_TO_START;\n+            }\n+\n+            protected float calculateSpeedPerPixel(DisplayMetrics displayMetrics) {\n+                return (quickScroll ? 200 : 1000) / (float) displayMetrics.densityDpi;\n+            }\n+        };\n+        smoothScroller.setTargetPosition(pos - 1);\n+        layoutManager.startSmoothScroll(smoothScroller);\n+    }\n+\n+    @Override\n+    public void onStop() {\n+        super.onStop();\n+        if (disposable != null) {\n+            disposable.dispose();\n+        }\n+        controller.release();\n+        controller = null;\n+        EventBus.getDefault().unregister(this);\n+    }\n+\n+}\n\\ No newline at end of file\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java\nindex e66ed6d3ea..42010dd53c 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java\n@@ -33,6 +33,7 @@\n import de.danoeh.antennapod.ui.screen.playback.MediaPlayerErrorDialog;\n import de.danoeh.antennapod.ui.screen.playback.PlayButton;\n import de.danoeh.antennapod.ui.screen.playback.SleepTimerDialog;\n+import de.danoeh.antennapod.ui.screen.playback.TranscriptDialogFragment;\n import de.danoeh.antennapod.ui.screen.playback.VariableSpeedDialog;\n import org.greenrobot.eventbus.EventBus;\n import org.greenrobot.eventbus.Subscribe;\n@@ -161,7 +162,6 @@ public void onPageSelected(int position) {\n     }\n \n     private void setChapterDividers(Playable media) {\n-\n         if (media == null) {\n             return;\n         }\n@@ -495,6 +495,10 @@ public boolean onMenuItemClick(MenuItem item) {\n         if (itemId == R.id.disable_sleeptimer_item || itemId == R.id.set_sleeptimer_item) {\n             new SleepTimerDialog().show(getChildFragmentManager(), \"SleepTimerDialog\");\n             return true;\n+        } else if (itemId == R.id.transcript_item) {\n+            new TranscriptDialogFragment().show(\n+                    getActivity().getSupportFragmentManager(), TranscriptDialogFragment.TAG);\n+            return true;\n         } else if (itemId == R.id.open_feed_item) {\n             if (feedItem != null) {\n                 Intent intent = MainActivity.getIntentToOpenFeed(getContext(), feedItem.getFeedId());\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/transcript/TranscriptViewholder.java b/app/src/main/java/de/danoeh/antennapod/ui/transcript/TranscriptViewholder.java\nnew file mode 100644\nindex 0000000000..4e5e5f8653\n--- /dev/null\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/transcript/TranscriptViewholder.java\n@@ -0,0 +1,23 @@\n+package de.danoeh.antennapod.ui.transcript;\n+\n+import android.widget.TextView;\n+\n+import androidx.recyclerview.widget.RecyclerView;\n+\n+import de.danoeh.antennapod.databinding.TranscriptItemBinding;\n+\n+public class TranscriptViewholder extends RecyclerView.ViewHolder {\n+    public final TextView viewTimecode;\n+    public final TextView viewContent;\n+\n+    public TranscriptViewholder(TranscriptItemBinding binding) {\n+        super(binding.getRoot());\n+        viewTimecode = binding.speaker;\n+        viewContent = binding.content;\n+    }\n+\n+    @Override\n+    public String toString() {\n+        return super.toString() + \" '\" + viewContent.getText() + \"'\";\n+    }\n+}\n\\ No newline at end of file\ndiff --git a/app/src/main/res/layout/transcript_dialog.xml b/app/src/main/res/layout/transcript_dialog.xml\nnew file mode 100644\nindex 0000000000..22ac9aa4f4\n--- /dev/null\n+++ b/app/src/main/res/layout/transcript_dialog.xml\n@@ -0,0 +1,35 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<LinearLayout\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:tools=\"http://schemas.android.com/tools\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"match_parent\"\n+    android:orientation=\"vertical\">\n+\n+    <ProgressBar\n+        android:id=\"@+id/progLoading\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:layout_gravity=\"center\"\n+        android:indeterminateOnly=\"true\"\n+        android:visibility=\"gone\" />\n+\n+    <androidx.recyclerview.widget.RecyclerView\n+        android:id=\"@+id/transcript_list\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"0dp\"\n+        android:scrollIndicators=\"right\"\n+        android:scrollbarStyle=\"outsideInset\"\n+        android:layout_marginTop=\"16dp\"\n+        android:scrollbars=\"vertical\"\n+        android:layout_weight=\"1\"\n+        tools:listitem=\"@layout/transcript_item\" />\n+\n+    <CheckBox\n+        android:id=\"@+id/followAudioCheckbox\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:layout_marginHorizontal=\"16dp\"\n+        android:text=\"@string/transcript_follow\" />\n+\n+</LinearLayout>\ndiff --git a/app/src/main/res/layout/transcript_item.xml b/app/src/main/res/layout/transcript_item.xml\nnew file mode 100644\nindex 0000000000..548ae7574e\n--- /dev/null\n+++ b/app/src/main/res/layout/transcript_item.xml\n@@ -0,0 +1,33 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<LinearLayout\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"wrap_content\"\n+    android:orientation=\"vertical\">\n+\n+    <TextView\n+        android:id=\"@+id/speaker\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:layout_marginVertical=\"8dp\"\n+        android:paddingHorizontal=\"24dp\"\n+        android:clickable=\"false\"\n+        android:defaultFocusHighlightEnabled=\"false\"\n+        android:longClickable=\"false\"\n+        android:textStyle=\"bold\"\n+        android:textColor=\"?android:attr/textColorPrimary\" />\n+\n+    <TextView\n+        android:id=\"@+id/content\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:minLines=\"1\"\n+        android:maxLines=\"100\"\n+        android:nestedScrollingEnabled=\"false\"\n+        android:paddingHorizontal=\"24dp\"\n+        android:selectAllOnFocus=\"false\"\n+        android:singleLine=\"false\"\n+        android:textColor=\"?android:attr/textColorPrimary\"\n+        android:textIsSelectable=\"false\" />\n+\n+</LinearLayout>\ndiff --git a/app/src/main/res/menu/mediaplayer.xml b/app/src/main/res/menu/mediaplayer.xml\nindex a99151ac88..85eef565b6 100644\n--- a/app/src/main/res/menu/mediaplayer.xml\n+++ b/app/src/main/res/menu/mediaplayer.xml\n@@ -2,6 +2,12 @@\n <menu xmlns:android=\"http://schemas.android.com/apk/res/android\"\n       xmlns:custom=\"http://schemas.android.com/apk/res-auto\">\n \n+    <item\n+        android:id=\"@+id/transcript_item\"\n+        android:icon=\"@drawable/transcript\"\n+        android:title=\"@string/show_transcript\"\n+        custom:showAsAction=\"ifRoom\">\n+    </item>\n     <item\n         android:id=\"@+id/add_to_favorites_item\"\n         android:icon=\"@drawable/ic_star_border\"\ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItem.java b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItem.java\nindex 1e623fd8e1..62dcf0f97b 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItem.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItem.java\n@@ -171,7 +171,7 @@ public void updateFromOther(FeedItem other) {\n         if (other.podcastIndexChapterUrl != null) {\n             podcastIndexChapterUrl = other.podcastIndexChapterUrl;\n         }\n-        if (other.getPodcastIndexTranscriptUrl() != null) {\n+        if (other.getTranscriptUrl() != null) {\n             podcastIndexTranscriptUrl = other.podcastIndexTranscriptUrl;\n         }\n     }\n@@ -425,15 +425,15 @@ public void setPodcastIndexChapterUrl(String url) {\n         podcastIndexChapterUrl = url;\n     }\n \n-    public void setPodcastIndexTranscriptUrl(String type, String url) {\n+    public void setTranscriptUrl(String type, String url) {\n         updateTranscriptPreferredFormat(type, url);\n     }\n \n-    public String getPodcastIndexTranscriptUrl() {\n+    public String getTranscriptUrl() {\n         return podcastIndexTranscriptUrl;\n     }\n \n-    public String getPodcastIndexTranscriptType() {\n+    public String getTranscriptType() {\n         return podcastIndexTranscriptType;\n     }\n \n@@ -459,7 +459,6 @@ public void updateTranscriptPreferredFormat(String type, String url) {\n                 }\n                 break;\n             default:\n-                System.out.println(\"Invalid format for transcript \" + type);\n                 break;\n         }\n     }\n@@ -480,6 +479,10 @@ public String setPodcastIndexTranscriptText(String str) {\n         return podcastIndexTranscriptText = str;\n     }\n \n+    public boolean hasTranscript() {\n+        return (podcastIndexTranscriptUrl != null);\n+    }\n+\n     @NonNull\n     @Override\n     public String toString() {\ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedMedia.java b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedMedia.java\nindex 76a891c15d..03710a6abf 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedMedia.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedMedia.java\n@@ -5,6 +5,7 @@\n import android.os.Parcel;\n import android.os.Parcelable;\n import androidx.annotation.Nullable;\n+\n import android.support.v4.media.MediaBrowserCompat;\n import android.support.v4.media.MediaDescriptionCompat;\n import de.danoeh.antennapod.model.MediaMetadataRetrieverCompat;\n@@ -520,4 +521,25 @@ public String getTranscriptFileUrl() {\n         }\n         return getLocalFileUrl() + \".transcript\";\n     }\n+\n+    public void setTranscript(Transcript t) {\n+        if (item == null)  {\n+            return;\n+        }\n+        item.setTranscript(t);\n+    }\n+\n+    public Transcript getTranscript() {\n+        if (item == null)  {\n+            return null;\n+        }\n+        return item.getTranscript();\n+    }\n+\n+    public Boolean hasTranscript() {\n+        if (item == null)  {\n+            return false;\n+        }\n+        return item.hasTranscript();\n+    }\n }\ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/Transcript.java b/model/src/main/java/de/danoeh/antennapod/model/feed/Transcript.java\nindex da01c0e58c..00c432dfec 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/feed/Transcript.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/Transcript.java\n@@ -1,28 +1,50 @@\n package de.danoeh.antennapod.model.feed;\n \n-import java.util.Map;\n-import java.util.TreeMap;\n+import java.util.ArrayList;\n+import java.util.Set;\n \n public class Transcript {\n-\n-    private final TreeMap<Long, TranscriptSegment> segmentsMap = new TreeMap<>();\n+    private Set<String> speakers;\n+    private final ArrayList<TranscriptSegment> segments = new ArrayList<>();\n \n     public void addSegment(TranscriptSegment segment) {\n-        segmentsMap.put(segment.getStartTime(), segment);\n+        if ((!segments.isEmpty() && segments.get(segments.size() - 1).getStartTime() >= segment.getStartTime())) {\n+            throw new IllegalArgumentException(\"Segments must be added in sorted order\");\n+        }\n+        segments.add(segment);\n     }\n \n-    public TranscriptSegment getSegmentAtTime(long time) {\n-        if (segmentsMap.floorEntry(time) == null) {\n-            return null;\n+    public int findSegmentIndexBefore(long time) {\n+        int a = 0;\n+        int b = segments.size() - 1;\n+        while (a < b) {\n+            int pivot = (a + b + 1) / 2;\n+            if (segments.get(pivot).getStartTime() > time) {\n+                b = pivot - 1;\n+            } else {\n+                a = pivot;\n+            }\n         }\n-        return segmentsMap.floorEntry(time).getValue();\n+        return a;\n     }\n \n-    public int getSegmentCount() {\n-        return segmentsMap.size();\n+    public TranscriptSegment getSegmentAt(int index) {\n+        return segments.get(index);\n+    }\n+\n+    public TranscriptSegment getSegmentAtTime(long time) {\n+        return getSegmentAt(findSegmentIndexBefore(time));\n+    }\n+\n+    public Set<String> getSpeakers() {\n+        return speakers;\n     }\n \n-    public Map.Entry<Long, TranscriptSegment> getEntryAfterTime(long time) {\n-        return segmentsMap.ceilingEntry(time);\n+    public void setSpeakers(Set<String> speakers) {\n+        this.speakers = speakers;\n+    }\n+\n+    public int getSegmentCount() {\n+        return segments.size();\n     }\n }\ndiff --git a/net/download/service/build.gradle b/net/download/service/build.gradle\nindex cebffc75c3..4aee1acd30 100644\n--- a/net/download/service/build.gradle\n+++ b/net/download/service/build.gradle\n@@ -22,6 +22,7 @@ dependencies {\n     implementation project(':storage:preferences')\n     implementation project(':ui:app-start-intent')\n     implementation project(':ui:chapters')\n+    implementation project(':ui:transcript')\n \n     annotationProcessor \"androidx.annotation:annotation:$annotationVersion\"\n     implementation \"androidx.core:core:$coreVersion\"\ndiff --git a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/MediaDownloadedHandler.java b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/MediaDownloadedHandler.java\nindex 3d39911e38..5f123961c4 100644\n--- a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/MediaDownloadedHandler.java\n+++ b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/MediaDownloadedHandler.java\n@@ -9,7 +9,6 @@\n import de.danoeh.antennapod.model.MediaMetadataRetrieverCompat;\n import de.danoeh.antennapod.net.sync.serviceinterface.SynchronizationQueueSink;\n import de.danoeh.antennapod.ui.chapters.ChapterUtils;\n-import de.danoeh.antennapod.ui.chapters.PodcastIndexTranscriptUtils;\n import org.apache.commons.lang3.StringUtils;\n import org.greenrobot.eventbus.EventBus;\n \n@@ -26,6 +25,7 @@\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedMedia;\n import de.danoeh.antennapod.net.sync.serviceinterface.EpisodeAction;\n+import de.danoeh.antennapod.ui.transcript.TranscriptUtils;\n \n /**\n  * Handles a completed media download.\n@@ -66,12 +66,11 @@ public void run() {\n                 ChapterUtils.loadChaptersFromUrl(media.getItem().getPodcastIndexChapterUrl(), false);\n             }\n             FeedItem item = media.getItem();\n-            if (item != null && item.getPodcastIndexTranscriptUrl() != null) {\n-                String transcript = PodcastIndexTranscriptUtils.loadTranscriptFromUrl(\n-                        item.getPodcastIndexTranscriptType(), item.getPodcastIndexTranscriptUrl(), false);\n+            if (item != null && item.getTranscriptUrl() != null) {\n+                String transcript = TranscriptUtils.loadTranscriptFromUrl(item.getTranscriptUrl(), true);\n                 if (!StringUtils.isEmpty(transcript)) {\n                     item.setPodcastIndexTranscriptText(transcript);\n-                    PodcastIndexTranscriptUtils.storeTranscript(media, transcript);\n+                    TranscriptUtils.storeTranscript(media, transcript);\n                 }\n             }\n         } catch (InterruptedIOException ignore) {\ndiff --git a/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/namespace/PodcastIndex.java b/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/namespace/PodcastIndex.java\nindex dd11fb4e7b..8b49831fe5 100644\n--- a/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/namespace/PodcastIndex.java\n+++ b/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/namespace/PodcastIndex.java\n@@ -34,7 +34,7 @@ public SyndElement handleElementStart(String localName, HandlerState state,\n             String href = attributes.getValue(URL);\n             String type = attributes.getValue(TYPE);\n             if (!TextUtils.isEmpty(href) && !TextUtils.isEmpty(type)) {\n-                state.getCurrentItem().setPodcastIndexTranscriptUrl(type, href);\n+                state.getCurrentItem().setTranscriptUrl(type, href);\n             }\n         }\n         return new SyndElement(localName, this);\ndiff --git a/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/JsonTranscriptParser.java b/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/JsonTranscriptParser.java\nindex 78f3bf9c85..38c24f09b2 100644\n--- a/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/JsonTranscriptParser.java\n+++ b/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/JsonTranscriptParser.java\n@@ -2,9 +2,13 @@\n \n import org.apache.commons.lang3.StringUtils;\n import org.json.JSONArray;\n+import org.json.JSONException;\n import org.json.JSONObject;\n import org.jsoup.internal.StringUtil;\n \n+import java.util.HashSet;\n+import java.util.Set;\n+\n import de.danoeh.antennapod.model.feed.Transcript;\n import de.danoeh.antennapod.model.feed.TranscriptSegment;\n \n@@ -15,14 +19,25 @@ public static Transcript parse(String jsonStr) {\n             long startTime = -1L;\n             long endTime = -1L;\n             long segmentStartTime = -1L;\n+            long segmentEndTime = -1L;\n             long duration = 0L;\n             String speaker = \"\";\n+            String prevSpeaker = \"\";\n             String segmentBody = \"\";\n-            JSONObject obj = new JSONObject(jsonStr);\n-            JSONArray objSegments = obj.getJSONArray(\"segments\");\n+            JSONArray objSegments;\n+            Set<String> speakers = new HashSet<>();\n+\n+            try {\n+                JSONObject obj = new JSONObject(jsonStr);\n+                objSegments = obj.getJSONArray(\"segments\");\n+            } catch (JSONException e) {\n+                e.printStackTrace();\n+                return null;\n+            }\n \n             for (int i = 0; i < objSegments.length(); i++) {\n                 JSONObject jsonObject = objSegments.getJSONObject(i);\n+                segmentEndTime = endTime;\n                 startTime = Double.valueOf(jsonObject.optDouble(\"startTime\", -1) * 1000L).longValue();\n                 endTime = Double.valueOf(jsonObject.optDouble(\"endTime\", -1) * 1000L).longValue();\n                 if (startTime < 0 || endTime < 0) {\n@@ -33,11 +48,40 @@ public static Transcript parse(String jsonStr) {\n                 }\n                 duration += endTime - startTime;\n \n+                prevSpeaker = speaker;\n                 speaker = jsonObject.optString(\"speaker\");\n+                speakers.add(speaker);\n+                if (StringUtils.isEmpty(speaker) && StringUtils.isNotEmpty(prevSpeaker)) {\n+                    speaker = prevSpeaker;\n+                }\n                 String body = jsonObject.optString(\"body\");\n-                segmentBody += body + \" \";\n+                if (!prevSpeaker.equals(speaker)) {\n+                    if (StringUtils.isNotEmpty(segmentBody)) {\n+                        segmentBody = StringUtils.trim(segmentBody);\n+                        transcript.addSegment(new TranscriptSegment(segmentStartTime,\n+                                segmentEndTime,\n+                                segmentBody,\n+                                prevSpeaker));\n+                        segmentStartTime = startTime;\n+                        segmentBody = body.toString();\n+                        duration = 0L;\n+                        continue;\n+                    }\n+                }\n+\n+                segmentBody += \" \" + body;\n \n                 if (duration >= TranscriptParser.MIN_SPAN) {\n+                    // Look ahead and make sure the next segment does not start with an alphanumeric character\n+                    if ((i + 1) < objSegments.length()) {\n+                        String nextSegmentFirstChar = objSegments.getJSONObject(i + 1)\n+                                .optString(\"body\")\n+                                .substring(0, 1);\n+                        if (!StringUtils.isAlphanumeric(nextSegmentFirstChar)\n+                                && (duration < TranscriptParser.MAX_SPAN)) {\n+                            continue;\n+                        }\n+                    }\n                     segmentBody = StringUtils.trim(segmentBody);\n                     transcript.addSegment(new TranscriptSegment(segmentStartTime, endTime, segmentBody, speaker));\n                     duration = 0L;\n@@ -52,12 +96,13 @@ public static Transcript parse(String jsonStr) {\n             }\n \n             if (transcript.getSegmentCount() > 0) {\n+                transcript.setSpeakers(speakers);\n                 return transcript;\n             } else {\n                 return null;\n             }\n \n-        } catch (org.json.JSONException e) {\n+        } catch (JSONException e) {\n             e.printStackTrace();\n         }\n         return null;\ndiff --git a/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/SrtTranscriptParser.java b/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/SrtTranscriptParser.java\nindex 098dadd994..5d80a72652 100644\n--- a/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/SrtTranscriptParser.java\n+++ b/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/SrtTranscriptParser.java\n@@ -4,8 +4,10 @@\n import org.jsoup.internal.StringUtil;\n \n import java.util.Arrays;\n+import java.util.HashSet;\n import java.util.Iterator;\n import java.util.List;\n+import java.util.Set;\n import java.util.regex.Matcher;\n import java.util.regex.Pattern;\n \n@@ -25,21 +27,26 @@ public static Transcript parse(String str) {\n         List<String> lines = Arrays.asList(str.split(\"\\n\"));\n         Iterator<String> iter = lines.iterator();\n         String speaker = \"\";\n-        StringBuilder body = new StringBuilder();\n+        String prevSpeaker = \"\";\n+        StringBuilder body;\n         String line;\n         String segmentBody = \"\";\n         long startTimecode = -1L;\n         long spanStartTimecode = -1L;\n+        long spanEndTimecode = -1L;\n         long endTimecode = -1L;\n         long duration = 0L;\n+        Set<String> speakers = new HashSet<>();\n \n         while (iter.hasNext()) {\n+            body = new StringBuilder();\n             line = iter.next();\n \n             if (line.isEmpty()) {\n                 continue;\n             }\n \n+            spanEndTimecode = endTimecode;\n             if (line.contains(\"-->\")) {\n                 String[] timecodes = line.split(\"-->\");\n                 if (timecodes.length < 2) {\n@@ -65,45 +72,53 @@ public static Transcript parse(String str) {\n                 } while (iter.hasNext());\n             }\n \n-            if (body.indexOf(\":\") != -1) {\n-                String [] parts = body.toString().trim().split(\":\");\n+            if (body.indexOf(\": \") != -1) {\n+                String[] parts = body.toString().trim().split(\":\");\n                 if (parts.length < 2) {\n                     continue;\n                 }\n+                prevSpeaker = speaker;\n                 speaker = parts[0];\n+                speakers.add(speaker);\n                 body = new StringBuilder(parts[1].strip());\n-            }\n-            if (!StringUtil.isBlank(body.toString())) {\n-                segmentBody += \" \" + body;\n-                segmentBody = StringUtils.trim(segmentBody);\n-                if (duration >= TranscriptParser.MIN_SPAN && endTimecode > spanStartTimecode) {\n-                    transcript.addSegment(new TranscriptSegment(spanStartTimecode,\n-                            endTimecode,\n-                            segmentBody,\n-                            speaker));\n-                    duration = 0L;\n-                    spanStartTimecode = -1L;\n-                    segmentBody = \"\";\n+                if (StringUtils.isNotEmpty(prevSpeaker) && !StringUtils.equals(speaker, prevSpeaker)) {\n+                    if (StringUtils.isNotEmpty(segmentBody)) {\n+                        transcript.addSegment(new TranscriptSegment(spanStartTimecode,\n+                                spanEndTimecode, segmentBody, prevSpeaker));\n+                        duration = 0L;\n+                        spanStartTimecode = startTimecode;\n+                        segmentBody = body.toString();\n+                        continue;\n+                    }\n+                }\n+            } else {\n+                if (StringUtils.isNotEmpty(prevSpeaker) && StringUtils.isEmpty(speaker)) {\n+                    speaker = prevSpeaker;\n                 }\n-                body = new StringBuilder();\n+            }\n+\n+            segmentBody += \" \" + body;\n+            segmentBody = StringUtils.trim(segmentBody);\n+            if (duration >= TranscriptParser.MIN_SPAN && endTimecode > spanStartTimecode) {\n+                transcript.addSegment(new TranscriptSegment(spanStartTimecode, endTimecode, segmentBody, speaker));\n+                duration = 0L;\n+                spanStartTimecode = -1L;\n+                segmentBody = \"\";\n             }\n         }\n \n         if (!StringUtil.isBlank(segmentBody) && endTimecode > spanStartTimecode) {\n             segmentBody = StringUtils.trim(segmentBody);\n-            transcript.addSegment(new TranscriptSegment(spanStartTimecode,\n-                    endTimecode,\n-                    segmentBody,\n-                    speaker));\n+            transcript.addSegment(new TranscriptSegment(spanStartTimecode, endTimecode, segmentBody, speaker));\n         }\n         if (transcript.getSegmentCount() > 0) {\n+            transcript.setSpeakers(speakers);\n             return transcript;\n         } else {\n             return null;\n         }\n     }\n \n-    // Time format 00:00:00,000\n     static long parseTimecode(String timecode) {\n         Matcher matcher = TIMECODE_PATTERN.matcher(timecode);\n         if (!matcher.matches()) {\ndiff --git a/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/TranscriptParser.java b/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/TranscriptParser.java\nindex 0a4025d96f..4049b2c8f8 100644\n--- a/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/TranscriptParser.java\n+++ b/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/TranscriptParser.java\n@@ -5,7 +5,8 @@\n import de.danoeh.antennapod.model.feed.Transcript;\n \n public class TranscriptParser {\n-    static final long MIN_SPAN = 1000L; // merge short segments together to form a span of 1 second\n+    static final long MIN_SPAN = 5000L; // Merge short segments together to form a span of 5 seconds\n+    static final long MAX_SPAN = 8000L; // Don't go beyond 10 seconds when merging\n \n     public static Transcript parse(String str, String type) {\n         if (str == null || StringUtils.isBlank(str)) {\ndiff --git a/settings.gradle b/settings.gradle\nindex 3b3df7ba87..9f1d16fa44 100644\n--- a/settings.gradle\n+++ b/settings.gradle\n@@ -52,3 +52,4 @@ include ':ui:notifications'\n include ':ui:preferences'\n include ':ui:statistics'\n include ':ui:widget'\n+include ':ui:transcript'\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\nindex 3a5771b36d..3d6b6e8ef7 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n@@ -675,8 +675,8 @@ private long updateOrInsertFeedItem(FeedItem item, boolean saveFeed) {\n         values.put(KEY_PODCASTINDEX_CHAPTER_URL, item.getPodcastIndexChapterUrl());\n \n         // We only store one transcript url, we prefer JSON if it exists\n-        String type = item.getPodcastIndexTranscriptType();\n-        String url = item.getPodcastIndexTranscriptUrl();\n+        String type = item.getTranscriptType();\n+        String url = item.getTranscriptUrl();\n         if (url != null) {\n             values.put(KEY_PODCASTINDEX_TRANSCRIPT_TYPE, type);\n             values.put(KEY_PODCASTINDEX_TRANSCRIPT_URL, url);\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemCursor.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemCursor.java\nindex 41e4d474ab..e771133ffe 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemCursor.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemCursor.java\n@@ -26,8 +26,8 @@ public class FeedItemCursor extends CursorWrapper {\n     private final int indexImageUrl;\n     private final int indexPodcastIndexChapterUrl;\n     private final int indexMediaId;\n-    private final int indexPodcastIndexTranscriptUrl;\n     private final int indexPodcastIndexTranscriptType;\n+    private final int indexPodcastIndexTranscriptUrl;\n \n     public FeedItemCursor(Cursor cursor) {\n         super(new FeedMediaCursor(cursor));\n@@ -45,8 +45,8 @@ public FeedItemCursor(Cursor cursor) {\n         indexImageUrl = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_IMAGE_URL);\n         indexPodcastIndexChapterUrl = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_PODCASTINDEX_CHAPTER_URL);\n         indexMediaId = cursor.getColumnIndexOrThrow(PodDBAdapter.SELECT_KEY_MEDIA_ID);\n-        indexPodcastIndexTranscriptUrl = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_PODCASTINDEX_TRANSCRIPT_URL);\n         indexPodcastIndexTranscriptType = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_PODCASTINDEX_TRANSCRIPT_TYPE);\n+        indexPodcastIndexTranscriptUrl = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_PODCASTINDEX_TRANSCRIPT_URL);\n     }\n \n     /**\n@@ -67,8 +67,8 @@ public FeedItem getFeedItem() {\n                 getString(indexItemIdentifier),\n                 getLong(indexAutoDownload) > 0,\n                 getString(indexPodcastIndexChapterUrl),\n-                getString(indexPodcastIndexTranscriptUrl),\n-                getString(indexPodcastIndexTranscriptType));\n+                getString(indexPodcastIndexTranscriptType),\n+                getString(indexPodcastIndexTranscriptUrl));\n         if (!isNull(indexMediaId)) {\n             item.setMedia(feedMediaCursor.getFeedMedia());\n         }\ndiff --git a/ui/chapters/build.gradle b/ui/chapters/build.gradle\nindex a3cb1b6779..a388027802 100644\n--- a/ui/chapters/build.gradle\n+++ b/ui/chapters/build.gradle\n@@ -13,9 +13,11 @@ dependencies {\n     implementation project(':net:common')\n     implementation project(':parser:media')\n     implementation project(':parser:feed')\n+    implementation project(':parser:transcript')\n     implementation project(':storage:database')\n \n     annotationProcessor \"androidx.annotation:annotation:$annotationVersion\"\n     implementation \"commons-io:commons-io:$commonsioVersion\"\n+    implementation \"org.apache.commons:commons-lang3:$commonslangVersion\"\n     implementation \"com.squareup.okhttp3:okhttp:$okhttpVersion\"\n }\ndiff --git a/ui/chapters/src/main/java/de/danoeh/antennapod/ui/chapters/PodcastIndexTranscriptUtils.java b/ui/chapters/src/main/java/de/danoeh/antennapod/ui/chapters/PodcastIndexTranscriptUtils.java\ndeleted file mode 100644\nindex 9add3db235..0000000000\n--- a/ui/chapters/src/main/java/de/danoeh/antennapod/ui/chapters/PodcastIndexTranscriptUtils.java\n+++ /dev/null\n@@ -1,55 +0,0 @@\n-package de.danoeh.antennapod.ui.chapters;\n-\n-import android.util.Log;\n-\n-import java.io.File;\n-import java.io.FileOutputStream;\n-import java.io.IOException;\n-import java.nio.charset.Charset;\n-\n-import de.danoeh.antennapod.model.feed.FeedMedia;\n-import de.danoeh.antennapod.net.common.AntennapodHttpClient;\n-import okhttp3.Request;\n-import okhttp3.Response;\n-import org.apache.commons.io.IOUtils;\n-\n-public class PodcastIndexTranscriptUtils {\n-\n-    private static final String TAG = \"PodcastIndexTranscript\";\n-\n-    public static String loadTranscriptFromUrl(String type, String url, boolean forceRefresh) {\n-        StringBuilder str = new StringBuilder();\n-        Response response = null;\n-        try {\n-            Log.d(TAG, \"Downloading transcript URL \" + url.toString());\n-            Request request = new Request.Builder().url(url).build();\n-            response = AntennapodHttpClient.getHttpClient().newCall(request).execute();\n-            if (response.isSuccessful() && response.body() != null) {\n-                str.append(response.body().string());\n-            }\n-        } catch (IOException e) {\n-            e.printStackTrace();\n-        } finally {\n-            if (response != null) {\n-                response.close();\n-            }\n-        }\n-        return str.toString();\n-    }\n-\n-    public static void storeTranscript(FeedMedia media, String transcript) {\n-        File transcriptFile = new File(media.getTranscriptFileUrl());\n-        FileOutputStream ostream = null;\n-        try {\n-            if (!transcriptFile.exists() && transcriptFile.createNewFile()) {\n-                ostream = new FileOutputStream(transcriptFile);\n-                ostream.write(transcript.getBytes(Charset.forName(\"UTF-8\")));\n-                ostream.close();\n-            }\n-        } catch (IOException e) {\n-            e.printStackTrace();\n-        } finally {\n-            IOUtils.closeQuietly(ostream);\n-        }\n-    }\n-}\ndiff --git a/ui/common/src/main/res/drawable/transcript.xml b/ui/common/src/main/res/drawable/transcript.xml\nnew file mode 100644\nindex 0000000000..435df4d7cc\n--- /dev/null\n+++ b/ui/common/src/main/res/drawable/transcript.xml\n@@ -0,0 +1,9 @@\n+<vector xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    android:width=\"24dp\"\n+    android:height=\"24dp\"\n+    android:viewportWidth=\"960\"\n+    android:viewportHeight=\"960\">\n+  <path\n+      android:fillColor=\"?attr/action_icon_color\"\n+      android:pathData=\"M240,640L560,640L560,560L240,560L240,640ZM640,640L720,640L720,560L640,560L640,640ZM240,480L320,480L320,400L240,400L240,480ZM400,480L720,480L720,400L400,400L400,480ZM160,800Q127,800 103.5,776.5Q80,753 80,720L80,240Q80,207 103.5,183.5Q127,160 160,160L800,160Q833,160 856.5,183.5Q880,207 880,240L880,720Q880,753 856.5,776.5Q833,800 800,800L160,800ZM160,720L800,720Q800,720 800,720Q800,720 800,720L800,240Q800,240 800,240Q800,240 800,240L160,240Q160,240 160,240Q160,240 160,240L160,720Q160,720 160,720Q160,720 160,720ZM160,720Q160,720 160,720Q160,720 160,720L160,240Q160,240 160,240Q160,240 160,240L160,240Q160,240 160,240Q160,240 160,240L160,720Q160,720 160,720Q160,720 160,720L160,720Z\"/>\n+</vector>\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex b86792f20e..bd925fefd3 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -257,6 +257,10 @@\n         <item quantity=\"other\">%d episodes removed from inbox.</item>\n     </plurals>\n     <string name=\"add_to_favorite_label\">Add to favorites</string>\n+    <string name=\"show_transcript\">Show transcript</string>\n+    <string name=\"transcript\">Transcript</string>\n+    <string name=\"transcript_follow\">Follow audio</string>\n+    <string name=\"no_transcript_label\">No transcript</string>\n     <string name=\"remove_from_favorite_label\">Remove from favorites</string>\n     <string name=\"visit_website_label\">Visit website</string>\n     <string name=\"skip_episode_label\">Skip episode</string>\ndiff --git a/ui/transcript/build.gradle b/ui/transcript/build.gradle\nnew file mode 100644\nindex 0000000000..c82639fa79\n--- /dev/null\n+++ b/ui/transcript/build.gradle\n@@ -0,0 +1,20 @@\n+plugins {\n+    id(\"com.android.library\")\n+}\n+apply from: \"../../common.gradle\"\n+apply from: \"../../playFlavor.gradle\"\n+\n+android {\n+    namespace \"de.danoeh.antennapod.ui.transcript\"\n+}\n+\n+dependencies {\n+    implementation project(':model')\n+    implementation project(':net:common')\n+    implementation project(':parser:media')\n+    implementation project(':parser:transcript')\n+\n+    implementation \"commons-io:commons-io:$commonsioVersion\"\n+    implementation \"org.apache.commons:commons-lang3:$commonslangVersion\"\n+    implementation \"com.squareup.okhttp3:okhttp:$okhttpVersion\"\n+}\ndiff --git a/ui/transcript/src/main/java/de/danoeh/antennapod/ui/transcript/TranscriptUtils.java b/ui/transcript/src/main/java/de/danoeh/antennapod/ui/transcript/TranscriptUtils.java\nnew file mode 100644\nindex 0000000000..6f784457e0\n--- /dev/null\n+++ b/ui/transcript/src/main/java/de/danoeh/antennapod/ui/transcript/TranscriptUtils.java\n@@ -0,0 +1,111 @@\n+package de.danoeh.antennapod.ui.transcript;\n+\n+import android.util.Log;\n+import org.apache.commons.io.FileUtils;\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InterruptedIOException;\n+import java.nio.charset.Charset;\n+import de.danoeh.antennapod.model.feed.FeedMedia;\n+import de.danoeh.antennapod.net.common.AntennapodHttpClient;\n+import de.danoeh.antennapod.model.feed.Transcript;\n+import de.danoeh.antennapod.parser.transcript.TranscriptParser;\n+import okhttp3.CacheControl;\n+import okhttp3.Request;\n+import okhttp3.Response;\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.lang3.StringUtils;\n+\n+public class TranscriptUtils {\n+    private static final String TAG = \"Transcript\";\n+\n+    public static String loadTranscriptFromUrl(String url, boolean forceRefresh) throws InterruptedIOException {\n+        if (forceRefresh) {\n+            return loadTranscriptFromUrl(url, CacheControl.FORCE_NETWORK);\n+        }\n+        String str = loadTranscriptFromUrl(url, CacheControl.FORCE_CACHE);\n+        if (str == null || str.length() <= 1) {\n+            // Some publishers use one dummy transcript before actual transcript are available\n+            return loadTranscriptFromUrl(url, CacheControl.FORCE_NETWORK);\n+        }\n+        return str;\n+    }\n+\n+    private static String loadTranscriptFromUrl(String url, CacheControl cacheControl) throws InterruptedIOException {\n+        StringBuilder str = new StringBuilder();\n+        Response response = null;\n+\n+        try {\n+            Log.d(TAG, \"Downloading transcript URL \" + url);\n+            Request request = new Request.Builder().url(url).cacheControl(cacheControl).build();\n+            response = AntennapodHttpClient.getHttpClient().newCall(request).execute();\n+            if (response.isSuccessful() && response.body() != null) {\n+                Log.d(TAG, \"Done Downloading transcript URL \" + url);\n+                str.append(response.body().string());\n+            } else {\n+                Log.d(TAG, \"Error Downloading transcript URL \" + url + \": \" + response.message());\n+            }\n+        } catch (InterruptedIOException e) {\n+            Log.d(TAG, \"InterruptedIOException while downloading transcript URL \" + url);\n+            throw e;\n+        } catch (Exception e) {\n+            e.printStackTrace();\n+            return null;\n+        } finally {\n+            if (response != null) {\n+                response.close();\n+            }\n+        }\n+        return str.toString();\n+    }\n+\n+    public static Transcript loadTranscript(FeedMedia media, Boolean forceRefresh) throws InterruptedIOException {\n+        String transcriptType = media.getItem().getTranscriptType();\n+\n+        if (!forceRefresh && media.getItem().getTranscript() != null) {\n+            return media.getTranscript();\n+        }\n+\n+        if (!forceRefresh && media.getTranscriptFileUrl() != null) {\n+            File transcriptFile = new File(media.getTranscriptFileUrl());\n+            try {\n+                if (transcriptFile.exists()) {\n+                    String t = FileUtils.readFileToString(transcriptFile, (String) null);\n+                    if (StringUtils.isNotEmpty(t)) {\n+                        media.setTranscript(TranscriptParser.parse(t, transcriptType));\n+                        return media.getTranscript();\n+                    }\n+                }\n+            } catch (IOException e) {\n+                e.printStackTrace();\n+            }\n+        }\n+\n+        String transcriptUrl = media.getItem().getTranscriptUrl();\n+        String t = TranscriptUtils.loadTranscriptFromUrl(transcriptUrl, forceRefresh);\n+        if (StringUtils.isNotEmpty(t)) {\n+            return TranscriptParser.parse(t, transcriptType);\n+        }\n+        return null;\n+    }\n+\n+    public static void storeTranscript(FeedMedia media, String transcript) {\n+        File transcriptFile = new File(media.getTranscriptFileUrl());\n+        FileOutputStream ostream = null;\n+        try {\n+            if (transcriptFile.exists() && !transcriptFile.delete()) {\n+                Log.e(TAG, \"Failed to delete existing transcript file \" + transcriptFile.getAbsolutePath());\n+            }\n+            if (transcriptFile.createNewFile()) {\n+                ostream = new FileOutputStream(transcriptFile);\n+                ostream.write(transcript.getBytes(Charset.forName(\"UTF-8\")));\n+                ostream.close();\n+            }\n+        } catch (IOException e) {\n+            e.printStackTrace();\n+        } finally {\n+            IOUtils.closeQuietly(ostream);\n+        }\n+    }\n+}\n", "test_patch": "diff --git a/.github/workflows/runEmulatorTests.sh b/.github/workflows/runEmulatorTests.sh\nindex c297932a73..3da5a6592f 100644\n--- a/.github/workflows/runEmulatorTests.sh\n+++ b/.github/workflows/runEmulatorTests.sh\n@@ -1,4 +1,4 @@\n-#!/bin/zsh\n+#!/bin/bash\n \n set -o pipefail\n \ndiff --git a/parser/feed/src/test/java/de/danoeh/antennapod/parser/feed/element/namespace/RssParserTest.java b/parser/feed/src/test/java/de/danoeh/antennapod/parser/feed/element/namespace/RssParserTest.java\nindex 983766f12b..027e843a88 100644\n--- a/parser/feed/src/test/java/de/danoeh/antennapod/parser/feed/element/namespace/RssParserTest.java\n+++ b/parser/feed/src/test/java/de/danoeh/antennapod/parser/feed/element/namespace/RssParserTest.java\n@@ -101,8 +101,8 @@ public void testMultipleFundingTags() throws Exception {\n     public void testPodcastIndexTranscript() throws Exception {\n         File feedFile = FeedParserTestHelper.getFeedFile(\"feed-rss-testPodcastIndexTranscript.xml\");\n         Feed feed = FeedParserTestHelper.runFeedParser(feedFile);\n-        assertEquals(\"https://podnews.net/audio/podnews231011.mp3.json\", feed.getItems().get(0).getPodcastIndexTranscriptUrl());\n-        assertEquals(\"application/json\", feed.getItems().get(0).getPodcastIndexTranscriptType());\n+        assertEquals(\"https://podnews.net/audio/podnews231011.mp3.json\", feed.getItems().get(0).getTranscriptUrl());\n+        assertEquals(\"application/json\", feed.getItems().get(0).getTranscriptType());\n     }\n \n     @Test\ndiff --git a/parser/transcript/src/test/java/de/danoeh/antennapod/parser/transcript/JsonTranscriptParserTest.java b/parser/transcript/src/test/java/de/danoeh/antennapod/parser/transcript/JsonTranscriptParserTest.java\nindex 48996f492c..b795d88d7d 100644\n--- a/parser/transcript/src/test/java/de/danoeh/antennapod/parser/transcript/JsonTranscriptParserTest.java\n+++ b/parser/transcript/src/test/java/de/danoeh/antennapod/parser/transcript/JsonTranscriptParserTest.java\n@@ -14,20 +14,20 @@ public class JsonTranscriptParserTest {\n             + \"'segments': [ \"\n             + \"{ 'speaker' : 'John Doe', 'startTime': 0.8, 'endTime': 1.9, 'body': 'And' },\"\n             + \"{ 'speaker' : 'Sally Green', 'startTime': 1.91, 'endTime': 2.8, 'body': 'this merges' },\"\n-            + \"{ 'startTime': 2.9, 'endTime': 3.4, 'body': 'the' },\"\n-            + \"{ 'startTime': 3.5, 'endTime': 3.6, 'body': 'person' }]}\";\n+            + \"{ 'startTime': 2.9, 'endTime': 3.4, 'body': ' the' },\"\n+            + \"{ 'startTime': 3.5, 'endTime': 3.6, 'body': ' person' }]}\";\n \n     @Test\n     public void testParseJson() {\n         Transcript result = JsonTranscriptParser.parse(jsonStr);\n-\n-        assertEquals(result.getSegmentAtTime(0L), null);\n+        // TODO: for gaps in the transcript (ads, music) should we return null?\n+        assertEquals(result.getSegmentAtTime(0L).getStartTime(), 800L);\n         assertEquals(result.getSegmentAtTime(800L).getSpeaker(), \"John Doe\");\n         assertEquals(result.getSegmentAtTime(800L).getStartTime(), 800L);\n         assertEquals(result.getSegmentAtTime(800L).getEndTime(), 1900L);\n-        assertEquals(1910L, (long) result.getEntryAfterTime(1800L).getKey());\n-        // 2 segments get merged into at least 1 second\n-        assertEquals(\"this merges the\", result.getEntryAfterTime(1800L).getValue().getWords());\n+        assertEquals(result.getSegmentAtTime(1800L).getStartTime(), 800L);\n+        // 2 segments get merged into at least 5 second\n+        assertEquals(result.getSegmentAtTime(1800L).getWords(), \"And\");\n     }\n \n     @Test\ndiff --git a/parser/transcript/src/test/java/de/danoeh/antennapod/parser/transcript/SrtTranscriptParserTest.java b/parser/transcript/src/test/java/de/danoeh/antennapod/parser/transcript/SrtTranscriptParserTest.java\nindex f7854c5bf2..e72ea8ebc2 100644\n--- a/parser/transcript/src/test/java/de/danoeh/antennapod/parser/transcript/SrtTranscriptParserTest.java\n+++ b/parser/transcript/src/test/java/de/danoeh/antennapod/parser/transcript/SrtTranscriptParserTest.java\n@@ -10,13 +10,13 @@\n @RunWith(RobolectricTestRunner.class)\n public class SrtTranscriptParserTest {\n     private static String srtStr = \"1\\n\"\n-            + \"00:00:00,000 --> 00:00:02,730\\n\"\n+            + \"00:00:00,000 --> 00:00:50,730\\n\"\n             + \"John Doe: Promoting your podcast in a new\\n\\n\"\n             + \"2\\n\"\n-            + \"00:00:02,730 --> 00:00:04,600\\n\"\n+            + \"00:00:90,740 --> 00:00:91,600\\n\"\n             + \"way. The latest from PogNews.\\n\\n\"\n-            + \"00:00:04,730 --> 00:00:05,600\\n\"\n-            + \"way. The latest from PogNews.\";\n+            + \"00:00:91,730 --> 00:00:93,600\\n\"\n+            + \"We bring your favorite podcast.\";\n \n     @Test\n     public void testParseSrt() {\n@@ -25,9 +25,10 @@ public void testParseSrt() {\n         assertEquals(result.getSegmentAtTime(0L).getWords(), \"Promoting your podcast in a new\");\n         assertEquals(result.getSegmentAtTime(0L).getSpeaker(), \"John Doe\");\n         assertEquals(result.getSegmentAtTime(0L).getStartTime(), 0L);\n-        assertEquals(result.getSegmentAtTime(0L).getEndTime(), 2730L);\n-        assertEquals((long) result.getEntryAfterTime(1000L).getKey(), 2730L);\n-        assertEquals(result.getEntryAfterTime(1000L).getValue().getWords(), \"way. The latest from PogNews.\");\n+        assertEquals(result.getSegmentAtTime(0L).getEndTime(), 50730L);\n+        assertEquals(result.getSegmentAtTime(90740).getStartTime(), 90740);\n+        assertEquals(\"way. The latest from PogNews. We bring your favorite podcast.\",\n+                result.getSegmentAtTime(90740).getWords());\n     }\n \n     @Test\n", "problem_statement": "Support for podcast:transcript tag\n# Checklist\r\n<!-- Place an x in the boxes to tick them: [x] -->\r\n\r\n- [x] I have used the search function to see if someone else has already submitted the same feature request.\r\n- [x] I will only create one feature request per issue.\r\n- [x] I will describe the problem with as much detail as possible\r\n\r\n# Feature description\r\nSome podcasts include text transcript using `podcast:transcipt`\r\n\r\n**Suggested solution**:\r\nDisplay transcript and sync it with the audio.\r\n\r\nMeeting notes from Nov 2nd, 2023 https://github.com/AntennaPod/AntennaPod/issues/4935#issuecomment-1791614891\r\n\n", "hints_text": "@keunes or @ByteHamster please assign to me, since I have the podcastindex namespace parsing done in #4933, I could tackle `podcast:transcript`\nI have a a few suggestions for transcript related features I think  would be great to include in AntennaPod (originally mentioned in https://github.com/AntennaPod/AntennaPod/issues/5002):\r\n\r\n1. Optionally including timestamps when copying from the trancsript. This would be helpful when using a noteapp to write down interesting segments from the podcast as it makes it easier to go back to the podcast an relisten to the particular segment.\r\n2.  Having the transcript autoscroll as the episode is playing, so when switching to the transcript tab, the text is in the same position as the audio. This would facilitate notetaking while listening.\r\n3. Searching the transcript. I am referring to searching within a single transcript , which would make it easier to find interesting segments (which in turn could be navigated to if combined with the below item).\r\n4. Using the transcript for seeking in the audio (clicking sentences to jump to that position).\r\n\r\nThere are currently at least two podcast apps on iOS that provide some of these features, but none on Android as far as I know. Those apps are https://podcast9.com/ and https://www.airr.io/. They are labeling themselves as more educational / productive alternatives to regular podcast apps and their main value proposition is the ability to interact with and remember what you listen to as well as easily share your favorite bits with others.\r\n\r\nA future item to consider which might be out of scope currently is to automatically create transcripts for episodes that don't provide it, e.g. using the live transcribe feature on phones where it is available.\nNice ideas \ud83d\udc4d My guess would be that # 4 wouldn't be too difficult. But for the others I guess we (the app) would need to receive the timestamps with the transcript I think - as I reckon it's not feasible for AP to automatically match the text with the audio. Do you know if transcripts typically have such timestamps?\nThanks @keunes ! I am not very experienced with podcast data and metadata, but I looked around a bit and it seems like at least some transcripts provide this. The [example used on the podcastindex API docs](https://podcastindex-org.github.io/docs-api/#get-/episodes/byid) page includes this segment:\r\n\r\n```json\r\ntranscriptUrl: \"https://mp3s.nashownotes.com/NA-1322-Captions.srt\"\r\n```\r\n\r\nThat srt file includes timestamps which look like this:\r\n\r\n```srt\r\n1\r\n00:00:00,000 --> 00:00:05,340\r\nPull my mask over my nose. Adam\r\nCurry John C Dvorak, Thursday,\r\n\r\n2\r\n00:00:05,340 --> 00:00:09,030\r\nFebruary 18 2021. This is your\r\naward winning media\r\n\r\n3\r\n00:00:09,030 --> 00:00:13,380\r\nassassination Episode 13. This\r\nis no agenda.\r\n\r\n...\r\n```\r\n\r\nI am not sure how common it is, but at least it exists.\r\n\r\nA complimentary approach that is less robust but does not rely on external data could be to match the relative position of sentences in the transcript with the relative time of the audio file (when no timestamps are available). Even if this was only able to generate precision to the minute, I think it would be helpful for most items I mentioned above. For some, like the scrolling text, it would probably perform quite well since so much of the transcript would be shown on the screen that the matched position does not have to be exact. It would probably benefit from calculating the relative audio position without silences (I noted that there is already an option in AP to skip these when listening).\r\n\nI like to add an idea mentioned in the issue above: **hide empty tabs** - that could be empty transcripts and especially nonexistent chapters, if only one tab remains the tablayout itself should probably be hidden.\r\n\r\nI think thats a sensible solution, to not crowd the AudioPlayer with empty tabs and require to user to swipe a thousand times to get to the desired tab, makes the UX clearer :)\n@tonytamsf Any idea how to implement the data store? Downloading all transcripts of all episodes could result in a huge amount of text to be stored. We already have the problem that the database is pretty big. I think it would be better to only store the URLs and then load the transcript when actually viewing the transcript page in AntennaPod. We could enable caching with okhttp to reduce the number of web requests. \n> @tonytamsf Any idea how to implement the data store? Downloading all transcripts of all episodes could result in a huge amount of text to be stored. We already have the problem that the database is pretty big. I think it would be better to only store the URLs and then load the transcript when actually viewing the transcript page in AntennaPod. We could enable caching with okhttp to reduce the number of web requests.\r\n\r\nI like your idea, there is no need to store transcription.  Depending on the user, they may not want to be downloading transcript using mobile data, so we might have to get user consent to use mobile to download transcript.\nWhy not storing transcript on file text on device? Same way episodes are stored. They would be removed along with episodes and it would allow to make them available like episodes are.\r\n\r\nEdit :\r\nAnd it won't clutter database except maybe to put a flag to know there is transcript downloaded. I am not sure it's even needed as all logics would be parallel to what is done for downloaded episodes.\nSounds like a good idea. When streaming, users need a data connection anyways. When downloading, we can download the transcripts, too. :+1:\n> Why not storing transcript on file text on device?\n\nI'm just wondering: this wouldn't hinder 'processing' the info (esp. timestamps, for # 4 in OP).\n\n> When downloading, we can download the transcripts, too\n\nJust to throw an idea out: couldn't this be done, but then in the db? As in, download & store in db when episode is downloaded; remove from dB when file is deleted? (Don't know if this would have any actual benefit, see above).\nI don't think storing and using text files would cause any problem : it is what video player does with srt files for subtitles.\nStoring it in the database but only for downloaded episodes should work :) Then we don't need to store the file path, we can just store the transcript directly.\nDon't know if you saw how Podverse implemented transcript with search. For reference there is a video of what they did : https://twitter.com/Podverse/status/1413642917760184325?s=19\r\n\r\nIMHO about their screen : \r\n- I would prefer timecode on left side and with a smaller font and using grey as text color. So time code would be there but won't distract your eyes when reading transcription\r\n- I wouldn't separate block like they did. It's like there is an empty line beetween each segment which is annoying when reading\nThanks for sharing that @Matth7878!\r\n\r\n> I would prefer timecode on left side and with a smaller font and using grey as text color\r\n\r\nFully agree\r\n\r\n> I wouldn't separate block like they did\r\n\r\nI understand your point, but we can't really merge sentences that are separated into two blocks I think:\r\n* we don't know where we can stitch parts together, and where a hard enter should be kept (in the interface). If there's no whitespace, it might still be complicated to read:\r\n![Schermafdruk van 2021-07-11 10-45-14](https://user-images.githubusercontent.com/11229646/125188759-38432280-e235-11eb-89f0-e0ce24a2ffff.png)\r\n* if we do stitch together the sentences, there might be a situation where one line on the screen covers three lines in the transcript file. Then we can only display the first timestamp, which can be problematic in some cases (e.g. when there is a line with `[silence]` that takes a minute - you wouldn't be able to jump to the bit after the silence).\r\n\nLet me take a stab at getting the podcast:transcript tag to download and stored.  Then we can work on the UI on the next step\n> Let me take a stab at getting the podcast:transcript tag to download and stored. Then we can work on the UI on the next step\r\n\r\nSorry I have been taking a break from AntennaPod.  I'm un-assigning myself until I get back\n\r\n> Sorry I have been taking a break from AntennaPod. I'm un-assigning myself until I get back\r\n\r\nI'm back with my beloved AP app. I'll start working on downloading the transcript\nAny thoughts about the support of all 4 content types in the `<podcast:transcript>` tag?\r\n\r\nSpec: https://github.com/Podcastindex-org/podcast-namespace/blob/main/transcripts/transcripts.md\r\n\r\n* HTML - this format has no or limited timecode - I recommend that we ignore this\r\n* JSON - Much more flexible - we should fully support this, I'm searching for sample podcast that use this format (not seeing it yet)\r\n* SRT - great for video or audio, max number of lines 2, max chars 32 - I recommend we support this fully\r\n* WebVTT - for HTML on the web, I recommend we don't support this\r\n\r\nExample: https://podnews.net/rss\r\n\r\n```\r\n<podcast:transcript url=\"https://podnews.net/audio/podnews230310.mp3.vtt\" type=\"text/vtt\" />\r\n<podcast:transcript url=\"https://podnews.net/audio/podnews230310.mp3.srt\" type=\"application/srt\" />\r\n<podcast:transcript url=\"https://podnews.net/audio/podnews230310.mp3.txt\" type=\"text/plain\" />\r\n<podcast:transcript url=\"https://podnews.net/audio/podnews230310.mp3.srt\" type=\"application/x-subrip\" rel=\"captions\" />\r\n```\r\n\r\nIt looks like Podnews also provides `text/pain` which is not in the Podcast 2.0 spec\r\n\r\n@jamescridland I am a loyal listener of Podnews, is there a reason you don't have JSON version of `podcast:transcript`?  \r\n\r\nExample: Podcasting 2.0 https://feeds.podcastindex.org/pc20.xml\r\n\r\nIt uses the SRT format \r\n`<podcast:transcript url=\"https://mp3s.nashownotes.com/PC20-125-Captions.srt\" type=\"application/srt\" rel=\"captions\"/>`\n@ByteHamster - do you have objections if I pull in this code to parse SRT files? https://github.com/gusthavosouza/SRTParser.\r\n\r\nI'm contacting the author about the missing license file his source code.\r\n\r\nIf you prefer I write my parser, I could do that.  It's not that hard.  Before I embark, I wanted to hear your opinion.\n> HTML - this format has no or limited timecode - I recommend that we ignore this\n\nAgreed.\n\nSupporting JSON & SRT is quite nice already.\n@tonytamsf I can't generate JSON transcripts - whisper.cpp is what I use, and it doesn't make them.\r\n\r\nI agree that supporting all four is redundant, and would agree with your suggestion to cease support for VTT. VTT seems to have been chosen because of support from libraries; but it seems to me that we are offering too many formats here for sensible support. It's not complicated to make an SRT using the same tools as that might make a VTT.\r\n\r\n(Edited) I was under the impression that support for HTML was as a simple link to a full web page with a transcript. This doesn't appear to be the case, and I believe that we should also remove this. So, we end up with (in preference order):\r\n\r\n1. JSON files for word-by-word closed-captioning, editing, etc.\r\n2. SRT files for closed-captioning (max 32 char length)\r\n\r\n(I shall also go and remove the TXT format from the Podnews feed; but will keep the VTT file there).\n> Any thoughts about the support of all 4 content types in the `<podcast:transcript>` tag?\r\n> \r\n> Spec: https://github.com/Podcastindex-org/podcast-namespace/blob/main/transcripts/transcripts.md\r\n> \r\n> * HTML - this format has no or limited timecode - I recommend that we ignore this\r\n> * JSON - Much more flexible - we should fully support this, I'm searching for sample podcast that use this format (not seeing it yet)\r\n> * SRT - great for video or audio, max number of lines 2, max chars 32 - I recommend we support this fully\r\n> * WebVTT - for HTML on the web, I recommend we don't support this\r\n> \r\n> Example: https://podnews.net/rss\r\n> \r\n> ```\r\n> <podcast:transcript url=\"https://podnews.net/audio/podnews230310.mp3.vtt\" type=\"text/vtt\" />\r\n> <podcast:transcript url=\"https://podnews.net/audio/podnews230310.mp3.srt\" type=\"application/srt\" />\r\n> <podcast:transcript url=\"https://podnews.net/audio/podnews230310.mp3.txt\" type=\"text/plain\" />\r\n> <podcast:transcript url=\"https://podnews.net/audio/podnews230310.mp3.srt\" type=\"application/x-subrip\" rel=\"captions\" />\r\n> ```\r\n> \r\n> It looks like Podnews also provides `text/pain` which is not in the Podcast 2.0 spec\r\n> \r\n> @jamescridland I am a loyal listener of Podnews, is there a reason you don't have JSON version of `podcast:transcript`?\r\n> \r\n> Example: Podcasting 2.0 https://feeds.podcastindex.org/pc20.xml\r\n> \r\n> It uses the SRT format `<podcast:transcript url=\"https://mp3s.nashownotes.com/PC20-125-Captions.srt\" type=\"application/srt\" rel=\"captions\"/>`\r\n\r\n@tonytamsf, @jamescridland, `text/plain` is mentioned [here](https://github.com/Podcastindex-org/podcast-namespace/blob/main/docs/1.0.md#transcript) but not [here](https://github.com/Podcastindex-org/podcast-namespace/blob/main/transcripts/transcripts.md).\nI don't get this removing supported formats business.  VTT is the only format supported natively by browsers, and like SRT+ in many ways but a proper w3c standard.  If some of the first apps to take a stab at implementing don't support all formats, that's on them (and will improve with time) - no need to penalize everyone else by removing valuable stuff from the spec.  We should encourage the server side to push as much signal out to the world as they can.\n> I don't get this removing supported formats business. VTT is the only format supported natively by browsers\r\n\r\nNote that this issue is about support for the transcript tag in AntennaPod. First I thought that HTML was pointless, but I see now that it has a (different) use case - outside of the scope of this issue.\r\n\r\nMaybe let's create a separate issue in the PC namespace repo about this wider (PC namespace) topic.\nAh, sorry - followed a clickbaity link from [podnews](https://podnews.net/update/size-matters), and thought this was referring to the spec itself!\r\n\r\n> [Should we drop support for VTT and even HTML file support](https://github.com/AntennaPod/AntennaPod/issues/4935#issuecomment-1465273529?utm_source=podnews.net&utm_medium=web&utm_campaign=podnews.net:2023-03-13) for the podcast:transcript tag?\r\n\n> do you have objections if I pull in this code to parse SRT files? https://github.com/gusthavosouza/SRTParser.\r\n\r\nIf the license allows that, it should be okay. Probably needs some changes, though, because we only want English comments and maybe don't need all the features.\n> because we only want English comments\r\n\r\nDo we? With 'comments' do you refer to the actual transcripts (subtitles)? If a user has their device in French and there are transcripts/subtitles available in French, why not use that instead.\r\n\r\nSide note on implementation: I would be in favour of storing the transcript 'on drive' for downloaded episodes. As we've discussed for chapters, it's probably too big for in the database, and retrieving it only on playtime causes issues like #6062.\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/podcast-subtitles/3365/4\n\n@keunes - I'm done with the data parsing for JSON and working on the SRT format now for `<podcast:transcript>`.  After I'm done with the data storage, I would like some mockups on how transcription would work in the AP app.\r\n\r\n1. How does transcription display while an episode is being played?  Does it by default hover as an overlay and users can click on the words to jump into a full timecode view?\r\n2. In the timecode full transcription view, I assume the user can scroll back and forward to view the transcription and tap on a timecode to jump into the audio?  Would each word highlight to follow along the audio?\r\n3. The user can copy and paste any portion transcript?\r\n4. Without the overlay of the words, can users jump to view the transcript before listening, how would that work?\r\n5. Propose Phase 2 : Can users search the transcripts in one episode, across all episodes and subscriptions?\nYeey. That's great news @tonytamsf!\n\nLet me try to reply to some of your questions:\n\n> How does transcription display while an episode is being played? Does it by default hover as an overlay and users can click on the words to jump into a full timecode view?\n\nBy default this 'live subtitling' should be enabled/visible in the full player, for discoverability (there are not yet many feeds with this tag, so we want to show it when it's available). It should be possible via a setting in the UI section to disable this. (I expect that someone at some point will ask to make this a setting at podcast level, e.g. to only turn it on for their language learning, but let's see.)\n\nWe'll need a mock-up for this. We can probably take inspiration from some of the other apps who have enabled this already. To make it work nicely, we might have to make some design/UI changes.\n\n> In the timecode full transcription view, I assume the user can scroll back and forward to view the transcription and tap on a timecode to jump into the audio?\n\nYes. We'll need a mock-up for this.\n\n> Would each word highlight to follow along the audio?\n\nDepends. It's not always possible at word-level. E.g. SRT/VTT does not \u2013 here I think we should highlight each fragment.\n\nIn any case, I think the highlighting should be quite subtle (and I'm wondering if it's acceptable if e.g. highlight colour is not visible to visually impaired/does not comply with accessibility standards). We'll need a mock-up for this.\n\nhttps://github.com/Podcastindex-org/podcast-namespace/blob/main/transcripts/transcripts.md\n\n(~~Which transcript file types do you support at thi point?~~ I see it's SRT and JSON.)\n\n>  The user can copy and paste any portion transcript?\n\nYes.\n\n> Without the overlay of the words, can users jump to view the transcript before listening, how would that work?\n\nYes, this should be possible. I made a proposal a long time ago here, following user feedback on a beta version: https://forum.antennapod.org/t/user-feedback-swipe-navigation-from-player-screen-2-3-beta/1119\n\nIt's probably a lot of work to implement, bit I still stand behind the UX concept.\n\n(As a back-up, there should probably be an entry in the overflow menu.)\n\n> Propose Phase 2 : Can users search the transcripts in one episode, across all episodes and subscriptions?\n\nThat would be cool indeed. Certainly *within* the current episode (e.g. to find the section where they talk about X). Global search is an entirely separate thing.\n> I made a proposal a long time ago here... It's probably a lot of work to implement, bit I still stand behind the UX concept. (As a back-up, there should probably be an entry in the overflow menu.)\r\n\r\nThat's outside the scope of this PR (and would need some discussion). For now, I would do the overflow button. There is enough to discuss about the subtitles dialog/page itself\nI have a working PR that can parse, scroll through the transcript while following the audio.   Feel free to download a test version and give some feedback. \r\n I use `Podnews Daily` to do my test https://github.com/AntennaPod/AntennaPod/pull/6710\r\n\r\nUnfortunately, after sampling podcasts that I am subscribed to, the state of the transcript format is still not super well supported.  Here is a sample of of 104 feeds\r\n\r\n# Podcasts sampling\r\n- Roblox Tech Talk - `text/plain` https://share.transistor.fm/s/39ce510f/transcript.txt\r\n   -  parsable with timecoees\r\n-  Dev Interrupted - `text/html` https://feeds.buzzsprout.com/1422892/10190284/transcript\r\n   - not parsable\r\n- The Method - json & 'text/html' https://feeds.buzzsprout.com/1859927/9638130/transcript\r\n   - html not parsable\r\n   - json is fine https://feeds.buzzsprout.com/1859927/9638130/transcript.json\r\n   - (only 2 episode)\r\n- Radical Candor - `application/x-subrip` https://freepodcasttranscription.com/transcription/5e6070b67882e784d6b5baf4b19976bb717f1115.srt\r\n   - parsable\r\n- Indie Bites - `text/plain` https://share.transistor.fm/s/6cdce2f8/transcript.txt (no timecodes)\r\n  - not parsable\r\n- The Golden Hour - `text/html` https://www.podcastone.com/episode/Someones-Getting-Tased--The-Golden-Hour-51-w/-Brendan-Schaub-Erik-Griffin--Chris-DElia?view=transcript\r\n   - not parsable\nHi, really exciting times for AntennaPod and Podcsting in general. I've been doing some research about the use of transcript in the Podcasting 2.0 namespace.\r\n- I've found that even these mime types being equivalent `text/srt` `application/srt` `application/x-subrip` most player don't support all 3, so in in a \"test\" feed I declare all for the same file. \r\n- SRT is the most used format, then JSON, VTT and TXT (but these are usually full transcripts, not subtitle with parsable timecodes)\r\n\r\nIn case is useful, I have a feed with different options of redirect/hosting with different formats and mime-types if you want to test different edge cases, as discussed here : https://github.com/podverse/podverse-web/issues/1168#issuecomment-1695231077\r\nProbably the redirect / hosting part is no problem here as that part was for testing CORS in different web players. (Gitlab Pages works best with web players than Archive if something is interested)\r\n\r\n```\r\nEpisode 16\r\nOp3+ archive.org + vtt only\r\n\r\nEpisode 15\r\nOp3+ gitlab + vtt only\r\n\r\nEpisode 09\r\nOp3 + gitlab + vtt\r\nOp3 + archive + srt\r\n\r\nEpisode 08 (without OP3)\r\nGitlab + vtt\r\nArchive + srt\r\n\r\nEpisode Episode 00\r\nOp3 + gitlab + vtt/srt\r\n\r\nAll others\r\nOP3 + archive + vtt/srt\r\n```\r\nA problem that I've found with some player, in case you want to take it into account, is that if there is first a transcript tag with a file that doesn't work, some player won't try the next tag that would work.\r\n\r\nFeed:\r\nhttps://kdeexpress.gitlab.io/feed\r\n\r\n**TL;NR**\r\n\r\nI would prioritize SRT parsing, then JSON and if there is no much trouble VTT given the similarities with SRT. \r\nFor `text/html` and `text/plain` I would either show a new screen with all the text just assuming that is the full transcript to read or just offer a link to be open in the web browser.\nI'd jump in here and say two things:\r\n\r\nThe accurate stat is [contained here](https://stats.podcastindex.org/hourly_counts.json) - which at the time of writing is: \r\n\r\n>    \"feedsWithTranscripts\": 38,255\r\n>    \"episodesWithTranscripts\": 1,379,606\r\n\r\nThere's obviously a chicken and egg scenario with support. If AntennaPod supports transcripts, it would be a significant benefit to podcasting as a whole, but also to the uptake of this feature. But you'll get considerable promotion when this is launched. (I will, as one guarantee, give you a headline story in Podnews.)\r\n\r\nSecondly; might I suggest you ideally support these in this format:\r\n\r\n1. JSON - this is accurate to the word level, and allows [this kind of highlighted transcript](https://www.steno.fm/show/9b024349-ccf0-5f69-a609-6b82873eab3c/episode/aHR0cHM6Ly9wb2RuZXdzLm5ldC91cGRhdGUvZ2Vuei1mYXN0ZXN0LWdyb3dpbmc=), where the individual word being said is highlighted on screen. That also allows you to lay out closed-captions in a very bespoke way - allowing you to properly wordwrap them. It also allows more features in future like clipping, where you could highlight a word or sentence, and have the app specifically clip that accurately.\r\n\r\n2. SRT - these are accurate to about 32 characters, and therefore the timing isn't as perfect as it could be. [It works like this](https://www.steno.fm/show/917393e3-1b1e-5cef-ace4-edaa54e1f810/episode/YTQ2OWE5ZmQtMzVlOC00MDNhLWIzMDUtZGEyNmU3MDE1ZjBh). \r\n\r\nI'd, frankly, not support TXT or HTML unless you really want to - my suspicion is that these are relatively poorly supported anyway. But it doesn't seem like a heavy lift to simply open these in a webview. (I'm also very unclear if anyone is using VTT.)\r\n\r\nI hope that helps a bit!\n> If AntennaPod supports transcripts\r\n\r\nThanks for chipping in @jamescridland - one of our contributors is already working on this functionality. Hope we can coordinate re your coverage when it gets released. :-)\r\n\r\n> JSON \u2026 That also allows you to lay out closed-captions in a very bespoke way - allowing you to properly wordwrap them\r\n\r\nSee, that's what I was thinking. But I'm also wondering: how. Let's say it is at word level, how do you wrap that into the traditional two lines neatly? Starting from the first word (with its time stamp) and fill up the two lines until the screen is full, and take the end-time of the last word as the end-time for these two lines? Do you 'hard break' when there's a comma, or a period? What about speaker changes?\r\n\r\nI feel that SRT - given that it's the provider's responsibility to make it work with the character limit - often will provide a more logical view (even if less accurate).\r\n\r\nEither way - I'm very happy that both SRT & JSON already can be fetched and parsed \ud83d\ude00\nThank you @jamescridland for the details, it is helpful.\n\nWhat would be helpful for me when I am implementing the transcript feature is to look at other Android apps that are supporting the transcript tag.  Do you recommend an app that has implemented this feature well and taken advantage of the JSON word level time code? \n[Podverse](https://github.com/podverse) could be a reference. [The web displays](https://podverse.fm/es/episode/hazS_hcJz) 1 word per line :-1: , but the mobile (-rn repo) app shows the full sentence :+1: . So I assume it's using a word level JSON.\r\nIn the Android app each line on sentences is a placeholder for the audio timestamps, not exactly a word by word. [Steno.fm](https://www.steno.fm/show/396d9ae0-da7e-5557-b894-b606231fa3ea/episode/QnV6enNwcm91dC0xMzgwNjg5Nw==) is 1 by 1, but I don't think it's open source :-1: \r\n\r\n![imagen](https://github.com/AntennaPod/AntennaPod/assets/2069735/ae51a17b-13b0-4928-934c-9c49b2156130)\r\n![imagen](https://github.com/AntennaPod/AntennaPod/assets/2069735/2d31a517-72df-4b48-9da9-00c957dc6f04)\r\n\n> What would be helpful for me when I am implementing the transcript feature is to look at other Android apps that are supporting the transcript tag.\n\n@tonytamsf Sorry for the silence on my end. I've been doing a comparative analysis of all the We/Android apps that support the transcript tag and will at some point this weekend share a couple of nice examples.\nHello,\r\n\r\nI've thought and designed a bit more over the weekend. Please find below some recordings of (web) apps that I particularly liked, and a link to some mock-ups I made.\r\n\r\nInspiration\r\n---\r\nI tested all Android & web-[apps listed on the Podcast Index website](https://podcastindex.org/apps?appTypes=podcast+player&elements=Transcript) that support the Transcript tag and are accessible without log-in. I always checked  episode [1601 - \"Unkool & The Gang\"](https://podcastindex.org/podcast/41504?episode=15754728488) of No agenda. It has [this SRT captions file](https://mp3s.nashownotes.com/NA-1601-Captions.srt). Here is [the podcast's RSS feed](https://feeds.noagendaassets.com/noagenda.xml).\r\n\r\n### Podfriend **\r\nCool because: has nicely designed subtitles, with different colours, and speaker images.\r\n\r\nhttps://github.com/AntennaPod/AntennaPod/assets/11229646/aa6d70d0-77d6-42dd-9d5a-ec7557145dd6\r\n\r\n### Steno **\r\ncool because: grouping of source content into blocks per speaker, highlighting background of actively playing blocks as well as selected block (when paused or searching)\r\n[Try for yourself](https://www.steno.fm/show/856cd618-7f34-57ea-9b84-3600f1f65e7f/episode/aHR0cDovLzE2MDEubm9hZ2VuZGFub3Rlcy5jb20=) - my recording is too big for GitHub.\r\n\r\n### Podfans *\r\ncool because: has up/down arrows in search bar, nice design of timestamps (thin + lighter colour - should try that in my mock-ups too, althgouh they only seem to use mm:ss, not hh)\r\n![Screenshot from 2023-10-29 23-16-03 podfans](https://github.com/AntennaPod/AntennaPod/assets/11229646/e94b019e-d7ba-4824-8c67-de9c5a9459a0)\r\n\r\n### Fountain *\r\ncool because: has a little (i) icon with info about the transcript timings - noting they \"might not be accurate if the podcaster has dynamic ads.\" --> not in mock-ups yet\r\n![Screenshot from 2023-10-29 23-09-47 Fountain](https://github.com/AntennaPod/AntennaPod/assets/11229646/007f0bdd-4fe6-40af-8100-a4cac7b4c1af)\r\n\r\n### Anytime Player *\r\ncool because: has 'follow transcript' toggle, the way scrolling position follows active block\r\n![Screenshot from 2023-10-29 23-13-14 anytime player](https://github.com/AntennaPod/AntennaPod/assets/11229646/350b356a-f936-4b2f-8a55-20c0aae2038d)\r\n\r\n### Podcast Addict\r\ncool because: has option in the player settings to (de)activate subtitles\r\n\r\nMock-up & general considerations\r\n---\r\n\r\nPlease find here the mock-ups I have so far: https://design.penpot.app/#/view/e357a320-7535-11eb-8a88-eb0147e048f5?page-id=eae2ba44-fe23-80be-8003-5736fde8c987&section=interactions&index=0&share-id=b509ea44-7222-80be-8003-5db588cbed16\r\n\r\nSome notes:\r\n* Several apps leverage speaker indication (either name + colon in SRT, or as metadata in JSON). It would be really neat if we can do that too. \r\n  * Steno 'collates' blocks - [Nathan explained how](https://mastodon.social/@keunes/111305523569815424).\r\n  * Podfriend & Anytime Player somehow connect speaker info from the subtitles with info from the `person` tags within the item (episode)\r\n```\r\n<podcast:person href=\"http://curry.com/\" img=\"https://upload.wikimedia.org/wikipedia/commons/thumb/d/d5/Adam_Curry_2016.jpg/440px-Adam_Curry_2016.jpg\" group=\"cast\" role=\"host\">Adam Curry</podcast:person>\r\n<podcast:person href=\"http://dvorak.org/blog\" img=\"https://speaking.com/wp-content/uploads/2018/09/John-Dvorak.jpg\" group=\"cast\" role=\"host\">John C Dvorak</podcast:person>\r\n```\r\n* I think we'll have to first identify if we have or can extract speakers, and adjust the design of the player & transcript screens for it. Yet maybe speaker indication (especially on the player screen) might be out of scope for now.\r\n* I kept the playback controls visible on purpose - I think it's handy to be able to pause and rewind when viewing the transcript.\r\n\r\n_The first set of screens you'll see are  in case there are speakers extracted/known, which can be displayed on the player screen. Followed by some screens where this is not the case. There's also some other details. Maybe it's best if we have a call @tonytamsf & @ByteHamster to see what's feasible for now._\n@keunes Thanks for the great research and screen casts of other players.   I can try to join the next community call about this topic if finding time is difficult \nWe'll be meeting to discuss the mock-ups Thursday 2 November at 21:00 CET, over at https://meet.antennapod.org/transcripts. Anyone interested in this UX review is welcome to join.\nAs discussed and agreed during the meeting:\r\n* implement as full-screen dialog (https://m3.material.io/components/dialogs/overview)\r\n* what to do with landscape player view? For now, easy implementation on the right-hand side.\r\n* store transcript SRT/JSON in filesystem\r\n* if there's word-level JSON without speaker:\r\n  * collate text blocks\r\n    * Sentence-based (using periods & question marks)\r\n    * If long pause, start new block\r\n    * If long single block without period, then break it up after x (30?) seconds\r\n  * combine highlighting in blocks of min. 1 second (e.g. 2 words) to avoid words being skipped due to 1-second refresh rate.\r\n\r\nDesign change to do:\r\n* tap on CC in player, open transcript dialog\r\n* setting to show/hide closed caption (TBC if in player settings or only in global>UI settings)\r\n\r\nIn separate PRs:\r\n* playback controls in transcript view\r\n* option to reach transcript from ep. detail page; show 'can't jump to postion' warning\r\n* Search in transcript\r\n* Speaker tag (parse & store; display in ep. details; display speaker photo in player screen)\nWe will be targeting the `transcript` branch on Github for this work.  Starting with PR https://github.com/AntennaPod/AntennaPod/pull/6739\nI have a test build of how we can display transcripts in 2 lines of text on the player screen.\n\nIt works for JSON (word by word) or SRT (a few seconds of text).\n\nThe way I am able to nicely display the transcript is as follows\n\n- join up segments of text at least one second, most json segments are less than 1 second\n- string together N segments and display them on the two lines of TextView, which has support for ellipses \n- when I detect an ellipse in the TexView, which means words are cut off at the end, start trimming words from the end until the display does not have ellipses. \n- move the words that have been ellipsed to the next segment, and  trimming a little more to get some buffer\n- calculate a reasonable (percentage of words trimmed) new start time of the next segment \n- display the text sync to the position of the audio\n- move to the next segment\n\n@keunes I would like to give this test build to you and maybe just one of two others (maybe @jamescridland ) to test out against different podcasts which have transcripts to make sure the algorithm works. I would like to do this before the code reviews because that will take many weeks while we can fine tune how transcripts will function in the UI.  \n\nnote: detecting words will be difficult with languages like Chinese and Arabic\n@keunes - I have a test build of the transcript functionality in the 3rd PR, it will display 2 lines of transcript in the player screen.  When you have time, please check out it.  If you wanted more podcasts that have the transcript tag to see the variety of how folks format their transcripts, I have crawl all 4 million podcasts from podcastindex.org found the [15233 urls](https://github.com/tonytamsf/podcastindex_data/blob/main/data/transcripts.podcasts.txt) of the podcasts which have at least one podcast:transcript tag\r\n\r\n- PR 3 https://github.com/tonytamsf/AntennaPod/pull/6/checks\r\n- Artifact https://github.com/AntennaPod/AntennaPod/suites/17875428651/artifacts/1026186509\nJust updating on the progress: in branch `transcript` the 2nd PR is merged to be able to download transcripts from the url in `podcast:transcript` https://github.com/AntennaPod/AntennaPod/pull/6797\r\n\r\nThe third PR is to parse SRT and JSON formats, and that is being reviewed https://github.com/AntennaPod/AntennaPod/pull/6852\n4th PR to display 2 lines of transcript on the cover https://github.com/AntennaPod/AntennaPod/pull/6912\n@keunes - take a look at the preview of iOS Podcast player and how the UX is for transcripts, play the video https://podnews.net/article/apple-podcasts-transcriptions-faq\r\n\r\n- Looks like they don't display 2 lines of transcript and just go full screen display\r\n- I like that they retain some basic episode information on the top\r\n- They do word by word highlight and increase the font size of the current line\r\n\nAlso adding some interesting stats here\r\nhttps://podcastindustryinsights.com/podcasting-2-0-features/\r\n\r\n```\r\nCurrent\r\n46,565\r\npodcasts with transcripts\r\n\r\n2,088,707\r\nepisodes with transcripts\r\n```\n> Looks like they don't display 2 lines of transcript and just go full screen display\n\nThat's interesting. Makes you wonder if we need the two-line fragment on the cover. Let's take some use-cases:\n* Language learning: Having the full text instead of just two lines is probably preferred. I'm purposefully processing the written text, so it's OK it takes the full screen. However, I would want to be able to pause & resume from that big screen (which doesn't seem possible in Apple podcasts).\n* Understanding of speakers with accents: I'm mainly listening, and occasionally checking the text. Meanwhile, I'm cleaning my inbox. Having the transcript full-screen is fine if it stays open while I switch between the mini-player and full player (so I don't have to reopen the transcript each time). Otherwise I'd rather have two lines which I keep on for the whole episode.\n* Understanding who speaks when, as hosts have similar voices: I don't really read the text, so the full transcript screen would be a bit much, but would be just as fine as two lines on the player screen.\n* Understanding what someone said, as a car was honking while I'm waiting for a traffic light: Here I'll prefer a full screen, so I can just 'activate' it for a moment, read the bit I missed while listening the podcast continue, without having to rewind.\n\nSeeing Apple's implementation and the use cases I can think of, I'm starting to think we might not need the subtitle version\u2026 @ByteHamster what do you think?\n\nPlus it might be easier to implement?\n\n> Also adding some interesting stats here\n\nDo you know what that does in terms of percentages vis-\u00e0-vis the full index?\nApple Podcasts actually has two views\r\n\r\nThe first is a full transcript view in the episode page, which is just text. Interestingly, there appear to be some restrictions on copy/paste from this view, with no \"Select All\" available, and it seems to only copy a few paragraphs over. This is a \"dumb\" transcript, in that it shows the whole transcript but there's nothing you can do with it.\r\n![IMG_0115](https://github.com/AntennaPod/AntennaPod/assets/231941/e8cbccea-7dcb-4950-a535-d262bcb98bd7)\r\n\r\nAdditionally, when playing the audio, you can turn on the closed-caption view. Apple does additional processing on these to enable word-by-word highlights; this is partially so that they can avoid spam appearing in the service, I would presume. This is an active transcript, so you can scroll down and tap on a section you want to hear.\r\n \r\n![IMG_0116](https://github.com/AntennaPod/AntennaPod/assets/231941/fd3a52ea-9783-423f-be82-9626bc105311)\r\n\r\nApple's own transcripts recognise changes of voices (judging by a look at the downloadable transcript) but it doesn't show the voice in the transcription. It's *supposed* to show voice names if you provide it with a marked-up VTT file, but it doesn't - the \"Unknown\" above is its attempt to parse my own VTT file.\r\n\r\nMy own view is that the \"only show two lines\" view - which the VTT file natually lends itself to - is not a particularly good thing; it requires you to look at the screen at all times, and offers little benefit in terms of navigation. Having seen Apple's version, it seems to avoid clutter by simply adding a \"captions\" button on the player itself, which opens a new screen.\r\n\r\nThe highlighting experience subtly makes the current paragraph larger; and then colours the text as the speaker says it. Assuming the VTT file is the only file you have, I'd suggest it's fine showing the current highlighted sentence in the paragraph; the word-by-word thing is nice, but doesn't really add much to the comprehension or experience.\n> Seeing Apple's implementation and the use cases I can think of, I'm starting to think we might not need the subtitle version\u2026 @ByteHamster what do you think?\r\n>\r\n> Plus it might be easier to implement?\r\n\r\nI would say it's probably a bit easier to implement, yes (at least we don't need to deal with doing line breaks manually). Also, I'm not a big fan of the moving text on the otherwise quite clean player screen anyway. So if @tonytamsf and you agree, I'm totally happy with just having the full transcript screen.\n> Apple Podcasts actually has two views\r\n> \r\n> The first is a full transcript view in the episode page, which is just text. Interestingly, there appear to be some restrictions on copy/paste from this view, with no \"Select All\" available, and it seems to only copy a few paragraphs over. This is a \"dumb\" transcript, in that it shows the whole transcript but there's nothing you can do with it. !\r\n...\r\n> Additionally, when playing the audio, you can turn on the closed-caption view. Apple does additional processing on these to enable word-by-word highlights; this is partially so that they can avoid spam appearing in the service, I would presume. This is an active transcript, so you can scroll down and tap on a section you want to hear.\r\n> \r\n\r\n@jamescridland - is there an issue with the transcript rollout in iTunes today?\r\n\r\n1) On the Podcasts app on my mac, they are featuring a 'Transcript' section, but none of those podcast RSS feeds show the `podcast:transcript` tag\r\n2) When I use view source or `curl` I also cannot see the `podcast:transcript` tag, for example the latest episode of RadioLab\r\n3) Is it at all possible that if it is not the iOS podcast app, Apple will not be showing the transcripts so Android apps or any non Apple iOS podcast apps will not benefit from transcripts?\r\n4) In this [article](https://www.macstories.net/stories/apple-releases-ios-and-ipados-17-4-with-major-safari-and-app-store-changes-in-the-eu-transcripts-for-podcasts-new-emoji-and-more/) on macrumors, `For now, Apple\u2019s generated transcripts are only available for podcasts published in the Apple Podcasts catalogue, not for podcasts you have manually added via an RSS feed` - Does that mean not all of 4 million podcasts on iTunes will get transcripts?\n> 1. On the Podcasts app on my mac, they are featuring a 'Transcript' section, but none of those podcast RSS feeds show the `podcast:transcript` tag\r\n\r\nApple produces its own transcripts, as well as using the podcast:transcript tag.\r\n\r\n> 2. When I use view source or `curl` I also cannot see the `podcast:transcript` tag, for example the latest episode of RadioLab\r\n\r\nAs above!\r\n\r\n> 3. Is it at all possible that if it is not the iOS podcast app, Apple will not be showing the transcripts so Android apps or any non Apple iOS podcast apps will not benefit from transcripts?\r\n\r\nIf there's a podcast:transcript tag listed, then anyone (like AntennaPod) can use the transcript.\r\n\r\nBut Apple isn't making its own transcripts (in the app) available to anyone other than the podcast creator. Which seems fair enough.\r\n\r\n> 4. In this [article](https://www.macstories.net/stories/apple-releases-ios-and-ipados-17-4-with-major-safari-and-app-store-changes-in-the-eu-transcripts-for-podcasts-new-emoji-and-more/) on macrumors, `For now, Apple\u2019s generated transcripts are only available for podcasts published in the Apple Podcasts catalogue, not for podcasts you have manually added via an RSS feed` - Does that mean not all of 4 million podcasts on iTunes will get transcripts?\r\n\r\nThere are only 2.4mn podcasts in Apple Podcasts. All of those come with auto-transcripts unless the creator has opted out.\n> 4\\. `Apple\u2019s generated transcripts are only available for podcasts published in the Apple Podcasts catalogue, not for podcasts you have manually added via an RSS feed` - Does that mean not all of 4 million podcasts on iTunes will get transcripts?\r\n\r\nJust since I'm updating my article...\r\n\r\nApple won't produce automated transcripts for RSS feeds you've manually added. But the app will, apparently, show transcripts from the podcast:transcript tag.\nThank you @jamescridland for the explanation.  Wow, talk about fragmenting the ecosystem with iOS wall.\n\nToday I am writing a school paper on why televisions and movies have gotten close to 100% close captioning but transcripts in podcast are still at 1%.  It is mind boggling \n\n\n\n> Wow, talk about fragmenting the ecosystem with iOS wall.\r\n\r\nActually, it's the opposite here. Apple has taken an open standard that's been under development for three years and implemented it in their app. But for those podcasts that can't be bothered to create a transcript to appear in Apple Podcasts, Apple will do it for them. That seems generous and the right thing to do.\r\n\r\n> transcripts in podcast are still at 1%\r\n\r\nIn Apple Podcasts, transcripts in podcasts are, from today, almost 100%.\r\nAnd Apple have ensured that creators remain in control of their work.\r\nIf there's anything to take away, it's that Apple have done 100% the correct thing.\n> > Wow, talk about fragmenting the ecosystem with iOS wall.\r\n> \r\n> Actually, it's the opposite here. Apple has taken an open standard that's been under development for three years and implemented it in their app. But for those podcasts that can't be bothered to create a transcript to appear in Apple Podcasts, Apple will do it for them. That seems generous and the right thing to do.\r\n\r\nSo if podcast A is transcribed by Apple, the RSS feed that is served out to non iOS Podcast players will not show the `podcast:transcript` tag (let's say it's hosted on transistor.fm). Apple is transcribing podcast A only for the Apple Podcast player.\r\n\r\nSo I will assume that the Apple Podcast app no longer fetches from the transistor.fm RSS feed directly?\r\n\r\nThen transistor.fm has to do it's own transcript in order for Spotify, AntennaPod, Overcast to consume. Is that the correct understanding?\r\n\r\nI guess it's too much to ask Apple to do us all a favor and give us the transcript for free via a `https://transcript.proxy.apple.com/?url=https://transistor.fm/feed.rss`\r\n\n> So if podcast A is transcribed by Apple, the RSS feed that is served out to non iOS Podcast players will not show the podcast:transcript tag (let's say it's hosted on transistor.fm). Apple is transcribing podcast A only for the Apple Podcast player. So I will assume that the Apple Podcast app no longer fetches from the transistor.fm RSS feed directly? Then transistor.fm has to do it's own transcript in order for Spotify, AntennaPod, Overcast to consume. Is that the correct understanding?\r\n\r\nNo, precisely wrong. If the creator is supplying a transcript, **Apple always uses it.**\r\nIf the creator doesn't supply a transcript, Apple - at its own expense - makes a transcript for its own app.\r\n\r\n> I guess it's too much to ask Apple to do us all a favor and give us the transcript for free\r\n\r\nAs the creator - Apple can do what it wants in its own app, but I don't want Apple to suddenly take control of my own RSS feed, no; and nor do I want it to produce transcripts for others.\r\n\r\nApple here is respecting the creator. And, good on them for doing so.\nre the references to Podverse: I can't find any obvious place in `podcast-rn` source that actually loads `<podcast:transcript>` tags from RSS feeds, nor have I been able to make Play Store's Podverse 4.15.4 fetch a transcript JSON file from my test server (after adding the test RSS feed to Podverse, my Apache logs show Podverse fetching the RSS but not the JSON, even when I play the episode, so it's unsurprising that no transcript is shown), nor was I able to make that version of Podverse show a transcript for `feeds.buzzsprout.com/1.rss` which has been cited as a working example of `podcast:transcript`.  So unless I've missed something, it seems Podverse gets its transcripts by some means *other* than the `<podcast:transcript>` tag and they are available only on select podcasts, therefore it's unfortunately not suitable as a player for testing the behaviour of new `<podcast:transcript>` tags.\nPodverse may not support JSON, but probably does SRT. Have you tried that?\nI see Podverse using the JSON transcript from `feeds.buzzsprout.com/1.rss` in their oldest episode: https://podverse.fm/episode/ubyZFbGg8f\r\n\r\n[Here\u2019s the line in podverse-rn](https://github.com/podverse/podverse-rn/blob/3489eca582fd028a518f4158c6f730389688303b/src/screens/EpisodeTranscriptScreen.tsx#L43-L53) where they fetch a transcript URL:\r\n```\r\nif (episode?.transcript?.[0]?.url && episode?.transcript?.[0]?.type) {\r\n  try {\r\n    if (episode?.id) {\r\n      parsedTranscript = await getEpisodeProxyTranscript(episode.id)\r\n    } else {\r\n      parsedTranscript = await getParsedTranscript(episode.transcript[0].url)\r\n    }\r\n  } catch (error) {\r\n    errorLogger(_fileName, 'componentDidMount', error)\r\n  }\r\n}\r\n```\nOh yes.\r\n\r\n<img width=\"646\" alt=\"Screenshot 2024-03-07 at 12 16 19\u202fpm\" src=\"https://github.com/AntennaPod/AntennaPod/assets/231941/385dfdb0-7ff2-45e7-a890-37daa10d9d1a\">\r\n\r\nTo the point of @ssb22 - the JSON call is absolutely made from the Podverse player.\nAh yes, and `getParsedTranscript` in `src/lib/transcriptHelpers.ts` fetches `transcriptUrl` then calls `convertFile` from [the Transcriptator library](https://github.com/stevencrader/transcriptator) which isn't part of the `podverse-rn` repo which explains why my grepping for JSON handling wasn't finding it.  Still my Apache logs were telling me my JSON file referred to in the below RSS wasn't being fetched by Podverse although it was fetched by Anytime Podcast Player:\r\n\r\n    <?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n    <rss version=\"2.0\" xmlns:atom=\"http://www.w3.org/2005/Atom\" xmlns:itunes=\"http://www.itunes.com/dtds/podcast-1.0.dtd\" xmlns:podcast=\"https://podcastindex.org/namespace/1.0\">\r\n    <channel>\r\n    <atom:link href=\"https://url.removed/\" rel=\"self\" type=\"application/rss+xml\" />\r\n    <title>Test Podcast Title</title>\r\n    <description>Test podcast description</description>\r\n    <link>https://url.removed</link>\r\n    <image>\r\n    <url>https://url.removed.jpg</url>\r\n    <title>Test Title</title>\r\n    <link>https://url.removed</link>\r\n    </image>\r\n    <item>\r\n    <guid>https://url.removed.mp3</guid>\r\n    <link>https://url.removed</link>\r\n    <title>Test Episode Title</title>\r\n    <description>Test episode description</description>\r\n    <podcast:transcript url=\"https://url.removed.json\" type=\"application/json\" />\r\n    <pubDate>Fri, 1 Mar 2024 00:00:00 +0000</pubDate>\r\n    <itunes:episode>1</itunes:episode>\r\n    <enclosure url=\"https://url.removed.mp3\" type=\"audio/mpeg\" length=\"2179906\"/>\r\n    <itunes:duration>153</itunes:duration>\r\n    </item>\r\n    </channel>\r\n    </rss>\r\n\nIf one imports the `feeds.buzzsprout.com/1.rss` feed into Apple Podcasts it doesn't show any transcripts. It does show the chapters, so they do have other Podcast 2.0 features. It seems they do not read transcripts from RSS feeds. Anyone have pointers on why transcripts are not viable sometimes?\nSorry, this is the AntennaPod bug & feature request tracker. For questions about Apple Podcasts, please use their support channels.", "created_at": "2024-04-14T20:57:13Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7102, "instance_id": "AntennaPod__AntennaPod-7102", "issue_numbers": ["5029", "7092"], "base_commit": "25e4703da4fc7717419c03e6fc953b6711b0c244", "patch": "diff --git a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\nindex 7f213a598e..02a6c95006 100644\n--- a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\n+++ b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\n@@ -162,6 +162,7 @@ public class PlaybackService extends MediaBrowserServiceCompat {\n     private CastStateListener castStateListener;\n \n     private String autoSkippedFeedMediaId = null;\n+    private String positionJustResetAfterPlayback = null;\n     private int clickCount = 0;\n     private final Handler clickHandler = new Handler(Looper.getMainLooper());\n \n@@ -874,6 +875,7 @@ public void statusChanged(PlaybackServiceMediaPlayer.PSMPInfo newInfo) {\n                                 (ctx) -> disableSleepTimer(), getString(R.string.undo)));\n                     }\n                     loadQueueForMediaSession();\n+                    positionJustResetAfterPlayback = null;\n                     break;\n                 case ERROR:\n                     PlaybackPreferences.writeNoMediaPlaying();\n@@ -935,15 +937,17 @@ public void onPlaybackStart(@NonNull Playable playable, int position) {\n         public void onPlaybackPause(Playable playable, int position) {\n             taskManager.cancelPositionSaver();\n             cancelPositionObserver();\n-            saveCurrentPosition(position == Playable.INVALID_TIME || playable == null, playable, position);\n             taskManager.cancelWidgetUpdater();\n-            if (playable != null) {\n-                if (playable instanceof FeedMedia) {\n-                    SynchronizationQueueSink.enqueueEpisodePlayedIfSynchronizationIsActive(getApplicationContext(),\n-                            (FeedMedia) playable, false);\n+            if (playable instanceof FeedMedia) {\n+                FeedMedia media = (FeedMedia) playable;\n+                if (!media.getItem().getIdentifyingValue().equals(positionJustResetAfterPlayback)) {\n+                    // Don't store position after position is already reset\n+                    saveCurrentPosition(position == Playable.INVALID_TIME, playable, position);\n                 }\n-                playable.onPlaybackPause(getApplicationContext());\n+                SynchronizationQueueSink.enqueueEpisodePlayedIfSynchronizationIsActive(getApplicationContext(),\n+                        media, false);\n             }\n+            playable.onPlaybackPause(getApplicationContext());\n         }\n \n         @Override\n@@ -1152,6 +1156,7 @@ private void onPostPlayback(final Playable playable, boolean ended, boolean skip\n                     || autoSkipped\n                     || (skipped && !UserPreferences.shouldSkipKeepEpisode())) {\n                 // only mark the item as played if we're not keeping it anyways\n+                positionJustResetAfterPlayback = item.getIdentifyingValue();\n                 DBWriter.markItemPlayed(item, FeedItem.PLAYED, ended || (skipped && almostEnded));\n                 // don't know if it actually matters to not autodownload when smart mark as played is triggered\n                 DBWriter.removeQueueItem(PlaybackService.this, ended, item);\n", "test_patch": "", "problem_statement": "Sometimes the position is not reset after an episode ends\n# Checklist\r\n<!-- Place an x in the boxes to tick them: [x] -->\r\n\r\n- [x] I have used the search function to see if someone else has already submitted the same bug report.\r\n- [x] I will describe the problem with as much detail as possible.\r\n- [x] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n# System info\r\n<!-- The following information is very important to fill out because some bugs may only occur on certain devices or versions of Android. -->\r\n\r\n**App version**: 2.2.0 develop\r\n<!-- The latest version may be different depending on your device. You can find the version in AntennaPod's settings. -->\r\n\r\n**App source**: custom\r\n<!-- Please delete irrelevant answer or fill in the blank -->\r\n\r\n**Android version**: 10 (LineageOS)\r\n\r\n**Device model**: OnePlus 3T\r\n\r\n# Bug description\r\n\r\n**Steps to reproduce**:\r\n\r\nI don't know, unfortunately\r\n\r\n**Expected behaviour**:\r\n<!-- After following the steps, what did you think AntennaPod would do? -->\r\nWhenever an episode plays to the end, it should be marked as played and its progress bar should be hidden.\r\n\r\n**Current behaviour**:\r\n<!-- What did AntennaPod do instead? Screenshots might help. Usually, you can take a screenshot of your smartphone by pressing *Power* + *Volume down* for a few seconds. -->\r\nSometimes it is marked as played but the progress bar is still there. I think this happens when there is a race condition between marking the episode as played (which also resets the position, so it is no longer displayed in the progress bar) and the position saver that is triggered every 5 seconds in a background thread.\nPlayed episodes still display progress upon completion\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.4.0-beta1 (58db8f103)\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\n_No response_\n\n### First occurred\n\nLast 1.5 days\n\n### Steps to reproduce\n\nThis looks like a recent regression, as it wasn't happening in 3.3.x. All episodes I have played so far on this version are affected.\r\nDespite the issue, auto-deletion and removal from queue both work correctly.\r\n\r\n1. Play an episode and reach the end (it doesn't seem to matter whether by playing or fast-forwarding)\n\n### Expected behaviour\n\n2. The episode is marked as played, with no progress bar visible\n\n### Current behaviour\n\n2. The episode still has a progress bar visible, as if it was paused\n\n### Logs\n\n_No response_\n", "hints_text": "I've also been seeing this quite regularly.\nI can confirm that behaviour for a regular v2.1.4  on Android 6.0.1. \nPlease verify whether this might have to do with the \"skip last n seconds\" setting. \n@uli-on Are you asking if people experiencing the issue have that enabled? I don't have the skip setting turned on but still see the problem.\nI've just set up a quick test with 3x setting a skip n seconds to some value and another 3x resetting to zero, and the progress bar remains with any value other than zero while it is removed with a value of zero. \r\nThe episode is removed, though, from the waiting queue (my translation of the German term \"Warteschlange\".) \nAlso not using the playback speed features here. Just plain playing podcasts from the queue.\nWhen using the auto-skip feature, keeping the position is currently actually intended. If you sometimes still want to hear the skipped part, you can just press \"play\" again. The missing reset described above sometimes happens even if skipping is turned off (because two parallel parts of the code are sometimes executed in the wrong order).\nHi there! Not sure if it fits there or I should start another thread, but I seen this happening today (screenshot attached)\r\nWe see the notification from the drawer and the top side of it is accurate. We see that I'm listening to episode 012. But the slider (progress bar) is frozen and is showing a time from the previous episode.\r\nAt the bottom of the screen we see accurate representation of what's happening - playback is on, it's at 6:30 and going further, the episode number is correct.\r\n<img src=\"https://user-images.githubusercontent.com/87779052/126540731-a7b72e76-b826-4a1c-a0b2-d880c39c615f.png\" alt=\"Screenshot_20210721-165923\" width=\"300\"/>\r\n\r\n\nAlso not sure if this is the same issue, but I frequently (every few days) have episodes play to the end but not clean up.\r\n\r\ne.g., \r\n\r\n![Screenshot from 2021-09-22 16-06-19](https://user-images.githubusercontent.com/2869/134292034-b73c308f-93a9-4301-a92b-8eea4a23742c.png)\r\n\r\nI do not play at accelerated speed. Smart marked played is set to 1 minute.\r\n\r\nThe `full-logs.txt` doesn't have much interesting, except maybe\r\n\r\n```\r\n09-12 12:55:44.739  8654  8654 D AudioPlayerFragment: currentPosition 00:00:00\r\n09-12 12:55:44.739  8654  8654 W AudioPlayerFragment: Could not react to position observer update because of invalid time\r\n```\r\n\nI have not seen this happen in 2 years. I assume it's fixed.\nCan confirm. Same here with Android 14.", "created_at": "2024-04-14T19:59:52Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7101, "instance_id": "AntennaPod__AntennaPod-7101", "issue_numbers": ["7099"], "base_commit": "25e4703da4fc7717419c03e6fc953b6711b0c244", "patch": "diff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedPreferences.java b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedPreferences.java\nindex 04c3849a27..a5fe60fb29 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedPreferences.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedPreferences.java\n@@ -249,6 +249,9 @@ public void setFeedSkipSilence(SkipSilence skipSilence) {\n     }\n \n     public SkipSilence getFeedSkipSilence() {\n+        if (feedPlaybackSpeed == SPEED_USE_GLOBAL) {\n+            return SkipSilence.GLOBAL;\n+        }\n         return feedSkipSilence;\n     }\n \ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java\nindex b7aec5b390..5285010c39 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java\n@@ -7,6 +7,7 @@\n import android.util.Log;\n \n import de.danoeh.antennapod.model.feed.FeedItem;\n+import de.danoeh.antennapod.model.feed.FeedPreferences;\n \n import static de.danoeh.antennapod.model.feed.FeedPreferences.SPEED_USE_GLOBAL;\n \n@@ -336,7 +337,8 @@ static void upgrade(final SQLiteDatabase db, final int oldVersion, final int new\n         }\n         if (oldVersion < 3040000) {\n             db.execSQL(\"ALTER TABLE \" + PodDBAdapter.TABLE_NAME_FEEDS\n-                    + \" ADD COLUMN \" + PodDBAdapter.KEY_FEED_SKIP_SILENCE + \" INTEGER\");\n+                    + \" ADD COLUMN \" + PodDBAdapter.KEY_FEED_SKIP_SILENCE\n+                    + \" INTEGER DEFAULT \" + FeedPreferences.SkipSilence.GLOBAL.code);\n         }\n     }\n \n", "test_patch": "", "problem_statement": "'Skip silence in audio' checkbox reverts to unchecked when a new podcast episode starts\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.4.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\nall\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n-  Check box \u2018Skip silence in audio\u2019\r\n-    Play episode, then let new episode start playing\r\n-    Check setting\r\n\r\n\r\nhttps://forum.antennapod.org/t/skip-silence-in-audio-checkbox-reverts-to-unchecked-when-a-new-podcast-episode-starts/4444\n\n### Expected behaviour\n\n_No response_\n\n### Current behaviour\n\n_No response_\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2024-04-14T19:38:56Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7100, "instance_id": "AntennaPod__AntennaPod-7100", "issue_numbers": ["6889"], "base_commit": "e9b3cc34fe211ab3b03c30c6c483078b99ba7561", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/SearchFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/SearchFragment.java\nindex 85d837a511..0416cca757 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/SearchFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/SearchFragment.java\n@@ -6,7 +6,6 @@\n import android.os.Handler;\n import android.os.Looper;\n import android.util.Log;\n-import android.util.Pair;\n import android.view.ContextMenu;\n import android.view.LayoutInflater;\n import android.view.MenuItem;\n@@ -75,7 +74,8 @@ public class SearchFragment extends Fragment implements EpisodeItemListAdapter.O\n \n     private EpisodeItemListAdapter adapter;\n     private HorizontalFeedListAdapter adapterFeeds;\n-    private Disposable disposable;\n+    private Disposable disposableFeeds;\n+    private Disposable disposableEpisodes;\n     private ProgressBar progressBar;\n     private EmptyViewHandler emptyViewHandler;\n     private EpisodeItemListRecyclerView recyclerView;\n@@ -127,8 +127,11 @@ public void onCreate(Bundle savedInstanceState) {\n     @Override\n     public void onStop() {\n         super.onStop();\n-        if (disposable != null) {\n-            disposable.dispose();\n+        if (disposableFeeds != null) {\n+            disposableFeeds.dispose();\n+        }\n+        if (disposableEpisodes != null) {\n+            disposableEpisodes.dispose();\n         }\n     }\n \n@@ -373,44 +376,45 @@ private void searchWithProgressBar() {\n     }\n \n     private void search() {\n-        if (disposable != null) {\n-            disposable.dispose();\n+        if (disposableFeeds != null) {\n+            disposableFeeds.dispose();\n+        }\n+        if (disposableEpisodes != null) {\n+            disposableEpisodes.dispose();\n         }\n         adapterFeeds.setEndButton(R.string.search_online, this::searchOnline);\n-        chip.setVisibility((getArguments().getLong(ARG_FEED, 0) == 0) ? View.GONE : View.VISIBLE);\n-        disposable = Observable.fromCallable(this::performSearch)\n+        long feed = getArguments().getLong(ARG_FEED, 0);\n+        chip.setVisibility((feed == 0) ? View.GONE : View.VISIBLE);\n+\n+        String query = searchView.getQuery().toString();\n+        if (query.isEmpty()) {\n+            emptyViewHandler.setMessage(R.string.type_to_search);\n+            return;\n+        }\n+        if (feed != 0) {\n+            // Search within a feed\n+            adapterFeeds.updateData(Collections.emptyList());\n+        } else {\n+            disposableFeeds = Observable.fromCallable(() -> DBReader.searchFeeds(query))\n+                    .subscribeOn(Schedulers.io())\n+                    .observeOn(AndroidSchedulers.mainThread())\n+                    .subscribe(results -> {\n+                        progressBar.setVisibility(View.GONE);\n+                        adapterFeeds.updateData(results);\n+                        emptyViewHandler.setMessage(getString(R.string.no_results_for_query, query));\n+                    }, error -> Log.e(TAG, Log.getStackTraceString(error)));\n+        }\n+        disposableEpisodes = Observable.fromCallable(() -> DBReader.searchFeedItems(feed, query))\n                 .subscribeOn(Schedulers.io())\n                 .observeOn(AndroidSchedulers.mainThread())\n                 .subscribe(results -> {\n                     progressBar.setVisibility(View.GONE);\n-                    this.results = results.first;\n-                    adapter.updateItems(results.first);\n-                    if (getArguments().getLong(ARG_FEED, 0) == 0) {\n-                        adapterFeeds.updateData(results.second);\n-                    } else {\n-                        adapterFeeds.updateData(Collections.emptyList());\n-                    }\n-\n-                    if (searchView.getQuery().toString().isEmpty()) {\n-                        emptyViewHandler.setMessage(R.string.type_to_search);\n-                    } else {\n-                        emptyViewHandler.setMessage(getString(R.string.no_results_for_query, searchView.getQuery()));\n-                    }\n+                    this.results = results;\n+                    adapter.updateItems(results);\n+                    emptyViewHandler.setMessage(getString(R.string.no_results_for_query, searchView.getQuery()));\n                 }, error -> Log.e(TAG, Log.getStackTraceString(error)));\n     }\n \n-    @NonNull\n-    private Pair<List<FeedItem>, List<Feed>> performSearch() {\n-        String query = searchView.getQuery().toString();\n-        if (query.isEmpty()) {\n-            return new Pair<>(Collections.emptyList(), Collections.emptyList());\n-        }\n-        long feed = getArguments().getLong(ARG_FEED);\n-        List<FeedItem> items = DBReader.searchFeedItems(feed, query);\n-        List<Feed> feeds = DBReader.searchFeeds(query);\n-        return new Pair<>(items, feeds);\n-    }\n-    \n     private void showInputMethod(View view) {\n         InputMethodManager imm = (InputMethodManager) getActivity().getSystemService(Context.INPUT_METHOD_SERVICE);\n         if (imm != null) {\n", "test_patch": "", "problem_statement": "Show search results for podcasts before results for episodes\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.2.0\n\n### Where did you get the app from\n\nF-Droid\n\n### Problem you may be having, or feature you want\n\n\u64ad\u5ba2\u4e00\u591a\uff0c\u641c\u7d22\u9700\u8981\u5f88\u957f\u65f6\u95f4\u624d\u80fd\u51fa\u7ed3\u679c\u3002\nWhen there are so many podcasts, the search takes a long time to produce results.\n\n### Suggested solution\n\n\u81f3\u5c11\u5148\u51fa\u73b0\u64ad\u5ba2\u540d\uff0c\u518d\u7ee7\u7eed\u51fa\u8282\u76ee\u7684\u641c\u7d22\u7ed3\u679c\u3002\u6216\u8005\uff0c\u5728\u201c\u8ba2\u9605\u201d\u4e2d\uff0c\u5e94\u8be5\u53ea\u641c\u7d22\u64ad\u5ba2\u540d\u3002\nAt least the podcast name appears first, and then the search results for the show continue. Or, in Subscriptions, you should just search for the podcast name.\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "", "created_at": "2024-04-14T17:49:08Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7098, "instance_id": "AntennaPod__AntennaPod-7098", "issue_numbers": ["4710"], "base_commit": "cb1a03cd8d55efca8a815d9c55b6a9a6448c0267", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/actionbutton/ItemActionButton.java b/app/src/main/java/de/danoeh/antennapod/actionbutton/ItemActionButton.java\nindex 84b2461670..54714be3d1 100644\n--- a/app/src/main/java/de/danoeh/antennapod/actionbutton/ItemActionButton.java\n+++ b/app/src/main/java/de/danoeh/antennapod/actionbutton/ItemActionButton.java\n@@ -7,6 +7,7 @@\n import androidx.annotation.StringRes;\n import android.view.View;\n \n+import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.playback.service.PlaybackStatus;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedMedia;\n@@ -48,6 +49,8 @@ public static ItemActionButton forItem(@NonNull FeedItem item) {\n             return new PlayActionButton(item);\n         } else if (isDownloadingMedia) {\n             return new CancelDownloadActionButton(item);\n+        } else if (item.getFeed().getState() != Feed.STATE_SUBSCRIBED) {\n+            return new StreamActionButton(item);\n         } else if (UserPreferences.isStreamOverDownload()) {\n             return new StreamActionButton(item);\n         } else {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemListAdapter.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemListAdapter.java\nindex 5082f25ffd..db79912611 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemListAdapter.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemListAdapter.java\n@@ -12,6 +12,7 @@\n \n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n+import androidx.fragment.app.FragmentActivity;\n import androidx.recyclerview.widget.RecyclerView;\n \n import de.danoeh.antennapod.ui.SelectableAdapter;\n@@ -32,13 +33,13 @@\n public class EpisodeItemListAdapter extends SelectableAdapter<EpisodeItemViewHolder>\n         implements View.OnCreateContextMenuListener {\n \n-    private final WeakReference<MainActivity> mainActivityRef;\n+    private final WeakReference<FragmentActivity> mainActivityRef;\n     private List<FeedItem> episodes = new ArrayList<>();\n     private FeedItem longPressedItem;\n     int longPressedPosition = 0; // used to init actionMode\n     private int dummyViews = 0;\n \n-    public EpisodeItemListAdapter(MainActivity mainActivity) {\n+    public EpisodeItemListAdapter(FragmentActivity mainActivity) {\n         super(mainActivity);\n         this.mainActivityRef = new WeakReference<>(mainActivity);\n         setHasStableIds(true);\n@@ -86,9 +87,18 @@ public final void onBindViewHolder(EpisodeItemViewHolder holder, int pos) {\n         holder.bind(item);\n \n         holder.itemView.setOnClickListener(v -> {\n-            MainActivity activity = mainActivityRef.get();\n-            if (activity != null && !inActionMode()) {\n-                activity.loadChildFragment(ItemPagerFragment.newInstance(episodes, item));\n+            if (!inActionMode()) {\n+                if (mainActivityRef.get() instanceof MainActivity) {\n+                    ((MainActivity) mainActivityRef.get())\n+                            .loadChildFragment(ItemPagerFragment.newInstance(episodes, item));\n+                } else {\n+                    ItemPagerFragment fragment = ItemPagerFragment.newInstance(episodes, item);\n+                    mainActivityRef.get().getSupportFragmentManager()\n+                            .beginTransaction()\n+                            .replace(R.id.fragmentContainer, fragment, \"Items\")\n+                            .addToBackStack(\"Items\")\n+                            .commitAllowingStateLoss();\n+                }\n             } else {\n                 toggleSelection(holder.getBindingAdapterPosition());\n             }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemViewHolder.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemViewHolder.java\nindex dd1a10450c..c5868a945f 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemViewHolder.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemViewHolder.java\n@@ -1,5 +1,6 @@\n package de.danoeh.antennapod.ui.episodeslist;\n \n+import android.app.Activity;\n import android.os.Build;\n import android.text.Layout;\n import android.text.format.Formatter;\n@@ -17,7 +18,6 @@\n import com.google.android.material.elevation.SurfaceColors;\n \n import de.danoeh.antennapod.R;\n-import de.danoeh.antennapod.activity.MainActivity;\n import de.danoeh.antennapod.ui.CoverLoader;\n import de.danoeh.antennapod.actionbutton.ItemActionButton;\n import de.danoeh.antennapod.playback.service.PlaybackStatus;\n@@ -62,10 +62,10 @@ public class EpisodeItemViewHolder extends RecyclerView.ViewHolder {\n     private final View leftPadding;\n     public final CardView coverHolder;\n \n-    private final MainActivity activity;\n+    private final Activity activity;\n     private FeedItem item;\n \n-    public EpisodeItemViewHolder(MainActivity activity, ViewGroup parent) {\n+    public EpisodeItemViewHolder(Activity activity, ViewGroup parent) {\n         super(LayoutInflater.from(activity).inflate(R.layout.feeditemlist_item, parent, false));\n         this.activity = activity;\n         container = itemView.findViewById(R.id.container);\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeMultiSelectActionHandler.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeMultiSelectActionHandler.java\nindex 76ed47de53..a655982cbb 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeMultiSelectActionHandler.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeMultiSelectActionHandler.java\n@@ -1,29 +1,28 @@\n package de.danoeh.antennapod.ui.episodeslist;\n \n+import android.app.Activity;\n import android.util.Log;\n \n import androidx.annotation.PluralsRes;\n \n-import com.google.android.material.snackbar.Snackbar;\n-\n import java.util.List;\n \n import de.danoeh.antennapod.R;\n-import de.danoeh.antennapod.activity.MainActivity;\n+import de.danoeh.antennapod.event.MessageEvent;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n import de.danoeh.antennapod.storage.database.DBWriter;\n import de.danoeh.antennapod.storage.database.LongList;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.ui.view.LocalDeleteModal;\n+import org.greenrobot.eventbus.EventBus;\n \n public class EpisodeMultiSelectActionHandler {\n     private static final String TAG = \"EpisodeSelectHandler\";\n-    private final MainActivity activity;\n+    private final Activity activity;\n     private final int actionId;\n     private int totalNumItems = 0;\n-    private Snackbar snackbar = null;\n \n-    public EpisodeMultiSelectActionHandler(MainActivity activity, int actionId) {\n+    public EpisodeMultiSelectActionHandler(Activity activity, int actionId) {\n         this.activity = activity;\n         this.actionId = actionId;\n     }\n@@ -116,12 +115,7 @@ private void showMessage(@PluralsRes int msgId, int numItems) {\n         totalNumItems += numItems;\n         activity.runOnUiThread(() -> {\n             String text = activity.getResources().getQuantityString(msgId, totalNumItems, totalNumItems);\n-            if (snackbar != null) {\n-                snackbar.setText(text);\n-                snackbar.show(); // Resets the timeout\n-            } else {\n-                snackbar = activity.showSnackbarAbovePlayer(text, Snackbar.LENGTH_LONG);\n-            }\n+            EventBus.getDefault().post(new MessageEvent(text));\n         });\n     }\n \ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java\nindex e1974940c1..720e0ccbcd 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java\n@@ -16,6 +16,7 @@\n \n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n+import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.net.sync.serviceinterface.SynchronizationQueueSink;\n import de.danoeh.antennapod.storage.preferences.PlaybackPreferences;\n import de.danoeh.antennapod.playback.service.PlaybackServiceInterface;\n@@ -84,6 +85,10 @@ public static boolean onPrepareMenu(Menu menu, FeedItem selectedItem) {\n         setItemVisibility(menu, R.id.add_to_favorites_item, !isFavorite);\n         setItemVisibility(menu, R.id.remove_from_favorites_item, isFavorite);\n         setItemVisibility(menu, R.id.remove_item, fileDownloaded || isLocalFile);\n+\n+        if (selectedItem.getFeed().getState() != Feed.STATE_SUBSCRIBED) {\n+            setItemVisibility(menu, R.id.mark_read_item, false);\n+        }\n         return true;\n     }\n \n@@ -158,7 +163,8 @@ public static boolean onMenuItemClicked(@NonNull Fragment fragment, int menuItem\n         } else if (menuItemId == R.id.mark_read_item) {\n             selectedItem.setPlayed(true);\n             DBWriter.markItemPlayed(selectedItem, FeedItem.PLAYED, true);\n-            if (!selectedItem.getFeed().isLocalFeed() && SynchronizationSettings.isProviderConnected()) {\n+            if (!selectedItem.getFeed().isLocalFeed() && selectedItem.getFeed().getState() == Feed.STATE_SUBSCRIBED\n+                    && SynchronizationSettings.isProviderConnected()) {\n                 FeedMedia media = selectedItem.getMedia();\n                 // not all items have media, Gpodder only cares about those that do\n                 if (media != null) {\n@@ -174,7 +180,8 @@ public static boolean onMenuItemClicked(@NonNull Fragment fragment, int menuItem\n         } else if (menuItemId == R.id.mark_unread_item) {\n             selectedItem.setPlayed(false);\n             DBWriter.markItemPlayed(selectedItem, FeedItem.UNPLAYED, false);\n-            if (!selectedItem.getFeed().isLocalFeed() && selectedItem.getMedia() != null) {\n+            if (!selectedItem.getFeed().isLocalFeed() && selectedItem.getMedia() != null\n+                    && selectedItem.getFeed().getState() == Feed.STATE_SUBSCRIBED) {\n                 EpisodeAction actionNew = new EpisodeAction.Builder(selectedItem, EpisodeAction.NEW)\n                         .currentTimestamp()\n                         .build();\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/AllEpisodesFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/AllEpisodesFragment.java\nindex eb49c94d93..6e48ade397 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/AllEpisodesFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/AllEpisodesFragment.java\n@@ -66,7 +66,12 @@ protected int loadTotalItemCount() {\n \n     @Override\n     protected FeedItemFilter getFilter() {\n-        return new FeedItemFilter(UserPreferences.getPrefFilterAllEpisodes());\n+        FeedItemFilter filter = new FeedItemFilter(UserPreferences.getPrefFilterAllEpisodes());\n+        if (filter.showIsFavorite) {\n+            return new FeedItemFilter(filter, FeedItemFilter.INCLUDE_NOT_SUBSCRIBED);\n+        } else {\n+            return filter;\n+        }\n     }\n \n     @Override\n@@ -91,6 +96,7 @@ public boolean onMenuItemClick(MenuItem item) {\n             ArrayList<String> filter = new ArrayList<>(getFilter().getValuesList());\n             if (filter.contains(FeedItemFilter.IS_FAVORITE)) {\n                 filter.remove(FeedItemFilter.IS_FAVORITE);\n+                filter.remove(FeedItemFilter.INCLUDE_NOT_SUBSCRIBED);\n             } else {\n                 filter.add(FeedItemFilter.IS_FAVORITE);\n             }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/PlaybackHistoryFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/PlaybackHistoryFragment.java\nindex a02f86bd21..abdf043b1e 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/PlaybackHistoryFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/PlaybackHistoryFragment.java\n@@ -23,7 +23,8 @@\n \n public class PlaybackHistoryFragment extends EpisodesListFragment {\n     public static final String TAG = \"PlaybackHistoryFragment\";\n-    private static final FeedItemFilter FILTER_HISTORY = new FeedItemFilter(FeedItemFilter.IS_IN_HISTORY);\n+    private static final FeedItemFilter FILTER_HISTORY = new FeedItemFilter(\n+            FeedItemFilter.IS_IN_HISTORY, FeedItemFilter.INCLUDE_NOT_SUBSCRIBED);\n \n     @NonNull\n     @Override\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java\nindex 001c2b4658..0d82b71330 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java\n@@ -285,7 +285,7 @@ private void loadItems() {\n         disposable = Observable.fromCallable(() -> {\n             SortOrder sortOrder = UserPreferences.getDownloadsSortedOrder();\n             List<FeedItem> downloadedItems = DBReader.getEpisodes(0, Integer.MAX_VALUE,\n-                        new FeedItemFilter(FeedItemFilter.DOWNLOADED), sortOrder);\n+                    new FeedItemFilter(FeedItemFilter.DOWNLOADED, FeedItemFilter.INCLUDE_NOT_SUBSCRIBED), sortOrder);\n \n             List<String> mediaUrls = new ArrayList<>();\n             if (runningDownloads == null) {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/episode/ItemFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/episode/ItemFragment.java\nindex e31004a57f..a5ee78a58c 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/episode/ItemFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/episode/ItemFragment.java\n@@ -38,6 +38,7 @@\n import de.danoeh.antennapod.actionbutton.StreamActionButton;\n import de.danoeh.antennapod.actionbutton.VisitWebsiteActionButton;\n import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n+import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.playback.service.PlaybackStatus;\n import de.danoeh.antennapod.event.FeedItemEvent;\n import de.danoeh.antennapod.event.PlayerStatusEvent;\n@@ -49,6 +50,7 @@\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import de.danoeh.antennapod.storage.database.DBReader;\n+import de.danoeh.antennapod.ui.appstartintent.OnlineFeedviewActivityStarter;\n import de.danoeh.antennapod.ui.common.Converter;\n import de.danoeh.antennapod.ui.common.DateFormatter;\n import de.danoeh.antennapod.ui.common.CircularProgressBar;\n@@ -114,6 +116,7 @@ public static ItemFragment newInstance(long feeditem) {\n     private ItemActionButton actionButton1;\n     private ItemActionButton actionButton2;\n     private View noMediaLabel;\n+    private View nonSubscribedWarningLabel;\n \n     private Disposable disposable;\n     private PlaybackController controller;\n@@ -164,6 +167,7 @@ public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container,\n         butAction1Text = layout.findViewById(R.id.butAction1Text);\n         butAction2Text = layout.findViewById(R.id.butAction2Text);\n         noMediaLabel = layout.findViewById(R.id.noMediaLabel);\n+        nonSubscribedWarningLabel = layout.findViewById(R.id.nonSubscribedWarningLabel);\n \n         butAction1.setOnClickListener(v -> {\n             if (actionButton1 instanceof StreamActionButton && !UserPreferences.isStreamOverDownload()\n@@ -287,6 +291,11 @@ private void updateAppearance() {\n             txtvPublished.setContentDescription(DateFormatter.formatForAccessibility(item.getPubDate()));\n         }\n \n+        if (item.getFeed().getState() != Feed.STATE_SUBSCRIBED) {\n+            nonSubscribedWarningLabel.setVisibility(View.VISIBLE);\n+            nonSubscribedWarningLabel.setOnClickListener(v -> openPodcast());\n+        }\n+\n         float radius = 8 * getResources().getDisplayMetrics().density;\n         RequestOptions options = new RequestOptions()\n                 .error(ImagePlaceholder.getDrawable(getContext(), radius))\n@@ -366,8 +375,13 @@ private void openPodcast() {\n         if (item == null) {\n             return;\n         }\n-        Fragment fragment = FeedItemlistFragment.newInstance(item.getFeedId());\n-        ((MainActivity) getActivity()).loadChildFragment(fragment);\n+        if (item.getFeed().getState() == Feed.STATE_SUBSCRIBED) {\n+            Fragment fragment = FeedItemlistFragment.newInstance(item.getFeedId());\n+            ((MainActivity) getActivity()).loadChildFragment(fragment);\n+        } else {\n+            startActivity(new OnlineFeedviewActivityStarter(getContext(), item.getFeed().getDownloadUrl())\n+                    .getIntent());\n+        }\n     }\n \n     @Subscribe(threadMode = ThreadMode.MAIN)\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/episode/ItemPagerFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/episode/ItemPagerFragment.java\nindex e7f3456175..951e5affb5 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/episode/ItemPagerFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/episode/ItemPagerFragment.java\n@@ -1,5 +1,6 @@\n package de.danoeh.antennapod.ui.screen.episode;\n \n+import android.content.Intent;\n import android.os.Bundle;\n import android.view.LayoutInflater;\n import android.view.MenuItem;\n@@ -13,7 +14,8 @@\n import androidx.viewpager2.adapter.FragmentStateAdapter;\n import androidx.viewpager2.widget.ViewPager2;\n \n-import de.danoeh.antennapod.ui.screen.feed.FeedItemlistFragment;\n+import de.danoeh.antennapod.model.feed.Feed;\n+import de.danoeh.antennapod.ui.appstartintent.OnlineFeedviewActivityStarter;\n import org.greenrobot.eventbus.EventBus;\n import org.greenrobot.eventbus.Subscribe;\n import org.greenrobot.eventbus.ThreadMode;\n@@ -173,8 +175,12 @@ private void openPodcast() {\n         if (item == null) {\n             return;\n         }\n-        Fragment fragment = FeedItemlistFragment.newInstance(item.getFeedId());\n-        ((MainActivity) getActivity()).loadChildFragment(fragment);\n+        if (item.getFeed().getState() == Feed.STATE_SUBSCRIBED) {\n+            Intent intent = MainActivity.getIntentToOpenFeed(getContext(), item.getFeedId());\n+            startActivity(intent);\n+        } else {\n+            startActivity(new OnlineFeedviewActivityStarter(getContext(), item.getFeed().getDownloadUrl()).getIntent());\n+        }\n     }\n \n     private class ItemPagerAdapter extends FragmentStateAdapter {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedInfoFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedInfoFragment.java\nindex aabb0852e2..f73b69d752 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedInfoFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedInfoFragment.java\n@@ -122,7 +122,6 @@ protected void doTint(Context themedContext) {\n         viewBinding.header.butFilter.setVisibility(View.INVISIBLE);\n         // https://github.com/bumptech/glide/issues/529\n         viewBinding.imgvBackground.setColorFilter(new LightingColorFilter(0xff828282, 0x000000));\n-\n         viewBinding.urlLabel.setOnClickListener(copyUrlToClipboard);\n \n         long feedId = getArguments().getLong(EXTRA_FEED_ID);\n@@ -237,6 +236,25 @@ private void showFeed() {\n             viewBinding.supportUrl.setText(str.toString());\n         }\n \n+        if (feed.getState() == Feed.STATE_SUBSCRIBED) {\n+            long feedId = getArguments().getLong(EXTRA_FEED_ID);\n+            getParentFragmentManager().beginTransaction().replace(R.id.statisticsFragmentContainer,\n+                            FeedStatisticsFragment.newInstance(feedId, false), \"feed_statistics_fragment\")\n+                    .commitAllowingStateLoss();\n+\n+            viewBinding.statisticsButton.setOnClickListener(view -> {\n+                StatisticsFragment fragment = new StatisticsFragment();\n+                ((MainActivity) getActivity()).loadChildFragment(fragment, TransitionEffect.SLIDE);\n+            });\n+        } else {\n+            viewBinding.statisticsButton.setVisibility(View.GONE);\n+            viewBinding.statisticsFragmentContainer.setVisibility(View.GONE);\n+            viewBinding.statisticsHeadingLabel.setVisibility(View.GONE);\n+            viewBinding.supportHeadingLabel.setVisibility(View.GONE);\n+            viewBinding.supportUrl.setVisibility(View.GONE);\n+            viewBinding.descriptionHeadingLabel.setVisibility(View.GONE);\n+        }\n+\n         refreshToolbarState();\n     }\n \n@@ -249,13 +267,14 @@ public void onDestroy() {\n     }\n \n     private void refreshToolbarState() {\n+        boolean isSubscribed = feed != null && feed.getState() == Feed.STATE_SUBSCRIBED;\n         viewBinding.toolbar.getMenu().findItem(R.id.reconnect_local_folder).setVisible(\n-                feed != null && feed.isLocalFeed());\n-        viewBinding.toolbar.getMenu().findItem(R.id.share_item).setVisible(feed != null && !feed.isLocalFeed());\n-        viewBinding.toolbar.getMenu().findItem(R.id.visit_website_item).setVisible(feed != null\n+                isSubscribed && feed.isLocalFeed());\n+        viewBinding.toolbar.getMenu().findItem(R.id.share_item).setVisible(isSubscribed && !feed.isLocalFeed());\n+        viewBinding.toolbar.getMenu().findItem(R.id.visit_website_item).setVisible(isSubscribed\n                 && feed.getLink() != null\n                 && IntentUtils.isCallable(getContext(), new Intent(Intent.ACTION_VIEW, Uri.parse(feed.getLink()))));\n-        viewBinding.toolbar.getMenu().findItem(R.id.edit_feed_url_item).setVisible(feed != null && !feed.isLocalFeed());\n+        viewBinding.toolbar.getMenu().findItem(R.id.edit_feed_url_item).setVisible(isSubscribed && !feed.isLocalFeed());\n     }\n \n     @Override\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\nindex 9bc45a235f..2167887d51 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\n@@ -12,52 +12,23 @@\n import android.view.View;\n import android.view.ViewGroup;\n import android.widget.AdapterView;\n-import android.widget.Toast;\n-\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n import androidx.appcompat.content.res.AppCompatResources;\n import androidx.core.util.Pair;\n import androidx.fragment.app.Fragment;\n+import androidx.fragment.app.FragmentActivity;\n import androidx.recyclerview.widget.RecyclerView;\n-\n import com.bumptech.glide.Glide;\n import com.bumptech.glide.request.RequestOptions;\n import com.google.android.material.appbar.MaterialToolbar;\n import com.google.android.material.snackbar.Snackbar;\n-\n-import de.danoeh.antennapod.ui.CoverLoader;\n-import de.danoeh.antennapod.ui.screen.episode.ItemPagerFragment;\n-import de.danoeh.antennapod.ui.screen.SearchFragment;\n-import de.danoeh.antennapod.ui.TransitionEffect;\n-import de.danoeh.antennapod.net.download.serviceinterface.FeedUpdateManager;\n-import de.danoeh.antennapod.ui.screen.download.DownloadLogFragment;\n-import de.danoeh.antennapod.ui.screen.feed.preferences.FeedSettingsFragment;\n-import org.apache.commons.lang3.StringUtils;\n-import org.apache.commons.lang3.Validate;\n-import org.greenrobot.eventbus.EventBus;\n-import org.greenrobot.eventbus.Subscribe;\n-import org.greenrobot.eventbus.ThreadMode;\n-\n-import java.util.Collections;\n-import java.util.List;\n-import java.util.concurrent.ExecutionException;\n-\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n-import de.danoeh.antennapod.ui.episodeslist.EpisodeItemListAdapter;\n-import de.danoeh.antennapod.event.FeedEvent;\n-import de.danoeh.antennapod.ui.MenuItemUtils;\n-import de.danoeh.antennapod.storage.database.DBReader;\n-import de.danoeh.antennapod.storage.database.DBWriter;\n-import de.danoeh.antennapod.ui.common.IntentUtils;\n-import de.danoeh.antennapod.ui.share.ShareUtils;\n-import de.danoeh.antennapod.ui.episodeslist.MoreContentListFooterUtil;\n import de.danoeh.antennapod.databinding.FeedItemListFragmentBinding;\n-import de.danoeh.antennapod.ui.screen.download.DownloadLogDetailsDialog;\n-import de.danoeh.antennapod.ui.FeedItemFilterDialog;\n import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FavoritesEvent;\n+import de.danoeh.antennapod.event.FeedEvent;\n import de.danoeh.antennapod.event.FeedItemEvent;\n import de.danoeh.antennapod.event.FeedListUpdateEvent;\n import de.danoeh.antennapod.event.FeedUpdateRunningEvent;\n@@ -65,21 +36,48 @@\n import de.danoeh.antennapod.event.QueueEvent;\n import de.danoeh.antennapod.event.UnreadItemsUpdateEvent;\n import de.danoeh.antennapod.event.playback.PlaybackPositionEvent;\n-import de.danoeh.antennapod.ui.episodeslist.EpisodeMultiSelectActionHandler;\n-import de.danoeh.antennapod.ui.swipeactions.SwipeActions;\n-import de.danoeh.antennapod.ui.episodeslist.FeedItemMenuHandler;\n import de.danoeh.antennapod.model.download.DownloadResult;\n import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n+import de.danoeh.antennapod.net.download.serviceinterface.FeedUpdateManager;\n+import de.danoeh.antennapod.storage.database.DBReader;\n+import de.danoeh.antennapod.storage.database.DBWriter;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n-import de.danoeh.antennapod.ui.glide.FastBlurTransformation;\n+import de.danoeh.antennapod.ui.CoverLoader;\n+import de.danoeh.antennapod.ui.FeedItemFilterDialog;\n+import de.danoeh.antennapod.ui.MenuItemUtils;\n+import de.danoeh.antennapod.ui.TransitionEffect;\n+import de.danoeh.antennapod.ui.appstartintent.MainActivityStarter;\n+import de.danoeh.antennapod.ui.cleaner.HtmlToPlainText;\n+import de.danoeh.antennapod.ui.common.IntentUtils;\n+import de.danoeh.antennapod.ui.episodeslist.EpisodeItemListAdapter;\n import de.danoeh.antennapod.ui.episodeslist.EpisodeItemViewHolder;\n+import de.danoeh.antennapod.ui.episodeslist.EpisodeMultiSelectActionHandler;\n+import de.danoeh.antennapod.ui.episodeslist.FeedItemMenuHandler;\n+import de.danoeh.antennapod.ui.episodeslist.MoreContentListFooterUtil;\n+import de.danoeh.antennapod.ui.glide.FastBlurTransformation;\n+import de.danoeh.antennapod.ui.screen.SearchFragment;\n+import de.danoeh.antennapod.ui.screen.download.DownloadLogDetailsDialog;\n+import de.danoeh.antennapod.ui.screen.download.DownloadLogFragment;\n+import de.danoeh.antennapod.ui.screen.episode.ItemPagerFragment;\n+import de.danoeh.antennapod.ui.screen.feed.preferences.FeedSettingsFragment;\n+import de.danoeh.antennapod.ui.share.ShareUtils;\n+import de.danoeh.antennapod.ui.swipeactions.SwipeActions;\n import io.reactivex.Maybe;\n import io.reactivex.Observable;\n import io.reactivex.android.schedulers.AndroidSchedulers;\n import io.reactivex.disposables.Disposable;\n import io.reactivex.schedulers.Schedulers;\n+import org.apache.commons.lang3.StringUtils;\n+import org.apache.commons.lang3.Validate;\n+import org.greenrobot.eventbus.EventBus;\n+import org.greenrobot.eventbus.Subscribe;\n+import org.greenrobot.eventbus.ThreadMode;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.concurrent.ExecutionException;\n \n /**\n  * Displays a list of FeedItems.\n@@ -100,7 +98,6 @@ public class FeedItemlistFragment extends Fragment implements AdapterView.OnItem\n     private boolean displayUpArrow;\n     private long feedID;\n     private Feed feed;\n-    private boolean headerCreated = false;\n     private Disposable disposable;\n     private FeedItemListFragmentBinding viewBinding;\n \n@@ -145,12 +142,18 @@ public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup c\n         if (savedInstanceState != null) {\n             displayUpArrow = savedInstanceState.getBoolean(KEY_UP_ARROW);\n         }\n-        ((MainActivity) getActivity()).setupToolbarToggle(viewBinding.toolbar, displayUpArrow);\n+        if (getActivity() instanceof MainActivity) {\n+            ((MainActivity) getActivity()).setupToolbarToggle(viewBinding.toolbar, displayUpArrow);\n+            viewBinding.recyclerView.setRecycledViewPool(((MainActivity) getActivity()).getRecycledViewPool());\n+        } else {\n+            viewBinding.toolbar.setNavigationIcon(R.drawable.ic_close);\n+            viewBinding.toolbar.setNavigationOnClickListener(view -> getActivity().finish());\n+        }\n         updateToolbar();\n         setupLoadMoreScrollListener();\n+        setupHeaderView();\n \n-        viewBinding.recyclerView.setRecycledViewPool(((MainActivity) getActivity()).getRecycledViewPool());\n-        adapter = new FeedItemListAdapter((MainActivity) getActivity());\n+        adapter = new FeedItemListAdapter(getActivity());\n         adapter.setOnSelectModeListener(this);\n         viewBinding.recyclerView.setAdapter(adapter);\n         swipeActions = new SwipeActions(this, TAG).attachTo(viewBinding.recyclerView);\n@@ -198,7 +201,7 @@ public void onScrolled(@NonNull RecyclerView view, int deltaX, int deltaY) {\n                         Snackbar.LENGTH_SHORT);\n                 return false;\n             }\n-            new EpisodeMultiSelectActionHandler(((MainActivity) getActivity()), menuItem.getItemId())\n+            new EpisodeMultiSelectActionHandler(getActivity(), menuItem.getItemId())\n                     .handleAction(adapter.getSelectedItems());\n             adapter.endSelectMode();\n             return true;\n@@ -249,6 +252,13 @@ private void updateToolbar() {\n         if (feed.isLocalFeed()) {\n             viewBinding.toolbar.getMenu().findItem(R.id.share_item).setVisible(false);\n         }\n+        if (feed.getState() == Feed.STATE_NOT_SUBSCRIBED) {\n+            viewBinding.toolbar.getMenu().findItem(R.id.sort_items).setVisible(false);\n+            viewBinding.toolbar.getMenu().findItem(R.id.refresh_item).setVisible(false);\n+            viewBinding.toolbar.getMenu().findItem(R.id.rename_item).setVisible(false);\n+            viewBinding.toolbar.getMenu().findItem(R.id.remove_feed).setVisible(false);\n+            viewBinding.toolbar.getMenu().findItem(R.id.action_search).setVisible(false);\n+        }\n     }\n \n     @Override\n@@ -263,8 +273,7 @@ public void onConfigurationChanged(@NonNull Configuration newConfig) {\n     @Override\n     public boolean onMenuItemClick(MenuItem item) {\n         if (feed == null) {\n-            ((MainActivity) getActivity()).showSnackbarAbovePlayer(\n-                    R.string.please_wait_for_data, Toast.LENGTH_LONG);\n+            EventBus.getDefault().post(getString(R.string.please_wait_for_data));\n             return true;\n         }\n         if (item.getItemId() == R.id.visit_website_item) {\n@@ -443,7 +452,6 @@ public void onEventMainThread(FeedUpdateRunningEvent event) {\n     }\n \n     private void refreshHeaderView() {\n-        setupHeaderView();\n         if (viewBinding == null || feed == null) {\n             Log.e(TAG, \"Unable to refresh header view\");\n             return;\n@@ -454,7 +462,7 @@ private void refreshHeaderView() {\n         } else {\n             viewBinding.header.txtvFailure.setVisibility(View.GONE);\n         }\n-        if (!feed.getPreferences().getKeepUpdated()) {\n+        if (!feed.getPreferences().getKeepUpdated() && feed.getState() == Feed.STATE_SUBSCRIBED) {\n             viewBinding.header.txtvUpdatesDisabled.setText(R.string.updates_disabled_label);\n             viewBinding.header.txtvUpdatesDisabled.setVisibility(View.VISIBLE);\n         } else {\n@@ -462,7 +470,11 @@ private void refreshHeaderView() {\n         }\n         viewBinding.header.txtvTitle.setText(feed.getTitle());\n         viewBinding.header.txtvAuthor.setText(feed.getAuthor());\n-        if (feed.getItemFilter() != null) {\n+        viewBinding.header.descriptionContainer.setVisibility(View.GONE);\n+        if (feed.getState() != Feed.STATE_SUBSCRIBED) {\n+            viewBinding.header.descriptionContainer.setVisibility(View.VISIBLE);\n+            viewBinding.header.headerDescriptionLabel.setText(HtmlToPlainText.getPlainText(feed.getDescription()));\n+        } else if (feed.getItemFilter() != null) {\n             FeedItemFilter filter = feed.getItemFilter();\n             if (filter.getValues().length > 0) {\n                 viewBinding.header.txtvInformation.setText(R.string.filtered_label);\n@@ -475,17 +487,30 @@ private void refreshHeaderView() {\n         } else {\n             viewBinding.header.txtvInformation.setVisibility(View.GONE);\n         }\n-    }\n+        boolean isSubscribed = feed.getState() == Feed.STATE_SUBSCRIBED;\n+        viewBinding.header.butShowInfo.setVisibility(isSubscribed ? View.VISIBLE : View.GONE);\n+        viewBinding.header.butFilter.setVisibility(isSubscribed ? View.VISIBLE : View.GONE);\n+        viewBinding.header.butShowSettings.setVisibility(isSubscribed ? View.VISIBLE : View.GONE);\n+        viewBinding.header.butSubscribe.setVisibility(isSubscribed ? View.GONE : View.VISIBLE);\n \n-    private void setupHeaderView() {\n-        if (feed == null || headerCreated) {\n-            return;\n+        if (!isSubscribed && feed.getLastRefreshAttempt() < System.currentTimeMillis() - 1000L * 3600 * 24) {\n+            FeedUpdateManager.getInstance().runOnce(getContext(), feed, true);\n         }\n+    }\n \n+    private void setupHeaderView() {\n         // https://github.com/bumptech/glide/issues/529\n         viewBinding.imgvBackground.setColorFilter(new LightingColorFilter(0xff666666, 0x000000));\n         viewBinding.header.butShowInfo.setOnClickListener(v -> showFeedInfo());\n         viewBinding.header.imgvCover.setOnClickListener(v -> showFeedInfo());\n+        viewBinding.header.headerDescriptionLabel.setOnClickListener(v -> showFeedInfo());\n+        viewBinding.header.butSubscribe.setOnClickListener(view -> {\n+            DBWriter.setFeedState(getContext(), feed, Feed.STATE_SUBSCRIBED);\n+            MainActivityStarter mainActivityStarter = new MainActivityStarter(getContext());\n+            mainActivityStarter.withOpenFeed(feed.getId());\n+            getActivity().finish();\n+            startActivity(mainActivityStarter.getIntent());\n+        });\n         viewBinding.header.butShowSettings.setOnClickListener(v -> {\n             if (feed != null) {\n                 FeedSettingsFragment fragment = FeedSettingsFragment.newInstance(feed);\n@@ -495,7 +520,6 @@ private void setupHeaderView() {\n         viewBinding.header.butFilter.setOnClickListener(v ->\n                 FeedItemFilterDialog.newInstance(feed).show(getChildFragmentManager(), null));\n         viewBinding.header.txtvFailure.setOnClickListener(v -> showErrorDetails());\n-        headerCreated = true;\n     }\n \n     private void showErrorDetails() {\n@@ -516,9 +540,18 @@ private void showErrorDetails() {\n     }\n \n     private void showFeedInfo() {\n-        if (feed != null) {\n-            FeedInfoFragment fragment = FeedInfoFragment.newInstance(feed);\n+        if (feed == null) {\n+            return;\n+        }\n+        FeedInfoFragment fragment = FeedInfoFragment.newInstance(feed);\n+        if (getActivity() instanceof MainActivity) {\n             ((MainActivity) getActivity()).loadChildFragment(fragment, TransitionEffect.SLIDE);\n+        } else {\n+            getActivity().getSupportFragmentManager()\n+                    .beginTransaction()\n+                    .replace(R.id.fragmentContainer, fragment, \"Info\")\n+                    .addToBackStack(\"Info\")\n+                    .commitAllowingStateLoss();\n         }\n     }\n \n@@ -625,7 +658,7 @@ public void onKeyUp(KeyEvent event) {\n     }\n \n     private class FeedItemListAdapter extends EpisodeItemListAdapter {\n-        public FeedItemListAdapter(MainActivity mainActivity) {\n+        public FeedItemListAdapter(FragmentActivity mainActivity) {\n             super(mainActivity);\n         }\n \n@@ -648,7 +681,7 @@ protected void afterBindViewHolder(EpisodeItemViewHolder holder, int pos) {\n         @Override\n         public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMenuInfo menuInfo) {\n             super.onCreateContextMenu(menu, v, menuInfo);\n-            if (!inActionMode()) {\n+            if (!inActionMode() && feed.getState() == Feed.STATE_SUBSCRIBED) {\n                 menu.findItem(R.id.multi_select).setVisible(true);\n             }\n             MenuItemUtils.setOnClickListeners(menu, FeedItemlistFragment.this::onContextItemSelected);\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/DownloadsSection.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/DownloadsSection.java\nindex cc3288e2f2..06de7803a1 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/DownloadsSection.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/DownloadsSection.java\n@@ -39,6 +39,8 @@\n public class DownloadsSection extends HomeSection {\n     public static final String TAG = \"DownloadsSection\";\n     private static final int NUM_EPISODES = 2;\n+    private static final FeedItemFilter FILTER_DOWNLOADED = new FeedItemFilter(\n+            FeedItemFilter.DOWNLOADED, FeedItemFilter.INCLUDE_NOT_SUBSCRIBED);\n     private EpisodeItemListAdapter adapter;\n     private List<FeedItem> items;\n     private Disposable disposable;\n@@ -52,7 +54,7 @@ public View onCreateView(@NonNull LayoutInflater inflater,\n         viewBinding.recyclerView.setOverScrollMode(RecyclerView.OVER_SCROLL_NEVER);\n         viewBinding.recyclerView.setLayoutManager(new LinearLayoutManager(getContext(), RecyclerView.VERTICAL, false));\n         viewBinding.recyclerView.setRecycledViewPool(((MainActivity) requireActivity()).getRecycledViewPool());\n-        adapter = new EpisodeItemListAdapter((MainActivity) requireActivity()) {\n+        adapter = new EpisodeItemListAdapter(requireActivity()) {\n             @Override\n             public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMenuInfo menuInfo) {\n                 super.onCreateContextMenu(menu, v, menuInfo);\n@@ -124,8 +126,7 @@ private void loadItems() {\n             disposable.dispose();\n         }\n         SortOrder sortOrder = UserPreferences.getDownloadsSortedOrder();\n-        disposable = Observable.fromCallable(() -> DBReader.getEpisodes(0, NUM_EPISODES,\n-                        new FeedItemFilter(FeedItemFilter.DOWNLOADED), sortOrder))\n+        disposable = Observable.fromCallable(() -> DBReader.getEpisodes(0, NUM_EPISODES, FILTER_DOWNLOADED, sortOrder))\n                 .subscribeOn(Schedulers.io())\n                 .observeOn(AndroidSchedulers.mainThread())\n                 .subscribe(downloads -> {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/onlinefeedview/FeedItemlistDescriptionAdapter.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/onlinefeedview/FeedItemlistDescriptionAdapter.java\ndeleted file mode 100644\nindex f46d786cfe..0000000000\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/onlinefeedview/FeedItemlistDescriptionAdapter.java\n+++ /dev/null\n@@ -1,112 +0,0 @@\n-package de.danoeh.antennapod.ui.screen.onlinefeedview;\n-\n-import android.content.Context;\n-import android.view.LayoutInflater;\n-import android.view.View;\n-import android.view.ViewGroup;\n-import android.widget.ArrayAdapter;\n-import android.widget.Button;\n-import android.widget.TextView;\n-\n-import androidx.annotation.NonNull;\n-import androidx.annotation.Nullable;\n-\n-import de.danoeh.antennapod.R;\n-import de.danoeh.antennapod.model.playback.MediaType;\n-import de.danoeh.antennapod.net.common.NetworkUtils;\n-import de.danoeh.antennapod.model.playback.RemoteMedia;\n-import de.danoeh.antennapod.model.feed.FeedItem;\n-import de.danoeh.antennapod.playback.service.PlaybackService;\n-import de.danoeh.antennapod.playback.service.PlaybackServiceStarter;\n-import de.danoeh.antennapod.ui.common.DateFormatter;\n-import de.danoeh.antennapod.model.playback.Playable;\n-import de.danoeh.antennapod.ui.cleaner.HtmlToPlainText;\n-import de.danoeh.antennapod.ui.StreamingConfirmationDialog;\n-\n-import java.util.List;\n-\n-/**\n- * List adapter for showing a list of FeedItems with their title and description.\n- */\n-public class FeedItemlistDescriptionAdapter extends ArrayAdapter<FeedItem> {\n-    private static final int MAX_LINES_COLLAPSED = 2;\n-\n-    public FeedItemlistDescriptionAdapter(Context context, int resource, List<FeedItem> objects) {\n-        super(context, resource, objects);\n-    }\n-\n-    @NonNull\n-    @Override\n-    public View getView(int position, @Nullable View convertView, @NonNull ViewGroup parent) {\n-        Holder holder;\n-\n-        FeedItem item = getItem(position);\n-\n-        // Inflate layout\n-        if (convertView == null) {\n-            holder = new Holder();\n-            LayoutInflater inflater = (LayoutInflater) getContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE);\n-            convertView = inflater.inflate(R.layout.itemdescription_listitem, parent, false);\n-            holder.title = convertView.findViewById(R.id.txtvTitle);\n-            holder.pubDate = convertView.findViewById(R.id.txtvPubDate);\n-            holder.description = convertView.findViewById(R.id.txtvDescription);\n-            holder.preview = convertView.findViewById(R.id.butPreview);\n-\n-            convertView.setTag(holder);\n-        } else {\n-            holder = (Holder) convertView.getTag();\n-        }\n-\n-        holder.title.setText(item.getTitle());\n-        holder.pubDate.setText(DateFormatter.formatAbbrev(getContext(), item.getPubDate()));\n-        if (item.getDescription() != null) {\n-            String description = HtmlToPlainText.getPlainText(item.getDescription())\n-                    .replaceAll(\"\\n\", \" \")\n-                    .replaceAll(\"\\\\s+\", \" \")\n-                    .trim();\n-            holder.description.setText(description);\n-            holder.description.setMaxLines(MAX_LINES_COLLAPSED);\n-        }\n-        holder.description.setTag(Boolean.FALSE); // not expanded\n-        holder.preview.setVisibility(View.GONE);\n-        holder.preview.setOnClickListener(v -> {\n-            if (item.getMedia() == null) {\n-                return;\n-            }\n-            Playable playable = new RemoteMedia(item);\n-            if (!NetworkUtils.isStreamingAllowed()) {\n-                new StreamingConfirmationDialog(getContext(), playable).show();\n-                return;\n-            }\n-\n-            new PlaybackServiceStarter(getContext(), playable)\n-                    .callEvenIfRunning(true)\n-                    .start();\n-\n-            if (playable.getMediaType() == MediaType.VIDEO) {\n-                getContext().startActivity(PlaybackService.getPlayerActivityIntent(getContext(), playable));\n-            }\n-        });\n-        convertView.setOnClickListener(v -> {\n-            if (holder.description.getTag() == Boolean.TRUE) {\n-                holder.description.setMaxLines(MAX_LINES_COLLAPSED);\n-                holder.preview.setVisibility(View.GONE);\n-                holder.description.setTag(Boolean.FALSE);\n-            } else {\n-                holder.description.setMaxLines(30);\n-                holder.description.setTag(Boolean.TRUE);\n-\n-                holder.preview.setVisibility(item.getMedia() != null ? View.VISIBLE : View.GONE);\n-                holder.preview.setText(R.string.preview_episode);\n-            }\n-        });\n-        return convertView;\n-    }\n-\n-    static class Holder {\n-        TextView title;\n-        TextView pubDate;\n-        TextView description;\n-        Button preview;\n-    }\n-}\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/onlinefeedview/OnlineFeedViewActivity.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/onlinefeedview/OnlineFeedViewActivity.java\nindex 7b8558c3d0..be601027c0 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/onlinefeedview/OnlineFeedViewActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/onlinefeedview/OnlineFeedViewActivity.java\n@@ -4,8 +4,6 @@\n import android.content.Context;\n import android.content.DialogInterface;\n import android.content.Intent;\n-import android.content.SharedPreferences;\n-import android.graphics.LightingColorFilter;\n import android.os.Bundle;\n import android.text.Spannable;\n import android.text.SpannableString;\n@@ -13,68 +11,45 @@\n import android.text.style.ForegroundColorSpan;\n import android.util.Log;\n import android.view.View;\n-import android.view.ViewGroup;\n-import android.widget.AdapterView;\n import android.widget.ArrayAdapter;\n import android.widget.Toast;\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n import androidx.annotation.UiThread;\n-import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import androidx.appcompat.app.AppCompatActivity;\n-import com.bumptech.glide.Glide;\n-import com.bumptech.glide.request.RequestOptions;\n-import com.google.android.material.snackbar.Snackbar;\n-\n+import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import de.danoeh.antennapod.R;\n-import de.danoeh.antennapod.net.download.service.feed.remote.Downloader;\n-import de.danoeh.antennapod.net.download.service.feed.remote.HttpDownloader;\n-import de.danoeh.antennapod.ui.appstartintent.MainActivityStarter;\n-import de.danoeh.antennapod.ui.common.ThemeSwitcher;\n-import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequestCreator;\n-import de.danoeh.antennapod.net.discovery.FeedUrlNotFoundException;\n-import de.danoeh.antennapod.storage.database.FeedDatabaseWriter;\n-import de.danoeh.antennapod.playback.service.PlaybackServiceInterface;\n-import de.danoeh.antennapod.ui.screen.download.DownloadErrorLabel;\n import de.danoeh.antennapod.databinding.EditTextDialogBinding;\n-import de.danoeh.antennapod.databinding.OnlinefeedviewHeaderBinding;\n-import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n-import de.danoeh.antennapod.event.FeedListUpdateEvent;\n-import de.danoeh.antennapod.event.PlayerStatusEvent;\n-import de.danoeh.antennapod.storage.preferences.PlaybackPreferences;\n-import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n-import de.danoeh.antennapod.storage.preferences.UserPreferences;\n+import de.danoeh.antennapod.databinding.OnlinefeedviewActivityBinding;\n+import de.danoeh.antennapod.model.download.DownloadError;\n import de.danoeh.antennapod.model.download.DownloadRequest;\n import de.danoeh.antennapod.model.download.DownloadResult;\n-import de.danoeh.antennapod.storage.database.DBReader;\n-import de.danoeh.antennapod.storage.database.DBWriter;\n+import de.danoeh.antennapod.model.feed.Feed;\n+import de.danoeh.antennapod.net.common.UrlChecker;\n import de.danoeh.antennapod.net.discovery.CombinedSearcher;\n+import de.danoeh.antennapod.net.discovery.FeedUrlNotFoundException;\n import de.danoeh.antennapod.net.discovery.PodcastSearchResult;\n import de.danoeh.antennapod.net.discovery.PodcastSearcherRegistry;\n+import de.danoeh.antennapod.net.download.service.feed.remote.Downloader;\n+import de.danoeh.antennapod.net.download.service.feed.remote.HttpDownloader;\n+import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequestCreator;\n import de.danoeh.antennapod.parser.feed.FeedHandler;\n import de.danoeh.antennapod.parser.feed.FeedHandlerResult;\n-import de.danoeh.antennapod.model.download.DownloadError;\n-import de.danoeh.antennapod.ui.common.IntentUtils;\n-import de.danoeh.antennapod.net.common.UrlChecker;\n-import de.danoeh.antennapod.ui.cleaner.HtmlToPlainText;\n-import de.danoeh.antennapod.databinding.OnlinefeedviewActivityBinding;\n-import de.danoeh.antennapod.model.feed.Feed;\n-import de.danoeh.antennapod.model.feed.FeedPreferences;\n-import de.danoeh.antennapod.model.playback.RemoteMedia;\n import de.danoeh.antennapod.parser.feed.UnsupportedFeedtypeException;\n+import de.danoeh.antennapod.storage.database.DBReader;\n+import de.danoeh.antennapod.storage.database.DBWriter;\n+import de.danoeh.antennapod.storage.database.FeedDatabaseWriter;\n+import de.danoeh.antennapod.ui.appstartintent.MainActivityStarter;\n+import de.danoeh.antennapod.ui.common.ThemeSwitcher;\n import de.danoeh.antennapod.ui.common.ThemeUtils;\n-import de.danoeh.antennapod.ui.glide.FastBlurTransformation;\n import de.danoeh.antennapod.ui.preferences.screen.synchronization.AuthenticationDialog;\n+import de.danoeh.antennapod.ui.screen.download.DownloadErrorLabel;\n+import de.danoeh.antennapod.ui.screen.feed.FeedItemlistFragment;\n import io.reactivex.Maybe;\n import io.reactivex.Observable;\n import io.reactivex.android.schedulers.AndroidSchedulers;\n import io.reactivex.disposables.Disposable;\n-import io.reactivex.observers.DisposableMaybeObserver;\n import io.reactivex.schedulers.Schedulers;\n-import org.apache.commons.lang3.StringUtils;\n-import org.greenrobot.eventbus.EventBus;\n-import org.greenrobot.eventbus.Subscribe;\n-import org.greenrobot.eventbus.ThreadMode;\n \n import java.io.File;\n import java.io.IOException;\n@@ -95,30 +70,16 @@\n  * and the activity will finish as soon as the error dialog is closed.\n  */\n public class OnlineFeedViewActivity extends AppCompatActivity {\n-\n-    private static final int RESULT_ERROR = 2;\n     private static final String TAG = \"OnlineFeedViewActivity\";\n-    private static final String PREFS = \"OnlineFeedViewActivityPreferences\";\n-    private static final String PREF_LAST_AUTO_DOWNLOAD = \"lastAutoDownload\";\n-    private static final int DESCRIPTION_MAX_LINES_COLLAPSED = 4;\n-\n-    private volatile List<Feed> feeds;\n     private String selectedDownloadUrl;\n     private Downloader downloader;\n     private String username = null;\n     private String password = null;\n-\n     private boolean isPaused;\n-    private boolean didPressSubscribe = false;\n     private boolean isFeedFoundBySearch = false;\n-\n     private Dialog dialog;\n-\n     private Disposable download;\n     private Disposable parser;\n-    private Disposable updater;\n-\n-    private OnlinefeedviewHeaderBinding headerBinding;\n     private OnlinefeedviewActivityBinding viewBinding;\n \n     @Override\n@@ -128,12 +89,9 @@ protected void onCreate(Bundle savedInstanceState) {\n \n         viewBinding = OnlinefeedviewActivityBinding.inflate(getLayoutInflater());\n         setContentView(viewBinding.getRoot());\n-\n         viewBinding.transparentBackground.setOnClickListener(v -> finish());\n-        viewBinding.closeButton.setOnClickListener(view -> finish());\n         viewBinding.card.setOnClickListener(null);\n         viewBinding.card.setCardBackgroundColor(ThemeUtils.getColorFromAttr(this, R.attr.colorSurface));\n-        headerBinding = OnlinefeedviewHeaderBinding.inflate(getLayoutInflater());\n \n         String feedUrl = null;\n         if (getIntent().hasExtra(ARG_FEEDURL)) {\n@@ -149,7 +107,6 @@ protected void onCreate(Bundle savedInstanceState) {\n             showNoPodcastFoundError();\n         } else {\n             Log.d(TAG, \"Activity was started with url \" + feedUrl);\n-            setLoadingLayout();\n             // Remove subscribeonandroid.com from feed URL in order to subscribe to the actual feed URL\n             if (feedUrl.contains(\"subscribeonandroid.com\")) {\n                 feedUrl = feedUrl.replaceFirst(\"((www.)?(subscribeonandroid.com/))\", \"\");\n@@ -167,33 +124,20 @@ private void showNoPodcastFoundError() {\n                 .setNeutralButton(android.R.string.ok, (dialog, which) -> finish())\n                 .setTitle(R.string.error_label)\n                 .setMessage(R.string.null_value_podcast_error)\n-                .setOnDismissListener(dialog1 -> {\n-                    setResult(RESULT_ERROR);\n-                    finish();\n-                })\n+                .setOnDismissListener(dialog1 -> finish())\n                 .show());\n     }\n \n-    /**\n-     * Displays a progress indicator.\n-     */\n-    private void setLoadingLayout() {\n-        viewBinding.progressBar.setVisibility(View.VISIBLE);\n-        viewBinding.feedDisplayContainer.setVisibility(View.GONE);\n-    }\n-\n     @Override\n     protected void onStart() {\n         super.onStart();\n         isPaused = false;\n-        EventBus.getDefault().register(this);\n     }\n \n     @Override\n     protected void onStop() {\n         super.onStop();\n         isPaused = true;\n-        EventBus.getDefault().unregister(this);\n         if (downloader != null && !downloader.isFinished()) {\n             downloader.cancel();\n         }\n@@ -205,9 +149,6 @@ protected void onStop() {\n     @Override\n     public void onDestroy() {\n         super.onDestroy();\n-        if(updater != null) {\n-            updater.dispose();\n-        }\n         if(download != null) {\n             download.dispose();\n         }\n@@ -239,7 +180,7 @@ private void lookupUrlAndDownload(String url) {\n         download = PodcastSearcherRegistry.lookupUrl(url)\n                 .subscribeOn(Schedulers.io())\n                 .observeOn(Schedulers.io())\n-                .subscribe(this::startFeedDownload,\n+                .subscribe(this::downloadIfNotAlreadySubscribed,\n                         error -> {\n                             if (error instanceof FeedUrlNotFoundException) {\n                                 tryToRetrieveFeedUrlBySearch((FeedUrlNotFoundException) error);\n@@ -256,7 +197,7 @@ private void tryToRetrieveFeedUrlBySearch(FeedUrlNotFoundException error) {\n         if (url != null) {\n             Log.d(TAG, \"Successfully retrieve feed url\");\n             isFeedFoundBySearch = true;\n-            startFeedDownload(url);\n+            downloadIfNotAlreadySubscribed(url);\n         } else {\n             showNoPodcastFoundError();\n             Log.d(TAG, \"Failed to retrieve feed url\");\n@@ -277,6 +218,28 @@ private String searchFeedUrlByTrackName(String trackName, String artistName) {\n         return null;\n     }\n \n+    private Feed downloadIfNotAlreadySubscribed(String url) {\n+        download = Maybe.fromCallable(() -> {\n+            List<Feed> feeds = DBReader.getFeedList();\n+            for (Feed f : feeds) {\n+                if (f.getDownloadUrl().equals(url)) {\n+                    return f;\n+                }\n+            }\n+            return null;\n+        })\n+        .subscribeOn(Schedulers.io())\n+        .observeOn(AndroidSchedulers.mainThread())\n+        .subscribe(subscribedFeed -> {\n+            if (subscribedFeed.getState() == Feed.STATE_SUBSCRIBED) {\n+                openFeed(subscribedFeed.getId());\n+            } else {\n+                showFeedFragment(subscribedFeed.getId());\n+            }\n+        }, error -> Log.e(TAG, Log.getStackTraceString(error)), () -> startFeedDownload(url));\n+        return null;\n+    }\n+\n     private void startFeedDownload(String url) {\n         Log.d(TAG, \"Starting feed download\");\n         selectedDownloadUrl = UrlChecker.prepareUrl(url);\n@@ -286,7 +249,6 @@ private void startFeedDownload(String url) {\n                 .build();\n \n         download = Observable.fromCallable(() -> {\n-            feeds = DBReader.getFeedList();\n             downloader = new HttpDownloader(request);\n             downloader.call();\n             return downloader.getResult();\n@@ -315,46 +277,25 @@ private void checkDownloadResult(@NonNull DownloadResult status, String destinat\n         }\n     }\n \n-    @Subscribe\n-    public void onFeedListChanged(FeedListUpdateEvent event) {\n-        updater = Observable.fromCallable(DBReader::getFeedList)\n-                .subscribeOn(Schedulers.io())\n-                .observeOn(AndroidSchedulers.mainThread())\n-                .subscribe(\n-                        feeds -> {\n-                            OnlineFeedViewActivity.this.feeds = feeds;\n-                            handleUpdatedFeedStatus();\n-                        }, error -> Log.e(TAG, Log.getStackTraceString(error))\n-                );\n-    }\n-\n-    @Subscribe(sticky = true, threadMode = ThreadMode.MAIN)\n-    public void onEventMainThread(EpisodeDownloadEvent event) {\n-        handleUpdatedFeedStatus();\n-    }\n-\n     private void parseFeed(String destination) {\n         Log.d(TAG, \"Parsing feed\");\n-        parser = Maybe.fromCallable(() -> doParseFeed(destination))\n-                .subscribeOn(Schedulers.computation())\n-                .observeOn(AndroidSchedulers.mainThread())\n-                .subscribeWith(new DisposableMaybeObserver<FeedHandlerResult>() {\n-                    @Override\n-                    public void onSuccess(@NonNull FeedHandlerResult result) {\n-                        showFeedInformation(result.feed, result.alternateFeedUrls);\n-                    }\n-\n-                    @Override\n-                    public void onComplete() {\n-                        // Ignore null result: We showed the discovery dialog.\n-                    }\n-\n-                    @Override\n-                    public void onError(@NonNull Throwable error) {\n-                        showErrorDialog(error.getMessage(), \"\");\n-                        Log.d(TAG, \"Feed parser exception: \" + Log.getStackTraceString(error));\n-                    }\n-                });\n+        parser = Observable.fromCallable(() -> {\n+            FeedHandlerResult handlerResult = doParseFeed(destination);\n+            Feed feed = handlerResult.feed;\n+            feed.setState(Feed.STATE_NOT_SUBSCRIBED);\n+            feed.setLastRefreshAttempt(System.currentTimeMillis());\n+            FeedDatabaseWriter.updateFeed(this, feed, false);\n+            Feed feedFromDb = DBReader.getFeed(feed.getId(), false, 0, Integer.MAX_VALUE);\n+            feedFromDb.getPreferences().setKeepUpdated(false);\n+            DBWriter.setFeedPreferences(feedFromDb.getPreferences());\n+            return feed.getId();\n+        })\n+        .subscribeOn(Schedulers.computation())\n+        .observeOn(AndroidSchedulers.mainThread())\n+        .subscribe(this::showFeedFragment, error -> {\n+            error.printStackTrace();\n+            showErrorDialog(error.getMessage(), \"\");\n+        });\n     }\n \n     /**\n@@ -392,123 +333,23 @@ private FeedHandlerResult doParseFeed(String destination) throws Exception {\n         }\n     }\n \n-    /**\n-     * Called when feed parsed successfully.\n-     * This method is executed on the GUI thread.\n-     */\n-    private void showFeedInformation(final Feed feed, Map<String, String> alternateFeedUrls) {\n-        viewBinding.progressBar.setVisibility(View.GONE);\n-        viewBinding.feedDisplayContainer.setVisibility(View.VISIBLE);\n+    private void showFeedFragment(long id) {\n         if (isFeedFoundBySearch) {\n-            int resId = R.string.no_feed_url_podcast_found_by_search;\n-            Snackbar.make(findViewById(android.R.id.content), resId, Snackbar.LENGTH_LONG).show();\n-        }\n-\n-        viewBinding.backgroundImage.setColorFilter(new LightingColorFilter(0xff828282, 0x000000));\n-\n-        viewBinding.listView.addHeaderView(headerBinding.getRoot());\n-        viewBinding.listView.setSelector(android.R.color.transparent);\n-        viewBinding.listView.setAdapter(new FeedItemlistDescriptionAdapter(this, 0, feed.getItems()));\n-\n-        if (StringUtils.isNotBlank(feed.getImageUrl())) {\n-            Glide.with(this)\n-                    .load(feed.getImageUrl())\n-                    .apply(new RequestOptions()\n-                        .placeholder(R.color.light_gray)\n-                        .error(R.color.light_gray)\n-                        .fitCenter()\n-                        .dontAnimate())\n-                    .into(viewBinding.coverImage);\n-            Glide.with(this)\n-                    .load(feed.getImageUrl())\n-                    .apply(new RequestOptions()\n-                            .placeholder(R.color.image_readability_tint)\n-                            .error(R.color.image_readability_tint)\n-                            .transform(new FastBlurTransformation())\n-                            .dontAnimate())\n-                    .into(viewBinding.backgroundImage);\n-        }\n-\n-        viewBinding.titleLabel.setText(feed.getTitle());\n-        viewBinding.authorLabel.setText(feed.getAuthor());\n-        headerBinding.txtvDescription.setText(HtmlToPlainText.getPlainText(feed.getDescription()));\n-\n-        viewBinding.subscribeButton.setOnClickListener(v -> {\n-            if (feedInFeedlist()) {\n-                openFeed();\n-            } else {\n-                FeedDatabaseWriter.updateFeed(this, feed, false);\n-                didPressSubscribe = true;\n-                handleUpdatedFeedStatus();\n-            }\n-        });\n-\n-        viewBinding.stopPreviewButton.setOnClickListener(v -> {\n-            PlaybackPreferences.writeNoMediaPlaying();\n-            IntentUtils.sendLocalBroadcast(this, PlaybackServiceInterface.ACTION_SHUTDOWN_PLAYBACK_SERVICE);\n-        });\n-\n-        if (UserPreferences.isEnableAutodownload()) {\n-            SharedPreferences preferences = getSharedPreferences(PREFS, MODE_PRIVATE);\n-            viewBinding.autoDownloadCheckBox.setChecked(preferences.getBoolean(PREF_LAST_AUTO_DOWNLOAD, true));\n+            Toast.makeText(this, R.string.no_feed_url_podcast_found_by_search, Toast.LENGTH_LONG).show();\n         }\n \n-        headerBinding.txtvDescription.setMaxLines(DESCRIPTION_MAX_LINES_COLLAPSED);\n-        headerBinding.txtvDescription.setOnClickListener(v -> {\n-            if (headerBinding.txtvDescription.getMaxLines() > DESCRIPTION_MAX_LINES_COLLAPSED) {\n-                headerBinding.txtvDescription.setMaxLines(DESCRIPTION_MAX_LINES_COLLAPSED);\n-            } else {\n-                headerBinding.txtvDescription.setMaxLines(2000);\n-            }\n-        });\n-\n-        if (alternateFeedUrls.isEmpty()) {\n-            viewBinding.alternateUrlsSpinner.setVisibility(View.GONE);\n-        } else {\n-            viewBinding.alternateUrlsSpinner.setVisibility(View.VISIBLE);\n-\n-            final List<String> alternateUrlsList = new ArrayList<>();\n-            final List<String> alternateUrlsTitleList = new ArrayList<>();\n-\n-            alternateUrlsList.add(feed.getDownloadUrl());\n-            alternateUrlsTitleList.add(feed.getTitle());\n-\n-\n-            alternateUrlsList.addAll(alternateFeedUrls.keySet());\n-            for (String url : alternateFeedUrls.keySet()) {\n-                alternateUrlsTitleList.add(alternateFeedUrls.get(url));\n-            }\n-\n-            ArrayAdapter<String> adapter = new ArrayAdapter<String>(this,\n-                    R.layout.alternate_urls_item, alternateUrlsTitleList) {\n-                @Override\n-                public View getDropDownView(int position, @Nullable View convertView, @NonNull ViewGroup parent) {\n-                    // reusing the old view causes a visual bug on Android <= 10\n-                    return super.getDropDownView(position, null, parent);\n-                }\n-            };\n-\n-            adapter.setDropDownViewResource(R.layout.alternate_urls_dropdown_item);\n-            viewBinding.alternateUrlsSpinner.setAdapter(adapter);\n-            viewBinding.alternateUrlsSpinner.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener() {\n-                @Override\n-                public void onItemSelected(AdapterView<?> parent, View view, int position, long id) {\n-                    selectedDownloadUrl = alternateUrlsList.get(position);\n-                }\n-\n-                @Override\n-                public void onNothingSelected(AdapterView<?> parent) {\n-\n-                }\n-            });\n-        }\n-        handleUpdatedFeedStatus();\n+        viewBinding.progressBar.setVisibility(View.GONE);\n+        FeedItemlistFragment fragment = FeedItemlistFragment.newInstance(id);\n+        getSupportFragmentManager()\n+                .beginTransaction()\n+                .replace(R.id.fragmentContainer, fragment, FeedItemlistFragment.TAG)\n+                .commitAllowingStateLoss();\n     }\n \n-    private void openFeed() {\n+    private void openFeed(long feedId) {\n         // feed.getId() is always 0, we have to retrieve the id from the feed list from the database\n         MainActivityStarter mainActivityStarter = new MainActivityStarter(this);\n-        mainActivityStarter.withOpenFeed(getFeedId());\n+        mainActivityStarter.withOpenFeed(feedId);\n         if (getIntent().getBooleanExtra(ARG_STARTED_FROM_SEARCH, false)) {\n             mainActivityStarter.withAddToBackStack();\n         }\n@@ -516,60 +357,6 @@ private void openFeed() {\n         startActivity(mainActivityStarter.getIntent());\n     }\n \n-    private void handleUpdatedFeedStatus() {\n-        if (DownloadServiceInterface.get().isDownloadingEpisode(selectedDownloadUrl)) {\n-            viewBinding.subscribeButton.setEnabled(false);\n-            viewBinding.subscribeButton.setText(R.string.subscribing_label);\n-        } else if (feedInFeedlist()) {\n-            viewBinding.subscribeButton.setEnabled(true);\n-            viewBinding.subscribeButton.setText(R.string.open_podcast);\n-            if (didPressSubscribe) {\n-                didPressSubscribe = false;\n-\n-                Feed feed1 = DBReader.getFeed(getFeedId(), false, 0, 0);\n-                FeedPreferences feedPreferences = feed1.getPreferences();\n-                if (UserPreferences.isEnableAutodownload()) {\n-                    boolean autoDownload = viewBinding.autoDownloadCheckBox.isChecked();\n-                    feedPreferences.setAutoDownload(autoDownload);\n-\n-                    SharedPreferences preferences = getSharedPreferences(PREFS, MODE_PRIVATE);\n-                    SharedPreferences.Editor editor = preferences.edit();\n-                    editor.putBoolean(PREF_LAST_AUTO_DOWNLOAD, autoDownload);\n-                    editor.apply();\n-                }\n-                if (username != null) {\n-                    feedPreferences.setUsername(username);\n-                    feedPreferences.setPassword(password);\n-                }\n-                DBWriter.setFeedPreferences(feedPreferences);\n-\n-                openFeed();\n-            }\n-        } else {\n-            viewBinding.subscribeButton.setEnabled(true);\n-            viewBinding.subscribeButton.setText(R.string.subscribe_label);\n-            if (UserPreferences.isEnableAutodownload()) {\n-                viewBinding.autoDownloadCheckBox.setVisibility(View.VISIBLE);\n-            }\n-        }\n-    }\n-\n-    private boolean feedInFeedlist() {\n-        return getFeedId() != 0;\n-    }\n-\n-    private long getFeedId() {\n-        if (feeds == null) {\n-            return 0;\n-        }\n-        for (Feed f : feeds) {\n-            if (f.getDownloadUrl().equals(selectedDownloadUrl)) {\n-                return f.getId();\n-            }\n-        }\n-        return 0;\n-    }\n-\n     @UiThread\n     private void showErrorDialog(String errorMsg, String details) {\n         if (!isFinishing() && !isPaused) {\n@@ -589,7 +376,6 @@ private void showErrorDialog(String errorMsg, String details) {\n                 builder.setNeutralButton(R.string.edit_url_menu, (dialog, which) -> editUrl());\n             }\n             builder.setOnCancelListener(dialog -> {\n-                setResult(RESULT_ERROR);\n                 finish();\n             });\n             if (dialog != null && dialog.isShowing()) {\n@@ -608,24 +394,15 @@ private void editUrl() {\n         }\n         builder.setView(dialogBinding.getRoot());\n         builder.setPositiveButton(R.string.confirm_label, (dialog, which) -> {\n-            setLoadingLayout();\n             lookupUrlAndDownload(dialogBinding.urlEditText.getText().toString());\n         });\n         builder.setNegativeButton(R.string.cancel_label, (dialog1, which) -> dialog1.cancel());\n         builder.setOnCancelListener(dialog1 -> {\n-            setResult(RESULT_ERROR);\n             finish();\n         });\n         builder.show();\n     }\n \n-    @Subscribe(threadMode = ThreadMode.MAIN)\n-    public void playbackStateChanged(PlayerStatusEvent event) {\n-        boolean isPlayingPreview =\n-                PlaybackPreferences.getCurrentlyPlayingMediaType() == RemoteMedia.PLAYABLE_TYPE_REMOTE_MEDIA;\n-        viewBinding.stopPreviewButton.setVisibility(isPlayingPreview ? View.VISIBLE : View.GONE);\n-    }\n-\n     /**\n      *\n      * @return true if a FeedDiscoveryDialog is shown, false otherwise (e.g., due to no feed found).\n@@ -657,7 +434,7 @@ private boolean showFeedDiscoveryDialog(File feedFile, String baseUrl) {\n         if (urls.size() == 1) {\n             // Skip dialog and display the item directly\n             resetIntent(urls.get(0));\n-            startFeedDownload(urls.get(0));\n+            downloadIfNotAlreadySubscribed(urls.get(0));\n             return true;\n         }\n \n@@ -667,7 +444,7 @@ private boolean showFeedDiscoveryDialog(File feedFile, String baseUrl) {\n             String selectedUrl = urls.get(which);\n             dialog.dismiss();\n             resetIntent(selectedUrl);\n-            startFeedDownload(selectedUrl);\n+            downloadIfNotAlreadySubscribed(selectedUrl);\n         };\n \n         MaterialAlertDialogBuilder ab = new MaterialAlertDialogBuilder(OnlineFeedViewActivity.this)\n@@ -704,7 +481,7 @@ protected void onCancelled() {\n         protected void onConfirmed(String username, String password) {\n             OnlineFeedViewActivity.this.username = username;\n             OnlineFeedViewActivity.this.password = password;\n-            startFeedDownload(feedUrl);\n+            downloadIfNotAlreadySubscribed(feedUrl);\n         }\n     }\n \ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java\nindex e66ed6d3ea..7aa9da5036 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java\n@@ -25,8 +25,10 @@\n import com.google.android.material.bottomsheet.BottomSheetBehavior;\n import com.google.android.material.elevation.SurfaceColors;\n \n+import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.playback.service.PlaybackController;\n import de.danoeh.antennapod.ui.appstartintent.MediaButtonStarter;\n+import de.danoeh.antennapod.ui.appstartintent.OnlineFeedviewActivityStarter;\n import de.danoeh.antennapod.ui.chapters.ChapterUtils;\n import de.danoeh.antennapod.ui.episodes.PlaybackSpeedUtils;\n import de.danoeh.antennapod.ui.episodes.TimeSpeedConverter;\n@@ -497,14 +499,25 @@ public boolean onMenuItemClick(MenuItem item) {\n             return true;\n         } else if (itemId == R.id.open_feed_item) {\n             if (feedItem != null) {\n-                Intent intent = MainActivity.getIntentToOpenFeed(getContext(), feedItem.getFeedId());\n-                startActivity(intent);\n+                openFeed(feedItem.getFeed());\n             }\n             return true;\n         }\n         return false;\n     }\n \n+    private void openFeed(Feed feed) {\n+        if (feed == null) {\n+            return;\n+        }\n+        if (feed.getState() == Feed.STATE_SUBSCRIBED) {\n+            Intent intent = MainActivity.getIntentToOpenFeed(getContext(), feed.getId());\n+            startActivity(intent);\n+        } else {\n+            startActivity(new OnlineFeedviewActivityStarter(getContext(), feed.getDownloadUrl()).getIntent());\n+        }\n+    }\n+\n     public void fadePlayerToToolbar(float slideOffset) {\n         float playerFadeProgress = Math.max(0.0f, Math.min(0.2f, slideOffset - 0.2f)) / 0.2f;\n         View player = getView().findViewById(R.id.playerFragment);\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/CoverFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/CoverFragment.java\nindex 073d5b0be3..d4931380ed 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/CoverFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/CoverFragment.java\n@@ -32,6 +32,8 @@\n import com.google.android.material.snackbar.Snackbar;\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n+import de.danoeh.antennapod.model.feed.Feed;\n+import de.danoeh.antennapod.ui.appstartintent.OnlineFeedviewActivityStarter;\n import de.danoeh.antennapod.ui.chapters.ChapterUtils;\n import de.danoeh.antennapod.ui.screen.chapter.ChaptersFragment;\n import de.danoeh.antennapod.playback.service.PlaybackController;\n@@ -122,9 +124,7 @@ private void displayMediaInfo(@NonNull Playable media) {\n                 + \"\\u00A0\"\n                 + StringUtils.replace(StringUtils.stripToEmpty(pubDateStr), \" \", \"\\u00A0\"));\n         if (media instanceof FeedMedia) {\n-            Intent openFeed = MainActivity.getIntentToOpenFeed(requireContext(),\n-                    ((FeedMedia) media).getItem().getFeedId());\n-            viewBinding.txtvPodcastTitle.setOnClickListener(v -> startActivity(openFeed));\n+            viewBinding.txtvPodcastTitle.setOnClickListener(v -> openFeed(((FeedMedia) media).getItem().getFeed()));\n         } else {\n             viewBinding.txtvPodcastTitle.setOnClickListener(null);\n         }\n@@ -164,6 +164,18 @@ public void onAnimationEnd(Animator animation) {\n         updateChapterControlVisibility();\n     }\n \n+    private void openFeed(Feed feed) {\n+        if (feed == null) {\n+            return;\n+        }\n+        if (feed.getState() == Feed.STATE_SUBSCRIBED) {\n+            Intent intent = MainActivity.getIntentToOpenFeed(getContext(), feed.getId());\n+            startActivity(intent);\n+        } else {\n+            startActivity(new OnlineFeedviewActivityStarter(getContext(), feed.getDownloadUrl()).getIntent());\n+        }\n+    }\n+\n     private void updateChapterControlVisibility() {\n         boolean chapterControlVisible = false;\n         if (media.getChapters() != null) {\ndiff --git a/app/src/main/res/layout/alternate_urls_dropdown_item.xml b/app/src/main/res/layout/alternate_urls_dropdown_item.xml\ndeleted file mode 100644\nindex 3c4dcc7fc6..0000000000\n--- a/app/src/main/res/layout/alternate_urls_dropdown_item.xml\n+++ /dev/null\n@@ -1,8 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"utf-8\"?>\n-<CheckedTextView\n-    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n-    android:id=\"@android:id/text1\"\n-    android:layout_width=\"match_parent\"\n-    android:layout_height=\"wrap_content\"\n-    android:paddingVertical=\"8dp\"\n-    style=\"?android:attr/spinnerDropDownItemStyle\" />\ndiff --git a/app/src/main/res/layout/alternate_urls_item.xml b/app/src/main/res/layout/alternate_urls_item.xml\ndeleted file mode 100644\nindex 54e05b49d0..0000000000\n--- a/app/src/main/res/layout/alternate_urls_item.xml\n+++ /dev/null\n@@ -1,9 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"utf-8\"?>\n-<TextView\n-    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n-    android:id=\"@android:id/text1\"\n-    android:layout_width=\"match_parent\"\n-    android:layout_height=\"wrap_content\"\n-    android:maxLines=\"3\"\n-    android:textAlignment=\"inherit\"\n-    style=\"?android:attr/spinnerItemStyle\" />\ndiff --git a/app/src/main/res/layout/feedinfo.xml b/app/src/main/res/layout/feedinfo.xml\nindex 1a6d8ce931..ba121a8f34 100644\n--- a/app/src/main/res/layout/feedinfo.xml\n+++ b/app/src/main/res/layout/feedinfo.xml\n@@ -66,13 +66,13 @@\n             android:layout_width=\"match_parent\"\n             android:layout_height=\"wrap_content\"\n             android:orientation=\"vertical\"\n+            android:paddingTop=\"16dp\"\n             android:paddingHorizontal=\"@dimen/additional_horizontal_spacing\">\n \n             <TextView\n                 android:id=\"@+id/statisticsHeadingLabel\"\n                 android:layout_width=\"wrap_content\"\n                 android:layout_height=\"wrap_content\"\n-                android:layout_marginTop=\"16dp\"\n                 android:textSize=\"18sp\"\n                 android:layout_marginBottom=\"8dp\"\n                 android:text=\"@string/statistics_label\"\n@@ -90,6 +90,7 @@\n                 android:layout_height=\"wrap_content\"\n                 android:minWidth=\"0dp\"\n                 android:minHeight=\"0dp\"\n+                android:layout_marginBottom=\"16dp\"\n                 android:text=\"@string/statistics_view_all\"\n                 style=\"@style/Widget.MaterialComponents.Button.TextButton\" />\n \n@@ -97,7 +98,6 @@\n                 android:id=\"@+id/supportHeadingLabel\"\n                 android:layout_width=\"match_parent\"\n                 android:layout_height=\"wrap_content\"\n-                android:layout_marginTop=\"16dp\"\n                 android:layout_marginBottom=\"4dp\"\n                 android:text=\"@string/support_funding_label\"\n                 android:textColor=\"?android:attr/textColorPrimary\"\n@@ -120,7 +120,6 @@\n                 android:layout_width=\"wrap_content\"\n                 android:layout_height=\"wrap_content\"\n                 android:textSize=\"18sp\"\n-                android:layout_marginTop=\"16dp\"\n                 android:layout_marginBottom=\"4dp\"\n                 android:text=\"@string/description_label\"\n                 android:textColor=\"?android:attr/textColorPrimary\"\n@@ -130,7 +129,6 @@\n                 android:id=\"@+id/descriptionLabel\"\n                 android:layout_width=\"match_parent\"\n                 android:layout_height=\"wrap_content\"\n-                android:text=\"@string/design_time_lorem_ipsum\"\n                 android:textIsSelectable=\"true\"\n                 tools:background=\"@android:color/holo_green_dark\" />\n \ndiff --git a/app/src/main/res/layout/feeditem_fragment.xml b/app/src/main/res/layout/feeditem_fragment.xml\nindex 37db9067c3..df95b8c157 100644\n--- a/app/src/main/res/layout/feeditem_fragment.xml\n+++ b/app/src/main/res/layout/feeditem_fragment.xml\n@@ -174,6 +174,20 @@\n \n         </LinearLayout>\n \n+        <TextView\n+            android:id=\"@+id/nonSubscribedWarningLabel\"\n+            android:layout_width=\"wrap_content\"\n+            android:layout_height=\"wrap_content\"\n+            android:layout_marginVertical=\"8dp\"\n+            android:layout_marginBottom=\"8dp\"\n+            android:paddingHorizontal=\"16dp\"\n+            android:paddingVertical=\"8dp\"\n+            android:background=\"@drawable/bg_message_info\"\n+            android:textColor=\"?attr/colorAccent\"\n+            android:visibility=\"gone\"\n+            android:foreground=\"?attr/selectableItemBackground\"\n+            android:text=\"@string/state_deleted_not_subscribed\" />\n+\n         <TextView\n             android:id=\"@+id/noMediaLabel\"\n             android:layout_width=\"match_parent\"\ndiff --git a/app/src/main/res/layout/feeditemlist_header.xml b/app/src/main/res/layout/feeditemlist_header.xml\nindex 9b6d190a85..857e44d599 100644\n--- a/app/src/main/res/layout/feeditemlist_header.xml\n+++ b/app/src/main/res/layout/feeditemlist_header.xml\n@@ -28,6 +28,14 @@\n                 android:layout_width=\"148dp\"\n                 android:layout_height=\"match_parent\" />\n \n+            <Button\n+                android:id=\"@+id/butSubscribe\"\n+                android:layout_width=\"wrap_content\"\n+                android:layout_height=\"wrap_content\"\n+                android:text=\"@string/subscribe_label\"\n+                android:visibility=\"gone\"\n+                tools:visibility=\"visible\" />\n+\n             <ImageButton\n                 android:id=\"@+id/butShowInfo\"\n                 android:layout_width=\"40dp\"\n@@ -178,4 +186,52 @@\n         tools:visibility=\"visible\"\n         tools:text=\"Updates disabled\" />\n \n+    <LinearLayout\n+        android:id=\"@+id/descriptionContainer\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:paddingHorizontal=\"16dp\"\n+        android:background=\"?android:attr/colorBackground\"\n+        android:orientation=\"vertical\"\n+        android:visibility=\"gone\">\n+\n+        <TextView\n+            android:layout_width=\"wrap_content\"\n+            android:layout_height=\"wrap_content\"\n+            android:layout_marginBottom=\"8dp\"\n+            android:layout_marginTop=\"16dp\"\n+            android:paddingHorizontal=\"16dp\"\n+            android:paddingVertical=\"8dp\"\n+            android:background=\"@drawable/bg_message_info\"\n+            android:textColor=\"?attr/colorAccent\"\n+            android:text=\"@string/state_deleted_not_subscribed\" />\n+\n+        <TextView\n+            android:layout_width=\"wrap_content\"\n+            android:layout_height=\"wrap_content\"\n+            android:layout_marginBottom=\"8dp\"\n+            android:text=\"@string/description_label\"\n+            style=\"@style/TextAppearance.Material3.TitleMedium\" />\n+\n+        <TextView\n+            android:id=\"@+id/headerDescriptionLabel\"\n+            android:layout_width=\"wrap_content\"\n+            android:layout_height=\"wrap_content\"\n+            android:ellipsize=\"end\"\n+            android:lineHeight=\"20dp\"\n+            android:maxLines=\"3\"\n+            android:layout_marginBottom=\"16dp\"\n+            android:background=\"?android:attr/selectableItemBackground\"\n+            style=\"@style/AntennaPod.TextView.ListItemBody\"\n+            tools:text=\"@string/design_time_lorem_ipsum\" />\n+\n+        <TextView\n+            android:layout_width=\"wrap_content\"\n+            android:layout_height=\"wrap_content\"\n+            android:text=\"@string/preview_episodes\"\n+            android:layout_marginBottom=\"8dp\"\n+            style=\"@style/TextAppearance.Material3.TitleMedium\" />\n+\n+    </LinearLayout>\n+\n </LinearLayout>\ndiff --git a/app/src/main/res/layout/itemdescription_listitem.xml b/app/src/main/res/layout/itemdescription_listitem.xml\ndeleted file mode 100644\nindex c3f8c24b8d..0000000000\n--- a/app/src/main/res/layout/itemdescription_listitem.xml\n+++ /dev/null\n@@ -1,51 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"utf-8\"?>\n-<LinearLayout\n-    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n-    xmlns:tools=\"http://schemas.android.com/tools\"\n-    android:layout_width=\"match_parent\"\n-    android:layout_height=\"wrap_content\"\n-    android:orientation=\"vertical\"\n-    android:paddingHorizontal=\"20dp\"\n-    android:paddingVertical=\"16dp\">\n-\n-    <TextView\n-        android:id=\"@+id/txtvPubDate\"\n-        android:layout_width=\"wrap_content\"\n-        android:layout_height=\"wrap_content\"\n-        android:ellipsize=\"end\"\n-        android:lines=\"1\"\n-        style=\"@android:style/TextAppearance.Small\"\n-        tools:text=\"22 Jan 2016\"\n-        tools:background=\"@android:color/holo_green_dark\" />\n-\n-    <TextView\n-        android:id=\"@+id/txtvTitle\"\n-        android:layout_width=\"match_parent\"\n-        android:layout_height=\"wrap_content\"\n-        android:layout_marginVertical=\"12dp\"\n-        android:ellipsize=\"end\"\n-        android:maxLines=\"2\"\n-        style=\"@style/AntennaPod.TextView.ListItemPrimaryTitle\"\n-        tools:text=\"Feed item title\"\n-        tools:background=\"@android:color/holo_green_dark\" />\n-\n-    <TextView\n-        android:id=\"@+id/txtvDescription\"\n-        android:layout_width=\"match_parent\"\n-        android:layout_height=\"wrap_content\"\n-        android:ellipsize=\"end\"\n-        android:maxLines=\"2\"\n-        style=\"@style/AntennaPod.TextView.ListItemBody\"\n-        tools:text=\"Feed item description\"\n-        tools:background=\"@android:color/holo_green_dark\" />\n-\n-    <Button\n-        android:id=\"@+id/butPreview\"\n-        android:layout_width=\"wrap_content\"\n-        android:layout_height=\"wrap_content\"\n-        android:layout_marginTop=\"8dp\"\n-        android:text=\"@string/preview_episode\"\n-        android:layout_gravity=\"end|right\"\n-        style=\"@style/Widget.MaterialComponents.Button.OutlinedButton\" />\n-\n-</LinearLayout>\ndiff --git a/app/src/main/res/layout/onlinefeedview_activity.xml b/app/src/main/res/layout/onlinefeedview_activity.xml\nindex 88b87da1af..a121c9e0ed 100644\n--- a/app/src/main/res/layout/onlinefeedview_activity.xml\n+++ b/app/src/main/res/layout/onlinefeedview_activity.xml\n@@ -2,7 +2,6 @@\n <LinearLayout\n     xmlns:android=\"http://schemas.android.com/apk/res/android\"\n     xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n-    xmlns:tools=\"http://schemas.android.com/tools\"\n     android:id=\"@+id/transparentBackground\"\n     android:layout_width=\"match_parent\"\n     android:layout_height=\"match_parent\">\n@@ -11,169 +10,22 @@\n         android:id=\"@+id/card\"\n         android:layout_width=\"match_parent\"\n         android:layout_height=\"match_parent\"\n-        android:layout_margin=\"24dp\"\n+        android:layout_marginHorizontal=\"16dp\"\n+        android:layout_marginVertical=\"56dp\"\n         android:elevation=\"16dp\"\n         app:cardCornerRadius=\"8dp\">\n \n-        <FrameLayout\n+        <androidx.fragment.app.FragmentContainerView\n+            android:id=\"@+id/fragmentContainer\"\n             android:layout_width=\"match_parent\"\n-            android:layout_height=\"match_parent\"\n-            android:orientation=\"vertical\">\n-\n-            <ProgressBar\n-                android:id=\"@+id/progressBar\"\n-                android:layout_width=\"wrap_content\"\n-                android:layout_height=\"wrap_content\"\n-                android:layout_gravity=\"center\"\n-                style=\"?android:attr/progressBarStyle\" />\n-\n-            <LinearLayout\n-                android:id=\"@+id/feed_display_container\"\n-                android:layout_width=\"match_parent\"\n-                android:layout_height=\"match_parent\"\n-                android:orientation=\"vertical\">\n-\n-                <RelativeLayout\n-                    android:layout_width=\"match_parent\"\n-                    android:layout_height=\"@dimen/feeditemlist_header_height\"\n-                    android:layout_marginBottom=\"12dp\"\n-                    android:background=\"@color/feed_image_bg\">\n-\n-                    <ImageView\n-                        android:id=\"@+id/backgroundImage\"\n-                        android:layout_width=\"match_parent\"\n-                        android:layout_height=\"match_parent\"\n-                        android:scaleType=\"centerCrop\" />\n-\n-                    <ImageView\n-                        android:id=\"@+id/coverImage\"\n-                        android:layout_width=\"@dimen/thumbnail_length_onlinefeedview\"\n-                        android:layout_height=\"@dimen/thumbnail_length_onlinefeedview\"\n-                        android:layout_alignParentLeft=\"true\"\n-                        android:layout_alignParentStart=\"true\"\n-                        android:layout_alignParentTop=\"true\"\n-                        android:layout_centerVertical=\"true\"\n-                        android:layout_marginBottom=\"12dp\"\n-                        android:layout_marginLeft=\"16dp\"\n-                        android:layout_marginStart=\"16dp\"\n-                        android:layout_marginTop=\"24dp\"\n-                        android:background=\"@drawable/bg_rounded_corners\"\n-                        android:clipToOutline=\"true\"\n-                        android:importantForAccessibility=\"no\"\n-                        tools:src=\"@tools:sample/avatars\" />\n-\n-                    <TextView\n-                        android:id=\"@+id/titleLabel\"\n-                        android:layout_width=\"0dp\"\n-                        android:layout_height=\"wrap_content\"\n-                        android:layout_alignParentTop=\"true\"\n-                        android:layout_marginBottom=\"8dp\"\n-                        android:layout_marginLeft=\"16dp\"\n-                        android:layout_marginStart=\"16dp\"\n-                        android:layout_marginTop=\"24dp\"\n-                        android:layout_marginRight=\"24dp\"\n-                        android:layout_marginEnd=\"24dp\"\n-                        android:layout_alignParentEnd=\"true\"\n-                        android:layout_alignParentRight=\"true\"\n-                        android:layout_toRightOf=\"@id/coverImage\"\n-                        android:layout_toEndOf=\"@id/coverImage\"\n-                        android:ellipsize=\"end\"\n-                        android:maxLines=\"2\"\n-                        android:shadowColor=\"@color/black\"\n-                        android:shadowRadius=\"3\"\n-                        android:textColor=\"@color/white\"\n-                        android:textSize=\"20sp\"\n-                        android:textFontWeight=\"800\"\n-                        tools:text=\"Podcast title\" />\n-\n-                    <TextView\n-                        android:id=\"@+id/author_label\"\n-                        android:layout_width=\"0dip\"\n-                        android:layout_height=\"wrap_content\"\n-                        android:layout_below=\"@id/titleLabel\"\n-                        android:layout_marginBottom=\"16dp\"\n-                        android:layout_marginLeft=\"16dp\"\n-                        android:layout_marginStart=\"16dp\"\n-                        android:layout_marginRight=\"16dp\"\n-                        android:layout_marginEnd=\"16dp\"\n-                        android:layout_alignParentEnd=\"true\"\n-                        android:layout_alignParentRight=\"true\"\n-                        android:layout_toRightOf=\"@id/coverImage\"\n-                        android:layout_toEndOf=\"@id/coverImage\"\n-                        android:ellipsize=\"end\"\n-                        android:lines=\"1\"\n-                        android:shadowColor=\"@color/black\"\n-                        android:shadowRadius=\"3\"\n-                        android:textColor=\"@color/white\"\n-                        android:textSize=\"@dimen/text_size_small\"\n-                        tools:text=\"Podcast author\" />\n-\n-                    <ImageButton\n-                        android:id=\"@+id/closeButton\"\n-                        android:layout_width=\"16dp\"\n-                        android:layout_height=\"16dp\"\n-                        android:layout_alignParentRight=\"true\"\n-                        android:layout_marginTop=\"12dp\"\n-                        android:layout_marginRight=\"12dp\"\n-                        android:background=\"@android:color/transparent\"\n-                        android:src=\"@drawable/ic_close_white\" />\n-\n-                </RelativeLayout>\n-\n-                <LinearLayout\n-                    android:layout_width=\"match_parent\"\n-                    android:layout_height=\"wrap_content\"\n-                    android:paddingHorizontal=\"16dp\"\n-                    android:orientation=\"vertical\">\n-\n-                    <Spinner\n-                        android:id=\"@+id/alternate_urls_spinner\"\n-                        android:layout_width=\"match_parent\"\n-                        android:layout_height=\"wrap_content\"\n-                        android:dropDownWidth=\"match_parent\"\n-                        android:padding=\"8dp\"\n-                        android:textColor=\"?android:attr/textColorPrimary\"\n-                        android:textSize=\"@dimen/text_size_micro\" />\n-\n-                    <Button\n-                        android:id=\"@+id/subscribeButton\"\n-                        android:layout_width=\"match_parent\"\n-                        android:layout_height=\"wrap_content\"\n-                        android:layout_marginTop=\"4dp\"\n-                        android:text=\"@string/subscribe_label\" />\n-\n-                    <CheckBox\n-                        android:id=\"@+id/autoDownloadCheckBox\"\n-                        android:layout_width=\"match_parent\"\n-                        android:layout_height=\"wrap_content\"\n-                        android:layout_gravity=\"left\"\n-                        android:checked=\"true\"\n-                        android:layout_marginTop=\"8dp\"\n-                        android:text=\"@string/auto_download_label\"\n-                        android:visibility=\"gone\"\n-                        tools:visibility=\"visible\" />\n-\n-                    <Button\n-                        android:id=\"@+id/stopPreviewButton\"\n-                        android:layout_width=\"match_parent\"\n-                        android:layout_height=\"wrap_content\"\n-                        android:layout_marginTop=\"4dp\"\n-                        android:text=\"@string/stop_preview\"\n-                        android:visibility=\"gone\"\n-                        tools:visibility=\"visible\" />\n-\n-                </LinearLayout>\n-\n-                <ListView\n-                    android:id=\"@+id/listView\"\n-                    android:layout_width=\"match_parent\"\n-                    android:layout_height=\"match_parent\"\n-                    android:paddingTop=\"16dp\"\n-                    android:clipToPadding=\"false\" />\n-\n-            </LinearLayout>\n-\n-        </FrameLayout>\n+            android:layout_height=\"match_parent\" />\n+\n+        <ProgressBar\n+            android:id=\"@+id/progressBar\"\n+            android:layout_width=\"wrap_content\"\n+            android:layout_height=\"wrap_content\"\n+            android:layout_gravity=\"center\"\n+            style=\"?android:attr/progressBarStyle\" />\n \n     </androidx.cardview.widget.CardView>\n \ndiff --git a/app/src/main/res/layout/onlinefeedview_header.xml b/app/src/main/res/layout/onlinefeedview_header.xml\ndeleted file mode 100644\nindex 6d740c772b..0000000000\n--- a/app/src/main/res/layout/onlinefeedview_header.xml\n+++ /dev/null\n@@ -1,36 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"utf-8\"?>\n-<LinearLayout\n-    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n-    xmlns:tools=\"http://schemas.android.com/tools\"\n-    android:layout_width=\"match_parent\"\n-    android:layout_height=\"wrap_content\"\n-    android:orientation=\"vertical\"\n-    android:paddingLeft=\"20dp\"\n-    android:paddingRight=\"20dp\"\n-    android:layout_marginBottom=\"8dp\">\n-\n-    <TextView\n-        android:layout_width=\"wrap_content\"\n-        android:layout_height=\"wrap_content\"\n-        android:layout_marginBottom=\"8dp\"\n-        android:text=\"@string/description_label\"\n-        style=\"@style/TextAppearance.Material3.TitleMedium\" />\n-\n-    <TextView\n-        android:id=\"@+id/txtvDescription\"\n-        android:layout_width=\"wrap_content\"\n-        android:layout_height=\"wrap_content\"\n-        android:layout_marginBottom=\"16dp\"\n-        android:ellipsize=\"end\"\n-        android:lineHeight=\"20dp\"\n-        style=\"@style/AntennaPod.TextView.ListItemBody\"\n-        tools:text=\"@string/design_time_lorem_ipsum\" />\n-\n-    <TextView\n-        android:layout_width=\"wrap_content\"\n-        android:layout_height=\"wrap_content\"\n-        android:layout_marginBottom=\"16dp\"\n-        android:text=\"@string/episodes_label\"\n-        style=\"@style/TextAppearance.Material3.TitleMedium\" />\n-\n-</LinearLayout>\ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/Feed.java b/model/src/main/java/de/danoeh/antennapod/model/feed/Feed.java\nindex 15d256c244..634d3440d7 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/feed/Feed.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/Feed.java\n@@ -15,6 +15,8 @@\n public class Feed {\n \n     public static final int FEEDFILETYPE_FEED = 0;\n+    public static final int STATE_SUBSCRIBED = 0;\n+    public static final int STATE_NOT_SUBSCRIBED = 1;\n     public static final String TYPE_RSS2 = \"rss\";\n     public static final String TYPE_ATOM1 = \"atom\";\n     public static final String PREFIX_LOCAL_FOLDER = \"antennapod_local:\";\n@@ -101,6 +103,7 @@ public class Feed {\n      */\n     @Nullable\n     private SortOrder sortOrder;\n+    private int state;\n \n     /**\n      * This constructor is used for restoring a feed from the database.\n@@ -109,7 +112,7 @@ public Feed(long id, String lastModified, String title, String customTitle, Stri\n                 String description, String paymentLinks, String author, String language,\n                 String type, String feedIdentifier, String imageUrl, String fileUrl,\n                 String downloadUrl, long lastRefreshAttempt, boolean paged, String nextPageLink,\n-                String filter, @Nullable SortOrder sortOrder, boolean lastUpdateFailed) {\n+                String filter, @Nullable SortOrder sortOrder, boolean lastUpdateFailed, int state) {\n         this.localFileUrl = fileUrl;\n         this.downloadUrl = downloadUrl;\n         this.lastRefreshAttempt = lastRefreshAttempt;\n@@ -135,6 +138,7 @@ public Feed(long id, String lastModified, String title, String customTitle, Stri\n         }\n         setSortOrder(sortOrder);\n         this.lastUpdateFailed = lastUpdateFailed;\n+        this.state = state;\n     }\n \n     /**\n@@ -144,7 +148,7 @@ public Feed(long id, String lastModified, String title, String link, String desc\n                 String author, String language, String type, String feedIdentifier, String imageUrl, String fileUrl,\n                 String downloadUrl, long lastRefreshAttempt) {\n         this(id, lastModified, title, null, link, description, paymentLink, author, language, type, feedIdentifier,\n-                imageUrl, fileUrl, downloadUrl, lastRefreshAttempt, false, null, null, null, false);\n+                imageUrl, fileUrl, downloadUrl, lastRefreshAttempt, false, null, null, null, false, STATE_SUBSCRIBED);\n     }\n \n     /**\n@@ -468,4 +472,12 @@ public void setLastUpdateFailed(boolean lastUpdateFailed) {\n     public boolean isLocalFeed() {\n         return downloadUrl.startsWith(PREFIX_LOCAL_FOLDER);\n     }\n+\n+    public int getState() {\n+        return state;\n+    }\n+\n+    public void setState(int state) {\n+        this.state = state;\n+    }\n }\ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItemFilter.java b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItemFilter.java\nindex 95a7a61102..1faeda0122 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItemFilter.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItemFilter.java\n@@ -24,6 +24,7 @@ public class FeedItemFilter implements Serializable {\n     public final boolean showIsFavorite;\n     public final boolean showNotFavorite;\n     public final boolean showInHistory;\n+    public final boolean includeNotSubscribed;\n \n     public static final String PLAYED = \"played\";\n     public static final String UNPLAYED = \"unplayed\";\n@@ -39,6 +40,7 @@ public class FeedItemFilter implements Serializable {\n     public static final String DOWNLOADED = \"downloaded\";\n     public static final String NOT_DOWNLOADED = \"not_downloaded\";\n     public static final String IS_IN_HISTORY = \"is_in_history\";\n+    public static final String INCLUDE_NOT_SUBSCRIBED = \"include_not_subscribed\";\n \n     public static FeedItemFilter unfiltered() {\n         return new FeedItemFilter(\"\");\n@@ -48,6 +50,10 @@ public FeedItemFilter(String properties) {\n         this(TextUtils.split(properties, \",\"));\n     }\n \n+    public FeedItemFilter(FeedItemFilter filter, String... additionalProperties) {\n+        this(TextUtils.join(\",\", filter.getValues()) + \",\" + TextUtils.join(\",\", additionalProperties));\n+    }\n+\n     public FeedItemFilter(String... properties) {\n         this.properties = properties;\n \n@@ -66,6 +72,7 @@ public FeedItemFilter(String... properties) {\n         showNotFavorite = hasProperty(NOT_FAVORITE);\n         showNew = hasProperty(NEW);\n         showInHistory = hasProperty(IS_IN_HISTORY);\n+        includeNotSubscribed = hasProperty(INCLUDE_NOT_SUBSCRIBED);\n     }\n \n     private boolean hasProperty(String property) {\n@@ -112,6 +119,9 @@ public boolean matches(FeedItem item) {\n         } else if (showInHistory && item.getMedia() != null\n                 && item.getMedia().getPlaybackCompletionDate().getTime() == 0) {\n             return false;\n+        } else if (!includeNotSubscribed && item.getFeed() != null\n+                && item.getFeed().getState() != Feed.STATE_SUBSCRIBED) {\n+            return false;\n         }\n         return true;\n     }\ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/SubscriptionsFilter.java b/model/src/main/java/de/danoeh/antennapod/model/feed/SubscriptionsFilter.java\nindex 434d474a79..2d584adef8 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/feed/SubscriptionsFilter.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/SubscriptionsFilter.java\n@@ -12,6 +12,7 @@ public class SubscriptionsFilter {\n     private final String[] properties;\n \n     private boolean showIfCounterGreaterZero = false;\n+    private boolean hideNonSubscribedFeeds = true;\n \n     private boolean showAutoDownloadEnabled = false;\n     private boolean showAutoDownloadDisabled = false;\n@@ -67,10 +68,6 @@ public boolean isEnabled() {\n      * Run a list of feed items through the filter.\n      */\n     public List<Feed> filter(List<Feed> items, Map<Long, Integer> feedCounters) {\n-        if (properties.length == 0) {\n-            return items;\n-        }\n-\n         List<Feed> result = new ArrayList<>();\n \n         for (Feed item : items) {\n@@ -95,6 +92,10 @@ public List<Feed> filter(List<Feed> items, Map<Long, Integer> feedCounters) {\n                 continue;\n             }\n \n+            if (hideNonSubscribedFeeds && item.getState() != Feed.STATE_SUBSCRIBED) {\n+                continue;\n+            }\n+\n             // If the item reaches here, it meets all criteria (except counter > 0)\n             result.add(item);\n         }\ndiff --git a/net/discovery/src/main/java/de/danoeh/antennapod/net/discovery/ItunesTopListLoader.java b/net/discovery/src/main/java/de/danoeh/antennapod/net/discovery/ItunesTopListLoader.java\nindex 128aad5939..c837a14efc 100644\n--- a/net/discovery/src/main/java/de/danoeh/antennapod/net/discovery/ItunesTopListLoader.java\n+++ b/net/discovery/src/main/java/de/danoeh/antennapod/net/discovery/ItunesTopListLoader.java\n@@ -58,7 +58,8 @@ private static List<PodcastSearchResult> removeSubscribed(\n             List<PodcastSearchResult> suggestedPodcasts, List<Feed> subscribedFeeds, int limit) {\n         Set<String> subscribedPodcastsSet = new HashSet<>();\n         for (Feed subscribedFeed : subscribedFeeds) {\n-            if (subscribedFeed.getTitle() != null && subscribedFeed.getAuthor() != null) {\n+            if (subscribedFeed.getTitle() != null && subscribedFeed.getAuthor() != null\n+                    && subscribedFeed.getState() == Feed.STATE_SUBSCRIBED) {\n                 subscribedPodcastsSet.add(subscribedFeed.getTitle().trim() + \" - \" + subscribedFeed.getAuthor().trim());\n             }\n         }\ndiff --git a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/MediaDownloadedHandler.java b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/MediaDownloadedHandler.java\nindex 96c1549e2a..cf9ec17e19 100644\n--- a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/MediaDownloadedHandler.java\n+++ b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/MediaDownloadedHandler.java\n@@ -7,6 +7,7 @@\n import androidx.annotation.NonNull;\n \n import de.danoeh.antennapod.model.MediaMetadataRetrieverCompat;\n+import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.net.sync.serviceinterface.SynchronizationQueueSink;\n import de.danoeh.antennapod.ui.chapters.ChapterUtils;\n import org.greenrobot.eventbus.EventBus;\n@@ -104,7 +105,7 @@ public void run() {\n                     FeedMedia.FEEDFILETYPE_FEEDMEDIA, false, DownloadError.ERROR_DB_ACCESS_ERROR, e.getMessage());\n         }\n \n-        if (item != null) {\n+        if (item != null && item.getFeed().getState() == Feed.STATE_SUBSCRIBED) {\n             EpisodeAction action = new EpisodeAction.Builder(item, EpisodeAction.DOWNLOAD)\n                     .currentTimestamp()\n                     .build();\ndiff --git a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/FeedUpdateWorker.java b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/FeedUpdateWorker.java\nindex 9e363b5852..b5174dfcb8 100644\n--- a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/FeedUpdateWorker.java\n+++ b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/FeedUpdateWorker.java\n@@ -35,6 +35,7 @@\n \n import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequestBuilder;\n import de.danoeh.antennapod.parser.feed.FeedHandlerResult;\n+import de.danoeh.antennapod.storage.database.NonSubscribedFeedsCleaner;\n import de.danoeh.antennapod.ui.notifications.NotificationUtils;\n import java.util.ArrayList;\n import java.util.Collections;\n@@ -69,7 +70,7 @@ public Result doWork() {\n             Iterator<Feed> itr = toUpdate.iterator();\n             while (itr.hasNext()) {\n                 Feed feed = itr.next();\n-                if (!feed.getPreferences().getKeepUpdated()) {\n+                if (!feed.getPreferences().getKeepUpdated() || feed.getState() != Feed.STATE_SUBSCRIBED) {\n                     itr.remove();\n                     continue;\n                 }\n@@ -99,8 +100,9 @@ public Result doWork() {\n         }\n         refreshFeeds(toUpdate,  force);\n \n-        notificationManager.cancel(R.id.notification_updating_feeds);\n+        NonSubscribedFeedsCleaner.deleteOldNonSubscribedFeeds(getApplicationContext());\n         AutoDownloadManager.getInstance().autodownloadUndownloadedItems(getApplicationContext());\n+        notificationManager.cancel(R.id.notification_updating_feeds);\n         return Result.success();\n     }\n \ndiff --git a/net/sync/service-interface/src/main/java/de/danoeh/antennapod/net/sync/serviceinterface/SynchronizationQueueSink.java b/net/sync/service-interface/src/main/java/de/danoeh/antennapod/net/sync/serviceinterface/SynchronizationQueueSink.java\nindex ad235130a2..e617dfc781 100644\n--- a/net/sync/service-interface/src/main/java/de/danoeh/antennapod/net/sync/serviceinterface/SynchronizationQueueSink.java\n+++ b/net/sync/service-interface/src/main/java/de/danoeh/antennapod/net/sync/serviceinterface/SynchronizationQueueSink.java\n@@ -2,6 +2,7 @@\n \n import android.content.Context;\n \n+import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.storage.preferences.SynchronizationSettings;\n import de.danoeh.antennapod.model.feed.FeedMedia;\n \n@@ -62,7 +63,8 @@ public static void enqueueEpisodePlayedIfSynchronizationIsActive(Context context\n         if (!SynchronizationSettings.isProviderConnected()) {\n             return;\n         }\n-        if (media.getItem() == null || media.getItem().getFeed().isLocalFeed()) {\n+        if (media.getItem() == null || media.getItem().getFeed().isLocalFeed()\n+                || media.getItem().getFeed().getState() != Feed.STATE_SUBSCRIBED) {\n             return;\n         }\n         if (media.getStartPosition() < 0 || (!completed && media.getStartPosition() >= media.getPosition())) {\ndiff --git a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\nindex 5fa89dd43d..7d20124cf3 100644\n--- a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\n+++ b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\n@@ -436,7 +436,9 @@ private List<MediaBrowserCompat.MediaItem> loadChildrenSynchronous(@NonNull Stri\n                     DBReader.getTotalEpisodeCount(new FeedItemFilter(FeedItemFilter.UNPLAYED))));\n             List<Feed> feeds = DBReader.getFeedList();\n             for (Feed feed : feeds) {\n-                mediaItems.add(createBrowsableMediaItemForFeed(feed));\n+                if (feed.getState() == Feed.STATE_SUBSCRIBED) {\n+                    mediaItems.add(createBrowsableMediaItemForFeed(feed));\n+                }\n             }\n             return mediaItems;\n         }\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBReader.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBReader.java\nindex 4329903796..272df50488 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBReader.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBReader.java\n@@ -356,7 +356,9 @@ public static Feed getFeed(final long feedId, boolean filtered, int offset, int\n         try (FeedCursor cursor = new FeedCursor(adapter.getFeedCursor(feedId))) {\n             if (cursor.moveToNext()) {\n                 feed = cursor.getFeed();\n-                FeedItemFilter filter = filtered ? feed.getItemFilter() : FeedItemFilter.unfiltered();\n+                FeedItemFilter filter = (filtered && feed.getItemFilter() != null)\n+                        ? feed.getItemFilter() : FeedItemFilter.unfiltered();\n+                filter = new FeedItemFilter(filter, FeedItemFilter.INCLUDE_NOT_SUBSCRIBED);\n                 List<FeedItem> items = getFeedItemList(feed, filter, feed.getSortOrder(), offset, limit);\n                 for (FeedItem item : items) {\n                     item.setFeed(feed);\n@@ -668,9 +670,10 @@ public static NavDrawerData getNavDrawerData(@Nullable SubscriptionsFilter subsc\n         final Map<Long, Integer> feedCounters = adapter.getFeedCounters(feedCounter);\n         List<Feed> feeds = getFeedList();\n \n-        if (subscriptionsFilter != null) {\n-            feeds = subscriptionsFilter.filter(feeds, feedCounters);\n+        if (subscriptionsFilter == null) {\n+            subscriptionsFilter = new SubscriptionsFilter(\"\");\n         }\n+        feeds = subscriptionsFilter.filter(feeds, feedCounters);\n \n         Comparator<Feed> comparator;\n         switch (feedOrder) {\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java\nindex 19a02972de..be09a5132e 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java\n@@ -6,6 +6,7 @@\n import android.media.MediaMetadataRetriever;\n import android.util.Log;\n \n+import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.model.feed.FeedItem;\n \n import static de.danoeh.antennapod.model.feed.FeedPreferences.SPEED_USE_GLOBAL;\n@@ -338,6 +339,10 @@ static void upgrade(final SQLiteDatabase db, final int oldVersion, final int new\n             db.execSQL(\"ALTER TABLE \" + PodDBAdapter.TABLE_NAME_FEEDS\n                     + \" ADD COLUMN \" + PodDBAdapter.KEY_FEED_SKIP_SILENCE + \" INTEGER\");\n         }\n+        if (oldVersion < 3050000) {\n+            db.execSQL(\"ALTER TABLE \" + PodDBAdapter.TABLE_NAME_FEEDS\n+                    + \" ADD COLUMN \" + PodDBAdapter.KEY_STATE + \" INTEGER DEFAULT \" + Feed.STATE_SUBSCRIBED);\n+        }\n     }\n \n }\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBWriter.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBWriter.java\nindex 5f684b3985..11e1ad7510 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBWriter.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBWriter.java\n@@ -14,6 +14,7 @@\n import com.google.common.util.concurrent.Futures;\n import de.danoeh.antennapod.event.DownloadLogEvent;\n \n+import de.danoeh.antennapod.model.feed.FeedItemFilter;\n import de.danoeh.antennapod.net.download.serviceinterface.AutoDownloadManager;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n import de.danoeh.antennapod.net.download.serviceinterface.FeedUpdateManager;\n@@ -141,12 +142,13 @@ private static boolean deleteFeedMediaSynchronous(@NonNull Context context, @Non\n             // Do full update of this feed to get rid of the item\n             FeedUpdateManager.getInstance().runOnce(context, media.getItem().getFeed());\n         } else {\n-            // Gpodder: queue delete action for synchronization\n-            FeedItem item = media.getItem();\n-            EpisodeAction action = new EpisodeAction.Builder(item, EpisodeAction.DELETE)\n-                    .currentTimestamp()\n-                    .build();\n-            SynchronizationQueueSink.enqueueEpisodeActionIfSynchronizationIsActive(context, action);\n+            if (media.getItem().getFeed().getState() == Feed.STATE_SUBSCRIBED) {\n+                FeedItem item = media.getItem();\n+                EpisodeAction action = new EpisodeAction.Builder(item, EpisodeAction.DELETE)\n+                        .currentTimestamp()\n+                        .build();\n+                SynchronizationQueueSink.enqueueEpisodeActionIfSynchronizationIsActive(context, action);\n+            }\n \n             EventBus.getDefault().post(FeedItemEvent.updated(media.getItem()));\n         }\n@@ -174,7 +176,7 @@ public static Future<?> deleteFeed(final Context context, final long feedId) {\n             adapter.removeFeed(feed);\n             adapter.close();\n \n-            if (!feed.isLocalFeed()) {\n+            if (!feed.isLocalFeed() && feed.getState() == Feed.STATE_SUBSCRIBED) {\n                 SynchronizationQueueSink.enqueueFeedRemovedIfSynchronizationIsActive(context, feed.getDownloadUrl());\n             }\n             EventBus.getDefault().post(new FeedListUpdateEvent(feed));\n@@ -786,7 +788,7 @@ static Future<?> addNewFeed(final Context context, final Feed... feeds) {\n             adapter.close();\n \n             for (Feed feed : feeds) {\n-                if (!feed.isLocalFeed()) {\n+                if (!feed.isLocalFeed() && feed.getState() == Feed.STATE_SUBSCRIBED) {\n                     SynchronizationQueueSink.enqueueFeedAddedIfSynchronizationIsActive(context, feed.getDownloadUrl());\n                 }\n             }\n@@ -928,6 +930,32 @@ public static Future<?> setFeedCustomTitle(Feed feed) {\n         });\n     }\n \n+    public static Future<?> setFeedState(Context context, Feed feed, int newState) {\n+        int oldState = feed.getState();\n+        return runOnDbThread(() -> {\n+            PodDBAdapter adapter = PodDBAdapter.getInstance();\n+            adapter.open();\n+            adapter.setFeedState(feed.getId(), newState);\n+            feed.setState(newState);\n+            if (oldState == Feed.STATE_NOT_SUBSCRIBED && newState == Feed.STATE_SUBSCRIBED) {\n+                feed.getPreferences().setKeepUpdated(true);\n+                DBWriter.setFeedPreferences(feed.getPreferences());\n+                FeedUpdateManager.getInstance().runOnceOrAsk(context, feed);\n+                SynchronizationQueueSink.enqueueFeedAddedIfSynchronizationIsActive(context, feed.getDownloadUrl());\n+                DBReader.getFeedItemList(feed, FeedItemFilter.unfiltered(),\n+                        SortOrder.DATE_NEW_OLD, 0, Integer.MAX_VALUE);\n+                for (FeedItem item : feed.getItems()) {\n+                    if (item.isPlayed()) {\n+                        SynchronizationQueueSink.enqueueEpisodePlayedIfSynchronizationIsActive(\n+                                context, item.getMedia(), true);\n+                    }\n+                }\n+            }\n+            adapter.close();\n+            EventBus.getDefault().post(new FeedListUpdateEvent(feed));\n+        });\n+    }\n+\n     /**\n      * Sort the FeedItems in the queue with the given the named sort order.\n      *\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/FeedDatabaseWriter.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/FeedDatabaseWriter.java\nindex 7269fcd55f..a62e18809b 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/FeedDatabaseWriter.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/FeedDatabaseWriter.java\n@@ -157,7 +157,8 @@ public static synchronized Feed updateFeed(Context context, Feed newFeed, boolea\n                                         + \"\\n\\nNow the feed contains:\\n\" + duplicateEpisodeDetails(item)));\n                         oldItem.setItemIdentifier(item.getItemIdentifier());\n \n-                        if (oldItem.isPlayed() && oldItem.getMedia() != null) {\n+                        if (oldItem.isPlayed() && oldItem.getMedia() != null\n+                                && savedFeed.getState() == Feed.STATE_SUBSCRIBED) {\n                             EpisodeAction action = new EpisodeAction.Builder(oldItem, EpisodeAction.PLAY)\n                                     .currentTimestamp()\n                                     .started(oldItem.getMedia().getDuration() / 1000)\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/NonSubscribedFeedsCleaner.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/NonSubscribedFeedsCleaner.java\nnew file mode 100644\nindex 0000000000..47a5a5aeef\n--- /dev/null\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/NonSubscribedFeedsCleaner.java\n@@ -0,0 +1,46 @@\n+package de.danoeh.antennapod.storage.database;\n+\n+import android.content.Context;\n+import android.util.Log;\n+import de.danoeh.antennapod.model.feed.Feed;\n+import de.danoeh.antennapod.model.feed.FeedItem;\n+import de.danoeh.antennapod.model.feed.FeedItemFilter;\n+import de.danoeh.antennapod.model.feed.SortOrder;\n+\n+import java.util.List;\n+\n+public class NonSubscribedFeedsCleaner {\n+    private static final String TAG = \"NonSubscrFeedsCleaner\";\n+    private static final long TIME_TO_KEEP = 1000L * 3600 * 24 * 30; // 30 days\n+\n+    public static void deleteOldNonSubscribedFeeds(Context context) {\n+        List<Feed> feeds = DBReader.getFeedList();\n+        for (Feed feed : feeds) {\n+            if (feed.getState() != Feed.STATE_NOT_SUBSCRIBED) {\n+                continue;\n+            }\n+            DBReader.getFeedItemList(feed, FeedItemFilter.unfiltered(), SortOrder.DATE_NEW_OLD, 0, Integer.MAX_VALUE);\n+            if (shouldDelete(feed)) {\n+                Log.d(TAG, \"Deleting unsubscribed feed \" + feed.getTitle());\n+                DBWriter.deleteFeed(context, feed.getId());\n+            }\n+            feed.setItems(null); // Let it be garbage collected\n+        }\n+    }\n+\n+    public static boolean shouldDelete(Feed feed) {\n+        if (feed.getState() != Feed.STATE_NOT_SUBSCRIBED) {\n+            return false;\n+        } else if (feed.getItems() == null) {\n+            return false;\n+        }\n+        for (FeedItem item : feed.getItems()) {\n+            if (item.isTagged(FeedItem.TAG_FAVORITE)\n+                    || item.isTagged(FeedItem.TAG_QUEUE)\n+                    || item.isDownloaded()) {\n+                return false;\n+            }\n+        }\n+        return feed.getLastRefreshAttempt() < System.currentTimeMillis() - TIME_TO_KEEP;\n+    }\n+}\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\nindex 2cbf275090..aec136457d 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n@@ -52,7 +52,7 @@ public class PodDBAdapter {\n \n     private static final String TAG = \"PodDBAdapter\";\n     public static final String DATABASE_NAME = \"Antennapod.db\";\n-    public static final int VERSION = 3040000;\n+    public static final int VERSION = 3050000;\n \n     /**\n      * Maximum number of arguments for IN-operator.\n@@ -121,6 +121,7 @@ public class PodDBAdapter {\n     public static final String KEY_EPISODE_NOTIFICATION = \"episode_notification\";\n     public static final String KEY_NEW_EPISODES_ACTION = \"new_episodes_action\";\n     public static final String KEY_PODCASTINDEX_CHAPTER_URL = \"podcastindex_chapter_url\";\n+    public static final String KEY_STATE = \"state\";\n \n     // Table names\n     public static final String TABLE_NAME_FEEDS = \"Feeds\";\n@@ -171,6 +172,7 @@ public class PodDBAdapter {\n             + KEY_FEED_SKIP_INTRO + \" INTEGER DEFAULT 0,\"\n             + KEY_FEED_SKIP_ENDING + \" INTEGER DEFAULT 0,\"\n             + KEY_EPISODE_NOTIFICATION + \" INTEGER DEFAULT 0,\"\n+            + KEY_STATE + \" INTEGER DEFAULT \" + Feed.STATE_SUBSCRIBED + \",\"\n             + KEY_NEW_EPISODES_ACTION + \" INTEGER DEFAULT 0)\";\n \n     private static final String CREATE_TABLE_FEED_ITEMS = \"CREATE TABLE \"\n@@ -323,6 +325,7 @@ public class PodDBAdapter {\n             + TABLE_NAME_FEEDS + \".\" + KEY_FEED_SKIP_INTRO + \", \"\n             + TABLE_NAME_FEEDS + \".\" + KEY_FEED_SKIP_ENDING + \", \"\n             + TABLE_NAME_FEEDS + \".\" + KEY_EPISODE_NOTIFICATION + \", \"\n+            + TABLE_NAME_FEEDS + \".\" + KEY_STATE + \", \"\n             + TABLE_NAME_FEEDS + \".\" + KEY_NEW_EPISODES_ACTION;\n \n     private static final String JOIN_FEED_ITEM_AND_MEDIA = \" LEFT JOIN \" + TABLE_NAME_FEED_MEDIA\n@@ -337,6 +340,9 @@ public class PodDBAdapter {\n             \"SELECT \" + KEYS_FEED_ITEM_WITHOUT_DESCRIPTION + \", \" + KEYS_FEED_MEDIA\n             + \" FROM \" + TABLE_NAME_FEED_ITEMS\n             + JOIN_FEED_ITEM_AND_MEDIA;\n+    public static final String SELECT_WHERE_FEED_IS_SUBSCRIBED = TABLE_NAME_FEED_ITEMS + \".\" + KEY_FEED\n+            + \" IN (SELECT \" + KEY_ID + \" FROM \" + TABLE_NAME_FEEDS\n+            + \" WHERE \" + KEY_STATE + \"=\" + Feed.STATE_SUBSCRIBED + \")\";\n \n     private static Context context;\n     private static PodDBAdapter instance;\n@@ -431,6 +437,7 @@ private long setFeed(Feed feed) {\n         values.put(KEY_LASTUPDATE, feed.getLastModified());\n         values.put(KEY_TYPE, feed.getType());\n         values.put(KEY_FEED_IDENTIFIER, feed.getFeedIdentifier());\n+        values.put(KEY_STATE, feed.getState());\n \n         values.put(KEY_IS_PAGED, feed.isPaged());\n         values.put(KEY_NEXT_PAGE_LINK, feed.getNextPageLink());\n@@ -768,6 +775,12 @@ public void setFeedCustomTitle(long feedId, String customTitle) {\n         db.update(TABLE_NAME_FEEDS, values, KEY_ID + \"=?\", new String[]{String.valueOf(feedId)});\n     }\n \n+    public void setFeedState(long feedId, int state) {\n+        ContentValues values = new ContentValues();\n+        values.put(KEY_STATE, state);\n+        db.update(TABLE_NAME_FEEDS, values, KEY_ID + \"=?\", new String[]{String.valueOf(feedId)});\n+    }\n+\n     /**\n      * Inserts or updates a download status.\n      */\n@@ -1101,6 +1114,7 @@ public Cursor getRandomEpisodesCursor(int limit, int seed) {\n                     // Hide episodes that have been played but not completed\n                     + \" AND (\" + KEY_LAST_PLAYED_TIME + \" == 0\"\n                         + \" OR \" + KEY_LAST_PLAYED_TIME + \" > \" + (System.currentTimeMillis() - 1000L * 3600L) + \")\"\n+                    + \" AND \" + SELECT_WHERE_FEED_IS_SUBSCRIBED\n                 + \" ORDER BY \" + randomEpisodeNumber(seed);\n         final String query = \"SELECT * FROM (\" + allItemsRandomOrder + \")\"\n                 + \" GROUP BY \" + KEY_FEED\n@@ -1221,6 +1235,7 @@ public final Cursor getFeedStatisticsCursor(boolean includeMarkedAsPlayed, long\n                 + JOIN_FEED_ITEM_AND_MEDIA\n                 + \" INNER JOIN \" + TABLE_NAME_FEEDS\n                 + \" ON \" + TABLE_NAME_FEED_ITEMS + \".\" + KEY_FEED + \"=\" + TABLE_NAME_FEEDS + \".\" + KEY_ID\n+                + \" WHERE \" + TABLE_NAME_FEEDS + \".\" + KEY_STATE + \"=\" + Feed.STATE_SUBSCRIBED\n                 + \" GROUP BY \" + TABLE_NAME_FEEDS + \".\" + KEY_ID;\n         return db.rawQuery(query, null);\n     }\n@@ -1372,7 +1387,7 @@ public Cursor searchItems(long feedID, String searchQuery) {\n         }\n \n         String queryStart = SELECT_FEED_ITEMS_AND_MEDIA_WITH_DESCRIPTION\n-                + \" WHERE \" + queryFeedId + \" AND (\";\n+                + \" WHERE \" + queryFeedId + \" AND \" + SELECT_WHERE_FEED_IS_SUBSCRIBED + \" AND (\";\n         StringBuilder sb = new StringBuilder(queryStart);\n \n         for (int i = 0; i < queryWords.length; i++) {\n@@ -1401,12 +1416,13 @@ public Cursor searchItems(long feedID, String searchQuery) {\n     public Cursor searchFeeds(String searchQuery) {\n         String[] queryWords = prepareSearchQuery(searchQuery);\n \n-        String queryStart = \"SELECT \" + KEYS_FEED + \" FROM \" + TABLE_NAME_FEEDS + \" WHERE \";\n+        String queryStart = \"SELECT \" + KEYS_FEED + \" FROM \" + TABLE_NAME_FEEDS\n+                + \" WHERE \" + KEY_STATE + \" = \" + Feed.STATE_SUBSCRIBED;\n         StringBuilder sb = new StringBuilder(queryStart);\n \n         for (int i = 0; i < queryWords.length; i++) {\n             sb\n-                    .append(\"(\")\n+                    .append(\" AND (\")\n                     .append(KEY_TITLE).append(\" LIKE '%\").append(queryWords[i])\n                     .append(\"%' OR \")\n                     .append(KEY_CUSTOM_TITLE).append(\" LIKE '%\").append(queryWords[i])\n@@ -1415,13 +1431,9 @@ public Cursor searchFeeds(String searchQuery) {\n                     .append(\"%' OR \")\n                     .append(KEY_DESCRIPTION).append(\" LIKE '%\").append(queryWords[i])\n                     .append(\"%') \");\n-\n-            if (i != queryWords.length - 1) {\n-                sb.append(\"AND \");\n-            }\n         }\n \n-        sb.append(\"ORDER BY \" + KEY_TITLE + \" ASC LIMIT 300\");\n+        sb.append(\" ORDER BY \" + KEY_TITLE + \" ASC LIMIT 300\");\n \n         return db.rawQuery(sb.toString(), null);\n     }\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedCursor.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedCursor.java\nindex 2707275caa..3aba691063 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedCursor.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedCursor.java\n@@ -34,6 +34,7 @@ public class FeedCursor extends CursorWrapper {\n     private final int indexSortOrder;\n     private final int indexLastUpdateFailed;\n     private final int indexImageUrl;\n+    private final int indexState;\n \n     public FeedCursor(Cursor cursor) {\n         super(new FeedPreferencesCursor(cursor));\n@@ -58,6 +59,7 @@ public FeedCursor(Cursor cursor) {\n         indexSortOrder = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_SORT_ORDER);\n         indexLastUpdateFailed = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_LAST_UPDATE_FAILED);\n         indexImageUrl = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_IMAGE_URL);\n+        indexState = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_STATE);\n     }\n \n     /**\n@@ -85,7 +87,8 @@ public Feed getFeed() {\n                 getString(indexNextPageLink),\n                 getString(indexHide),\n                 SortOrder.fromCodeString(getString(indexSortOrder)),\n-                getInt(indexLastUpdateFailed) > 0);\n+                getInt(indexLastUpdateFailed) > 0,\n+                getInt(indexState));\n         feed.setPreferences(preferencesCursor.getFeedPreferences());\n         return feed;\n     }\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemFilterQuery.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemFilterQuery.java\nindex a4794d324d..481107cfac 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemFilterQuery.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemFilterQuery.java\n@@ -66,6 +66,9 @@ public static String generateFrom(FeedItemFilter filter) {\n         if (filter.showInHistory) {\n             statements.add(keyCompletionDate + \" > 0 \");\n         }\n+        if (!filter.includeNotSubscribed) {\n+            statements.add(PodDBAdapter.SELECT_WHERE_FEED_IS_SUBSCRIBED);\n+        }\n \n         if (statements.isEmpty()) {\n             return \"\";\ndiff --git a/storage/importexport/src/main/java/de/danoeh/antennapod/storage/importexport/HtmlWriter.java b/storage/importexport/src/main/java/de/danoeh/antennapod/storage/importexport/HtmlWriter.java\nindex 0b162fab0f..d259db43b1 100644\n--- a/storage/importexport/src/main/java/de/danoeh/antennapod/storage/importexport/HtmlWriter.java\n+++ b/storage/importexport/src/main/java/de/danoeh/antennapod/storage/importexport/HtmlWriter.java\n@@ -28,6 +28,9 @@ public static void writeDocument(List<Feed> feeds, Writer writer, Context contex\n \n         writer.append(templateParts[0]);\n         for (Feed feed : feeds) {\n+            if (feed.getState() != Feed.STATE_SUBSCRIBED) {\n+                continue;\n+            }\n             writer.append(\"<li><div><img src=\\\"\");\n             writer.append(feed.getImageUrl());\n             writer.append(\"\\\" /><p>\");\ndiff --git a/storage/importexport/src/main/java/de/danoeh/antennapod/storage/importexport/OpmlWriter.java b/storage/importexport/src/main/java/de/danoeh/antennapod/storage/importexport/OpmlWriter.java\nindex 9701476f95..d06932a5e4 100644\n--- a/storage/importexport/src/main/java/de/danoeh/antennapod/storage/importexport/OpmlWriter.java\n+++ b/storage/importexport/src/main/java/de/danoeh/antennapod/storage/importexport/OpmlWriter.java\n@@ -48,6 +48,9 @@ public static void writeDocument(List<Feed> feeds, Writer writer)\n \n         xs.startTag(null, OpmlSymbols.BODY);\n         for (Feed feed : feeds) {\n+            if (feed.getState() != Feed.STATE_SUBSCRIBED) {\n+                continue;\n+            }\n             xs.startTag(null, OpmlSymbols.OUTLINE);\n             xs.attribute(null, OpmlSymbols.TEXT, feed.getTitle());\n             xs.attribute(null, OpmlSymbols.TITLE, feed.getTitle());\ndiff --git a/ui/common/src/main/res/drawable/bg_message_info.xml b/ui/common/src/main/res/drawable/bg_message_info.xml\nnew file mode 100644\nindex 0000000000..6543066cfd\n--- /dev/null\n+++ b/ui/common/src/main/res/drawable/bg_message_info.xml\n@@ -0,0 +1,17 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<shape xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+       xmlns:aapt=\"http://schemas.android.com/aapt\">\n+    <stroke\n+        android:width=\"2dp\"\n+        android:color=\"?attr/colorPrimary\" />\n+\n+    <corners android:radius=\"8dp\" />\n+\n+    <solid>\n+        <aapt:attr name=\"android:color\" >\n+            <selector>\n+                <item android:alpha=\"0.1\" android:color=\"?attr/colorPrimary\" />\n+            </selector>\n+        </aapt:attr>\n+    </solid>\n+</shape>\n\\ No newline at end of file\ndiff --git a/ui/common/src/main/res/drawable/bg_rounded_corners.xml b/ui/common/src/main/res/drawable/bg_rounded_corners.xml\ndeleted file mode 100644\nindex 11b7710c40..0000000000\n--- a/ui/common/src/main/res/drawable/bg_rounded_corners.xml\n+++ /dev/null\n@@ -1,6 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"utf-8\"?>\n-<shape\n-    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n-    android:shape=\"rectangle\">\n-    <corners android:radius=\"8dp\" />\n-</shape>\ndiff --git a/ui/common/src/main/res/drawable/ic_close.xml b/ui/common/src/main/res/drawable/ic_close.xml\nnew file mode 100644\nindex 0000000000..ccba7f4a04\n--- /dev/null\n+++ b/ui/common/src/main/res/drawable/ic_close.xml\n@@ -0,0 +1,11 @@\n+<vector xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    android:width=\"24dp\"\n+    android:height=\"24dp\"\n+    android:viewportWidth=\"24\"\n+    android:viewportHeight=\"24\">\n+  <path\n+      android:pathData=\"M17.656,6.343L12,12M12,12L6.343,17.656M12,12L17.656,17.656M12,12L6.343,6.343\"\n+      android:strokeWidth=\"2\"\n+      android:fillColor=\"#00000000\"\n+      android:strokeColor=\"?attr/action_icon_color\"/>\n+</vector>\ndiff --git a/ui/common/src/main/res/values/colors.xml b/ui/common/src/main/res/values/colors.xml\nindex ad835faf47..55ba650e78 100644\n--- a/ui/common/src/main/res/values/colors.xml\n+++ b/ui/common/src/main/res/values/colors.xml\n@@ -8,7 +8,6 @@\n     <color name=\"medium_gray\">#afafaf</color>\n     <color name=\"black\">#000000</color>\n     <color name=\"image_readability_tint\">#80000000</color>\n-    <color name=\"feed_image_bg\">#50000000</color>\n     <color name=\"feed_text_bg\">#55333333</color>\n \n     <!-- Theme colors -->\ndiff --git a/ui/common/src/main/res/values/dimens.xml b/ui/common/src/main/res/values/dimens.xml\nindex 5cfcd68b62..82c2b14517 100644\n--- a/ui/common/src/main/res/values/dimens.xml\n+++ b/ui/common/src/main/res/values/dimens.xml\n@@ -7,8 +7,6 @@\n     <dimen name=\"text_size_large\">22sp</dimen>\n     <dimen name=\"thumbnail_length_itemlist\">56dp</dimen>\n     <dimen name=\"thumbnail_length_queue_item\">56dp</dimen>\n-    <dimen name=\"thumbnail_length_onlinefeedview\">92dp</dimen>\n-    <dimen name=\"feeditemlist_header_height\">132dp</dimen>\n     <dimen name=\"thumbnail_length_navlist\">40dp</dimen>\n     <dimen name=\"listitem_iconwithtext_height\">48dp</dimen>\n     <dimen name=\"listitem_iconwithtext_textleftpadding\">16dp</dimen>\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex a840a1abfe..f5ac3c3064 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -681,9 +681,8 @@\n \n     <!-- Online feed view -->\n     <string name=\"subscribe_label\">Subscribe</string>\n-    <string name=\"subscribing_label\">Subscribing&#8230;</string>\n-    <string name=\"preview_episode\">Preview</string>\n-    <string name=\"stop_preview\">Stop preview</string>\n+    <string name=\"preview_episodes\">Episodes preview</string>\n+    <string name=\"state_deleted_not_subscribed\">Playback state and history of non-subscribed podcasts are deleted after a while. Subscribe to keep them.</string>\n \n     <!-- Content descriptions for image buttons -->\n     <string name=\"toolbar_back_button_content_description\">Back</string>\n", "test_patch": "diff --git a/storage/database/src/test/java/de/danoeh/antennapod/storage/database/NonSubscribedFeedsCleanerTest.java b/storage/database/src/test/java/de/danoeh/antennapod/storage/database/NonSubscribedFeedsCleanerTest.java\nnew file mode 100644\nindex 0000000000..76bbfddc1a\n--- /dev/null\n+++ b/storage/database/src/test/java/de/danoeh/antennapod/storage/database/NonSubscribedFeedsCleanerTest.java\n@@ -0,0 +1,104 @@\n+package de.danoeh.antennapod.storage.database;\n+\n+import de.danoeh.antennapod.model.feed.Feed;\n+import de.danoeh.antennapod.model.feed.FeedItem;\n+import de.danoeh.antennapod.model.feed.FeedMedia;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.robolectric.RobolectricTestRunner;\n+\n+import java.util.ArrayList;\n+import java.util.Date;\n+import java.util.concurrent.TimeUnit;\n+\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertTrue;\n+\n+@RunWith(RobolectricTestRunner.class)\n+public class NonSubscribedFeedsCleanerTest {\n+\n+    @Test\n+    public void testSubscribed() {\n+        Feed feed = createFeed();\n+        feed.setLastRefreshAttempt(System.currentTimeMillis() - TimeUnit.MILLISECONDS.convert(200, TimeUnit.DAYS));\n+        assertFalse(NonSubscribedFeedsCleaner.shouldDelete(feed));\n+\n+        feed.setState(Feed.STATE_NOT_SUBSCRIBED);\n+        assertTrue(NonSubscribedFeedsCleaner.shouldDelete(feed));\n+    }\n+\n+    @Test\n+    public void testOldDate() {\n+        Feed feed = createFeed();\n+        feed.setState(Feed.STATE_NOT_SUBSCRIBED);\n+        feed.setLastRefreshAttempt(System.currentTimeMillis());\n+        assertFalse(NonSubscribedFeedsCleaner.shouldDelete(feed));\n+\n+        feed.setLastRefreshAttempt(System.currentTimeMillis() - TimeUnit.MILLISECONDS.convert(10, TimeUnit.DAYS));\n+        assertFalse(NonSubscribedFeedsCleaner.shouldDelete(feed));\n+\n+        feed.setLastRefreshAttempt(System.currentTimeMillis() - TimeUnit.MILLISECONDS.convert(200, TimeUnit.DAYS));\n+        assertTrue(NonSubscribedFeedsCleaner.shouldDelete(feed));\n+\n+        feed.setLastRefreshAttempt(System.currentTimeMillis() + TimeUnit.MILLISECONDS.convert(200, TimeUnit.DAYS));\n+        assertFalse(NonSubscribedFeedsCleaner.shouldDelete(feed));\n+    }\n+\n+    @Test\n+    public void testQueuedItem() {\n+        Feed feed = createFeed();\n+        feed.setState(Feed.STATE_NOT_SUBSCRIBED);\n+        feed.setLastRefreshAttempt(System.currentTimeMillis() - TimeUnit.MILLISECONDS.convert(200, TimeUnit.DAYS));\n+        feed.getItems().add(createItem(feed));\n+        assertTrue(NonSubscribedFeedsCleaner.shouldDelete(feed));\n+\n+        FeedItem queuedItem = createItem(feed);\n+        queuedItem.addTag(FeedItem.TAG_QUEUE);\n+        feed.getItems().add(queuedItem);\n+        assertFalse(NonSubscribedFeedsCleaner.shouldDelete(feed));\n+    }\n+\n+    @Test\n+    public void testFavoriteItem() {\n+        Feed feed = createFeed();\n+        feed.setState(Feed.STATE_NOT_SUBSCRIBED);\n+        feed.setLastRefreshAttempt(System.currentTimeMillis() - TimeUnit.MILLISECONDS.convert(200, TimeUnit.DAYS));\n+        feed.getItems().add(createItem(feed));\n+        assertTrue(NonSubscribedFeedsCleaner.shouldDelete(feed));\n+\n+        FeedItem queuedItem = createItem(feed);\n+        queuedItem.addTag(FeedItem.TAG_FAVORITE);\n+        feed.getItems().add(queuedItem);\n+        assertFalse(NonSubscribedFeedsCleaner.shouldDelete(feed));\n+    }\n+\n+    @Test\n+    public void testDownloadedItem() {\n+        Feed feed = createFeed();\n+        feed.setState(Feed.STATE_NOT_SUBSCRIBED);\n+        feed.setLastRefreshAttempt(System.currentTimeMillis() - TimeUnit.MILLISECONDS.convert(200, TimeUnit.DAYS));\n+        feed.getItems().add(createItem(feed));\n+        assertTrue(NonSubscribedFeedsCleaner.shouldDelete(feed));\n+\n+        FeedItem queuedItem = createItem(feed);\n+        queuedItem.getMedia().setDownloaded(true, System.currentTimeMillis());\n+        feed.getItems().add(queuedItem);\n+        assertFalse(NonSubscribedFeedsCleaner.shouldDelete(feed));\n+    }\n+\n+    private Feed createFeed() {\n+        Feed feed = new Feed(0, null, \"title\", \"http://example.com\", \"This is the description\",\n+                \"http://example.com/payment\", \"Daniel\", \"en\", null, \"http://example.com/feed\",\n+                \"http://example.com/image\", null, \"http://example.com/feed\", System.currentTimeMillis());\n+        feed.setItems(new ArrayList<>());\n+        return feed;\n+    }\n+\n+    private FeedItem createItem(Feed feed) {\n+        FeedItem item = new FeedItem(0, \"Item\", \"ItemId\", \"url\", new Date(), FeedItem.PLAYED, feed);\n+        FeedMedia media = new FeedMedia(item, \"http://download.url.net/\", 1234567, \"audio/mpeg\");\n+        media.setId(item.getId());\n+        item.setMedia(media);\n+        return item;\n+    }\n+}\n", "problem_statement": "Add/play single episode without subscribing to podcast\n# Checklist\r\n<!-- Place an x in the boxes to tick them: [x] -->\r\n\r\n- [x] I have used the search function to see if someone else has already submitted the same feature request.\r\n- [x] I will only create one feature request per issue.\r\n- [x] I will describe the problem with as much detail as possible.\r\n\r\n# System info\r\n\r\n**App version**: 2.0.3\r\n\r\n**App source**:  F-Droid\r\n\r\n# Feature description\r\n\r\n**Problem you may be having, or feature you want**:\r\n\r\nAfter recommending AntennaPod to a friend, the friend is really happy with the application and use it to listen to regular podcast shows, some of them in auto-download, some of them cherry picking the episodes according to the description and title. \r\n\r\nI recommend a particular episode of a podcast I enjoy, which she doesn't follow, she says \"great, I'll listen to it, but not right now, I'll add it to AntennaPod\", but then she had the following reaction \"Hey, why can't I add a single episode without having to subscribe to the whole podcast ?\". And I thought this would be a nice feature in AntennaPod : not having to subscribe to a podcast which you won't follow or have to unsubscribe to later, and benefit from the \"Queue\" feature that enables one to \"Listen later\" to a single episode. \r\n\r\n\r\n**Suggested solution**:\r\n\r\nIn the podcast \"Subscribe\" menu, when the user clicks on an episode there is a \"Preview\" link which is useful to listen to it straight away, there could be an other link / button with \"Download to listen later (without subscribing)\".  \r\n\r\n**Screenshots / Drawings / Technical details**:\r\n<!-- If your request is about (or includes) changing or extending the UI, describe what the UI would look like and how the user would interact with it. -->\r\n\r\n![Screenshot_20201123-094806](https://user-images.githubusercontent.com/108437/99943362-773d6a00-2d71-11eb-8b53-e739c724e6e6.png)\r\n\r\n\n", "hints_text": "I suggest we don't work on this.    Without subscribing to a podcast, it's difficult to manage that 'dangling' episode in the app without the data structures behind the 'parent', which is the podcast. \r\n\r\nFor example: for the episode that you download, we have to deal with the 'Open Podcast' menu because it has no where to go.\r\n\r\nI suggest you 'share the episode' with your friend so they can use their email as a bookmarking feature\nNow that support for virtual podcast from local folder is going to become possible maybe it could be used to allow this : \r\n- create a preview folder if it doesn't already exist and add it as a virtual podcast\r\n- download the episode and put it in the preview local folder\r\n\r\nLocal folder for this would really be handy and I think could remove a lot of problem which were making this hard to do?\nWhile that would work, it's not really good UX. Users could then not press the \"open podcast\" button to hear more from the same publishers. Also, deleting the downloaded file would also delete the listening status. In general, to store listening status, we always need the feed as well. I don't think we should add this as a half-working feature. (the reason why we can not really store state of individual episodes without a subscription is that AntennaPod is decentralized without a server that knows all episodes of all podcasts. You can read more about that on the forum: https://forum.antennapod.org/t/newbie-questions/84/2)\r\n\r\nThe easiest option is (as @tonytamsf wrote) to share the link to the episode file. In AntennaPod 2.1, you can add the downloads folder as a \"virtual\" podcast to have it directly in AntennaPod.\r\n\r\n---\r\n\r\nWhy don't you just subscribe to the podcast and unsubscribe again when no longer interested? The number of clicks to delete a whole subscription is not much higher than the number of clicks to delete a download.\nYou can also just preview an episode without subscribing to it.\r\nI vote that we close this issue @keunes ?\nTo be honest I find the use-case very relevant: it would be great if you could share a particular episode with a friend who could listen to it at a later point. Indeed temporarily subscribing is a workaround, but it doesn't feel great as a user (you have to remember to delete the feed afterwards, a cognitive burden).\n\nI realise it's currently technically hardly possible to cater for this use-case elegantly, but I would opt to keep this feature request open.\nAnother idea to manage this :  \r\n- wait for group folders to be implemented\r\n- have a \"no subscription\" folder\r\n- let user download episode without subscribing (instead of previewing) and add it to the queue\r\n- behind the scenes subscribe to podcast, put it in \"no subscription\" folder\r\n- make \"no subscription\" folder and podcasts in it invisible to user\r\n- remove invisible subscriptions if there is no longer any related episodes in queue or in favorites\r\n- like for normal subscriptions user can go to podcast screen from episode or player. When viewing podcast screen a subscribe button should be added so user can permanently subscribe. (Doing so, move subscription outside of \"no subscription\" folder)\r\n\r\nPros : \r\n- user can access to podcast normally from player or from episodes (but he won't be able to see it in subscriptions in lateral menu or in subscriptions screen)\r\n- all information from podcast is available and accessible to AntennaPod like any other podcast\r\n- It becomes easy for user to permanently subscribe\r\n- apart from invisible group folder everything is the same\r\n\r\nCons : \r\nI fear that it could be complicated to manage an invisible folder group \u2639\ufe0f\n@keunes thanks for this user centric approach. There is no rush for this feature. \n> behind the scenes subscribe to podcast, put it in \"no subscription\" folder\r\n\r\nYeah, I think that is the only good option we have. Would mean a lot of work, though (hide in episodes list, etc). Also, what happens if someone goes to the podcast page and downloads another episode of that podcast without subscribing? Do we delete the subscription only when no episode is marked as favorite? This feature sounds like it could lead to pretty big discussions about the behavior and quite a lot of confused users\nYes removing podcast should only happen when there is no more downloaded episode or episode in favorites.\r\nReally all would be like any other podcasts for the user except he wouldn't be able to see it in subscriptions screen or in subscriptions list. As all others interaction will be exactly the same I don't think it will cause any confusion.\n> what happens if someone goes to the podcast page and downloads another episode of that podcast without subscribing?\r\n\r\nEither nothing special (episode gets added, nothing else changes), or - probably better - a dialog is shown saying that they're currently not subscribed and adding more episodes is not possible, offering to 'subscribe' (i.e. remove the 'not subscribed' tag).\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/is-there-a-way-to-download-podcasts-from-within-antennapod-without-subscribing/456/2\n\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/ability-to-download-queue-episodes-from-non-subscribed-podcast/691/2\n\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/downloading-just-one-episode-of-a-podcast/153/7\n\nPlay store review in favour of this:\r\n\r\n[1](https://play.google.com/apps/publish?account=8008695526664634386#ReviewDetailsPlace:p=de.danoeh.antennapod&reviewid=gp:AOqpTOGmhirt-hw7-qwI6tNJ-UCLP3d0MMM8W7-bFNLP9wkA0PU6WGseoG-KnDQkuGGn7FZBKFarZr8PF0kaQvY)\r\n\r\n> Browsing through podcasts that you have not yet subscribed to is very cumbersome. You would first have to subscribe to a podcast in order to watch the episodes normally and listen to them normally without this strange \"rehearsal\". Pictures / logos of the podcasts are only displayed if you have subscribed. So not to be used for me. 2 stars because it is open source..\r\n\r\n[2](https://play.google.com/apps/publish?account=8008695526664634386#ReviewDetailsPlace:p=de.danoeh.antennapod&reviewid=gp:AOqpTOEcI_r2mtnsYsffAapPd9oNJx5s0vh4wdcoJszMUOhk1uYNjAYvfIPG2W1-NZwy_8iexwvaropY2JTEt4s)\r\n\r\n> If I search for a podcast I see a list of the episodes but it won't let me sample one it seems like I have to subscribe first that doesn't work for me.\r\n\r\n[3](https://play.google.com/apps/publish?account=8008695526664634386#ReviewDetailsPlace:p=de.danoeh.antennapod&reviewid=5fdaaa83-a0ec-492f-9e1a-e0a40183bec2)\r\n\r\n> Would be nice to have backups via Google account and single episode download without subbing, but otherwise really nice..\r\n\r\n[4](https://play.google.com/apps/publish?account=8008695526664634386#ReviewDetailsPlace:p=de.danoeh.antennapod&reviewid=fc78c156-b31b-4b81-bacb-ad276556336b)\r\n\r\n> Could be perfect but missing a crucial feature; download episode(s) without having to subscribe to the whole podcast first...So annoying, why??.\r\n\r\n[5](https://play.google.com/console/u/0/developers/8008695526664634386/app/4974638472012894302/user-feedback/review-details?reviewId=e5c79032-84ea-468d-b282-229a15264c0b&corpus=PUBLIC_REVIEWS)\r\n\r\n> Good podcast app. Only issue is that it's unclear how to listen to podcasts that I'm not subscribed to.\r\n\r\n[6](https://play.google.com/console/u/0/developers/8008695526664634386/app/4974638472012894302/user-feedback/review-details?reviewId=17fdf663-5922-451d-b74a-e019431e7082&corpus=PUBLIC_REVIEWS)\r\n> I switched over to find a replacement for Google podcasts. tried several apps this one seems the most intuitive for Google Podcast users. I wish the queue was a little more prominent and I am still confused about how to download single episodes when not subscribed to a podcast. glad to have a new podcast player.\nI really think that the only thing needed is triggering an invisible subscription for the user when he is adding an episode.\r\n\r\nPodcast wouldn't show in subscriptions list but could be accessed through added episodes.\r\nUnsubscribing should be automatic when there is no more episode in queue or starred / in favorites.\r\n\r\n-> this way there would be minimum difference for AntennaPod and for user it would be as if subscribing for only an episode is not necessary\r\n\n**Requested in #5643: ability to open a specific episode when it is shared (especially between AntennaPod users). Possible solutions are discussed there. Ideally support for this is implemented together with this issue.**\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/add-episode-from-podcasts-without-subscribing/1271/4\n\nI recently started using this app and came across this issue, but I found a decent work-around. It is possible to subscribe to a podcast, download a single episode, and turn auto-refreshing off in the settings. I think that's good enough and similar to what other podcast applications do, what do you think of adding a shortcut for doing this?\nYeah, I think that's what the solution for this issue will look like. Internally, subscribe to it normally but disable auto-refreshing and put it in a folder called \"not subscribed\".\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/user-must-be-able-to-listen-to-the-podcast-without-subscribing/1853/2\n", "created_at": "2024-04-14T15:01:06Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7096, "instance_id": "AntennaPod__AntennaPod-7096", "issue_numbers": ["4795"], "base_commit": "e9b3cc34fe211ab3b03c30c6c483078b99ba7561", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/AutomaticDeletionPreferencesFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/AutomaticDeletionPreferencesFragment.java\nnew file mode 100644\nindex 0000000000..8c7608b6bc\n--- /dev/null\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/AutomaticDeletionPreferencesFragment.java\n@@ -0,0 +1,96 @@\n+package de.danoeh.antennapod.ui.screen.preferences;\n+\n+import android.content.res.Resources;\n+import android.os.Bundle;\n+import androidx.preference.ListPreference;\n+import androidx.preference.PreferenceFragmentCompat;\n+import androidx.preference.TwoStatePreference;\n+import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n+import de.danoeh.antennapod.R;\n+import de.danoeh.antennapod.storage.preferences.UserPreferences;\n+\n+\n+public class AutomaticDeletionPreferencesFragment extends PreferenceFragmentCompat {\n+    private static final String PREF_AUTO_DELETE_LOCAL = \"prefAutoDeleteLocal\";\n+    private boolean blockAutoDeleteLocal = true;\n+\n+    @Override\n+    public void onCreatePreferences(Bundle savedInstanceState, String rootKey) {\n+        addPreferencesFromResource(R.xml.preferences_auto_deletion);\n+        setupScreen();\n+        buildEpisodeCleanupPreference();\n+        checkItemVisibility(UserPreferences.isAutoDelete());\n+    }\n+\n+    @Override\n+    public void onStart() {\n+        super.onStart();\n+        ((PreferenceActivity) getActivity()).getSupportActionBar().setTitle(R.string.pref_auto_delete_title);\n+    }\n+\n+    private void checkItemVisibility(boolean autoDeleteEnabled) {\n+        findPreference(UserPreferences.PREF_FAVORITE_KEEPS_EPISODE).setEnabled(autoDeleteEnabled);\n+        findPreference(PREF_AUTO_DELETE_LOCAL).setEnabled(autoDeleteEnabled);\n+    }\n+\n+    private void setupScreen() {\n+        if (!UserPreferences.isEnableAutodownload()) {\n+            findPreference(UserPreferences.PREF_EPISODE_CLEANUP).setEnabled(false);\n+            findPreference(UserPreferences.PREF_EPISODE_CLEANUP).setSummary(R.string.auto_download_disabled_globally);\n+        }\n+        findPreference(PREF_AUTO_DELETE_LOCAL).setOnPreferenceChangeListener((preference, newValue) -> {\n+            if (blockAutoDeleteLocal && newValue == Boolean.TRUE) {\n+                showAutoDeleteEnableDialog();\n+                return false;\n+            } else {\n+                return true;\n+            }\n+        });\n+        findPreference(UserPreferences.PREF_AUTO_DELETE).setOnPreferenceChangeListener((preference, newValue) -> {\n+            if (newValue instanceof Boolean) {\n+                checkItemVisibility((Boolean) newValue);\n+            }\n+            return true;\n+        });\n+    }\n+\n+    private void showAutoDeleteEnableDialog() {\n+        new MaterialAlertDialogBuilder(requireContext())\n+                .setMessage(R.string.pref_auto_local_delete_dialog_body)\n+                .setPositiveButton(R.string.yes, (dialog, which) -> {\n+                    blockAutoDeleteLocal = false;\n+                    ((TwoStatePreference) findPreference(PREF_AUTO_DELETE_LOCAL)).setChecked(true);\n+                    blockAutoDeleteLocal = true;\n+                })\n+                .setNegativeButton(R.string.cancel_label, null)\n+                .show();\n+    }\n+\n+\n+    private void buildEpisodeCleanupPreference() {\n+        final Resources res = getActivity().getResources();\n+\n+        ListPreference pref = findPreference(UserPreferences.PREF_EPISODE_CLEANUP);\n+        String[] values = res.getStringArray(\n+                de.danoeh.antennapod.ui.preferences.R.array.episode_cleanup_values);\n+        String[] entries = new String[values.length];\n+        for (int x = 0; x < values.length; x++) {\n+            int v = Integer.parseInt(values[x]);\n+            if (v == UserPreferences.EPISODE_CLEANUP_EXCEPT_FAVORITE) {\n+                entries[x] =  res.getString(R.string.episode_cleanup_except_favorite_removal);\n+            } else if (v == UserPreferences.EPISODE_CLEANUP_QUEUE) {\n+                entries[x] = res.getString(R.string.episode_cleanup_queue_removal);\n+            } else if (v == UserPreferences.EPISODE_CLEANUP_NULL) {\n+                entries[x] = res.getString(R.string.episode_cleanup_never);\n+            } else if (v == 0) {\n+                entries[x] = res.getString(R.string.episode_cleanup_after_listening);\n+            } else if (v > 0 && v < 24) {\n+                entries[x] = res.getQuantityString(R.plurals.episode_cleanup_hours_after_listening, v, v);\n+            } else {\n+                int numDays = v / 24; // assume underlying value will be NOT fraction of days, e.g., 36 (hours)\n+                entries[x] = res.getQuantityString(R.plurals.episode_cleanup_days_after_listening, numDays, numDays);\n+            }\n+        }\n+        pref.setEntries(entries);\n+    }\n+}\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/DownloadsPreferencesFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/DownloadsPreferencesFragment.java\nindex fad8c69868..3af3a0248e 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/DownloadsPreferencesFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/DownloadsPreferencesFragment.java\n@@ -2,16 +2,12 @@\n \n import android.content.SharedPreferences;\n import android.os.Bundle;\n-\n import androidx.preference.PreferenceFragmentCompat;\n import androidx.preference.PreferenceManager;\n-import androidx.preference.TwoStatePreference;\n-\n-import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.net.download.serviceinterface.FeedUpdateManager;\n-import de.danoeh.antennapod.ui.preferences.screen.downloads.ChooseDataFolderDialog;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n+import de.danoeh.antennapod.ui.preferences.screen.downloads.ChooseDataFolderDialog;\n \n import java.io.File;\n \n@@ -19,12 +15,10 @@\n public class DownloadsPreferencesFragment extends PreferenceFragmentCompat\n         implements SharedPreferences.OnSharedPreferenceChangeListener {\n     private static final String PREF_SCREEN_AUTODL = \"prefAutoDownloadSettings\";\n-    private static final String PREF_AUTO_DELETE_LOCAL = \"prefAutoDeleteLocal\";\n+    private static final String PREF_SCREEN_AUTO_DELETE = \"prefAutoDeleteScreen\";\n     private static final String PREF_PROXY = \"prefProxy\";\n     private static final String PREF_CHOOSE_DATA_DIR = \"prefChooseDataDir\";\n \n-    private boolean blockAutoDeleteLocal = true;\n-\n     @Override\n     public void onCreatePreferences(Bundle savedInstanceState, String rootKey) {\n         addPreferencesFromResource(R.xml.preferences_downloads);\n@@ -55,6 +49,10 @@ private void setupNetworkScreen() {\n             ((PreferenceActivity) getActivity()).openScreen(R.xml.preferences_autodownload);\n             return true;\n         });\n+        findPreference(PREF_SCREEN_AUTO_DELETE).setOnPreferenceClickListener(preference -> {\n+            ((PreferenceActivity) getActivity()).openScreen(R.xml.preferences_auto_deletion);\n+            return true;\n+        });\n         // validate and set correct value: number of downloads between 1 and 50 (inclusive)\n         findPreference(PREF_PROXY).setOnPreferenceClickListener(preference -> {\n             ProxyDialog dialog = new ProxyDialog(getActivity());\n@@ -68,14 +66,6 @@ private void setupNetworkScreen() {\n             });\n             return true;\n         });\n-        findPreference(PREF_AUTO_DELETE_LOCAL).setOnPreferenceChangeListener((preference, newValue) -> {\n-            if (blockAutoDeleteLocal && newValue == Boolean.TRUE) {\n-                showAutoDeleteEnableDialog();\n-                return false;\n-            } else {\n-                return true;\n-            }\n-        });\n     }\n \n     private void setDataFolderText() {\n@@ -91,16 +81,4 @@ public void onSharedPreferenceChanged(SharedPreferences sharedPreferences, Strin\n             FeedUpdateManager.getInstance().restartUpdateAlarm(getContext(), true);\n         }\n     }\n-\n-    private void showAutoDeleteEnableDialog() {\n-        new MaterialAlertDialogBuilder(requireContext())\n-                .setMessage(R.string.pref_auto_local_delete_dialog_body)\n-                .setPositiveButton(R.string.yes, (dialog, which) -> {\n-                    blockAutoDeleteLocal = false;\n-                    ((TwoStatePreference) findPreference(PREF_AUTO_DELETE_LOCAL)).setChecked(true);\n-                    blockAutoDeleteLocal = true;\n-                })\n-                .setNegativeButton(R.string.cancel_label, null)\n-                .show();\n-    }\n }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/PreferenceActivity.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/PreferenceActivity.java\nindex e82c2c0843..b083bda5db 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/PreferenceActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/PreferenceActivity.java\n@@ -83,6 +83,8 @@ private PreferenceFragmentCompat getPreferenceScreen(int screen) {\n             prefFragment = new NotificationPreferencesFragment();\n         } else if (screen == R.xml.preferences_swipe) {\n             prefFragment = new SwipePreferencesFragment();\n+        } else if (screen == R.xml.preferences_auto_deletion) {\n+            prefFragment = new AutomaticDeletionPreferencesFragment();\n         }\n         return prefFragment;\n     }\n@@ -106,6 +108,8 @@ public static int getTitleOfPage(int preferences) {\n             return R.string.feed_settings_label;\n         } else if (preferences == R.xml.preferences_swipe) {\n             return R.string.swipeactions_label;\n+        } else if (preferences == R.xml.preferences_auto_deletion) {\n+            return R.string.pref_auto_delete_title;\n         }\n         return R.string.settings_label;\n     }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/FeedMultiSelectActionHandler.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/FeedMultiSelectActionHandler.java\nindex f2c89f12fd..7f2d96ed4e 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/FeedMultiSelectActionHandler.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/FeedMultiSelectActionHandler.java\n@@ -96,7 +96,7 @@ private void playbackSpeedPrefHandler() {\n \n     private void autoDeleteEpisodesPrefHandler() {\n         PreferenceListDialog preferenceListDialog = new PreferenceListDialog(activity,\n-                activity.getString(R.string.auto_delete_label));\n+                activity.getString(R.string.pref_auto_delete_playback_title));\n         String[] items = activity.getResources().getStringArray(R.array.spnAutoDeleteItems);\n         preferenceListDialog.openDialog(items);\n         preferenceListDialog.setOnPreferenceChangedListener(which -> {\ndiff --git a/app/src/main/res/menu/nav_feed_action_speeddial.xml b/app/src/main/res/menu/nav_feed_action_speeddial.xml\nindex 250d12bc2a..ce2453ab60 100644\n--- a/app/src/main/res/menu/nav_feed_action_speeddial.xml\n+++ b/app/src/main/res/menu/nav_feed_action_speeddial.xml\n@@ -23,7 +23,7 @@\n     <item\n         android:id=\"@+id/autoDeleteDownload\"\n         android:menuCategory=\"container\"\n-        android:title=\"@string/auto_delete_label\"\n+        android:title=\"@string/pref_auto_delete_playback_title\"\n         android:icon=\"@drawable/ic_delete_auto\"/>\n     <item\n         android:id=\"@+id/playback_speed\"\ndiff --git a/app/src/main/res/xml/feed_settings.xml b/app/src/main/res/xml/feed_settings.xml\nindex 11e7132a59..6425baff74 100644\n--- a/app/src/main/res/xml/feed_settings.xml\n+++ b/app/src/main/res/xml/feed_settings.xml\n@@ -46,7 +46,7 @@\n         android:icon=\"@drawable/ic_delete\"\n         android:key=\"autoDelete\"\n         android:summary=\"@string/global_default\"\n-        android:title=\"@string/auto_delete_label\" />\n+        android:title=\"@string/pref_auto_delete_playback_title\" />\n \n     <de.danoeh.antennapod.ui.screen.feed.preferences.VolumeAdaptationPreference\n         android:defaultValue=\"off\"\ndiff --git a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\nindex 9e7333a2ec..f68fa77a71 100644\n--- a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n+++ b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n@@ -80,8 +80,8 @@ public abstract class UserPreferences {\n     public static final String PREF_HARDWARE_PREVIOUS_BUTTON = \"prefHardwarePreviousButton\";\n     public static final String PREF_FOLLOW_QUEUE = \"prefFollowQueue\";\n     public static final String PREF_SKIP_KEEPS_EPISODE = \"prefSkipKeepsEpisode\";\n-    private static final String PREF_FAVORITE_KEEPS_EPISODE = \"prefFavoriteKeepsEpisode\";\n-    private static final String PREF_AUTO_DELETE = \"prefAutoDelete\";\n+    public static final String PREF_FAVORITE_KEEPS_EPISODE = \"prefFavoriteKeepsEpisode\";\n+    public static final String PREF_AUTO_DELETE = \"prefAutoDelete\";\n     private static final String PREF_AUTO_DELETE_LOCAL = \"prefAutoDeleteLocal\";\n     public static final String PREF_SMART_MARK_AS_PLAYED_SECS = \"prefSmartMarkAsPlayedSecs\";\n     private static final String PREF_PLAYBACK_SPEED_ARRAY = \"prefPlaybackSpeedArray\";\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 6a42387799..11acdf6766 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -127,7 +127,6 @@\n     <string name=\"close_label\">Close</string>\n     <string name=\"retry_label\">Retry</string>\n     <string name=\"auto_download_label\">Include in auto downloads</string>\n-    <string name=\"auto_delete_label\">Auto delete episode</string>\n     <string name=\"feed_volume_adapdation\">Volume adaptation</string>\n     <string name=\"feed_volume_adaptation_summary\">Turn volume for episodes of this podcast up or down: %1$s</string>\n     <string name=\"feed_volume_reduction_off\">No adaption</string>\n@@ -385,7 +384,7 @@\n     <string name=\"preference_search_hint\">Search\u2026</string>\n     <string name=\"preference_search_no_results\">No results</string>\n     <string name=\"preference_search_clear_history\">Clear history</string>\n-    <string name=\"pref_episode_cleanup_title\">Episode cleanup</string>\n+    <string name=\"pref_episode_cleanup_title\">Delete before auto download</string>\n     <string name=\"pref_episode_cleanup_summary\">Episodes that should be eligible for removal if Auto Download needs space for new episodes</string>\n     <string name=\"pref_pauseOnDisconnect_sum\">Pause playback when headphones or bluetooth are disconnected</string>\n     <string name=\"pref_unpauseOnHeadsetReconnect_sum\">Resume playback when the headphones are reconnected</string>\n@@ -399,8 +398,10 @@\n     <string name=\"button_action_skip_episode\">Skip episode</string>\n     <string name=\"button_action_restart_episode\">Restart episode</string>\n     <string name=\"pref_followQueue_sum\">Jump to next queue item when playback completes</string>\n-    <string name=\"pref_auto_delete_sum\">Delete episode when playback completes</string>\n-    <string name=\"pref_auto_delete_title\">Auto delete</string>\n+    <string name=\"pref_auto_delete_playback_sum\">Delete episode when playback completes</string>\n+    <string name=\"pref_auto_delete_playback_title\">Delete after playing</string>\n+    <string name=\"pref_auto_delete_title\">Automatic deletion</string>\n+    <string name=\"pref_auto_delete_sum\">Delete episodes after playing or when automatic download needs space</string>\n     <string name=\"pref_auto_local_delete_title\">Auto delete from local folders</string>\n     <string name=\"pref_auto_local_delete_sum\">Include local folders in Auto delete functionality</string>\n     <string name=\"pref_auto_local_delete_dialog_body\">Note that for local folders this will remove episodes from AntennaPod and delete their media files from your device storage. They cannot be downloaded again through AntennaPod. Enable auto delete?</string>\n@@ -455,8 +456,8 @@\n     <string name=\"pref_autodl_wifi_filter_sum\">Allow automatic download only for selected Wi-Fi networks.</string>\n     <string name=\"pref_automatic_download_on_battery_title\">Download when not charging</string>\n     <string name=\"pref_automatic_download_on_battery_sum\">Allow automatic download when the battery is not charging</string>\n-    <string name=\"pref_episode_cache_title\">Episode cache</string>\n-    <string name=\"pref_episode_cache_summary\">Total number of downloaded episodes cached on the device. Automatic download will be suspended if this number is reached.</string>\n+    <string name=\"pref_episode_cache_title\">Episode limit</string>\n+    <string name=\"pref_episode_cache_summary\">Automatic download is stopped if this number is reached</string>\n     <string name=\"pref_episode_cover_title\">Use episode cover</string>\n     <string name=\"pref_episode_cover_summary\">Use the episode specific cover in lists whenever available. If unchecked, the app will always use the podcast cover image.</string>\n     <string name=\"pref_show_remain_time_title\">Show remaining time</string>\ndiff --git a/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/AutoDownloadPreferencesFragment.java b/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/AutoDownloadPreferencesFragment.java\nindex 7c0c3ed4c7..1f0fbfbebe 100644\n--- a/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/AutoDownloadPreferencesFragment.java\n+++ b/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/AutoDownloadPreferencesFragment.java\n@@ -3,7 +3,6 @@\n import android.annotation.SuppressLint;\n import android.app.Activity;\n import android.content.Context;\n-import android.content.res.Resources;\n import android.net.wifi.WifiConfiguration;\n import android.net.wifi.WifiManager;\n import android.os.Build;\n@@ -11,7 +10,6 @@\n import android.util.Log;\n import androidx.appcompat.app.AppCompatActivity;\n import androidx.preference.CheckBoxPreference;\n-import androidx.preference.ListPreference;\n import androidx.preference.Preference;\n import androidx.preference.PreferenceFragmentCompat;\n import androidx.preference.PreferenceScreen;\n@@ -35,7 +33,6 @@ public void onCreatePreferences(Bundle savedInstanceState, String rootKey) {\n         setupAutoDownloadScreen();\n         buildAutodownloadSelectedNetworksPreference();\n         setSelectedNetworksEnabled(UserPreferences.isEnableAutodownloadWifiFilter());\n-        buildEpisodeCleanupPreference();\n     }\n \n     @Override\n@@ -78,7 +75,6 @@ private void checkAutodownloadItemVisibility(boolean autoDownload) {\n         findPreference(UserPreferences.PREF_EPISODE_CACHE_SIZE).setEnabled(autoDownload);\n         findPreference(UserPreferences.PREF_ENABLE_AUTODL_ON_BATTERY).setEnabled(autoDownload);\n         findPreference(UserPreferences.PREF_ENABLE_AUTODL_WIFI_FILTER).setEnabled(autoDownload);\n-        findPreference(UserPreferences.PREF_EPISODE_CLEANUP).setEnabled(autoDownload);\n         setSelectedNetworksEnabled(autoDownload && UserPreferences.isEnableAutodownloadWifiFilter());\n     }\n \n@@ -165,33 +161,6 @@ private void clearAutodownloadSelectedNetworsPreference() {\n         }\n     }\n \n-    private void buildEpisodeCleanupPreference() {\n-        final Resources res = getActivity().getResources();\n-\n-        ListPreference pref = findPreference(UserPreferences.PREF_EPISODE_CLEANUP);\n-        String[] values = res.getStringArray(\n-                R.array.episode_cleanup_values);\n-        String[] entries = new String[values.length];\n-        for (int x = 0; x < values.length; x++) {\n-            int v = Integer.parseInt(values[x]);\n-            if (v == UserPreferences.EPISODE_CLEANUP_EXCEPT_FAVORITE) {\n-                entries[x] =  res.getString(R.string.episode_cleanup_except_favorite_removal);\n-            } else if (v == UserPreferences.EPISODE_CLEANUP_QUEUE) {\n-                entries[x] = res.getString(R.string.episode_cleanup_queue_removal);\n-            } else if (v == UserPreferences.EPISODE_CLEANUP_NULL){\n-                entries[x] = res.getString(R.string.episode_cleanup_never);\n-            } else if (v == 0) {\n-                entries[x] = res.getString(R.string.episode_cleanup_after_listening);\n-            } else if (v > 0 && v < 24) {\n-                entries[x] = res.getQuantityString(R.plurals.episode_cleanup_hours_after_listening, v, v);\n-            } else {\n-                int numDays = v / 24; // assume underlying value will be NOT fraction of days, e.g., 36 (hours)\n-                entries[x] = res.getQuantityString(R.plurals.episode_cleanup_days_after_listening, numDays, numDays);\n-            }\n-        }\n-        pref.setEntries(entries);\n-    }\n-\n     private void setSelectedNetworksEnabled(boolean b) {\n         if (selectedNetworks != null) {\n             for (Preference p : selectedNetworks) {\ndiff --git a/ui/preferences/src/main/res/xml/preferences_auto_deletion.xml b/ui/preferences/src/main/res/xml/preferences_auto_deletion.xml\nnew file mode 100644\nindex 0000000000..057ce55174\n--- /dev/null\n+++ b/ui/preferences/src/main/res/xml/preferences_auto_deletion.xml\n@@ -0,0 +1,31 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<PreferenceScreen\n+        xmlns:android=\"http://schemas.android.com/apk/res/android\">\n+\n+    <SwitchPreferenceCompat\n+        android:defaultValue=\"false\"\n+        android:enabled=\"true\"\n+        android:key=\"prefAutoDelete\"\n+        android:summary=\"@string/pref_auto_delete_playback_sum\"\n+        android:title=\"@string/pref_auto_delete_playback_title\"/>\n+    <SwitchPreferenceCompat\n+        android:defaultValue=\"false\"\n+        android:enabled=\"true\"\n+        android:key=\"prefAutoDeleteLocal\"\n+        android:summary=\"@string/pref_auto_local_delete_sum\"\n+        android:title=\"@string/pref_auto_local_delete_title\"/>\n+    <SwitchPreferenceCompat\n+        android:defaultValue=\"true\"\n+        android:enabled=\"true\"\n+        android:key=\"prefFavoriteKeepsEpisode\"\n+        android:summary=\"@string/pref_favorite_keeps_episodes_sum\"\n+        android:title=\"@string/pref_favorite_keeps_episodes_title\"/>\n+    <de.danoeh.antennapod.ui.preferences.preference.MaterialListPreference\n+        android:defaultValue=\"-1\"\n+        android:entries=\"@array/episode_cleanup_entries\"\n+        android:key=\"prefEpisodeCleanup\"\n+        android:title=\"@string/pref_episode_cleanup_title\"\n+        android:summary=\"@string/pref_episode_cleanup_summary\"\n+        android:entryValues=\"@array/episode_cleanup_values\"/>\n+\n+</PreferenceScreen>\ndiff --git a/ui/preferences/src/main/res/xml/preferences_autodownload.xml b/ui/preferences/src/main/res/xml/preferences_autodownload.xml\nindex 339ddc9af2..3ababbf1dd 100644\n--- a/ui/preferences/src/main/res/xml/preferences_autodownload.xml\n+++ b/ui/preferences/src/main/res/xml/preferences_autodownload.xml\n@@ -15,13 +15,6 @@\n             android:title=\"@string/pref_episode_cache_title\"\n             android:summary=\"@string/pref_episode_cache_summary\"\n             android:entryValues=\"@array/episode_cache_size_values\"/>\n-    <de.danoeh.antennapod.ui.preferences.preference.MaterialListPreference\n-            android:defaultValue=\"-1\"\n-            android:entries=\"@array/episode_cleanup_entries\"\n-            android:key=\"prefEpisodeCleanup\"\n-            android:title=\"@string/pref_episode_cleanup_title\"\n-            android:summary=\"@string/pref_episode_cleanup_summary\"\n-            android:entryValues=\"@array/episode_cleanup_values\"/>\n     <SwitchPreferenceCompat\n             android:key=\"prefEnableAutoDownloadOnBattery\"\n             android:title=\"@string/pref_automatic_download_on_battery_title\"\ndiff --git a/ui/preferences/src/main/res/xml/preferences_downloads.xml b/ui/preferences/src/main/res/xml/preferences_downloads.xml\nindex 8a0c2efbe0..3dc08b9172 100644\n--- a/ui/preferences/src/main/res/xml/preferences_downloads.xml\n+++ b/ui/preferences/src/main/res/xml/preferences_downloads.xml\n@@ -27,24 +27,10 @@\n             android:key=\"prefAutoDownloadSettings\"\n             android:title=\"@string/pref_automatic_download_title\"\n             search:ignore=\"true\" />\n-        <SwitchPreferenceCompat\n-            android:defaultValue=\"false\"\n-            android:enabled=\"true\"\n-            android:key=\"prefAutoDelete\"\n+        <Preference\n+            android:key=\"prefAutoDeleteScreen\"\n             android:summary=\"@string/pref_auto_delete_sum\"\n             android:title=\"@string/pref_auto_delete_title\"/>\n-        <SwitchPreferenceCompat\n-            android:defaultValue=\"false\"\n-            android:enabled=\"true\"\n-            android:key=\"prefAutoDeleteLocal\"\n-            android:summary=\"@string/pref_auto_local_delete_sum\"\n-            android:title=\"@string/pref_auto_local_delete_title\"/>\n-        <SwitchPreferenceCompat\n-            android:defaultValue=\"true\"\n-            android:enabled=\"true\"\n-            android:key=\"prefFavoriteKeepsEpisode\"\n-            android:summary=\"@string/pref_favorite_keeps_episodes_sum\"\n-            android:title=\"@string/pref_favorite_keeps_episodes_title\"/>\n         <SwitchPreferenceCompat\n             android:defaultValue=\"false\"\n             android:enabled=\"true\"\n", "test_patch": "diff --git a/app/src/androidTest/java/de/test/antennapod/ui/FeedSettingsTest.java b/app/src/androidTest/java/de/test/antennapod/ui/FeedSettingsTest.java\nindex 187c9e16da..c34ab19c09 100644\n--- a/app/src/androidTest/java/de/test/antennapod/ui/FeedSettingsTest.java\n+++ b/app/src/androidTest/java/de/test/antennapod/ui/FeedSettingsTest.java\n@@ -70,7 +70,7 @@ public void testClickFeedSettings() {\n         clickPreference(R.string.pref_feed_skip);\n         onView(withText(R.string.cancel_label)).perform(click());\n \n-        clickPreference(R.string.auto_delete_label);\n+        clickPreference(R.string.pref_auto_delete_playback_title);\n         onView(withText(R.string.cancel_label)).perform(click());\n \n         clickPreference(R.string.feed_volume_adapdation);\ndiff --git a/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java b/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java\nindex 93d9fe1290..3e6267ac40 100644\n--- a/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java\n+++ b/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java\n@@ -173,11 +173,12 @@ public void testContinuousPlayback() {\n     @Test\n     public void testAutoDelete() {\n         clickPreference(R.string.downloads_pref);\n-        final boolean autoDelete = UserPreferences.isAutoDelete();\n         onView(withText(R.string.pref_auto_delete_title)).perform(click());\n+        final boolean autoDelete = UserPreferences.isAutoDelete();\n+        onView(withText(R.string.pref_auto_delete_playback_title)).perform(click());\n         Awaitility.await().atMost(1000, MILLISECONDS)\n                 .until(() -> autoDelete != UserPreferences.isAutoDelete());\n-        onView(withText(R.string.pref_auto_delete_title)).perform(click());\n+        onView(withText(R.string.pref_auto_delete_playback_title)).perform(click());\n         Awaitility.await().atMost(1000, MILLISECONDS)\n                 .until(() -> autoDelete == UserPreferences.isAutoDelete());\n     }\n@@ -185,8 +186,10 @@ public void testAutoDelete() {\n     @Test\n     public void testAutoDeleteLocal() {\n         clickPreference(R.string.downloads_pref);\n-        final boolean initialAutoDelete = UserPreferences.isAutoDeleteLocal();\n-        assertFalse(initialAutoDelete);\n+        onView(withText(R.string.pref_auto_delete_title)).perform(click());\n+        onView(withText(R.string.pref_auto_delete_playback_title)).perform(click());\n+        assertTrue(UserPreferences.isAutoDelete());\n+        assertFalse(UserPreferences.isAutoDeleteLocal());\n \n         onView(withText(R.string.pref_auto_local_delete_title)).perform(click());\n         onView(withText(R.string.yes)).perform(click());\n@@ -289,7 +292,7 @@ public void testAutomaticDownload() {\n     @Test\n     public void testEpisodeCleanupFavoriteOnly() {\n         clickPreference(R.string.downloads_pref);\n-        onView(withText(R.string.pref_automatic_download_title)).perform(click());\n+        onView(withText(R.string.pref_auto_delete_title)).perform(click());\n         onView(withText(R.string.pref_episode_cleanup_title)).perform(click());\n         onView(withId(R.id.select_dialog_listview)).perform(swipeDown());\n         onView(withText(R.string.episode_cleanup_except_favorite_removal)).perform(click());\n@@ -300,7 +303,7 @@ public void testEpisodeCleanupFavoriteOnly() {\n     @Test\n     public void testEpisodeCleanupQueueOnly() {\n         clickPreference(R.string.downloads_pref);\n-        onView(withText(R.string.pref_automatic_download_title)).perform(click());\n+        onView(withText(R.string.pref_auto_delete_title)).perform(click());\n         onView(withText(R.string.pref_episode_cleanup_title)).perform(click());\n         onView(withId(R.id.select_dialog_listview)).perform(swipeDown());\n         onView(withText(R.string.episode_cleanup_queue_removal)).perform(click());\n@@ -311,7 +314,7 @@ public void testEpisodeCleanupQueueOnly() {\n     @Test\n     public void testEpisodeCleanupNeverAlg() {\n         clickPreference(R.string.downloads_pref);\n-        onView(withText(R.string.pref_automatic_download_title)).perform(click());\n+        onView(withText(R.string.pref_auto_delete_title)).perform(click());\n         onView(withText(R.string.pref_episode_cleanup_title)).perform(click());\n         onView(withId(R.id.select_dialog_listview)).perform(swipeUp());\n         onView(withText(R.string.episode_cleanup_never)).perform(click());\n@@ -322,7 +325,7 @@ public void testEpisodeCleanupNeverAlg() {\n     @Test\n     public void testEpisodeCleanupClassic() {\n         clickPreference(R.string.downloads_pref);\n-        onView(withText(R.string.pref_automatic_download_title)).perform(click());\n+        onView(withText(R.string.pref_auto_delete_title)).perform(click());\n         onView(withText(R.string.pref_episode_cleanup_title)).perform(click());\n         onView(withText(R.string.episode_cleanup_after_listening)).perform(click());\n         Awaitility.await().atMost(1000, MILLISECONDS)\n@@ -339,7 +342,7 @@ public void testEpisodeCleanupClassic() {\n     @Test\n     public void testEpisodeCleanupNumDays() {\n         clickPreference(R.string.downloads_pref);\n-        clickPreference(R.string.pref_automatic_download_title);\n+        onView(withText(R.string.pref_auto_delete_title)).perform(click());\n         clickPreference(R.string.pref_episode_cleanup_title);\n         String search = res.getQuantityString(R.plurals.episode_cleanup_days_after_listening, 3, 3);\n         onView(withText(search)).perform(scrollTo());\n", "problem_statement": "Improve usability of episode cache / automatic cleanup\n# Checklist\r\n<!-- Place an x in the boxes to tick them: [x] -->\r\n\r\n- [x] I have used the search function to see if someone else has already submitted the same feature request.\r\n- [x] I will only create one feature request per issue.\r\n- [x] I will describe the problem with as much detail as possible.\r\n\r\n# System info\r\n\r\n**App version**: 2.1.1\r\n<!-- The latest version may be different depending on your device. You can find the version in AntennaPod's settings. -->\r\n\r\n**App source**: Google Play\r\n<!-- Please delete irrelevant answer or fill in the blank -->\r\n\r\n# Enhancement description\r\n\r\n**Problem you may be having, or feature you want**: the Episode cache linked to the automatic downloads is useful, but can lead to confusion, as is clear from [this conversation on Twitter](https://twitter.com/tjmcgrew/status/1341939976230080512). We should better guide users in this, and make the feature easier to understand.\r\n<!-- Give a brief explanation about the problem that may currently exist -->\r\n\r\n**Suggested solution**:\r\n<!-- Describe how your requested feature solves this problem. Try to be as specific as possible. Please not only explain what the feature does, but also how. -->\r\n* Rename 'episode cache' to 'Episode storage limit' or 'Episode download limit' (or something like that). 'Cache' is used for two different things in the app, and a rather technical term.\r\n* Show a pop-up to the user when the episode limit is reached for the first time. (Or do we already do this?). The pop-up text showing after hitting the icon in the menu should get the same text. It should read something like:\r\n**Episode storage limit reached**\r\nAntennaPod has download the maximum number of episodes on your device. In the settings you can:\r\n  * increase the limit (under Automatic Download)\r\n  * enable Episode Cleanup (under Automatic Download)\r\n  * enable Auto Delete (under Storage)\r\n* Make the episode limit universal - i.e. not only for automatic but also manual downloads. It could work in a similar fashion as downloading over mobile network, i.e. show a warning when the maximum is reached and let user override when downloading manually.\r\n* Move the episode limit setting under 'Storage', or (if the above isn't implemented) add there a reference to the setting. Storage is where I first checked when replying on Twitter; it's hard to find it currently (even though it makes sense it is under Automatic Downloads).\r\n\r\nRelated to #2990\n", "hints_text": "I think a similar discussion is currently going on in #2495. In general, all the issues of the \"Rework automatic deletion\" milestone are pretty similar.\nThere's a link indeed, but from quickly scanning that issue, it seems more about functional changes to the mechanisms. This issue I feel is more about relatively quick UX fixes. Since the Rework automatic deletion milestone is a rather big one that probably wont be implemented any time soon, at least fixing point 1, 2 & 4 listed here in the next point release would be great.\n> Rename 'episode cache' to 'Episode storage limit' or 'Episode download limit' (or something like that).\r\n\r\n:+1:\r\n\r\n> Move the episode limit setting under 'Storage'\r\n\r\nI would rather wait until the auto delete things are reworked and then create a new settings item for automation.", "created_at": "2024-04-14T09:43:16Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7094, "instance_id": "AntennaPod__AntennaPod-7094", "issue_numbers": ["5148", "7002"], "base_commit": "f3bca9d9e40f2a30a8d579452a78c048cd1d49bd", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemViewHolder.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemViewHolder.java\nindex 2d9cf70044..dd1a10450c 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemViewHolder.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemViewHolder.java\n@@ -43,8 +43,8 @@ public class EpisodeItemViewHolder extends RecyclerView.ViewHolder {\n \n     private final View container;\n     public final ImageView dragHandle;\n-    private final TextView placeholder;\n-    private final ImageView cover;\n+    public final TextView placeholder;\n+    public final ImageView cover;\n     private final TextView title;\n     private final TextView pubDate;\n     private final TextView position;\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\nindex b4a2556d1d..8c2d14a8a8 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\n@@ -26,6 +26,7 @@\n import com.google.android.material.snackbar.Snackbar;\n import com.leinardi.android.speeddial.SpeedDialView;\n \n+import de.danoeh.antennapod.ui.CoverLoader;\n import de.danoeh.antennapod.ui.screen.episode.ItemPagerFragment;\n import de.danoeh.antennapod.ui.screen.SearchFragment;\n import de.danoeh.antennapod.ui.TransitionEffect;\n@@ -596,7 +597,18 @@ public FeedItemListAdapter(MainActivity mainActivity) {\n \n         @Override\n         protected void beforeBindViewHolder(EpisodeItemViewHolder holder, int pos) {\n-            holder.coverHolder.setVisibility(View.GONE);\n+            holder.coverHolder.setVisibility(View.GONE); // Load it ourselves\n+        }\n+\n+        @Override\n+        protected void afterBindViewHolder(EpisodeItemViewHolder holder, int pos) {\n+            holder.coverHolder.setVisibility(View.VISIBLE);\n+            new CoverLoader()\n+                    .withUri(holder.getFeedItem().getImageLocation()) // Ignore \"Show episode cover\" setting\n+                    .withFallbackUri(holder.getFeedItem().getFeed().getImageUrl())\n+                    .withPlaceholderView(holder.placeholder)\n+                    .withCoverView(holder.cover)\n+                    .load();\n         }\n \n         @Override\n", "test_patch": "", "problem_statement": "Add episode cover art to subscription episode listings\n# Checklist\r\n<!-- Place an x in the boxes to tick them: [x] -->\r\n\r\n- [x] I have used the search function to see if someone else has already submitted the same feature request.\r\n- [x] I will only create one feature request per issue.\r\n- [x] I will describe the problem with as much detail as possible.\r\n\r\n# System info\r\n\r\n**App version**: 2.2.0\r\n<!-- The latest version may be different depending on your device. You can find the version in AntennaPod's settings. -->\r\n\r\n**App source**: Google Play\r\n<!-- Please delete irrelevant answer or fill in the blank -->\r\n\r\n# Feature description\r\n\r\n**Problem you may be having, or feature you want**:\r\nIt would be fantastic to add episode cover art to the episode listings of a podcast (i.e. the podcast listing when accessed from the Subscriptions page).  Currently, episode cover art is displayed on the Queue and Episodes pages.  The only place the episode cover art is not displayed is in the podcast episode listings.\r\n\r\nWhy would I want this?  I tend to listen to many podcasts out of order, browsing the listing from the Subscriptions podcast listing, and for particular podcasts the episode art is extremely useful in making a decision on what to listen to -- e.g. \"The Lonely Palette\" (art history podcast) where the episode art is the artwork discussed in the episode, or \"Our Fake History\" (historical myth-busting podcast) where the artwork hints at the aesthetics of the episode.\r\n\r\n**Suggested solution**:\r\nHopefully this is as easy as calling an episode-art-displaying function and layout from the Queue and Episodes pages in the per-podcast Subscription pages.\r\n\r\n**Screenshots / Drawings / Technical details**:\r\nI hope this isn't necessary, but I'm just thinking of the episode art thumbnail (or the podcast cover art if episode art is not unique and / or the option to display episode art is switched off) displayed to the left of each podcast listing.\r\n\nMake the difference between played and unplayed episodes more visible\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.2.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Problem you may be having, or feature you want\n\nOn bright sun I found that for me is difficult to distinguish between them\r\n![Screenshot_2024-03-18-16-40-38-118_de danoeh antennapod](https://github.com/AntennaPod/AntennaPod/assets/3514015/4d22960d-e241-473c-bd28-91b9e96a0b4b)\r\n\n\n### Suggested solution\n\n_No response_\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "I just switched to this podcast app and I'd also really like to have this feature, there are some podcasts where it's practically necessary. For example, some D&D podcasts might run several campaigns simultaneously (eg. Not Another D&D Podcast later episodes) and differentiate them with different thumbnails, which makes finding a specific episode much easier than trying to navigate just by title, which isn't always very helpful. So I thought I'd contribute with some mockups.\r\n\r\nFirst a simpler one just based on the queue screen:\r\n\r\n- ![antennapod mockup 1](https://github.com/AntennaPod/AntennaPod/assets/23014105/ab701c37-bf68-4173-b7d1-70d7e8e7aed3)\r\n\r\nReorganized it a little and experimented with placement:\r\n\r\n- ![antennapod mockup 14](https://github.com/AntennaPod/AntennaPod/assets/23014105/dc2a8b79-cdab-4eaa-b93d-0f95fc4a68d2)\r\n- ![antennapod mockup 15](https://github.com/AntennaPod/AntennaPod/assets/23014105/dd8308c2-14c5-4063-a8bd-3db782d20c3d)\r\n- ![antennapod mockup 16](https://github.com/AntennaPod/AntennaPod/assets/23014105/5b233e31-f043-4a24-b137-17216b402371)\r\n\r\nThis is probably the best one:\r\n\r\n- ![antennapod mockup 18](https://github.com/AntennaPod/AntennaPod/assets/23014105/9c74144f-7955-49c3-b466-23a31446e197)\r\n\r\nThey might be a little messy/not perfectly aligned but I hope for some mockups it's okay. The episodes take up the same amount of space in all of them. Personally I like the larger thumbnail but any of these would be good in my book. :)\r\n\r\nI hope this is what op imagined when opening this issue and that the images will be helpful.\nI think this could be fixed by #5148, as the image wash-out would be more visible than the text wash-out.", "created_at": "2024-04-14T08:41:36Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7093, "instance_id": "AntennaPod__AntennaPod-7093", "issue_numbers": ["6948"], "base_commit": "c063c59af320e15204584ede3611478d880cc407", "patch": "diff --git a/app/build.gradle b/app/build.gradle\nindex 2abb66ccfd..a918918619 100644\n--- a/app/build.gradle\n+++ b/app/build.gradle\n@@ -114,7 +114,6 @@ dependencies {\n     implementation \"io.reactivex.rxjava2:rxandroid:$rxAndroidVersion\"\n     implementation \"io.reactivex.rxjava2:rxjava:$rxJavaVersion\"\n \n-    implementation 'com.leinardi.android:speed-dial:3.2.0'\n     implementation 'com.github.ByteHamster:SearchPreference:v2.5.0'\n     implementation 'com.github.skydoves:balloon:1.5.3'\n     implementation 'com.github.xabaras:RecyclerViewSwipeDecorator:1.3'\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemListAdapter.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemListAdapter.java\nindex 34f4739536..5082f25ffd 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemListAdapter.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemListAdapter.java\n@@ -111,9 +111,11 @@ public final void onBindViewHolder(EpisodeItemViewHolder holder, int pos) {\n             return false;\n         });\n \n+        holder.itemView.setSelected(false);\n         if (inActionMode()) {\n             holder.secondaryActionButton.setOnClickListener(null);\n             if (isSelected(pos)) {\n+                holder.itemView.setSelected(true);\n                 holder.itemView.setBackgroundColor(0x88000000\n                         + (0xffffff & ThemeUtils.getColorFromAttr(mainActivityRef.get(), R.attr.colorAccent)));\n             } else {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodesListFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodesListFragment.java\nindex 90f7cf1e53..08ec14ec09 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodesListFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodesListFragment.java\n@@ -22,10 +22,10 @@\n \n import com.google.android.material.appbar.MaterialToolbar;\n import com.google.android.material.snackbar.Snackbar;\n-import com.leinardi.android.speeddial.SpeedDialView;\n \n import de.danoeh.antennapod.ui.screen.SearchFragment;\n import de.danoeh.antennapod.net.download.serviceinterface.FeedUpdateManager;\n+import de.danoeh.antennapod.ui.view.FloatingSelectMenu;\n import org.greenrobot.eventbus.EventBus;\n import org.greenrobot.eventbus.Subscribe;\n import org.greenrobot.eventbus.ThreadMode;\n@@ -72,7 +72,7 @@ public abstract class EpisodesListFragment extends Fragment\n     protected EpisodeItemListRecyclerView recyclerView;\n     protected EpisodeItemListAdapter listAdapter;\n     protected EmptyViewHandler emptyView;\n-    protected SpeedDialView speedDialView;\n+    protected FloatingSelectMenu floatingSelectMenu;\n     protected MaterialToolbar toolbar;\n     protected SwipeRefreshLayout swipeRefreshLayout;\n     protected SwipeActions swipeActions;\n@@ -200,41 +200,30 @@ public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMen\n         emptyView.updateAdapter(listAdapter);\n         emptyView.hide();\n \n-        speedDialView = root.findViewById(R.id.fabSD);\n-        speedDialView.setOverlayLayout(root.findViewById(R.id.fabSDOverlay));\n-        speedDialView.inflate(R.menu.episodes_apply_action_speeddial);\n-        speedDialView.setOnChangeListener(new SpeedDialView.OnChangeListener() {\n-            @Override\n-            public boolean onMainActionSelected() {\n+        floatingSelectMenu = root.findViewById(R.id.floatingSelectMenu);\n+        floatingSelectMenu.inflate(R.menu.episodes_apply_action_speeddial);\n+        floatingSelectMenu.setOnMenuItemClickListener(menuItem -> {\n+            if (listAdapter.getSelectedCount() == 0) {\n+                ((MainActivity) getActivity()).showSnackbarAbovePlayer(R.string.no_items_selected,\n+                        Snackbar.LENGTH_SHORT);\n                 return false;\n             }\n-\n-            @Override\n-            public void onToggleChanged(boolean open) {\n-                if (open && listAdapter.getSelectedCount() == 0) {\n-                    ((MainActivity) getActivity()).showSnackbarAbovePlayer(R.string.no_items_selected,\n-                            Snackbar.LENGTH_SHORT);\n-                    speedDialView.close();\n-                }\n-            }\n-        });\n-        speedDialView.setOnActionSelectedListener(actionItem -> {\n             int confirmationString = 0;\n             if (listAdapter.getSelectedItems().size() >= 25 || listAdapter.shouldSelectLazyLoadedItems()) {\n                 // Should ask for confirmation\n-                if (actionItem.getId() == R.id.mark_read_batch) {\n+                if (menuItem.getItemId() == R.id.mark_read_batch) {\n                     confirmationString = R.string.multi_select_mark_played_confirmation;\n-                } else if (actionItem.getId() == R.id.mark_unread_batch) {\n+                } else if (menuItem.getItemId() == R.id.mark_unread_batch) {\n                     confirmationString = R.string.multi_select_mark_unplayed_confirmation;\n                 }\n             }\n             if (confirmationString == 0) {\n-                performMultiSelectAction(actionItem.getId());\n+                performMultiSelectAction(menuItem.getItemId());\n             } else {\n                 new ConfirmationDialog(getActivity(), R.string.multi_select, confirmationString) {\n                     @Override\n                     public void onConfirmButtonPressed(DialogInterface dialog) {\n-                        performMultiSelectAction(actionItem.getId());\n+                        performMultiSelectAction(menuItem.getItemId());\n                     }\n                 }.createNewDialog().show();\n             }\n@@ -320,13 +309,17 @@ public void onDestroyView() {\n \n     @Override\n     public void onStartSelectMode() {\n-        speedDialView.setVisibility(View.VISIBLE);\n+        floatingSelectMenu.setVisibility(View.VISIBLE);\n+        recyclerView.setPadding(recyclerView.getPaddingLeft(), recyclerView.getPaddingTop(),\n+                recyclerView.getPaddingRight(),\n+                (int) getResources().getDimension(R.dimen.floating_select_menu_height));\n     }\n \n     @Override\n     public void onEndSelectMode() {\n-        speedDialView.close();\n-        speedDialView.setVisibility(View.GONE);\n+        floatingSelectMenu.setVisibility(View.GONE);\n+        recyclerView.setPadding(recyclerView.getPaddingLeft(), recyclerView.getPaddingTop(),\n+                recyclerView.getPaddingRight(), 0);\n     }\n \n     @Subscribe(threadMode = ThreadMode.MAIN)\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/InboxFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/InboxFragment.java\nindex 5ac6e5bef2..68d7accf6c 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/InboxFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/InboxFragment.java\n@@ -48,9 +48,9 @@ public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container,\n         emptyView.setIcon(R.drawable.ic_inbox);\n         emptyView.setTitle(R.string.no_inbox_head_label);\n         emptyView.setMessage(R.string.no_inbox_label);\n-        speedDialView.removeActionItemById(R.id.mark_unread_batch);\n-        speedDialView.removeActionItemById(R.id.remove_from_queue_batch);\n-        speedDialView.removeActionItemById(R.id.delete_batch);\n+        floatingSelectMenu.getMenu().findItem(R.id.mark_unread_batch).setVisible(false);\n+        floatingSelectMenu.getMenu().findItem(R.id.remove_from_queue_batch).setVisible(false);\n+        floatingSelectMenu.getMenu().findItem(R.id.delete_batch).setVisible(false);\n         return root;\n     }\n \ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/SearchFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/SearchFragment.java\nindex 0416cca757..ec782001a4 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/SearchFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/SearchFragment.java\n@@ -23,14 +23,12 @@\n \n import com.google.android.material.chip.Chip;\n import com.google.android.material.snackbar.Snackbar;\n-import com.leinardi.android.speeddial.SpeedDialView;\n \n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n import de.danoeh.antennapod.ui.episodeslist.EpisodeItemListAdapter;\n import de.danoeh.antennapod.ui.screen.subscriptions.HorizontalFeedListAdapter;\n import de.danoeh.antennapod.ui.MenuItemUtils;\n-import de.danoeh.antennapod.databinding.MultiSelectSpeedDialBinding;\n import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FeedItemEvent;\n import de.danoeh.antennapod.event.playback.PlaybackPositionEvent;\n@@ -46,6 +44,7 @@\n import de.danoeh.antennapod.ui.discovery.OnlineSearchFragment;\n import de.danoeh.antennapod.ui.view.EmptyViewHandler;\n import de.danoeh.antennapod.ui.episodeslist.EpisodeItemListRecyclerView;\n+import de.danoeh.antennapod.ui.view.FloatingSelectMenu;\n import de.danoeh.antennapod.ui.view.LiftOnScrollListener;\n import de.danoeh.antennapod.ui.episodeslist.EpisodeItemViewHolder;\n import io.reactivex.Observable;\n@@ -82,9 +81,9 @@ public class SearchFragment extends Fragment implements EpisodeItemListAdapter.O\n     private List<FeedItem> results;\n     private Chip chip;\n     private SearchView searchView;\n+    private FloatingSelectMenu floatingSelectMenu;\n     private Handler automaticSearchDebouncer;\n     private long lastQueryChange = 0;\n-    private MultiSelectSpeedDialBinding speedDialBinding;\n     private boolean isOtherViewInFoucus = false;\n \n \n@@ -141,9 +140,9 @@ public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup c\n                              @Nullable Bundle savedInstanceState) {\n         View layout = inflater.inflate(R.layout.search_fragment, container, false);\n         setupToolbar(layout.findViewById(R.id.toolbar));\n-        speedDialBinding = MultiSelectSpeedDialBinding.bind(layout);\n         progressBar = layout.findViewById(R.id.progressBar);\n         recyclerView = layout.findViewById(R.id.recyclerView);\n+        floatingSelectMenu = layout.findViewById(R.id.floatingSelectMenu);\n         recyclerView.setRecycledViewPool(((MainActivity) getActivity()).getRecycledViewPool());\n         registerForContextMenu(recyclerView);\n         adapter = new EpisodeItemListAdapter((MainActivity) getActivity()) {\n@@ -207,25 +206,14 @@ public void onScrollStateChanged(@NonNull RecyclerView recyclerView, int newStat\n                 }\n             }\n         });\n-        speedDialBinding.fabSD.setOverlayLayout(speedDialBinding.fabSDOverlay);\n-        speedDialBinding.fabSD.inflate(R.menu.episodes_apply_action_speeddial);\n-        speedDialBinding.fabSD.setOnChangeListener(new SpeedDialView.OnChangeListener() {\n-            @Override\n-            public boolean onMainActionSelected() {\n+        floatingSelectMenu.inflate(R.menu.episodes_apply_action_speeddial);\n+        floatingSelectMenu.setOnMenuItemClickListener(menuItem -> {\n+            if (adapter.getSelectedCount() == 0) {\n+                ((MainActivity) getActivity())\n+                        .showSnackbarAbovePlayer(R.string.no_items_selected, Snackbar.LENGTH_SHORT);\n                 return false;\n             }\n-\n-            @Override\n-            public void onToggleChanged(boolean open) {\n-                if (open && adapter.getSelectedCount() == 0) {\n-                    ((MainActivity) getActivity())\n-                            .showSnackbarAbovePlayer(R.string.no_items_selected, Snackbar.LENGTH_SHORT);\n-                    speedDialBinding.fabSD.close();\n-                }\n-            }\n-        });\n-        speedDialBinding.fabSD.setOnActionSelectedListener(actionItem -> {\n-            new EpisodeMultiSelectActionHandler((MainActivity) getActivity(), actionItem.getId())\n+            new EpisodeMultiSelectActionHandler((MainActivity) getActivity(), menuItem.getItemId())\n                     .handleAction(adapter.getSelectedItems());\n             adapter.endSelectMode();\n             return true;\n@@ -438,16 +426,17 @@ private void searchOnline() {\n     @Override\n     public void onStartSelectMode() {\n         searchViewFocusOff();\n-        speedDialBinding.fabSD.removeActionItemById(R.id.remove_from_inbox_batch);\n-        speedDialBinding.fabSD.removeActionItemById(R.id.remove_from_queue_batch);\n-        speedDialBinding.fabSD.removeActionItemById(R.id.delete_batch);\n-        speedDialBinding.fabSD.setVisibility(View.VISIBLE);\n+        floatingSelectMenu.setVisibility(View.VISIBLE);\n+        recyclerView.setPadding(recyclerView.getPaddingLeft(), recyclerView.getPaddingTop(),\n+                recyclerView.getPaddingRight(),\n+                (int) getResources().getDimension(R.dimen.floating_select_menu_height));\n     }\n \n     @Override\n     public void onEndSelectMode() {\n-        speedDialBinding.fabSD.close();\n-        speedDialBinding.fabSD.setVisibility(View.GONE);\n+        floatingSelectMenu.setVisibility(View.GONE);\n+        recyclerView.setPadding(recyclerView.getPaddingLeft(), recyclerView.getPaddingTop(),\n+                recyclerView.getPaddingRight(), 0);\n         searchViewFocusOn();\n     }\n \ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java\nindex 260f3e6a03..001c2b4658 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java\n@@ -13,7 +13,6 @@\n import androidx.fragment.app.Fragment;\n import com.google.android.material.appbar.MaterialToolbar;\n import com.google.android.material.snackbar.Snackbar;\n-import com.leinardi.android.speeddial.SpeedDialView;\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n import de.danoeh.antennapod.ui.episodeslist.EpisodeItemListAdapter;\n@@ -39,6 +38,7 @@\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import de.danoeh.antennapod.ui.view.EmptyViewHandler;\n import de.danoeh.antennapod.ui.episodeslist.EpisodeItemListRecyclerView;\n+import de.danoeh.antennapod.ui.view.FloatingSelectMenu;\n import de.danoeh.antennapod.ui.view.LiftOnScrollListener;\n import de.danoeh.antennapod.ui.episodeslist.EpisodeItemViewHolder;\n import io.reactivex.Observable;\n@@ -71,7 +71,7 @@ public class CompletedDownloadsFragment extends Fragment\n     private Disposable disposable;\n     private EmptyViewHandler emptyView;\n     private boolean displayUpArrow;\n-    private SpeedDialView speedDialView;\n+    private FloatingSelectMenu floatingSelectMenu;\n     private SwipeActions swipeActions;\n     private ProgressBar progressBar;\n     private MaterialToolbar toolbar;\n@@ -107,31 +107,19 @@ public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup c\n         progressBar = root.findViewById(R.id.progLoading);\n         progressBar.setVisibility(View.VISIBLE);\n \n-        speedDialView = root.findViewById(R.id.fabSD);\n-        speedDialView.setOverlayLayout(root.findViewById(R.id.fabSDOverlay));\n-        speedDialView.inflate(R.menu.episodes_apply_action_speeddial);\n-        speedDialView.removeActionItemById(R.id.download_batch);\n-        speedDialView.removeActionItemById(R.id.mark_read_batch);\n-        speedDialView.removeActionItemById(R.id.mark_unread_batch);\n-        speedDialView.removeActionItemById(R.id.remove_from_queue_batch);\n-        speedDialView.removeActionItemById(R.id.remove_all_inbox_item);\n-        speedDialView.setOnChangeListener(new SpeedDialView.OnChangeListener() {\n-            @Override\n-            public boolean onMainActionSelected() {\n+        floatingSelectMenu = root.findViewById(R.id.floatingSelectMenu);\n+        floatingSelectMenu.inflate(R.menu.episodes_apply_action_speeddial);\n+        floatingSelectMenu.getMenu().findItem(R.id.download_batch).setVisible(false);\n+        floatingSelectMenu.getMenu().findItem(R.id.mark_read_batch).setVisible(false);\n+        floatingSelectMenu.getMenu().findItem(R.id.mark_unread_batch).setVisible(false);\n+        floatingSelectMenu.getMenu().findItem(R.id.remove_from_inbox_batch).setVisible(false);\n+        floatingSelectMenu.setOnMenuItemClickListener(menuItem -> {\n+            if (adapter.getSelectedCount() == 0) {\n+                ((MainActivity) getActivity()).showSnackbarAbovePlayer(R.string.no_items_selected,\n+                        Snackbar.LENGTH_SHORT);\n                 return false;\n             }\n-\n-            @Override\n-            public void onToggleChanged(boolean open) {\n-                if (open && adapter.getSelectedCount() == 0) {\n-                    ((MainActivity) getActivity()).showSnackbarAbovePlayer(R.string.no_items_selected,\n-                            Snackbar.LENGTH_SHORT);\n-                    speedDialView.close();\n-                }\n-            }\n-        });\n-        speedDialView.setOnActionSelectedListener(actionItem -> {\n-            new EpisodeMultiSelectActionHandler(((MainActivity) getActivity()), actionItem.getId())\n+            new EpisodeMultiSelectActionHandler(((MainActivity) getActivity()), menuItem.getItemId())\n                     .handleAction(adapter.getSelectedItems());\n             adapter.endSelectMode();\n             return true;\n@@ -331,14 +319,18 @@ private void loadItems() {\n     @Override\n     public void onStartSelectMode() {\n         swipeActions.detach();\n-        speedDialView.setVisibility(View.VISIBLE);\n+        floatingSelectMenu.setVisibility(View.VISIBLE);\n+        recyclerView.setPadding(recyclerView.getPaddingLeft(), recyclerView.getPaddingTop(),\n+                recyclerView.getPaddingRight(),\n+                (int) getResources().getDimension(R.dimen.floating_select_menu_height));\n     }\n \n     @Override\n     public void onEndSelectMode() {\n-        speedDialView.close();\n-        speedDialView.setVisibility(View.GONE);\n+        floatingSelectMenu.setVisibility(View.GONE);\n         swipeActions.attachTo(recyclerView);\n+        recyclerView.setPadding(recyclerView.getPaddingLeft(), recyclerView.getPaddingTop(),\n+                recyclerView.getPaddingRight(), 0);\n     }\n \n     private class CompletedDownloadsListAdapter extends EpisodeItemListAdapter {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\nindex ee92187ff1..9bc45a235f 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\n@@ -25,7 +25,6 @@\n import com.bumptech.glide.request.RequestOptions;\n import com.google.android.material.appbar.MaterialToolbar;\n import com.google.android.material.snackbar.Snackbar;\n-import com.leinardi.android.speeddial.SpeedDialView;\n \n import de.danoeh.antennapod.ui.CoverLoader;\n import de.danoeh.antennapod.ui.screen.episode.ItemPagerFragment;\n@@ -55,7 +54,6 @@\n import de.danoeh.antennapod.ui.share.ShareUtils;\n import de.danoeh.antennapod.ui.episodeslist.MoreContentListFooterUtil;\n import de.danoeh.antennapod.databinding.FeedItemListFragmentBinding;\n-import de.danoeh.antennapod.databinding.MultiSelectSpeedDialBinding;\n import de.danoeh.antennapod.ui.screen.download.DownloadLogDetailsDialog;\n import de.danoeh.antennapod.ui.FeedItemFilterDialog;\n import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n@@ -105,7 +103,6 @@ public class FeedItemlistFragment extends Fragment implements AdapterView.OnItem\n     private boolean headerCreated = false;\n     private Disposable disposable;\n     private FeedItemListFragmentBinding viewBinding;\n-    private MultiSelectSpeedDialBinding speedDialBinding;\n \n     /**\n      * Creates new ItemlistFragment which shows the Feeditems of a specific\n@@ -136,7 +133,6 @@ public void onCreate(Bundle savedInstanceState) {\n     public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container,\n                              @Nullable Bundle savedInstanceState) {\n         viewBinding = FeedItemListFragmentBinding.inflate(inflater);\n-        speedDialBinding = MultiSelectSpeedDialBinding.bind(viewBinding.getRoot());\n         viewBinding.toolbar.inflateMenu(R.menu.feedlist);\n         viewBinding.toolbar.setOnMenuItemClickListener(this);\n         viewBinding.toolbar.setOnLongClickListener(v -> {\n@@ -183,12 +179,7 @@ protected void doTint(Context themedContext) {\n             @Override\n             public void onScrolled(@NonNull RecyclerView view, int deltaX, int deltaY) {\n                 super.onScrolled(view, deltaX, deltaY);\n-                boolean hasMorePages = feed != null && feed.isPaged() && feed.getNextPageLink() != null;\n-                boolean pageLoaderVisible = viewBinding.recyclerView.isScrolledToBottom() && hasMorePages;\n-                nextPageLoader.getRoot().setVisibility(pageLoaderVisible ? View.VISIBLE : View.GONE);\n-                viewBinding.recyclerView.setPadding(\n-                        viewBinding.recyclerView.getPaddingLeft(), 0, viewBinding.recyclerView.getPaddingRight(),\n-                        pageLoaderVisible ? nextPageLoader.getRoot().getMeasuredHeight() : 0);\n+                updateRecyclerPadding();\n             }\n         });\n \n@@ -200,26 +191,14 @@ public void onScrolled(@NonNull RecyclerView view, int deltaX, int deltaY) {\n \n         loadItems();\n \n-        // Init action UI (via a FAB Speed Dial)\n-        speedDialBinding.fabSD.setOverlayLayout(speedDialBinding.fabSDOverlay);\n-        speedDialBinding.fabSD.inflate(R.menu.episodes_apply_action_speeddial);\n-        speedDialBinding.fabSD.setOnChangeListener(new SpeedDialView.OnChangeListener() {\n-            @Override\n-            public boolean onMainActionSelected() {\n+        viewBinding.floatingSelectMenu.inflate(R.menu.episodes_apply_action_speeddial);\n+        viewBinding.floatingSelectMenu.setOnMenuItemClickListener(menuItem -> {\n+            if (adapter.getSelectedCount() == 0) {\n+                ((MainActivity) getActivity()).showSnackbarAbovePlayer(R.string.no_items_selected,\n+                        Snackbar.LENGTH_SHORT);\n                 return false;\n             }\n-\n-            @Override\n-            public void onToggleChanged(boolean open) {\n-                if (open && adapter.getSelectedCount() == 0) {\n-                    ((MainActivity) getActivity()).showSnackbarAbovePlayer(R.string.no_items_selected,\n-                            Snackbar.LENGTH_SHORT);\n-                    speedDialBinding.fabSD.close();\n-                }\n-            }\n-        });\n-        speedDialBinding.fabSD.setOnActionSelectedListener(actionItem -> {\n-            new EpisodeMultiSelectActionHandler(((MainActivity) getActivity()), actionItem.getId())\n+            new EpisodeMultiSelectActionHandler(((MainActivity) getActivity()), menuItem.getItemId())\n                     .handleAction(adapter.getSelectedItems());\n             adapter.endSelectMode();\n             return true;\n@@ -227,6 +206,20 @@ public void onToggleChanged(boolean open) {\n         return viewBinding.getRoot();\n     }\n \n+    private void updateRecyclerPadding() {\n+        boolean hasMorePages = feed != null && feed.isPaged() && feed.getNextPageLink() != null;\n+        boolean pageLoaderVisible = viewBinding.recyclerView.isScrolledToBottom() && hasMorePages;\n+        nextPageLoader.getRoot().setVisibility(pageLoaderVisible ? View.VISIBLE : View.GONE);\n+        int paddingBottom = 0;\n+        if (adapter.inActionMode()) {\n+            paddingBottom = (int) getResources().getDimension(R.dimen.floating_select_menu_height);\n+        } else if (pageLoaderVisible) {\n+            paddingBottom = nextPageLoader.getRoot().getMeasuredHeight();\n+        }\n+        viewBinding.recyclerView.setPadding(viewBinding.recyclerView.getPaddingLeft(), 0,\n+                viewBinding.recyclerView.getPaddingRight(), paddingBottom);\n+    }\n+\n     @Override\n     public void onDestroyView() {\n         super.onDestroyView();\n@@ -406,18 +399,16 @@ public void onQueueChanged(QueueEvent event) {\n     @Override\n     public void onStartSelectMode() {\n         swipeActions.detach();\n-        if (feed.isLocalFeed()) {\n-            speedDialBinding.fabSD.removeActionItemById(R.id.download_batch);\n-        }\n-        speedDialBinding.fabSD.removeActionItemById(R.id.remove_all_inbox_item);\n-        speedDialBinding.fabSD.setVisibility(View.VISIBLE);\n+        viewBinding.floatingSelectMenu.getMenu().findItem(R.id.download_batch).setVisible(!feed.isLocalFeed());\n+        viewBinding.floatingSelectMenu.setVisibility(View.VISIBLE);\n+        updateRecyclerPadding();\n         updateToolbar();\n     }\n \n     @Override\n     public void onEndSelectMode() {\n-        speedDialBinding.fabSD.close();\n-        speedDialBinding.fabSD.setVisibility(View.GONE);\n+        viewBinding.floatingSelectMenu.setVisibility(View.GONE);\n+        updateRecyclerPadding();\n         swipeActions.attachTo(viewBinding.recyclerView);\n     }\n \ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java\nindex adc8b6c59d..bc70a06bb6 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java\n@@ -26,11 +26,11 @@\n import com.google.android.material.appbar.MaterialToolbar;\n import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import com.google.android.material.snackbar.Snackbar;\n-import com.leinardi.android.speeddial.SpeedDialView;\n \n import de.danoeh.antennapod.ui.screen.SearchFragment;\n import de.danoeh.antennapod.net.download.serviceinterface.FeedUpdateManager;\n import de.danoeh.antennapod.ui.episodes.PlaybackSpeedUtils;\n+import de.danoeh.antennapod.ui.view.FloatingSelectMenu;\n import org.greenrobot.eventbus.EventBus;\n import org.greenrobot.eventbus.Subscribe;\n import org.greenrobot.eventbus.ThreadMode;\n@@ -94,7 +94,7 @@ public class QueueFragment extends Fragment implements MaterialToolbar.OnMenuIte\n     private SwipeActions swipeActions;\n     private SharedPreferences prefs;\n \n-    private SpeedDialView speedDialView;\n+    private FloatingSelectMenu floatingSelectMenu;\n     private ProgressBar progressBar;\n \n     @Override\n@@ -436,30 +436,17 @@ public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMen\n         emptyView.setMessage(R.string.no_items_label);\n         emptyView.updateAdapter(recyclerAdapter);\n \n-        speedDialView = root.findViewById(R.id.fabSD);\n-        speedDialView.setOverlayLayout(root.findViewById(R.id.fabSDOverlay));\n-        speedDialView.inflate(R.menu.episodes_apply_action_speeddial);\n-        speedDialView.removeActionItemById(R.id.mark_read_batch);\n-        speedDialView.removeActionItemById(R.id.mark_unread_batch);\n-        speedDialView.removeActionItemById(R.id.add_to_queue_batch);\n-        speedDialView.removeActionItemById(R.id.remove_all_inbox_item);\n-        speedDialView.setOnChangeListener(new SpeedDialView.OnChangeListener() {\n-            @Override\n-            public boolean onMainActionSelected() {\n+        floatingSelectMenu = root.findViewById(R.id.floatingSelectMenu);\n+        floatingSelectMenu.inflate(R.menu.episodes_apply_action_speeddial);\n+        floatingSelectMenu.getMenu().findItem(R.id.add_to_queue_batch).setVisible(false);\n+        floatingSelectMenu.getMenu().findItem(R.id.remove_from_inbox_batch).setVisible(false);\n+        floatingSelectMenu.setOnMenuItemClickListener(menuItem -> {\n+            if (recyclerAdapter.getSelectedCount() == 0) {\n+                ((MainActivity) getActivity()).showSnackbarAbovePlayer(R.string.no_items_selected,\n+                        Snackbar.LENGTH_SHORT);\n                 return false;\n             }\n-\n-            @Override\n-            public void onToggleChanged(boolean open) {\n-                if (open && recyclerAdapter.getSelectedCount() == 0) {\n-                    ((MainActivity) getActivity()).showSnackbarAbovePlayer(R.string.no_items_selected,\n-                            Snackbar.LENGTH_SHORT);\n-                    speedDialView.close();\n-                }\n-            }\n-        });\n-        speedDialView.setOnActionSelectedListener(actionItem -> {\n-            new EpisodeMultiSelectActionHandler(((MainActivity) getActivity()), actionItem.getId())\n+            new EpisodeMultiSelectActionHandler(((MainActivity) getActivity()), menuItem.getItemId())\n                     .handleAction(recyclerAdapter.getSelectedItems());\n             recyclerAdapter.endSelectMode();\n             return true;\n@@ -528,15 +515,20 @@ private void loadItems(final boolean restoreScrollPosition) {\n     @Override\n     public void onStartSelectMode() {\n         swipeActions.detach();\n-        speedDialView.setVisibility(View.VISIBLE);\n+        floatingSelectMenu.setVisibility(View.VISIBLE);\n+        recyclerView.setPadding(recyclerView.getPaddingLeft(), recyclerView.getPaddingTop(),\n+                recyclerView.getPaddingRight(),\n+                (int) getResources().getDimension(R.dimen.floating_select_menu_height));\n         refreshToolbarState();\n         refreshInfoBar();\n     }\n \n     @Override\n     public void onEndSelectMode() {\n-        speedDialView.close();\n-        speedDialView.setVisibility(View.GONE);\n+        floatingSelectMenu.setVisibility(View.GONE);\n+        recyclerView.setPadding(recyclerView.getPaddingLeft(), recyclerView.getPaddingTop(),\n+                recyclerView.getPaddingRight(), 0);\n+        infoBar.setVisibility(View.VISIBLE);\n         swipeActions.attachTo(recyclerView);\n         refreshInfoBar();\n     }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/SubscriptionFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/SubscriptionFragment.java\nindex 793a62eded..c7bc579b1c 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/SubscriptionFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/SubscriptionFragment.java\n@@ -20,11 +20,11 @@\n \n import com.google.android.material.appbar.MaterialToolbar;\n import com.google.android.material.floatingactionbutton.FloatingActionButton;\n-import com.leinardi.android.speeddial.SpeedDialView;\n \n import de.danoeh.antennapod.ui.screen.AddFeedFragment;\n import de.danoeh.antennapod.ui.screen.SearchFragment;\n import de.danoeh.antennapod.net.download.serviceinterface.FeedUpdateManager;\n+import de.danoeh.antennapod.ui.view.FloatingSelectMenu;\n import org.greenrobot.eventbus.EventBus;\n import org.greenrobot.eventbus.Subscribe;\n import org.greenrobot.eventbus.ThreadMode;\n@@ -86,7 +86,7 @@ public class SubscriptionFragment extends Fragment\n     private SharedPreferences prefs;\n \n     private FloatingActionButton subscriptionAddButton;\n-    private SpeedDialView speedDialView;\n+    private FloatingSelectMenu floatingSelectMenu;\n     private RecyclerView.ItemDecoration itemDecoration;\n     private List<NavDrawerData.DrawerItem> listItems;\n \n@@ -168,12 +168,11 @@ public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMen\n         swipeRefreshLayout.setDistanceToTriggerSync(getResources().getInteger(R.integer.swipe_refresh_distance));\n         swipeRefreshLayout.setOnRefreshListener(() -> FeedUpdateManager.getInstance().runOnceOrAsk(requireContext()));\n \n-        speedDialView = root.findViewById(R.id.fabSD);\n-        speedDialView.setOverlayLayout(root.findViewById(R.id.fabSDOverlay));\n-        speedDialView.inflate(R.menu.nav_feed_action_speeddial);\n-        speedDialView.setOnActionSelectedListener(actionItem -> {\n+        floatingSelectMenu = root.findViewById(R.id.floatingSelectMenu);\n+        floatingSelectMenu.inflate(R.menu.nav_feed_action_speeddial);\n+        floatingSelectMenu.setOnMenuItemClickListener(menuItem -> {\n             new FeedMultiSelectActionHandler((MainActivity) getActivity(), subscriptionAdapter.getSelectedItems())\n-                    .handleAction(actionItem.getId());\n+                    .handleAction(menuItem.getItemId());\n             return true;\n         });\n \n@@ -370,8 +369,7 @@ public void onUnreadItemsChanged(UnreadItemsUpdateEvent event) {\n \n     @Override\n     public void onEndSelectMode() {\n-        speedDialView.close();\n-        speedDialView.setVisibility(View.GONE);\n+        floatingSelectMenu.setVisibility(View.GONE);\n         subscriptionAddButton.setVisibility(View.VISIBLE);\n         subscriptionAdapter.setItems(listItems);\n         updateFilterVisibility();\n@@ -386,7 +384,7 @@ public void onStartSelectMode() {\n             }\n         }\n         subscriptionAdapter.setItems(feedsOnly);\n-        speedDialView.setVisibility(View.VISIBLE);\n+        floatingSelectMenu.setVisibility(View.VISIBLE);\n         subscriptionAddButton.setVisibility(View.GONE);\n         updateFilterVisibility();\n     }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/view/FloatingSelectMenu.java b/app/src/main/java/de/danoeh/antennapod/ui/view/FloatingSelectMenu.java\nnew file mode 100644\nindex 0000000000..02f0192b76\n--- /dev/null\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/view/FloatingSelectMenu.java\n@@ -0,0 +1,90 @@\n+package de.danoeh.antennapod.ui.view;\n+\n+import android.content.Context;\n+import android.util.AttributeSet;\n+import android.view.Menu;\n+import android.view.MenuItem;\n+import android.view.View;\n+import android.widget.FrameLayout;\n+import androidx.annotation.MenuRes;\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import androidx.appcompat.widget.PopupMenu;\n+import com.google.android.material.elevation.SurfaceColors;\n+import de.danoeh.antennapod.R;\n+import de.danoeh.antennapod.databinding.FloatingSelectMenuBinding;\n+import de.danoeh.antennapod.databinding.FloatingSelectMenuItemBinding;\n+\n+public class FloatingSelectMenu extends FrameLayout {\n+    private FloatingSelectMenuBinding viewBinding;\n+    private Menu menu;\n+    private MenuItem.OnMenuItemClickListener menuItemClickListener;\n+\n+    public FloatingSelectMenu(@NonNull Context context) {\n+        super(context);\n+        setup();\n+    }\n+\n+    public FloatingSelectMenu(@NonNull Context context, @Nullable AttributeSet attrs) {\n+        super(context, attrs);\n+        setup();\n+    }\n+\n+    public FloatingSelectMenu(@NonNull Context context, @Nullable AttributeSet attrs, int defStyleAttr) {\n+        super(context, attrs, defStyleAttr);\n+        setup();\n+    }\n+\n+    private void setup() {\n+        viewBinding = FloatingSelectMenuBinding.bind(\n+                View.inflate(getContext(), R.layout.floating_select_menu, null));\n+        viewBinding.card.setCardBackgroundColor(\n+                SurfaceColors.getColorForElevation(getContext(), 8 * getResources().getDisplayMetrics().density));\n+        addView(viewBinding.getRoot());\n+        setVisibility(View.GONE);\n+    }\n+\n+    public void inflate(@MenuRes int menuRes) {\n+        PopupMenu popupMenu = new PopupMenu(getContext(), new View(getContext()));\n+        popupMenu.inflate(menuRes);\n+        menu = popupMenu.getMenu();\n+        updateItemVisibility();\n+    }\n+\n+    public void updateItemVisibility() {\n+        viewBinding.selectContainer.removeAllViews();\n+        if (menu == null) {\n+            return;\n+        }\n+        for (int i = 0; i < menu.size(); i++) {\n+            MenuItem item = menu.getItem(i);\n+            if (!item.isVisible()) {\n+                continue;\n+            }\n+            FloatingSelectMenuItemBinding itemBinding = FloatingSelectMenuItemBinding.bind(\n+                    View.inflate(getContext(), R.layout.floating_select_menu_item, null));\n+            itemBinding.titleLabel.setText(item.getTitle());\n+            itemBinding.icon.setImageDrawable(item.getIcon());\n+            itemBinding.getRoot().setOnClickListener(view -> menuItemClickListener.onMenuItemClick(item));\n+            viewBinding.selectContainer.addView(itemBinding.getRoot());\n+        }\n+    }\n+\n+    public Menu getMenu() {\n+        return menu;\n+    }\n+\n+    public void setOnMenuItemClickListener(MenuItem.OnMenuItemClickListener listener) {\n+        this.menuItemClickListener = listener;\n+    }\n+\n+    @Override\n+    public void setVisibility(int visibility) {\n+        if (getVisibility() != View.VISIBLE && visibility == View.VISIBLE) {\n+            announceForAccessibility(getContext().getString(R.string.multi_select_started_talkback));\n+        }\n+        super.setVisibility(visibility);\n+        viewBinding.scrollView.scrollTo(0, 0);\n+        updateItemVisibility();\n+    }\n+}\ndiff --git a/app/src/main/res/layout/episodes_list_fragment.xml b/app/src/main/res/layout/episodes_list_fragment.xml\nindex d408f531ca..b88e677372 100644\n--- a/app/src/main/res/layout/episodes_list_fragment.xml\n+++ b/app/src/main/res/layout/episodes_list_fragment.xml\n@@ -58,7 +58,10 @@\n         android:layout_centerInParent=\"true\"\n         tools:background=\"@android:color/holo_red_light\" />\n \n-    <include\n-        layout=\"@layout/multi_select_speed_dial\" />\n+    <de.danoeh.antennapod.ui.view.FloatingSelectMenu\n+        android:id=\"@+id/floatingSelectMenu\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:layout_alignParentBottom=\"true\" />\n \n </RelativeLayout>\ndiff --git a/app/src/main/res/layout/feed_item_list_fragment.xml b/app/src/main/res/layout/feed_item_list_fragment.xml\nindex 23cbe0f05f..f236ee90a6 100644\n--- a/app/src/main/res/layout/feed_item_list_fragment.xml\n+++ b/app/src/main/res/layout/feed_item_list_fragment.xml\n@@ -76,7 +76,10 @@\n         android:visibility=\"gone\"\n         layout=\"@layout/more_content_list_footer\" />\n \n-    <include\n-        layout=\"@layout/multi_select_speed_dial\" />\n+    <de.danoeh.antennapod.ui.view.FloatingSelectMenu\n+        android:id=\"@+id/floatingSelectMenu\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:layout_gravity=\"bottom\" />\n \n </androidx.coordinatorlayout.widget.CoordinatorLayout>\ndiff --git a/app/src/main/res/layout/floating_select_menu.xml b/app/src/main/res/layout/floating_select_menu.xml\nnew file mode 100644\nindex 0000000000..4a72de0f7a\n--- /dev/null\n+++ b/app/src/main/res/layout/floating_select_menu.xml\n@@ -0,0 +1,31 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<FrameLayout\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"@dimen/floating_select_menu_height\">\n+\n+    <androidx.cardview.widget.CardView\n+        android:id=\"@+id/card\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"match_parent\"\n+        android:layout_marginHorizontal=\"16dp\"\n+        android:layout_marginBottom=\"16dp\"\n+        app:cardCornerRadius=\"16dp\">\n+\n+        <HorizontalScrollView\n+            android:id=\"@+id/scrollView\"\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"match_parent\">\n+\n+            <LinearLayout\n+                android:id=\"@+id/selectContainer\"\n+                android:layout_width=\"wrap_content\"\n+                android:layout_height=\"match_parent\"\n+                android:orientation=\"horizontal\" />\n+\n+        </HorizontalScrollView>\n+\n+    </androidx.cardview.widget.CardView>\n+\n+</FrameLayout>\ndiff --git a/app/src/main/res/layout/floating_select_menu_item.xml b/app/src/main/res/layout/floating_select_menu_item.xml\nnew file mode 100644\nindex 0000000000..e84acde586\n--- /dev/null\n+++ b/app/src/main/res/layout/floating_select_menu_item.xml\n@@ -0,0 +1,28 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<LinearLayout\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    android:layout_width=\"wrap_content\"\n+    android:layout_height=\"match_parent\"\n+    android:paddingHorizontal=\"2dp\"\n+    android:paddingVertical=\"8dp\"\n+    android:background=\"?attr/selectableItemBackgroundBorderless\"\n+    android:orientation=\"vertical\">\n+\n+    <ImageView\n+        android:id=\"@+id/icon\"\n+        android:layout_width=\"28dp\"\n+        android:layout_height=\"28dp\"\n+        android:layout_gravity=\"center_horizontal\"\n+        android:importantForAccessibility=\"no\" />\n+\n+    <TextView\n+        android:id=\"@id/titleLabel\"\n+        android:layout_width=\"96dp\"\n+        android:layout_height=\"wrap_content\"\n+        android:layout_marginTop=\"8dp\"\n+        android:textColor=\"?android:attr/textColorPrimary\"\n+        android:lines=\"2\"\n+        android:textAlignment=\"center\"\n+        android:ellipsize=\"end\" />\n+\n+</LinearLayout>\ndiff --git a/app/src/main/res/layout/fragment_subscriptions.xml b/app/src/main/res/layout/fragment_subscriptions.xml\nindex dbf0fc11d3..dc8b24e41d 100644\n--- a/app/src/main/res/layout/fragment_subscriptions.xml\n+++ b/app/src/main/res/layout/fragment_subscriptions.xml\n@@ -84,7 +84,10 @@\n         android:contentDescription=\"@string/add_feed_label\"\n         app:srcCompat=\"@drawable/ic_add\" />\n \n-    <include\n-        layout=\"@layout/multi_select_speed_dial\" />\n+    <de.danoeh.antennapod.ui.view.FloatingSelectMenu\n+        android:id=\"@+id/floatingSelectMenu\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:layout_alignParentBottom=\"true\" />\n \n </RelativeLayout>\ndiff --git a/app/src/main/res/layout/multi_select_speed_dial.xml b/app/src/main/res/layout/multi_select_speed_dial.xml\ndeleted file mode 100644\nindex 0451471bc5..0000000000\n--- a/app/src/main/res/layout/multi_select_speed_dial.xml\n+++ /dev/null\n@@ -1,41 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"utf-8\"?>\n-<merge\n-    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n-    xmlns:app=\"http://schemas.android.com/apk/res-auto\">\n-\n-    <com.leinardi.android.speeddial.SpeedDialOverlayLayout\n-        android:id=\"@+id/fabSDOverlay\"\n-        android:layout_width=\"match_parent\"\n-        android:layout_height=\"match_parent\"\n-        android:importantForAccessibility=\"no\" />\n-\n-    <!-- The FAB SpeedDial\n-         1. MUST be placed at the bottom of the layout xml to ensure it is at the front,\n-            clickable on Pre-Lollipop devices (that do not support elevation).\n-            See: https://stackoverflow.com/a/2614402\n-         2. ScrollView is needed to ensure the vertical list of speed dials are\n-            accessible when screen height is small, eg., landscape mode on most phones.\n-      -->\n-    <ScrollView\n-        android:id=\"@+id/fabSDScrollCtr\"\n-        android:layout_width=\"wrap_content\"\n-        android:layout_height=\"wrap_content\"\n-        android:layout_gravity=\"bottom|right\"\n-        android:layout_alignParentBottom=\"true\"\n-        android:layout_alignParentEnd=\"true\"\n-        android:layout_alignParentRight=\"true\"\n-        android:elevation=\"@dimen/sd_open_elevation\">\n-\n-        <com.leinardi.android.speeddial.SpeedDialView\n-            android:id=\"@+id/fabSD\"\n-            android:layout_width=\"match_parent\"\n-            android:layout_height=\"wrap_content\"\n-            android:accessibilityTraversalBefore=\"@android:id/list\"\n-            android:contentDescription=\"@string/apply_action\"\n-            android:visibility=\"gone\"\n-            app:sdMainFabClosedSrc=\"@drawable/ic_fab_edit\"\n-            app:sdOverlayLayout=\"@id/fabSDOverlay\" />\n-\n-    </ScrollView>\n-\n-</merge>\ndiff --git a/app/src/main/res/layout/queue_fragment.xml b/app/src/main/res/layout/queue_fragment.xml\nindex 801c9e93ac..f42df9f9b8 100644\n--- a/app/src/main/res/layout/queue_fragment.xml\n+++ b/app/src/main/res/layout/queue_fragment.xml\n@@ -57,7 +57,10 @@\n         android:indeterminateOnly=\"true\"\n         android:visibility=\"gone\" />\n \n-    <include\n-        layout=\"@layout/multi_select_speed_dial\" />\n+    <de.danoeh.antennapod.ui.view.FloatingSelectMenu\n+        android:id=\"@+id/floatingSelectMenu\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:layout_alignParentBottom=\"true\" />\n \n </RelativeLayout>\ndiff --git a/app/src/main/res/layout/search_fragment.xml b/app/src/main/res/layout/search_fragment.xml\nindex 59853a9ee8..e398bb83d9 100644\n--- a/app/src/main/res/layout/search_fragment.xml\n+++ b/app/src/main/res/layout/search_fragment.xml\n@@ -61,7 +61,10 @@\n         android:paddingTop=\"12dp\"\n         android:paddingHorizontal=\"@dimen/additional_horizontal_spacing\" />\n \n-    <include\n-        layout=\"@layout/multi_select_speed_dial\" />\n+    <de.danoeh.antennapod.ui.view.FloatingSelectMenu\n+        android:id=\"@+id/floatingSelectMenu\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:layout_alignParentBottom=\"true\" />\n \n </RelativeLayout>\ndiff --git a/app/src/main/res/layout/simple_list_fragment.xml b/app/src/main/res/layout/simple_list_fragment.xml\nindex 273a088465..3972e419e5 100644\n--- a/app/src/main/res/layout/simple_list_fragment.xml\n+++ b/app/src/main/res/layout/simple_list_fragment.xml\n@@ -36,7 +36,10 @@\n         android:indeterminateOnly=\"true\"\n         android:visibility=\"gone\" />\n \n-    <include\n-        layout=\"@layout/multi_select_speed_dial\" />\n+    <de.danoeh.antennapod.ui.view.FloatingSelectMenu\n+        android:id=\"@+id/floatingSelectMenu\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:layout_gravity=\"bottom\" />\n \n </androidx.coordinatorlayout.widget.CoordinatorLayout>\ndiff --git a/app/src/main/res/values/dimens.xml b/app/src/main/res/values/dimens.xml\nindex 1020df1354..6e468096e6 100644\n--- a/app/src/main/res/values/dimens.xml\n+++ b/app/src/main/res/values/dimens.xml\n@@ -3,4 +3,5 @@\n     <dimen name=\"additional_horizontal_spacing\">0dp</dimen>\n     <!-- Should match with @dimen/m3_navigation_drawer_layout_corner_size -->\n     <dimen name=\"drawer_corner_size\">16dp</dimen>\n+    <dimen name=\"floating_select_menu_height\">112dp</dimen>\n </resources>\n\\ No newline at end of file\ndiff --git a/ui/common/src/main/res/drawable/ic_fab_edit.xml b/ui/common/src/main/res/drawable/ic_fab_edit.xml\ndeleted file mode 100644\nindex 6fd80e29fd..0000000000\n--- a/ui/common/src/main/res/drawable/ic_fab_edit.xml\n+++ /dev/null\n@@ -1,5 +0,0 @@\n-<vector android:height=\"24dp\"\n-    android:viewportHeight=\"24.0\" android:viewportWidth=\"24.0\"\n-    android:width=\"24dp\" xmlns:android=\"http://schemas.android.com/apk/res/android\">\n-    <path android:fillColor=\"?attr/colorOnPrimary\" android:pathData=\"M3,17.25V21h3.75L17.81,9.94l-3.75,-3.75L3,17.25zM20.71,7.04c0.39,-0.39 0.39,-1.02 0,-1.41l-2.34,-2.34c-0.39,-0.39 -1.02,-0.39 -1.41,0l-1.83,1.83 3.75,3.75 1.83,-1.83z\"/>\n-</vector>\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 884e99ac94..a840a1abfe 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -194,6 +194,7 @@\n     <string name=\"multi_select\">Multi select</string>\n     <string name=\"select_all_above\">Select all above</string>\n     <string name=\"select_all_below\">Select all below</string>\n+    <string name=\"multi_select_started_talkback\">Multi select actions shown at the bottom</string>\n     <string name=\"filtered_label\">Filtered</string>\n     <string name=\"refresh_failed_msg\">Last refresh failed. Tap to view details.</string>\n     <string name=\"open_podcast\">Open podcast</string>\n@@ -699,7 +700,6 @@\n     <string name=\"load_next_page_label\">Load next page</string>\n     <string name=\"position\">Position: %1$s</string>\n     <string name=\"remaining_time\">Remaining time: %1$s</string>\n-    <string name=\"apply_action\">Apply action</string>\n     <string name=\"play_chapter\">Play chapter</string>\n     <string name=\"prev_chapter\">Previous chapter</string>\n     <string name=\"next_chapter\">Next chapter</string>\ndiff --git a/ui/preferences/src/main/assets/licenses.xml b/ui/preferences/src/main/assets/licenses.xml\nindex e6745e4f5e..804073dd65 100644\n--- a/ui/preferences/src/main/assets/licenses.xml\n+++ b/ui/preferences/src/main/assets/licenses.xml\n@@ -42,12 +42,6 @@\n         website=\"https://github.com/google/ExoPlayer\"\n         license=\"Apache 2.0\"\n         licenseText=\"LICENSE_APACHE-2.0.txt\" />\n-    <library\n-        name=\"Floating Action Button Speed Dial\"\n-        author=\"Roberto Leinardi\"\n-        website=\"https://github.com/leinardi/FloatingActionButtonSpeedDial\"\n-        license=\"Apache 2.0\"\n-        licenseText=\"LICENSE_APACHE-2.0.txt\" />\n     <library\n         name=\"fyydlin\"\n         author=\"Martin Fietz\"\n", "test_patch": "", "problem_statement": "Move multi-select actions from floating action button to top toolbar\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.3.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Problem you may be having, or feature you want\n\nAlmost all other apps that I tried show their multi-select actions in the top toolbar. AntennaPod shows them as an action button in the bottom. This is not intuitive for users (see https://forum.antennapod.org/t/merge-multi-select-and-long-press-menu-on-single-episode/2579/4). Another reason to switch is that the floating action button library caused quite a few problems in the past. Switching to the toolbar would allow removing the library.\n\n### Suggested solution\n\nUse the top toolbar like other apps\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "Wouldn't the same argument (simplification, it's what other apps do) apply to the long-press menu? I have the impression that differentiating single-select and multi-select is the exception nowadays.\r\n\r\nIf the top bar is too crowded or hard to reach, there are examples of apps using a bottom sheet or bar (e.g. Google Photos uses a horizontally scrollable bottom sheet with fully labelled icons, which is overlaid on top of the bottom navigation).\nI'm personally impartial to removing SpeedDial. I like the current speed dial multi-select actions, but I wouldn't be against switching to just using the top toolbar.\r\n\r\nObviously the users are going to be the ones you have to ask about this. I think this question should be asked on the AntennaPod forum for user feedback.\n> Wouldn't the same argument (simplification, it's what other apps do) apply to the long-press menu? I have the impression that differentiating single-select and multi-select is the exception nowadays.\r\n\r\nYes, that's one more reason to make it more standard compliant. Though I would start with multi-select for now because that's less intrusive. Changing the long-press menu will probably make some people not happy. Though I would say that most of the long-press options (except for maybe \"move to top/bottom\" in the queue) can be achieved with swipe actions anyway, so maybe it is okay if the options are a bit harder to reach.\nI had a look at a bunch of apps on my phone where I can multi-select. Basically every app does it via the header bar, indicating the current selection number (not the total number of episodes. Some have 'selected', some only the number.\n\nI like our FAB but cannot deny that the top bar is a common pattern. from the apps on my phone only Signal & FairEmail deviate from that pattern:\n![Imagepipe_1.jpg](https://github.com/AntennaPod/AntennaPod/assets/11229646/d79af8fc-a11c-497b-a240-a3b5e30eaf07)\n![Imagepipe_0.jpg](https://github.com/AntennaPod/AntennaPod/assets/11229646/c0219a34-3e91-4951-87c3-309bd1657704)\n\nSo I'm on board with this change. We just have to identify per screen which icons we'll put in the top bar, and which ones will be in the overflow.\nI don't think we can show much more than just 2 icons by default. For these, I would use (consistently across all screens) the first single-select long-press actions \"mark as played\" and \"add to queue\" (because in the future, we might want to migrate single-select to always start multi-select).\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/mark-all-newer-older-episodes-as-played-after-selected-one/4236/8\n", "created_at": "2024-04-13T18:40:20Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7085, "instance_id": "AntennaPod__AntennaPod-7085", "issue_numbers": ["7083"], "base_commit": "863d4c3b611df83389d82958114bfd2d1204e457", "patch": "diff --git a/net/sync/gpoddernet/src/main/java/de/danoeh/antennapod/net/sync/nextcloud/NextcloudSyncService.java b/net/sync/gpoddernet/src/main/java/de/danoeh/antennapod/net/sync/nextcloud/NextcloudSyncService.java\nindex e98976c811..692d7028ac 100644\n--- a/net/sync/gpoddernet/src/main/java/de/danoeh/antennapod/net/sync/nextcloud/NextcloudSyncService.java\n+++ b/net/sync/gpoddernet/src/main/java/de/danoeh/antennapod/net/sync/nextcloud/NextcloudSyncService.java\n@@ -16,6 +16,8 @@\n import okhttp3.Request;\n import okhttp3.RequestBody;\n import okhttp3.Response;\n+\n+import org.apache.commons.lang3.StringUtils;\n import org.json.JSONArray;\n import org.json.JSONException;\n import org.json.JSONObject;\n@@ -148,7 +150,7 @@ private HttpUrl.Builder makeUrl(String path) {\n                 .scheme(hostname.scheme)\n                 .host(hostname.host)\n                 .port(hostname.port)\n-                .addPathSegments(hostname.subfolder + path);\n+                .addPathSegments(StringUtils.stripStart(hostname.subfolder + path, \"/\"));\n     }\n \n     @Override\n", "test_patch": "", "problem_statement": "Nextcloud Gpodder sync using wrong url\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n### App version\r\n\r\n3.3.2f\r\n\r\n### Where did you get the app from\r\n\r\nF-Droid\r\n\r\n### Android version\r\n\r\n11\r\n\r\n### Device model\r\n\r\nPixel 7a\r\n\r\n### First occurred\r\n\r\n_No response_\r\n\r\n### Steps to reproduce\r\n\r\n1. In [NextcloudSyncService.java](https://github.com/AntennaPod/AntennaPod/blob/863d4c3b611df83389d82958114bfd2d1204e457/net/sync/gpoddernet/src/main/java/de/danoeh/antennapod/net/sync/nextcloud/NextcloudSyncService.java#L50) set a breakpoint for one of the `makeUrl` calls.\r\n2. Run the app and execute a sync with the a nextcloud gpodder server.\r\n3. Go back into AndroidStudio and look at the url returned by `makeUrl`\r\n\r\n### Expected behaviour\r\n\r\nUrl should be something like this: `https://example.com/index.php/apps/gpoddersync/subscriptions`\r\n\r\n### Current behaviour\r\n\r\nUrl is: `https://example.com//index.php/apps/gpoddersync/subscriptions`\r\n\r\nSo the url contains a double slash at the start of the path where a single slash should be. Interestingly nextcloud still accepts this without issues.\r\nHere is a simple [fix](https://github.com/tomhense/AntennaPod/tree/fix-nextcloud-urls). I have tested this fix using a current nextcloud version and it works without problems.\r\n\r\n### Logs\r\n\r\n_No response_\n", "hints_text": "", "created_at": "2024-04-12T16:43:42Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7076, "instance_id": "AntennaPod__AntennaPod-7076", "issue_numbers": ["6974"], "base_commit": "e578f4ca93f6292f62e4b4c7fa11d17fe0b27c71", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeMultiSelectActionHandler.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeMultiSelectActionHandler.java\nindex 2a9f76939b..76ed47de53 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeMultiSelectActionHandler.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeMultiSelectActionHandler.java\n@@ -91,12 +91,14 @@ private void markedCheckedUnplayed(List<FeedItem> items) {\n \n     private void downloadChecked(List<FeedItem> items) {\n         // download the check episodes in the same order as they are currently displayed\n+        int downloaded = 0;\n         for (FeedItem episode : items) {\n-            if (episode.hasMedia() && !episode.getFeed().isLocalFeed()) {\n+            if (episode.hasMedia() && !episode.isDownloaded() && !episode.getFeed().isLocalFeed()) {\n                 DownloadServiceInterface.get().download(activity, episode);\n+                downloaded++;\n             }\n         }\n-        showMessage(R.plurals.downloading_batch_label, items.size());\n+        showMessage(R.plurals.downloading_batch_label, downloaded);\n     }\n \n     private void deleteChecked(List<FeedItem> items) {\ndiff --git a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/DownloadServiceInterfaceImpl.java b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/DownloadServiceInterfaceImpl.java\nindex 37a7f30e0d..0b5be92b85 100644\n--- a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/DownloadServiceInterfaceImpl.java\n+++ b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/DownloadServiceInterfaceImpl.java\n@@ -36,6 +36,9 @@ public void downloadNow(Context context, FeedItem item, boolean ignoreConstraint\n     }\n \n     public void download(Context context, FeedItem item) {\n+        if (item.isDownloaded()) {\n+            return;\n+        }\n         OneTimeWorkRequest.Builder workRequest = getRequest(context, item);\n         workRequest.setConstraints(getConstraints());\n         WorkManager.getInstance(context).enqueueUniqueWork(item.getMedia().getDownloadUrl(),\n", "test_patch": "", "problem_statement": "Re-downloading a downloaded episode using multi-select\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.3.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n-\n\n### Device model\n\n-\n\n### First occurred\n\n-\n\n### Steps to reproduce\n\n- Download an episode\r\n- Multi-select it\r\n- Press \"download\"\n\n### Expected behaviour\n\nNothing happens (or an error message)\n\n### Current behaviour\n\nIt tries re-downloading\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2024-04-09T19:20:17Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7060, "instance_id": "AntennaPod__AntennaPod-7060", "issue_numbers": ["4661"], "base_commit": "2143ab135182434911d4554a8ef08115eaa0d2d0", "patch": "diff --git a/app/build.gradle b/app/build.gradle\nindex 449488f587..b96b966778 100644\n--- a/app/build.gradle\n+++ b/app/build.gradle\n@@ -62,7 +62,6 @@ android {\n }\n \n dependencies {\n-    implementation project(\":core\")\n     implementation project(\":event\")\n     implementation project(':model')\n     implementation project(':net:common')\n@@ -91,6 +90,7 @@ dependencies {\n     implementation project(':ui:statistics')\n     implementation project(':net:sync:service-interface')\n     implementation project(':playback:service')\n+    implementation project(':ui:chapters')\n \n     annotationProcessor \"androidx.annotation:annotation:$annotationVersion\"\n     implementation \"androidx.appcompat:appcompat:$appcompatVersion\"\ndiff --git a/app/src/main/AndroidManifest.xml b/app/src/main/AndroidManifest.xml\nindex 3d608133fd..81b809c898 100644\n--- a/app/src/main/AndroidManifest.xml\n+++ b/app/src/main/AndroidManifest.xml\n@@ -4,12 +4,15 @@\n     android:installLocation=\"auto\">\n \n     <uses-permission android:name=\"android.permission.INTERNET\"/>\n-    <uses-permission android:name=\"android.permission.WRITE_EXTERNAL_STORAGE\"\n-        tools:ignore=\"ScopedStorage\" />\n+    <uses-permission android:name=\"android.permission.WRITE_EXTERNAL_STORAGE\" tools:ignore=\"ScopedStorage\" />\n     <uses-permission android:name=\"android.permission.WAKE_LOCK\"/>\n     <uses-permission android:name=\"android.permission.ACCESS_NETWORK_STATE\"/>\n     <uses-permission android:name=\"android.permission.FOREGROUND_SERVICE\"/>\n     <uses-permission android:name=\"android.permission.POST_NOTIFICATIONS\"/>\n+    <uses-permission android:name=\"android.permission.ACCESS_WIFI_STATE\" />\n+    <uses-permission android:name=\"android.permission.RECEIVE_BOOT_COMPLETED\" />\n+    <uses-permission android:name=\"android.permission.BLUETOOTH\" />\n+    <uses-permission android:name=\"android.permission.VIBRATE\" />\n \n     <supports-screens\n         android:anyDensity=\"true\"\ndiff --git a/core/src/main/assets/shownotes-style.css b/app/src/main/assets/shownotes-style.css\nsimilarity index 100%\nrename from core/src/main/assets/shownotes-style.css\nrename to app/src/main/assets/shownotes-style.css\ndiff --git a/app/src/main/java/de/danoeh/antennapod/actionbutton/VisitWebsiteActionButton.java b/app/src/main/java/de/danoeh/antennapod/actionbutton/VisitWebsiteActionButton.java\nindex dbe937c140..1c781fee0e 100644\n--- a/app/src/main/java/de/danoeh/antennapod/actionbutton/VisitWebsiteActionButton.java\n+++ b/app/src/main/java/de/danoeh/antennapod/actionbutton/VisitWebsiteActionButton.java\n@@ -6,7 +6,7 @@\n import androidx.annotation.StringRes;\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.model.feed.FeedItem;\n-import de.danoeh.antennapod.core.util.IntentUtils;\n+import de.danoeh.antennapod.ui.common.IntentUtils;\n \n public class VisitWebsiteActionButton extends ItemActionButton {\n \ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/cleaner/ShownotesCleaner.java b/app/src/main/java/de/danoeh/antennapod/ui/cleaner/ShownotesCleaner.java\nindex 57f91e35c9..03ce01d5e4 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/cleaner/ShownotesCleaner.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/cleaner/ShownotesCleaner.java\n@@ -22,7 +22,7 @@\n import java.util.regex.Matcher;\n import java.util.regex.Pattern;\n \n-import de.danoeh.antennapod.core.R;\n+import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.ui.common.Converter;\n \n /**\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemListAdapter.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemListAdapter.java\nindex cb026240a8..34f4739536 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemListAdapter.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodeItemListAdapter.java\n@@ -16,7 +16,6 @@\n \n import de.danoeh.antennapod.ui.SelectableAdapter;\n import de.danoeh.antennapod.ui.common.ThemeUtils;\n-import org.apache.commons.lang3.ArrayUtils;\n \n import java.lang.ref.WeakReference;\n import java.util.ArrayList;\n@@ -25,7 +24,6 @@\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n import de.danoeh.antennapod.model.feed.FeedItem;\n-import de.danoeh.antennapod.core.util.FeedItemUtil;\n import de.danoeh.antennapod.ui.screen.episode.ItemPagerFragment;\n \n /**\n@@ -90,9 +88,7 @@ public final void onBindViewHolder(EpisodeItemViewHolder holder, int pos) {\n         holder.itemView.setOnClickListener(v -> {\n             MainActivity activity = mainActivityRef.get();\n             if (activity != null && !inActionMode()) {\n-                long[] ids = FeedItemUtil.getIds(episodes);\n-                int position = ArrayUtils.indexOf(ids, item.getId());\n-                activity.loadChildFragment(ItemPagerFragment.newInstance(ids, position));\n+                activity.loadChildFragment(ItemPagerFragment.newInstance(episodes, item));\n             } else {\n                 toggleSelection(holder.getBindingAdapterPosition());\n             }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodesListFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodesListFragment.java\nindex 054183f7c2..90f7cf1e53 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodesListFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/EpisodesListFragment.java\n@@ -36,9 +36,8 @@\n \n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n-import de.danoeh.antennapod.core.util.ConfirmationDialog;\n+import de.danoeh.antennapod.ui.common.ConfirmationDialog;\n import de.danoeh.antennapod.ui.MenuItemUtils;\n-import de.danoeh.antennapod.core.util.FeedItemUtil;\n import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FeedItemEvent;\n import de.danoeh.antennapod.event.FeedListUpdateEvent;\n@@ -334,7 +333,7 @@ public void onEndSelectMode() {\n     public void onEventMainThread(FeedItemEvent event) {\n         Log.d(TAG, \"onEventMainThread() called with: \" + \"event = [\" + event + \"]\");\n         for (FeedItem item : event.items) {\n-            int pos = FeedItemUtil.indexOfItemWithId(episodes, item.getId());\n+            int pos = FeedItemEvent.indexOfItemWithId(episodes, item.getId());\n             if (pos >= 0) {\n                 episodes.remove(pos);\n                 if (getFilter().matches(item)) {\n@@ -378,7 +377,7 @@ public void onKeyUp(KeyEvent event) {\n     @Subscribe(sticky = true, threadMode = ThreadMode.MAIN)\n     public void onEventMainThread(EpisodeDownloadEvent event) {\n         for (String downloadUrl : event.getUrls()) {\n-            int pos = FeedItemUtil.indexOfItemWithDownloadUrl(episodes, downloadUrl);\n+            int pos = EpisodeDownloadEvent.indexOfItemWithDownloadUrl(episodes, downloadUrl);\n             if (pos >= 0) {\n                 listAdapter.notifyItemChangedCompat(pos);\n             }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java\nindex 12b455d1f8..55f865ef65 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/FeedItemMenuHandler.java\n@@ -18,12 +18,10 @@\n import de.danoeh.antennapod.activity.MainActivity;\n import de.danoeh.antennapod.net.sync.serviceinterface.SynchronizationQueueSink;\n import de.danoeh.antennapod.storage.preferences.PlaybackPreferences;\n-import de.danoeh.antennapod.core.util.FeedUtil;\n import de.danoeh.antennapod.playback.service.PlaybackServiceInterface;\n import de.danoeh.antennapod.storage.database.DBWriter;\n import de.danoeh.antennapod.storage.preferences.SynchronizationSettings;\n-import de.danoeh.antennapod.core.util.FeedItemUtil;\n-import de.danoeh.antennapod.core.util.IntentUtils;\n+import de.danoeh.antennapod.ui.common.IntentUtils;\n import de.danoeh.antennapod.playback.service.PlaybackStatus;\n import de.danoeh.antennapod.ui.share.ShareUtils;\n import de.danoeh.antennapod.ui.share.ShareDialog;\n@@ -198,7 +196,7 @@ public static boolean onMenuItemClicked(@NonNull Fragment fragment, int menuItem\n             }\n             DBWriter.markItemPlayed(selectedItem, FeedItem.UNPLAYED, true);\n         } else if (menuItemId == R.id.visit_website_item) {\n-            IntentUtils.openInBrowser(context, FeedItemUtil.getLinkWithFallback(selectedItem));\n+            IntentUtils.openInBrowser(context, selectedItem.getLinkWithFallback());\n         } else if (menuItemId == R.id.share_item) {\n             ShareDialog shareDialog = ShareDialog.newInstance(selectedItem);\n             shareDialog.show((fragment.getActivity().getSupportFragmentManager()), \"ShareEpisodeDialog\");\n@@ -234,7 +232,8 @@ public static void markReadWithUndo(@NonNull Fragment fragment, FeedItem item,\n             if (media == null) {\n                 return;\n             }\n-            boolean shouldAutoDelete = FeedUtil.shouldAutoDeleteItemsOnThatFeed(item.getFeed());\n+            boolean shouldAutoDelete = UserPreferences.isAutoDelete()\n+                    && (!item.getFeed().isLocalFeed() || UserPreferences.isAutoDeleteLocal());\n             int smartMarkAsPlayedSecs = UserPreferences.getSmartMarkAsPlayedSecs();\n             boolean almostEnded = media.getDuration() > 0\n                     && media.getPosition() >= media.getDuration() - smartMarkAsPlayedSecs * 1000;\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/HorizontalItemListAdapter.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/HorizontalItemListAdapter.java\nindex f40851ec2b..d4407bf865 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/HorizontalItemListAdapter.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/HorizontalItemListAdapter.java\n@@ -9,10 +9,8 @@\n import androidx.recyclerview.widget.RecyclerView;\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n-import de.danoeh.antennapod.core.util.FeedItemUtil;\n import de.danoeh.antennapod.ui.screen.episode.ItemPagerFragment;\n import de.danoeh.antennapod.model.feed.FeedItem;\n-import org.apache.commons.lang3.ArrayUtils;\n \n import java.lang.ref.WeakReference;\n import java.util.ArrayList;\n@@ -68,9 +66,7 @@ public void onBindViewHolder(@NonNull HorizontalItemViewHolder holder, int posit\n         holder.card.setOnClickListener(v -> {\n             MainActivity activity = mainActivityRef.get();\n             if (activity != null) {\n-                long[] ids = FeedItemUtil.getIds(data);\n-                int clickPosition = ArrayUtils.indexOf(ids, item.getId());\n-                activity.loadChildFragment(ItemPagerFragment.newInstance(ids, clickPosition));\n+                activity.loadChildFragment(ItemPagerFragment.newInstance(data, item));\n             }\n         });\n     }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/MoreContentListFooterUtil.java b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/MoreContentListFooterUtil.java\nindex fe9ce71f02..d120e5943c 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/MoreContentListFooterUtil.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/episodeslist/MoreContentListFooterUtil.java\n@@ -3,8 +3,7 @@\n import android.view.View;\n import android.widget.ImageView;\n import android.widget.ProgressBar;\n-\n-import de.danoeh.antennapod.core.R;\n+import de.danoeh.antennapod.R;\n \n /**\n  * Utility methods for the more_content_list_footer layout.\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/PlaybackHistoryFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/PlaybackHistoryFragment.java\nindex 4efdf38a3c..a02f86bd21 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/PlaybackHistoryFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/PlaybackHistoryFragment.java\n@@ -8,7 +8,7 @@\n import android.view.ViewGroup;\n import androidx.annotation.NonNull;\n import de.danoeh.antennapod.R;\n-import de.danoeh.antennapod.core.util.ConfirmationDialog;\n+import de.danoeh.antennapod.ui.common.ConfirmationDialog;\n import de.danoeh.antennapod.storage.database.DBReader;\n import de.danoeh.antennapod.storage.database.DBWriter;\n import de.danoeh.antennapod.event.playback.PlaybackHistoryEvent;\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/SearchFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/SearchFragment.java\nindex 8e21117b3d..85d837a511 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/SearchFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/SearchFragment.java\n@@ -40,7 +40,6 @@\n import de.danoeh.antennapod.ui.episodeslist.EpisodeMultiSelectActionHandler;\n import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.model.feed.FeedItem;\n-import de.danoeh.antennapod.core.util.FeedItemUtil;\n import de.danoeh.antennapod.ui.episodeslist.FeedItemMenuHandler;\n import de.danoeh.antennapod.net.discovery.CombinedSearcher;\n import de.danoeh.antennapod.storage.database.DBReader;\n@@ -327,7 +326,7 @@ public void onEventMainThread(FeedItemEvent event) {\n         }\n         for (int i = 0, size = event.items.size(); i < size; i++) {\n             FeedItem item = event.items.get(i);\n-            int pos = FeedItemUtil.indexOfItemWithId(results, item.getId());\n+            int pos = FeedItemEvent.indexOfItemWithId(results, item.getId());\n             if (pos >= 0) {\n                 results.remove(pos);\n                 results.add(pos, item);\n@@ -342,7 +341,7 @@ public void onEventMainThread(EpisodeDownloadEvent event) {\n             return;\n         }\n         for (String downloadUrl : event.getUrls()) {\n-            int pos = FeedItemUtil.indexOfItemWithDownloadUrl(results, downloadUrl);\n+            int pos = EpisodeDownloadEvent.indexOfItemWithDownloadUrl(results, downloadUrl);\n             if (pos >= 0) {\n                 adapter.notifyItemChangedCompat(pos);\n             }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/chapter/ChaptersFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/chapter/ChaptersFragment.java\nindex f1dcbf415d..8fea6e209e 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/chapter/ChaptersFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/chapter/ChaptersFragment.java\n@@ -19,13 +19,13 @@\n import androidx.recyclerview.widget.RecyclerView;\n import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import de.danoeh.antennapod.R;\n-import de.danoeh.antennapod.core.util.ChapterUtils;\n import de.danoeh.antennapod.event.playback.PlaybackPositionEvent;\n import de.danoeh.antennapod.model.feed.Chapter;\n import de.danoeh.antennapod.model.feed.FeedMedia;\n import de.danoeh.antennapod.model.playback.Playable;\n import de.danoeh.antennapod.playback.base.PlayerStatus;\n import de.danoeh.antennapod.playback.service.PlaybackController;\n+import de.danoeh.antennapod.ui.chapters.ChapterUtils;\n import io.reactivex.Maybe;\n import io.reactivex.android.schedulers.AndroidSchedulers;\n import io.reactivex.disposables.Disposable;\n@@ -130,7 +130,7 @@ private int getCurrentChapter(Playable media) {\n         if (controller == null) {\n             return -1;\n         }\n-        return ChapterUtils.getCurrentChapterIndex(media, controller.getPosition());\n+        return Chapter.getAfterPosition(media.getChapters(), controller.getPosition());\n     }\n \n     private void loadMediaInfo(boolean forceRefresh) {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/chapter/ChaptersListAdapter.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/chapter/ChaptersListAdapter.java\nindex 33e55a7e20..bf84b7bd73 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/chapter/ChaptersListAdapter.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/chapter/ChaptersListAdapter.java\n@@ -19,7 +19,7 @@\n import de.danoeh.antennapod.model.feed.Chapter;\n import de.danoeh.antennapod.ui.common.Converter;\n import de.danoeh.antennapod.model.feed.EmbeddedChapterImage;\n-import de.danoeh.antennapod.core.util.IntentUtils;\n+import de.danoeh.antennapod.ui.common.IntentUtils;\n import de.danoeh.antennapod.model.playback.Playable;\n import de.danoeh.antennapod.ui.common.CircularProgressBar;\n \ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java\nindex 15be1e2307..260f3e6a03 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/download/CompletedDownloadsFragment.java\n@@ -23,7 +23,6 @@\n import de.danoeh.antennapod.ui.screen.SearchFragment;\n import de.danoeh.antennapod.net.download.serviceinterface.FeedUpdateManager;\n import de.danoeh.antennapod.storage.database.DBReader;\n-import de.danoeh.antennapod.core.util.FeedItemUtil;\n import de.danoeh.antennapod.ui.screen.feed.ItemSortDialog;\n import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FeedItemEvent;\n@@ -209,7 +208,7 @@ public void onEventMainThread(EpisodeDownloadEvent event) {\n             return; // Refreshed anyway\n         }\n         for (String downloadUrl : event.getUrls()) {\n-            int pos = FeedItemUtil.indexOfItemWithDownloadUrl(items, downloadUrl);\n+            int pos = EpisodeDownloadEvent.indexOfItemWithDownloadUrl(items, downloadUrl);\n             if (pos >= 0) {\n                 adapter.notifyItemChangedCompat(pos);\n             }\n@@ -249,7 +248,7 @@ public void onEventMainThread(FeedItemEvent event) {\n         }\n         for (int i = 0, size = event.items.size(); i < size; i++) {\n             FeedItem item = event.items.get(i);\n-            int pos = FeedItemUtil.indexOfItemWithId(items, item.getId());\n+            int pos = FeedItemEvent.indexOfItemWithId(items, item.getId());\n             if (pos >= 0) {\n                 items.remove(pos);\n                 if (item.getMedia().isDownloaded()) {\n@@ -305,7 +304,7 @@ private void loadItems() {\n                 return downloadedItems;\n             }\n             for (String url : runningDownloads) {\n-                if (FeedItemUtil.indexOfItemWithDownloadUrl(downloadedItems, url) != -1) {\n+                if (EpisodeDownloadEvent.indexOfItemWithDownloadUrl(downloadedItems, url) != -1) {\n                     continue; // Already in list\n                 }\n                 mediaUrls.add(url);\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/download/DownloadErrorLabel.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/download/DownloadErrorLabel.java\nindex e5eedd54b9..7940146dbd 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/download/DownloadErrorLabel.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/download/DownloadErrorLabel.java\n@@ -1,8 +1,8 @@\n package de.danoeh.antennapod.ui.screen.download;\n \n import androidx.annotation.StringRes;\n-import de.danoeh.antennapod.core.BuildConfig;\n-import de.danoeh.antennapod.core.R;\n+import de.danoeh.antennapod.BuildConfig;\n+import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.model.download.DownloadError;\n \n /**\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/drawer/NavDrawerFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/drawer/NavDrawerFragment.java\nindex 98690e0cf9..b6580575ab 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/drawer/NavDrawerFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/drawer/NavDrawerFragment.java\n@@ -55,7 +55,7 @@\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n import de.danoeh.antennapod.ui.screen.preferences.PreferenceActivity;\n-import de.danoeh.antennapod.core.util.ConfirmationDialog;\n+import de.danoeh.antennapod.ui.common.ConfirmationDialog;\n import de.danoeh.antennapod.ui.MenuItemUtils;\n import de.danoeh.antennapod.storage.database.DBReader;\n import de.danoeh.antennapod.storage.database.DBWriter;\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/episode/ItemPagerFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/episode/ItemPagerFragment.java\nindex 5240665874..e7f3456175 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/episode/ItemPagerFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/episode/ItemPagerFragment.java\n@@ -29,6 +29,8 @@\n import io.reactivex.disposables.Disposable;\n import io.reactivex.schedulers.Schedulers;\n \n+import java.util.List;\n+\n /**\n  * Displays information about a list of FeedItems.\n  */\n@@ -41,15 +43,21 @@ public class ItemPagerFragment extends Fragment implements MaterialToolbar.OnMen\n     /**\n      * Creates a new instance of an ItemPagerFragment.\n      *\n-     * @param feeditems   The IDs of the FeedItems that belong to the same list\n-     * @param feedItemPos The position of the FeedItem that is currently shown\n      * @return The ItemFragment instance\n      */\n-    public static ItemPagerFragment newInstance(long[] feeditems, int feedItemPos) {\n+    public static ItemPagerFragment newInstance(List<FeedItem> allItems, FeedItem currentItem) {\n+        int position = 0;\n+        long[] ids = new long[allItems.size()];\n+        for (int i = 0; i < allItems.size(); i++) {\n+            ids[i] = allItems.get(i).getId();\n+            if (ids[i] == currentItem.getId()) {\n+                position = i;\n+            }\n+        }\n         ItemPagerFragment fragment = new ItemPagerFragment();\n         Bundle args = new Bundle();\n-        args.putLongArray(ARG_FEEDITEMS, feeditems);\n-        args.putInt(ARG_FEEDITEM_POS, Math.max(0, feedItemPos));\n+        args.putLongArray(ARG_FEEDITEMS, ids);\n+        args.putInt(ARG_FEEDITEM_POS, position);\n         fragment.setArguments(args);\n         return fragment;\n     }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedInfoFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedInfoFragment.java\nindex 3e7fd3cdc9..929a68ffff 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedInfoFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedInfoFragment.java\n@@ -37,7 +37,7 @@\n import de.danoeh.antennapod.ui.TransitionEffect;\n import de.danoeh.antennapod.storage.database.DBReader;\n import de.danoeh.antennapod.storage.database.FeedDatabaseWriter;\n-import de.danoeh.antennapod.core.util.IntentUtils;\n+import de.danoeh.antennapod.ui.common.IntentUtils;\n import de.danoeh.antennapod.ui.share.ShareUtils;\n import de.danoeh.antennapod.ui.cleaner.HtmlToPlainText;\n import de.danoeh.antennapod.model.feed.Feed;\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemFilterGroup.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemFilterGroup.java\nindex 5cb0f36fd9..b19d680daf 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemFilterGroup.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemFilterGroup.java\n@@ -1,6 +1,6 @@\n package de.danoeh.antennapod.ui.screen.feed;\n \n-import de.danoeh.antennapod.core.R;\n+import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n \n public enum FeedItemFilterGroup {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\nindex 7743f1cd9d..b4a2556d1d 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/FeedItemlistFragment.java\n@@ -50,8 +50,7 @@\n import de.danoeh.antennapod.storage.database.DBReader;\n import de.danoeh.antennapod.storage.database.DBWriter;\n import de.danoeh.antennapod.storage.database.FeedItemPermutors;\n-import de.danoeh.antennapod.core.util.FeedItemUtil;\n-import de.danoeh.antennapod.core.util.IntentUtils;\n+import de.danoeh.antennapod.ui.common.IntentUtils;\n import de.danoeh.antennapod.ui.share.ShareUtils;\n import de.danoeh.antennapod.ui.episodeslist.MoreContentListFooterUtil;\n import de.danoeh.antennapod.databinding.FeedItemListFragmentBinding;\n@@ -321,8 +320,7 @@ public boolean onContextItemSelected(@NonNull MenuItem item) {\n     @Override\n     public void onItemClick(AdapterView<?> parent, View view, int position, long id) {\n         MainActivity activity = (MainActivity) getActivity();\n-        long[] ids = FeedItemUtil.getIds(feed.getItems());\n-        activity.loadChildFragment(ItemPagerFragment.newInstance(ids, position));\n+        activity.loadChildFragment(ItemPagerFragment.newInstance(feed.getItems(), feed.getItems().get(position)));\n     }\n \n     @Subscribe(threadMode = ThreadMode.MAIN)\n@@ -341,7 +339,7 @@ public void onEventMainThread(FeedItemEvent event) {\n         }\n         for (int i = 0, size = event.items.size(); i < size; i++) {\n             FeedItem item = event.items.get(i);\n-            int pos = FeedItemUtil.indexOfItemWithId(feed.getItems(), item.getId());\n+            int pos = FeedItemEvent.indexOfItemWithId(feed.getItems(), item.getId());\n             if (pos >= 0) {\n                 feed.getItems().remove(pos);\n                 feed.getItems().add(pos, item);\n@@ -356,7 +354,7 @@ public void onEventMainThread(EpisodeDownloadEvent event) {\n             return;\n         }\n         for (String downloadUrl : event.getUrls()) {\n-            int pos = FeedItemUtil.indexOfItemWithDownloadUrl(feed.getItems(), downloadUrl);\n+            int pos = EpisodeDownloadEvent.indexOfItemWithDownloadUrl(feed.getItems(), downloadUrl);\n             if (pos >= 0) {\n                 adapter.notifyItemChangedCompat(pos);\n             }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/RemoveFeedDialog.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/RemoveFeedDialog.java\nindex 415948a818..52bb36867c 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/RemoveFeedDialog.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/RemoveFeedDialog.java\n@@ -11,7 +11,7 @@\n import java.util.List;\n \n import de.danoeh.antennapod.R;\n-import de.danoeh.antennapod.core.util.ConfirmationDialog;\n+import de.danoeh.antennapod.ui.common.ConfirmationDialog;\n import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.storage.database.DBWriter;\n import io.reactivex.Completable;\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/RenameFeedDialog.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/RenameFeedDialog.java\nindex 4bc63f732e..a2c2caaaff 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/RenameFeedDialog.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/RenameFeedDialog.java\n@@ -54,8 +54,8 @@ public void show() {\n                         renameTag(newTitle);\n                     }\n                 })\n-                .setNeutralButton(de.danoeh.antennapod.core.R.string.reset, null)\n-                .setNegativeButton(de.danoeh.antennapod.core.R.string.cancel_label, null)\n+                .setNeutralButton(R.string.reset, null)\n+                .setNegativeButton(R.string.cancel_label, null)\n                 .show();\n \n         // To prevent cancelling the dialog on button click\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/EpisodesSurpriseSection.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/EpisodesSurpriseSection.java\nindex 451a0aedc2..09f060f814 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/EpisodesSurpriseSection.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/EpisodesSurpriseSection.java\n@@ -15,7 +15,6 @@\n import de.danoeh.antennapod.ui.episodeslist.HorizontalItemListAdapter;\n import de.danoeh.antennapod.ui.MenuItemUtils;\n import de.danoeh.antennapod.storage.database.DBReader;\n-import de.danoeh.antennapod.core.util.FeedItemUtil;\n import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FeedItemEvent;\n import de.danoeh.antennapod.event.PlayerStatusEvent;\n@@ -105,7 +104,7 @@ public void onEventMainThread(FeedItemEvent event) {\n         Log.d(TAG, \"onEventMainThread() called with: \" + \"event = [\" + event + \"]\");\n         for (int i = 0, size = event.items.size(); i < size; i++) {\n             FeedItem item = event.items.get(i);\n-            int pos = FeedItemUtil.indexOfItemWithId(episodes, item.getId());\n+            int pos = FeedItemEvent.indexOfItemWithId(episodes, item.getId());\n             if (pos >= 0) {\n                 episodes.remove(pos);\n                 episodes.add(pos, item);\n@@ -117,7 +116,7 @@ public void onEventMainThread(FeedItemEvent event) {\n     @Subscribe(sticky = true, threadMode = ThreadMode.MAIN)\n     public void onEventMainThread(EpisodeDownloadEvent event) {\n         for (String downloadUrl : event.getUrls()) {\n-            int pos = FeedItemUtil.indexOfItemWithDownloadUrl(episodes, downloadUrl);\n+            int pos = EpisodeDownloadEvent.indexOfItemWithDownloadUrl(episodes, downloadUrl);\n             if (pos >= 0) {\n                 listAdapter.notifyItemChangedCompat(pos);\n             }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/InboxSection.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/InboxSection.java\nindex de6f6bef4f..d30fa85bce 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/InboxSection.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/InboxSection.java\n@@ -16,7 +16,6 @@\n import de.danoeh.antennapod.ui.episodeslist.EpisodeItemListAdapter;\n import de.danoeh.antennapod.ui.MenuItemUtils;\n import de.danoeh.antennapod.storage.database.DBReader;\n-import de.danoeh.antennapod.core.util.FeedItemUtil;\n import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FeedItemEvent;\n import de.danoeh.antennapod.event.FeedListUpdateEvent;\n@@ -99,7 +98,7 @@ public void onFeedListChanged(FeedListUpdateEvent event) {\n     @Subscribe(sticky = true, threadMode = ThreadMode.MAIN)\n     public void onEventMainThread(EpisodeDownloadEvent event) {\n         for (String downloadUrl : event.getUrls()) {\n-            int pos = FeedItemUtil.indexOfItemWithDownloadUrl(items, downloadUrl);\n+            int pos = EpisodeDownloadEvent.indexOfItemWithDownloadUrl(items, downloadUrl);\n             if (pos >= 0) {\n                 adapter.notifyItemChangedCompat(pos);\n             }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/QueueSection.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/QueueSection.java\nindex 57d896ae9e..7909924209 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/QueueSection.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/sections/QueueSection.java\n@@ -15,7 +15,6 @@\n import de.danoeh.antennapod.ui.episodeslist.HorizontalItemListAdapter;\n import de.danoeh.antennapod.ui.MenuItemUtils;\n import de.danoeh.antennapod.storage.database.DBReader;\n-import de.danoeh.antennapod.core.util.FeedItemUtil;\n import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FeedItemEvent;\n import de.danoeh.antennapod.event.PlayerStatusEvent;\n@@ -92,7 +91,7 @@ public void onEventMainThread(FeedItemEvent event) {\n         }\n         for (int i = 0, size = event.items.size(); i < size; i++) {\n             FeedItem item = event.items.get(i);\n-            int pos = FeedItemUtil.indexOfItemWithId(queue, item.getId());\n+            int pos = FeedItemEvent.indexOfItemWithId(queue, item.getId());\n             if (pos >= 0) {\n                 queue.remove(pos);\n                 queue.add(pos, item);\n@@ -104,7 +103,7 @@ public void onEventMainThread(FeedItemEvent event) {\n     @Subscribe(sticky = true, threadMode = ThreadMode.MAIN)\n     public void onEventMainThread(EpisodeDownloadEvent event) {\n         for (String downloadUrl : event.getUrls()) {\n-            int pos = FeedItemUtil.indexOfItemWithDownloadUrl(queue, downloadUrl);\n+            int pos = EpisodeDownloadEvent.indexOfItemWithDownloadUrl(queue, downloadUrl);\n             if (pos >= 0) {\n                 listAdapter.notifyItemChangedCompat(pos);\n             }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/onlinefeedview/OnlineFeedViewActivity.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/onlinefeedview/OnlineFeedViewActivity.java\nindex 42050e7184..799366ecb3 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/onlinefeedview/OnlineFeedViewActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/onlinefeedview/OnlineFeedViewActivity.java\n@@ -54,7 +54,7 @@\n import de.danoeh.antennapod.parser.feed.FeedHandler;\n import de.danoeh.antennapod.parser.feed.FeedHandlerResult;\n import de.danoeh.antennapod.model.download.DownloadError;\n-import de.danoeh.antennapod.core.util.IntentUtils;\n+import de.danoeh.antennapod.ui.common.IntentUtils;\n import de.danoeh.antennapod.net.common.UrlChecker;\n import de.danoeh.antennapod.ui.cleaner.HtmlToPlainText;\n import de.danoeh.antennapod.databinding.OnlinefeedviewActivityBinding;\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java\nindex 5e1f5c818d..e66ed6d3ea 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/AudioPlayerFragment.java\n@@ -27,6 +27,7 @@\n \n import de.danoeh.antennapod.playback.service.PlaybackController;\n import de.danoeh.antennapod.ui.appstartintent.MediaButtonStarter;\n+import de.danoeh.antennapod.ui.chapters.ChapterUtils;\n import de.danoeh.antennapod.ui.episodes.PlaybackSpeedUtils;\n import de.danoeh.antennapod.ui.episodes.TimeSpeedConverter;\n import de.danoeh.antennapod.ui.screen.playback.MediaPlayerErrorDialog;\n@@ -43,7 +44,6 @@\n \n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n-import de.danoeh.antennapod.core.util.ChapterUtils;\n import de.danoeh.antennapod.ui.common.Converter;\n import de.danoeh.antennapod.ui.screen.feed.preferences.SkipPreferenceDialog;\n import de.danoeh.antennapod.event.FavoritesEvent;\n@@ -360,7 +360,7 @@ public void updatePosition(PlaybackPositionEvent event) {\n         int currentPosition = converter.convert(event.getPosition());\n         int duration = converter.convert(event.getDuration());\n         int remainingTime = converter.convert(Math.max(event.getDuration() - event.getPosition(), 0));\n-        currentChapterIndex = ChapterUtils.getCurrentChapterIndex(controller.getMedia(), currentPosition);\n+        currentChapterIndex = Chapter.getAfterPosition(controller.getMedia().getChapters(), currentPosition);\n         Log.d(TAG, \"currentPosition \" + Converter.getDurationStringLong(currentPosition));\n         if (currentPosition == Playable.INVALID_TIME || duration == Playable.INVALID_TIME) {\n             Log.w(TAG, \"Could not react to position observer update because of invalid time\");\n@@ -406,7 +406,7 @@ public void onProgressChanged(SeekBar seekBar, int progress, boolean fromUser) {\n             float prog = progress / ((float) seekBar.getMax());\n             TimeSpeedConverter converter = new TimeSpeedConverter(controller.getCurrentPlaybackSpeedMultiplier());\n             int position = converter.convert((int) (prog * controller.getDuration()));\n-            int newChapterIndex = ChapterUtils.getCurrentChapterIndex(controller.getMedia(), position);\n+            int newChapterIndex = Chapter.getAfterPosition(controller.getMedia().getChapters(), position);\n             if (newChapterIndex > -1) {\n                 if (!sbPosition.isPressed() && currentChapterIndex != newChapterIndex) {\n                     currentChapterIndex = newChapterIndex;\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/CoverFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/CoverFragment.java\nindex 05e6f3d6cc..57794b4109 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/CoverFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/audio/CoverFragment.java\n@@ -32,7 +32,7 @@\n import com.google.android.material.snackbar.Snackbar;\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n-import de.danoeh.antennapod.core.util.ChapterUtils;\n+import de.danoeh.antennapod.ui.chapters.ChapterUtils;\n import de.danoeh.antennapod.ui.screen.chapter.ChaptersFragment;\n import de.danoeh.antennapod.playback.service.PlaybackController;\n import de.danoeh.antennapod.ui.common.DateFormatter;\n@@ -160,7 +160,7 @@ public void onAnimationEnd(Animator animation) {\n         });\n         \n         displayedChapterIndex = -1;\n-        refreshChapterData(ChapterUtils.getCurrentChapterIndex(media, media.getPosition())); //calls displayCoverImage\n+        refreshChapterData(Chapter.getAfterPosition(media.getChapters(), media.getPosition()));\n         updateChapterControlVisibility();\n     }\n \n@@ -261,7 +261,7 @@ public void onStop() {\n \n     @Subscribe(threadMode = ThreadMode.MAIN)\n     public void onEventMainThread(PlaybackPositionEvent event) {\n-        int newChapterIndex = ChapterUtils.getCurrentChapterIndex(media, event.getPosition());\n+        int newChapterIndex = Chapter.getAfterPosition(media.getChapters(), event.getPosition());\n         if (newChapterIndex > -1 && newChapterIndex != displayedChapterIndex) {\n             refreshChapterData(newChapterIndex);\n         }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/video/VideoplayerActivity.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/video/VideoplayerActivity.java\nindex 2a0746f542..d5289d8d24 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/video/VideoplayerActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/playback/video/VideoplayerActivity.java\n@@ -48,8 +48,7 @@\n import de.danoeh.antennapod.storage.database.DBReader;\n import de.danoeh.antennapod.storage.database.DBWriter;\n import de.danoeh.antennapod.ui.common.Converter;\n-import de.danoeh.antennapod.core.util.FeedItemUtil;\n-import de.danoeh.antennapod.core.util.IntentUtils;\n+import de.danoeh.antennapod.ui.common.IntentUtils;\n import de.danoeh.antennapod.ui.share.ShareUtils;\n import de.danoeh.antennapod.databinding.VideoplayerActivityBinding;\n import de.danoeh.antennapod.ui.share.ShareDialog;\n@@ -636,7 +635,7 @@ private static String getWebsiteLinkWithFallback(Playable media) {\n         } else if (StringUtils.isNotBlank(media.getWebsiteLink())) {\n             return media.getWebsiteLink();\n         } else if (media instanceof FeedMedia) {\n-            return FeedItemUtil.getLinkWithFallback(((FeedMedia) media).getItem());\n+            return (((FeedMedia) media).getItem()).getLinkWithFallback();\n         }\n         return null;\n     }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/BugReportActivity.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/BugReportActivity.java\nindex b4a5218eeb..5e9de47036 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/BugReportActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/BugReportActivity.java\n@@ -25,7 +25,7 @@\n import de.danoeh.antennapod.CrashReportWriter;\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n-import de.danoeh.antennapod.core.util.IntentUtils;\n+import de.danoeh.antennapod.ui.common.IntentUtils;\n import org.apache.commons.io.IOUtils;\n \n import java.io.File;\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/MainPreferencesFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/MainPreferencesFragment.java\nindex 40a9dd6051..7c036974b5 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/MainPreferencesFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/MainPreferencesFragment.java\n@@ -13,7 +13,7 @@\n import com.bytehamster.lib.preferencesearch.SearchPreference;\n \n import de.danoeh.antennapod.R;\n-import de.danoeh.antennapod.core.util.IntentUtils;\n+import de.danoeh.antennapod.ui.common.IntentUtils;\n import de.danoeh.antennapod.ui.preferences.screen.about.AboutFragment;\n \n public class MainPreferencesFragment extends PreferenceFragmentCompat {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java\nindex 31fedda1d8..471d4f17db 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/queue/QueueFragment.java\n@@ -40,12 +40,11 @@\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n import de.danoeh.antennapod.ui.episodeslist.EpisodeItemListAdapter;\n-import de.danoeh.antennapod.core.util.ConfirmationDialog;\n+import de.danoeh.antennapod.ui.common.ConfirmationDialog;\n import de.danoeh.antennapod.ui.MenuItemUtils;\n import de.danoeh.antennapod.storage.database.DBReader;\n import de.danoeh.antennapod.storage.database.DBWriter;\n import de.danoeh.antennapod.ui.common.Converter;\n-import de.danoeh.antennapod.core.util.FeedItemUtil;\n import de.danoeh.antennapod.ui.screen.feed.ItemSortDialog;\n import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FeedItemEvent;\n@@ -150,7 +149,7 @@ public void onEventMainThread(QueueEvent event) {\n                 break;\n             case REMOVED:\n             case IRREVERSIBLE_REMOVED:\n-                int position = FeedItemUtil.indexOfItemWithId(queue, event.item.getId());\n+                int position = FeedItemEvent.indexOfItemWithId(queue, event.item.getId());\n                 queue.remove(position);\n                 recyclerAdapter.notifyItemRemoved(position);\n                 break;\n@@ -178,7 +177,7 @@ public void onEventMainThread(FeedItemEvent event) {\n         }\n         for (int i = 0, size = event.items.size(); i < size; i++) {\n             FeedItem item = event.items.get(i);\n-            int pos = FeedItemUtil.indexOfItemWithId(queue, item.getId());\n+            int pos = FeedItemEvent.indexOfItemWithId(queue, item.getId());\n             if (pos >= 0) {\n                 queue.remove(pos);\n                 queue.add(pos, item);\n@@ -194,7 +193,7 @@ public void onEventMainThread(EpisodeDownloadEvent event) {\n             return;\n         }\n         for (String downloadUrl : event.getUrls()) {\n-            int pos = FeedItemUtil.indexOfItemWithDownloadUrl(queue, downloadUrl);\n+            int pos = EpisodeDownloadEvent.indexOfItemWithDownloadUrl(queue, downloadUrl);\n             if (pos >= 0) {\n                 recyclerAdapter.notifyItemChangedCompat(pos);\n             }\n@@ -357,7 +356,7 @@ public boolean onContextItemSelected(MenuItem item) {\n             return super.onContextItemSelected(item);\n         }\n \n-        int position = FeedItemUtil.indexOfItemWithId(queue, selectedItem.getId());\n+        int position = FeedItemEvent.indexOfItemWithId(queue, selectedItem.getId());\n         if (position < 0) {\n             Log.i(TAG, \"Selected item no longer exist, ignoring selection\");\n             return super.onContextItemSelected(item);\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/rating/RatingDialogFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/rating/RatingDialogFragment.java\nindex 9adf885b1e..f0dedb13ee 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/rating/RatingDialogFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/rating/RatingDialogFragment.java\n@@ -12,7 +12,7 @@\n import androidx.fragment.app.DialogFragment;\n import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import de.danoeh.antennapod.R;\n-import de.danoeh.antennapod.core.util.IntentUtils;\n+import de.danoeh.antennapod.ui.common.IntentUtils;\n import de.danoeh.antennapod.databinding.RatingDialogBinding;\n import de.danoeh.antennapod.ui.common.DateFormatter;\n \ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/rating/RatingDialogManager.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/rating/RatingDialogManager.java\nindex edba0ec833..89a984e42c 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/rating/RatingDialogManager.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/rating/RatingDialogManager.java\n@@ -7,7 +7,7 @@\n \n import android.util.Log;\n import androidx.fragment.app.FragmentActivity;\n-import de.danoeh.antennapod.core.BuildConfig;\n+import de.danoeh.antennapod.BuildConfig;\n import de.danoeh.antennapod.storage.database.DBReader;\n import de.danoeh.antennapod.storage.database.StatisticsItem;\n import io.reactivex.Observable;\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/FeedMenuHandler.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/FeedMenuHandler.java\nindex e1e9f22870..f5761020c9 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/FeedMenuHandler.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/FeedMenuHandler.java\n@@ -7,7 +7,7 @@\n import androidx.annotation.NonNull;\n import androidx.fragment.app.Fragment;\n import de.danoeh.antennapod.R;\n-import de.danoeh.antennapod.core.util.ConfirmationDialog;\n+import de.danoeh.antennapod.ui.common.ConfirmationDialog;\n import de.danoeh.antennapod.storage.database.DBWriter;\n import de.danoeh.antennapod.ui.screen.feed.RemoveFeedDialog;\n import de.danoeh.antennapod.ui.screen.feed.RenameFeedDialog;\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/SubscriptionsFilterGroup.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/SubscriptionsFilterGroup.java\nindex 41dce16f07..d952d610ff 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/SubscriptionsFilterGroup.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/subscriptions/SubscriptionsFilterGroup.java\n@@ -1,6 +1,6 @@\n package de.danoeh.antennapod.ui.screen.subscriptions;\n \n-import de.danoeh.antennapod.core.R;\n+import de.danoeh.antennapod.R;\n \n public enum SubscriptionsFilterGroup {\n     COUNTER_GREATER_ZERO(new ItemProperties(R.string.subscriptions_counter_greater_zero, \"counter_greater_zero\")),\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/share/ShareUtils.java b/app/src/main/java/de/danoeh/antennapod/ui/share/ShareUtils.java\nindex 77d5f43052..7b685f8bc8 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/share/ShareUtils.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/share/ShareUtils.java\n@@ -9,12 +9,11 @@\n import androidx.core.app.ShareCompat;\n import androidx.core.content.FileProvider;\n \n-import de.danoeh.antennapod.core.util.FeedItemUtil;\n import de.danoeh.antennapod.ui.common.Converter;\n import java.io.File;\n import java.net.URLEncoder;\n \n-import de.danoeh.antennapod.core.R;\n+import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedMedia;\n@@ -46,7 +45,7 @@ public static void shareFeedLink(Context context, Feed feed) {\n     }\n \n     public static boolean hasLinkToShare(FeedItem item) {\n-        return FeedItemUtil.getLinkWithFallback(item) != null;\n+        return item.getLinkWithFallback() != null;\n     }\n \n     public static void shareMediaDownloadLink(Context context, FeedMedia media) {\n@@ -64,7 +63,7 @@ public static void shareFeedItemLinkWithDownloadLink(Context context, FeedItem i\n \n         if (hasLinkToShare(item)) {\n             text +=  \"\\n\\n\" + context.getResources().getString(R.string.share_dialog_episode_website_label) + \": \";\n-            text += FeedItemUtil.getLinkWithFallback(item);\n+            text += item.getLinkWithFallback();\n         }\n \n         if (item.getMedia() != null && item.getMedia().getDownloadUrl() != null) {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/view/ShownotesWebView.java b/app/src/main/java/de/danoeh/antennapod/ui/view/ShownotesWebView.java\nindex 67a659418f..ae8654e830 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/view/ShownotesWebView.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/view/ShownotesWebView.java\n@@ -26,7 +26,7 @@\n import de.danoeh.antennapod.activity.MainActivity;\n import de.danoeh.antennapod.ui.MenuItemUtils;\n import de.danoeh.antennapod.ui.common.Converter;\n-import de.danoeh.antennapod.core.util.IntentUtils;\n+import de.danoeh.antennapod.ui.common.IntentUtils;\n import de.danoeh.antennapod.net.common.NetworkUtils;\n import de.danoeh.antennapod.ui.share.ShareUtils;\n import de.danoeh.antennapod.ui.cleaner.ShownotesCleaner;\ndiff --git a/core/src/main/res/drawable-anydpi-v26/ic_shortcut_feed.xml b/app/src/main/res/drawable-anydpi-v26/ic_shortcut_feed.xml\nsimilarity index 100%\nrename from core/src/main/res/drawable-anydpi-v26/ic_shortcut_feed.xml\nrename to app/src/main/res/drawable-anydpi-v26/ic_shortcut_feed.xml\ndiff --git a/core/src/main/res/drawable-anydpi-v26/ic_shortcut_playlist.xml b/app/src/main/res/drawable-anydpi-v26/ic_shortcut_playlist.xml\nsimilarity index 100%\nrename from core/src/main/res/drawable-anydpi-v26/ic_shortcut_playlist.xml\nrename to app/src/main/res/drawable-anydpi-v26/ic_shortcut_playlist.xml\ndiff --git a/core/src/main/res/drawable-anydpi-v26/ic_shortcut_refresh.xml b/app/src/main/res/drawable-anydpi-v26/ic_shortcut_refresh.xml\nsimilarity index 100%\nrename from core/src/main/res/drawable-anydpi-v26/ic_shortcut_refresh.xml\nrename to app/src/main/res/drawable-anydpi-v26/ic_shortcut_refresh.xml\ndiff --git a/core/src/main/res/drawable-anydpi-v26/ic_shortcut_subscriptions.xml b/app/src/main/res/drawable-anydpi-v26/ic_shortcut_subscriptions.xml\nsimilarity index 100%\nrename from core/src/main/res/drawable-anydpi-v26/ic_shortcut_subscriptions.xml\nrename to app/src/main/res/drawable-anydpi-v26/ic_shortcut_subscriptions.xml\ndiff --git a/core/src/main/res/drawable/ic_shortcut_feed.xml b/app/src/main/res/drawable/ic_shortcut_feed.xml\nsimilarity index 100%\nrename from core/src/main/res/drawable/ic_shortcut_feed.xml\nrename to app/src/main/res/drawable/ic_shortcut_feed.xml\ndiff --git a/core/src/main/res/drawable/ic_shortcut_playlist.xml b/app/src/main/res/drawable/ic_shortcut_playlist.xml\nsimilarity index 100%\nrename from core/src/main/res/drawable/ic_shortcut_playlist.xml\nrename to app/src/main/res/drawable/ic_shortcut_playlist.xml\ndiff --git a/core/src/main/res/drawable/ic_shortcut_refresh.xml b/app/src/main/res/drawable/ic_shortcut_refresh.xml\nsimilarity index 100%\nrename from core/src/main/res/drawable/ic_shortcut_refresh.xml\nrename to app/src/main/res/drawable/ic_shortcut_refresh.xml\ndiff --git a/core/src/main/res/drawable/ic_shortcut_subscriptions.xml b/app/src/main/res/drawable/ic_shortcut_subscriptions.xml\nsimilarity index 100%\nrename from core/src/main/res/drawable/ic_shortcut_subscriptions.xml\nrename to app/src/main/res/drawable/ic_shortcut_subscriptions.xml\ndiff --git a/core/src/main/res/layout/more_content_list_footer.xml b/app/src/main/res/layout/more_content_list_footer.xml\nsimilarity index 100%\nrename from core/src/main/res/layout/more_content_list_footer.xml\nrename to app/src/main/res/layout/more_content_list_footer.xml\ndiff --git a/core/src/main/res/layout/popup_bubble_view.xml b/app/src/main/res/layout/popup_bubble_view.xml\nsimilarity index 100%\nrename from core/src/main/res/layout/popup_bubble_view.xml\nrename to app/src/main/res/layout/popup_bubble_view.xml\ndiff --git a/core/src/main/res/values/ids.xml b/app/src/main/res/values/ids.xml\nsimilarity index 100%\nrename from core/src/main/res/values/ids.xml\nrename to app/src/main/res/values/ids.xml\ndiff --git a/core/.gitignore b/core/.gitignore\ndeleted file mode 100644\nindex 796b96d1c4..0000000000\n--- a/core/.gitignore\n+++ /dev/null\n@@ -1,1 +0,0 @@\n-/build\ndiff --git a/core/build.gradle b/core/build.gradle\ndeleted file mode 100644\nindex ad0ad1e3b0..0000000000\n--- a/core/build.gradle\n+++ /dev/null\n@@ -1,65 +0,0 @@\n-plugins {\n-    id(\"com.android.library\")\n-}\n-apply from: \"../common.gradle\"\n-apply from: \"../playFlavor.gradle\"\n-\n-android {\n-    namespace \"de.danoeh.antennapod.core\"\n-\n-    lint {\n-        disable \"InvalidPeriodicWorkRequestInterval\", \"ObsoleteLintCustomCheck\", \"DefaultLocale\", \"UnusedAttribute\",\n-                \"ParcelClassLoader\", \"CheckResult\", \"TrustAllX509TrustManager\",\n-                \"StaticFieldLeak\", \"IconDensities\", \"IconDuplicates\", \"UnsafeOptInUsageError\"\n-    }\n-\n-    defaultConfig {\n-        javaCompileOptions {\n-            annotationProcessorOptions {\n-                arguments = [eventBusIndex: 'de.danoeh.antennapod.core.ApCoreEventBusIndex']\n-            }\n-        }\n-    }\n-}\n-\n-dependencies {\n-    implementation project(':model')\n-    implementation project(':net:common')\n-    implementation project(':net:download:service-interface')\n-    implementation project(':parser:feed')\n-    implementation project(':parser:media')\n-    implementation project(':storage:preferences')\n-    implementation project(':storage:database')\n-    implementation project(':ui:common')\n-\n-    annotationProcessor \"androidx.annotation:annotation:$annotationVersion\"\n-    implementation \"androidx.appcompat:appcompat:$appcompatVersion\"\n-    implementation \"androidx.core:core:$coreVersion\"\n-    implementation 'androidx.documentfile:documentfile:1.0.1'\n-    implementation \"androidx.fragment:fragment:$fragmentVersion\"\n-    implementation \"androidx.preference:preference:$preferenceVersion\"\n-    implementation \"androidx.work:work-runtime:$workManagerVersion\"\n-    implementation \"com.google.android.material:material:$googleMaterialVersion\"\n-\n-    implementation \"org.apache.commons:commons-lang3:$commonslangVersion\"\n-    implementation \"commons-io:commons-io:$commonsioVersion\"\n-    implementation \"org.jsoup:jsoup:$jsoupVersion\"\n-    implementation \"com.github.bumptech.glide:glide:$glideVersion\"\n-    implementation \"com.github.bumptech.glide:okhttp3-integration:$glideVersion@aar\"\n-    implementation \"com.squareup.okhttp3:okhttp:$okhttpVersion\"\n-    implementation \"com.squareup.okhttp3:okhttp-urlconnection:$okhttpVersion\"\n-    implementation \"org.greenrobot:eventbus:$eventbusVersion\"\n-    annotationProcessor \"org.greenrobot:eventbus-annotation-processor:$eventbusVersion\"\n-    implementation \"io.reactivex.rxjava2:rxandroid:$rxAndroidVersion\"\n-    implementation \"io.reactivex.rxjava2:rxjava:$rxJavaVersion\"\n-\n-    testImplementation \"androidx.test:core:$testCoreVersion\"\n-    testImplementation \"org.awaitility:awaitility:$awaitilityVersion\"\n-    testImplementation \"junit:junit:$junitVersion\"\n-    testImplementation \"org.mockito:mockito-core:$mockitoVersion\"\n-    testImplementation \"org.robolectric:robolectric:$robolectricVersion\"\n-    testImplementation 'javax.inject:javax.inject:1'\n-    androidTestImplementation \"androidx.test.espresso:espresso-core:$espressoVersion\"\n-    androidTestImplementation \"androidx.test:runner:$runnerVersion\"\n-    androidTestImplementation \"androidx.test:rules:$rulesVersion\"\n-}\ndiff --git a/core/lint.xml b/core/lint.xml\ndeleted file mode 100644\nindex f3cb248102..0000000000\n--- a/core/lint.xml\n+++ /dev/null\n@@ -1,7 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-<lint>\n-    <issue id=\"VectorPath\">\n-        <ignore path=\"res/drawable/ic_settings.xml\" />\n-        <ignore path=\"res/drawable/ic_settings_white.xml\" />\n-    </issue>\n-</lint>\ndiff --git a/core/src/main/AndroidManifest.xml b/core/src/main/AndroidManifest.xml\ndeleted file mode 100644\nindex 73c47d6368..0000000000\n--- a/core/src/main/AndroidManifest.xml\n+++ /dev/null\n@@ -1,15 +0,0 @@\n-<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\n-    xmlns:tools=\"http://schemas.android.com/tools\">\n-\n-    <uses-permission android:name=\"android.permission.INTERNET\" />\n-    <uses-permission android:name=\"android.permission.WRITE_EXTERNAL_STORAGE\"\n-        tools:ignore=\"ScopedStorage\" />\n-    <uses-permission android:name=\"android.permission.WAKE_LOCK\" />\n-    <uses-permission android:name=\"android.permission.ACCESS_NETWORK_STATE\" />\n-    <uses-permission android:name=\"android.permission.ACCESS_WIFI_STATE\" />\n-    <uses-permission android:name=\"android.permission.RECEIVE_BOOT_COMPLETED\" />\n-    <uses-permission android:name=\"android.permission.BLUETOOTH\" />\n-    <uses-permission android:name=\"android.permission.VIBRATE\" />\n-    <uses-permission android:name=\"android.permission.POST_NOTIFICATIONS\" />\n-\n-</manifest>\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/util/FeedItemUtil.java b/core/src/main/java/de/danoeh/antennapod/core/util/FeedItemUtil.java\ndeleted file mode 100644\nindex db8a335765..0000000000\n--- a/core/src/main/java/de/danoeh/antennapod/core/util/FeedItemUtil.java\n+++ /dev/null\n@@ -1,69 +0,0 @@\n-package de.danoeh.antennapod.core.util;\n-\n-import androidx.annotation.NonNull;\n-\n-import org.apache.commons.lang3.StringUtils;\n-\n-import java.util.ArrayList;\n-import java.util.List;\n-\n-import de.danoeh.antennapod.model.feed.FeedItem;\n-\n-public class FeedItemUtil {\n-    private FeedItemUtil(){}\n-\n-    public static int indexOfItemWithId(List<FeedItem> items, long id) {\n-        for(int i=0; i < items.size(); i++) {\n-            FeedItem item = items.get(i);\n-            if(item != null && item.getId() == id) {\n-                return i;\n-            }\n-        }\n-        return -1;\n-    }\n-\n-    public static int indexOfItemWithDownloadUrl(List<FeedItem> items, String downloadUrl) {\n-        for (int i = 0; i < items.size(); i++) {\n-            FeedItem item = items.get(i);\n-            if (item != null && item.getMedia() != null && item.getMedia().getDownloadUrl().equals(downloadUrl)) {\n-                return i;\n-            }\n-        }\n-        return -1;\n-    }\n-\n-    public static long[] getIds(List<FeedItem> items) {\n-        if(items == null || items.size() == 0) {\n-            return new long[0];\n-        }\n-        long[] result = new long[items.size()];\n-        for(int i=0; i < items.size(); i++) {\n-            result[i] = items.get(i).getId();\n-        }\n-        return result;\n-    }\n-\n-    @NonNull\n-    public static List<Long> getIdList(List<? extends FeedItem> items) {\n-        List<Long> result = new ArrayList<>();\n-        for (FeedItem item : items) {\n-            result.add(item.getId());\n-        }\n-        return result;\n-    }\n-\n-    /**\n-     * Get the link for the feed item for the purpose of Share. It fallbacks to\n-     * use the feed's link if the named feed item has no link.\n-     */\n-    public static String getLinkWithFallback(FeedItem item) {\n-        if (item == null) {\n-            return null;\n-        } else if (StringUtils.isNotBlank(item.getLink())) {\n-            return item.getLink();\n-        } else if (StringUtils.isNotBlank(item.getFeed().getLink())) {\n-            return item.getFeed().getLink();\n-        }\n-        return null;\n-    }\n-}\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/util/FeedUtil.java b/core/src/main/java/de/danoeh/antennapod/core/util/FeedUtil.java\ndeleted file mode 100644\nindex 201207816d..0000000000\n--- a/core/src/main/java/de/danoeh/antennapod/core/util/FeedUtil.java\n+++ /dev/null\n@@ -1,13 +0,0 @@\n-package de.danoeh.antennapod.core.util;\n-\n-import de.danoeh.antennapod.model.feed.Feed;\n-import de.danoeh.antennapod.storage.preferences.UserPreferences;\n-\n-public abstract class FeedUtil {\n-    public static boolean shouldAutoDeleteItemsOnThatFeed(Feed feed) {\n-        if (!UserPreferences.isAutoDelete()) {\n-            return false;\n-        }\n-        return !feed.isLocalFeed() || UserPreferences.isAutoDeleteLocal();\n-    }\n-}\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/util/StorageUtils.java b/core/src/main/java/de/danoeh/antennapod/core/util/StorageUtils.java\ndeleted file mode 100644\nindex eed9fcf372..0000000000\n--- a/core/src/main/java/de/danoeh/antennapod/core/util/StorageUtils.java\n+++ /dev/null\n@@ -1,42 +0,0 @@\n-package de.danoeh.antennapod.core.util;\n-\n-import android.os.StatFs;\n-import de.danoeh.antennapod.storage.preferences.UserPreferences;\n-\n-import java.io.File;\n-\n-/**\n- * Utility functions for handling storage errors\n- */\n-public class StorageUtils {\n-    private StorageUtils(){}\n-\n-    /**\n-     * Get the number of free bytes that are available on the external storage.\n-     */\n-    public static long getFreeSpaceAvailable() {\n-        File dataFolder = UserPreferences.getDataFolder(null);\n-        if (dataFolder != null) {\n-            return getFreeSpaceAvailable(dataFolder.getAbsolutePath());\n-        } else {\n-            return 0;\n-        }\n-    }\n-\n-    /**\n-     * Get the number of free bytes that are available on the external storage.\n-     */\n-    public static long getFreeSpaceAvailable(String path) {\n-        StatFs stat = new StatFs(path);\n-        long availableBlocks = stat.getAvailableBlocksLong();\n-        long blockSize = stat.getBlockSizeLong();\n-        return availableBlocks * blockSize;\n-    }\n-\n-    public static long getTotalSpaceAvailable(String path) {\n-        StatFs stat = new StatFs(path);\n-        long blockCount = stat.getBlockCountLong();\n-        long blockSize = stat.getBlockSizeLong();\n-        return blockCount * blockSize;\n-    }\n-}\ndiff --git a/event/src/main/java/de/danoeh/antennapod/event/EpisodeDownloadEvent.java b/event/src/main/java/de/danoeh/antennapod/event/EpisodeDownloadEvent.java\nindex c9790d18a7..28cbc234c5 100644\n--- a/event/src/main/java/de/danoeh/antennapod/event/EpisodeDownloadEvent.java\n+++ b/event/src/main/java/de/danoeh/antennapod/event/EpisodeDownloadEvent.java\n@@ -1,7 +1,9 @@\n package de.danoeh.antennapod.event;\n \n import de.danoeh.antennapod.model.download.DownloadStatus;\n+import de.danoeh.antennapod.model.feed.FeedItem;\n \n+import java.util.List;\n import java.util.Map;\n import java.util.Set;\n \n@@ -15,4 +17,14 @@ public EpisodeDownloadEvent(Map<String, DownloadStatus> map) {\n     public Set<String> getUrls() {\n         return map.keySet();\n     }\n+\n+    public static int indexOfItemWithDownloadUrl(List<FeedItem> items, String downloadUrl) {\n+        for (int i = 0; i < items.size(); i++) {\n+            FeedItem item = items.get(i);\n+            if (item != null && item.getMedia() != null && item.getMedia().getDownloadUrl().equals(downloadUrl)) {\n+                return i;\n+            }\n+        }\n+        return -1;\n+    }\n }\ndiff --git a/event/src/main/java/de/danoeh/antennapod/event/FeedItemEvent.java b/event/src/main/java/de/danoeh/antennapod/event/FeedItemEvent.java\nindex 125d113d69..e217649710 100644\n--- a/event/src/main/java/de/danoeh/antennapod/event/FeedItemEvent.java\n+++ b/event/src/main/java/de/danoeh/antennapod/event/FeedItemEvent.java\n@@ -22,4 +22,14 @@ public static FeedItemEvent updated(List<FeedItem> items) {\n     public static FeedItemEvent updated(FeedItem... items) {\n         return new FeedItemEvent(Arrays.asList(items));\n     }\n+\n+    public static int indexOfItemWithId(List<FeedItem> items, long id) {\n+        for (int i = 0; i < items.size(); i++) {\n+            FeedItem item = items.get(i);\n+            if (item != null && item.getId() == id) {\n+                return i;\n+            }\n+        }\n+        return -1;\n+    }\n }\ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/Chapter.java b/model/src/main/java/de/danoeh/antennapod/model/feed/Chapter.java\nindex 3f4116f9cf..3683a2a444 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/feed/Chapter.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/Chapter.java\n@@ -1,5 +1,7 @@\n package de.danoeh.antennapod.model.feed;\n \n+import java.util.List;\n+\n public class Chapter {\n     private long id;\n     /** Defines starting point in milliseconds. */\n@@ -74,4 +76,16 @@ public long getId() {\n     public void setId(long id) {\n         this.id = id;\n     }\n+\n+    public static int getAfterPosition(List<Chapter> chapters, int playbackPosition) {\n+        if (chapters == null || chapters.isEmpty()) {\n+            return -1;\n+        }\n+        for (int i = 0; i < chapters.size(); i++) {\n+            if (chapters.get(i).getStart() > playbackPosition) {\n+                return i - 1;\n+            }\n+        }\n+        return chapters.size() - 1;\n+    }\n }\ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItem.java b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItem.java\nindex 9cc71eb1da..df4cc8f9cb 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItem.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItem.java\n@@ -3,6 +3,7 @@\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n \n+import org.apache.commons.lang3.StringUtils;\n import org.apache.commons.lang3.builder.ToStringBuilder;\n import org.apache.commons.lang3.builder.ToStringStyle;\n \n@@ -205,6 +206,19 @@ public String getLink() {\n         return link;\n     }\n \n+    /**\n+     * Get the link for the feed item for the purpose of Share.\n+     * It falls backs to the feed's link if the item has no link.\n+     */\n+    public String getLinkWithFallback() {\n+        if (StringUtils.isNotBlank(link)) {\n+            return link;\n+        } else if (StringUtils.isNotBlank(getFeed().getLink())) {\n+            return getFeed().getLink();\n+        }\n+        return null;\n+    }\n+\n     public void setLink(String link) {\n         this.link = link;\n     }\ndiff --git a/net/download/service/build.gradle b/net/download/service/build.gradle\nindex 789fb3aef9..f74550c054 100644\n--- a/net/download/service/build.gradle\n+++ b/net/download/service/build.gradle\n@@ -10,7 +10,6 @@ android {\n }\n \n dependencies {\n-    implementation project(\":core\")\n     implementation project(':event')\n     implementation project(':model')\n     implementation project(':net:common')\n@@ -23,6 +22,7 @@ dependencies {\n     implementation project(':ui:notifications')\n     implementation project(':storage:preferences')\n     implementation project(':ui:app-start-intent')\n+    implementation project(':ui:chapters')\n \n     annotationProcessor \"androidx.annotation:annotation:$annotationVersion\"\n     implementation \"androidx.core:core:$coreVersion\"\ndiff --git a/net/download/service/src/main/AndroidManifest.xml b/net/download/service/src/main/AndroidManifest.xml\nindex 89b6823e55..0a14000100 100644\n--- a/net/download/service/src/main/AndroidManifest.xml\n+++ b/net/download/service/src/main/AndroidManifest.xml\n@@ -7,7 +7,6 @@\n \n     <application\n         android:allowBackup=\"true\"\n-        android:icon=\"@mipmap/ic_launcher\"\n         android:supportsRtl=\"true\">\n \n         <receiver android:name=\".feed.FeedUpdateReceiver\"\ndiff --git a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/MediaDownloadedHandler.java b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/MediaDownloadedHandler.java\nindex dd930c62fd..6ed16aa809 100644\n--- a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/MediaDownloadedHandler.java\n+++ b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/episode/MediaDownloadedHandler.java\n@@ -8,6 +8,7 @@\n \n import de.danoeh.antennapod.model.MediaMetadataRetrieverCompat;\n import de.danoeh.antennapod.net.sync.serviceinterface.SynchronizationQueueSink;\n+import de.danoeh.antennapod.ui.chapters.ChapterUtils;\n import org.greenrobot.eventbus.EventBus;\n \n import java.io.File;\n@@ -19,7 +20,6 @@\n import de.danoeh.antennapod.model.download.DownloadResult;\n import de.danoeh.antennapod.storage.database.DBReader;\n import de.danoeh.antennapod.storage.database.DBWriter;\n-import de.danoeh.antennapod.core.util.ChapterUtils;\n import de.danoeh.antennapod.model.download.DownloadError;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedMedia;\ndiff --git a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/FeedUpdateManagerImpl.java b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/FeedUpdateManagerImpl.java\nindex ae9b255648..2ce5f7006e 100644\n--- a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/FeedUpdateManagerImpl.java\n+++ b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/FeedUpdateManagerImpl.java\n@@ -14,10 +14,10 @@\n import androidx.work.PeriodicWorkRequest;\n import androidx.work.WorkManager;\n import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n-import de.danoeh.antennapod.core.R;\n import de.danoeh.antennapod.net.common.NetworkUtils;\n import de.danoeh.antennapod.event.MessageEvent;\n import de.danoeh.antennapod.model.feed.Feed;\n+import de.danoeh.antennapod.net.download.service.R;\n import de.danoeh.antennapod.net.download.serviceinterface.FeedUpdateManager;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import org.greenrobot.eventbus.EventBus;\ndiff --git a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/remote/HttpDownloader.java b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/remote/HttpDownloader.java\nindex f3c3e657c6..2e983d88e5 100644\n--- a/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/remote/HttpDownloader.java\n+++ b/net/download/service/src/main/java/de/danoeh/antennapod/net/download/service/feed/remote/HttpDownloader.java\n@@ -1,5 +1,6 @@\n package de.danoeh.antennapod.net.download.service.feed.remote;\n \n+import android.os.StatFs;\n import androidx.annotation.NonNull;\n import android.text.TextUtils;\n import android.util.Log;\n@@ -9,6 +10,7 @@\n import de.danoeh.antennapod.model.download.DownloadRequest;\n import de.danoeh.antennapod.net.common.AntennapodHttpClient;\n import de.danoeh.antennapod.net.download.service.R;\n+import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import okhttp3.CacheControl;\n import okhttp3.internal.http.StatusLine;\n import org.apache.commons.io.IOUtils;\n@@ -30,7 +32,6 @@\n import de.danoeh.antennapod.model.feed.FeedMedia;\n import de.danoeh.antennapod.parser.feed.util.DateUtils;\n import de.danoeh.antennapod.model.download.DownloadError;\n-import de.danoeh.antennapod.core.util.StorageUtils;\n import de.danoeh.antennapod.net.common.UriUtil;\n import okhttp3.OkHttpClient;\n import okhttp3.Protocol;\n@@ -148,7 +149,7 @@ && isContentTypeTextAndSmallerThan100kb(response)) {\n                 request.setSize(DownloadResult.SIZE_UNKNOWN);\n             }\n \n-            long freeSpace = StorageUtils.getFreeSpaceAvailable();\n+            long freeSpace = getFreeSpaceAvailable();\n             Log.d(TAG, \"Free space is \" + freeSpace);\n             if (request.getSize() != DownloadResult.SIZE_UNKNOWN && request.getSize() > freeSpace) {\n                 onFail(DownloadError.ERROR_NOT_ENOUGH_SPACE, null);\n@@ -297,6 +298,18 @@ private void checkIfRedirect(Response response) {\n         }\n     }\n \n+    private static long getFreeSpaceAvailable() {\n+        File dataFolder = UserPreferences.getDataFolder(null);\n+        if (dataFolder != null) {\n+            StatFs stat = new StatFs(dataFolder.getAbsolutePath());\n+            long availableBlocks = stat.getAvailableBlocksLong();\n+            long blockSize = stat.getBlockSizeLong();\n+            return availableBlocks * blockSize;\n+        } else {\n+            return 0;\n+        }\n+    }\n+\n     private void onSuccess() {\n         Log.d(TAG, \"Download was successful\");\n         result.setSuccessful();\ndiff --git a/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/util/DateUtils.java b/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/util/DateUtils.java\nindex 4d9f689051..dbddb44b04 100644\n--- a/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/util/DateUtils.java\n+++ b/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/util/DateUtils.java\n@@ -1,7 +1,5 @@\n package de.danoeh.antennapod.parser.feed.util;\n \n-import android.util.Log;\n-\n import androidx.annotation.Nullable;\n import org.apache.commons.lang3.StringUtils;\n \n@@ -16,7 +14,6 @@\n  * Parses several date formats.\n  */\n public abstract class DateUtils {\n-    private static final String TAG = \"DateUtils\";\n     private static final TimeZone TIME_ZONE_GMT = TimeZone.getTimeZone(\"GMT\");\n     private static final ThreadLocal<SimpleDateFormat> RFC822_DATE_FORMAT = new ThreadLocal<>() {\n         @Override\n@@ -117,8 +114,8 @@ public static Date parse(final String input) {\n                 if (result != null && pos.getIndex() == date.length()) {\n                     return result;\n                 }\n-            } catch (Exception e) {\n-                Log.e(TAG, Log.getStackTraceString(e));\n+            } catch (Exception ignored) {\n+                // Ignore\n             }\n         }\n \n@@ -127,7 +124,7 @@ public static Date parse(final String input) {\n             return parse(date.substring(date.indexOf(',') + 1));\n         }\n \n-        Log.d(TAG, \"Could not parse date string \\\"\" + input + \"\\\" [\" + date + \"]\");\n+        System.out.println(\"Could not parse date string \\\"\" + input + \"\\\" [\" + date + \"]\");\n         return null;\n     }\n \ndiff --git a/playback/service/build.gradle b/playback/service/build.gradle\nindex b8c47df8e7..219565696b 100644\n--- a/playback/service/build.gradle\n+++ b/playback/service/build.gradle\n@@ -9,7 +9,6 @@ android {\n }\n \n dependencies {\n-    implementation project(':core')\n     implementation project(':event')\n     implementation project(':model')\n     implementation project(':net:common')\n@@ -24,6 +23,7 @@ dependencies {\n     implementation project(':ui:i18n')\n     implementation project(':ui:notifications')\n     implementation project(':ui:widget')\n+    implementation project(':ui:chapters')\n \n     annotationProcessor \"androidx.annotation:annotation:$annotationVersion\"\n     implementation \"androidx.core:core:$coreVersion\"\ndiff --git a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\nindex dfcb67e51d..8932a36d24 100644\n--- a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\n+++ b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\n@@ -77,9 +77,7 @@\n import de.danoeh.antennapod.storage.database.DBReader;\n import de.danoeh.antennapod.storage.database.DBWriter;\n import de.danoeh.antennapod.playback.service.internal.PlaybackServiceTaskManager.SleepTimer;\n-import de.danoeh.antennapod.core.util.ChapterUtils;\n-import de.danoeh.antennapod.core.util.FeedUtil;\n-import de.danoeh.antennapod.core.util.IntentUtils;\n+import de.danoeh.antennapod.ui.common.IntentUtils;\n import de.danoeh.antennapod.net.common.NetworkUtils;\n import de.danoeh.antennapod.event.MessageEvent;\n import de.danoeh.antennapod.event.PlayerErrorEvent;\n@@ -1147,9 +1145,10 @@ private void onPostPlayback(final Playable playable, boolean ended, boolean skip\n                 // Delete episode if enabled\n                 FeedPreferences.AutoDeleteAction action =\n                         item.getFeed().getPreferences().getCurrentAutoDelete();\n+                boolean autoDeleteEnabledGlobally = UserPreferences.isAutoDelete()\n+                        && (!item.getFeed().isLocalFeed() || UserPreferences.isAutoDeleteLocal());\n                 boolean shouldAutoDelete = action == FeedPreferences.AutoDeleteAction.ALWAYS\n-                        || (action == FeedPreferences.AutoDeleteAction.GLOBAL\n-                                && FeedUtil.shouldAutoDeleteItemsOnThatFeed(item.getFeed()));\n+                        || (action == FeedPreferences.AutoDeleteAction.GLOBAL && autoDeleteEnabledGlobally);\n                 if (shouldAutoDelete && (!item.isTagged(FeedItem.TAG_FAVORITE)\n                         || !UserPreferences.shouldFavoriteKeepEpisode())) {\n                     DBWriter.deleteFeedMediaOfItem(PlaybackService.this, media);\n@@ -1889,8 +1888,7 @@ public void onNextChapter() {\n                 return;\n             }\n \n-            int nextChapter = ChapterUtils.getCurrentChapterIndex(\n-                    mediaPlayer.getPlayable(), mediaPlayer.getPosition()) + 1;\n+            int nextChapter = Chapter.getAfterPosition(chapters, mediaPlayer.getPosition()) + 1;\n \n             if (chapters.size() < nextChapter + 1) {\n                 // We are on the last chapter, just fallback to the next episode\ndiff --git a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/internal/PlaybackServiceTaskManager.java b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/internal/PlaybackServiceTaskManager.java\nindex 71e68c8737..e21499bbab 100644\n--- a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/internal/PlaybackServiceTaskManager.java\n+++ b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/internal/PlaybackServiceTaskManager.java\n@@ -9,7 +9,7 @@\n \n import de.danoeh.antennapod.event.playback.SleepTimerUpdatedEvent;\n import de.danoeh.antennapod.storage.preferences.SleepTimerPreferences;\n-import de.danoeh.antennapod.core.util.ChapterUtils;\n+import de.danoeh.antennapod.ui.chapters.ChapterUtils;\n import de.danoeh.antennapod.ui.widget.WidgetUpdater;\n import io.reactivex.disposables.Disposable;\n import org.greenrobot.eventbus.EventBus;\ndiff --git a/scripts/makeRelease.sh b/scripts/makeRelease.sh\nindex 34c79f319b..7cf6286e94 100644\n--- a/scripts/makeRelease.sh\n+++ b/scripts/makeRelease.sh\n@@ -1,4 +1,4 @@\n #!/bin/sh\n \n-curl -s https://raw.githubusercontent.com/AntennaPod/antennapod.github.io/master/_config.yml | yq -r \".languages[]\" > ./app/src/main/assets/website-languages.txt\n+curl -s https://raw.githubusercontent.com/AntennaPod/antennapod.github.io/master/_config.yml | yq -r \".languages[]\" > ./ui/common/src/main/assets/website-languages.txt\n python ./createContributors.py\ndiff --git a/settings.gradle b/settings.gradle\nindex 111eb3e88f..184df07f2e 100644\n--- a/settings.gradle\n+++ b/settings.gradle\n@@ -16,7 +16,6 @@ dependencyResolutionManagement {\n }\n \n include ':app'\n-include ':core'\n include ':event'\n include ':model'\n \n@@ -42,6 +41,7 @@ include ':storage:importexport'\n include ':storage:preferences'\n \n include ':ui:app-start-intent'\n+include ':ui:chapters'\n include ':ui:common'\n include ':ui:discovery'\n include ':ui:echo'\ndiff --git a/storage/database/build.gradle b/storage/database/build.gradle\nindex a78afbf791..60b57828a6 100644\n--- a/storage/database/build.gradle\n+++ b/storage/database/build.gradle\n@@ -30,6 +30,7 @@ dependencies {\n     implementation \"com.google.guava:guava:31.0.1-android\"\n     implementation \"org.apache.commons:commons-lang3:$commonslangVersion\"\n \n+    testImplementation project(':parser:feed')\n     testImplementation \"junit:junit:$junitVersion\"\n     testImplementation \"androidx.test:core:$testCoreVersion\"\n     testImplementation \"org.robolectric:robolectric:$robolectricVersion\"\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/util/ReleaseScheduleGuesser.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/ReleaseScheduleGuesser.java\nsimilarity index 99%\nrename from core/src/main/java/de/danoeh/antennapod/core/util/ReleaseScheduleGuesser.java\nrename to storage/database/src/main/java/de/danoeh/antennapod/storage/database/ReleaseScheduleGuesser.java\nindex 580cf41646..3ee4e5b1d9 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/util/ReleaseScheduleGuesser.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/ReleaseScheduleGuesser.java\n@@ -1,4 +1,4 @@\n-package de.danoeh.antennapod.core.util;\n+package de.danoeh.antennapod.storage.database;\n \n import java.util.ArrayList;\n import java.util.Arrays;\ndiff --git a/ui/chapters/README.md b/ui/chapters/README.md\nnew file mode 100644\nindex 0000000000..68136b4369\n--- /dev/null\n+++ b/ui/chapters/README.md\n@@ -0,0 +1,3 @@\n+# :ui:chapters\n+\n+This module provides chapter loading and merging for display, but not the actual UI to display them.\ndiff --git a/ui/chapters/build.gradle b/ui/chapters/build.gradle\nnew file mode 100644\nindex 0000000000..a3cb1b6779\n--- /dev/null\n+++ b/ui/chapters/build.gradle\n@@ -0,0 +1,21 @@\n+plugins {\n+    id(\"com.android.library\")\n+}\n+apply from: \"../../common.gradle\"\n+apply from: \"../../playFlavor.gradle\"\n+\n+android {\n+    namespace \"de.danoeh.antennapod.ui.chapters\"\n+}\n+\n+dependencies {\n+    implementation project(':model')\n+    implementation project(':net:common')\n+    implementation project(':parser:media')\n+    implementation project(':parser:feed')\n+    implementation project(':storage:database')\n+\n+    annotationProcessor \"androidx.annotation:annotation:$annotationVersion\"\n+    implementation \"commons-io:commons-io:$commonsioVersion\"\n+    implementation \"com.squareup.okhttp3:okhttp:$okhttpVersion\"\n+}\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/util/ChapterMerger.java b/ui/chapters/src/main/java/de/danoeh/antennapod/ui/chapters/ChapterMerger.java\nsimilarity index 98%\nrename from core/src/main/java/de/danoeh/antennapod/core/util/ChapterMerger.java\nrename to ui/chapters/src/main/java/de/danoeh/antennapod/ui/chapters/ChapterMerger.java\nindex 794b2322d6..7ec11b5668 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/util/ChapterMerger.java\n+++ b/ui/chapters/src/main/java/de/danoeh/antennapod/ui/chapters/ChapterMerger.java\n@@ -1,4 +1,4 @@\n-package de.danoeh.antennapod.core.util;\n+package de.danoeh.antennapod.ui.chapters;\n \n import android.text.TextUtils;\n import android.util.Log;\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/util/ChapterUtils.java b/ui/chapters/src/main/java/de/danoeh/antennapod/ui/chapters/ChapterUtils.java\nsimilarity index 94%\nrename from core/src/main/java/de/danoeh/antennapod/core/util/ChapterUtils.java\nrename to ui/chapters/src/main/java/de/danoeh/antennapod/ui/chapters/ChapterUtils.java\nindex b32b05236b..5554890ed0 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/util/ChapterUtils.java\n+++ b/ui/chapters/src/main/java/de/danoeh/antennapod/ui/chapters/ChapterUtils.java\n@@ -1,4 +1,4 @@\n-package de.danoeh.antennapod.core.util;\n+package de.danoeh.antennapod.ui.chapters;\n \n import android.content.ContentResolver;\n import android.content.Context;\n@@ -41,19 +41,6 @@ public class ChapterUtils {\n     private ChapterUtils() {\n     }\n \n-    public static int getCurrentChapterIndex(Playable media, int position) {\n-        if (media == null || media.getChapters() == null || media.getChapters().size() == 0) {\n-            return -1;\n-        }\n-        List<Chapter> chapters = media.getChapters();\n-        for (int i = 0; i < chapters.size(); i++) {\n-            if (chapters.get(i).getStart() > position) {\n-                return i - 1;\n-            }\n-        }\n-        return chapters.size() - 1;\n-    }\n-\n     public static void loadChapters(Playable playable, Context context, boolean forceRefresh) {\n         if (playable.getChapters() != null && !forceRefresh) {\n             // Already loaded\ndiff --git a/ui/common/build.gradle b/ui/common/build.gradle\nindex 1325761d3d..f2916593a5 100644\n--- a/ui/common/build.gradle\n+++ b/ui/common/build.gradle\n@@ -16,6 +16,8 @@ dependencies {\n     implementation \"androidx.viewpager2:viewpager2:$viewPager2Version\"\n     implementation \"com.google.android.material:material:$googleMaterialVersion\"\n     implementation \"androidx.core:core-splashscreen:1.0.0\"\n+    implementation \"org.apache.commons:commons-lang3:$commonslangVersion\"\n+    implementation \"commons-io:commons-io:$commonsioVersion\"\n \n     testImplementation \"junit:junit:$junitVersion\"\n }\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/util/ConfirmationDialog.java b/ui/common/src/main/java/de/danoeh/antennapod/ui/common/ConfirmationDialog.java\nsimilarity index 95%\nrename from core/src/main/java/de/danoeh/antennapod/core/util/ConfirmationDialog.java\nrename to ui/common/src/main/java/de/danoeh/antennapod/ui/common/ConfirmationDialog.java\nindex ff5e56f5d5..8acedc7d34 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/util/ConfirmationDialog.java\n+++ b/ui/common/src/main/java/de/danoeh/antennapod/ui/common/ConfirmationDialog.java\n@@ -1,4 +1,4 @@\n-package de.danoeh.antennapod.core.util;\n+package de.danoeh.antennapod.ui.common;\n \n import android.content.Context;\n import android.content.DialogInterface;\n@@ -6,8 +6,6 @@\n import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import android.util.Log;\n \n-import de.danoeh.antennapod.core.R;\n-\n /**\n  * Creates an AlertDialog which asks the user to confirm something. Other\n  * classes can handle events like confirmation or cancellation.\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/util/IntentUtils.java b/ui/common/src/main/java/de/danoeh/antennapod/ui/common/IntentUtils.java\nsimilarity index 96%\nrename from core/src/main/java/de/danoeh/antennapod/core/util/IntentUtils.java\nrename to ui/common/src/main/java/de/danoeh/antennapod/ui/common/IntentUtils.java\nindex 8b30b4eace..26c703e7b8 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/util/IntentUtils.java\n+++ b/ui/common/src/main/java/de/danoeh/antennapod/ui/common/IntentUtils.java\n@@ -1,4 +1,4 @@\n-package de.danoeh.antennapod.core.util;\n+package de.danoeh.antennapod.ui.common;\n \n import android.content.ActivityNotFoundException;\n import android.content.Context;\n@@ -8,7 +8,6 @@\n import android.net.Uri;\n import android.util.Log;\n import android.widget.Toast;\n-import de.danoeh.antennapod.core.R;\n import org.apache.commons.io.IOUtils;\n import org.apache.commons.lang3.ArrayUtils;\n \n@@ -52,7 +51,6 @@ public static void openInBrowser(Context context, String url) {\n         }\n     }\n \n-\n     public static String getLocalizedWebsiteLink(Context context) {\n         try (InputStream is = context.getAssets().open(\"website-languages.txt\")) {\n             String[] languages = IOUtils.toString(is, StandardCharsets.UTF_8.name()).split(\"\\n\");\ndiff --git a/core/src/main/res/drawable/bg_blue_gradient.xml b/ui/common/src/main/res/drawable/bg_blue_gradient.xml\nsimilarity index 100%\nrename from core/src/main/res/drawable/bg_blue_gradient.xml\nrename to ui/common/src/main/res/drawable/bg_blue_gradient.xml\ndiff --git a/core/src/main/res/drawable/bg_circle.xml b/ui/common/src/main/res/drawable/bg_circle.xml\nsimilarity index 100%\nrename from core/src/main/res/drawable/bg_circle.xml\nrename to ui/common/src/main/res/drawable/bg_circle.xml\ndiff --git a/core/src/main/res/drawable/bg_drawer_item.xml b/ui/common/src/main/res/drawable/bg_drawer_item.xml\nsimilarity index 100%\nrename from core/src/main/res/drawable/bg_drawer_item.xml\nrename to ui/common/src/main/res/drawable/bg_drawer_item.xml\ndiff --git a/core/src/main/res/drawable/bg_gradient.xml b/ui/common/src/main/res/drawable/bg_gradient.xml\nsimilarity index 100%\nrename from core/src/main/res/drawable/bg_gradient.xml\nrename to ui/common/src/main/res/drawable/bg_gradient.xml\ndiff --git a/core/src/main/res/drawable/bg_pill.xml b/ui/common/src/main/res/drawable/bg_pill.xml\nsimilarity index 100%\nrename from core/src/main/res/drawable/bg_pill.xml\nrename to ui/common/src/main/res/drawable/bg_pill.xml\ndiff --git a/core/src/main/res/drawable/bg_rounded_corners.xml b/ui/common/src/main/res/drawable/bg_rounded_corners.xml\nsimilarity index 100%\nrename from core/src/main/res/drawable/bg_rounded_corners.xml\nrename to ui/common/src/main/res/drawable/bg_rounded_corners.xml\ndiff --git a/ui/preferences/src/main/assets/website-languages.txt b/ui/common/website-languages.txt\nsimilarity index 100%\nrename from ui/preferences/src/main/assets/website-languages.txt\nrename to ui/common/website-languages.txt\ndiff --git a/ui/preferences/build.gradle b/ui/preferences/build.gradle\nindex a777b43327..eb595da584 100644\n--- a/ui/preferences/build.gradle\n+++ b/ui/preferences/build.gradle\n@@ -23,7 +23,6 @@ android {\n }\n \n dependencies {\n-    implementation project(\":core\")\n     implementation project(\":event\")\n     implementation project(\":net:common\")\n     implementation project(\":net:sync:model\")\ndiff --git a/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/about/AboutFragment.java b/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/about/AboutFragment.java\nindex ad956ed717..3e30b44dd8 100644\n--- a/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/about/AboutFragment.java\n+++ b/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/about/AboutFragment.java\n@@ -10,7 +10,7 @@\n import androidx.appcompat.app.AppCompatActivity;\n import androidx.preference.PreferenceFragmentCompat;\n import com.google.android.material.snackbar.Snackbar;\n-import de.danoeh.antennapod.core.util.IntentUtils;\n+import de.danoeh.antennapod.ui.common.IntentUtils;\n import de.danoeh.antennapod.ui.preferences.BuildConfig;\n import de.danoeh.antennapod.ui.preferences.R;\n \ndiff --git a/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/about/LicensesFragment.java b/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/about/LicensesFragment.java\nindex 85badcefcf..1a60d03ce8 100644\n--- a/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/about/LicensesFragment.java\n+++ b/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/about/LicensesFragment.java\n@@ -9,7 +9,7 @@\n import androidx.appcompat.app.AppCompatActivity;\n import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import androidx.fragment.app.ListFragment;\n-import de.danoeh.antennapod.core.util.IntentUtils;\n+import de.danoeh.antennapod.ui.common.IntentUtils;\n import de.danoeh.antennapod.ui.preferences.R;\n import io.reactivex.Single;\n import io.reactivex.SingleOnSubscribe;\ndiff --git a/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/downloads/DataFolderAdapter.java b/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/downloads/DataFolderAdapter.java\nindex bd6a75503e..99f63156c2 100644\n--- a/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/downloads/DataFolderAdapter.java\n+++ b/ui/preferences/src/main/java/de/danoeh/antennapod/ui/preferences/screen/downloads/DataFolderAdapter.java\n@@ -1,6 +1,7 @@\n package de.danoeh.antennapod.ui.preferences.screen.downloads;\n \n import android.content.Context;\n+import android.os.StatFs;\n import android.text.format.Formatter;\n import android.view.LayoutInflater;\n import android.view.View;\n@@ -12,7 +13,6 @@\n import androidx.core.util.Consumer;\n import androidx.recyclerview.widget.RecyclerView;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n-import de.danoeh.antennapod.core.util.StorageUtils;\n import de.danoeh.antennapod.ui.preferences.R;\n \n import java.io.File;\n@@ -125,11 +125,17 @@ String getFullPath() {\n         }\n \n         long getAvailableSpace() {\n-            return StorageUtils.getFreeSpaceAvailable(path);\n+            StatFs stat = new StatFs(path);\n+            long availableBlocks = stat.getAvailableBlocksLong();\n+            long blockSize = stat.getBlockSizeLong();\n+            return availableBlocks * blockSize;\n         }\n \n         long getTotalSpace() {\n-            return StorageUtils.getTotalSpaceAvailable(path);\n+            StatFs stat = new StatFs(path);\n+            long blockCount = stat.getBlockCountLong();\n+            long blockSize = stat.getBlockSizeLong();\n+            return blockCount * blockSize;\n         }\n \n         int getUsagePercentage() {\ndiff --git a/core/src/main/res/values/arrays.xml b/ui/preferences/src/main/res/values/arrays.xml\nsimilarity index 100%\nrename from core/src/main/res/values/arrays.xml\nrename to ui/preferences/src/main/res/values/arrays.xml\ndiff --git a/core/src/main/res/values/keycodes.xml b/ui/preferences/src/main/res/values/keycodes.xml\nsimilarity index 100%\nrename from core/src/main/res/values/keycodes.xml\nrename to ui/preferences/src/main/res/values/keycodes.xml\ndiff --git a/ui/statistics/build.gradle b/ui/statistics/build.gradle\nindex 1e33a0f0a0..be86665a79 100644\n--- a/ui/statistics/build.gradle\n+++ b/ui/statistics/build.gradle\n@@ -9,7 +9,6 @@ android {\n }\n \n dependencies {\n-    implementation project(\":core\")\n     implementation project(\":event\")\n     implementation project(\":model\")\n     implementation project(':storage:database')\ndiff --git a/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/StatisticsFragment.java b/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/StatisticsFragment.java\nindex a2f9e81460..74a0eaa5f2 100644\n--- a/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/StatisticsFragment.java\n+++ b/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/StatisticsFragment.java\n@@ -18,7 +18,7 @@\n \n import com.google.android.material.tabs.TabLayout;\n import com.google.android.material.tabs.TabLayoutMediator;\n-import de.danoeh.antennapod.core.util.ConfirmationDialog;\n+import de.danoeh.antennapod.ui.common.ConfirmationDialog;\n import de.danoeh.antennapod.storage.database.DBWriter;\n import de.danoeh.antennapod.event.StatisticsEvent;\n import de.danoeh.antennapod.ui.common.PagedToolbarFragment;\ndiff --git a/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/feed/FeedStatisticsFragment.java b/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/feed/FeedStatisticsFragment.java\nindex 6a9e807402..aacd1294d5 100644\n--- a/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/feed/FeedStatisticsFragment.java\n+++ b/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/feed/FeedStatisticsFragment.java\n@@ -13,7 +13,7 @@\n import de.danoeh.antennapod.storage.database.StatisticsItem;\n import de.danoeh.antennapod.ui.common.Converter;\n import de.danoeh.antennapod.ui.common.DateFormatter;\n-import de.danoeh.antennapod.core.util.ReleaseScheduleGuesser;\n+import de.danoeh.antennapod.storage.database.ReleaseScheduleGuesser;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n import de.danoeh.antennapod.model.feed.SortOrder;\n", "test_patch": "diff --git a/core/src/test/java/android/util/Log.java b/core/src/test/java/android/util/Log.java\ndeleted file mode 100644\nindex a65bc80fad..0000000000\n--- a/core/src/test/java/android/util/Log.java\n+++ /dev/null\n@@ -1,246 +0,0 @@\n-package android.util;\n-\n-import java.io.PrintWriter;\n-import java.io.StringWriter;\n-\n-/**\n- * A stub for {@link android.util.Log} to be used in unit tests.\n- *\n- * It outputs the log statements to standard error.\n- */\n-public final class Log {\n-\n-    /**\n-     * Priority constant for the println method; use Log.v.\n-     */\n-    public static final int VERBOSE = 2;\n-\n-    /**\n-     * Priority constant for the println method; use Log.d.\n-     */\n-    public static final int DEBUG = 3;\n-\n-    /**\n-     * Priority constant for the println method; use Log.i.\n-     */\n-    public static final int INFO = 4;\n-\n-    /**\n-     * Priority constant for the println method; use Log.w.\n-     */\n-    public static final int WARN = 5;\n-\n-    /**\n-     * Priority constant for the println method; use Log.e.\n-     */\n-    public static final int ERROR = 6;\n-\n-    /**\n-     * Priority constant for the println method.\n-     */\n-    public static final int ASSERT = 7;\n-\n-    private Log() {\n-    }\n-\n-    /**\n-     * Send a {@link #VERBOSE} log message.\n-     * @param tag Used to identify the source of a log message.  It usually identifies\n-     *        the class or activity where the log call occurs.\n-     * @param msg The message you would like logged.\n-     */\n-    public static int v(String tag, String msg) {\n-        return println_native(LOG_ID_MAIN, VERBOSE, tag, msg);\n-    }\n-\n-    /**\n-     * Send a {@link #VERBOSE} log message and log the exception.\n-     * @param tag Used to identify the source of a log message.  It usually identifies\n-     *        the class or activity where the log call occurs.\n-     * @param msg The message you would like logged.\n-     * @param tr An exception to log\n-     */\n-    public static int v(String tag, String msg, Throwable tr) {\n-        return printlns(LOG_ID_MAIN, VERBOSE, tag, msg, tr);\n-    }\n-\n-    /**\n-     * Send a {@link #DEBUG} log message.\n-     * @param tag Used to identify the source of a log message.  It usually identifies\n-     *        the class or activity where the log call occurs.\n-     * @param msg The message you would like logged.\n-     */\n-    public static int d(String tag, String msg) {\n-        return println_native(LOG_ID_MAIN, DEBUG, tag, msg);\n-    }\n-\n-    /**\n-     * Send a {@link #DEBUG} log message and log the exception.\n-     * @param tag Used to identify the source of a log message.  It usually identifies\n-     *        the class or activity where the log call occurs.\n-     * @param msg The message you would like logged.\n-     * @param tr An exception to log\n-     */\n-    public static int d(String tag, String msg, Throwable tr) {\n-        return printlns(LOG_ID_MAIN, DEBUG, tag, msg, tr);\n-    }\n-\n-    /**\n-     * Send an {@link #INFO} log message.\n-     * @param tag Used to identify the source of a log message.  It usually identifies\n-     *        the class or activity where the log call occurs.\n-     * @param msg The message you would like logged.\n-     */\n-    public static int i(String tag, String msg) {\n-        return println_native(LOG_ID_MAIN, INFO, tag, msg);\n-    }\n-\n-    /**\n-     * Send a {@link #INFO} log message and log the exception.\n-     * @param tag Used to identify the source of a log message.  It usually identifies\n-     *        the class or activity where the log call occurs.\n-     * @param msg The message you would like logged.\n-     * @param tr An exception to log\n-     */\n-    public static int i(String tag, String msg, Throwable tr) {\n-        return printlns(LOG_ID_MAIN, INFO, tag, msg, tr);\n-    }\n-\n-    /**\n-     * Send a {@link #WARN} log message.\n-     * @param tag Used to identify the source of a log message.  It usually identifies\n-     *        the class or activity where the log call occurs.\n-     * @param msg The message you would like logged.\n-     */\n-    public static int w(String tag, String msg) {\n-        return println_native(LOG_ID_MAIN, WARN, tag, msg);\n-    }\n-\n-    /**\n-     * Send a {@link #WARN} log message and log the exception.\n-     * @param tag Used to identify the source of a log message.  It usually identifies\n-     *        the class or activity where the log call occurs.\n-     * @param msg The message you would like logged.\n-     * @param tr An exception to log\n-     */\n-    public static int w(String tag, String msg, Throwable tr) {\n-        return printlns(LOG_ID_MAIN, WARN, tag, msg, tr);\n-    }\n-\n-    /**\n-     * Checks to see whether or not a log for the specified tag is loggable at the specified level.\n-     *\n-     * @return true in all cases (for unit test environment)\n-     */\n-    public static boolean isLoggable(String tag, int level) {\n-        return true;\n-    }\n-\n-    /*\n-     * Send a {@link #WARN} log message and log the exception.\n-     * @param tag Used to identify the source of a log message.  It usually identifies\n-     *        the class or activity where the log call occurs.\n-     * @param tr An exception to log\n-     */\n-    public static int w(String tag, Throwable tr) {\n-        return printlns(LOG_ID_MAIN, WARN, tag, \"\", tr);\n-    }\n-\n-    /**\n-     * Send an {@link #ERROR} log message.\n-     * @param tag Used to identify the source of a log message.  It usually identifies\n-     *        the class or activity where the log call occurs.\n-     * @param msg The message you would like logged.\n-     */\n-    public static int e(String tag, String msg) {\n-        return println_native(LOG_ID_MAIN, ERROR, tag, msg);\n-    }\n-\n-    /**\n-     * Send a {@link #ERROR} log message and log the exception.\n-     * @param tag Used to identify the source of a log message.  It usually identifies\n-     *        the class or activity where the log call occurs.\n-     * @param msg The message you would like logged.\n-     * @param tr An exception to log\n-     */\n-    public static int e(String tag, String msg, Throwable tr) {\n-        return printlns(LOG_ID_MAIN, ERROR, tag, msg, tr);\n-    }\n-\n-    /**\n-     * What a Terrible Failure: Report a condition that should never happen.\n-     * The error will always be logged at level ASSERT with the call stack.\n-     * Depending on system configuration, a report may be added to the\n-     * {@link android.os.DropBoxManager} and/or the process may be terminated\n-     * immediately with an error dialog.\n-     * @param tag Used to identify the source of a log message.\n-     * @param msg The message you would like logged.\n-     */\n-    public static int wtf(String tag, String msg) {\n-        return wtf(LOG_ID_MAIN, tag, msg, null, false, false);\n-    }\n-\n-    /**\n-     * Like {@link #wtf(String, String)}, but also writes to the log the full\n-     * call stack.\n-     * @hide\n-     */\n-    public static int wtfStack(String tag, String msg) {\n-        return wtf(LOG_ID_MAIN, tag, msg, null, true, false);\n-    }\n-\n-    /**\n-     * What a Terrible Failure: Report an exception that should never happen.\n-     * Similar to {@link #wtf(String, String)}, with an exception to log.\n-     * @param tag Used to identify the source of a log message.\n-     * @param tr An exception to log.\n-     */\n-    public static int wtf(String tag, Throwable tr) {\n-        return wtf(LOG_ID_MAIN, tag, tr.getMessage(), tr, false, false);\n-    }\n-\n-    /**\n-     * What a Terrible Failure: Report an exception that should never happen.\n-     * Similar to {@link #wtf(String, Throwable)}, with a message as well.\n-     * @param tag Used to identify the source of a log message.\n-     * @param msg The message you would like logged.\n-     * @param tr An exception to log.  May be null.\n-     */\n-    public static int wtf(String tag, String msg, Throwable tr) {\n-        return wtf(LOG_ID_MAIN, tag, msg, tr, false, false);\n-    }\n-\n-    /**\n-     * Priority Constant for wtf.\n-     * Added for this custom Log implementation, not in android sources.\n-     */\n-    private static final int WTF = 8;\n-\n-    static int wtf(int logId, String tag, String msg, Throwable tr, boolean localStack,\n-                   boolean system) {\n-        return printlns(LOG_ID_MAIN, WTF, tag, msg, tr);\n-    }\n-\n-    private static final int LOG_ID_MAIN = 0;\n-\n-    private static final String[] PRIORITY_ABBREV = { \"0\", \"1\", \"V\", \"D\", \"I\", \"W\", \"E\", \"A\", \"WTF\" };\n-\n-    private static int println_native(int bufID, int priority, String tag, String msg) {\n-        String res = PRIORITY_ABBREV[priority] + \"/\" + tag + \" \" + msg + System.lineSeparator();\n-        System.err.print(res);\n-        return res.length();\n-    }\n-\n-    private static int printlns(int bufID, int priority, String tag, String msg,\n-                               Throwable tr) {\n-        StringWriter trSW = new StringWriter();\n-        if (tr != null) {\n-            trSW.append(\" , Exception: \");\n-            PrintWriter trPW = new PrintWriter(trSW);\n-            tr.printStackTrace(trPW);\n-            trPW.flush();\n-        }\n-        return println_native(bufID, priority, tag, msg + trSW.toString());\n-    }\n-\n-}\ndiff --git a/core/src/test/java/de/danoeh/antennapod/core/util/FeedItemUtilTest.java b/model/src/test/java/de/danoeh/antennapod/model/feed/FeedItemFallbackLinkTest.java\nsimilarity index 53%\nrename from core/src/test/java/de/danoeh/antennapod/core/util/FeedItemUtilTest.java\nrename to model/src/test/java/de/danoeh/antennapod/model/feed/FeedItemFallbackLinkTest.java\nindex df9617ab44..c0ea222e44 100644\n--- a/core/src/test/java/de/danoeh/antennapod/core/util/FeedItemUtilTest.java\n+++ b/model/src/test/java/de/danoeh/antennapod/model/feed/FeedItemFallbackLinkTest.java\n@@ -1,23 +1,18 @@\n-package de.danoeh.antennapod.core.util;\n+package de.danoeh.antennapod.model.feed;\n \n import org.junit.Test;\n import org.junit.runner.RunWith;\n import org.junit.runners.Parameterized;\n import org.junit.runners.Parameterized.Parameters;\n \n-import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.Collection;\n import java.util.Collections;\n-import java.util.List;\n-\n-import de.danoeh.antennapod.model.feed.Feed;\n-import de.danoeh.antennapod.model.feed.FeedItem;\n \n import static org.junit.Assert.assertEquals;\n \n @RunWith(Parameterized.class)\n-public class FeedItemUtilTest {\n+public class FeedItemFallbackLinkTest {\n     private static final String FEED_LINK = \"http://example.com\";\n     private static final String ITEM_LINK = \"http://example.com/feedItem1\";\n \n@@ -39,57 +34,16 @@ public static Collection<Object[]> data() {\n         });\n     }\n \n-    public FeedItemUtilTest(String msg, String feedLink, String itemLink, String expected) {\n+    public FeedItemFallbackLinkTest(String msg, String feedLink, String itemLink, String expected) {\n         this.msg = msg;\n         this.feedLink = feedLink;\n         this.itemLink = itemLink;\n         this.expected = expected;\n     }\n \n-\n-    // Test the getIds() method\n-    @Test\n-    public void testGetIds() {\n-        List<FeedItem> feedItemsList = new ArrayList<FeedItem>(5);\n-        List<Integer> idList = new ArrayList<Integer>();\n-\n-        idList.add(980);\n-        idList.add(324);\n-        idList.add(226);\n-        idList.add(164);\n-        idList.add(854);\n-\n-        for (int i = 0; i < 5; i++) {\n-            FeedItem item = createFeedItem(feedLink, itemLink);\n-            item.setId(idList.get(i));\n-            feedItemsList.add(item);\n-        }\n-\n-        long[] actual = FeedItemUtil.getIds(feedItemsList);\n-\n-        // covers edge case for getIds() method\n-        List<FeedItem> emptyList = new ArrayList<FeedItem>();\n-        long[] testEmptyList = FeedItemUtil.getIds(emptyList);\n-        assertEquals(msg, 0, testEmptyList.length);\n-        assertEquals(msg, 980, actual[0]);\n-        assertEquals(msg, 324, actual[1]);\n-        assertEquals(msg, 226, actual[2]);\n-        assertEquals(msg, 164, actual[3]);\n-        assertEquals(msg, 854, actual[4]);\n-\n-    }\n-\n-    // Tests the Null value for getLinkWithFallback() method\n-    @Test\n-    public void testLinkWithFallbackNullValue() {\n-        String actual = FeedItemUtil.getLinkWithFallback(null);\n-        assertEquals(msg, null, actual);\n-    }\n-\n-\n     @Test\n     public void testLinkWithFallback() {\n-        String actual = FeedItemUtil.getLinkWithFallback(createFeedItem(feedLink, itemLink));\n+        String actual = createFeedItem(feedLink, itemLink).getLinkWithFallback();\n         assertEquals(msg, expected, actual);\n     }\n \ndiff --git a/net/download/service/src/test/java/de/danoeh/antennapod/net/download/service/episode/autodownload/DbWriterTest.java b/net/download/service/src/test/java/de/danoeh/antennapod/net/download/service/episode/autodownload/DbWriterTest.java\nindex 38d3e5dd0d..ccb822a916 100644\n--- a/net/download/service/src/test/java/de/danoeh/antennapod/net/download/service/episode/autodownload/DbWriterTest.java\n+++ b/net/download/service/src/test/java/de/danoeh/antennapod/net/download/service/episode/autodownload/DbWriterTest.java\n@@ -36,7 +36,6 @@\n import de.danoeh.antennapod.model.feed.FeedMedia;\n import de.danoeh.antennapod.storage.preferences.PlaybackPreferences;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n-import de.danoeh.antennapod.core.util.FeedItemUtil;\n \n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertFalse;\n@@ -610,17 +609,12 @@ public void testAddQueueItemMultipleItems() throws Exception {\n         Cursor cursor = adapter.getQueueIDCursor();\n         assertTrue(cursor.moveToFirst());\n         assertEquals(numItems, cursor.getCount());\n-        List<Long> expectedIds;\n-        expectedIds = FeedItemUtil.getIdList(feed.getItems());\n-        List<Long> actualIds = new ArrayList<>();\n         for (int i = 0; i < numItems; i++) {\n             assertTrue(cursor.moveToPosition(i));\n-            actualIds.add(cursor.getLong(0));\n+            assertEquals(feed.getItems().get(i).getId(), cursor.getLong(0));\n         }\n         cursor.close();\n         adapter.close();\n-        assertEquals(\"Bulk add to queue: result order should be the same as the order given\",\n-                expectedIds, actualIds);\n     }\n \n     @Test\ndiff --git a/core/src/test/java/de/danoeh/antennapod/core/util/ReleaseScheduleGuesserRealWorldTest.java b/storage/database/src/test/java/de/danoeh/antennapod/storage/database/ReleaseScheduleGuesserRealWorldTest.java\nsimilarity index 93%\nrename from core/src/test/java/de/danoeh/antennapod/core/util/ReleaseScheduleGuesserRealWorldTest.java\nrename to storage/database/src/test/java/de/danoeh/antennapod/storage/database/ReleaseScheduleGuesserRealWorldTest.java\nindex dd3cd763b8..3bcdb21aa4 100644\n--- a/core/src/test/java/de/danoeh/antennapod/core/util/ReleaseScheduleGuesserRealWorldTest.java\n+++ b/storage/database/src/test/java/de/danoeh/antennapod/storage/database/ReleaseScheduleGuesserRealWorldTest.java\n@@ -1,4 +1,4 @@\n-package de.danoeh.antennapod.core.util;\n+package de.danoeh.antennapod.storage.database;\n \n import de.danoeh.antennapod.parser.feed.util.DateUtils;\n import org.apache.commons.io.IOUtils;\n@@ -73,9 +73,12 @@ public void testRealWorld() throws Exception {\n \n             final boolean is3hoursClose = Math.abs(dateActual.getTime() - guess.nextExpectedDate.getTime())\n                     < 3 * ReleaseScheduleGuesser.ONE_HOUR;\n-            System.out.println(lineNr + \" guessed: \" + DATE_FORMAT.format(guess.nextExpectedDate)\n-                    + \", actual: \" + DATE_FORMAT.format(dateActual)\n-                    + \" \" + guess.schedule.name() + (is3hoursClose ? \" \u2714\" : \"\"));\n+            //noinspection ConstantValue\n+            if (false) {\n+                System.out.println(lineNr + \" guessed: \" + DATE_FORMAT.format(guess.nextExpectedDate)\n+                        + \", actual: \" + DATE_FORMAT.format(dateActual)\n+                        + \" \" + guess.schedule.name() + (is3hoursClose ? \" \u2714\" : \"\"));\n+            }\n             long deltaTime = dateActual.getTime() - guess.nextExpectedDate.getTime();\n             int histogramClass = (int) Math.max(0, Math.min(100, deltaTime / ReleaseScheduleGuesser.ONE_HOUR + 50));\n             histogram[histogramClass]++;\ndiff --git a/core/src/test/java/de/danoeh/antennapod/core/util/ReleaseScheduleGuesserTest.java b/storage/database/src/test/java/de/danoeh/antennapod/storage/database/ReleaseScheduleGuesserTest.java\nsimilarity index 94%\nrename from core/src/test/java/de/danoeh/antennapod/core/util/ReleaseScheduleGuesserTest.java\nrename to storage/database/src/test/java/de/danoeh/antennapod/storage/database/ReleaseScheduleGuesserTest.java\nindex aaad125c97..92fcbbea01 100644\n--- a/core/src/test/java/de/danoeh/antennapod/core/util/ReleaseScheduleGuesserTest.java\n+++ b/storage/database/src/test/java/de/danoeh/antennapod/storage/database/ReleaseScheduleGuesserTest.java\n@@ -1,4 +1,4 @@\n-package de.danoeh.antennapod.core.util;\n+package de.danoeh.antennapod.storage.database;\n \n import org.junit.Test;\n \n@@ -8,10 +8,10 @@\n import java.util.Date;\n import java.util.Locale;\n \n-import static de.danoeh.antennapod.core.util.ReleaseScheduleGuesser.ONE_DAY;\n-import static de.danoeh.antennapod.core.util.ReleaseScheduleGuesser.ONE_HOUR;\n-import static de.danoeh.antennapod.core.util.ReleaseScheduleGuesser.ONE_MINUTE;\n-import static de.danoeh.antennapod.core.util.ReleaseScheduleGuesser.performGuess;\n+import static de.danoeh.antennapod.storage.database.ReleaseScheduleGuesser.ONE_DAY;\n+import static de.danoeh.antennapod.storage.database.ReleaseScheduleGuesser.ONE_HOUR;\n+import static de.danoeh.antennapod.storage.database.ReleaseScheduleGuesser.ONE_MINUTE;\n+import static de.danoeh.antennapod.storage.database.ReleaseScheduleGuesser.performGuess;\n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertTrue;\n \ndiff --git a/core/src/test/resources/release_dates.csv b/storage/database/src/test/resources/release_dates.csv\nsimilarity index 100%\nrename from core/src/test/resources/release_dates.csv\nrename to storage/database/src/test/resources/release_dates.csv\ndiff --git a/core/src/test/resources/release_dates.sh b/storage/database/src/test/resources/release_dates.sh\nold mode 100755\nnew mode 100644\nsimilarity index 100%\nrename from core/src/test/resources/release_dates.sh\nrename to storage/database/src/test/resources/release_dates.sh\n", "problem_statement": "Modularize code to improve testability\n# Checklist\r\n<!-- Place an x in the boxes to tick them: [x] -->\r\n\r\n- [x] I have used the search function to see if someone else has already submitted the same feature request.\r\n- [x] I will only create one feature request per issue.\r\n- [x] I will describe the problem with as much detail as possible.\r\n\r\n# System info\r\n\r\n**App version**: 2.0.3\r\n<!-- The latest version may be different depending on your device. You can find the version in AntennaPod's settings. -->\r\n\r\n**App source**: not relevant\r\n<!-- Please delete irrelevant answer or fill in the blank -->\r\n\r\n# Feature description\r\n\r\n**Problem you may be having, or feature you want**:\r\n<!-- Give a brief explanation about the problem that may currently exist -->\r\n\r\nWhile investigating in #4569 to provide more unit tests I realized that the source code is very hard to unit test because it heavily uses static fields, static methods, and the package dependencies are very cyclic, see chart below.\r\n\r\n**Suggested solution**:\r\n<!-- Describe how your requested feature solves this problem. Try to be as specific as possible. Please not only explain what the feature does, but also how. -->\r\n\r\nTo improve testability the code would need some refactoring: The package structure should be acyclic, coupling between packages should be as low as possible.\r\n\r\n1. Do you think it is realistic to do refactoring step by step to make the code more testable via unit tests?\r\n2. Is it a desirable goal to improve testability as it might require a lot of effort, or are you almost happy with the (unit and integration) tests we have so far and spend the time mainly on new features?\r\n\r\n**Screenshots / Drawings / Technical details**:\r\n<!-- If your request is about (or includes) changing or extending the UI, describe what the UI would look like and how the user would interact with it. -->\r\n\r\nAntennaPod currently has about 54 kLOC in more than 480 Java classes.\r\n\r\nJava package dependency graph:\r\n(only shows packages starting with `de.danoeh.antennapod`, same color = same package depth)\r\n\r\n![graph](https://user-images.githubusercontent.com/46045854/98408256-28a18780-2071-11eb-9098-03bedabb6273.png)\r\n\n", "hints_text": "> The package structure should be acyclic, coupling between packages should be as low as possible.\r\n\r\n100% agree. AntennaPod's code base has historically grown. Even model objects like the \"FeedItem\" class perform database queries. The code is a real mess in many places. Over the past 3 years, I have reworked quite a few monsterous classes but it is still far from being a good code structure.\r\n\r\nThanks for generating the dependency graph. It's even worse than what I thought. There hardly is any package that is not inside a cycle.\r\n\r\n> are you almost happy with the (unit and integration) tests we have so far and spend the time mainly on new features?\r\n\r\nI spend most of my time fixing bugs. Then new features. If there is still time left, I maybe do some code cleanup. I'm definitely not happy about the code structure, though. And I would probably have to spend less time doing bug fixes if the code had more tests.\r\n\r\nA long-term goal would be to be able to separate the code base into multiple gradle modules (model, feed parser, media file parser, etc). I don't like the type of commits that touch everything at once because it creates conflicts in PRs and clutters the git history. So I think it would be best to start gradually and try to break some of the cycles. If one part (eg. the model) is completely free of dependencies, the files can be moved to a new gradle module (without code changes). I hope that this procedure then avoids completely breaking `git bisect`, which I use pretty much during bug fixing. Using gradle modules ensures that the graph stays acyclic because you simply can't access other gradle modules without thinking about it explicitly.\r\n\r\nI am also wondering if the package structure in AntennaPod should be changed generally. Currently, classes are sorted by type (adapters, fragments, etc). Maybe it would be more clear if we sorted them by their use within the app (audio player: fragment + views + adapters. Queue: fragment + adapter, ...). The separation into `app` and `core` module has lead to quite a number of strange constructs with static variables, too. The core module was once used to allow creating white-labeled apps but that time is long gone.\r\n\r\nIf you are interested in helping to make the code structure more clean, that would be really appreciated!\nI think rewriting it from scratch is far more efficient than breaking intertwined package cycles (if it's possible at all), in my experience.\nThat's what K-9 mail is doing since more than 2 years (and it is still not finished). In that time, their rating dropped significantly because users think that the project is abandoned. Also considering the fact that Google seems to rank apps based on their update behavior, a rewrite from scratch is not a path I want to go. We need to compete with commercial platforms that currently destroy the open podcast ecosystem instead of spending our time rewriting for the next 2 years.\nAfter a rough review of the packages I can imagine to structure the AntennaPod software architecture in the following way:\r\n\r\n![modules-refactoring](https://user-images.githubusercontent.com/46045854/99196982-c131b900-278f-11eb-9d42-a5cb0daa13be.png)\r\n\r\n**Module :app**\r\nResponsible for user interaction. Keeps all the packages it has now.\r\n\r\n**Module :feed**\r\nProvides an API for the :app module to read and modify feeds. Most of the non-ui business logic will be located here, mainly covers the current package `de.danoeh.antennapod.core.feed`.\r\n\r\n**Module :eventbus**\r\nProvides the EventBus (`org.greenrobot.eventbus.EventBus`), wraps the required access methods via non-static variables and methods.\r\n\r\n**Module :storage**\r\nProvides access to the feed data base, preferences and export/import. Mainly covers the current packages\r\n- `de.danoeh.antennapod.core.export`\r\n- `de.danoeh.antennapod.core.preferences`\r\n- `de.danoeh.antennapod.core.storage`\r\n\r\n**Module :communication**\r\nResponsible for all external communication, e.g. downloading feed data, synchronization with gpodder.net. Mainly covers the current packages\r\n- `de.danoeh.antennapod.core.service.download`\r\n- `de.danoeh.antennapod.core.ssl`\r\n- `de.danoeh.antennapod.core.sync`\r\n\r\nI suggest to start with the base modules `:eventbus`, `:storage:`, and `:communication`. First, we add a new module and then refactor all usages step by step. Important requirements are to allow only downward dependencies, no upward dependencies, and to avoid static variables and methods to provide a good testability via unit tests without the usage of `mockStatic` and other dirty hacks.\r\n\r\nAny comments on the approach? Anything else we should consider?\r\n\r\nShall we use Gradle modules to ensure only allowed dependencies? A more lightweight approach could be to check package dependencies via unit tests with e.g. [JDepend](https://github.com/clarkware/jdepend).\nI think we should first try to separate a \"model\" module (Feed, FeedItem, Chapter). Then it should be possible to move feed parsing and chapter parsing to their own modules (both depending on the model). I have not compared your graph with your suggested module structure in more detail yet but I think even with your structure, we need a \"model\" module.\r\n\r\n> Module :communication\r\n\r\nThis one could be hard to separate. It displays notifications which link to the main pages of the app. Not sure how that could be achieved if it does not have access to the main page. Child classes in the app module?\r\n\r\n> Shall we use Gradle modules to ensure only allowed dependencies?\r\n\r\nI think gradle modules would be nice.\n> I think we should first try to separate a \"model\" module (Feed, FeedItem, Chapter).\r\n\r\nA common data model is a very popular approach. But I want to emphasize a significant disadvantage: Most fields are kept optional (i.e. they can be null or empty) what makes the usage of the model error prone und complicated. So the model is like a superset of the fields required for several method calls. I collected some examples in AntennaPod:\r\n\r\n* The methods `DBReader.getFeedList()` and `DBTasks.searchFeeds()` return a list of `Feed` objects with an empty `feed.items` list.\r\n* The method `DBReader.loadDescriptionOfFeedItem(FeedItem item)` fills the fields `item.description` and `item.contentEncoded` which are `null` for all other method calls.\r\n* Whenever the methods `DownloadRequester.downloadFeed(..., Feed feed, ...)` and `DownloadRequester.createRequest(FeedFile feed, ...)` are called, almost all fields in `feed` are `null` except the field `download_url` and a few others.\r\n* The method `FeedHandler.parseFeed(Feed feed)` only uses the fields `download_url`, `file_url`, `type`, and `language` (only 4 of 23 fields).\r\n\r\nAlternatively, a more slim approach could be to let every module provide its own model that only covers the fields supported by its API. For example, the classes `SyncService` and `GpodnetService` provide their own model classes in their `model` sub packages and thus perfectly fit to their API. If necessary, code using two modules needs to have some glue code to convert data from one model to another model.\r\n\r\nWhat do you prefer?\r\n\r\n>> Module :communication\r\n\r\n> This one could be hard to separate. It displays notifications which link to the main pages of the app. Not sure how that could be achieved if it does not have access to the main page. Child classes in the app module?\r\n\r\nI can imagine to use the `EventBus` to display notifications, this would technically uncouple the UI from the business logic in that case. But I haven't checked the details in that cases.\r\n\r\n> I think gradle modules would be nice.\r\n\r\n:+1:\nRefactoring that code is really good idea. I would create at least 10 modules. One module should contain only few packages and every package should contain only few classes. Networking, persistence, view, event handling, model, utility, parsers etc.\r\n\r\nI encourage to consider using libraries like Lombok which reduce boilerplate. I never used [Android Jetpack](https://developer.android.com/jetpack/getting-started) but its worth looking into.\r\n\r\nThere are also tools for automatic code refactoring, some built in Android Studio. That will iterate through classes and refactor them. \r\n\r\nUnrelated question, probably to @ByteHamster , is it common practice in android development to use internal android package name to put implemented classes in? For ex. `com.google.android.material.bottomsheet.ViewPagerBottomSheetBehavior` .\nI suggest we roll up our sleeves and tackle changes to the code to make testing easier instead of talking about it.\n\nI would expect any of those PRs to add a test for each refactoring.\n\nCould we close this issue and get to work on it?\ud83d\ude01\n> Unrelated question, probably to @ByteHamster , is it common practice in android development to use internal android package name to put implemented classes in? For ex. com.google.android.material.bottomsheet.ViewPagerBottomSheetBehavior .\r\n\r\nThat's not a common practice but a hack to make it possible to extend a protected class\nSorry for the late reply @damoasda.\r\n\r\n> Alternatively, a more slim approach could be to let every module provide its own model that only covers the fields supported by its API.\r\n\r\nMost modules need access to the `Feed`, `FeedItem`, etc classes. I don't think those should be duplicated and converted for every single module. So I think as a first step, those could be separated (see also #4842). If that is done, we can already create modules for quite a few parts of the app (chapter parser, feed parser, OPML export, sync, maybe even database handling).\nMany parts of the app need to start the main activity with different parameters (eg. widget, playback service, download service, sync). Any idea how to do that while still de-coupling the code? Currently, we use a ton of static variables in `ClientConfig` [that are then set from the app module](https://github.com/AntennaPod/AntennaPod/blob/3f31764f58bdb8aab9182f3aa960ed827df42b9c/app/src/main/java/de/danoeh/antennapod/config/ClientConfigurator.java) but that is not really pretty.\nThat's the most difficult part of de-coupling the code. The class `ClientConfig` contains a collection of global references that might be dissolved in different steps:\r\n\r\n1) **`ClientConfig.applicationCallbacks`** is used to provide the `Context` reference and to return a new `StorageErrorActivity` intent. Possible solution:\r\n-- Hand over the `Context` reference as an additional parameter in the corresponding helper methods.\r\n-- Move the method `applicationCallbacks.getStorageErrorActivity()` body into the method `StorageUtils.checkStorageAvailability()` as it is the only place that uses the method.\r\n\r\n2) **`ClientConfig.downloadServiceCallbacks`** provides helper methods for the `DownloadService`.\r\nPossible solution: Move `DownloadService` to app module.\r\n\r\n3) **`ClientConfig.playbackServiceCallbacks`** provides a single method getPlayerActivityIntent() that is used by the `PlaybackService`.\r\nPossible solution: Move `PlaybackService` to app module.\r\n\r\n4) **`ClientConfig.automaticDownloadAlgorithm`** is only used by `DBTasks.autodownloadUndownloadedItems()` which is called by `DownloadService`, `DBWriter`, `ConnectivityActionReceiver`, and `PowerConnectionReceiver`. As both, the implementation and its usage are in  the `core` module, it should be easy to get rid of the field `ClientConfig.automaticDownloadAlgorithm`.\r\n\r\n5) **`ClientConfig.castCallbacks`** is only used by `CastManager` for the \"play\" flavour to access a fragment.\r\nPossible solution: Move `CastManager` to app module.\nI had another idea for how to start the main activity (eg from DownloadService) that could work without moving all services to the same module. We could create an `intents` module that can send a specific intent. The intent is then picked up and interpreted by the main activity. I will try to come up with a proof-of-concept.\nVery interesting. That sounds similar to the `EventBus` that could be an alternative.\nEventBus only works when the app is already started but the idea is pretty much the same, yeah :)\nI just tried to come up with a more detailed module structure. Looks a lot more cluttered than yours but I think it could be good to make it more detailed, so that the code is as decoupled as possible. (click to enlarge)\r\n\r\n![modules](https://user-images.githubusercontent.com/5811634/131211095-7c38abec-09c8-4101-a929-23b6194a17a2.png)\r\n\r\nWhat do you think?\r\n\r\nEdit: Green modules are already done.\nWow, that's awesome! The graph is acyclic, the services are separated, and also the UI is split into several logic units.\r\n\r\nMaybe we will identify more module candidates like \":storage:export\" during the refactoring work or we will merge two modules again because the dependencies are too hard to dissolve. But that's fully ok and a concession to practice. :smile:\r\n\r\nI'd be happy to start with your modularization approach.\nOkay, nice :) Now that the `:app-start-intent` module is separated, we have to deal with the model module. Without that module, most others cannot be modularized. @widlok already started working on this in #4842 but the PR got a bit too big to handle. So I suggest to start with small steps and multiple individual PRs before actually creating the module. Some ideas for small chunks of work that could be done in individual PRs:\r\n\r\n- [x] Remove `Cursor` related code from the model, as it is database specific\r\n- [x] Decouple loading shownotes (I think this should be done after #3974 is merged)\r\n- [x] Decouple loading chapter marks\r\n- [x] Decouple saving FeedPreferences\r\n- [x] `loadMetadata` in FeedMedia\r\n- [x] `saveCurrentPosition` should be performed outside the model\r\n\r\nOnce all of that is done, I think we can move some model classes to their own module\nJust in case you run into problems in Android Studio where the modules are not displayed in the correct subfolders, try closing AS, then deleting `AntennaPod/.idea/modules.xml` and `AntennaPod/.idea/modules/*`. Took me a while to figure this out.\n@ByteHamster Hi, I would like to offer my help in the refactoring efforts. \r\nLet me know where I can start. \r\nFor now, I have a few suggestions I thought i'd throw out there. \r\n1. Have designated developer be resposnbile for their own module(s).\r\n2. I would like to be assigned to work on storage or may eveentbus.\r\n\n> I would like to offer my help in the refactoring efforts.\r\n\r\nAwesome!\r\n\r\n> I would like to be assigned to work on storage or may eveentbus.\r\n\r\nFirst, we need to uncouple the model from the rest of the code. When that is done, we can start to do other modules (see https://github.com/AntennaPod/AntennaPod/issues/4661#issuecomment-778614258). If you want to do a PR like #4968 (but for another class), that would be great.\r\n\r\nAbout EventBus: I think we should change some of the events. Currently, every page in the app basically receives every event. I would love if it could be simplified to fewer events but that needs some more thinking to still be efficient and flexible. Maybe event subclasses could help in case that's supported by EventBus. Anyway, the model needs to be changed first :)\n@ByteHamster Awesome! I'll get to it as soon as possible. Also, it seem you introduced some lint errors when you push a commit for #5108. It would be great if we can resolve this and finally merge this. That would be one less PR to have to think about. \nDecoupling the model module will finally be done in #5129 :)\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/antennapod-2-3-0-release-notes/1047/1\n\n@damoasda What tool did you use to generate the dependency graph?\nI used [Graphviz](https://graphviz.org/).\nAnd how did you analyze the code to get a Graphviz file?\nI think I used the JDK tool jdeps. I found a note calling a command like this:\r\n`jdeps --no-recursive -verbose:package --regex ^de.danoeh.antennapod..* --dot-output . core`\nThanks! So what I ended up doing was to run these commands\r\n\r\n```\r\n./gradlew assembleDebug\r\nfind -name \"*.class\" | xargs /usr/lib/jvm/default/bin/jdeps --dot-output __dependencies\r\ncp __dependencies/summary.dot dependencies.dot\r\nrm -r __dependencies\r\nsed -i 's/\\$[^\\.]*\\././g' dependencies.dot # Replaces inner classes with top class\r\n```\r\n\r\nThen I used `gephi` to (manually, repeatedly) remove nodes that have `indegree==0` or `outdegree==0`. This leaves us with a quite small number of 31 classes that are strongly connected. Once these dependencies are decoupled, the classes can be \"peeled\" to different modules without any dependency cycles.\r\n\r\nA first decoupling of bloated utility classes (#6176) reduces the number of problematic classes down to only 19. The strongly connected classes give a quite nice overview about what needs to be done here.\r\n\r\n![screenshot_233437](https://user-images.githubusercontent.com/5811634/199615526-46dcc074-6f42-47ff-ad14-8adf40ab9afa.png)\nMaking some more progress in #6176. We are down to 11 problematic classes.\r\n\r\n![screenshot_232435](https://user-images.githubusercontent.com/5811634/199845990-340c2bb4-7f16-47c6-b7d1-561a58eb06b4.png)\r\n\r\nNow it gets kind of hard, though. We have a ton of real dependencies here. Not just bloated utility classes. For example, the Synchronization feature needs access to the database to store the new state. At the same time, the database needs access to the sync service to upload possible changes.\r\n\r\nMaybe we need to hide some classes behind an interface and then keep a reference to an actual implementation somewhere.That's not totally elegant, though. For the sync service, that should work rather easily, at least.\nWhen this is done, we can create nice module graphs for developer documentation using this gradle plugin: https://github.com/iurysza/module-graph/tree/main\nThe `core` module still does too many things but it is getting there...\r\n\r\n![grafik](https://github.com/AntennaPod/AntennaPod/assets/5811634/3f584416-6992-47b5-8e23-19faa0f7850e)\r\n", "created_at": "2024-04-04T21:23:17Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7053, "instance_id": "AntennaPod__AntennaPod-7053", "issue_numbers": ["7052"], "base_commit": "5e7858ef7e101115a45a90c8225580713789a24b", "patch": "diff --git a/playback/service/build.gradle b/playback/service/build.gradle\nindex e49052c444..439ec953d0 100644\n--- a/playback/service/build.gradle\n+++ b/playback/service/build.gradle\n@@ -26,6 +26,7 @@ dependencies {\n     implementation project(':ui:widget')\n \n     annotationProcessor \"androidx.annotation:annotation:$annotationVersion\"\n+    implementation \"androidx.car.app:app:1.4.0-rc02\"\n     implementation \"androidx.core:core:$coreVersion\"\n     implementation \"androidx.appcompat:appcompat:$appcompatVersion\"\n     implementation \"androidx.media:media:$mediaVersion\"\ndiff --git a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\nindex dfcb67e51d..b20a06ee9c 100644\n--- a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\n+++ b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\n@@ -45,9 +45,12 @@\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n import androidx.annotation.StringRes;\n+import androidx.car.app.connection.CarConnection;\n import androidx.core.app.NotificationCompat;\n import androidx.core.app.NotificationManagerCompat;\n import androidx.core.content.ContextCompat;\n+import androidx.lifecycle.LiveData;\n+import androidx.lifecycle.Observer;\n import androidx.media.MediaBrowserServiceCompat;\n \n import de.danoeh.antennapod.event.PlayerStatusEvent;\n@@ -172,6 +175,9 @@ public class PlaybackService extends MediaBrowserServiceCompat {\n     private MediaSessionCompat mediaSession;\n \n     private static volatile MediaType currentMediaType = MediaType.UNKNOWN;\n+    private LiveData<Integer> androidAutoConnectionState;\n+    private boolean androidAutoConnected = false;\n+    private Observer<Integer> androidAutoConnectionObserver;\n \n     private final IBinder mBinder = new LocalBinder();\n \n@@ -228,6 +234,11 @@ public void onCreate() {\n \n         stateManager = new PlaybackServiceStateManager(this);\n         notificationBuilder = new PlaybackServiceNotificationBuilder(this);\n+        androidAutoConnectionState = new CarConnection(this).getType();\n+        androidAutoConnectionObserver = connectionState -> {\n+            androidAutoConnected = connectionState == CarConnection.CONNECTION_TYPE_PROJECTION;\n+        };\n+        androidAutoConnectionState.observeForever(androidAutoConnectionObserver);\n \n         registerReceiver(autoStateUpdated, new IntentFilter(\"com.google.android.gms.car.media.STATUS\"));\n         registerReceiver(headsetDisconnected, new IntentFilter(Intent.ACTION_HEADSET_PLUG));\n@@ -317,6 +328,7 @@ public void onDestroy() {\n         currentMediaType = MediaType.UNKNOWN;\n         castStateListener.destroy();\n \n+        androidAutoConnectionState.removeObserver(androidAutoConnectionObserver);\n         cancelPositionObserver();\n         if (mediaSession != null) {\n             mediaSession.release();\n@@ -859,6 +871,10 @@ public void statusChanged(PlaybackServiceMediaPlayer.PSMPInfo newInfo) {\n                         int currentHour = now.get(Calendar.HOUR_OF_DAY);\n                         autoEnableByTime = SleepTimerPreferences.isInTimeRange(fromSetting, toSetting, currentHour);\n                     }\n+                    if (androidAutoConnected) {\n+                        Log.i(TAG, \"Android Auto is connected, sleep timer will not be auto-enabled\");\n+                        autoEnableByTime = false;\n+                    }\n \n                     if (newInfo.oldPlayerStatus != null && newInfo.oldPlayerStatus != PlayerStatus.SEEKING\n                             && SleepTimerPreferences.autoEnable() && autoEnableByTime && !sleepTimerActive()) {\n", "test_patch": "", "problem_statement": "sleep timer is automatically enabled when using Android Auto\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.3.2\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\nAP1A.240305.019.A1\n\n### Device model\n\nPixel 8\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Enable automatic sleep timer.\r\n2. Connect your phone to the car.\r\n3. Start playing back a podcast during the automatic sleep interval.\n\n### Expected behaviour\n\nAutomatic sleep is not enabled, since I'm not planning to fall asleep in the car. Also, there is no UI in the projection that tells me about the sleep timer, or allows to cancel it.\n\n### Current behaviour\n\nSleep timer is quietly enabled and playback is stopped after some time.\n\n### Logs\n\n_No response_\n", "hints_text": "I've prepared a draft pull request in #7053 just to demonstrate how this can be fixed. Let me know what you think.\r\n\r\nThank you very much in advance for your time, and for a great product!", "created_at": "2024-04-01T22:42:29Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7050, "instance_id": "AntennaPod__AntennaPod-7050", "issue_numbers": ["7049"], "base_commit": "edb440a5a9a05e24c344a71b272b9238217e9c55", "patch": "diff --git a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\nindex 138c9bc61e..dfcb67e51d 100644\n--- a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\n+++ b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\n@@ -831,6 +831,7 @@ public void statusChanged(PlaybackServiceMediaPlayer.PSMPInfo newInfo) {\n                     break;\n                 case PAUSED:\n                     updateNotificationAndMediaSession(newInfo.playable);\n+                    PlaybackPreferences.setCurrentPlayerStatus(PlaybackPreferences.PLAYER_STATUS_PAUSED);\n                     if (!isCasting) {\n                         stateManager.stopForeground(!UserPreferences.isPersistNotify());\n                     }\n@@ -841,6 +842,7 @@ public void statusChanged(PlaybackServiceMediaPlayer.PSMPInfo newInfo) {\n                     //stopService();\n                     break;\n                 case PLAYING:\n+                    PlaybackPreferences.setCurrentPlayerStatus(PlaybackPreferences.PLAYER_STATUS_PLAYING);\n                     saveCurrentPosition(true, null, Playable.INVALID_TIME);\n                     recreateMediaSessionIfNeeded();\n                     updateNotificationAndMediaSession(newInfo.playable);\ndiff --git a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/PlaybackPreferences.java b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/PlaybackPreferences.java\nindex d6d2604462..9ec20bd2ce 100644\n--- a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/PlaybackPreferences.java\n+++ b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/PlaybackPreferences.java\n@@ -109,6 +109,10 @@ public static int getCurrentPlayerStatus() {\n         return prefs.getInt(PREF_CURRENT_PLAYER_STATUS, PLAYER_STATUS_OTHER);\n     }\n \n+    public static void setCurrentPlayerStatus(int playerStatus) {\n+        prefs.edit().putInt(PREF_CURRENT_PLAYER_STATUS, playerStatus).apply();\n+    }\n+\n     public static float getCurrentlyPlayingTemporaryPlaybackSpeed() {\n         return prefs.getFloat(PREF_CURRENTLY_PLAYING_TEMPORARY_PLAYBACK_SPEED, FeedPreferences.SPEED_USE_GLOBAL);\n     }\n", "test_patch": "", "problem_statement": "Playback regression: Play/pause buttons are not updating\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n### App version\r\n\r\nDebug\r\n\r\n### Where did you get the app from\r\n\r\nOther\r\n\r\n### Android version\r\n\r\nN/A\r\n\r\n### Device model\r\n\r\nN/A\r\n\r\n### First occurred\r\n\r\nAs of commit 4078b34 (#7024)\r\n\r\n### Steps to reproduce\r\n\r\n1. Install debug artifact from https://github.com/AntennaPod/AntennaPod/actions/runs/8411809556\r\n2. Stream podcast episode (or download it and press play)\r\n3. Notice that buttons are not updating to reflect the new player status (\"stream\" does not go away and buttons still show the download icon; \"play\" does not go away and buttons still show the play icon)\r\n\r\n### Expected behaviour\r\n\r\nMedia can be paused and unpaused from any play/pause button.\r\n\r\n### Current behaviour\r\n\r\nWhen media is playing, multiple buttons do not update to show the pause button, and media cannot be paused via these buttons.\r\n\r\n### Logs\r\n\r\n_No response_\n", "hints_text": "Found this while testing some stuff (on the latest develop commit). I narrowed down the issue to this precise commit: https://github.com/AntennaPod/AntennaPod/commit/4078b3475e5140e6f5f9ef924bc8ff8d9e345113\nThe AudioPlayerFragment and ExternalPlayerFragment play/pause buttons still work fine, fwiw, but all the other ones do not (episodes list, queue list, \"continue listening\" home screen, etc.).", "created_at": "2024-04-01T06:35:04Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7048, "instance_id": "AntennaPod__AntennaPod-7048", "issue_numbers": ["6068"], "base_commit": "92ab575b150ab49ca85e0ac994558142e49c9e68", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/HomeFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/HomeFragment.java\nindex 0ed96a70ce..9b10031b63 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/HomeFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/HomeFragment.java\n@@ -6,22 +6,26 @@\n import android.content.pm.PackageManager;\n import android.os.Build;\n import android.os.Bundle;\n-import android.text.TextUtils;\n import android.util.Log;\n import android.view.LayoutInflater;\n import android.view.MenuItem;\n import android.view.View;\n import android.view.ViewGroup;\n-\n import androidx.annotation.NonNull;\n import androidx.appcompat.widget.Toolbar;\n import androidx.core.content.ContextCompat;\n import androidx.fragment.app.Fragment;\n import androidx.fragment.app.FragmentContainerView;\n-\n+import de.danoeh.antennapod.R;\n+import de.danoeh.antennapod.activity.MainActivity;\n+import de.danoeh.antennapod.databinding.HomeFragmentBinding;\n+import de.danoeh.antennapod.event.FeedListUpdateEvent;\n+import de.danoeh.antennapod.event.FeedUpdateRunningEvent;\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n import de.danoeh.antennapod.net.download.serviceinterface.FeedUpdateManager;\n+import de.danoeh.antennapod.storage.database.DBReader;\n import de.danoeh.antennapod.ui.echo.EchoConfig;\n+import de.danoeh.antennapod.ui.screen.SearchFragment;\n import de.danoeh.antennapod.ui.screen.home.sections.AllowNotificationsSection;\n import de.danoeh.antennapod.ui.screen.home.sections.DownloadsSection;\n import de.danoeh.antennapod.ui.screen.home.sections.EchoSection;\n@@ -29,28 +33,20 @@\n import de.danoeh.antennapod.ui.screen.home.sections.InboxSection;\n import de.danoeh.antennapod.ui.screen.home.sections.QueueSection;\n import de.danoeh.antennapod.ui.screen.home.sections.SubscriptionsSection;\n+import de.danoeh.antennapod.ui.screen.home.settingsdialog.HomePreferences;\n+import de.danoeh.antennapod.ui.screen.home.settingsdialog.HomeSectionsSettingsDialog;\n+import de.danoeh.antennapod.ui.view.LiftOnScrollListener;\n+import io.reactivex.Observable;\n+import io.reactivex.android.schedulers.AndroidSchedulers;\n+import io.reactivex.disposables.Disposable;\n+import io.reactivex.schedulers.Schedulers;\n import org.greenrobot.eventbus.EventBus;\n import org.greenrobot.eventbus.Subscribe;\n import org.greenrobot.eventbus.ThreadMode;\n \n-import java.util.ArrayList;\n-import java.util.Arrays;\n import java.util.Calendar;\n import java.util.List;\n \n-import de.danoeh.antennapod.R;\n-import de.danoeh.antennapod.activity.MainActivity;\n-import de.danoeh.antennapod.storage.database.DBReader;\n-import de.danoeh.antennapod.databinding.HomeFragmentBinding;\n-import de.danoeh.antennapod.event.FeedListUpdateEvent;\n-import de.danoeh.antennapod.event.FeedUpdateRunningEvent;\n-import de.danoeh.antennapod.ui.screen.SearchFragment;\n-import de.danoeh.antennapod.ui.view.LiftOnScrollListener;\n-import io.reactivex.Observable;\n-import io.reactivex.android.schedulers.AndroidSchedulers;\n-import io.reactivex.disposables.Disposable;\n-import io.reactivex.schedulers.Schedulers;\n-\n /**\n  * Shows unread or recently published episodes\n  */\n@@ -58,7 +54,6 @@ public class HomeFragment extends Fragment implements Toolbar.OnMenuItemClickLis\n \n     public static final String TAG = \"HomeFragment\";\n     public static final String PREF_NAME = \"PrefHomeFragment\";\n-    public static final String PREF_HIDDEN_SECTIONS = \"PrefHomeSectionsString\";\n     public static final String PREF_DISABLE_NOTIFICATION_PERMISSION_NAG = \"DisableNotificationPermissionNag\";\n     public static final String PREF_HIDE_ECHO = \"HideEcho\";\n \n@@ -106,12 +101,8 @@ private void populateSectionList() {\n             addSection(new EchoSection());\n         }\n \n-        List<String> hiddenSections = getHiddenSections(getContext());\n-        String[] sectionTags = getResources().getStringArray(R.array.home_section_tags);\n+        List<String> sectionTags = HomePreferences.getSortedSectionTags(getContext());\n         for (String sectionTag : sectionTags) {\n-            if (hiddenSections.contains(sectionTag)) {\n-                continue;\n-            }\n             addSection(getSection(sectionTag));\n         }\n     }\n@@ -140,12 +131,6 @@ private Fragment getSection(String tag) {\n         }\n     }\n \n-    public static List<String> getHiddenSections(Context context) {\n-        SharedPreferences prefs = context.getSharedPreferences(HomeFragment.PREF_NAME, Context.MODE_PRIVATE);\n-        String hiddenSectionsString = prefs.getString(HomeFragment.PREF_HIDDEN_SECTIONS, \"\");\n-        return new ArrayList<>(Arrays.asList(TextUtils.split(hiddenSectionsString, \",\")));\n-    }\n-\n     @Subscribe(sticky = true, threadMode = ThreadMode.MAIN)\n     public void onEventMainThread(FeedUpdateRunningEvent event) {\n         viewBinding.swipeRefresh.setRefreshing(event.isFeedUpdateRunning);\n@@ -154,7 +139,7 @@ public void onEventMainThread(FeedUpdateRunningEvent event) {\n     @Override\n     public boolean onMenuItemClick(MenuItem item) {\n         if (item.getItemId() == R.id.homesettings_items) {\n-            HomeSectionsSettingsDialog.open(getContext(), (dialogInterface, i) -> populateSectionList());\n+            HomeSectionsSettingsDialog.open(getContext(), this::populateSectionList);\n             return true;\n         } else if (item.getItemId() == R.id.refresh_item) {\n             FeedUpdateManager.getInstance().runOnceOrAsk(requireContext());\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/HomeSectionsSettingsDialog.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/HomeSectionsSettingsDialog.java\ndeleted file mode 100644\nindex 3238c299cd..0000000000\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/HomeSectionsSettingsDialog.java\n+++ /dev/null\n@@ -1,42 +0,0 @@\n-package de.danoeh.antennapod.ui.screen.home;\n-\n-import android.content.Context;\n-import android.content.DialogInterface;\n-import android.content.SharedPreferences;\n-import android.text.TextUtils;\n-import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n-import de.danoeh.antennapod.R;\n-\n-import java.util.List;\n-\n-public class HomeSectionsSettingsDialog {\n-    public static void open(Context context, DialogInterface.OnClickListener onSettingsChanged) {\n-        final List<String> hiddenSections = HomeFragment.getHiddenSections(context);\n-        String[] sectionLabels = context.getResources().getStringArray(R.array.home_section_titles);\n-        String[] sectionTags = context.getResources().getStringArray(R.array.home_section_tags);\n-        final boolean[] checked = new boolean[sectionLabels.length];\n-        for (int i = 0; i < sectionLabels.length; i++) {\n-            String tag = sectionTags[i];\n-            if (!hiddenSections.contains(tag)) {\n-                checked[i] = true;\n-            }\n-        }\n-\n-        MaterialAlertDialogBuilder builder = new MaterialAlertDialogBuilder(context);\n-        builder.setTitle(R.string.configure_home);\n-        builder.setMultiChoiceItems(sectionLabels, checked, (dialog, which, isChecked) -> {\n-            if (isChecked) {\n-                hiddenSections.remove(sectionTags[which]);\n-            } else {\n-                hiddenSections.add(sectionTags[which]);\n-            }\n-        });\n-        builder.setPositiveButton(R.string.confirm_label, (dialog, which) -> {\n-            SharedPreferences prefs = context.getSharedPreferences(HomeFragment.PREF_NAME, Context.MODE_PRIVATE);\n-            prefs.edit().putString(HomeFragment.PREF_HIDDEN_SECTIONS, TextUtils.join(\",\", hiddenSections)).apply();\n-            onSettingsChanged.onClick(dialog, which);\n-        });\n-        builder.setNegativeButton(R.string.cancel_label, null);\n-        builder.create().show();\n-    }\n-}\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/settingsdialog/HomePreferences.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/settingsdialog/HomePreferences.java\nnew file mode 100644\nindex 0000000000..a976524dd0\n--- /dev/null\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/settingsdialog/HomePreferences.java\n@@ -0,0 +1,85 @@\n+package de.danoeh.antennapod.ui.screen.home.settingsdialog;\n+\n+import android.content.Context;\n+import android.content.SharedPreferences;\n+import android.content.res.Resources;\n+import android.text.TextUtils;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.List;\n+\n+import de.danoeh.antennapod.R;\n+import de.danoeh.antennapod.ui.screen.home.HomeFragment;\n+\n+public class HomePreferences {\n+    private static final String PREF_HIDDEN_SECTIONS = \"PrefHomeSectionsString\";\n+    private static final String PREF_SECTION_ORDER = \"PrefHomeSectionOrder\";\n+    private static HashMap<String, String> sectionTagToName;\n+\n+    public static String getNameFromTag(Context context, String sectionTag) {\n+        if (sectionTagToName == null) {\n+            initializeMap(context);\n+        }\n+\n+        return sectionTagToName.get(sectionTag);\n+    }\n+\n+    private static void initializeMap(Context context) {\n+        Resources resources = context.getResources();\n+        String[] sectionLabels = resources.getStringArray(R.array.home_section_titles);\n+        String[] sectionTags = resources.getStringArray(R.array.home_section_tags);\n+\n+        sectionTagToName = new HashMap<>(sectionTags.length);\n+\n+        for (int i = 0; i < sectionLabels.length; i++) {\n+            String label = sectionLabels[i];\n+            String tag = sectionTags[i];\n+\n+            sectionTagToName.put(tag, label);\n+        }\n+    }\n+\n+    public static List<String> getHiddenSectionTags(Context context) {\n+        return getListPreference(context, PREF_HIDDEN_SECTIONS);\n+    }\n+\n+    public static List<String> getSortedSectionTags(Context context) {\n+        List<String> sectionTagOrder = getListPreference(context, PREF_SECTION_ORDER);\n+        List<String> hiddenSectionTags = getHiddenSectionTags(context);\n+        String[] sectionTags = context.getResources().getStringArray(R.array.home_section_tags);\n+        Arrays.sort(sectionTags, (String a, String b) -> Integer.signum(\n+                indexOfOrMaxValue(sectionTagOrder, a) - indexOfOrMaxValue(sectionTagOrder, b)));\n+\n+        List<String> finalSectionTags = new ArrayList<>();\n+        for (String sectionTag: sectionTags) {\n+            if (hiddenSectionTags.contains(sectionTag)) {\n+                continue;\n+            }\n+\n+            finalSectionTags.add(sectionTag);\n+        }\n+\n+        return finalSectionTags;\n+    }\n+\n+    private static List<String> getListPreference(Context context, String preferenceKey) {\n+        SharedPreferences prefs = context.getSharedPreferences(HomeFragment.PREF_NAME, Context.MODE_PRIVATE);\n+        String hiddenSectionsString = prefs.getString(preferenceKey, \"\");\n+        return new ArrayList<>(Arrays.asList(TextUtils.split(hiddenSectionsString, \",\")));\n+    }\n+\n+    private static int indexOfOrMaxValue(List<String> haystack, String needle) {\n+        int index = haystack.indexOf(needle);\n+        return index == -1 ? Integer.MAX_VALUE : index;\n+    }\n+\n+    public static void saveChanges(Context context, List<String> hiddenSections, List<String> sectionOrder) {\n+        SharedPreferences prefs = context.getSharedPreferences(HomeFragment.PREF_NAME, Context.MODE_PRIVATE);\n+        SharedPreferences.Editor edit = prefs.edit();\n+        edit.putString(PREF_HIDDEN_SECTIONS, TextUtils.join(\",\", hiddenSections));\n+        edit.putString(PREF_SECTION_ORDER, TextUtils.join(\",\", sectionOrder));\n+        edit.apply();\n+    }\n+}\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/settingsdialog/HomeScreenSettingDialogAdapter.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/settingsdialog/HomeScreenSettingDialogAdapter.java\nnew file mode 100644\nindex 0000000000..95ead011ad\n--- /dev/null\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/settingsdialog/HomeScreenSettingDialogAdapter.java\n@@ -0,0 +1,148 @@\n+package de.danoeh.antennapod.ui.screen.home.settingsdialog;\n+\n+import android.view.LayoutInflater;\n+import android.view.MotionEvent;\n+import android.view.View;\n+import android.view.ViewGroup;\n+import android.widget.ImageView;\n+import android.widget.TextView;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import androidx.core.util.Consumer;\n+import androidx.recyclerview.widget.RecyclerView;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import de.danoeh.antennapod.databinding.ChooseHomeScreenOrderDialogEntryBinding;\n+import de.danoeh.antennapod.databinding.ChooseHomeScreenOrderDialogHeaderBinding;\n+\n+class HomeScreenSettingDialogAdapter extends RecyclerView.Adapter<RecyclerView.ViewHolder>  {\n+    private static final int HEADER_VIEW = 0;\n+    private static final int ITEM_VIEW = 1;\n+    private final List<HomeScreenSettingsDialogItem> settingsDialogItems;\n+    @Nullable private Consumer<ItemViewHolder> dragListener;\n+\n+    public HomeScreenSettingDialogAdapter(@NonNull List<HomeScreenSettingsDialogItem> dialogItems) {\n+        settingsDialogItems = dialogItems;\n+    }\n+\n+    public void setDragListener(@Nullable Consumer<ItemViewHolder> dragListener) {\n+        this.dragListener = dragListener;\n+    }\n+\n+    @NonNull\n+    public List<String> getOrderedSectionTags() {\n+        List<String> orderedSectionTags = new ArrayList<>();\n+        for (HomeScreenSettingsDialogItem item: settingsDialogItems) {\n+            if (item.getViewType() == HomeScreenSettingsDialogItem.ViewType.Header) {\n+                continue;\n+            }\n+\n+            orderedSectionTags.add(item.getTitle());\n+        }\n+\n+        return orderedSectionTags;\n+    }\n+\n+    public List<String> getHiddenSectionTags() {\n+        List<String> hiddenSections = new ArrayList<>();\n+        for (int i = settingsDialogItems.size() - 1; i >= 0; i--) {\n+            HomeScreenSettingsDialogItem item = settingsDialogItems.get(i);\n+            if (item.getViewType() == HomeScreenSettingsDialogItem.ViewType.Header) {\n+                return hiddenSections;\n+            }\n+\n+            hiddenSections.add(item.getTitle());\n+        }\n+\n+        Collections.reverse(hiddenSections);\n+        return hiddenSections;\n+    }\n+\n+    @NonNull\n+    @Override\n+    public RecyclerView.ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {\n+        LayoutInflater inflater = LayoutInflater.from(parent.getContext());\n+        if (viewType == HEADER_VIEW) {\n+            ChooseHomeScreenOrderDialogHeaderBinding binding = ChooseHomeScreenOrderDialogHeaderBinding.inflate(\n+                    inflater, parent, false);\n+            return new HeaderViewHolder(binding.getRoot(), binding.headerLabel);\n+        }\n+\n+        ChooseHomeScreenOrderDialogEntryBinding binding = ChooseHomeScreenOrderDialogEntryBinding.inflate(\n+                inflater, parent, false);\n+        return new ItemViewHolder(binding.getRoot(), binding.sectionLabel, binding.dragHandle);\n+    }\n+\n+    @Override\n+    public int getItemViewType(int position) {\n+        HomeScreenSettingsDialogItem.ViewType viewType = settingsDialogItems.get(position).getViewType();\n+        boolean isHeader = viewType == HomeScreenSettingsDialogItem.ViewType.Header;\n+        return isHeader ? HEADER_VIEW : ITEM_VIEW;\n+    }\n+\n+    @Override\n+    public void onBindViewHolder(@NonNull RecyclerView.ViewHolder holder, int position) {\n+        String title = settingsDialogItems.get(position).getTitle();\n+        if (holder instanceof HeaderViewHolder) {\n+            HeaderViewHolder headerViewHolder = (HeaderViewHolder) holder;\n+            headerViewHolder.categoryLabel.setText(title);\n+        } else if (holder instanceof ItemViewHolder) {\n+            ItemViewHolder itemViewHolder = (ItemViewHolder) holder;\n+            String sectionName = HomePreferences.getNameFromTag(itemViewHolder.nameLabel.getContext(), title);\n+            itemViewHolder.nameLabel.setText(sectionName);\n+            itemViewHolder.dragImage.setOnTouchListener((view, motionEvent) -> {\n+                if (motionEvent.getAction() == MotionEvent.ACTION_DOWN) {\n+                    if (dragListener != null) {\n+                        dragListener.accept(itemViewHolder);\n+                    }\n+                }\n+                return true;\n+            });\n+        }\n+    }\n+\n+    @Override\n+    public int getItemCount() {\n+        return settingsDialogItems.size();\n+    }\n+\n+    public boolean onItemMove(int fromPosition, int toPosition) {\n+        if (fromPosition < toPosition) {\n+            for (int i = fromPosition; i < toPosition; i++) {\n+                Collections.swap(settingsDialogItems, i, i + 1);\n+            }\n+        } else {\n+            for (int i = fromPosition; i > toPosition; i--) {\n+                Collections.swap(settingsDialogItems, i, i - 1);\n+            }\n+        }\n+\n+        notifyItemMoved(fromPosition, toPosition);\n+        return true;\n+    }\n+\n+    static class ItemViewHolder extends RecyclerView.ViewHolder {\n+        private final TextView nameLabel;\n+        private final ImageView dragImage;\n+\n+        ItemViewHolder(@NonNull View itemView, TextView nameLabel, ImageView dragImage) {\n+            super(itemView);\n+            this.nameLabel = nameLabel;\n+            this.dragImage = dragImage;\n+        }\n+    }\n+\n+    static class HeaderViewHolder extends RecyclerView.ViewHolder {\n+\n+        private final TextView categoryLabel;\n+\n+        HeaderViewHolder(@NonNull View itemView, @NonNull TextView categoryLabel) {\n+            super(itemView);\n+            this.categoryLabel = categoryLabel;\n+        }\n+    }\n+}\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/settingsdialog/HomeScreenSettingsDialogItem.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/settingsdialog/HomeScreenSettingsDialogItem.java\nnew file mode 100644\nindex 0000000000..8e59976254\n--- /dev/null\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/settingsdialog/HomeScreenSettingsDialogItem.java\n@@ -0,0 +1,24 @@\n+package de.danoeh.antennapod.ui.screen.home.settingsdialog;\n+\n+final class HomeScreenSettingsDialogItem {\n+    enum ViewType {\n+        Section,\n+        Header\n+    }\n+\n+    private final ViewType viewType;\n+    private final String title;\n+\n+    HomeScreenSettingsDialogItem(ViewType viewType, String title) {\n+        this.viewType = viewType;\n+        this.title = title;\n+    }\n+\n+    public ViewType getViewType() {\n+        return viewType;\n+    }\n+\n+    public String getTitle() {\n+        return title;\n+    }\n+}\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/settingsdialog/HomeSectionsSettingsDialog.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/settingsdialog/HomeSectionsSettingsDialog.java\nnew file mode 100644\nindex 0000000000..7d2c716422\n--- /dev/null\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/settingsdialog/HomeSectionsSettingsDialog.java\n@@ -0,0 +1,82 @@\n+package de.danoeh.antennapod.ui.screen.home.settingsdialog;\n+\n+import android.content.Context;\n+import android.view.LayoutInflater;\n+\n+import androidx.annotation.NonNull;\n+import androidx.recyclerview.widget.ItemTouchHelper;\n+import androidx.recyclerview.widget.LinearLayoutManager;\n+import androidx.recyclerview.widget.RecyclerView;\n+\n+import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n+import de.danoeh.antennapod.R;\n+import de.danoeh.antennapod.databinding.ChooseHomeScreenOrderDialogBinding;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+\n+public class HomeSectionsSettingsDialog {\n+    public static void open(Context context, Runnable onSettingsChanged) {\n+        LayoutInflater layoutInflater = LayoutInflater.from(context);\n+        ChooseHomeScreenOrderDialogBinding viewBinding = ChooseHomeScreenOrderDialogBinding.inflate(layoutInflater);\n+\n+        MaterialAlertDialogBuilder builder = new MaterialAlertDialogBuilder(context);\n+        builder.setTitle(R.string.configure_home);\n+        builder.setView(viewBinding.getRoot());\n+        RecyclerView recyclerView = viewBinding.recyclerView;\n+        List<HomeScreenSettingsDialogItem> dialogItems = initialItemsSettingsDialog(context);\n+        HomeScreenSettingDialogAdapter adapter = new HomeScreenSettingDialogAdapter(dialogItems);\n+\n+        configureRecyclerView(recyclerView, adapter, context);\n+\n+        builder.setPositiveButton(R.string.confirm_label, (dialog, which) -> {\n+            final List<String> sectionOrder = adapter.getOrderedSectionTags();\n+            final List<String> hiddenSections = adapter.getHiddenSectionTags();\n+            HomePreferences.saveChanges(context, hiddenSections, sectionOrder);\n+            onSettingsChanged.run();\n+        });\n+        builder.setNegativeButton(R.string.cancel_label, null);\n+        builder.setNeutralButton(R.string.reset, (dialog, which) -> {\n+            HomePreferences.saveChanges(context, Collections.emptyList(), Collections.emptyList());\n+            onSettingsChanged.run();\n+        });\n+        builder.show();\n+    }\n+\n+    private static void configureRecyclerView(RecyclerView recyclerView,\n+                                              HomeScreenSettingDialogAdapter adapter, Context context) {\n+        ItemTouchCallback itemMoveCallback = new ItemTouchCallback() {\n+            @Override\n+            protected boolean onItemMove(int fromPosition, int toPosition) {\n+                return adapter.onItemMove(fromPosition, toPosition);\n+            }\n+        };\n+        ItemTouchHelper itemTouchHelper = new ItemTouchHelper(itemMoveCallback);\n+        itemTouchHelper.attachToRecyclerView(recyclerView);\n+        adapter.setDragListener(itemTouchHelper::startDrag);\n+        recyclerView.setLayoutManager(new LinearLayoutManager(context));\n+        recyclerView.setAdapter(adapter);\n+    }\n+\n+    @NonNull\n+    private static List<HomeScreenSettingsDialogItem> initialItemsSettingsDialog(@NonNull Context context) {\n+        final List<String> sectionTags = HomePreferences.getSortedSectionTags(context);\n+        final List<String> hiddenSectionTags = HomePreferences.getHiddenSectionTags(context);\n+\n+        ArrayList<HomeScreenSettingsDialogItem> settingsDialogItems = new ArrayList<>();\n+        for (String sectionTag: sectionTags) {\n+            settingsDialogItems.add(new HomeScreenSettingsDialogItem(\n+                    HomeScreenSettingsDialogItem.ViewType.Section, sectionTag));\n+        }\n+        String hiddenText = context.getString(R.string.section_hidden);\n+        settingsDialogItems.add(new HomeScreenSettingsDialogItem(\n+                HomeScreenSettingsDialogItem.ViewType.Header, hiddenText));\n+        for (String sectionTag: hiddenSectionTags) {\n+            settingsDialogItems.add(new HomeScreenSettingsDialogItem(\n+                    HomeScreenSettingsDialogItem.ViewType.Section, sectionTag));\n+        }\n+\n+        return settingsDialogItems;\n+    }\n+}\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/home/settingsdialog/ItemTouchCallback.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/settingsdialog/ItemTouchCallback.java\nnew file mode 100644\nindex 0000000000..9ccefda6f5\n--- /dev/null\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/home/settingsdialog/ItemTouchCallback.java\n@@ -0,0 +1,32 @@\n+package de.danoeh.antennapod.ui.screen.home.settingsdialog;\n+\n+import androidx.annotation.NonNull;\n+import androidx.recyclerview.widget.ItemTouchHelper;\n+import androidx.recyclerview.widget.RecyclerView;\n+\n+public abstract class ItemTouchCallback extends ItemTouchHelper.Callback {\n+    @Override\n+    public int getMovementFlags(@NonNull RecyclerView recyclerView, @NonNull RecyclerView.ViewHolder viewHolder) {\n+        final int dragFlags = ItemTouchHelper.UP | ItemTouchHelper.DOWN;\n+        final int swipeFlags = 0;\n+        return makeMovementFlags(dragFlags, swipeFlags);\n+    }\n+\n+    @Override\n+    public boolean onMove(@NonNull RecyclerView recyclerView,\n+            @NonNull RecyclerView.ViewHolder viewHolder, @NonNull RecyclerView.ViewHolder target) {\n+        return onItemMove(viewHolder.getBindingAdapterPosition(), target.getBindingAdapterPosition());\n+    }\n+\n+    protected abstract boolean onItemMove(int fromPosition, int toPosition);\n+\n+    @Override\n+    public boolean isItemViewSwipeEnabled() {\n+        return false;\n+    }\n+\n+    @Override\n+    public void onSwiped(@NonNull RecyclerView.ViewHolder viewHolder, int direction) {\n+\n+    }\n+}\ndiff --git a/app/src/main/res/layout/choose_home_screen_order_dialog.xml b/app/src/main/res/layout/choose_home_screen_order_dialog.xml\nnew file mode 100644\nindex 0000000000..cd76833a2e\n--- /dev/null\n+++ b/app/src/main/res/layout/choose_home_screen_order_dialog.xml\n@@ -0,0 +1,7 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<androidx.recyclerview.widget.RecyclerView\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    android:id=\"@+id/recyclerView\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"wrap_content\"\n+    android:paddingTop=\"16sp\" />\ndiff --git a/app/src/main/res/layout/choose_home_screen_order_dialog_entry.xml b/app/src/main/res/layout/choose_home_screen_order_dialog_entry.xml\nnew file mode 100644\nindex 0000000000..118e7aadb3\n--- /dev/null\n+++ b/app/src/main/res/layout/choose_home_screen_order_dialog_entry.xml\n@@ -0,0 +1,29 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<LinearLayout\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"wrap_content\"\n+    android:gravity=\"center_vertical\"\n+    android:orientation=\"horizontal\">\n+\n+    <ImageView\n+        android:id=\"@+id/dragHandle\"\n+        android:layout_width=\"48dp\"\n+        android:layout_height=\"48dp\"\n+        android:paddingStart=\"16dp\"\n+        android:paddingEnd=\"0dp\"\n+        android:paddingVertical=\"8dp\"\n+        android:layout_gravity=\"center_vertical\"\n+        android:contentDescription=\"@string/sort\"\n+        android:src=\"?attr/dragview_background\" />\n+\n+    <TextView\n+        android:id=\"@+id/sectionLabel\"\n+        android:layout_width=\"wrap_content\"\n+        android:layout_height=\"wrap_content\"\n+        android:layout_margin=\"8dp\"\n+        android:layout_gravity=\"center_vertical\"\n+        android:textColor=\"?android:attr/textColorPrimary\"\n+        android:textSize=\"18sp\" />\n+\n+</LinearLayout>\ndiff --git a/app/src/main/res/layout/choose_home_screen_order_dialog_header.xml b/app/src/main/res/layout/choose_home_screen_order_dialog_header.xml\nnew file mode 100644\nindex 0000000000..410ec664d8\n--- /dev/null\n+++ b/app/src/main/res/layout/choose_home_screen_order_dialog_header.xml\n@@ -0,0 +1,19 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<LinearLayout\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"wrap_content\"\n+    android:gravity=\"center_vertical\"\n+    android:orientation=\"horizontal\"\n+    android:paddingHorizontal=\"16dp\"\n+    android:paddingVertical=\"16dp\">\n+\n+    <TextView\n+        android:id=\"@+id/headerLabel\"\n+        android:layout_width=\"wrap_content\"\n+        android:layout_height=\"wrap_content\"\n+        android:layout_margin=\"8dp\"\n+        android:textColor=\"?android:attr/textColorPrimary\"\n+        android:textSize=\"18sp\" />\n+\n+</LinearLayout>\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 8b7f8b9ea5..d8825fa553 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -69,6 +69,7 @@\n     <string name=\"deny_label\">Deny</string>\n     <string name=\"open_settings\">Open settings</string>\n     <string name=\"configure_home\">Configure Home Screen</string>\n+    <string name=\"section_hidden\">Hidden</string>\n \n     <!-- Download Statistics fragment -->\n     <string name=\"total_size_downloaded_podcasts\">Total size of episodes on the device</string>\n", "test_patch": "", "problem_statement": "Make it possible to re-order sections on the home screen\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n2.7.0\n\n### Where did you get the app from\n\nOther\n\n### Problem you may be having, or feature you want\n\nCurrently, the sections on the home screen have a specific order. Some users might prefer a different order.\n\n### Suggested solution\n\nAdd a screen that has two sections: \"Enabled\" and \"Disabled\". List entries can be dragged between both sections, as well as within each section. This changes the order of the entries and allows to enable/disable them.\n\n### Screenshots / Drawings / Technical details\n\n- This should probably be done using a single RecyclerView that has different view types. The section headers would be different types (and are not draggable), while the entries can be dragged. This could help: https://stackoverflow.com/questions/54096462/how-do-i-create-a-semi-draggable-recyclerview-on-android\r\n- The implementation should be generic - we want to re-use the same view for sorting side bar entries. Also, it should be extendible to 3 sections without needing to re-write everything. It doesn't have to support 3 sections from the start, but the sections should be kept in mind.\n", "hints_text": "Design specifications & a mock-up (partly covered in the last bullet point above) can be found here: https://github.com/AntennaPod/AntennaPod/issues/4376#issuecomment-1215145107\nI can try this if no one has yet! (using it as a first issue assignment for class)\nAwesome :) Feel free to post a PR if you are ready to get early feedback. Note, however, that this is not an easy task. It has the `Good first issue` label because it does not require knowledge about the AntennaPod code and is relatively self-contained, but it will probably need quite a bit of time to implement.\r\n\r\nA first entry point would be the class [`HomeSectionsSettingsDialog`](https://github.com/AntennaPod/AntennaPod/blob/develop/app/src/main/java/de/danoeh/antennapod/ui/home/HomeSectionsSettingsDialog.java).\nI already did this, but it was apparently scraped.\r\nFor the reordering I did a library that makes it really easy, without bothering with recyclerview directly, have a look https://github.com/ueen/SortView\nYeah, I removed quite a bit from the Home PR. Getting the bare minimum home screen to fully work was a huge task on its own. All the configurability on top would have made it even harder to merge.\r\n\r\nI forgot about your library, to be honest. Does it support fixed \"dividers\" that cannot be dragged? Keunes made a mock-up for bottom navigation somewhere, which needs 3 \"sections\" that items can be dragged into. I think we should use the same method there.\r\n\r\nI see your library introduces some additional dependencies. How much larger does it make the app?\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/home-feature-expanable-episodes-list-and-inbox/3891/5\n", "created_at": "2024-03-30T22:16:17Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7016, "instance_id": "AntennaPod__AntennaPod-7016", "issue_numbers": ["6871"], "base_commit": "69f0daa2e88b5ead63a95c8b6cb2e33696cd1c24", "patch": "diff --git a/ui/glide/src/main/java/de/danoeh/antennapod/ui/glide/ApGlideModule.java b/ui/glide/src/main/java/de/danoeh/antennapod/ui/glide/ApGlideModule.java\nindex 132ed49010..69294ff416 100644\n--- a/ui/glide/src/main/java/de/danoeh/antennapod/ui/glide/ApGlideModule.java\n+++ b/ui/glide/src/main/java/de/danoeh/antennapod/ui/glide/ApGlideModule.java\n@@ -49,6 +49,6 @@ public void registerComponents(@NonNull Context context, @NonNull Glide glide, @\n         registry.append(String.class, InputStream.class, new ApOkHttpUrlLoader.Factory());\n         registry.append(String.class, InputStream.class, new NoHttpStringLoader.StreamFactory());\n \n-        registry.append(EmbeddedChapterImage.class, ByteBuffer.class, new ChapterImageModelLoader.Factory());\n+        registry.append(EmbeddedChapterImage.class, ByteBuffer.class, new ChapterImageModelLoader.Factory(context));\n     }\n }\ndiff --git a/ui/glide/src/main/java/de/danoeh/antennapod/ui/glide/ChapterImageModelLoader.java b/ui/glide/src/main/java/de/danoeh/antennapod/ui/glide/ChapterImageModelLoader.java\nindex 3f6aa7c488..84e1d07a64 100644\n--- a/ui/glide/src/main/java/de/danoeh/antennapod/ui/glide/ChapterImageModelLoader.java\n+++ b/ui/glide/src/main/java/de/danoeh/antennapod/ui/glide/ChapterImageModelLoader.java\n@@ -1,5 +1,8 @@\n package de.danoeh.antennapod.ui.glide;\n \n+import android.content.ContentResolver;\n+import android.content.Context;\n+import android.net.Uri;\n import androidx.annotation.NonNull;\n import com.bumptech.glide.Priority;\n import com.bumptech.glide.load.DataSource;\n@@ -22,12 +25,17 @@\n import org.apache.commons.io.IOUtils;\n \n public final class ChapterImageModelLoader implements ModelLoader<EmbeddedChapterImage, ByteBuffer> {\n-\n     public static class Factory implements ModelLoaderFactory<EmbeddedChapterImage, ByteBuffer> {\n+        private final Context context;\n+\n+        public Factory(Context context) {\n+            this.context = context;\n+        }\n+\n         @NonNull\n         @Override\n         public ModelLoader<EmbeddedChapterImage, ByteBuffer> build(@NonNull MultiModelLoaderFactory unused) {\n-            return new ChapterImageModelLoader();\n+            return new ChapterImageModelLoader(context);\n         }\n \n         @Override\n@@ -36,12 +44,16 @@ public void teardown() {\n         }\n     }\n \n+    private final Context context;\n+\n+    public ChapterImageModelLoader(Context context) {\n+        this.context = context;\n+    }\n+\n     @Override\n-    public LoadData<ByteBuffer> buildLoadData(@NonNull EmbeddedChapterImage model,\n-                                              int width,\n-                                              int height,\n-                                              @NonNull Options options) {\n-        return new LoadData<>(new ObjectKey(model), new EmbeddedImageFetcher(model));\n+    public LoadData<ByteBuffer> buildLoadData(@NonNull EmbeddedChapterImage model, int width,\n+                                              int height, @NonNull Options options) {\n+        return new LoadData<>(new ObjectKey(model), new EmbeddedImageFetcher(model, context));\n     }\n \n     @Override\n@@ -51,9 +63,11 @@ public boolean handles(@NonNull EmbeddedChapterImage model) {\n \n     static class EmbeddedImageFetcher implements DataFetcher<ByteBuffer> {\n         private final EmbeddedChapterImage image;\n+        private final Context context;\n \n-        public EmbeddedImageFetcher(EmbeddedChapterImage image) {\n+        public EmbeddedImageFetcher(EmbeddedChapterImage image, Context context) {\n             this.image = image;\n+            this.context = context;\n         }\n \n         @Override\n@@ -61,9 +75,15 @@ public void loadData(@NonNull Priority priority, @NonNull DataCallback<? super B\n \n             BufferedInputStream stream = null;\n             try {\n-                if (image.getMedia().localFileAvailable()) {\n-                    File localFile = new File(image.getMedia().getLocalMediaUrl());\n-                    stream = new BufferedInputStream(new FileInputStream(localFile));\n+                boolean isLocalFeed = image.getMedia().getStreamUrl().startsWith(ContentResolver.SCHEME_CONTENT);\n+                if (isLocalFeed || image.getMedia().localFileAvailable()) {\n+                    if (isLocalFeed) {\n+                        Uri uri = Uri.parse(image.getMedia().getStreamUrl());\n+                        stream = new BufferedInputStream(context.getContentResolver().openInputStream(uri));\n+                    } else {\n+                        File localFile = new File(image.getMedia().getLocalMediaUrl());\n+                        stream = new BufferedInputStream(new FileInputStream(localFile));\n+                    }\n                     IOUtils.skip(stream, image.getPosition());\n                     byte[] imageContent = new byte[image.getLength()];\n                     IOUtils.read(stream, imageContent, 0, image.getLength());\n", "test_patch": "", "problem_statement": "Chapter images are not shown when playing local files\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.2.0\n\n### Where did you get the app from\n\nOther\n\n### Android version\n\nCurrent\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\nIf playing files from a local folder (Add Podcast > Add local folder), chapter images included in the mp3 file via ID3 tags are not shown.\r\n\r\nIf playing the same file downloaded from a podcast on the web, the chapter images are shown.\r\n\r\nTo reproduce, one can use\r\nhttps://mp3chapters.github.io/example.mp3\r\nhttps://mp3chapters.github.io/example.xml (podcast feed pointing to that mp3 file)\r\n\r\n<img width=\"344\" alt=\"image\" src=\"https://github.com/AntennaPod/AntennaPod/assets/3543224/5529921d-88e4-428e-b519-424aeba6176c\">\r\n<img width=\"339\" alt=\"image\" src=\"https://github.com/AntennaPod/AntennaPod/assets/3543224/78ed54ac-f0e3-42c7-891c-e754b6d15ff1\">\r\n\r\n(A user of my mp3 chapter tag editor [reported this issue](https://github.com/mp3chapters/mp3chapters.github.io/issues/8) to me.)\n\n### Expected behaviour\n\n_No response_\n\n### Current behaviour\n\n_No response_\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2024-03-22T19:36:40Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7013, "instance_id": "AntennaPod__AntennaPod-7013", "issue_numbers": ["6916"], "base_commit": "0a6b7ed69957cea9582af9e0dd861ed13795d6b5", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/dialog/VariableSpeedDialog.java b/app/src/main/java/de/danoeh/antennapod/dialog/VariableSpeedDialog.java\nindex c62f5df7ee..c32f2f3093 100644\n--- a/app/src/main/java/de/danoeh/antennapod/dialog/VariableSpeedDialog.java\n+++ b/app/src/main/java/de/danoeh/antennapod/dialog/VariableSpeedDialog.java\n@@ -86,6 +86,7 @@ public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup c\n         View root = View.inflate(getContext(), R.layout.speed_select_dialog, null);\n         speedSeekBar = root.findViewById(R.id.speed_seek_bar);\n         speedSeekBar.setProgressChangedListener(multiplier -> {\n+            UserPreferences.setPlaybackSpeed(multiplier);\n             if (controller != null) {\n                 controller.setPlaybackSpeed(multiplier);\n             }\n@@ -148,10 +149,11 @@ public void onBindViewHolder(@NonNull ViewHolder holder, int position) {\n                 return true;\n             });\n             holder.chip.setOnClickListener(v -> {\n+                UserPreferences.setPlaybackSpeed(speed);\n                 new Handler(Looper.getMainLooper()).postDelayed(() -> {\n                     if (controller != null) {\n-                        dismiss();\n                         controller.setPlaybackSpeed(speed);\n+                        dismiss();\n                     }\n                 }, 200);\n             });\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/feed/util/PlaybackSpeedUtils.java b/core/src/main/java/de/danoeh/antennapod/core/feed/util/PlaybackSpeedUtils.java\nindex cd98507bac..d532d9ba63 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/feed/util/PlaybackSpeedUtils.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/feed/util/PlaybackSpeedUtils.java\n@@ -1,54 +1,36 @@\n package de.danoeh.antennapod.core.feed.util;\n \n-import android.util.Log;\n import de.danoeh.antennapod.model.feed.Feed;\n-import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedMedia;\n import de.danoeh.antennapod.model.feed.FeedPreferences;\n-import de.danoeh.antennapod.model.playback.MediaType;\n import de.danoeh.antennapod.core.preferences.PlaybackPreferences;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import de.danoeh.antennapod.model.playback.Playable;\n \n-import static de.danoeh.antennapod.model.feed.FeedPreferences.SPEED_USE_GLOBAL;\n-\n /**\n  * Utility class to use the appropriate playback speed based on {@link PlaybackPreferences}\n  */\n-public final class PlaybackSpeedUtils {\n-    private static final String TAG = \"PlaybackSpeedUtils\";\n-\n-    private PlaybackSpeedUtils() {\n-    }\n-\n+public abstract class PlaybackSpeedUtils {\n     /**\n      * Returns the currently configured playback speed for the specified media.\n      */\n     public static float getCurrentPlaybackSpeed(Playable media) {\n-        float playbackSpeed = SPEED_USE_GLOBAL;\n-        MediaType mediaType = null;\n-\n-        if (media != null) {\n-            mediaType = media.getMediaType();\n-            playbackSpeed = PlaybackPreferences.getCurrentlyPlayingTemporaryPlaybackSpeed();\n-\n-            if (playbackSpeed == SPEED_USE_GLOBAL && media instanceof FeedMedia) {\n-                FeedItem item = ((FeedMedia) media).getItem();\n-                if (item != null) {\n-                    Feed feed = item.getFeed();\n-                    if (feed != null && feed.getPreferences() != null) {\n-                        playbackSpeed = feed.getPreferences().getFeedPlaybackSpeed();\n-                    } else {\n-                        Log.d(TAG, \"Can not get feed specific playback speed: \" + feed);\n-                    }\n+        float playbackSpeed = FeedPreferences.SPEED_USE_GLOBAL;\n+        if (media instanceof FeedMedia) {\n+            FeedMedia feedMedia = (FeedMedia) media;\n+            if (PlaybackPreferences.getCurrentlyPlayingFeedMediaId() == feedMedia.getId()) {\n+                playbackSpeed = PlaybackPreferences.getCurrentlyPlayingTemporaryPlaybackSpeed();\n+            }\n+            if (playbackSpeed == FeedPreferences.SPEED_USE_GLOBAL && feedMedia.getItem() != null) {\n+                Feed feed = feedMedia.getItem().getFeed();\n+                if (feed != null && feed.getPreferences() != null) {\n+                    playbackSpeed = feed.getPreferences().getFeedPlaybackSpeed();\n                 }\n             }\n         }\n-\n-        if (playbackSpeed == SPEED_USE_GLOBAL) {\n-            playbackSpeed = UserPreferences.getPlaybackSpeed(mediaType);\n+        if (playbackSpeed == FeedPreferences.SPEED_USE_GLOBAL) {\n+            playbackSpeed = UserPreferences.getPlaybackSpeed();\n         }\n-\n         return playbackSpeed;\n     }\n \n@@ -57,12 +39,15 @@ public static float getCurrentPlaybackSpeed(Playable media) {\n      */\n     public static FeedPreferences.SkipSilence getCurrentSkipSilencePreference(Playable media) {\n         FeedPreferences.SkipSilence skipSilence = FeedPreferences.SkipSilence.GLOBAL;\n-        if (media != null) {\n-            skipSilence = PlaybackPreferences.getCurrentlyPlayingTemporarySkipSilence();\n-            if (skipSilence == FeedPreferences.SkipSilence.GLOBAL && media instanceof FeedMedia) {\n-                FeedItem item = ((FeedMedia) media).getItem();\n-                if (item != null && item.getFeed() != null && item.getFeed().getPreferences() != null) {\n-                    skipSilence = item.getFeed().getPreferences().getFeedSkipSilence();\n+        if (media instanceof FeedMedia) {\n+            FeedMedia feedMedia = (FeedMedia) media;\n+            if (PlaybackPreferences.getCurrentlyPlayingFeedMediaId() == feedMedia.getId()) {\n+                skipSilence = PlaybackPreferences.getCurrentlyPlayingTemporarySkipSilence();\n+            }\n+            if (skipSilence == FeedPreferences.SkipSilence.GLOBAL && feedMedia.getItem() != null) {\n+                Feed feed = feedMedia.getItem().getFeed();\n+                if (feed != null && feed.getPreferences() != null) {\n+                    skipSilence = feed.getPreferences().getFeedSkipSilence();\n                 }\n             }\n         }\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\nindex abeb9f942b..41a8a20eec 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n@@ -1616,18 +1616,17 @@ public void volumeAdaptionChanged(VolumeAdaptionChangedEvent event) {\n     @SuppressWarnings(\"unused\")\n     public void speedPresetChanged(SpeedPresetChangedEvent event) {\n         if (getPlayable() instanceof FeedMedia) {\n-            if (((FeedMedia) getPlayable()).getItem().getFeed().getId() == event.getFeedId()) {\n+            FeedMedia playable = (FeedMedia) getPlayable();\n+            if (playable.getItem().getFeed().getId() == event.getFeedId()) {\n                 if (event.getSpeed() == SPEED_USE_GLOBAL) {\n-                    setSpeed(UserPreferences.getPlaybackSpeed(getPlayable().getMediaType()));\n-                    setSkipSilence(UserPreferences.isSkipSilence());\n+                    setSpeed(UserPreferences.getPlaybackSpeed());\n                 } else {\n                     setSpeed(event.getSpeed());\n-                    FeedPreferences.SkipSilence skipSilence = event.getSkipSilence();\n-                    if (skipSilence == FeedPreferences.SkipSilence.GLOBAL) {\n-                        setSkipSilence(UserPreferences.isSkipSilence());\n-                    } else {\n-                        setSkipSilence(skipSilence == FeedPreferences.SkipSilence.AGGRESSIVE);\n-                    }\n+                }\n+                if (event.getSkipSilence() == FeedPreferences.SkipSilence.GLOBAL) {\n+                    setSkipSilence(UserPreferences.isSkipSilence());\n+                } else {\n+                    setSkipSilence(event.getSkipSilence() == FeedPreferences.SkipSilence.AGGRESSIVE);\n                 }\n             }\n         }\n@@ -1637,10 +1636,10 @@ public void speedPresetChanged(SpeedPresetChangedEvent event) {\n     @SuppressWarnings(\"unused\")\n     public void skipIntroEndingPresetChanged(SkipIntroEndingChangedEvent event) {\n         if (getPlayable() instanceof FeedMedia) {\n-            if (((FeedMedia) getPlayable()).getItem().getFeed().getId() == event.getFeedId()) {\n+            FeedMedia playable = (FeedMedia) getPlayable();\n+            if (playable.getItem().getFeed().getId() == event.getFeedId()) {\n                 if (event.getSkipEnding() != 0) {\n-                    FeedPreferences feedPreferences\n-                            = ((FeedMedia) getPlayable()).getItem().getFeed().getPreferences();\n+                    FeedPreferences feedPreferences = playable.getItem().getFeed().getPreferences();\n                     feedPreferences.setFeedSkipIntro(event.getSkipIntro());\n                     feedPreferences.setFeedSkipEnding(event.getSkipEnding());\n                 }\n@@ -1684,18 +1683,11 @@ public Playable getPlayable() {\n \n     public void setSpeed(float speed) {\n         PlaybackPreferences.setCurrentlyPlayingTemporaryPlaybackSpeed(speed);\n-        if (currentMediaType == MediaType.VIDEO) {\n-            UserPreferences.setVideoPlaybackSpeed(speed);\n-        } else {\n-            UserPreferences.setPlaybackSpeed(speed);\n-        }\n-\n         mediaPlayer.setPlaybackParams(speed, getCurrentSkipSilence());\n     }\n \n     public void setSkipSilence(boolean skipSilence) {\n         PlaybackPreferences.setCurrentlyPlayingTemporarySkipSilence(skipSilence);\n-        UserPreferences.setSkipSilence(skipSilence);\n         mediaPlayer.setPlaybackParams(getCurrentPlaybackSpeed(), skipSilence);\n     }\n \ndiff --git a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\nindex f2baf1242b..42bdd5cf02 100644\n--- a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n+++ b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n@@ -33,7 +33,6 @@\n import de.danoeh.antennapod.model.feed.FeedPreferences;\n import de.danoeh.antennapod.model.feed.SortOrder;\n import de.danoeh.antennapod.model.feed.SubscriptionsFilter;\n-import de.danoeh.antennapod.model.playback.MediaType;\n \n /**\n  * Provides access to preferences set by the user in the settings screen. A\n@@ -118,7 +117,6 @@ private UserPreferences(){}\n \n     // Mediaplayer\n     private static final String PREF_PLAYBACK_SPEED = \"prefPlaybackSpeed\";\n-    private static final String PREF_VIDEO_PLAYBACK_SPEED = \"prefVideoPlaybackSpeed\";\n     public static final String PREF_PLAYBACK_SKIP_SILENCE = \"prefSkipSilence\";\n     private static final String PREF_FAST_FORWARD_SECS = \"prefFastForwardSecs\";\n     private static final String PREF_REWIND_SECS = \"prefRewindSecs\";\n@@ -131,8 +129,6 @@ private UserPreferences(){}\n     public static final int EPISODE_CLEANUP_DEFAULT = 0;\n \n     // Constants\n-    public static final int NOTIFICATION_BUTTON_REWIND = 0;\n-    public static final int NOTIFICATION_BUTTON_FAST_FORWARD = 1;\n     public static final int NOTIFICATION_BUTTON_SKIP = 2;\n     public static final int NOTIFICATION_BUTTON_NEXT_CHAPTER = 3;\n     public static final int NOTIFICATION_BUTTON_PLAYBACK_SPEED = 4;\n@@ -406,15 +402,7 @@ public static boolean shouldDeleteRemoveFromQueue() {\n         return prefs.getBoolean(PREF_DELETE_REMOVES_FROM_QUEUE, false);\n     }\n \n-    public static float getPlaybackSpeed(MediaType mediaType) {\n-        if (mediaType == MediaType.VIDEO) {\n-            return getVideoPlaybackSpeed();\n-        } else {\n-            return getAudioPlaybackSpeed();\n-        }\n-    }\n-\n-    private static float getAudioPlaybackSpeed() {\n+    public static float getPlaybackSpeed() {\n         try {\n             return Float.parseFloat(prefs.getString(PREF_PLAYBACK_SPEED, \"1.00\"));\n         } catch (NumberFormatException e) {\n@@ -424,16 +412,6 @@ private static float getAudioPlaybackSpeed() {\n         }\n     }\n \n-    private static float getVideoPlaybackSpeed() {\n-        try {\n-            return Float.parseFloat(prefs.getString(PREF_VIDEO_PLAYBACK_SPEED, \"1.00\"));\n-        } catch (NumberFormatException e) {\n-            Log.e(TAG, Log.getStackTraceString(e));\n-            UserPreferences.setVideoPlaybackSpeed(1.0f);\n-            return 1.0f;\n-        }\n-    }\n-\n     public static boolean isSkipSilence() {\n         return prefs.getBoolean(PREF_PLAYBACK_SKIP_SILENCE, false);\n     }\n@@ -612,10 +590,6 @@ public static void setPlaybackSpeed(float speed) {\n         prefs.edit().putString(PREF_PLAYBACK_SPEED, String.valueOf(speed)).apply();\n     }\n \n-    public static void setVideoPlaybackSpeed(float speed) {\n-        prefs.edit().putString(PREF_VIDEO_PLAYBACK_SPEED, String.valueOf(speed)).apply();\n-    }\n-\n     public static void setSkipSilence(boolean skipSilence) {\n         prefs.edit().putBoolean(PREF_PLAYBACK_SKIP_SILENCE, skipSilence).apply();\n     }\n", "test_patch": "", "problem_statement": "Global playback speed cannot always be set via app settings dialog, but is overwritten by feed settings dialog\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.2.0\n\n### Where did you get the app from\n\nOther\n\n### Android version\n\nAndroid 14 / CalyxOS 5.3.2\n\n### Device model\n\nPixel 4a\n\n### First occurred\n\nMonths ago\n\n### Steps to reproduce\n\n### High level description\r\n\r\nThe global playback speed cannot always be set via app settings dialog, but it is overwritten by feed settings dialog.\r\nSee also the forum post https://forum.antennapod.org/t/global-playback-speed-not-reliable/3992/2\r\n\r\n### Problem 1: The app settings dialog doesn't always update the global playback speed value\r\n\r\n**Steps to reproduce when global setting is _not_ updated:**\r\n\r\n1. Uninstall AntennaPod and install a fresh snapshot from develop branch (or version 3.2.0)\r\n2. Go to settings -> Playback -> Playback speed\r\n3. Change the speed to another value like 2.00.\r\n4. Go back.\r\n5. Open Playback speed dialog again.\r\n6. It shows 1.00, the change is ignored and the value \"prefPlaybackSpeed\" is not stored in preferences.xml.\r\n\r\n**Steps to reproduce when global setting _is_ updated:**\r\n\r\n1. Add a podcast and download any episode.\r\n2. Play the episode for a second and stop it, this runs the PlaybackService.\r\n3. Go to settings -> Playback -> Playback speed\r\n4. Change the speed to another value like 2.00.\r\n5. Go back.\r\n6. Open Playback speed dialog again.\r\n7. Now, it shows the value 2.00,  and the value \"prefPlaybackSpeed\" is set to \"2.0\" in preferences.xml.\r\n\r\nQuestion:\r\nShould the Playback speed dialog _always_ update the global setting, or is this dialog not intended to change this setting _at all_ but it should only configure the speed list in \"prefPlaybackSpeedArray\"?\r\n\r\n### Problem 2: Feed specific playback speed change also changes the global speed setting\r\n\r\n**Steps to reproduce:**\r\n1. Install AntennaPod.\r\n2. Add a podcast and download an episode.\r\n3. Play the episode for a second and stop it, this runs the PlaybackService.\r\n4. Open podcast settings -> Playback speed\r\n5. Uncheck \"Global default\".\r\n6. Change the speed to another value like 1.50.\r\n7. Click OK.\r\n8. Now, the value \"prefPlaybackSpeed\" is set to \"1.5\" in preferences.xml.\r\n\r\n### Root cause analysis\r\n\r\nI think, both problems have the same root cause. That's why I listed them both in this issue.\r\n\r\nThe method `PlaybackService.setSpeed(float speed)` updates several settings, rather than just forwarding the speed to the media player:\r\n```java\r\n    public void setSpeed(float speed) {\r\n        PlaybackPreferences.setCurrentlyPlayingTemporaryPlaybackSpeed(speed);\r\n        if (currentMediaType == MediaType.VIDEO) {\r\n            UserPreferences.setVideoPlaybackSpeed(speed);\r\n        } else {\r\n            UserPreferences.setPlaybackSpeed(speed);\r\n        }\r\n\r\n        mediaPlayer.setPlaybackParams(speed, UserPreferences.isSkipSilence());\r\n    }\r\n```\r\n\r\nI suggest to\r\n- change `PlaybackService.setSpeed(float speed)` to only forward the new speed to mediaPlayer and\r\n- change `VariableSpeedDialog.onCreateView()` to configure the global playback speed in preferences.xml via the app settings dialog.\r\n\r\nWhat do you think?\n\n### Expected behaviour\n\n_No response_\n\n### Current behaviour\n\n_No response_\n\n### Logs\n\n_No response_\n", "hints_text": "This issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/global-playback-speed-not-reliable/3992/5\n\n> Should the Playback speed dialog always update the global setting, or is this dialog not intended to change this setting at all but it should only configure the speed list in \"prefPlaybackSpeedArray\"?\r\n\r\nI think the idea is that the dialog, whether called from the Settings screen or the full Player screen, always changes the setting for current playback and adjusts the preference. (Although one could also argue that when playback is ongoing of an episode whose feed has a custom/podcast-specific playback speed, it should _not_ adjust the global standard. Regardless problem 2, which I would consider a bug indeed.)\r\n\r\n> I suggest to\r\n> change `PlaybackService.setSpeed(float speed)` to only forward the new speed to mediaPlayer and\r\n> change `VariableSpeedDialog.onCreateView()` to configure the global playback speed in preferences.xml via the app settings dialog.\r\n\r\nWhat does this imply in terms of UX? Global speed is only adjusted when the dialog is opened from the Settings?\r\n\r\nI think that adjusting the playback speed when opening the dialog from the Player screen should _also_ adjust the global playback speed - possibly with an exception for episodes with a custom playback speed as indicated above. Reasoning:\r\n* Talking speed is often consistent between podcasts and between episodes within a podcast.\r\n* If the talking speed of one podcast deviates from the average, or is in a less well understood language, it can get a podcast-specific speed setting.\r\n* The talking speed of a single episode is unlikely to deviate from the average of its podcast. So it is unlikely that one would need to adjust the playback speed just for 1 episode currently being listened. Therefore, _not_ adjusting the global default when working from the Player screen (and only affecting currently playing episode) would make little sense.\r\n  * counter-argument: Playback speed may be context-specific; you might want to make things slower while driving in the car without adjusting the global preference.\r\n    * at the same time: Not adjusting the global default would mean that your next episode would 'jump back' to the global default, which is somewhat unexpected also (I expect circumstances to last beyond the length of 1 episode).\r\n      * conclusion: I think frequently updating the global default (also from Player screen) is better than hardly ever doing this (only from Settings screen).\nTo add more details: From data model perspective, there are the following playback speed settings:\r\n\r\n1. The **global playback speed**, separated for audio and for video.\r\n2. **Per-feed playback speed**. If not set, use the global playback speed.\r\n3. **Temporary playback speed** for the currently playing media. If not set, use the per-feed playback speed.\r\n\r\nThis speed settings hierarchy makes AntennaPod very flexible. From my perspective, it's just the UI/UX that isn't intuitive at the moment (and some bugs in the implementation).\r\n\r\nI think the following UX would be quite intuitive:\r\n\r\n1. The **global playback speed** is only adjusted when the dialog is opened from the settings menu.\r\n2. **Per-feed playback speed** is configured only from the feed settings dialog, as today.\r\n3. **Temporary playback speed** is only adjusted when the dialog is opened from the player screen. No need to also modify the global speed.\nOk, thank you @damoasda. I think that makes sense (even though my impression is that in the past, global playback speed was adjusted from the player screen, meaning there was no temporary speed).\n\nJust one additional question: how long do you foresee the temporary playback speed to last?\n\nAlso, if paused, should the temporary speed be set for whatever is paused or (also) playing next? (See #6920)\nYou can basically ignore the temporary one in any discussion. From an average user's perspective (who didn't open any settings screen), there is just one playback speed, and making a difference between player screen and settings screen would be confusing, in my opinion. To users, that would feel like the speed does not \"stick\".\r\n\r\nThe only reason for the temporary one is that if you have a per-feed one set and change the speed on the player screen, pressing pause and play again in the same episode should remember what you changed. That is not something users need to think about manually changing.", "created_at": "2024-03-22T17:57:58Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7011, "instance_id": "AntennaPod__AntennaPod-7011", "issue_numbers": ["7007"], "base_commit": "27aa5cba96299dd14569f8a5f6da60bb88352d60", "patch": "diff --git a/app/build.gradle b/app/build.gradle\nindex d0958cd17f..559e36a3ff 100644\n--- a/app/build.gradle\n+++ b/app/build.gradle\n@@ -125,9 +125,6 @@ dependencies {\n     implementation 'com.github.skydoves:balloon:1.5.3'\n     implementation 'com.github.xabaras:RecyclerViewSwipeDecorator:1.3'\n \n-    // Non-free dependencies:\n-    playImplementation \"com.google.android.play:review:2.0.1\"\n-\n     androidTestImplementation \"org.awaitility:awaitility:$awaitilityVersion\"\n     androidTestImplementation 'com.nanohttpd:nanohttpd:2.1.1'\n     androidTestImplementation \"androidx.test.espresso:espresso-core:$espressoVersion\"\ndiff --git a/app/src/free/java/de/danoeh/antennapod/dialog/RatingDialog.java b/app/src/free/java/de/danoeh/antennapod/dialog/RatingDialog.java\ndeleted file mode 100644\nindex ec470eee62..0000000000\n--- a/app/src/free/java/de/danoeh/antennapod/dialog/RatingDialog.java\n+++ /dev/null\n@@ -1,13 +0,0 @@\n-package de.danoeh.antennapod.dialog;\n-\n-import android.content.Context;\n-import androidx.annotation.VisibleForTesting;\n-\n-public class RatingDialog {\n-    public static void init(Context context) {}\n-\n-    public static void check() {}\n-\n-    @VisibleForTesting\n-    public static void saveRated() {}\n-}\n\\ No newline at end of file\ndiff --git a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\nindex d38d4e3ad6..3c867b88c2 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n@@ -39,7 +39,7 @@\n import de.danoeh.antennapod.ui.common.ThemeSwitcher;\n import de.danoeh.antennapod.core.sync.queue.SynchronizationQueueSink;\n import de.danoeh.antennapod.core.util.download.FeedUpdateManager;\n-import de.danoeh.antennapod.dialog.RatingDialog;\n+import de.danoeh.antennapod.dialog.rating.RatingDialogManager;\n import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FeedUpdateRunningEvent;\n import de.danoeh.antennapod.event.MessageEvent;\n@@ -496,14 +496,13 @@ protected void onRestoreInstanceState(Bundle savedInstanceState) {\n     public void onStart() {\n         super.onStart();\n         EventBus.getDefault().register(this);\n-        RatingDialog.init(this);\n+        new RatingDialogManager(this).showIfNeeded();\n     }\n \n     @Override\n     protected void onResume() {\n         super.onResume();\n         handleNavIntent();\n-        RatingDialog.check();\n \n         if (lastTheme != ThemeSwitcher.getNoTitleTheme(this)) {\n             finish();\ndiff --git a/app/src/main/java/de/danoeh/antennapod/dialog/rating/RatingDialogFragment.java b/app/src/main/java/de/danoeh/antennapod/dialog/rating/RatingDialogFragment.java\nnew file mode 100644\nindex 0000000000..4e9da8b9a1\n--- /dev/null\n+++ b/app/src/main/java/de/danoeh/antennapod/dialog/rating/RatingDialogFragment.java\n@@ -0,0 +1,79 @@\n+package de.danoeh.antennapod.dialog.rating;\n+\n+import android.app.Dialog;\n+import android.content.DialogInterface;\n+import android.os.Bundle;\n+import android.view.LayoutInflater;\n+import android.view.View;\n+import android.view.ViewGroup;\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import androidx.core.text.HtmlCompat;\n+import androidx.fragment.app.DialogFragment;\n+import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n+import de.danoeh.antennapod.R;\n+import de.danoeh.antennapod.core.util.IntentUtils;\n+import de.danoeh.antennapod.databinding.RatingDialogBinding;\n+import de.danoeh.antennapod.ui.common.DateFormatter;\n+\n+import java.util.Date;\n+\n+public class RatingDialogFragment extends DialogFragment {\n+    private static final String EXTRA_TOTAL_TIME = \"totalTime\";\n+    private static final String EXTRA_OLDEST_DATE = \"oldestDate\";\n+\n+    public static RatingDialogFragment newInstance(long totalTime, long oldestDate) {\n+        RatingDialogFragment fragment = new RatingDialogFragment();\n+        Bundle arguments = new Bundle();\n+        arguments.putLong(EXTRA_TOTAL_TIME, totalTime);\n+        arguments.putLong(EXTRA_OLDEST_DATE, oldestDate);\n+        fragment.setArguments(arguments);\n+        return fragment;\n+    }\n+\n+    @NonNull\n+    @Override\n+    public Dialog onCreateDialog(@Nullable Bundle savedInstanceState) {\n+        return new MaterialAlertDialogBuilder(getContext())\n+                .setView(onCreateView(getLayoutInflater(), null, savedInstanceState))\n+                .create();\n+    }\n+\n+    @Nullable\n+    @Override\n+    public View onCreateView(@NonNull LayoutInflater inflater,\n+                             @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {\n+        RatingDialogBinding viewBinding = RatingDialogBinding.inflate(inflater);\n+        long totalTime = getArguments().getLong(EXTRA_TOTAL_TIME, 0);\n+        long oldestDate = getArguments().getLong(EXTRA_OLDEST_DATE, 0);\n+\n+        viewBinding.headerLabel.setText(HtmlCompat.fromHtml(getString(R.string.rating_tagline,\n+                DateFormatter.formatAbbrev(getContext(), new Date(oldestDate)),\n+                \"<br/><b><big><big><big><big><big>\", totalTime / 3600L,\n+                \"</big></big></big></big></big></b><br/>\"), HtmlCompat.FROM_HTML_MODE_LEGACY));\n+        viewBinding.neverAgainButton.setOnClickListener(v -> {\n+            new RatingDialogManager(getActivity()).saveRated();\n+            dismiss();\n+        });\n+        viewBinding.showLaterButton.setOnClickListener(v -> {\n+            new RatingDialogManager(getActivity()).resetStartDate();\n+            dismiss();\n+        });\n+        viewBinding.rateButton.setOnClickListener(v -> {\n+            IntentUtils.openInBrowser(getContext(),\n+                    \"https://play.google.com/store/apps/details?id=de.danoeh.antennapod\");\n+            new RatingDialogManager(getActivity()).saveRated();\n+        });\n+        viewBinding.contibuteButton.setOnClickListener(v -> {\n+            IntentUtils.openInBrowser(getContext(), IntentUtils.getLocalizedWebsiteLink(getContext()) + \"/contribute/\");\n+            new RatingDialogManager(getActivity()).saveRated();\n+        });\n+        return viewBinding.getRoot();\n+    }\n+\n+    @Override\n+    public void onCancel(@NonNull DialogInterface dialog) {\n+        super.onCancel(dialog);\n+        new RatingDialogManager(getActivity()).resetStartDate();\n+    }\n+}\ndiff --git a/app/src/main/java/de/danoeh/antennapod/dialog/rating/RatingDialogManager.java b/app/src/main/java/de/danoeh/antennapod/dialog/rating/RatingDialogManager.java\nnew file mode 100644\nindex 0000000000..ffa67cc2ee\n--- /dev/null\n+++ b/app/src/main/java/de/danoeh/antennapod/dialog/rating/RatingDialogManager.java\n@@ -0,0 +1,94 @@\n+package de.danoeh.antennapod.dialog.rating;\n+\n+import android.content.Context;\n+import android.content.SharedPreferences;\n+\n+import java.util.concurrent.TimeUnit;\n+\n+import android.util.Log;\n+import androidx.fragment.app.FragmentActivity;\n+import de.danoeh.antennapod.core.BuildConfig;\n+import de.danoeh.antennapod.core.storage.DBReader;\n+import de.danoeh.antennapod.core.storage.StatisticsItem;\n+import io.reactivex.Observable;\n+import io.reactivex.android.schedulers.AndroidSchedulers;\n+import io.reactivex.disposables.Disposable;\n+import io.reactivex.schedulers.Schedulers;\n+import kotlin.Pair;\n+\n+public class RatingDialogManager {\n+    private static final int AFTER_DAYS = 20;\n+    private static final String TAG = \"RatingDialog\";\n+    private static final String PREFS_NAME = \"RatingPrefs\";\n+    private static final String KEY_RATED = \"KEY_WAS_RATED\";\n+    private static final String KEY_FIRST_START_DATE = \"KEY_FIRST_HIT_DATE\";\n+\n+    private final SharedPreferences preferences;\n+    private final FragmentActivity fragmentActivity;\n+    private Disposable disposable;\n+\n+    public RatingDialogManager(FragmentActivity activity) {\n+        this.fragmentActivity = activity;\n+        preferences = activity.getSharedPreferences(PREFS_NAME, Context.MODE_PRIVATE);\n+    }\n+\n+    public void showIfNeeded() {\n+        //noinspection ConstantConditions\n+        if (isRated() || BuildConfig.DEBUG || \"free\".equals(BuildConfig.FLAVOR)) {\n+            return;\n+        } else if (!enoughTimeSinceInstall()) {\n+            return;\n+        }\n+\n+        if (disposable != null) {\n+            disposable.dispose();\n+        }\n+        disposable = Observable.fromCallable(\n+                () -> {\n+                    DBReader.StatisticsResult statisticsData = DBReader.getStatistics(false, 0, Long.MAX_VALUE);\n+                    long totalTime = 0;\n+                    for (StatisticsItem item : statisticsData.feedTime) {\n+                        totalTime += item.timePlayed;\n+                    }\n+                    return new Pair<>(totalTime, statisticsData.oldestDate);\n+                })\n+                .subscribeOn(Schedulers.io())\n+                .observeOn(AndroidSchedulers.mainThread())\n+                .subscribe(result -> {\n+                    long totalTime = result.getFirst();\n+                    long oldestDate = result.getSecond();\n+                    if (totalTime < TimeUnit.SECONDS.convert(15, TimeUnit.HOURS)) {\n+                        return;\n+                    } else if (oldestDate > System.currentTimeMillis()\n+                            - TimeUnit.MILLISECONDS.convert(AFTER_DAYS, TimeUnit.DAYS)) {\n+                        return; // In case the app was opened but nothing was played\n+                    }\n+                    RatingDialogFragment.newInstance(result.getFirst(), result.getSecond())\n+                            .show(fragmentActivity.getSupportFragmentManager(), TAG);\n+                }, error -> Log.e(TAG, Log.getStackTraceString(error)));\n+    }\n+\n+    private boolean isRated() {\n+        return preferences.getBoolean(KEY_RATED, false);\n+    }\n+\n+    public void saveRated() {\n+        preferences.edit().putBoolean(KEY_RATED, true).apply();\n+    }\n+\n+    public void resetStartDate() {\n+        preferences.edit().putLong(KEY_FIRST_START_DATE, System.currentTimeMillis()).apply();\n+    }\n+\n+    private boolean enoughTimeSinceInstall() {\n+        if (preferences.getLong(KEY_FIRST_START_DATE, 0) == 0) {\n+            resetStartDate();\n+            return false;\n+        }\n+        long now = System.currentTimeMillis();\n+        long firstDate = preferences.getLong(KEY_FIRST_START_DATE, now);\n+        long diff = now - firstDate;\n+        long diffDays = TimeUnit.DAYS.convert(diff, TimeUnit.MILLISECONDS);\n+        return diffDays >= AFTER_DAYS;\n+    }\n+}\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/MainPreferencesFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/MainPreferencesFragment.java\nindex 4d73132473..bf30700bf8 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/MainPreferencesFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/MainPreferencesFragment.java\n@@ -17,13 +17,6 @@\n import de.danoeh.antennapod.activity.PreferenceActivity;\n import de.danoeh.antennapod.core.util.IntentUtils;\n import de.danoeh.antennapod.fragment.preferences.about.AboutFragment;\n-import org.apache.commons.io.IOUtils;\n-import org.apache.commons.lang3.ArrayUtils;\n-\n-import java.io.IOException;\n-import java.io.InputStream;\n-import java.nio.charset.StandardCharsets;\n-import java.util.Locale;\n \n public class MainPreferencesFragment extends PreferenceFragmentCompat {\n \n@@ -113,7 +106,8 @@ private void setupMainScreen() {\n                 }\n         );\n         findPreference(PREF_DOCUMENTATION).setOnPreferenceClickListener(preference -> {\n-            IntentUtils.openInBrowser(getContext(), getLocalizedWebsiteLink() + \"/documentation/\");\n+            IntentUtils.openInBrowser(getContext(),\n+                    IntentUtils.getLocalizedWebsiteLink(getContext()) + \"/documentation/\");\n             return true;\n         });\n         findPreference(PREF_VIEW_FORUM).setOnPreferenceClickListener(preference -> {\n@@ -121,7 +115,8 @@ private void setupMainScreen() {\n             return true;\n         });\n         findPreference(PREF_CONTRIBUTE).setOnPreferenceClickListener(preference -> {\n-            IntentUtils.openInBrowser(getContext(), getLocalizedWebsiteLink() + \"/contribute/\");\n+            IntentUtils.openInBrowser(getContext(),\n+                    IntentUtils.getLocalizedWebsiteLink(getContext()) + \"/contribute/\");\n             return true;\n         });\n         findPreference(PREF_SEND_BUG_REPORT).setOnPreferenceClickListener(preference -> {\n@@ -130,20 +125,6 @@ private void setupMainScreen() {\n         });\n     }\n \n-    private String getLocalizedWebsiteLink() {\n-        try (InputStream is = getContext().getAssets().open(\"website-languages.txt\")) {\n-            String[] languages = IOUtils.toString(is, StandardCharsets.UTF_8.name()).split(\"\\n\");\n-            String deviceLanguage = Locale.getDefault().getLanguage();\n-            if (ArrayUtils.contains(languages, deviceLanguage) && !\"en\".equals(deviceLanguage)) {\n-                return \"https://antennapod.org/\" + deviceLanguage;\n-            } else {\n-                return \"https://antennapod.org\";\n-            }\n-        } catch (IOException e) {\n-            throw new RuntimeException(e);\n-        }\n-    }\n-\n     private void setupSearch() {\n         SearchPreference searchPreference = findPreference(\"searchPreference\");\n         SearchConfiguration config = searchPreference.getSearchConfiguration();\ndiff --git a/app/src/main/res/layout/rating_dialog.xml b/app/src/main/res/layout/rating_dialog.xml\nnew file mode 100644\nindex 0000000000..c8f3c980b9\n--- /dev/null\n+++ b/app/src/main/res/layout/rating_dialog.xml\n@@ -0,0 +1,100 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<ScrollView\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"wrap_content\"\n+    android:orientation=\"vertical\"\n+    android:clipToPadding=\"false\"\n+    android:paddingBottom=\"32dp\">\n+\n+    <LinearLayout\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:orientation=\"vertical\">\n+\n+        <LinearLayout\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"wrap_content\"\n+            android:background=\"@drawable/bg_blue_gradient\"\n+            android:orientation=\"horizontal\"\n+            android:paddingVertical=\"32dp\"\n+            android:paddingHorizontal=\"16dp\">\n+\n+            <ImageView\n+                android:layout_width=\"56dp\"\n+                android:layout_height=\"56dp\"\n+                android:layout_gravity=\"center_vertical\"\n+                android:layout_marginLeft=\"8dp\"\n+                android:layout_marginStart=\"8dp\"\n+                android:importantForAccessibility=\"no\"\n+                android:src=\"@drawable/logo_monochrome\" />\n+\n+            <TextView\n+                android:id=\"@+id/headerLabel\"\n+                android:layout_width=\"0dp\"\n+                android:layout_height=\"wrap_content\"\n+                android:layout_marginLeft=\"16dp\"\n+                android:layout_marginStart=\"16dp\"\n+                android:textColor=\"#fff\"\n+                android:layout_weight=\"1\" />\n+\n+        </LinearLayout>\n+\n+        <TextView\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"wrap_content\"\n+            android:text=\"@string/rating_volunteers_label\"\n+            android:layout_marginHorizontal=\"32dp\"\n+            android:layout_marginVertical=\"16dp\"\n+            android:textColor=\"?colorOnBackground\" />\n+\n+        <Button\n+            android:id=\"@+id/rateButton\"\n+            android:layout_width=\"wrap_content\"\n+            android:layout_height=\"wrap_content\"\n+            android:layout_marginHorizontal=\"32dp\"\n+            android:text=\"@string/rating_rate\"\n+            android:layout_gravity=\"right|end\"\n+            style=\"@style/Widget.Material3.Button.OutlinedButton\" />\n+\n+        <TextView\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"wrap_content\"\n+            android:text=\"@string/rating_contribute_label\"\n+            android:layout_marginHorizontal=\"32dp\"\n+            android:layout_marginVertical=\"16dp\"\n+            android:textColor=\"?colorOnBackground\" />\n+\n+        <Button\n+            android:id=\"@+id/contibuteButton\"\n+            android:layout_width=\"wrap_content\"\n+            android:layout_height=\"wrap_content\"\n+            android:layout_marginHorizontal=\"32dp\"\n+            android:text=\"@string/rating_contribute_button\"\n+            android:layout_gravity=\"right|end\"\n+            style=\"@style/Widget.Material3.Button.OutlinedButton\" />\n+\n+        <Button\n+            android:id=\"@+id/showLaterButton\"\n+            android:layout_width=\"wrap_content\"\n+            android:layout_height=\"wrap_content\"\n+            android:layout_marginHorizontal=\"32dp\"\n+            android:layout_marginTop=\"8dp\"\n+            android:text=\"@string/rating_later\"\n+            android:layout_gravity=\"right|end\"\n+            android:gravity=\"right|end\"\n+            style=\"@style/Widget.Material3.Button.TextButton\" />\n+\n+        <Button\n+            android:id=\"@+id/neverAgainButton\"\n+            android:layout_width=\"wrap_content\"\n+            android:layout_height=\"wrap_content\"\n+            android:layout_marginHorizontal=\"32dp\"\n+            android:text=\"@string/checkbox_do_not_show_again\"\n+            android:layout_gravity=\"right|end\"\n+            android:gravity=\"right|end\"\n+            style=\"@style/Widget.Material3.Button.TextButton\" />\n+\n+    </LinearLayout>\n+\n+</ScrollView>\ndiff --git a/app/src/play/java/de/danoeh/antennapod/dialog/RatingDialog.java b/app/src/play/java/de/danoeh/antennapod/dialog/RatingDialog.java\ndeleted file mode 100644\nindex c38ae26595..0000000000\n--- a/app/src/play/java/de/danoeh/antennapod/dialog/RatingDialog.java\n+++ /dev/null\n@@ -1,123 +0,0 @@\n-package de.danoeh.antennapod.dialog;\n-\n-import android.app.Activity;\n-\n-import android.content.Context;\n-import android.content.SharedPreferences;\n-\n-import androidx.annotation.VisibleForTesting;\n-import android.util.Log;\n-\n-import java.lang.ref.WeakReference;\n-import java.util.concurrent.TimeUnit;\n-\n-import com.google.android.gms.tasks.Task;\n-import com.google.android.play.core.review.ReviewInfo;\n-import com.google.android.play.core.review.ReviewManager;\n-import com.google.android.play.core.review.ReviewManagerFactory;\n-\n-import de.danoeh.antennapod.BuildConfig;\n-\n-public class RatingDialog {\n-\n-    private RatingDialog() {\n-    }\n-\n-    private static final String TAG = RatingDialog.class.getSimpleName();\n-    private static final int AFTER_DAYS = 14;\n-\n-    private static WeakReference<Context> mContext;\n-    private static SharedPreferences mPreferences;\n-\n-    private static final String PREFS_NAME = \"RatingPrefs\";\n-    private static final String KEY_RATED = \"KEY_WAS_RATED\";\n-    private static final String KEY_FIRST_START_DATE = \"KEY_FIRST_HIT_DATE\";\n-    private static final String KEY_NUMBER_OF_REVIEWS = \"NUMBER_OF_REVIEW_ATTEMPTS\";\n-\n-    public static void init(Context context) {\n-        mContext = new WeakReference<>(context);\n-        mPreferences = context.getSharedPreferences(PREFS_NAME, Context.MODE_PRIVATE);\n-\n-        long firstDate = mPreferences.getLong(KEY_FIRST_START_DATE, 0);\n-        if (firstDate == 0) {\n-            resetStartDate();\n-        }\n-    }\n-\n-    public static void check() {\n-        if (shouldShow()) {\n-            try {\n-                showInAppReview();\n-            } catch (Exception e) {\n-                Log.e(TAG, Log.getStackTraceString(e));\n-            }\n-        }\n-    }\n-\n-    private static void showInAppReview() {\n-        Context context = mContext.get();\n-        if (context == null) {\n-            return;\n-        }\n-\n-        ReviewManager manager = ReviewManagerFactory.create(context);\n-        Task<ReviewInfo> request = manager.requestReviewFlow();\n-\n-        request.addOnCompleteListener(task -> {\n-            if (task.isSuccessful()) {\n-                ReviewInfo reviewInfo = task.getResult();\n-                Task<Void> flow = manager.launchReviewFlow((Activity) context, reviewInfo);\n-                flow.addOnCompleteListener(task1 -> {\n-                    int previousAttempts = mPreferences.getInt(KEY_NUMBER_OF_REVIEWS, 0);\n-                    if (previousAttempts >= 3) {\n-                        saveRated();\n-                    } else {\n-                        resetStartDate();\n-                        mPreferences\n-                                .edit()\n-                                .putInt(KEY_NUMBER_OF_REVIEWS, previousAttempts + 1)\n-                                .apply();\n-                    }\n-                    Log.i(\"ReviewDialog\", \"Successfully finished in-app review\");\n-                })\n-                        .addOnFailureListener(error -> {\n-                            Log.i(\"ReviewDialog\", \"failed in reviewing process\");\n-                        });\n-            }\n-        })\n-                .addOnFailureListener(error -> {\n-                    Log.i(\"ReviewDialog\",  \"failed to get in-app review request\");\n-                });\n-    }\n-\n-    private static boolean rated() {\n-        return mPreferences.getBoolean(KEY_RATED, false);\n-    }\n-\n-    @VisibleForTesting\n-    public static void saveRated() {\n-        mPreferences\n-                .edit()\n-                .putBoolean(KEY_RATED, true)\n-                .apply();\n-    }\n-\n-    private static void resetStartDate() {\n-        mPreferences\n-                .edit()\n-                .putLong(KEY_FIRST_START_DATE, System.currentTimeMillis())\n-                .apply();\n-    }\n-\n-    private static boolean shouldShow() {\n-        if (rated() || BuildConfig.DEBUG) {\n-            return false;\n-        }\n-\n-        long now = System.currentTimeMillis();\n-        long firstDate = mPreferences.getLong(KEY_FIRST_START_DATE, now);\n-        long diff = now - firstDate;\n-        long diffDays = TimeUnit.DAYS.convert(diff, TimeUnit.MILLISECONDS);\n-        return diffDays >= AFTER_DAYS;\n-    }\n-}\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/util/IntentUtils.java b/core/src/main/java/de/danoeh/antennapod/core/util/IntentUtils.java\nindex 959a3e574c..8b30b4eace 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/util/IntentUtils.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/util/IntentUtils.java\n@@ -9,8 +9,14 @@\n import android.util.Log;\n import android.widget.Toast;\n import de.danoeh.antennapod.core.R;\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.lang3.ArrayUtils;\n \n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.nio.charset.StandardCharsets;\n import java.util.List;\n+import java.util.Locale;\n \n public class IntentUtils {\n     private static final String TAG = \"IntentUtils\";\n@@ -45,4 +51,19 @@ public static void openInBrowser(Context context, String url) {\n             Log.e(TAG, Log.getStackTraceString(e));\n         }\n     }\n+\n+\n+    public static String getLocalizedWebsiteLink(Context context) {\n+        try (InputStream is = context.getAssets().open(\"website-languages.txt\")) {\n+            String[] languages = IOUtils.toString(is, StandardCharsets.UTF_8.name()).split(\"\\n\");\n+            String deviceLanguage = Locale.getDefault().getLanguage();\n+            if (ArrayUtils.contains(languages, deviceLanguage) && !\"en\".equals(deviceLanguage)) {\n+                return \"https://antennapod.org/\" + deviceLanguage;\n+            } else {\n+                return \"https://antennapod.org\";\n+            }\n+        } catch (IOException e) {\n+            throw new RuntimeException(e);\n+        }\n+    }\n }\ndiff --git a/ui/echo/src/main/res/drawable-nodpi/logo_monochrome.png b/ui/common/src/main/res/drawable-nodpi/logo_monochrome.png\nsimilarity index 100%\nrename from ui/echo/src/main/res/drawable-nodpi/logo_monochrome.png\nrename to ui/common/src/main/res/drawable-nodpi/logo_monochrome.png\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 6da3e554fc..44cf707b57 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -672,6 +672,14 @@\n     <string name=\"pref_pausePlaybackForFocusLoss_sum\">Pause playback instead of lowering volume when another app wants to play sounds</string>\n     <string name=\"pref_pausePlaybackForFocusLoss_title\">Pause for interruptions</string>\n \n+    <!-- Rating dialog -->\n+    <string name=\"rating_tagline\">Since %1$s, you played %2$s%3$d%4$s hours of podcasts.</string>\n+    <string name=\"rating_contribute_label\">Want to join? Whether you want to translate, support, design or code, we would be happy to have you!</string>\n+    <string name=\"rating_contribute_button\">Discover ways to contribute</string>\n+    <string name=\"rating_volunteers_label\">AntennaPod is developed by volunteers in our free time. We would be happy if you appreciated our work by leaving a nice rating.</string>\n+    <string name=\"rating_rate\">Rate AntennaPod</string>\n+    <string name=\"rating_later\">Later</string>\n+\n     <!-- Online feed view -->\n     <string name=\"subscribe_label\">Subscribe</string>\n     <string name=\"subscribing_label\">Subscribing&#8230;</string>\n", "test_patch": "diff --git a/app/src/androidTest/java/de/test/antennapod/EspressoTestUtils.java b/app/src/androidTest/java/de/test/antennapod/EspressoTestUtils.java\nindex a7575862b1..f0e0a69962 100644\n--- a/app/src/androidTest/java/de/test/antennapod/EspressoTestUtils.java\n+++ b/app/src/androidTest/java/de/test/antennapod/EspressoTestUtils.java\n@@ -25,7 +25,6 @@\n import de.danoeh.antennapod.activity.MainActivity;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import de.danoeh.antennapod.core.service.playback.PlaybackService;\n-import de.danoeh.antennapod.dialog.RatingDialog;\n import de.danoeh.antennapod.fragment.NavDrawerFragment;\n import org.awaitility.Awaitility;\n import org.awaitility.core.ConditionTimeoutException;\n@@ -166,9 +165,6 @@ public static void clearPreferences() {\n                 .edit()\n                 .putString(UserPreferences.PREF_UPDATE_INTERVAL, \"0\")\n                 .commit();\n-\n-        RatingDialog.init(InstrumentationRegistry.getInstrumentation().getTargetContext());\n-        RatingDialog.saveRated();\n     }\n \n     public static void setLaunchScreen(String tag) {\n", "problem_statement": "Further delay the displaying of the review popup\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.3.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Problem you may be having, or feature you want\n\nFor several users, the pop-up requesting review is shown too quickly.\n\n### Suggested solution\n\nFurther delay showing the pop-up requesting a review from 14 to 30 days after the app was used the first time.\r\nAdded benefit: users who don't use AntennaPod anymore and who left in the meantime, won't see the pop-up.\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "", "created_at": "2024-03-20T22:15:24Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 7006, "instance_id": "AntennaPod__AntennaPod-7006", "issue_numbers": ["7001"], "base_commit": "817787567454ef1f92329d9e1214add43786eb52", "patch": "diff --git a/common.gradle b/common.gradle\nindex 65eed001ca..4073875e29 100644\n--- a/common.gradle\n+++ b/common.gradle\n@@ -44,7 +44,7 @@ android {\n     }\n \n     lint {\n-        disable \"GradleDependency\"\n+        disable \"GradleDependency\", \"OutdatedLibrary\"\n         checkDependencies true\n         warningsAsErrors true\n         abortOnError true\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\nindex 02102db14c..5a9e6f34f4 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n@@ -867,8 +867,12 @@ public void statusChanged(PlaybackServiceMediaPlayer.PSMPInfo newInfo) {\n             }\n \n             if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.N) {\n-                TileService.requestListeningState(getApplicationContext(),\n-                        new ComponentName(getApplicationContext(), QuickSettingsTileService.class));\n+                try {\n+                    TileService.requestListeningState(getApplicationContext(),\n+                            new ComponentName(getApplicationContext(), QuickSettingsTileService.class));\n+                } catch (IllegalArgumentException e) {\n+                    Log.d(TAG, \"Skipping quick settings tile setup\");\n+                }\n             }\n \n             IntentUtils.sendLocalBroadcast(getApplicationContext(), ACTION_PLAYER_STATUS_CHANGED);\n", "test_patch": "", "problem_statement": "Can't play a podcast\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n### App version\r\n\r\n3.2.0\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Android version\r\n\r\n13 (lineageOS)\r\n\r\n### Device model\r\n\r\n_No response_\r\n\r\n### First occurred\r\n\r\nI just downloaded the app, tried multiple podcasts and none work.\r\nGoing to spotify it works fine.\r\n\r\n### Steps to reproduce\r\n\r\n1. Open a podcast\r\n2. Press \"stream\"\r\n3. Press the \"play\" button in the bottom right corner => doesn't do anything\r\n4. Click the banner at the bottom of the screen\r\n5. Click the play button there => closes the overview, and no more banner at the bottom\r\n6. Download the podcast => works fine\r\n7. Repeat above steps but with downloaded podcast => doesn't work either\r\n\r\n### Expected behaviour\r\n\r\nIt should play\r\n\r\n### Current behaviour\r\n\r\nIt doesn't play, and when pressing \"play\" from the screen where it shows advanced controls like going backwards/forwards/shownotes it will close the playing (seems like it's crashing?)\r\n\r\n### Logs\r\n\r\n\"No crash report recorded\"\n", "hints_text": "Does this happen with literally every podcast you subscribe to, or are there some that do work and some that don't?\nI tried 3 so far and all of them didn't work.\r\n\r\nEDIT: I tried like 20 different podcasts, and nothing is working.\nI just checked logcat, and that gave the following error(s): \r\n```\r\n31070 31070 W PlaybackController: Play/Pause button was pressed, but playbackservice was null!\r\n31070 31070 D PlaybackService: Service created.\r\n 1667  4156 I MediaSessionStack: addSession to bottom of stack | record: de.danoeh.antennapod/PlaybackService (userId=10)\r\n31070 31070 D SessionManagerImpl: unimplemented Method: addSessionManagerListener\r\n 1667  4156 W ActivityManager: Receiver with filter android.content.IntentFilter@6665d8d already registered for pid 31070, callerPackage is de.danoeh.antennapod\r\n 1667  4156 W ActivityManager: Receiver with filter android.content.IntentFilter@224fb42 already registered for pid 31070, callerPackage is de.danoeh.antennapod\r\n31070 31070 D PlaybackController: Trying to connect to service\r\n31070 31070 D PlaybackController: Result for service binding: true\r\n 1667  4156 W ActivityManager: Receiver with filter android.content.IntentFilter@7f0d890 already registered for pid 31070, callerPackage is de.danoeh.antennapod\r\n 1667  4156 W ActivityManager: Receiver with filter android.content.IntentFilter@2e84589 already registered for pid 31070, callerPackage is de.danoeh.antennapod\r\n31070 31070 D PlaybackController: Trying to connect to service\r\n31070 31070 D PlaybackController: Result for service binding: true\r\n 1667  4156 W ActivityManager: Receiver with filter android.content.IntentFilter@1a705af already registered for pid 31070, callerPackage is de.danoeh.antennapod\r\n 1667  4156 W ActivityManager: Receiver with filter android.content.IntentFilter@c32edbc already registered for pid 31070, callerPackage is de.danoeh.antennapod\r\n31070 31070 D PlaybackController: Trying to connect to service\r\n31070 31070 D PlaybackController: Result for service binding: true\r\n 1667  4156 W ActivityManager: Receiver with filter android.content.IntentFilter@bab09a already registered for pid 31070, callerPackage is de.danoeh.antennapod\r\n 1667  4156 W ActivityManager: Receiver with filter android.content.IntentFilter@2684dcb already registered for pid 31070, callerPackage is de.danoeh.antennapod\r\n31070 31070 D PlaybackController: Trying to connect to service\r\n31070 31070 D PlaybackController: Result for service binding: true\r\n31070 31070 D PlaybackController: Trying to connect to service\r\n31070 31070 D PlaybackController: Result for service binding: true\r\n31070 31070 D PlaybackController: Trying to connect to service\r\n31070 31070 D PlaybackController: Result for service binding: true\r\n31070 31070 D ItemDescriptionFragment: load()\r\n31070 31070 D PlaybackService: OnStartCommand called\r\n31070 31070 D PlaybackSrvState: startForeground\r\n31070 31118 D DBReader: getFeedItem() called with: itemId = [1]\r\n31070 31118 D DBReader: Loading feeditem with id 1\r\n31070 31118 D DBReader: getFavoriteIDList() called\r\n31070 31118 D DBReader: getQueueIDList() called\r\n31070 31070 D PlaybackService: Received onBind event\r\n31070 31118 D DBReader: Extracting Feedlist\r\n31070 31070 D PlaybackController: Trying to connect to service\r\n31070 31070 D PlaybackController: Result for service binding: true\r\n31070 31070 D PlaybackController: Trying to connect to service\r\n31070 31070 D PlaybackController: Result for service binding: true\r\n31070 31070 D PlaybackController: Trying to connect to service\r\n31070 31070 D PlaybackController: Result for service binding: true\r\n31070 31070 D PlaybackController: Trying to connect to service\r\n31070 31070 D PlaybackController: Result for service binding: true\r\n31070 31070 D PlaybackController: Trying to connect to service\r\n31070 31070 D PlaybackController: Result for service binding: true\r\n31070 31070 D PlaybackController: Trying to connect to service\r\n31070 31070 D PlaybackController: Result for service binding: true\r\n31070 31070 D PlaybackController: Querying service info\r\n31070 31070 D PlaybackController: status: STOPPED\r\n31070 31070 D PlaybackController: Connection to Service established\r\n31070 31070 D PlaybackController: Querying service info\r\n31070 31070 D PlaybackController: status: STOPPED\r\n31070 31070 D ItemDescriptionFragment: load()\r\n31070 31070 D PlaybackController: Connection to Service established\r\n31070 31070 D PlaybackController: Querying service info\r\n31070 31070 D PlaybackController: status: STOPPED\r\n31070 31070 D PlaybackController: Connection to Service established\r\n31070 31070 D PlaybackController: Querying service info\r\n31070 31070 D PlaybackController: status: STOPPED\r\n31070 31070 D PlaybackController: Connection to Service established\r\n31070 31070 D PlaybackController: Querying service info\r\n31070 31070 D PlaybackController: status: STOPPED\r\n31070 31070 D PlaybackController: Connection to Service established\r\n31070 31070 D PlaybackController: Querying service info\r\n31070 31070 D PlaybackController: status: STOPPED\r\n31070 31070 D ExternalPlayerFragment: Loading media info\r\n31070 31070 D PlaybackController: Connection to Service established\r\n31070 31070 D LclPlaybackSvcMPlayer: playMediaObject(...)\r\n31070 31070 I ExoPlayerImpl: Init 77fda15 [ExoPlayerLib/2.14.2] [REDACTED]\r\n  882  8595 I EffectsFactory: EffectCreate() create_effect\r\n31070 31070 D PlaybackSvcMediaPlayer: LocalPSMP: Setting player status to INITIALIZING\r\n 1667  1694 I MediaSessionStack: onPlaybackStateChanged - Pushing session to top | record: de.danoeh.antennapod/PlaybackService (userId=10)\r\n31070 31070 W System.err: java.lang.IllegalArgumentException: User 10 is not the current user.\r\n31070 31070 W System.err: \tat android.os.Parcel.createExceptionOrNull(Parcel.java:3015)\r\n31070 31070 W System.err: \tat android.os.Parcel.createException(Parcel.java:2995)\r\n31070 31070 W System.err: \tat android.os.Parcel.readException(Parcel.java:2978)\r\n31070 31070 W System.err: \tat android.os.Parcel.readException(Parcel.java:2920)\r\n31070 31070 W System.err: \tat com.android.internal.statusbar.IStatusBarService$Stub$Proxy.requestTileServiceListeningState(IStatusBarService.java:2400)\r\n31070 31070 W System.err: \tat android.app.StatusBarManager.requestTileServiceListeningState(StatusBarManager.java:906)\r\n31070 31070 W System.err: \tat android.service.quicksettings.TileService.requestListeningState(TileService.java:518)\r\n31070 31070 W System.err: \tat de.danoeh.antennapod.core.service.QuickSettingsTileService$$ExternalSyntheticApiModelOutline0.m(R8$$SyntheticClass:0)\r\n31070 31070 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService$3.statusChanged(PlaybackService.java:856)\r\n31070 31070 W System.err: \tat de.danoeh.antennapod.playback.base.PlaybackServiceMediaPlayer.setPlayerStatus(PlaybackServiceMediaPlayer.java:319)\r\n31070 31070 W System.err: \tat de.danoeh.antennapod.playback.base.PlaybackServiceMediaPlayer.setPlayerStatus(PlaybackServiceMediaPlayer.java:331)\r\n31070 31070 W System.err: \tat de.danoeh.antennapod.core.service.playback.LocalPSMP.playMediaObject(LocalPSMP.java:160)\r\n31070 31070 W System.err: \tat de.danoeh.antennapod.core.service.playback.LocalPSMP.playMediaObject(LocalPSMP.java:113)\r\n31070 31070 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.startPlaying(PlaybackService.java:741)\r\n31070 31070 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.lambda$onStartCommand$6(PlaybackService.java:526)\r\n31070 31070 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.$r8$lambda$mOCf9qqsskaQGmxsaI_m2ZmJO2w(PlaybackService.java:0)\r\n31070 31070 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService$$ExternalSyntheticLambda6.accept(R8$$SyntheticClass:0)\r\n31070 31070 W System.err: \tat io.reactivex.internal.observers.LambdaObserver.onNext(LambdaObserver.java:63)\r\n31070 31070 W System.err: \tat io.reactivex.internal.operators.observable.ObservableObserveOn$ObserveOnObserver.drainNormal(ObservableObserveOn.java:201)\r\n31070 31070 W System.err: \tat io.reactivex.internal.operators.observable.ObservableObserveOn$ObserveOnObserver.run(ObservableObserveOn.java:255)\r\n31070 31070 W System.err: \tat io.reactivex.android.schedulers.HandlerScheduler$ScheduledRunnable.run(HandlerScheduler.java:124)\r\n31070 31070 W System.err: \tat android.os.Handler.handleCallback(Handler.java:942)\r\n31070 31070 W System.err: \tat android.os.Handler.dispatchMessage(Handler.java:99)\r\n31070 31070 W System.err: \tat android.os.Looper.loopOnce(Looper.java:201)\r\n31070 31070 W System.err: \tat android.os.Looper.loop(Looper.java:288)\r\n31070 31070 W System.err: \tat android.app.ActivityThread.main(ActivityThread.java:7924)\r\n31070 31070 W System.err: \tat java.lang.reflect.Method.invoke(Native Method)\r\n31070 31070 W System.err: \tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548)\r\n31070 31070 W System.err: \tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:936)\r\n31070 31070 W System.err: Caused by: android.os.RemoteException: Remote stack trace:\r\n31070 31070 W System.err: \tat com.android.server.statusbar.StatusBarManagerService.requestTileServiceListeningState(StatusBarManagerService.java:1869)\r\n31070 31070 W System.err: \tat com.android.internal.statusbar.IStatusBarService$Stub.onTransact(IStatusBarService.java:1259)\r\n31070 31070 W System.err: \tat android.os.Binder.execTransactInternal(Binder.java:1280)\r\n31070 31070 W System.err: \tat android.os.Binder.execTransact(Binder.java:1244)\r\n31070 31070 D PlaybackService: Playable was not found. Stopping service.\r\n31070 31070 W System.err: java.lang.IllegalArgumentException: User 10 is not the current user.\r\n31070 31070 W System.err: \tat android.os.Parcel.createExceptionOrNull(Parcel.java:3015)\r\n31070 31070 W System.err: \tat android.os.Parcel.createException(Parcel.java:2995)\r\n31070 31070 W System.err: \tat android.os.Parcel.readException(Parcel.java:2978)\r\n31070 31070 W System.err: \tat android.os.Parcel.readException(Parcel.java:2920)\r\n31070 31070 W System.err: \tat com.android.internal.statusbar.IStatusBarService$Stub$Proxy.requestTileServiceListeningState(IStatusBarService.java:2400)\r\n31070 31070 W System.err: \tat android.app.StatusBarManager.requestTileServiceListeningState(StatusBarManager.java:906)\r\n31070 31070 W System.err: \tat android.service.quicksettings.TileService.requestListeningState(TileService.java:518)\r\n31070 31070 W System.err: \tat de.danoeh.antennapod.core.service.QuickSettingsTileService$$ExternalSyntheticApiModelOutline0.m(R8$$SyntheticClass:0)\r\n31070 31070 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService$3.statusChanged(PlaybackService.java:856)\r\n31070 31070 W System.err: \tat de.danoeh.antennapod.playback.base.PlaybackServiceMediaPlayer.setPlayerStatus(PlaybackServiceMediaPlayer.java:319)\r\n31070 31070 W System.err: \tat de.danoeh.antennapod.playback.base.PlaybackServiceMediaPlayer.setPlayerStatus(PlaybackServiceMediaPlayer.java:331)\r\n31070 31070 W System.err: \tat de.danoeh.antennapod.core.service.playback.LocalPSMP.playMediaObject(LocalPSMP.java:160)\r\n31070 31070 W System.err: \tat de.danoeh.antennapod.core.service.playback.LocalPSMP.playMediaObject(LocalPSMP.java:113)\r\n31070 31070 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.startPlaying(PlaybackService.java:741)\r\n31070 31070 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.lambda$onStartCommand$6(PlaybackService.java:526)\r\n31070 31070 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.$r8$lambda$mOCf9qqsskaQGmxsaI_m2ZmJO2w(PlaybackService.java:0)\r\n31070 31070 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService$$ExternalSyntheticLambda6.accept(R8$$SyntheticClass:0)\r\n31070 31070 W System.err: \tat io.reactivex.internal.observers.LambdaObserver.onNext(LambdaObserver.java:63)\r\n31070 31070 W System.err: \tat io.reactivex.internal.operators.observable.ObservableObserveOn$ObserveOnObserver.drainNormal(ObservableObserveOn.java:201)\r\n31070 31070 W System.err: \tat io.reactivex.internal.operators.observable.ObservableObserveOn$ObserveOnObserver.run(ObservableObserveOn.java:255)\r\n31070 31070 W System.err: \tat io.reactivex.android.schedulers.HandlerScheduler$ScheduledRunnable.run(HandlerScheduler.java:124)\r\n31070 31070 W System.err: \tat android.os.Handler.handleCallback(Handler.java:942)\r\n31070 31070 W System.err: \tat android.os.Handler.dispatchMessage(Handler.java:99)\r\n31070 31070 W System.err: \tat android.os.Looper.loopOnce(Looper.java:201)\r\n31070 31070 W System.err: \tat android.os.Looper.loop(Looper.java:288)\r\n31070 31070 W System.err: \tat android.app.ActivityThread.main(ActivityThread.java:7924)\r\n31070 31070 W System.err: \tat java.lang.reflect.Method.invoke(Native Method)\r\n31070 31070 W System.err: \tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548)\r\n31070 31070 W System.err: \tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:936)\r\n31070 31070 W System.err: Caused by: android.os.RemoteException: Remote stack trace:\r\n31070 31070 W System.err: \tat com.android.server.statusbar.StatusBarManagerService.requestTileServiceListeningState(StatusBarManagerService.java:1869)\r\n31070 31070 W System.err: \tat com.android.internal.statusbar.IStatusBarService$Stub.onTransact(IStatusBarService.java:1259)\r\n31070 31070 W System.err: \tat android.os.Binder.execTransactInternal(Binder.java:1280)\r\n31070 31070 W System.err: \tat android.os.Binder.execTransact(Binder.java:1244)\r\n31070 31070 D PlaybackSrvState: stopService\r\n31070 31070 D PlaybackSrvState: stopForeground\r\n31070 31070 D PlaybackController: Disconnected from Service\r\n31070 31070 D PlaybackController: Disconnected from Service\r\n31070 31070 D PlaybackController: Disconnected from Service\r\n31070 31070 D PlaybackService: Received onUnbind event\r\n31070 31070 D PlaybackService: Service is about to be destroyed\r\n31070 31070 D PlaybackSrvState: stopForeground\r\n31070 31070 D SessionManagerImpl: unimplemented Method: removeSessionManagerListener\r\n 1667  1694 I MediaSessionStack: removeSession | record: de.danoeh.antennapod/PlaybackService (userId=10)\r\n31070 31070 I ExoPlayerImpl: Release 77fda15 [ExoPlayerLib/2.14.2] [REDACTED] [goog.exo.core]\r\n 1667  1694 I MediaFocusControl: abandonAudioFocus() from uid/pid 1010233/31070 clientId=android.media.AudioManager@53a7464de.danoeh.antennapod.core.service.playback.LocalPSMP$1@2b236cd\r\n31070 31070 D PlaybackController: Disconnected from Service\r\n31070 31070 D PlaybackController: Disconnected from Service\r\n```\r\n\r\nAnd this in particular: `User 10 is not the current user`. Since I'm running AntennaPod in a android work profile (see the [shelter](https://f-droid.org/packages/net.typeblog.shelter/) application), the user ID is 10. I'm not sure what exactly is going on, but hopefully this can send you in the right direction. Let me know if there's something else I can do.\nDo you use the AntennaPod quick settings tile?\nNope I don't, everything's done from the app\nCan you please check that you did not add it at some point? Is it really not added to the quick settings tiles?\nYep it's not there. Besides that, I can't even add it (because it's in a work profile).\r\n\r\nIf you want to see/try it for yourself, download an app which can create a work profile (for example shelter, but [insular](https://f-droid.org/en/packages/com.oasisfeng.island.fdroid/), [island](https://play.google.com/store/apps/details?id=com.oasisfeng.island) or something similar works too).", "created_at": "2024-03-19T23:12:23Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6994, "instance_id": "AntennaPod__AntennaPod-6994", "issue_numbers": ["4850"], "base_commit": "17f5a5d1b85f07bada36abe6541ed0fc1e1d83a2", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\nindex b4d45b2629..3c38c4c216 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n@@ -59,6 +59,7 @@\n import de.danoeh.antennapod.model.download.DownloadStatus;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n import de.danoeh.antennapod.playback.cast.CastEnabledActivity;\n+import de.danoeh.antennapod.storage.importexport.AutomaticDatabaseExportWorker;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import de.danoeh.antennapod.ui.appstartintent.MainActivityStarter;\n import de.danoeh.antennapod.ui.common.ThemeUtils;\n@@ -167,6 +168,7 @@ public void onCreate(Bundle savedInstanceState) {\n \n         FeedUpdateManager.restartUpdateAlarm(this, false);\n         SynchronizationQueueSink.syncNowIfNotSyncedRecently();\n+        AutomaticDatabaseExportWorker.enqueueIfNeeded(this, false);\n \n         WorkManager.getInstance(this)\n                 .getWorkInfosByTagLiveData(FeedUpdateManager.WORK_TAG_FEED_UPDATE)\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/ImportExportPreferencesFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/ImportExportPreferencesFragment.java\nindex 9191825aa3..6c0e0d456e 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/ImportExportPreferencesFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/ImportExportPreferencesFragment.java\n@@ -15,8 +15,10 @@\n import androidx.activity.result.contract.ActivityResultContracts.GetContent;\n import androidx.activity.result.contract.ActivityResultContracts.StartActivityForResult;\n import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n import androidx.annotation.StringRes;\n import androidx.documentfile.provider.DocumentFile;\n+import androidx.preference.SwitchPreferenceCompat;\n import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import androidx.core.app.ShareCompat;\n import androidx.core.content.FileProvider;\n@@ -30,6 +32,7 @@\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n import de.danoeh.antennapod.model.feed.SortOrder;\n+import de.danoeh.antennapod.storage.importexport.AutomaticDatabaseExportWorker;\n import de.danoeh.antennapod.storage.importexport.DatabaseExporter;\n import de.danoeh.antennapod.storage.importexport.FavoritesWriter;\n import de.danoeh.antennapod.storage.importexport.HtmlWriter;\n@@ -59,6 +62,7 @@ public class ImportExportPreferencesFragment extends PreferenceFragmentCompat {\n     private static final String PREF_HTML_EXPORT = \"prefHtmlExport\";\n     private static final String PREF_DATABASE_IMPORT = \"prefDatabaseImport\";\n     private static final String PREF_DATABASE_EXPORT = \"prefDatabaseExport\";\n+    private static final String PREF_AUTOMATIC_DATABASE_EXPORT = \"prefAutomaticDatabaseExport\";\n     private static final String PREF_FAVORITE_EXPORT = \"prefFavoritesExport\";\n     private static final String DEFAULT_OPML_OUTPUT_NAME = \"antennapod-feeds-%s.opml\";\n     private static final String CONTENT_TYPE_OPML = \"text/x-opml\";\n@@ -88,6 +92,8 @@ public class ImportExportPreferencesFragment extends PreferenceFragmentCompat {\n                     startActivity(intent);\n                 }\n             });\n+    private final ActivityResultLauncher<Uri> automaticBackupLauncher =\n+            registerForActivityResult(new PickWritableFolder(), this::setupAutomaticBackup);\n \n     private Disposable disposable;\n     private ProgressDialog progressDialog;\n@@ -143,7 +149,26 @@ private void setupStorageScreen() {\n                 });\n         findPreference(PREF_DATABASE_EXPORT).setOnPreferenceClickListener(\n                 preference -> {\n-                    exportDatabase();\n+                    backupDatabaseLauncher.launch(dateStampFilename(DATABASE_EXPORT_FILENAME));\n+                    return true;\n+                });\n+        ((SwitchPreferenceCompat) findPreference(PREF_AUTOMATIC_DATABASE_EXPORT))\n+                .setChecked(UserPreferences.getAutomaticExportFolder() != null);\n+        findPreference(PREF_AUTOMATIC_DATABASE_EXPORT).setOnPreferenceChangeListener(\n+                (preference, newValue) -> {\n+                    if (Boolean.TRUE.equals(newValue)) {\n+                        try {\n+                            automaticBackupLauncher.launch(null);\n+                        } catch (ActivityNotFoundException e) {\n+                            e.printStackTrace();\n+                            Snackbar.make(getView(), R.string.unable_to_start_system_file_manager, Snackbar.LENGTH_LONG)\n+                                    .show();\n+                        }\n+                        return false;\n+                    } else {\n+                        UserPreferences.setAutomaticExportFolder(null);\n+                        AutomaticDatabaseExportWorker.enqueueIfNeeded(getContext(), false);\n+                    }\n                     return true;\n                 });\n         findPreference(PREF_FAVORITE_EXPORT).setOnPreferenceClickListener(\n@@ -157,10 +182,6 @@ private String dateStampFilename(String fname) {\n         return String.format(fname, new SimpleDateFormat(\"yyyy-MM-dd\", Locale.US).format(new Date()));\n     }\n \n-    private void exportDatabase() {\n-        backupDatabaseLauncher.launch(dateStampFilename(DATABASE_EXPORT_FILENAME));\n-    }\n-\n     private void importDatabase() {\n         // setup the alert builder\n         MaterialAlertDialogBuilder builder = new MaterialAlertDialogBuilder(getActivity());\n@@ -330,6 +351,17 @@ private void writeToStream(OutputStream outputStream, Export type) throws IOExce\n         }\n     }\n \n+    private void setupAutomaticBackup(Uri uri) {\n+        if (uri == null) {\n+            return;\n+        }\n+        getActivity().getContentResolver().takePersistableUriPermission(uri,\n+                Intent.FLAG_GRANT_READ_URI_PERMISSION | Intent.FLAG_GRANT_WRITE_URI_PERMISSION);\n+        UserPreferences.setAutomaticExportFolder(uri.toString());\n+        AutomaticDatabaseExportWorker.enqueueIfNeeded(getContext(), true);\n+        ((SwitchPreferenceCompat) findPreference(PREF_AUTOMATIC_DATABASE_EXPORT)).setChecked(true);\n+    }\n+\n     private static class BackupDatabase extends ActivityResultContracts.CreateDocument {\n \n         BackupDatabase() {\n@@ -345,6 +377,15 @@ public Intent createIntent(@NonNull final Context context, @NonNull final String\n         }\n     }\n \n+    private static class PickWritableFolder extends ActivityResultContracts.OpenDocumentTree {\n+        @NonNull\n+        @Override\n+        public Intent createIntent(@NonNull final Context context, @Nullable final Uri input) {\n+            return super.createIntent(context, input)\n+                    .addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION | Intent.FLAG_GRANT_WRITE_URI_PERMISSION);\n+        }\n+    }\n+\n     private enum Export {\n         OPML(CONTENT_TYPE_OPML, DEFAULT_OPML_OUTPUT_NAME, R.string.opml_export_label),\n         HTML(CONTENT_TYPE_HTML, DEFAULT_HTML_OUTPUT_NAME, R.string.html_export_label),\ndiff --git a/app/src/main/res/xml/preferences_import_export.xml b/app/src/main/res/xml/preferences_import_export.xml\nindex 383bff1175..789c8c2161 100644\n--- a/app/src/main/res/xml/preferences_import_export.xml\n+++ b/app/src/main/res/xml/preferences_import_export.xml\n@@ -9,6 +9,11 @@\n                 search:keywords=\"@string/import_export_search_keywords\"\n                 android:title=\"@string/database_export_label\"\n                 android:summary=\"@string/database_export_summary\"/>\n+        <SwitchPreferenceCompat\n+                android:key=\"prefAutomaticDatabaseExport\"\n+                android:title=\"@string/automatic_database_export_label\"\n+                android:summary=\"@string/automatic_database_export_summary\"\n+                android:defaultValue=\"false\" />\n         <Preference\n                 android:key=\"prefDatabaseImport\"\n                 search:keywords=\"@string/import_export_search_keywords\"\ndiff --git a/storage/importexport/build.gradle b/storage/importexport/build.gradle\nindex ddbbd19519..ae1faa284a 100644\n--- a/storage/importexport/build.gradle\n+++ b/storage/importexport/build.gradle\n@@ -8,14 +8,20 @@ android {\n }\n \n dependencies {\n+    implementation project(':event')\n     implementation project(':storage:database')\n     implementation project(':storage:preferences')\n     implementation project(':ui:i18n')\n+    implementation project(':ui:notifications')\n     implementation project(':model')\n \n     annotationProcessor \"androidx.annotation:annotation:$annotationVersion\"\n+    implementation \"androidx.core:core:$coreVersion\"\n+    implementation 'androidx.documentfile:documentfile:1.0.1'\n+    implementation \"androidx.work:work-runtime:$workManagerVersion\"\n+\n     implementation \"commons-io:commons-io:$commonsioVersion\"\n     implementation \"io.reactivex.rxjava2:rxandroid:$rxAndroidVersion\"\n     implementation \"io.reactivex.rxjava2:rxjava:$rxJavaVersion\"\n-    implementation 'androidx.documentfile:documentfile:1.0.1'\n+    implementation \"org.greenrobot:eventbus:$eventbusVersion\"\n }\ndiff --git a/storage/importexport/src/main/java/de/danoeh/antennapod/storage/importexport/AutomaticDatabaseExportWorker.java b/storage/importexport/src/main/java/de/danoeh/antennapod/storage/importexport/AutomaticDatabaseExportWorker.java\nnew file mode 100644\nindex 0000000000..6002c3bba0\n--- /dev/null\n+++ b/storage/importexport/src/main/java/de/danoeh/antennapod/storage/importexport/AutomaticDatabaseExportWorker.java\n@@ -0,0 +1,127 @@\n+package de.danoeh.antennapod.storage.importexport;\n+\n+import android.Manifest;\n+import android.app.Notification;\n+import android.app.NotificationManager;\n+import android.app.PendingIntent;\n+import android.content.Context;\n+import android.content.Intent;\n+import android.content.pm.PackageManager;\n+import android.net.Uri;\n+import android.os.Build;\n+import androidx.annotation.NonNull;\n+import androidx.core.app.NotificationCompat;\n+import androidx.core.content.ContextCompat;\n+import androidx.documentfile.provider.DocumentFile;\n+import androidx.work.ExistingPeriodicWorkPolicy;\n+import androidx.work.PeriodicWorkRequest;\n+import androidx.work.WorkManager;\n+import androidx.work.Worker;\n+import androidx.work.WorkerParameters;\n+import de.danoeh.antennapod.event.MessageEvent;\n+import de.danoeh.antennapod.storage.preferences.UserPreferences;\n+import de.danoeh.antennapod.ui.notifications.NotificationUtils;\n+import java.io.IOException;\n+import java.text.SimpleDateFormat;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.Date;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Locale;\n+import java.util.concurrent.TimeUnit;\n+import org.greenrobot.eventbus.EventBus;\n+\n+public class AutomaticDatabaseExportWorker extends Worker {\n+    private static final String WORK_ID_AUTOMATIC_DATABASE_EXPORT = \"de.danoeh.antennapod.AutomaticDbExport\";\n+\n+    public static void enqueueIfNeeded(Context context, boolean replace) {\n+        if (UserPreferences.getAutomaticExportFolder() == null) {\n+            WorkManager.getInstance(context).cancelUniqueWork(WORK_ID_AUTOMATIC_DATABASE_EXPORT);\n+        } else {\n+            PeriodicWorkRequest workRequest = new PeriodicWorkRequest.Builder(\n+                        AutomaticDatabaseExportWorker.class, 1, TimeUnit.DAYS)\n+                    .build();\n+            WorkManager.getInstance(context).enqueueUniquePeriodicWork(WORK_ID_AUTOMATIC_DATABASE_EXPORT,\n+                    replace ? ExistingPeriodicWorkPolicy.REPLACE : ExistingPeriodicWorkPolicy.KEEP, workRequest);\n+        }\n+    }\n+\n+    public AutomaticDatabaseExportWorker(@NonNull Context context, @NonNull WorkerParameters params) {\n+        super(context, params);\n+    }\n+\n+    @Override\n+    @NonNull\n+    public Result doWork() {\n+        String folderUri = UserPreferences.getAutomaticExportFolder();\n+        if (folderUri == null) {\n+            return Result.success();\n+        }\n+        try {\n+            export(folderUri);\n+            return Result.success();\n+        } catch (IOException e) {\n+            showErrorNotification(e);\n+            return Result.failure();\n+        }\n+    }\n+\n+    private void export(String folderUri) throws IOException {\n+        DocumentFile documentFolder = DocumentFile.fromTreeUri(getApplicationContext(), Uri.parse(folderUri));\n+        if (documentFolder == null || !documentFolder.exists() || !documentFolder.canWrite()) {\n+            throw new IOException(\"Unable to open export folder\");\n+        }\n+        String filename = String.format(\"AntennaPodBackup-%s.db\",\n+                new SimpleDateFormat(\"yyyy-MM-dd\", Locale.US).format(new Date()));\n+        DocumentFile exportFile = documentFolder.createFile(\"application/x-sqlite3\", filename);\n+        if (exportFile == null || !exportFile.canWrite()) {\n+            throw new IOException(\"Unable to create export file\");\n+        }\n+        DatabaseExporter.exportToDocument(exportFile.getUri(), getApplicationContext());\n+        List<DocumentFile> files = new ArrayList<>(Arrays.asList(documentFolder.listFiles()));\n+        Iterator<DocumentFile> itr = files.iterator();\n+        while (itr.hasNext()) {\n+            DocumentFile file = itr.next();\n+            if (!file.getName().startsWith(\"AntennaPod\")) {\n+                itr.remove();\n+            }\n+        }\n+        Collections.sort(files, (o1, o2) -> Long.compare(o2.lastModified(), o1.lastModified()));\n+        for (int i = 5; i < files.size(); i++) {\n+            files.get(i).delete();\n+        }\n+    }\n+\n+    private void showErrorNotification(Exception exception) {\n+        final String description = getApplicationContext().getString(R.string.automatic_database_export_error)\n+                + \" \" + exception.getMessage();\n+        if (EventBus.getDefault().hasSubscriberForEvent(MessageEvent.class)) {\n+            EventBus.getDefault().post(new MessageEvent(description));\n+            return;\n+        }\n+\n+        Intent intent = getApplicationContext().getPackageManager().getLaunchIntentForPackage(\n+                getApplicationContext().getPackageName());\n+        PendingIntent pendingIntent = PendingIntent.getActivity(getApplicationContext(),\n+                R.id.pending_intent_backup_error, intent, PendingIntent.FLAG_UPDATE_CURRENT\n+                        | (Build.VERSION.SDK_INT >= 23 ? PendingIntent.FLAG_IMMUTABLE : 0));\n+        Notification notification = new NotificationCompat.Builder(getApplicationContext(),\n+                        NotificationUtils.CHANNEL_ID_SYNC_ERROR)\n+                .setContentTitle(getApplicationContext().getString(R.string.automatic_database_export_error))\n+                .setContentText(exception.getMessage())\n+                .setStyle(new NotificationCompat.BigTextStyle().bigText(description))\n+                .setContentIntent(pendingIntent)\n+                .setSmallIcon(R.drawable.ic_notification_sync_error)\n+                .setAutoCancel(true)\n+                .setVisibility(NotificationCompat.VISIBILITY_PUBLIC)\n+                .build();\n+        NotificationManager nm = (NotificationManager) getApplicationContext()\n+                .getSystemService(Context.NOTIFICATION_SERVICE);\n+        if (ContextCompat.checkSelfPermission(getApplicationContext(), Manifest.permission.POST_NOTIFICATIONS)\n+                == PackageManager.PERMISSION_GRANTED) {\n+            nm.notify(R.id.notification_id_backup_error, notification);\n+        }\n+    }\n+}\ndiff --git a/storage/importexport/src/main/res/values/ids.xml b/storage/importexport/src/main/res/values/ids.xml\nnew file mode 100644\nindex 0000000000..7e973d82ac\n--- /dev/null\n+++ b/storage/importexport/src/main/res/values/ids.xml\n@@ -0,0 +1,5 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<resources>\n+    <item name=\"pending_intent_backup_error\" type=\"id\" />\n+    <item name=\"notification_id_backup_error\" type=\"id\" />\n+</resources>\ndiff --git a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\nindex a424936928..f2baf1242b 100644\n--- a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n+++ b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n@@ -114,6 +114,7 @@ private UserPreferences(){}\n     // Other\n     private static final String PREF_DATA_FOLDER = \"prefDataFolder\";\n     public static final String PREF_DELETE_REMOVES_FROM_QUEUE = \"prefDeleteRemovesFromQueue\";\n+    private static final String PREF_AUTOMATIC_EXPORT_FOLDER = \"prefAutomaticExportFolder\";\n \n     // Mediaplayer\n     private static final String PREF_PLAYBACK_SPEED = \"prefPlaybackSpeed\";\n@@ -282,6 +283,15 @@ public static void setShowRemainTimeSetting(Boolean showRemain) {\n         prefs.edit().putBoolean(PREF_SHOW_TIME_LEFT, showRemain).apply();\n     }\n \n+    @Nullable\n+    public static String getAutomaticExportFolder() {\n+        return prefs.getString(PREF_AUTOMATIC_EXPORT_FOLDER, null);\n+    }\n+\n+    public static void setAutomaticExportFolder(@Nullable String folder) {\n+        prefs.edit().putString(PREF_AUTOMATIC_EXPORT_FOLDER, folder).apply();\n+    }\n+\n     /**\n      * Returns notification priority.\n      *\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex b07d6c45f3..964b85c77b 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -579,6 +579,9 @@\n     <string name=\"opml_export_label\">OPML export</string>\n     <string name=\"html_export_label\">HTML export</string>\n     <string name=\"database_export_label\">Database export</string>\n+    <string name=\"automatic_database_export_label\">Automatic database export</string>\n+    <string name=\"automatic_database_export_summary\">Automatically create daily backups of the AntennaPod database</string>\n+    <string name=\"automatic_database_export_error\">Error during automatic database backup</string>\n     <string name=\"database_import_label\">Database import</string>\n     <string name=\"database_import_warning\">Importing a database will replace all of your current subscriptions and playing history. You should export your current database as a backup. Do you want to replace?</string>\n     <string name=\"please_wait\">Please wait&#8230;</string>\n", "test_patch": "", "problem_statement": "Automatic backup/export functionality\n# Checklist\r\n\r\n- [x] I have used the search function to see if someone else has already submitted the same feature request.\r\n- [x] I will only create one feature request per issue.\r\n- [x] I will describe the problem with as much detail as possible.\r\n\r\n# System info\r\n\r\n**App version**: 2.1.1\r\n\r\n**App source**: Aurora Store (identical Google Play)\r\n\r\n# Feature description\r\n\r\n**Problem you may be having, or feature you want**:\r\nSince gpodder sync is the only supported sync, and since the gpodder website is mostly down all the time, I'm looking for a way to make scheduled backups (exports) of my subscriptions to the SD-Card.\r\n\r\n**Suggested solution**:\r\nAdd a schedule option for the Database Export or the OPML Export to allow export it automatically every day/weeks/months.\r\nIdeally it would be great to be able to automatically export to some cloud storage providers, like ownCloud / NextCloud / Google Drive / Dropbox, but being able to export to the SD-Card would be enough for me.\r\n\r\nThanks\r\n\n", "hints_text": "Yes, I love this idea.  Instead of regularly scheduled, if you don't open the app for 30 days, I assume nothing has changed and you don't need to backup?\n\nI think exporting to SD or local storage is a good start.  I would like to do a full backup instead of just the opml\nGood point, that's true that if I don't open the App then it's safe to assume that there's nothing to backup.\r\n\r\nI agree with the full backup (I thought that OPML was kind of a full backup, just a different format).\r\n\r\nIdeally we would want to be able to select to either export to a static name, meaning that it would override the previous backup, or to export with a dynamic name that contains the date/time of the export (i.e. /sdcard/backups/Antennapod/antennapod_<YYYYMMDD_HHMMSS>.ext), and eventually be able to configure how many backups we want to keep so it automatically deletes the oldest ones.\r\n\nA similar issue is bring talked about here #1899 for auto backup\nStarting with Android 11, we can no longer simply store data on the sd card. So unfortunately, this feature needs to show a folder select screen (like the new local feeds feature) and needs to be enabled manually. Signal messenger does something similar. I don't know how WhatsApp deals with automatic backups on Android 11.\ni came here because i had a similar idea. don't know if it's the same?\r\nnextcloud has a new app called \"podcasts\", but it's still in it's early days.\r\nhttps://git.project-insanity.org/onny/nextcloud-app-podcast/-/issues/103\r\nit would be nice if antennapod would have a function which allows us to sync with nextcloud or other cloud-services (why just gpodder?)\r\nis it technically possible to sync both? is it the same format?\r\nthen the backup-functionallity could work like this: the podcast-backup could be made through the nextcloud app somehow and stored in nextcloud somewhere.\r\nthese projects should inspire each other!\nHi @moagee \nThanks for chipping in :)\nWe're aware of this new app and - you have seen my comment in the app's repo - are interested in cooperating with them on getting the integration working (it's possible but needs work from both sides).\n\nThis issue (4850) is about frequent (e.g. weekly) full database dumps (aka backups). The sync that you described above falls under #421.\n\n> Starting with Android 11, we can no longer simply store data on the sd card. So unfortunately, this feature needs to show a folder select screen (like the new local feeds feature) and needs to be enabled manually.\n\nTo be honest I don't see it as a massive drawback. This is fairly easy from a user perspective, and those unfamiliar can be informed with an occasional snackbar/modal similar to how the review request is implemented.\nAnd until this setting is set we could do a backup in the app's own folder (or does that not make sense?).\nI think doing backup in the app's folder regularly makes sense, if the user removes the app, the backups is gone though.\n\nDoing a weekly reminder to backup to external, which will have to ask the user to open the folder to store a backup seems reasonable and I would appreciate as a user\n> Doing a weekly reminder to backup to external, which will have to ask the user to open the folder to store a backup seems reasonable and I would appreciate as a user\n\nDoes it have to be weekly once the user gave the permission? I.e. the permission/location wouldn't be permanent (so we could overwrite the file)?\n> those unfamiliar can be informed with an occasional snackbar/modal\r\n\r\nHmm... A big advantage of AntennaPod is that we do not nag the users too much. I don't really like the idea of adding more user interruption.\r\n\r\n> Does it have to be weekly once the user gave the permission? I.e. the permission/location wouldn't be permanent (so we could overwrite the file)?\r\n\r\nIt can be permanent\nSaving a database backup on a daily basis to the episode storage location would work great for my use case. That way I could just set up automatic sync for the whole directory to my NAS for safe keeping.\n> That way I could just set up automatic sync for the whole directory\r\n\r\nStarting with Android 11, that directory can no longer be accessed, apparently.\n> Starting with Android 11, that directory can no longer be accessed, apparently.\r\n\r\nAh. I'm still stuck on 9, so I haven't run into that. Still, I'd *like* to be able to backup the downloaded files along with the database, so perhaps a solution to that problem would be to allow the data directory itself to be stored outside of `Android/data` (requesting the appropriate storage permissions if and only if the user wants to do that).\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/should-gpodder-net-be-supported-long-term/396/27\n\nRelated: #5099\nGiven @ByteHamster's comment in #2463\u2026\n> I'm pretty much out of ideas here. A rather similar issue seems to happen in K-9 Mail. Maybe corrupted databases are just a thing that occasionally happens when running an app on thousands of devices?\n\n\u2026 I think it would make sense to implement some form of regular local full database back-ups. If we need to ask the user permission once to write to a specific folder, then so be it. Indeed Signal has a nice UX for backups.\nI'm not an expert so I don't know if and how you can do it, but I'd like some kind of automatic backup too :-) \r\nI just lost every AntennaPod subscription and settings (my fault), so an automatic backup would be great\nAutomatic database export would be a killer feature since:\n\n1. No everyone has a nextcloud server\n2. Gpodder is often inaccessible\n\nAn example of a nice backup UX is aegis authenticator, where the user sets up a folder with permission, and the database is exported every defined period of time, with option to keep only a certain number of backups named with date and time.\n\nThis way the we can manually copy this file to another device or set up an automatic syncing with syncthing or foldersync or whatever way is convenient for each person to keep it safe and in hand.\n\nThis would make switching devices basically effortless and would really add to the comfort of using antennapod.\n\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/where-can-i-find-db-files-and-opml-files-after-weird-crash/2401/7\n\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/automated-generation-of-backup-data-not-sync/2322/3\n\nSeconding this one (as I assume nobody would even notice if I simply upvoted)\r\n\r\nI could basically just copy paste @ahmuro 's post since they've got everything right, down to a tee.\r\n\r\nAegis's auto backup feature works beautifully (PS: and also with Android 11)\n> Seconding this one (as I assume nobody would even notice if I simply upvoted)\n\nWe would - in some sessions we sort GH tickets by upvotes. Giving a thumbs-up gives more weight to your opinion than a '+1' message.\n\n> Aegis's auto backup feature works beautifully (PS: and also with Android 11)\n\nFor others that don't have it: they allow 'automatic backups when the vault is changed ', have you select a folder for back-up and a setting 'Umber of versions to keep'. Especially the latter would be a welcome addition \u2013 not sure how they do it, though.\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/scheduling-local-online-auto-app-data-backups/2127/3\n\nAutomatic backup to Google Drive would be great. My phone recently broke and I lost my queue and played episodes. \ud83d\ude1e", "created_at": "2024-03-16T20:37:08Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6975, "instance_id": "AntennaPod__AntennaPod-6975", "issue_numbers": ["6601"], "base_commit": "aaf225c7aff4e204c46f5a12663d097b967626cb", "patch": "diff --git a/build.gradle b/build.gradle\nindex 4afbb3803e..8261587ef1 100644\n--- a/build.gradle\n+++ b/build.gradle\n@@ -27,7 +27,7 @@ project.ext {\n     commonsioVersion = \"2.5\"\n     jsoupVersion = \"1.15.1\"\n     glideVersion = \"4.13.2\"\n-    okhttpVersion = \"3.12.10\"\n+    okhttpVersion = \"4.12.0\"\n     eventbusVersion = \"3.3.1\"\n     rxAndroidVersion = \"2.1.1\"\n     rxJavaVersion = \"2.2.2\"\n", "test_patch": "", "problem_statement": "Upgrade to OkHttp4\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.1.0-develop\n\n### Where did you get the app from\n\nOther\n\n### Problem you may be having, or feature you want\n\nAt some point, we need to switch to AndroidX Media3. Media3 uses OkHttp4, so if we include Media3, we get a version conflict.\n\n### Suggested solution\n\nUpgrade our use of OkHttp3 to OkHttp4.\n\n### Screenshots / Drawings / Technical details\n\n@TacoTheDank are you maybe interested in doing this?\n", "hints_text": "@ByteHamster I don't think I'll have much time to do this, especially if I'll have to debug a bunch of stuff, but I might take a look. No promises, though. You might be better off not waiting on me.\n> @ByteHamster I don't think I'll have much time to do this, especially if I'll have to debug a bunch of stuff, but I might take a look. No promises, though. You might be better off not waiting on me.\r\n\r\nI am interested in tackling this if no one else takes it.l\n@tonytamsf Go ahead, it's all yours!", "created_at": "2024-03-09T18:07:55Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6966, "instance_id": "AntennaPod__AntennaPod-6966", "issue_numbers": ["6896"], "base_commit": "22f36bc9c0dccbb056994833ce078024772d9a51", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/export/opml/OpmlReader.java b/core/src/main/java/de/danoeh/antennapod/core/export/opml/OpmlReader.java\nindex a17fedd7d4..2ecaafbe13 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/export/opml/OpmlReader.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/export/opml/OpmlReader.java\n@@ -1,5 +1,6 @@\n package de.danoeh.antennapod.core.export.opml;\n \n+import android.text.TextUtils;\n import android.util.Log;\n \n import org.xmlpull.v1.XmlPullParser;\n@@ -53,7 +54,7 @@ public ArrayList<OpmlElement> readDocument(Reader reader)\n \t\t\t\t\tOpmlElement element = new OpmlElement();\n \t\t\t\t\t\n \t\t\t\t\tfinal String title = xpp.getAttributeValue(null, OpmlSymbols.TITLE);\n-\t\t\t\t\tif (title != null) {\n+\t\t\t\t\tif (!TextUtils.isEmpty(title)) {\n \t\t\t\t\t\tLog.i(TAG, \"Using title: \" + title);\n \t\t\t\t\t\telement.setText(title);\n \t\t\t\t\t} else {\n@@ -63,8 +64,8 @@ public ArrayList<OpmlElement> readDocument(Reader reader)\n \t\t\t\t\telement.setXmlUrl(xpp.getAttributeValue(null, OpmlSymbols.XMLURL));\n \t\t\t\t\telement.setHtmlUrl(xpp.getAttributeValue(null, OpmlSymbols.HTMLURL));\n \t\t\t\t\telement.setType(xpp.getAttributeValue(null, OpmlSymbols.TYPE));\n-\t\t\t\t\tif (element.getXmlUrl() != null) {\n-\t\t\t\t\t\tif (element.getText() == null) {\n+\t\t\t\t\tif (!TextUtils.isEmpty(element.getXmlUrl())) {\n+\t\t\t\t\t\tif (!TextUtils.isEmpty(element.getText())) {\n \t\t\t\t\t\t\tLog.i(TAG, \"Opml element has no text attribute.\");\n \t\t\t\t\t\t\telement.setText(element.getXmlUrl());\n \t\t\t\t\t\t}\n", "test_patch": "", "problem_statement": "OPML file containing podcast without title or URL makes it impossible to subscribe to further podcasts\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.2.0 (58081fe5b) \n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\nAndroid 13 (OS version: 4.19.157-perf-g9d90dd04aa7c) \n\n### Device model\n\nModel: M2012K11AG Device: alioth Product: alioth_global\n\n### First occurred\n\nabout two weeks ago \n\n### Steps to reproduce\n\n1. I open the App, search for the podcast I want to subscribe to.\r\n2. Find the show/podcast in the search results. \r\n3. Clicks on the Subscribe button to subscribe to the podcast. \r\n4. The App Crashes and closes \r\n5. I repeat again and same results every time. \r\n\n\n### Expected behaviour\n\nI would expect AntennaPod to work normally. Search for a show, click subscribe. \n\n### Current behaviour\n\nit crashed every time I try to subscribe to podcast. \n\n### Logs\n\n## Environment\r\nAndroid version: 13\r\nOS version: 4.19.157-perf-g9d90dd04aa7c\r\nAntennaPod version: 3.2.0\r\nModel: M2012K11AG\r\nDevice: alioth\r\nProduct: alioth_global\r\n\r\n## Crash info\r\nTime: 24-01-2024 23:05:41\r\nAntennaPod version: 3.2.0\r\n\r\n## StackTrace\r\n```\r\njava.lang.NullPointerException: Attempt to invoke virtual method 'boolean java.lang.String.equals(java.lang.Object)' on a null object reference\r\n\tat de.danoeh.antennapod.core.storage.DBTasks.searchFeedByIdentifyingValueOrID(DBTasks.java:148)\r\n\tat de.danoeh.antennapod.core.storage.DBTasks.updateFeed(DBTasks.java:205)\r\n\tat de.danoeh.antennapod.activity.OnlineFeedViewActivity.lambda$showFeedInformation$12(OnlineFeedViewActivity.java:454)\r\n\tat de.danoeh.antennapod.activity.OnlineFeedViewActivity.$r8$lambda$hi785Ed59_1ny6L2vpKQJxreomE(OnlineFeedViewActivity.java:0)\r\n\tat de.danoeh.antennapod.activity.OnlineFeedViewActivity$$ExternalSyntheticLambda5.onClick(R8$$SyntheticClass:0)\r\n\tat android.view.View.performClick(View.java:7544)\r\n\tat com.google.android.material.button.MaterialButton.performClick(MaterialButton.java:1219)\r\n\tat android.view.View.performClickInternal(View.java:7521)\r\n\tat android.view.View.-$$Nest$mperformClickInternal(Unknown Source:0)\r\n\tat android.view.View$PerformClick.run(View.java:29555)\r\n\tat android.os.Handler.handleCallback(Handler.java:942)\r\n\tat android.os.Handler.dispatchMessage(Handler.java:99)\r\n\tat android.os.Looper.loopOnce(Looper.java:210)\r\n\tat android.os.Looper.loop(Looper.java:299)\r\n\tat android.app.ActivityThread.main(ActivityThread.java:8261)\r\n\tat java.lang.reflect.Method.invoke(Native Method)\r\n\tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:559)\r\n\tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:954)\r\n```\r\n\n", "hints_text": "It is possible this particular feed has poor formatting and AP is not handling it correctly.  Which feed/podcast were you searching for? @AlbertKents \n> It is possible this particular feed has poor formatting and AP is not handling it correctly. Which feed/podcast were you searching for? @AlbertKents\r\n\r\nAt first I thought the same. So I tried subscribing to several podcasts but still getting the same crash issue every time. For almost two weeks now.\nCould you still share (some of) the feeds that you're trying to subscribe to @AlbertKents? We're not experiencing this issue, and if we can't reproduce it'll be hard to fix.\nThe stacktrace looks like you somehow ended up being subscribed to a feed that has no guid, no title, no website link, and not even an RSS url. Have you ever exported your database and modified it in any way?\nI am experiencing the exact same issue. Clean Antennapod install, subscribing to first podcast from search\r\n\r\nAntennapod 3.2.0 (58081fe5b)\r\nPhone: Pixel 7a\r\nOS version: Android 14 (UQ1A.240105.004)\r\n\r\n```\r\nFATAL EXCEPTION: main\r\nProcess: de.danoeh.antennapod, PID: 18407\r\njava.lang.NullPointerException: Attempt to invoke virtual method 'boolean java.lang.String.equals(java.lang.Object)' on a null object reference\r\n\tat de.danoeh.antennapod.core.storage.DBTasks.searchFeedByIdentifyingValueOrID(DBTasks.java:148)\r\n\tat de.danoeh.antennapod.core.storage.DBTasks.updateFeed(DBTasks.java:205)\r\n\tat de.danoeh.antennapod.activity.OnlineFeedViewActivity.lambda$showFeedInformation$12(OnlineFeedViewActivity.java:454)\r\n\tat de.danoeh.antennapod.activity.OnlineFeedViewActivity.$r8$lambda$hi785Ed59_1ny6L2vpKQJxreomE(OnlineFeedViewActivity.java:0)\r\n\tat de.danoeh.antennapod.activity.OnlineFeedViewActivity$$ExternalSyntheticLambda5.onClick(R8$$SyntheticClass:0)\r\n\tat android.view.View.performClick(View.java:7658)\r\n\tat com.google.android.material.button.MaterialButton.performClick(MaterialButton.java:1219)\r\n\tat android.view.View.performClickInternal(View.java:7635)\r\n\tat android.view.View.-$$Nest$mperformClickInternal(Unknown Source:0)\r\n\tat android.view.View$PerformClick.run(View.java:30167)\r\n\tat android.os.Handler.handleCallback(Handler.java:958)\r\n\tat android.os.Handler.dispatchMessage(Handler.java:99)\r\n\tat android.os.Looper.loopOnce(Looper.java:205)\r\n\tat android.os.Looper.loop(Looper.java:294)\r\n\tat android.app.ActivityThread.main(ActivityThread.java:8248)\r\n\tat java.lang.reflect.Method.invoke(Native Method)\r\n\tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:552)\r\n\tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:971) \r\n```\r\n\r\nPodcast for this crash is ADSP (https://adspthepodcast.com/)\r\n\r\nI get similar error when attempting to import OPML file exported from Google Podcasts via Takeout. The app doesn't close in this case though - just pops the error\r\n\r\n```\r\n01-29 21:15:27.108 18407 18407 W System.err: java.lang.NullPointerException: Attempt to invoke virtual method 'boolean java.lang.String.equals(java.lang.Object)' on a null object reference\r\n01-29 21:15:27.111 18407 18407 W System.err:    at de.danoeh.antennapod.core.storage.DBTasks.searchFeedByIdentifyingValueOrID(DBTasks.java:148)\r\n01-29 21:15:27.111 18407 18407 W System.err:    at de.danoeh.antennapod.core.storage.DBTasks.updateFeed(DBTasks.java:205)\r\n01-29 21:15:27.111 18407 18407 W System.err:    at de.danoeh.antennapod.activity.OpmlImportActivity.lambda$onCreate$2(OpmlImportActivity.java:102)\r\n01-29 21:15:27.111 18407 18407 W System.err:    at de.danoeh.antennapod.activity.OpmlImportActivity.$r8$lambda$wRc0Agyx9b5bQ_M-2soLqtejhQM(OpmlImportActivity.java:0)\r\n01-29 21:15:27.111 18407 18407 W System.err:    at de.danoeh.antennapod.activity.OpmlImportActivity$$ExternalSyntheticLambda10.run(R8$$SyntheticClass:0)\r\n01-29 21:15:27.112 18407 18407 W System.err:    at io.reactivex.internal.operators.completable.CompletableFromAction.subscribeActual(CompletableFromAction.java:34)\r\n01-29 21:15:27.112 18407 18407 W System.err:    at io.reactivex.Completable.subscribe(Completable.java:2302)\r\n01-29 21:15:27.112 18407 18407 W System.err:    at io.reactivex.internal.operators.completable.CompletableSubscribeOn$SubscribeOnObserver.run(CompletableSubscribeOn.java:64)\r\n01-29 21:15:27.112 18407 18407 W System.err:    at io.reactivex.Scheduler$DisposeTask.run(Scheduler.java:578)\r\n01-29 21:15:27.112 18407 18407 W System.err:    at io.reactivex.internal.schedulers.ScheduledRunnable.run(ScheduledRunnable.java:66)\r\n01-29 21:15:27.112 18407 18407 W System.err:    at io.reactivex.internal.schedulers.ScheduledRunnable.call(ScheduledRunnable.java:57)\r\n01-29 21:15:27.112 18407 18407 W System.err:    at java.util.concurrent.FutureTask.run(FutureTask.java:264)\r\n01-29 21:15:27.112 18407 18407 W System.err:    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:307)\r\n01-29 21:15:27.112 18407 18407 W System.err:    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\r\n01-29 21:15:27.112 18407 18407 W System.err:    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:644)\r\n01-29 21:15:27.112 18407 18407 W System.err:    at java.lang.Thread.run(Thread.java:1012)\r\n```\r\n\r\nThe OPML file imports fine in e.g. Pocket Casts, so I assume a non-corrupted file.\r\n\nHi @monzool \n\n> subscribing to first podcast from search\n> Podcast for this crash is ADSP (https://adspthepodcast.com/)\n\nI searched for this podcast in AntennaPod but can't find it:\n![Screenshot_20240129-214213.png](https://github.com/AntennaPod/AntennaPod/assets/11229646/33953168-03ac-4241-9176-14be88551905)\n\nCan you please copy/paste the exact search text you enter?\n\n>  get similar error when attempting to import OPML file exported from Google Podcasts via Takeout\n\nIs that OPML something you would be willing to share? If not publicly, to one of us individually? Then we can investigate if there's any issues with the formatting of the file. (The file may still be 'broken' if Pocket Casts built in methods to catch the errors and ignore or work around them.)\n>Can you please copy/paste the exact search text you enter?\r\n\r\nYes, certainly. And sorry - I shouldn't have provided the abbreviated name. The exact name of the podcast is \"Algorithms + Data Structures = Programs\". I enter just \"algorithms\" in the search box to find it\r\n\r\nYou are right about the OPML of course. Have extended the test to Pocket Casts, Podcast Addict and Podverse which all imports the OPML (however with different resulting number of imports). I can share the file to you\nThanks @monzool.\n\n> The exact name of the podcast is \"Algorithms + Data Structures = Programs\". I enter just \"algorithms\" in the search box to find it\n\nI can subscribe to that one (https://feeds.buzzsprout.com/1501960.rss) just fine. Did you say you tried this from a completely clean install, or did you already have subscriptions? And what if you try to add the above feed \u2013 same problem?\n\n> You are right about the OPML of course. Have extended the test to Pocket Casts, Podcast Addict and Podverse which all imports the OPML (however with different resulting number of imports). I can share the file to you\n\nHmm, the different number of imports does make me suspect there's something off with the file. If you send it to [my username]@mailbox.org, I can have a look and pass it on to fellow core contributors if needed.\n>I can subscribe to that one ([feeds.buzzsprout.com/1501960.rss](https://feeds.buzzsprout.com/1501960.rss)) just fine\r\n\r\nIf I select _Subscription_ \u2b95 _Add Podcast by RSS address_ \u2b95 _Confirm_ then I get a null pointer exception\r\n\r\n```\r\nFATAL EXCEPTION: main\r\nProcess: de.danoeh.antennapod, PID: 25486\r\njava.lang.NullPointerException: Attempt to invoke virtual method 'boolean java.lang.String.equals(java.lang.Object)' on a null object reference\r\n\tat de.danoeh.antennapod.core.storage.DBTasks.searchFeedByIdentifyingValueOrID(DBTasks.java:148)\r\n\tat de.danoeh.antennapod.core.storage.DBTasks.updateFeed(DBTasks.java:205)\r\n\tat de.danoeh.antennapod.activity.OnlineFeedViewActivity.lambda$showFeedInformation$12(OnlineFeedViewActivity.java:454)\r\n\tat de.danoeh.antennapod.activity.OnlineFeedViewActivity.$r8$lambda$hi785Ed59_1ny6L2vpKQJxreomE(OnlineFeedViewActivity.java:0)\r\n\tat de.danoeh.antennapod.activity.OnlineFeedViewActivity$$ExternalSyntheticLambda5.onClick(R8$$SyntheticClass:0)\r\n\tat android.view.View.performClick(View.java:7658)\r\n\tat com.google.android.material.button.MaterialButton.performClick(MaterialButton.java:1219)\r\n\tat android.view.View.performClickInternal(View.java:7635)\r\n\tat android.view.View.-$$Nest$mperformClickInternal(Unknown Source:0)\r\n\tat android.view.View$PerformClick.run(View.java:30167)\r\n\tat android.os.Handler.handleCallback(Handler.java:958)\r\n\tat android.os.Handler.dispatchMessage(Handler.java:99)\r\n\tat android.os.Looper.loopOnce(Looper.java:205)\r\n\tat android.os.Looper.loop(Looper.java:294)\r\n\tat android.app.ActivityThread.main(ActivityThread.java:8248)\r\n\tat java.lang.reflect.Method.invoke(Native Method)\r\n\tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:552)\r\n\tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:971) \r\n```\r\n\r\n>Did you say you tried this from a completely clean install\r\n\r\nI did - though I installed it some time ago, but only now did I get around to use it. So unused. First action of use was to attempt the OPML import. Then the manual add\r\nBtw I install via F-Droid\n> I did - though I installed it some time ago, but only now did I get around to use it. So unused.\r\n\r\nTry clearing the app data from Android's settings screen first \nSeems it cannot escape comparing on a null object :shrug: \r\n\r\n<table>\r\n<tr>\r\n <td>\r\n <td><strong>Subscribe rss</strong>\r\n <td><strong>Import OPML</strong>\r\n<tr>\r\n <td>Clear app cache\r\n <td><em>NullPointerException</em>\r\n <td><em>NullPointerException</em>\r\n<tr>\r\n <td>Clear app data\r\n <td><em>NullPointerException</em>\r\n <td><em>NullPointerException</em>\r\n<tr>\r\n <td>Reinstall app (Google Play store)\r\n <td><em>NullPointerException</em>\r\n <td><em>NullPointerException</em>\r\n</table>\r\n\nThe feed itself seems fine also (?)\r\nhttps://validator.w3.org/feed/check.cgi?url=feeds.buzzsprout.com%2F1501960.rss\r\nIt's just missing the `itunes:email` element within the `owner` tag, but I guess that shouldn't be a problem.\r\n\r\n@ByteHamster Given a clean install, would it be of any use to have the full logs?\r\n\r\nBTW @monzool Thanks for sending over the OPML file. It seems fine to me, and given that you're also having trouble just adding the RSS, I guess it's unlikely it's the OMPL.\nHmm, I think an interesting thing to see would actually be a database export of your empty AntennaPod database. \n@AlbertKents I looked at the OPML file you sent to @keunes , the first item in the OPML has an empty title and empty url.  Can you manually edit that OPML file to delete line # 8 and see what happens?\r\n\r\n```\r\n <body>\r\n    <outline text='feeds'>\r\n      <outline type='rss' text='' xmlUrl=''/>\r\n      <outline type='rss' text='Algorithms + Data Structures = Programs' xmlUrl='https://feeds.buzzsprout.com/1501960.rss'/>\r\n```\r\n\r\nAlso, I think in your subscriptions there could be a podcast feed with empty title and url, if you Remove that podcast, I hope you will be able to subscribe again\nHere is the way to replicate this problem\r\n\r\n1) Import an opml with a single empty feed\r\n2) This will create a feed that has empty title and url \r\n3) From this point forward, the user can no longer subscribe to any other feeds (crashing the app)\r\n\r\n```\r\n<?xml version='1.0' encoding='utf-8'?>\r\n<opml>\r\n  <head>\r\n    <title>Google Podcasts Subscriptions</title>\r\n  </head>\r\n  <body>\r\n    <outline text='feeds'>\r\n      <outline type='rss' text='' xmlUrl=''/>\r\n    </outline>\r\n  </body>\r\n</opml>\r\n```\n@tonytamsf that was @monzool's OPML file. Thanks for finding the culprit!\n\nI guess in such cases, we should just ignore the empty item when importing? (I.e. skip item if URL is not present. Empty title is fine as it'll be picked up from the feed itself.)\n@ByteHamster Is it worth it to add some defensive code against bad fields in the OPML files?\nYeah, that would be good. Especially considering that it makes the app crash in such a strange way ", "created_at": "2024-03-07T20:27:40Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6958, "instance_id": "AntennaPod__AntennaPod-6958", "issue_numbers": ["6941"], "base_commit": "5e8960f4bcf1bfa98f1fe8adc824cbf6a5a5fbc4", "patch": "diff --git a/.github/workflows/checks.yml b/.github/workflows/checks.yml\nindex d56ec7ace9..9dbfdcf1aa 100644\n--- a/.github/workflows/checks.yml\n+++ b/.github/workflows/checks.yml\n@@ -65,7 +65,7 @@ jobs:\n       - name: Lint :app module recursively\n         run: ./gradlew :app:lintPlayRelease\n       - name: SpotBugs\n-        run: ./gradlew spotbugsPlayDebug spotbugsDebug 2>&1 | grep -i \"spotbugs\"\n+        run: ./gradlew spotbugsPlayDebug spotbugsDebug\n \n   unit-test:\n     name: \"Unit Test: ${{ matrix.variant }}\"\ndiff --git a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\nindex 1baa90d28c..46c62b9f4d 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n@@ -290,7 +290,7 @@ public void setupToolbarToggle(@NonNull MaterialToolbar toolbar, boolean display\n     @Override\n     protected void onDestroy() {\n         super.onDestroy();\n-        if (drawerLayout != null) {\n+        if (drawerLayout != null && drawerToggle != null) {\n             drawerLayout.removeDrawerListener(drawerToggle);\n         }\n     }\n@@ -551,7 +551,7 @@ public boolean onOptionsItemSelected(MenuItem item) {\n \n     @Override\n     public void onBackPressed() {\n-        if (isDrawerOpen()) {\n+        if (isDrawerOpen() && drawerLayout != null) {\n             drawerLayout.closeDrawer(navDrawer);\n         } else if (sheetBehavior.getState() == BottomSheetBehavior.STATE_EXPANDED) {\n             sheetBehavior.setState(BottomSheetBehavior.STATE_COLLAPSED);\ndiff --git a/app/src/main/java/de/danoeh/antennapod/adapter/NavListAdapter.java b/app/src/main/java/de/danoeh/antennapod/adapter/NavListAdapter.java\nindex a304ead3c3..1768283080 100644\n--- a/app/src/main/java/de/danoeh/antennapod/adapter/NavListAdapter.java\n+++ b/app/src/main/java/de/danoeh/antennapod/adapter/NavListAdapter.java\n@@ -341,7 +341,7 @@ private void bindTagView(NavDrawerData.TagDrawerItem tag, FeedHolder holder) {\n         if (context == null) {\n             return;\n         }\n-        if (tag.isOpen) {\n+        if (tag.isOpen()) {\n             holder.count.setVisibility(View.GONE);\n         }\n         Glide.with(context).clear(holder.image);\ndiff --git a/app/src/main/java/de/danoeh/antennapod/dialog/TimeRangeDialog.java b/app/src/main/java/de/danoeh/antennapod/dialog/TimeRangeDialog.java\nindex 85913043ea..1d84c7c22e 100644\n--- a/app/src/main/java/de/danoeh/antennapod/dialog/TimeRangeDialog.java\n+++ b/app/src/main/java/de/danoeh/antennapod/dialog/TimeRangeDialog.java\n@@ -139,8 +139,8 @@ protected void onDraw(Canvas canvas) {\n         }\n \n         protected Point radToPoint(float angle, float radius) {\n-            return new Point((int) (getWidth() / 2 + radius * Math.sin(-angle * Math.PI / 180 + Math.PI)),\n-                    (int) (getHeight() / 2 + radius * Math.cos(-angle * Math.PI / 180 + Math.PI)));\n+            return new Point((int) (getWidth() / 2.0 + radius * Math.sin(-angle * Math.PI / 180.0 + Math.PI)),\n+                    (int) (getHeight() / 2.0 + radius * Math.cos(-angle * Math.PI / 180.0 + Math.PI)));\n         }\n \n         @Override\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/DownloadLogFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/DownloadLogFragment.java\nindex 291de2a50c..34712d428b 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/DownloadLogFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/DownloadLogFragment.java\n@@ -86,9 +86,9 @@ public void onDestroyView() {\n \n     @Override\n     public void onItemClick(AdapterView<?> parent, View view, int position, long id) {\n-        Object item = adapter.getItem(position);\n-        if (item instanceof DownloadResult) {\n-            new DownloadLogDetailsDialog(getContext(), (DownloadResult) item).show();\n+        final DownloadResult item = adapter.getItem(position);\n+        if (item != null) {\n+            new DownloadLogDetailsDialog(getContext(), item).show();\n         }\n     }\n \ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/NavDrawerFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/NavDrawerFragment.java\nindex 636c0245b6..4c3647669b 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/NavDrawerFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/NavDrawerFragment.java\n@@ -359,10 +359,10 @@ public void onItemClick(int position) {\n                                 .setState(BottomSheetBehavior.STATE_COLLAPSED);\n                     } else {\n                         NavDrawerData.TagDrawerItem folder = ((NavDrawerData.TagDrawerItem) clickedItem);\n-                        if (openFolders.contains(folder.name)) {\n-                            openFolders.remove(folder.name);\n+                        if (openFolders.contains(folder.getTitle())) {\n+                            openFolders.remove(folder.getTitle());\n                         } else {\n-                            openFolders.add(folder.name);\n+                            openFolders.add(folder.getTitle());\n                         }\n \n                         getContext().getSharedPreferences(PREF_NAME, Context.MODE_PRIVATE)\n@@ -438,8 +438,8 @@ private List<NavDrawerData.DrawerItem> makeFlatDrawerData(List<NavDrawerData.Dra\n             flatItems.add(item);\n             if (item.type == NavDrawerData.DrawerItem.Type.TAG) {\n                 NavDrawerData.TagDrawerItem folder = ((NavDrawerData.TagDrawerItem) item);\n-                folder.isOpen = openFolders.contains(folder.name);\n-                if (folder.isOpen) {\n+                folder.setOpen(openFolders.contains(folder.getTitle()));\n+                if (folder.isOpen()) {\n                     flatItems.addAll(makeFlatDrawerData(((NavDrawerData.TagDrawerItem) item).children, layer + 1));\n                 }\n             }\ndiff --git a/build.gradle b/build.gradle\nindex 6afa8f74e1..99dd30056d 100644\n--- a/build.gradle\n+++ b/build.gradle\n@@ -4,7 +4,7 @@ buildscript {\n plugins {\n     id 'com.android.application' version \"$agpVersion\" apply false\n     id 'com.android.library' version \"$agpVersion\" apply false\n-    id 'com.github.spotbugs' version '4.7.0' apply false\n+    id 'com.github.spotbugs' version '4.8.0' apply false\n     id 'checkstyle'\n }\n \ndiff --git a/common.gradle b/common.gradle\nindex a2afc72798..97960149bc 100644\n--- a/common.gradle\n+++ b/common.gradle\n@@ -76,6 +76,7 @@ gradle.projectsEvaluated {\n apply plugin: 'com.github.spotbugs'\n \n spotbugs {\n+    toolVersion = '4.2.3'\n     effort = 'max'\n     reportLevel = 'medium'\n     excludeFilter = rootProject.file('config/spotbugs/exclude.xml')\n@@ -86,23 +87,33 @@ gradle.taskGraph.whenReady { taskGraph ->\n     taskGraph.allTasks.each { task ->\n         if (task.name.toLowerCase().contains('spotbugs')) {\n             task.doLast {\n-                def reportFile = task.project.file(\"build/reports/spotbugs/playDebug.xml\")\n-                if (!reportFile.exists()) return\n-                def slurped = new groovy.xml.XmlSlurper().parse(reportFile)\n-\n-                def foundErrors = false\n-                slurped['BugInstance'].each { bug ->\n-                    logger.error \"[SpotBugs] ${bug['LongMessage']} [${bug.@'type'}]\"\n-                    bug['SourceLine'].each { line ->\n-                        logger.error \"[SpotBugs]     ${line['Message']}\"\n-                        foundErrors = true\n-                    }\n+                def reportFile = task.project.file(\"build/reports/spotbugs/debug.xml\")\n+                def reportFilePlay = task.project.file(\"build/reports/spotbugs/playDebug.xml\")\n+\n+                if (reportFile.exists()) {\n+                    parseSpotBugsXml(task, reportFile)\n                 }\n-                if (foundErrors) {\n-                    throw new TaskExecutionException(task,\n-                            new Exception(\"SpotBugs violations were found. See output above for details.\"))\n+                if (reportFilePlay.exists()) {\n+                    parseSpotBugsXml(task, reportFilePlay)\n                 }\n             }\n         }\n     }\n }\n+\n+def parseSpotBugsXml(task, xmlFile) {\n+    def slurped = new groovy.xml.XmlSlurper().parse(xmlFile)\n+\n+    def foundErrors = false\n+    slurped['BugInstance'].each { bug ->\n+        logger.error \"[SpotBugs] ${bug['LongMessage']} [${bug.@'type'}]\"\n+        bug['SourceLine'].each { line ->\n+            logger.error \"[SpotBugs]     ${line['Message']}\"\n+            foundErrors = true\n+        }\n+    }\n+    if (foundErrors) {\n+        throw new TaskExecutionException(task,\n+                new Exception(\"SpotBugs violations were found. See output above for details.\"))\n+    }\n+}\ndiff --git a/config/spotbugs/exclude.xml b/config/spotbugs/exclude.xml\nindex d544e86d96..b80c0550c8 100644\n--- a/config/spotbugs/exclude.xml\n+++ b/config/spotbugs/exclude.xml\n@@ -5,17 +5,29 @@\n         <Class name=\"de.danoeh.antennapod.adapter.NavListAdapter\"/>\n     </Match>\n     <Match>\n-        <Bug pattern=\"BC_UNCONFIRMED_CAST_OF_RETURN_VALUE\"/>\n-        <Class name=\"de.danoeh.antennapod.net.ssl.NoV1SslSocketFactory\"/>\n+        <Bug pattern=\"DLS_DEAD_LOCAL_STORE\"/>\n+        <Class name=\"de.danoeh.antennapod.ui.statistics.StatisticsFragment\"/>\n     </Match>\n     <Match>\n         <Bug pattern=\"DM_DEFAULT_ENCODING\"/>\n         <Class name=\"de.danoeh.antennapod.parser.media.vorbis.VorbisCommentReader\"/>\n     </Match>\n+    <Match>\n+        <Bug pattern=\"EQ_CHECK_FOR_OPERAND_NOT_COMPATIBLE_WITH_THIS\"/>\n+        <Class name=\"de.danoeh.antennapod.model.feed.FeedMedia\"/>\n+    </Match>\n+    <Match>\n+        <Bug pattern=\"EQ_CHECK_FOR_OPERAND_NOT_COMPATIBLE_WITH_THIS\"/>\n+        <Class name=\"de.danoeh.antennapod.model.playback.RemoteMedia\"/>\n+    </Match>\n     <Match>\n         <Bug pattern=\"HSC_HUGE_SHARED_STRING_CONSTANT\"/>\n         <Class name=\"de.danoeh.antennapod.net.ssl.BackportCaCerts\"/>\n     </Match>\n+    <Match>\n+        <Bug pattern=\"ICAST_IDIV_CAST_TO_DOUBLE\"/>\n+        <Class name=\"de.danoeh.antennapod.ui.echo.screens.RotatingSquaresScreen\"/>\n+    </Match>\n     <Match>\n         <Bug pattern=\"MS_CANNOT_BE_FINAL\"/>\n         <Class name=\"de.danoeh.antennapod.core.service.playback.PlaybackService\"/>\n@@ -24,10 +36,6 @@\n         <Bug pattern=\"MS_MUTABLE_ARRAY\"/>\n         <Class name=\"de.danoeh.antennapod.fragment.NavDrawerFragment\"/>\n     </Match>\n-    <Match>\n-        <Bug pattern=\"NM_SAME_SIMPLE_NAME_AS_SUPERCLASS\"/>\n-        <Class name=\"de.danoeh.antennapod.menuhandler.MenuItemUtils\"/>\n-    </Match>\n     <Match>\n         <Bug pattern=\"NP_NONNULL_PARAM_VIOLATION\"/>\n         <Class name=\"de.danoeh.antennapod.activity.MainActivity\"/>\n@@ -41,8 +49,8 @@\n         <Class name=\"de.danoeh.antennapod.model.feed.FeedMedia\"/>\n     </Match>\n     <Match>\n-        <Bug pattern=\"NP_NULL_PARAM_DEREF\"/>\n-        <Class name=\"de.danoeh.antennapod.model.feed.FeedMedia\"/>\n+        <Bug pattern=\"RV_RETURN_VALUE_IGNORED_BAD_PRACTICE\"/>\n+        <Class name=\"de.danoeh.antennapod.core.service.download.DownloadRequestCreator\"/>\n     </Match>\n     <Match>\n         <Bug pattern=\"RV_RETURN_VALUE_IGNORED_BAD_PRACTICE\"/>\n@@ -50,37 +58,38 @@\n     </Match>\n     <Match>\n         <Bug pattern=\"ST_WRITE_TO_STATIC_FROM_INSTANCE_METHOD\"/>\n-        <Class name=\"de.danoeh.antennapod.PodcastApp\"/>\n+        <Class name=\"de.danoeh.antennapod.core.service.playback.PlaybackService\"/>\n     </Match>\n     <Match>\n         <Bug pattern=\"ST_WRITE_TO_STATIC_FROM_INSTANCE_METHOD\"/>\n-        <Class name=\"de.danoeh.antennapod.core.service.download.DownloadService\"/>\n-    </Match>\n-    <Match>\n-        <Bug pattern=\"MS_CANNOT_BE_FINAL\"/>\n-        <Class name=\"de.danoeh.antennapod.core.service.download.DownloadService\"/>\n+        <Class name=\"de.danoeh.antennapod.ui.home.sections.EpisodesSurpriseSection\"/>\n     </Match>\n     <Match>\n-        <Bug pattern=\"ST_WRITE_TO_STATIC_FROM_INSTANCE_METHOD\"/>\n-        <Class name=\"de.danoeh.antennapod.core.service.playback.PlaybackService\"/>\n+        <Bug pattern=\"URF_UNREAD_FIELD\"/>\n+        <Class name=\"de.danoeh.antennapod.ui.common.TriangleLabelView$PaintHolder\"/>\n     </Match>\n     <Match>\n-        <Bug pattern=\"UUF_UNUSED_PUBLIC_OR_PROTECTED_FIELD\"/>\n-        <Class name=\"de.danoeh.antennapod.core.storage.NavDrawerData$TagDrawerItem\"/>\n+        <Bug pattern=\"URF_UNREAD_PUBLIC_OR_PROTECTED_FIELD\"/>\n+        <Class name=\"de.danoeh.antennapod.playback.base.PlaybackServiceMediaPlayer\"/>\n     </Match>\n     <Match>\n-        <Bug pattern=\"UWF_UNWRITTEN_PUBLIC_OR_PROTECTED_FIELD\"/>\n-        <Class name=\"de.danoeh.antennapod.core.cast.CastButtonVisibilityManager\"/>\n+        <Bug pattern=\"URF_UNREAD_PUBLIC_OR_PROTECTED_FIELD\"/>\n+        <Class name=\"de.danoeh.antennapod.playback.base.PlaybackServiceMediaPlayer$PSMPInfo\"/>\n     </Match>\n \n     <Match><Class name=\"de.danoeh.antennapod.core.ClientConfig\"/></Match>\n \n-    <Match><Package name=\"de.danoeh.antennapod.core.glide\"/></Match>\n     <Match><Package name=\"de.danoeh.antennapod.databinding\"/></Match>\n+    <Match><Package name=\"de.danoeh.antennapod.core.databinding\"/></Match>\n+    <Match><Package name=\"de.danoeh.antennapod.ui.common.databinding\"/></Match>\n+    <Match><Package name=\"de.danoeh.antennapod.ui.echo.databinding\"/></Match>\n+    <Match><Package name=\"de.danoeh.antennapod.ui.statistics.databinding\"/></Match>\n \n+    <Match><Bug pattern=\"DMI_RANDOM_USED_ONLY_ONCE\"/></Match>\n     <Match><Bug pattern=\"EI_EXPOSE_REP\"/></Match>\n     <Match><Bug pattern=\"EI_EXPOSE_REP2\"/></Match>\n     <Match><Bug pattern=\"HE_EQUALS_NO_HASHCODE\"/></Match>\n+    <Match><Bug pattern=\"HE_EQUALS_USE_HASHCODE\"/></Match>\n     <Match><Bug pattern=\"ICAST_INTEGER_MULTIPLY_CAST_TO_LONG\"/></Match>\n     <Match><Bug pattern=\"IS2_INCONSISTENT_SYNC\"/></Match>\n     <Match><Bug pattern=\"NP_METHOD_PARAMETER_TIGHTENS_ANNOTATION\"/></Match>\n@@ -96,6 +105,8 @@\n     <Match><Bug pattern=\"SE_TRANSIENT_FIELD_NOT_RESTORED\"/></Match>\n     <Match><Bug pattern=\"SF_SWITCH_NO_DEFAULT\"/></Match>\n     <Match><Bug pattern=\"SIC_INNER_SHOULD_BE_STATIC_ANON\"/></Match>\n+    <Match><Bug pattern=\"ST_WRITE_TO_STATIC_FROM_INSTANCE_METHOD\"/></Match>\n     <Match><Bug pattern=\"UWF_FIELD_NOT_INITIALIZED_IN_CONSTRUCTOR\"/></Match>\n+    <Match><Bug pattern=\"VA_FORMAT_STRING_USES_NEWLINE\"/></Match>\n     <Match><Bug pattern=\"WMI_WRONG_MAP_ITERATOR\"/></Match>\n </FindBugsFilter>\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/backup/OpmlBackupAgent.java b/core/src/main/java/de/danoeh/antennapod/core/backup/OpmlBackupAgent.java\nindex 79c6dd6bc4..2058d5b2f1 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/backup/OpmlBackupAgent.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/backup/OpmlBackupAgent.java\n@@ -90,17 +90,18 @@ public void performBackup(ParcelFileDescriptor oldState, BackupDataOutput data,\n \n                     // Get the old checksum\n                     if (oldState != null) {\n-                        FileInputStream inState = new FileInputStream(oldState.getFileDescriptor());\n-                        int len = inState.read();\n-\n-                        if (len != -1) {\n-                            byte[] oldChecksum = new byte[len];\n-                            IOUtils.read(inState, oldChecksum, 0, len);\n-                            Log.d(TAG, \"Old checksum: \" + new BigInteger(1, oldChecksum).toString(16));\n-\n-                            if (Arrays.equals(oldChecksum, newChecksum)) {\n-                                Log.d(TAG, \"Checksums are the same; won't backup\");\n-                                return;\n+                        try (final FileInputStream inState = new FileInputStream(oldState.getFileDescriptor())) {\n+                            int len = inState.read();\n+\n+                            if (len != -1) {\n+                                byte[] oldChecksum = new byte[len];\n+                                IOUtils.read(inState, oldChecksum, 0, len);\n+                                Log.d(TAG, \"Old checksum: \" + new BigInteger(1, oldChecksum).toString(16));\n+\n+                                if (Arrays.equals(oldChecksum, newChecksum)) {\n+                                    Log.d(TAG, \"Checksums are the same; won't backup\");\n+                                    return;\n+                                }\n                             }\n                         }\n                     }\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/storage/DBReader.java b/core/src/main/java/de/danoeh/antennapod/core/storage/DBReader.java\nindex 492dff7599..b390f5f44e 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/storage/DBReader.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/storage/DBReader.java\n@@ -736,9 +736,33 @@ public static List<FeedItem> getFeedItemsWithUrl(List<String> urls) {\n     }\n \n     public static class MonthlyStatisticsItem {\n-        public int year = 0;\n-        public int month = 0;\n-        public long timePlayed = 0;\n+        private int year = 0;\n+        private int month = 0;\n+        private long timePlayed = 0;\n+\n+        public int getYear() {\n+            return year;\n+        }\n+\n+        public void setYear(final int year) {\n+            this.year = year;\n+        }\n+\n+        public int getMonth() {\n+            return month;\n+        }\n+\n+        public void setMonth(final int month) {\n+            this.month = month;\n+        }\n+\n+        public long getTimePlayed() {\n+            return timePlayed;\n+        }\n+\n+        public void setTimePlayed(final long timePlayed) {\n+            this.timePlayed = timePlayed;\n+        }\n     }\n \n     @NonNull\n@@ -752,9 +776,9 @@ public static List<MonthlyStatisticsItem> getMonthlyTimeStatistics() {\n             int indexTotalDuration = cursor.getColumnIndexOrThrow(\"total_duration\");\n             while (cursor.moveToNext()) {\n                 MonthlyStatisticsItem item = new MonthlyStatisticsItem();\n-                item.month = Integer.parseInt(cursor.getString(indexMonth));\n-                item.year = Integer.parseInt(cursor.getString(indexYear));\n-                item.timePlayed = cursor.getLong(indexTotalDuration);\n+                item.setMonth(Integer.parseInt(cursor.getString(indexMonth)));\n+                item.setYear(Integer.parseInt(cursor.getString(indexYear)));\n+                item.setTimePlayed(cursor.getLong(indexTotalDuration));\n                 months.add(item);\n             }\n         }\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/storage/NavDrawerData.java b/core/src/main/java/de/danoeh/antennapod/core/storage/NavDrawerData.java\nindex af02a77331..024c5d357a 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/storage/NavDrawerData.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/storage/NavDrawerData.java\n@@ -57,8 +57,8 @@ public void setLayer(int layer) {\n \n     public static class TagDrawerItem extends DrawerItem {\n         public final List<DrawerItem> children = new ArrayList<>();\n-        public final String name;\n-        public boolean isOpen;\n+        private final String name;\n+        private boolean isOpen;\n \n         public TagDrawerItem(String name) {\n             // Keep IDs >0 but make room for many feeds\n@@ -70,6 +70,14 @@ public String getTitle() {\n             return name;\n         }\n \n+        public boolean isOpen() {\n+            return isOpen;\n+        }\n+\n+        public void setOpen(final boolean open) {\n+            isOpen = open;\n+        }\n+\n         public int getCounter() {\n             int sum = 0;\n             for (DrawerItem item : children) {\ndiff --git a/ui/echo/src/main/java/de/danoeh/antennapod/ui/echo/EchoActivity.java b/ui/echo/src/main/java/de/danoeh/antennapod/ui/echo/EchoActivity.java\nindex 758eaeac7c..5981c7ad4f 100644\n--- a/ui/echo/src/main/java/de/danoeh/antennapod/ui/echo/EchoActivity.java\n+++ b/ui/echo/src/main/java/de/danoeh/antennapod/ui/echo/EchoActivity.java\n@@ -222,7 +222,7 @@ private void loadScreen(int screen, boolean force) {\n                     long secondsPerDay = queueSecondsLeft / daysUntilNextYear;\n                     String timePerDay = Converter.getDurationStringLocalized(\n                             getLocalizedResources(this, getEchoLanguage()), secondsPerDay * 1000, true);\n-                    double hoursPerDay = (double) (secondsPerDay / 3600);\n+                    double hoursPerDay = secondsPerDay / 3600.0;\n                     int nextYear = RELEASE_YEAR + 1;\n                     if (hoursPerDay < 1.5) {\n                         viewBinding.aboveLabel.setText(R.string.echo_queue_title_clean);\ndiff --git a/ui/glide/src/main/java/de/danoeh/antennapod/ui/glide/FastBlurTransformation.java b/ui/glide/src/main/java/de/danoeh/antennapod/ui/glide/FastBlurTransformation.java\nindex a19611100f..54040e4b4d 100644\n--- a/ui/glide/src/main/java/de/danoeh/antennapod/ui/glide/FastBlurTransformation.java\n+++ b/ui/glide/src/main/java/de/danoeh/antennapod/ui/glide/FastBlurTransformation.java\n@@ -12,7 +12,7 @@\n import java.security.MessageDigest;\n \n public class FastBlurTransformation extends BitmapTransformation {\n-    private static final String ID = \"de.danoeh.antennapod.core.glide.FastBlurTransformation\";\n+    private static final String ID = \"de.danoeh.antennapod.ui.glide.FastBlurTransformation\";\n \n     private static final String TAG = FastBlurTransformation.class.getSimpleName();\n \ndiff --git a/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/years/BarChartView.java b/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/years/BarChartView.java\nindex eadbb29ee3..93b9e33325 100644\n--- a/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/years/BarChartView.java\n+++ b/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/years/BarChartView.java\n@@ -49,7 +49,7 @@ public void setData(List<DBReader.MonthlyStatisticsItem> data) {\n         drawable.data = data;\n         drawable.maxValue = 1;\n         for (DBReader.MonthlyStatisticsItem item : data) {\n-            drawable.maxValue = Math.max(drawable.maxValue, item.timePlayed);\n+            drawable.maxValue = Math.max(drawable.maxValue, item.getTimePlayed());\n         }\n     }\n \n@@ -89,21 +89,21 @@ public void draw(@NonNull Canvas canvas) {\n             paintBars.setStrokeWidth(height * 0.015f);\n             paintBars.setColor(colors[0]);\n             int colorIndex = 0;\n-            int lastYear = data.size() > 0 ? data.get(0).year : 0;\n+            int lastYear = data.size() > 0 ? data.get(0).getYear() : 0;\n             for (int i = 0; i < data.size(); i++) {\n                 float x = textPadding + (i + 1) * stepSize;\n-                if (lastYear != data.get(i).year) {\n-                    lastYear = data.get(i).year;\n+                if (lastYear != data.get(i).getYear()) {\n+                    lastYear = data.get(i).getYear();\n                     colorIndex++;\n                     paintBars.setColor(colors[colorIndex % 2]);\n                     if (i < data.size() - 2) {\n-                        canvas.drawText(String.valueOf(data.get(i).year), x + stepSize,\n+                        canvas.drawText(String.valueOf(data.get(i).getYear()), x + stepSize,\n                                 barHeight + (height - barHeight + textSize) / 2, paintGridText);\n                     }\n                     canvas.drawLine(x, height, x, barHeight, paintGridText);\n                 }\n \n-                float valuePercentage = (float) Math.max(0.005, (float) data.get(i).timePlayed / maxValue);\n+                float valuePercentage = (float) Math.max(0.005, (float) data.get(i).getTimePlayed() / maxValue);\n                 float y = (1 - valuePercentage) * barHeight;\n                 canvas.drawRect(x, y, x + stepSize * 0.95f, barHeight, paintBars);\n             }\ndiff --git a/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/years/YearStatisticsListAdapter.java b/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/years/YearStatisticsListAdapter.java\nindex 2116a17a44..d000ceb628 100644\n--- a/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/years/YearStatisticsListAdapter.java\n+++ b/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/years/YearStatisticsListAdapter.java\n@@ -57,41 +57,41 @@ public void onBindViewHolder(@NonNull RecyclerView.ViewHolder h, int position) {\n         } else {\n             StatisticsHolder holder = (StatisticsHolder) h;\n             DBReader.MonthlyStatisticsItem statsItem = yearlyAggregate.get(position - 1);\n-            holder.year.setText(String.format(Locale.getDefault(), \"%d \", statsItem.year));\n-            holder.hours.setText(String.format(Locale.getDefault(), \"%.1f \", statsItem.timePlayed / 3600000.0f)\n+            holder.year.setText(String.format(Locale.getDefault(), \"%d \", statsItem.getYear()));\n+            holder.hours.setText(String.format(Locale.getDefault(), \"%.1f \", statsItem.getTimePlayed() / 3600000.0f)\n                     + context.getString(R.string.time_hours));\n         }\n     }\n \n     public void update(List<DBReader.MonthlyStatisticsItem> statistics) {\n-        int lastYear = statistics.size() > 0 ? statistics.get(0).year : 0;\n-        int lastDataPoint = statistics.size() > 0 ? (statistics.get(0).month - 1) + lastYear * 12 : 0;\n+        int lastYear = statistics.size() > 0 ? statistics.get(0).getYear() : 0;\n+        int lastDataPoint = statistics.size() > 0 ? (statistics.get(0).getMonth() - 1) + lastYear * 12 : 0;\n         long yearSum = 0;\n         yearlyAggregate.clear();\n         statisticsData.clear();\n         for (DBReader.MonthlyStatisticsItem statistic : statistics) {\n-            if (statistic.year != lastYear) {\n+            if (statistic.getYear() != lastYear) {\n                 DBReader.MonthlyStatisticsItem yearAggregate = new DBReader.MonthlyStatisticsItem();\n-                yearAggregate.year = lastYear;\n-                yearAggregate.timePlayed = yearSum;\n+                yearAggregate.setYear(lastYear);\n+                yearAggregate.setTimePlayed(yearSum);\n                 yearlyAggregate.add(yearAggregate);\n                 yearSum = 0;\n-                lastYear = statistic.year;\n+                lastYear = statistic.getYear();\n             }\n-            yearSum += statistic.timePlayed;\n-            while (lastDataPoint + 1 < (statistic.month - 1) + statistic.year * 12) {\n+            yearSum += statistic.getTimePlayed();\n+            while (lastDataPoint + 1 < (statistic.getMonth() - 1) + statistic.getYear() * 12) {\n                 lastDataPoint++;\n                 DBReader.MonthlyStatisticsItem item = new DBReader.MonthlyStatisticsItem();\n-                item.year = lastDataPoint / 12;\n-                item.month = lastDataPoint % 12 + 1;\n+                item.setYear(lastDataPoint / 12);\n+                item.setMonth(lastDataPoint % 12 + 1);\n                 statisticsData.add(item); // Compensate for months without playback\n             }\n             statisticsData.add(statistic);\n-            lastDataPoint = (statistic.month - 1) + statistic.year * 12;\n+            lastDataPoint = (statistic.getMonth() - 1) + statistic.getYear() * 12;\n         }\n         DBReader.MonthlyStatisticsItem yearAggregate = new DBReader.MonthlyStatisticsItem();\n-        yearAggregate.year = lastYear;\n-        yearAggregate.timePlayed = yearSum;\n+        yearAggregate.setYear(lastYear);\n+        yearAggregate.setTimePlayed(yearSum);\n         yearlyAggregate.add(yearAggregate);\n         Collections.reverse(yearlyAggregate);\n         notifyDataSetChanged();\n", "test_patch": "", "problem_statement": "CI does not fail if SpotBugs fails\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n-\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n-\n\n### Device model\n\n-\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n_No response_\n\n### Expected behaviour\n\nIf something violates SpotBugs, the CI fails\n\n### Current behaviour\n\nCI still shows green. Our current code now has a bunch of SpotBugs violations that were introduced by recent PRs because the CI did not catch them.\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2024-03-06T00:44:24Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6923, "instance_id": "AntennaPod__AntennaPod-6923", "issue_numbers": ["6731"], "base_commit": "c07ae17962b0fbb757c42e873d9c06cdac3a52ae", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\nindex b26cf48142..02102db14c 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n@@ -47,20 +47,6 @@\n import androidx.core.app.NotificationManagerCompat;\n import androidx.media.MediaBrowserServiceCompat;\n \n-import de.danoeh.antennapod.core.service.QuickSettingsTileService;\n-import de.danoeh.antennapod.core.util.ChapterUtils;\n-import de.danoeh.antennapod.core.util.playback.PlayableUtils;\n-import de.danoeh.antennapod.event.playback.BufferUpdateEvent;\n-import de.danoeh.antennapod.event.playback.PlaybackServiceEvent;\n-import de.danoeh.antennapod.event.PlayerErrorEvent;\n-import de.danoeh.antennapod.event.playback.SleepTimerUpdatedEvent;\n-import de.danoeh.antennapod.model.feed.Chapter;\n-import de.danoeh.antennapod.model.feed.FeedItemFilter;\n-import de.danoeh.antennapod.playback.base.PlaybackServiceMediaPlayer;\n-import de.danoeh.antennapod.playback.base.PlayerStatus;\n-import de.danoeh.antennapod.playback.cast.CastPsmp;\n-import de.danoeh.antennapod.playback.cast.CastStateListener;\n-\n import org.greenrobot.eventbus.EventBus;\n import org.greenrobot.eventbus.Subscribe;\n import org.greenrobot.eventbus.ThreadMode;\n@@ -77,10 +63,12 @@\n import de.danoeh.antennapod.core.preferences.SleepTimerPreferences;\n import de.danoeh.antennapod.core.receiver.MediaButtonReceiver;\n import de.danoeh.antennapod.core.service.QuickSettingsTileService;\n+import de.danoeh.antennapod.core.service.playback.PlaybackServiceTaskManager.SleepTimer;\n import de.danoeh.antennapod.core.storage.DBReader;\n import de.danoeh.antennapod.core.storage.DBWriter;\n import de.danoeh.antennapod.core.storage.FeedSearcher;\n import de.danoeh.antennapod.core.sync.queue.SynchronizationQueueSink;\n+import de.danoeh.antennapod.core.util.ChapterUtils;\n import de.danoeh.antennapod.core.util.FeedItemUtil;\n import de.danoeh.antennapod.core.util.FeedUtil;\n import de.danoeh.antennapod.core.util.IntentUtils;\n@@ -98,6 +86,7 @@\n import de.danoeh.antennapod.event.settings.SkipIntroEndingChangedEvent;\n import de.danoeh.antennapod.event.settings.SpeedPresetChangedEvent;\n import de.danoeh.antennapod.event.settings.VolumeAdaptionChangedEvent;\n+import de.danoeh.antennapod.model.feed.Chapter;\n import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n@@ -990,7 +979,10 @@ public void sleepTimerUpdate(SleepTimerUpdatedEvent event) {\n         if (event.isOver()) {\n             mediaPlayer.pause(true, true);\n             mediaPlayer.setVolume(1.0f, 1.0f);\n-        } else if (event.getTimeLeft() < PlaybackServiceTaskManager.SleepTimer.NOTIFICATION_THRESHOLD) {\n+            int newPosition = mediaPlayer.getPosition() - (int) SleepTimer.NOTIFICATION_THRESHOLD / 2;\n+            newPosition = Math.max(newPosition, 0);\n+            seekTo(newPosition);\n+        } else if (event.getTimeLeft() < SleepTimer.NOTIFICATION_THRESHOLD) {\n             final float[] multiplicators = {0.1f, 0.2f, 0.3f, 0.3f, 0.3f, 0.4f, 0.4f, 0.4f, 0.6f, 0.8f};\n             float multiplicator = multiplicators[Math.max(0, (int) event.getTimeLeft() / 1000)];\n             Log.d(TAG, \"onSleepTimerAlmostExpired: \" + multiplicator);\n", "test_patch": "", "problem_statement": "Rewind a few seconds when sleep timer pauses playback\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.1.1\n\n### Where did you get the app from\n\nF-Droid\n\n### Problem you may be having, or feature you want\n\nWhen the sleep timer pauses the playback it lowers the volume. Right before the pause happens it's so quite that I cannot listen to the podcast. When I resume (because I'm not at sleep yet) I missed a few seconds because the volume lowering.\n\n### Suggested solution\n\nRewind a few seconds after the sleep timer has been paused playback. \n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "And also when app is closed.\nHi @albertopasqualetto\nFor regular use, there already is automatic rewind: https://antennapod.org/documentation/playback/auto-rewind\n> Hi @albertopasqualetto\n> For regular use, there already is automatic rewind: https://antennapod.org/documentation/playback/auto-rewind\n\nI've never notice it, but good to know, thanks!", "created_at": "2024-02-16T18:37:10Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6913, "instance_id": "AntennaPod__AntennaPod-6913", "issue_numbers": ["6651"], "base_commit": "45a05ed3322b7dfff5257734892e140084dd5e36", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/UserInterfacePreferencesFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/UserInterfacePreferencesFragment.java\nindex 0f3320e980..2edf8cb68a 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/UserInterfacePreferencesFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/UserInterfacePreferencesFragment.java\n@@ -6,12 +6,19 @@\n import android.os.Bundle;\n import android.widget.Button;\n import android.widget.ListView;\n+\n import androidx.appcompat.app.AlertDialog;\n import androidx.core.app.ActivityCompat;\n import androidx.preference.Preference;\n import androidx.preference.PreferenceFragmentCompat;\n+\n import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import com.google.android.material.snackbar.Snackbar;\n+\n+import org.greenrobot.eventbus.EventBus;\n+\n+import java.util.List;\n+\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.PreferenceActivity;\n import de.danoeh.antennapod.dialog.DrawerPreferencesDialog;\n@@ -20,9 +27,6 @@\n import de.danoeh.antennapod.event.PlayerStatusEvent;\n import de.danoeh.antennapod.event.UnreadItemsUpdateEvent;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n-import org.greenrobot.eventbus.EventBus;\n-\n-import java.util.List;\n \n public class UserInterfacePreferencesFragment extends PreferenceFragmentCompat {\n     private static final String PREF_SWIPE = \"prefSwipe\";\n@@ -100,7 +104,12 @@ private void showFullNotificationButtonsDialog() {\n         final List<Integer> preferredButtons = UserPreferences.getFullNotificationButtons();\n         final String[] allButtonNames = context.getResources().getStringArray(\n                 R.array.full_notification_buttons_options);\n-        final int[] buttonIDs = {2, 3, 4};\n+        final int[] buttonIDs = {\n+                UserPreferences.NOTIFICATION_BUTTON_SKIP,\n+                UserPreferences.NOTIFICATION_BUTTON_NEXT_CHAPTER,\n+                UserPreferences.NOTIFICATION_BUTTON_PLAYBACK_SPEED,\n+                UserPreferences.NOTIFICATION_BUTTON_SLEEP_TIMER,\n+        };\n         final int exactItems = 2;\n         final DialogInterface.OnClickListener completeListener = (dialog, which) ->\n                 UserPreferences.setFullNotificationButtons(preferredButtons);\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\nindex 02102db14c..fd11dc4c57 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n@@ -129,6 +129,8 @@ public class PlaybackService extends MediaBrowserServiceCompat {\n     private static final String CUSTOM_ACTION_REWIND = \"action.de.danoeh.antennapod.core.service.rewind\";\n     private static final String CUSTOM_ACTION_CHANGE_PLAYBACK_SPEED =\n             \"action.de.danoeh.antennapod.core.service.changePlaybackSpeed\";\n+    private static final String CUSTOM_ACTION_TOGGLE_SLEEP_TIMER =\n+            \"action.de.danoeh.antennapod.core.service.toggleSleepTimer\";\n     public static final String CUSTOM_ACTION_NEXT_CHAPTER = \"action.de.danoeh.antennapod.core.service.next_chapter\";\n \n     /**\n@@ -977,6 +979,7 @@ public void bufferUpdate(BufferUpdateEvent event) {\n     @SuppressWarnings(\"unused\")\n     public void sleepTimerUpdate(SleepTimerUpdatedEvent event) {\n         if (event.isOver()) {\n+            updateMediaSession(mediaPlayer.getPlayerStatus());\n             mediaPlayer.pause(true, true);\n             mediaPlayer.setVolume(1.0f, 1.0f);\n             int newPosition = mediaPlayer.getPosition() - (int) SleepTimer.NOTIFICATION_THRESHOLD / 2;\n@@ -988,7 +991,10 @@ public void sleepTimerUpdate(SleepTimerUpdatedEvent event) {\n             Log.d(TAG, \"onSleepTimerAlmostExpired: \" + multiplicator);\n             mediaPlayer.setVolume(multiplicator, multiplicator);\n         } else if (event.isCancelled()) {\n+            updateMediaSession(mediaPlayer.getPlayerStatus());\n             mediaPlayer.setVolume(1.0f, 1.0f);\n+        } else if (event.wasJustEnabled()) {\n+            updateMediaSession(mediaPlayer.getPlayerStatus());\n         }\n     }\n \n@@ -1271,6 +1277,16 @@ private void updateMediaSession(final PlayerStatus playerStatus) {\n             );\n         }\n \n+        if (UserPreferences.showSleepTimerOnFullNotification()) {\n+            @DrawableRes int icon = R.drawable.ic_notification_sleep;\n+            if (sleepTimerActive()) {\n+                icon = R.drawable.ic_notification_sleep_off;\n+            }\n+            sessionState.addCustomAction(\n+                    new PlaybackStateCompat.CustomAction.Builder(CUSTOM_ACTION_TOGGLE_SLEEP_TIMER,\n+                            getString(R.string.sleep_timer_label), icon).build());\n+        }\n+\n         if (UserPreferences.showNextChapterOnFullNotification()) {\n             if (getPlayable() != null && getPlayable().getChapters() != null) {\n                 sessionState.addCustomAction(\n@@ -1950,6 +1966,12 @@ public void onCustomAction(String action, Bundle extra) {\n                     }\n                     onSetPlaybackSpeed(newSpeed);\n                 }\n+            } else if (CUSTOM_ACTION_TOGGLE_SLEEP_TIMER.equals(action)) {\n+                if (sleepTimerActive()) {\n+                    disableSleepTimer();\n+                } else {\n+                    setSleepTimer(SleepTimerPreferences.timerMillis());\n+                }\n             }\n         }\n     };\ndiff --git a/core/src/main/res/values/arrays.xml b/core/src/main/res/values/arrays.xml\nindex 7eeab886a8..2961339cd9 100644\n--- a/core/src/main/res/values/arrays.xml\n+++ b/core/src/main/res/values/arrays.xml\n@@ -250,6 +250,7 @@\n         <item>@string/skip_episode_label</item>\n         <item>@string/next_chapter</item>\n         <item>@string/playback_speed</item>\n+        <item>@string/sleep_timer_label</item>\n     </string-array>\n \n     <string-array name=\"default_page_values\">\ndiff --git a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\nindex b454ee5a1a..2e38d55f13 100644\n--- a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n+++ b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n@@ -6,17 +6,13 @@\n import android.text.TextUtils;\n import android.util.Log;\n import android.view.KeyEvent;\n+\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n import androidx.annotation.VisibleForTesting;\n import androidx.core.app.NotificationCompat;\n import androidx.preference.PreferenceManager;\n-import de.danoeh.antennapod.model.download.ProxyConfig;\n-import de.danoeh.antennapod.model.feed.FeedCounter;\n-import de.danoeh.antennapod.model.feed.FeedPreferences;\n-import de.danoeh.antennapod.model.feed.SortOrder;\n-import de.danoeh.antennapod.model.feed.SubscriptionsFilter;\n-import de.danoeh.antennapod.model.playback.MediaType;\n+\n import org.json.JSONArray;\n import org.json.JSONException;\n \n@@ -32,6 +28,13 @@\n import java.util.Locale;\n import java.util.Set;\n \n+import de.danoeh.antennapod.model.download.ProxyConfig;\n+import de.danoeh.antennapod.model.feed.FeedCounter;\n+import de.danoeh.antennapod.model.feed.FeedPreferences;\n+import de.danoeh.antennapod.model.feed.SortOrder;\n+import de.danoeh.antennapod.model.feed.SubscriptionsFilter;\n+import de.danoeh.antennapod.model.playback.MediaType;\n+\n /**\n  * Provides access to preferences set by the user in the settings screen. A\n  * private instance of this class must first be instantiated via\n@@ -130,9 +133,9 @@ private UserPreferences(){}\n     public static final int NOTIFICATION_BUTTON_REWIND = 0;\n     public static final int NOTIFICATION_BUTTON_FAST_FORWARD = 1;\n     public static final int NOTIFICATION_BUTTON_SKIP = 2;\n-\n     public static final int NOTIFICATION_BUTTON_NEXT_CHAPTER = 3;\n     public static final int NOTIFICATION_BUTTON_PLAYBACK_SPEED = 4;\n+    public static final int NOTIFICATION_BUTTON_SLEEP_TIMER = 5;\n     public static final int EPISODE_CACHE_SIZE_UNLIMITED = -1;\n     public static final int FEED_ORDER_COUNTER = 0;\n     public static final int FEED_ORDER_ALPHABETICAL = 1;\n@@ -235,6 +238,10 @@ public static boolean showPlaybackSpeedOnFullNotification() {\n         return showButtonOnFullNotification(NOTIFICATION_BUTTON_PLAYBACK_SPEED);\n     }\n \n+    public static boolean showSleepTimerOnFullNotification() {\n+        return showButtonOnFullNotification(NOTIFICATION_BUTTON_SLEEP_TIMER);\n+    }\n+\n     public static int getFeedOrder() {\n         String value = prefs.getString(PREF_DRAWER_FEED_ORDER, \"\" + FEED_ORDER_COUNTER);\n         return Integer.parseInt(value);\ndiff --git a/ui/png-icons/src/main/res/drawable/ic_notification_sleep.xml b/ui/png-icons/src/main/res/drawable/ic_notification_sleep.xml\nnew file mode 100644\nindex 0000000000..60cfbb6169\n--- /dev/null\n+++ b/ui/png-icons/src/main/res/drawable/ic_notification_sleep.xml\n@@ -0,0 +1,5 @@\n+<vector android:height=\"24dp\"\n+        android:viewportHeight=\"24.0\" android:viewportWidth=\"24.0\"\n+        android:width=\"24dp\" xmlns:android=\"http://schemas.android.com/apk/res/android\">\n+    <path android:fillColor=\"#ffffff\" android:pathData=\"M23,12H17V10L20.39,6H17V4H23V6L19.62,10H23V12M15,16H9V14L12.39,10H9V8H15V10L11.62,14H15V16M7,20H1V18L4.39,14H1V12H7V14L3.62,18H7V20Z\"/>\n+</vector>\ndiff --git a/ui/png-icons/src/main/res/drawable/ic_notification_sleep_off.xml b/ui/png-icons/src/main/res/drawable/ic_notification_sleep_off.xml\nnew file mode 100644\nindex 0000000000..8cb32124b1\n--- /dev/null\n+++ b/ui/png-icons/src/main/res/drawable/ic_notification_sleep_off.xml\n@@ -0,0 +1,5 @@\n+<vector android:height=\"24dp\"\n+        android:viewportHeight=\"24.0\" android:viewportWidth=\"24.0\"\n+        android:width=\"24dp\" xmlns:android=\"http://schemas.android.com/apk/res/android\">\n+    <path android:fillColor=\"#ffffff\" android:pathData=\"M2,5.27L3.28,4L20,20.72L18.73,22L12.73,16H9V14L9.79,13.06L2,5.27M23,12H17V10L20.39,6H17V4H23V6L19.62,10H23V12M9.82,8H15V10L13.54,11.72L9.82,8M7,20H1V18L4.39,14H1V12H7V14L3.62,18H7V20Z\"/>\n+</vector>\n", "test_patch": "", "problem_statement": "Toggle sleep timer from notification\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.1.0\n\n### Where did you get the app from\n\nF-Droid\n\n### Problem you may be having, or feature you want\n\nI'd like to toggle the sleep timer from the notification, so I don't have to unlock the app to do this. \n\n### Suggested solution\n\nAdd a setting to configure the buttons in the media notification (similar to the one that I suggest to hide in #6650). IMO it should be fine to have a radio button preference for one configurable button, e.g. sleep timer or playback speed.\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "> Add a setting to configure the buttons in the media notification \r\n\r\nSuch a setting will be added when #6276 is merged.", "created_at": "2024-02-06T16:20:45Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6910, "instance_id": "AntennaPod__AntennaPod-6910", "issue_numbers": ["4427"], "base_commit": "f0e96a269233e85a452eabcbfe09899157024ab3", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/dialog/VariableSpeedDialog.java b/app/src/main/java/de/danoeh/antennapod/dialog/VariableSpeedDialog.java\nindex 8de7dce044..c62f5df7ee 100644\n--- a/app/src/main/java/de/danoeh/antennapod/dialog/VariableSpeedDialog.java\n+++ b/app/src/main/java/de/danoeh/antennapod/dialog/VariableSpeedDialog.java\n@@ -37,6 +37,7 @@ public class VariableSpeedDialog extends BottomSheetDialogFragment {\n     private final List<Float> selectedSpeeds;\n     private PlaybackSpeedSeekBar speedSeekBar;\n     private Chip addCurrentSpeedChip;\n+    private CheckBox skipSilenceCheckbox;\n \n     public VariableSpeedDialog() {\n         DecimalFormatSymbols format = new DecimalFormatSymbols(Locale.US);\n@@ -51,11 +52,13 @@ public void onStart() {\n             @Override\n             public void loadMediaInfo() {\n                 updateSpeed(new SpeedChangedEvent(controller.getCurrentPlaybackSpeedMultiplier()));\n+                updateSkipSilence(controller.getCurrentPlaybackSkipSilence());\n             }\n         };\n         controller.init();\n         EventBus.getDefault().register(this);\n         updateSpeed(new SpeedChangedEvent(controller.getCurrentPlaybackSpeedMultiplier()));\n+        updateSkipSilence(controller.getCurrentPlaybackSkipSilence());\n     }\n \n     @Override\n@@ -72,6 +75,10 @@ public void updateSpeed(SpeedChangedEvent event) {\n         addCurrentSpeedChip.setText(String.format(Locale.getDefault(), \"%1$.2f\", event.getNewSpeed()));\n     }\n \n+    public void updateSkipSilence(boolean skipSilence) {\n+        skipSilenceCheckbox.setChecked(skipSilence);\n+    }\n+\n     @Nullable\n     @Override\n     public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container,\n@@ -97,9 +104,9 @@ public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup c\n         addCurrentSpeedChip.setCloseIconContentDescription(getString(R.string.add_preset));\n         addCurrentSpeedChip.setOnClickListener(v -> addCurrentSpeed());\n \n-        final CheckBox skipSilence = root.findViewById(R.id.skipSilence);\n-        skipSilence.setChecked(UserPreferences.isSkipSilence());\n-        skipSilence.setOnCheckedChangeListener((buttonView, isChecked) -> {\n+        skipSilenceCheckbox = root.findViewById(R.id.skipSilence);\n+        skipSilenceCheckbox.setChecked(UserPreferences.isSkipSilence());\n+        skipSilenceCheckbox.setOnCheckedChangeListener((buttonView, isChecked) -> {\n             UserPreferences.setSkipSilence(isChecked);\n             controller.setSkipSilence(isChecked);\n         });\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/FeedSettingsFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/FeedSettingsFragment.java\nindex 7e9c3d093c..c08dda4166 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/FeedSettingsFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/FeedSettingsFragment.java\n@@ -241,14 +241,21 @@ private void setupPlaybackSpeedPreference() {\n                         PlaybackSpeedFeedSettingDialogBinding.inflate(getLayoutInflater());\n                 viewBinding.seekBar.setProgressChangedListener(speed ->\n                         viewBinding.currentSpeedLabel.setText(String.format(Locale.getDefault(), \"%.2fx\", speed)));\n-                float speed = feedPreferences.getFeedPlaybackSpeed();\n                 viewBinding.useGlobalCheckbox.setOnCheckedChangeListener((buttonView, isChecked) -> {\n                     viewBinding.seekBar.setEnabled(!isChecked);\n                     viewBinding.seekBar.setAlpha(isChecked ? 0.4f : 1f);\n                     viewBinding.currentSpeedLabel.setAlpha(isChecked ? 0.4f : 1f);\n+\n+                    viewBinding.skipSilenceFeed.setEnabled(!isChecked);\n+                    viewBinding.skipSilenceFeed.setAlpha(isChecked ? 0.4f : 1f);\n                 });\n-                viewBinding.useGlobalCheckbox.setChecked(speed == FeedPreferences.SPEED_USE_GLOBAL);\n-                viewBinding.seekBar.updateSpeed(speed == FeedPreferences.SPEED_USE_GLOBAL ? 1 : speed);\n+                float speed = feedPreferences.getFeedPlaybackSpeed();\n+                FeedPreferences.SkipSilence skipSilence = feedPreferences.getFeedSkipSilence();\n+                boolean isGlobal = speed == FeedPreferences.SPEED_USE_GLOBAL;\n+                viewBinding.useGlobalCheckbox.setChecked(isGlobal);\n+                viewBinding.seekBar.updateSpeed(isGlobal ? 1 : speed);\n+                viewBinding.skipSilenceFeed.setChecked(!isGlobal\n+                        && skipSilence == FeedPreferences.SkipSilence.AGGRESSIVE);\n                 new MaterialAlertDialogBuilder(getContext())\n                         .setTitle(R.string.playback_speed)\n                         .setView(viewBinding.getRoot())\n@@ -256,9 +263,19 @@ private void setupPlaybackSpeedPreference() {\n                             float newSpeed = viewBinding.useGlobalCheckbox.isChecked()\n                                     ? FeedPreferences.SPEED_USE_GLOBAL : viewBinding.seekBar.getCurrentSpeed();\n                             feedPreferences.setFeedPlaybackSpeed(newSpeed);\n+                            FeedPreferences.SkipSilence newSkipSilence;\n+                            if (viewBinding.useGlobalCheckbox.isChecked()) {\n+                                newSkipSilence = FeedPreferences.SkipSilence.GLOBAL;\n+                            } else if (viewBinding.skipSilenceFeed.isChecked()) {\n+                                newSkipSilence = FeedPreferences.SkipSilence.AGGRESSIVE;\n+                            } else {\n+                                newSkipSilence = FeedPreferences.SkipSilence.OFF;\n+                            }\n+                            feedPreferences.setFeedSkipSilence(newSkipSilence);\n                             DBWriter.setFeedPreferences(feedPreferences);\n-                            EventBus.getDefault().post(\n-                                    new SpeedPresetChangedEvent(feedPreferences.getFeedPlaybackSpeed(), feed.getId()));\n+                            EventBus.getDefault().post(new SpeedPresetChangedEvent(\n+                                    feedPreferences.getFeedPlaybackSpeed(),\n+                                    feed.getId(), feedPreferences.getFeedSkipSilence()));\n                         })\n                         .setNegativeButton(R.string.cancel_label, null)\n                         .show();\ndiff --git a/app/src/main/res/layout/playback_speed_feed_setting_dialog.xml b/app/src/main/res/layout/playback_speed_feed_setting_dialog.xml\nindex 48d69e4a9c..50eb4f84f3 100644\n--- a/app/src/main/res/layout/playback_speed_feed_setting_dialog.xml\n+++ b/app/src/main/res/layout/playback_speed_feed_setting_dialog.xml\n@@ -34,4 +34,10 @@\n \n     </LinearLayout>\n \n+    <CheckBox\n+        android:id=\"@+id/skipSilenceFeed\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:text=\"@string/pref_skip_silence_title\" />\n+\n </LinearLayout>\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/feed/util/PlaybackSpeedUtils.java b/core/src/main/java/de/danoeh/antennapod/core/feed/util/PlaybackSpeedUtils.java\nindex d0824e00b8..cd98507bac 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/feed/util/PlaybackSpeedUtils.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/feed/util/PlaybackSpeedUtils.java\n@@ -4,6 +4,7 @@\n import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedMedia;\n+import de.danoeh.antennapod.model.feed.FeedPreferences;\n import de.danoeh.antennapod.model.playback.MediaType;\n import de.danoeh.antennapod.core.preferences.PlaybackPreferences;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n@@ -50,4 +51,25 @@ public static float getCurrentPlaybackSpeed(Playable media) {\n \n         return playbackSpeed;\n     }\n+\n+    /**\n+     * Returns the currently configured skip silence for the specified media.\n+     */\n+    public static FeedPreferences.SkipSilence getCurrentSkipSilencePreference(Playable media) {\n+        FeedPreferences.SkipSilence skipSilence = FeedPreferences.SkipSilence.GLOBAL;\n+        if (media != null) {\n+            skipSilence = PlaybackPreferences.getCurrentlyPlayingTemporarySkipSilence();\n+            if (skipSilence == FeedPreferences.SkipSilence.GLOBAL && media instanceof FeedMedia) {\n+                FeedItem item = ((FeedMedia) media).getItem();\n+                if (item != null && item.getFeed() != null && item.getFeed().getPreferences() != null) {\n+                    skipSilence = item.getFeed().getPreferences().getFeedSkipSilence();\n+                }\n+            }\n+        }\n+        if (skipSilence == FeedPreferences.SkipSilence.GLOBAL) {\n+            skipSilence = UserPreferences.isSkipSilence()\n+                    ? FeedPreferences.SkipSilence.AGGRESSIVE : FeedPreferences.SkipSilence.OFF;\n+        }\n+        return skipSilence;\n+    }\n }\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/preferences/PlaybackPreferences.java b/core/src/main/java/de/danoeh/antennapod/core/preferences/PlaybackPreferences.java\nindex 160b6b7745..d6f6cdb43c 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/preferences/PlaybackPreferences.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/preferences/PlaybackPreferences.java\n@@ -10,6 +10,7 @@\n import de.danoeh.antennapod.core.storage.DBReader;\n import de.danoeh.antennapod.event.PlayerStatusEvent;\n import de.danoeh.antennapod.model.feed.FeedMedia;\n+import de.danoeh.antennapod.model.feed.FeedPreferences;\n import de.danoeh.antennapod.model.playback.MediaType;\n import de.danoeh.antennapod.model.playback.Playable;\n import de.danoeh.antennapod.playback.base.PlayerStatus;\n@@ -64,6 +65,12 @@ public class PlaybackPreferences implements SharedPreferences.OnSharedPreference\n     private static final String PREF_CURRENTLY_PLAYING_TEMPORARY_PLAYBACK_SPEED\n             = \"de.danoeh.antennapod.preferences.temporaryPlaybackSpeed\";\n \n+    /**\n+     * A temporary skip silence preference which overrides the per-feed skip silence for the currently playing\n+     * media. Considered unset if set to null;\n+     */\n+    private static final String PREF_CURRENTLY_PLAYING_TEMPORARY_SKIP_SILENCE\n+            = \"de.danoeh.antennapod.preferences.temporarySkipSilence\";\n \n     /**\n      * Value of PREF_CURRENTLY_PLAYING_MEDIA if no media is playing.\n@@ -123,6 +130,11 @@ public static float getCurrentlyPlayingTemporaryPlaybackSpeed() {\n         return prefs.getFloat(PREF_CURRENTLY_PLAYING_TEMPORARY_PLAYBACK_SPEED, SPEED_USE_GLOBAL);\n     }\n \n+    public static FeedPreferences.SkipSilence getCurrentlyPlayingTemporarySkipSilence() {\n+        return FeedPreferences.SkipSilence.fromCode(prefs.getInt(\n+                PREF_CURRENTLY_PLAYING_TEMPORARY_SKIP_SILENCE, FeedPreferences.SkipSilence.GLOBAL.code));\n+    }\n+\n     public static void writeNoMediaPlaying() {\n         SharedPreferences.Editor editor = prefs.edit();\n         editor.putLong(PREF_CURRENTLY_PLAYING_MEDIA_TYPE, NO_MEDIA_PLAYING);\n@@ -170,9 +182,17 @@ public static void setCurrentlyPlayingTemporaryPlaybackSpeed(float speed) {\n         editor.apply();\n     }\n \n-    public static void clearCurrentlyPlayingTemporaryPlaybackSpeed() {\n+    public static void setCurrentlyPlayingTemporarySkipSilence(boolean skipSilence) {\n+        SharedPreferences.Editor editor = prefs.edit();\n+        editor.putInt(PREF_CURRENTLY_PLAYING_TEMPORARY_SKIP_SILENCE, skipSilence\n+                ? FeedPreferences.SkipSilence.AGGRESSIVE.code : FeedPreferences.SkipSilence.OFF.code);\n+        editor.apply();\n+    }\n+\n+    public static void clearCurrentlyPlayingTemporaryPlaybackSettings() {\n         SharedPreferences.Editor editor = prefs.edit();\n         editor.remove(PREF_CURRENTLY_PLAYING_TEMPORARY_PLAYBACK_SPEED);\n+        editor.remove(PREF_CURRENTLY_PLAYING_TEMPORARY_SKIP_SILENCE);\n         editor.apply();\n     }\n \ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/ExoPlayerWrapper.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/ExoPlayerWrapper.java\nindex 79cd97fd28..e413a33ca8 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/ExoPlayerWrapper.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/ExoPlayerWrapper.java\n@@ -154,6 +154,10 @@ public float getCurrentSpeedMultiplier() {\n         return playbackParameters.speed;\n     }\n \n+    public boolean getCurrentSkipSilence() {\n+        return exoPlayer.getSkipSilenceEnabled();\n+    }\n+\n     public int getDuration() {\n         if (exoPlayer.getDuration() == C.TIME_UNSET) {\n             return Playable.INVALID_TIME;\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/LocalPSMP.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/LocalPSMP.java\nindex 69c632c4fa..2ad8f2b8a4 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/LocalPSMP.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/LocalPSMP.java\n@@ -161,7 +161,9 @@ private void playMediaObject(@NonNull final Playable playable, final boolean for\n         try {\n             callback.ensureMediaInfoLoaded(media);\n             callback.onMediaChanged(false);\n-            setPlaybackParams(PlaybackSpeedUtils.getCurrentPlaybackSpeed(media), UserPreferences.isSkipSilence());\n+            setPlaybackParams(PlaybackSpeedUtils.getCurrentPlaybackSpeed(media),\n+                    PlaybackSpeedUtils.getCurrentSkipSilencePreference(media)\n+                            == FeedPreferences.SkipSilence.AGGRESSIVE);\n             if (stream) {\n                 if (playable instanceof FeedMedia) {\n                     FeedMedia feedMedia = (FeedMedia) playable;\n@@ -212,7 +214,9 @@ public void resume() {\n                 Log.d(TAG, \"Resuming/Starting playback\");\n                 acquireWifiLockIfNecessary();\n \n-                setPlaybackParams(PlaybackSpeedUtils.getCurrentPlaybackSpeed(media), UserPreferences.isSkipSilence());\n+                setPlaybackParams(PlaybackSpeedUtils.getCurrentPlaybackSpeed(media),\n+                        PlaybackSpeedUtils.getCurrentSkipSilencePreference(media)\n+                                == FeedPreferences.SkipSilence.AGGRESSIVE);\n                 setVolume(1.0f, 1.0f);\n \n                 if (playerStatus == PlayerStatus.PREPARED && media.getPosition() > 0) {\n@@ -461,6 +465,18 @@ public float getPlaybackSpeed() {\n         return retVal;\n     }\n \n+    @Override\n+    public boolean getSkipSilence() {\n+        boolean retVal = false;\n+        if ((playerStatus == PlayerStatus.PLAYING\n+                || playerStatus == PlayerStatus.PAUSED\n+                || playerStatus == PlayerStatus.INITIALIZED\n+                || playerStatus == PlayerStatus.PREPARED)) {\n+            retVal = mediaPlayer.getCurrentSkipSilence();\n+        }\n+        return retVal;\n+    }\n+\n     /**\n      * Sets the playback volume.\n      * This method is executed on an internal executor service.\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\nindex 3ef2e22144..af56661f0b 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n@@ -741,7 +741,7 @@ private void startPlaying(Playable playable, boolean allowStreamThisTime) {\n         }\n \n         if (!playable.getIdentifier().equals(PlaybackPreferences.getCurrentlyPlayingFeedMediaId())) {\n-            PlaybackPreferences.clearCurrentlyPlayingTemporaryPlaybackSpeed();\n+            PlaybackPreferences.clearCurrentlyPlayingTemporaryPlaybackSettings();\n         }\n \n         mediaPlayer.playMediaObject(playable, stream, true, true);\n@@ -1030,7 +1030,7 @@ private Playable getNextInQueue(final Playable currentMedia) {\n      */\n     private void onPlaybackEnded(MediaType mediaType, boolean stopPlaying) {\n         Log.d(TAG, \"Playback ended\");\n-        PlaybackPreferences.clearCurrentlyPlayingTemporaryPlaybackSpeed();\n+        PlaybackPreferences.clearCurrentlyPlayingTemporaryPlaybackSettings();\n         if (stopPlaying) {\n             taskManager.cancelPositionSaver();\n             cancelPositionObserver();\n@@ -1562,8 +1562,15 @@ public void speedPresetChanged(SpeedPresetChangedEvent event) {\n             if (((FeedMedia) getPlayable()).getItem().getFeed().getId() == event.getFeedId()) {\n                 if (event.getSpeed() == SPEED_USE_GLOBAL) {\n                     setSpeed(UserPreferences.getPlaybackSpeed(getPlayable().getMediaType()));\n+                    setSkipSilence(UserPreferences.isSkipSilence());\n                 } else {\n                     setSpeed(event.getSpeed());\n+                    FeedPreferences.SkipSilence skipSilence = event.getSkipSilence();\n+                    if (skipSilence == FeedPreferences.SkipSilence.GLOBAL) {\n+                        setSkipSilence(UserPreferences.isSkipSilence());\n+                    } else {\n+                        setSkipSilence(skipSilence == FeedPreferences.SkipSilence.AGGRESSIVE);\n+                    }\n                 }\n             }\n         }\n@@ -1627,20 +1634,29 @@ public void setSpeed(float speed) {\n             UserPreferences.setPlaybackSpeed(speed);\n         }\n \n-        mediaPlayer.setPlaybackParams(speed, UserPreferences.isSkipSilence());\n+        mediaPlayer.setPlaybackParams(speed, getCurrentSkipSilence());\n     }\n \n-    public void skipSilence(boolean skipSilence) {\n+    public void setSkipSilence(boolean skipSilence) {\n+        PlaybackPreferences.setCurrentlyPlayingTemporarySkipSilence(skipSilence);\n+        UserPreferences.setSkipSilence(skipSilence);\n         mediaPlayer.setPlaybackParams(getCurrentPlaybackSpeed(), skipSilence);\n     }\n \n     public float getCurrentPlaybackSpeed() {\n-        if(mediaPlayer == null) {\n+        if (mediaPlayer == null) {\n             return 1.0f;\n         }\n         return mediaPlayer.getPlaybackSpeed();\n     }\n \n+    public boolean getCurrentSkipSilence() {\n+        if (mediaPlayer == null) {\n+            return false;\n+        }\n+        return mediaPlayer.getSkipSilence();\n+    }\n+\n     public boolean isStartWhenPrepared() {\n         return mediaPlayer.isStartWhenPrepared();\n     }\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/util/playback/PlaybackController.java b/core/src/main/java/de/danoeh/antennapod/core/util/playback/PlaybackController.java\nindex 2274dcf832..f17bd7e318 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/util/playback/PlaybackController.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/util/playback/PlaybackController.java\n@@ -18,6 +18,7 @@\n import de.danoeh.antennapod.model.feed.FeedMedia;\n import de.danoeh.antennapod.event.playback.PlaybackServiceEvent;\n import de.danoeh.antennapod.event.playback.SpeedChangedEvent;\n+import de.danoeh.antennapod.model.feed.FeedPreferences;\n import de.danoeh.antennapod.model.playback.MediaType;\n import de.danoeh.antennapod.core.feed.util.PlaybackSpeedUtils;\n import de.danoeh.antennapod.core.preferences.PlaybackPreferences;\n@@ -407,7 +408,7 @@ public void setPlaybackSpeed(float speed) {\n \n     public void setSkipSilence(boolean skipSilence) {\n         if (playbackService != null) {\n-            playbackService.skipSilence(skipSilence);\n+            playbackService.setSkipSilence(skipSilence);\n         }\n     }\n \n@@ -419,6 +420,15 @@ public float getCurrentPlaybackSpeedMultiplier() {\n         }\n     }\n \n+    public boolean getCurrentPlaybackSkipSilence() {\n+        if (playbackService != null) {\n+            return playbackService.getCurrentSkipSilence();\n+        } else {\n+            return PlaybackSpeedUtils.getCurrentSkipSilencePreference(getMedia())\n+                    == FeedPreferences.SkipSilence.AGGRESSIVE;\n+        }\n+    }\n+\n     public List<String> getAudioTracks() {\n         if (playbackService == null) {\n             return Collections.emptyList();\ndiff --git a/event/src/main/java/de/danoeh/antennapod/event/settings/SpeedPresetChangedEvent.java b/event/src/main/java/de/danoeh/antennapod/event/settings/SpeedPresetChangedEvent.java\nindex 6ca8a1290e..bc7c46785c 100644\n--- a/event/src/main/java/de/danoeh/antennapod/event/settings/SpeedPresetChangedEvent.java\n+++ b/event/src/main/java/de/danoeh/antennapod/event/settings/SpeedPresetChangedEvent.java\n@@ -1,18 +1,26 @@\n package de.danoeh.antennapod.event.settings;\n \n+import de.danoeh.antennapod.model.feed.FeedPreferences;\n+\n public class SpeedPresetChangedEvent {\n     private final float speed;\n+    private final FeedPreferences.SkipSilence skipSilence;\n     private final long feedId;\n \n-    public SpeedPresetChangedEvent(float speed, long feedId) {\n+    public SpeedPresetChangedEvent(float speed, long feedId, FeedPreferences.SkipSilence skipSilence) {\n         this.speed = speed;\n         this.feedId = feedId;\n+        this.skipSilence = skipSilence;\n     }\n \n     public float getSpeed() {\n         return speed;\n     }\n \n+    public FeedPreferences.SkipSilence getSkipSilence() {\n+        return skipSilence;\n+    }\n+\n     public long getFeedId() {\n         return feedId;\n     }\ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedPreferences.java b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedPreferences.java\nindex 8e3dd48f62..ba2631cd8b 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedPreferences.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedPreferences.java\n@@ -58,6 +58,25 @@ public static NewEpisodesAction fromCode(int code) {\n         }\n     }\n \n+    public enum SkipSilence {\n+        OFF(0), GLOBAL(1), AGGRESSIVE(2);\n+\n+        public final int code;\n+\n+        SkipSilence(int code) {\n+            this.code = code;\n+        }\n+\n+        public static SkipSilence fromCode(int code) {\n+            for (SkipSilence s : values()) {\n+                if (s.code == code) {\n+                    return s;\n+                }\n+            }\n+            return GLOBAL;\n+        }\n+    }\n+\n     @NonNull\n     private FeedFilter filter;\n     private long feedID;\n@@ -71,6 +90,7 @@ public static NewEpisodesAction fromCode(int code) {\n     private float feedPlaybackSpeed;\n     private int feedSkipIntro;\n     private int feedSkipEnding;\n+    private SkipSilence feedSkipSilence;\n     private boolean showEpisodeNotification;\n     private final Set<String> tags = new HashSet<>();\n \n@@ -78,13 +98,14 @@ public FeedPreferences(long feedID, boolean autoDownload, AutoDeleteAction autoD\n                            VolumeAdaptionSetting volumeAdaptionSetting, NewEpisodesAction newEpisodesAction,\n                            String username, String password) {\n         this(feedID, autoDownload, true, autoDeleteAction, volumeAdaptionSetting, username, password,\n-                new FeedFilter(), SPEED_USE_GLOBAL, 0, 0, false, newEpisodesAction, new HashSet<>());\n+                new FeedFilter(), SPEED_USE_GLOBAL, 0, 0, SkipSilence.GLOBAL,\n+                false, newEpisodesAction, new HashSet<>());\n     }\n \n     public FeedPreferences(long feedID, boolean autoDownload, boolean keepUpdated,\n                             AutoDeleteAction autoDeleteAction, VolumeAdaptionSetting volumeAdaptionSetting,\n                             String username, String password, @NonNull FeedFilter filter,\n-                            float feedPlaybackSpeed, int feedSkipIntro, int feedSkipEnding,\n+                            float feedPlaybackSpeed, int feedSkipIntro, int feedSkipEnding, SkipSilence feedSkipSilence,\n                             boolean showEpisodeNotification, NewEpisodesAction newEpisodesAction,\n                             Set<String> tags) {\n         this.feedID = feedID;\n@@ -98,6 +119,7 @@ public FeedPreferences(long feedID, boolean autoDownload, boolean keepUpdated,\n         this.feedPlaybackSpeed = feedPlaybackSpeed;\n         this.feedSkipIntro = feedSkipIntro;\n         this.feedSkipEnding = feedSkipEnding;\n+        this.feedSkipSilence = feedSkipSilence;\n         this.showEpisodeNotification = showEpisodeNotification;\n         this.newEpisodesAction = newEpisodesAction;\n         this.tags.addAll(tags);\n@@ -240,6 +262,14 @@ public int getFeedSkipEnding() {\n         return feedSkipEnding;\n     }\n \n+    public void setFeedSkipSilence(SkipSilence skipSilence) {\n+        feedSkipSilence = skipSilence;\n+    }\n+\n+    public SkipSilence getFeedSkipSilence() {\n+        return feedSkipSilence;\n+    }\n+\n     public Set<String> getTags() {\n         return tags;\n     }\ndiff --git a/playback/base/src/main/java/de/danoeh/antennapod/playback/base/PlaybackServiceMediaPlayer.java b/playback/base/src/main/java/de/danoeh/antennapod/playback/base/PlaybackServiceMediaPlayer.java\nindex 73b38c00c9..39ee998843 100644\n--- a/playback/base/src/main/java/de/danoeh/antennapod/playback/base/PlaybackServiceMediaPlayer.java\n+++ b/playback/base/src/main/java/de/danoeh/antennapod/playback/base/PlaybackServiceMediaPlayer.java\n@@ -151,6 +151,8 @@ protected PlaybackServiceMediaPlayer(@NonNull Context context,\n      */\n     public abstract float getPlaybackSpeed();\n \n+    public abstract boolean getSkipSilence();\n+\n     /**\n      * Sets the playback volume.\n      * This method is executed on an internal executor service.\ndiff --git a/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastPsmp.java b/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastPsmp.java\nindex 8f0738e538..fd70fa18cf 100644\n--- a/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastPsmp.java\n+++ b/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastPsmp.java\n@@ -427,6 +427,12 @@ public float getPlaybackSpeed() {\n         return status != null ? (float) status.getPlaybackRate() : 1.0f;\n     }\n \n+    @Override\n+    public boolean getSkipSilence() {\n+        // Don't think this is supported\n+        return false;\n+    }\n+\n     @Override\n     public void setVolume(float volumeLeft, float volumeRight) {\n         Log.d(TAG, \"Setting the Stream volume on Remote Media Player\");\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java\nindex cbac417a98..b7aec5b390 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java\n@@ -334,6 +334,10 @@ static void upgrade(final SQLiteDatabase db, final int oldVersion, final int new\n             db.execSQL(\"ALTER TABLE \" + PodDBAdapter.TABLE_NAME_FEEDS\n                     + \" ADD COLUMN \" + PodDBAdapter.KEY_NEW_EPISODES_ACTION + \" INTEGER DEFAULT 0\");\n         }\n+        if (oldVersion < 3040000) {\n+            db.execSQL(\"ALTER TABLE \" + PodDBAdapter.TABLE_NAME_FEEDS\n+                    + \" ADD COLUMN \" + PodDBAdapter.KEY_FEED_SKIP_SILENCE + \" INTEGER\");\n+        }\n     }\n \n }\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\nindex ccef19dc11..19eb49678e 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n@@ -52,7 +52,7 @@ public class PodDBAdapter {\n \n     private static final String TAG = \"PodDBAdapter\";\n     public static final String DATABASE_NAME = \"Antennapod.db\";\n-    public static final int VERSION = 3010000;\n+    public static final int VERSION = 3040000;\n \n     /**\n      * Maximum number of arguments for IN-operator.\n@@ -113,6 +113,7 @@ public class PodDBAdapter {\n     public static final String KEY_EXCLUDE_FILTER = \"exclude_filter\";\n     public static final String KEY_MINIMAL_DURATION_FILTER = \"minimal_duration_filter\";\n     public static final String KEY_FEED_PLAYBACK_SPEED = \"feed_playback_speed\";\n+    public static final String KEY_FEED_SKIP_SILENCE = \"feed_skip_silence\";\n     public static final String KEY_FEED_SKIP_INTRO = \"feed_skip_intro\";\n     public static final String KEY_FEED_SKIP_ENDING = \"feed_skip_ending\";\n     public static final String KEY_FEED_TAGS = \"tags\";\n@@ -155,6 +156,7 @@ public class PodDBAdapter {\n             + KEY_LAST_UPDATE_FAILED + \" INTEGER DEFAULT 0,\"\n             + KEY_AUTO_DELETE_ACTION + \" INTEGER DEFAULT 0,\"\n             + KEY_FEED_PLAYBACK_SPEED + \" REAL DEFAULT \" + SPEED_USE_GLOBAL + \",\"\n+            + KEY_FEED_SKIP_SILENCE + \" INTEGER DEFAULT \" + FeedPreferences.SkipSilence.GLOBAL.code + \",\"\n             + KEY_FEED_VOLUME_ADAPTION + \" INTEGER DEFAULT 0,\"\n             + KEY_FEED_TAGS + \" TEXT,\"\n             + KEY_FEED_SKIP_INTRO + \" INTEGER DEFAULT 0,\"\n@@ -307,6 +309,7 @@ public class PodDBAdapter {\n             + TABLE_NAME_FEEDS + \".\" + KEY_EXCLUDE_FILTER + \", \"\n             + TABLE_NAME_FEEDS + \".\" + KEY_MINIMAL_DURATION_FILTER + \", \"\n             + TABLE_NAME_FEEDS + \".\" + KEY_FEED_PLAYBACK_SPEED + \", \"\n+            + TABLE_NAME_FEEDS + \".\" + KEY_FEED_SKIP_SILENCE + \", \"\n             + TABLE_NAME_FEEDS + \".\" + KEY_FEED_TAGS + \", \"\n             + TABLE_NAME_FEEDS + \".\" + KEY_FEED_SKIP_INTRO + \", \"\n             + TABLE_NAME_FEEDS + \".\" + KEY_FEED_SKIP_ENDING + \", \"\n@@ -456,6 +459,7 @@ public void setFeedPreferences(FeedPreferences prefs) {\n         values.put(KEY_EXCLUDE_FILTER, prefs.getFilter().getExcludeFilterRaw());\n         values.put(KEY_MINIMAL_DURATION_FILTER, prefs.getFilter().getMinimalDurationFilter());\n         values.put(KEY_FEED_PLAYBACK_SPEED, prefs.getFeedPlaybackSpeed());\n+        values.put(KEY_FEED_SKIP_SILENCE, prefs.getFeedSkipSilence().code);\n         values.put(KEY_FEED_TAGS, prefs.getTagsAsString());\n         values.put(KEY_FEED_SKIP_INTRO, prefs.getFeedSkipIntro());\n         values.put(KEY_FEED_SKIP_ENDING, prefs.getFeedSkipEnding());\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedPreferencesCursorMapper.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedPreferencesCursorMapper.java\nindex 2de100dfff..83b62b8a36 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedPreferencesCursorMapper.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedPreferencesCursorMapper.java\n@@ -31,6 +31,7 @@ public static FeedPreferences convert(@NonNull Cursor cursor) {\n         int indexExcludeFilter = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_EXCLUDE_FILTER);\n         int indexMinimalDurationFilter = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_MINIMAL_DURATION_FILTER);\n         int indexFeedPlaybackSpeed = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_FEED_PLAYBACK_SPEED);\n+        int indexFeedSkipSilence = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_FEED_SKIP_SILENCE);\n         int indexAutoSkipIntro = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_FEED_SKIP_INTRO);\n         int indexAutoSkipEnding = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_FEED_SKIP_ENDING);\n         int indexEpisodeNotification = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_EPISODE_NOTIFICATION);\n@@ -52,6 +53,8 @@ public static FeedPreferences convert(@NonNull Cursor cursor) {\n         float feedPlaybackSpeed = cursor.getFloat(indexFeedPlaybackSpeed);\n         int feedAutoSkipIntro = cursor.getInt(indexAutoSkipIntro);\n         int feedAutoSkipEnding = cursor.getInt(indexAutoSkipEnding);\n+        FeedPreferences.SkipSilence feedSkipSilence =\n+                FeedPreferences.SkipSilence.fromCode(cursor.getInt(indexFeedSkipSilence));\n         FeedPreferences.NewEpisodesAction feedNewEpisodesAction =\n                 FeedPreferences.NewEpisodesAction.fromCode(cursor.getInt(indexNewEpisodesAction));\n         boolean showNotification = cursor.getInt(indexEpisodeNotification) > 0;\n@@ -59,6 +62,7 @@ public static FeedPreferences convert(@NonNull Cursor cursor) {\n         if (TextUtils.isEmpty(tagsString)) {\n             tagsString = FeedPreferences.TAG_ROOT;\n         }\n+\n         return new FeedPreferences(feedId,\n                 autoDownload,\n                 autoRefresh,\n@@ -70,6 +74,7 @@ public static FeedPreferences convert(@NonNull Cursor cursor) {\n                 feedPlaybackSpeed,\n                 feedAutoSkipIntro,\n                 feedAutoSkipEnding,\n+                feedSkipSilence,\n                 showNotification,\n                 feedNewEpisodesAction,\n                 new HashSet<>(Arrays.asList(tagsString.split(FeedPreferences.TAG_SEPARATOR))));\n", "test_patch": "", "problem_statement": "Add \"Skip Silence in Audio\" to Podcast settings\n# Checklist\r\n<!-- Place an x in the boxes to tick them: [x] -->\r\n\r\n- [x] I have used the search function to see if someone else has already submitted the same feature request.\r\n- [x] I will only create one feature request per issue.\r\n- [x] I will describe the problem with as much detail as possible.\r\n\r\n# System info\r\n\r\nF-Droid - 1.8.3 (7f0acbbcf)\r\n\r\n# Feature description\r\n\r\nCurrently playback speed is configurable both globally/ad-hoc and in Podcast settings. I would also like to skip silence in audio to be configurable per-feed. (Personally, I like silence skipped in news and not skipped for audio stories.)\r\n\r\n**Suggested solution**:\r\n\r\nAdd a option \"Skip silence in audio\" under the existing \"Adjust playback speed\" in \"Podcast settings\" with options `Global default`, `Skip silence in audio` and `Do not skip silence in audio`.\n", "hints_text": "What we could do is to learn from the user, which podcast they want to skip silence and which ones they don't (instead of adding yet another option per podcast)\r\n\r\nIf you are playing an episode from feed Y, and you turn on skip silence, then that is turned on for podcast X.\r\n\r\nWe don't introduce this option to the user to select. What do you think?\r\n\r\n@ByteHamster argues for less options, which I agree.\nI think it's best and simpler the way xPMo is describing it.\r\n\r\nIf user turn on skip silence in player it doesn't mean that he wants to do it always for this podcast. Yet settings will have been changed and it could be difficult to be aware of it.\r\nAnd for sure it will leads to more option so you could skip silence but not make it default. Or to temporally allow not to skip.\r\n\r\nBesides if it is automatic then what happens when user changed setting and next episode from another podcast starts? If silence are no longer skipped it would be unexpected. If they are auto settings don't change for this other podcast? Or to trigger auto set on/off for a podcast user would have to do it manually more than x times while playing an episode?\r\n\r\nI can't see how it won't be hard to understand when settings is applied automatically and it's not a good think because it changes what you are listening without telling you.\r\nAlso it wouldn't be logical to have skip silence behavior different than the one for default speed.\r\n\r\nAbout less options I think it's more less advanced user options which normal user would never use. If not specifics settings for podcast shouldn't exist.\nEither way, it should mirror the way playback speed is configured. I think having a scenario would help us make a better decision. Suppose a user has episodes from two feeds queued: X1, Y1, X2.\r\n\r\nSuppose that:\r\n\r\n- while X1 is playing, the user changes speed to x1.5 and enables skip silence\r\n- while Y1 is playing, the user changes speed to x1.25 and disables ss\r\n\r\nWhen X2 plays, what should the speed be set to, and what should the skip silence setting be set to?\r\n\r\nBy the current behavior, it will remain at x1.25 with ss disabled. In order to make it return to x1.5 speed automatically, the user must go to that feed > Podcast Settings > Playback Speed and change the setting from \"Global default\" to the desired speed.\r\nMy proposal is to mirror that behavior with the ss setting.\r\n\r\nHowever, I like the idea that we could be smarter as well. What if in addition to adding a per-feed setting, the audio control panel changes the feed's settings instead of the global settings? In the above scenario, episode X2 would play at x1.5 with ss without the user needing to open Podcast Settings. \n> If you are playing an episode from feed Y, and you turn on skip silence, then that is turned on for podcast X.\r\n>\r\n> We don't introduce this option to the user to select. What do you think?\r\n\r\nTo be honest, I think that this is pretty confusing. The setting would change without users having actively indicated what they want the app to do.\nI think allowing users to set which podcast to skip silence is reasonable. Instead of waiting for a \"final solution\" to come, we can implement simpler things first. \nThe current situation is very confusing. It's difficult to find the Skip Silence setting. It's suprising and frustrating that the setting applies to all podcasts even though it is only set on the full screen of a particular episode.\r\n\r\nIf this is the easiest option to implement, I would be happy enough with it:\r\n> [tonytamsf](https://github.com/tonytamsf) commented [on Nov 21, 2020]\r\n> What we could do is to learn from the user, which podcast they want to skip silence and which ones they don't (instead of adding yet another option per podcast)\r\n\r\nThe setting would apply to a podcast even though it is configured on an episode but it would be a big improvement.\n> instead of adding yet another option per podcast\n\nThere is nothing wrong to give user absolute power to configure settings per podcast. This actually helps user to tailor the settings to their needs based on the podcast type, language, genre, narrator, etc.\n\nImho the most correct way is to add the checkbox to the podcast settings. The app can have auto-detection and etc, but I would argue that it makes the settings very confusing since settings are changing behind the scene and without informing user.\n\nP.s: this is very critical feature and I really miss this feature. Every time I listen to news I have to toggle it on and every time I listen to audiobooks I have to manually toggle it off. This gets annoying very fast. I was hoping there was some updates during the past 3 years.\n\nIs there anything users can do to push this forward?\nI'd like to have a go at this if there's no objections? I've taken a look over the code and I think I roughly know what needs doing.\r\n\r\nIn terms of UX I think adding a setting to the feed settings makes sense.\nNote that adding this feature is harder than it might sound. One has to consider the case where a per-podcast value is set and then a user changes the value on the player screen, similar to what happens with the playback speed. Depending on how much experience you have contributing to open-source applications, it might be better to start with an issue labelled \"good first issue\".\nI was thinking of simplifying by removing the current UI and only allowing change from the feed settings page, unless you want to keep that to not confuse users who expect it to be there?\r\nI don't have a lot of experience with OSS, Java, Android, but I have programmed professionally for > 10 years so I'm hoping I can figure it out. If not then hopefully it will at least provide a starting point for someone else.\nI don't think we should remove the global setting. Most users probably never look at the per-feed settings.\nOk, I'll keep it.\r\n\r\n\"One has to consider the case where a per-podcast value is set and then a user changes the value on the player screen, similar to what happens with the playback speed.\"\r\nCouple of options:\r\n1. Disable with message when per feed setting is set. (Possibly a bit inconvenient, but probably simplest to implement.)\r\n2. Update the per feed setting rather than the global one. (Might be confusing for users expecting a glbal change.)\r\n3. Update global setting and revert feed to use global setting. (Might not be obvious to users that they're changing a feed and global setting.)\r\n4. Same as playback speed, have a checkbox for whether to update globally or per feed. (Presumably if you select global it will revert the feed back to using global similar to option 3.)\r\n\r\nCan add extra UI messages along with any of the above to make the effects clearer to the user.\r\n\r\nPersonally I find it a bit confusing that playback speed changes are global by default rather than scoped to feed, but if that works well for most users then probably best to be consistent.", "created_at": "2024-02-04T16:34:09Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6855, "instance_id": "AntennaPod__AntennaPod-6855", "issue_numbers": ["5246"], "base_commit": "c07ae17962b0fbb757c42e873d9c06cdac3a52ae", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/fragment/FeedSettingsFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/FeedSettingsFragment.java\nindex 7e9c3d093c..c421341652 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/FeedSettingsFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/FeedSettingsFragment.java\n@@ -421,6 +421,9 @@ private void updateNewEpisodesAction() {\n                 case ADD_TO_INBOX:\n                     newEpisodesAction.setSummary(R.string.feed_new_episodes_action_add_to_inbox);\n                     break;\n+                case ADD_TO_QUEUE:\n+                    newEpisodesAction.setSummary(R.string.feed_new_episodes_action_add_to_queue);\n+                    break;\n                 case NOTHING:\n                     newEpisodesAction.setSummary(R.string.feed_new_episodes_action_nothing);\n                     break;\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/storage/DBTasks.java b/core/src/main/java/de/danoeh/antennapod/core/storage/DBTasks.java\nindex d6a4fa1cbc..840ce65f65 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/storage/DBTasks.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/storage/DBTasks.java\n@@ -197,6 +197,7 @@ private static FeedItem searchFeedItemGuessDuplicate(List<FeedItem> items, FeedI\n     public static synchronized Feed updateFeed(Context context, Feed newFeed, boolean removeUnlistedItems) {\n         Feed resultFeed;\n         List<FeedItem> unlistedItems = new ArrayList<>();\n+        List<FeedItem> itemsToAddToQueue = new ArrayList<>();\n \n         PodDBAdapter adapter = PodDBAdapter.getInstance();\n         adapter.open();\n@@ -290,18 +291,26 @@ public static synchronized Feed updateFeed(Context context, Feed newFeed, boolea\n                         savedFeed.getItems().add(idx, item);\n                     }\n \n-                    FeedPreferences.NewEpisodesAction action = savedFeed.getPreferences().getNewEpisodesAction();\n-                    if (action == FeedPreferences.NewEpisodesAction.GLOBAL) {\n-                        action = UserPreferences.getNewEpisodesAction();\n-                    }\n-                    if (action == FeedPreferences.NewEpisodesAction.ADD_TO_INBOX\n-                            && (item.getPubDate() == null\n-                                || priorMostRecentDate == null\n-                                || priorMostRecentDate.before(item.getPubDate())\n-                                || priorMostRecentDate.equals(item.getPubDate()))) {\n-                        Log.d(TAG, \"Marking item published on \" + item.getPubDate()\n-                                + \" new, prior most recent date = \" + priorMostRecentDate);\n-                        item.setNew();\n+                    if (item.getPubDate() == null\n+                            || priorMostRecentDate == null\n+                            || priorMostRecentDate.before(item.getPubDate())\n+                            || priorMostRecentDate.equals(item.getPubDate())) {\n+                        Log.d(TAG, \"Performing new episode action for item published on \" + item.getPubDate()\n+                                + \", prior most recent date = \" + priorMostRecentDate);\n+                        FeedPreferences.NewEpisodesAction action = savedFeed.getPreferences().getNewEpisodesAction();\n+                        if (action == FeedPreferences.NewEpisodesAction.GLOBAL) {\n+                            action = UserPreferences.getNewEpisodesAction();\n+                        }\n+                        switch (action) {\n+                            case ADD_TO_INBOX:\n+                                item.setNew();\n+                                break;\n+                            case ADD_TO_QUEUE:\n+                                itemsToAddToQueue.add(item);\n+                                break;\n+                            default:\n+                                break;\n+                        }\n                     }\n                 }\n             }\n@@ -341,6 +350,9 @@ public static synchronized Feed updateFeed(Context context, Feed newFeed, boolea\n             e.printStackTrace();\n         }\n \n+        // We need to add to queue after items are saved to database\n+        DBWriter.addQueueItem(context, itemsToAddToQueue.toArray(new FeedItem[0]));\n+\n         adapter.close();\n \n         if (savedFeed != null) {\ndiff --git a/core/src/main/res/values/arrays.xml b/core/src/main/res/values/arrays.xml\nindex f72a2e1080..4fb9e7c4d3 100644\n--- a/core/src/main/res/values/arrays.xml\n+++ b/core/src/main/res/values/arrays.xml\n@@ -55,23 +55,27 @@\n \n     <string-array name=\"globalNewEpisodesActionItems\">\n         <item>@string/feed_new_episodes_action_add_to_inbox</item>\n+        <item>@string/feed_new_episodes_action_add_to_queue</item>\n         <item>@string/feed_new_episodes_action_nothing</item>\n     </string-array>\n \n     <string-array name=\"globalNewEpisodesActionValues\">\n         <item>1</item>\n+        <item>3</item>\n         <item>2</item>\n     </string-array>\n \n     <string-array name=\"feedNewEpisodesActionItems\">\n         <item>@string/global_default</item>\n         <item>@string/feed_new_episodes_action_add_to_inbox</item>\n+        <item>@string/feed_new_episodes_action_add_to_queue</item>\n         <item>@string/feed_new_episodes_action_nothing</item>\n     </string-array>\n \n     <string-array name=\"feedNewEpisodesActionValues\">\n         <item>0</item>\n         <item>1</item>\n+        <item>3</item>\n         <item>2</item>\n     </string-array>\n \ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedPreferences.java b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedPreferences.java\nindex 8e3dd48f62..39b6e2bdd5 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedPreferences.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedPreferences.java\n@@ -40,6 +40,7 @@ public static AutoDeleteAction fromCode(int code) {\n     public enum NewEpisodesAction {\n         GLOBAL(0),\n         ADD_TO_INBOX(1),\n+        ADD_TO_QUEUE(3),\n         NOTHING(2);\n \n         public final int code;\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex d7b6aa6cc4..49941ad296 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -139,6 +139,7 @@\n     <string name=\"feed_auto_download_always\">Always</string>\n     <string name=\"feed_auto_download_never\">Never</string>\n     <string name=\"feed_new_episodes_action_add_to_inbox\">Add to inbox</string>\n+    <string name=\"feed_new_episodes_action_add_to_queue\">Add to queue</string>\n     <string name=\"feed_new_episodes_action_nothing\">Nothing</string>\n     <string name=\"episode_cleanup_never\">Never</string>\n     <string name=\"episode_cleanup_except_favorite_removal\">When not favorited</string>\n", "test_patch": "", "problem_statement": "Automatically add new episodes of particular subscription into queue\n# Checklist\r\n<!-- Place an x in the boxes to tick them: [x] -->\r\n\r\n- [x] I have used the search function to see if someone else has already submitted the same feature request.\r\n- [x] I will only create one feature request per issue.\r\n- [x] I will describe the problem with as much detail as possible.\r\n\r\n# System info\r\n\r\n**App version**: 2.2.1\r\n<!-- The latest version may be different depending on your device. You can find the version in AntennaPod's settings. -->\r\n\r\n**App source**: F-Droid\r\n<!-- Please delete irrelevant answer or fill in the blank -->\r\n\r\n# Feature description\r\n\r\n**Problem you may be having, or feature you want**:\r\n<!-- Give a brief explanation about the problem that may currently exist -->\r\n\r\nI have a lot of subscriptions and my workflow is such, that I curate my home tab (Episodes -> New) daily. I remove episodes which I don't intend to listen and add the ones I like to the queue. But there are some subscriptions to which I listen every episode. Right now it is my understanding that I always have to manually add those episodes to the queue (as with the rest of the more infrequent ones). I would appreciate a feature which automatically adds every new episode of a specific subscription directly into my queue.\r\n\r\n**Suggested solution**:\r\n<!-- Describe how your requested feature solves this problem. Try to be as specific as possible. Please not only explain what the feature does, but also how. -->\r\nMaybe a \"favorite\" tag or \"stared\" subscription could be added to individual subscriptions which automatically adds every new episode of them to the queue (e.g. at the end).\r\n\r\n**Screenshots / Drawings / Technical details**:\r\n<!-- If your request is about (or includes) changing or extending the UI, describe what the UI would look like and how the user would interact with it. -->\r\nNIL\n", "hints_text": "I think this is the more appropriate title as my intention isn't to add ALL episodes, just the new ones.\nAlso, I was thinking: If this were implemented, I reckon this would be a per-podcast setting (not based on marking a podcast as favourite or adding a tag). So I made the title more 'neutral' as to how to indicate of which podcasts this should apply to.\nIndeed, this would be best as a per-podcast setting. Maybe like switching the \"Keep Updated\" toggle but with \"Queue episodes\" ?\r\n\r\n![Setting](https://user-images.githubusercontent.com/72392544/123602780-a674f780-d7e8-11eb-820d-ed32bbcc3d9b.png)\r\n\r\n\nYour usage is very similar to mine: many subscriptions, only a couple must-listens.\r\nI wager, like me, you never enabled Automatic Downloads, either.\r\n\r\nBut isn't this a kind of Automatic Download?\r\nShould this be added to the [Rework automatic download/deletion](https://github.com/AntennaPod/AntennaPod/milestone/47) milestone as well?\nYes @lolilolicon, I haven't enabled Automatic Downloads. I almost only stream the episodes directly, as I have no problems with data usage and my goal is being as minimalistic with downloads/storage/cleanups on my phone as possible. So it is probably kind of the same but Automatic Downloads also doesn't show the new episodes automatically in the queue I guess?\n> Automatic Downloads also doesn't show the new episodes automatically in the queue I guess?\r\n\r\nPerhaps (I never really tried it). If not, I apologize, I misunderstood what Automatic Downloads did.\r\n\r\nWhat I was thinking was more \"Automatic Queuing\", which, since I always download (not stream) episodes, adds the episode to playlist & starts downloading (and therefore is to me very close to \"Automatic Download\").\r\n\r\nI might add that I don't quite understand why one would want to (auto- or otherwise) download an episode without adding it to the playlist.\nI'm interested in eventually creating a PR for this.\r\n\r\nWhat do you think about just changing \"Enqueue Downloaded\" option into a \"Auto Enqueue\" selector that can pick between \"All\", \"Downloaded Only\" and \"None\"? Then we can add that same elector to the per-subscription settings with extra (default) option \"Use global setting\".\nThanks @matejdro for considering a PR on this issue. \r\n\r\nI have no insights into the code base but this sounds fantastic to me...\nThis might conflict with a setting that @terminalmage is working on. I would wait until that is done before adding this setting.\n@ByteHamster I should hopefully be able to finish adding the per-feed settings this week. The holidays have been busy. :slightly_smiling_face: \nThinking forward to once #6095 is merged, it seems like implementing this as a `New Episodes Action` would partially conflict with the existing `Enqueue Downloaded` option. `Enqueue Downloaded` (and `Enqueue Location`, both in the settings under `Playback->Queue`) apply to downloaded episodes, but `New Episodes Action` applies to all new episodes, irrespective of whether or not they are downloaded.\r\n\r\n@ByteHamster @keunes What would be the best way to resolve this conflict?\nWhat do you think about my idea above (https://github.com/AntennaPod/AntennaPod/issues/5246#issuecomment-1366468705)? \nOh, very nice. I thought I had read all the comments but I guess I missed that one. I like that idea.\n> What do you think about my idea above (https://github.com/AntennaPod/AntennaPod/issues/5246#issuecomment-1366468705)?\r\n> \"Auto Enqueue\" selector that can pick between \"All\"\r\n\r\nWith \"all\", you mean newly released episodes?\r\nThat doesn't really fit together with \"New episode action\" (options: add to inbox, add to queue, nothing).\nNot sure what you mean by that. What is the \"New episode action\"? Also, what would the difference here be between inbox and queue?\nHuh am I missing something, didn't https://github.com/AntennaPod/AntennaPod/pull/6095 already implement this?\nIt only implemented adding to the inbox, not the queue. But the setting is already prepared for the additional option to add to the queue, so it should be easy to add.\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/new-episode-action-enhancement/3871/1\n", "created_at": "2024-01-03T14:26:07Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6852, "instance_id": "AntennaPod__AntennaPod-6852", "issue_numbers": ["4935"], "base_commit": "fc696428ec3693616c5cb375bea2fdd265abb0a0", "patch": "diff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItem.java b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItem.java\nindex 3ff9589f18..d98d61243b 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItem.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItem.java\n@@ -49,6 +49,7 @@ public class FeedItem extends FeedComponent implements Serializable {\n     private String podcastIndexTranscriptUrl;\n     private String podcastIndexTranscriptType;\n     private String podcastIndexTranscriptText;\n+    private Transcript transcript;\n \n     private int state;\n     public static final int NEW = -1;\n@@ -494,6 +495,14 @@ public void updateTranscriptPreferredFormat(String type, String url) {\n         }\n     }\n \n+    public Transcript getTranscript() {\n+        return transcript;\n+    }\n+\n+    public void setTranscript(Transcript t) {\n+        transcript = t;\n+    }\n+\n     public String getPodcastIndexTranscriptText() {\n         return podcastIndexTranscriptText;\n     }\ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/Transcript.java b/model/src/main/java/de/danoeh/antennapod/model/feed/Transcript.java\nnew file mode 100644\nindex 0000000000..da01c0e58c\n--- /dev/null\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/Transcript.java\n@@ -0,0 +1,28 @@\n+package de.danoeh.antennapod.model.feed;\n+\n+import java.util.Map;\n+import java.util.TreeMap;\n+\n+public class Transcript {\n+\n+    private final TreeMap<Long, TranscriptSegment> segmentsMap = new TreeMap<>();\n+\n+    public void addSegment(TranscriptSegment segment) {\n+        segmentsMap.put(segment.getStartTime(), segment);\n+    }\n+\n+    public TranscriptSegment getSegmentAtTime(long time) {\n+        if (segmentsMap.floorEntry(time) == null) {\n+            return null;\n+        }\n+        return segmentsMap.floorEntry(time).getValue();\n+    }\n+\n+    public int getSegmentCount() {\n+        return segmentsMap.size();\n+    }\n+\n+    public Map.Entry<Long, TranscriptSegment> getEntryAfterTime(long time) {\n+        return segmentsMap.ceilingEntry(time);\n+    }\n+}\ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/TranscriptSegment.java b/model/src/main/java/de/danoeh/antennapod/model/feed/TranscriptSegment.java\nnew file mode 100644\nindex 0000000000..0101bb8ed5\n--- /dev/null\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/TranscriptSegment.java\n@@ -0,0 +1,31 @@\n+package de.danoeh.antennapod.model.feed;\n+\n+public class TranscriptSegment {\n+    private final long startTime;\n+    private final long endTime;\n+    private final String words;\n+    private final String speaker;\n+\n+    public TranscriptSegment(long start, long end, String w, String s) {\n+        startTime = start;\n+        endTime = end;\n+        words = w;\n+        speaker = s;\n+    }\n+\n+    public long getStartTime() {\n+        return startTime;\n+    }\n+\n+    public long getEndTime() {\n+        return endTime;\n+    }\n+\n+    public String getWords() {\n+        return words;\n+    }\n+\n+    public String getSpeaker() {\n+        return speaker;\n+    }\n+}\n\\ No newline at end of file\ndiff --git a/parser/transcript/README.md b/parser/transcript/README.md\nnew file mode 100644\nindex 0000000000..a6ca616125\n--- /dev/null\n+++ b/parser/transcript/README.md\n@@ -0,0 +1,3 @@\n+# :parser:transcript\n+\n+This module provides parsing for transcripts\ndiff --git a/parser/transcript/build.gradle b/parser/transcript/build.gradle\nnew file mode 100644\nindex 0000000000..122c740250\n--- /dev/null\n+++ b/parser/transcript/build.gradle\n@@ -0,0 +1,23 @@\n+plugins {\n+    id(\"com.android.library\")\n+}\n+apply from: \"../../common.gradle\"\n+\n+android {\n+    namespace \"de.danoeh.antennapod.parser.transcript\"\n+}\n+\n+dependencies {\n+    implementation project(':model')\n+\n+    annotationProcessor \"androidx.annotation:annotation:$annotationVersion\"\n+\n+    implementation \"androidx.core:core:$coreVersion\"\n+\n+    implementation \"org.apache.commons:commons-lang3:$commonslangVersion\"\n+    implementation \"commons-io:commons-io:$commonsioVersion\"\n+    implementation \"org.jsoup:jsoup:$jsoupVersion\"\n+\n+    testImplementation \"junit:junit:$junitVersion\"\n+    testImplementation \"org.robolectric:robolectric:$robolectricVersion\"\n+}\ndiff --git a/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/JsonTranscriptParser.java b/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/JsonTranscriptParser.java\nnew file mode 100644\nindex 0000000000..78f3bf9c85\n--- /dev/null\n+++ b/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/JsonTranscriptParser.java\n@@ -0,0 +1,65 @@\n+package de.danoeh.antennapod.parser.transcript;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.json.JSONArray;\n+import org.json.JSONObject;\n+import org.jsoup.internal.StringUtil;\n+\n+import de.danoeh.antennapod.model.feed.Transcript;\n+import de.danoeh.antennapod.model.feed.TranscriptSegment;\n+\n+public class JsonTranscriptParser {\n+    public static Transcript parse(String jsonStr) {\n+        try {\n+            Transcript transcript = new Transcript();\n+            long startTime = -1L;\n+            long endTime = -1L;\n+            long segmentStartTime = -1L;\n+            long duration = 0L;\n+            String speaker = \"\";\n+            String segmentBody = \"\";\n+            JSONObject obj = new JSONObject(jsonStr);\n+            JSONArray objSegments = obj.getJSONArray(\"segments\");\n+\n+            for (int i = 0; i < objSegments.length(); i++) {\n+                JSONObject jsonObject = objSegments.getJSONObject(i);\n+                startTime = Double.valueOf(jsonObject.optDouble(\"startTime\", -1) * 1000L).longValue();\n+                endTime = Double.valueOf(jsonObject.optDouble(\"endTime\", -1) * 1000L).longValue();\n+                if (startTime < 0 || endTime < 0) {\n+                    continue;\n+                }\n+                if (segmentStartTime == -1L) {\n+                    segmentStartTime = startTime;\n+                }\n+                duration += endTime - startTime;\n+\n+                speaker = jsonObject.optString(\"speaker\");\n+                String body = jsonObject.optString(\"body\");\n+                segmentBody += body + \" \";\n+\n+                if (duration >= TranscriptParser.MIN_SPAN) {\n+                    segmentBody = StringUtils.trim(segmentBody);\n+                    transcript.addSegment(new TranscriptSegment(segmentStartTime, endTime, segmentBody, speaker));\n+                    duration = 0L;\n+                    segmentBody = \"\";\n+                    segmentStartTime = -1L;\n+                }\n+            }\n+\n+            if (!StringUtil.isBlank(segmentBody)) {\n+                segmentBody = StringUtils.trim(segmentBody);\n+                transcript.addSegment(new TranscriptSegment(segmentStartTime, endTime, segmentBody, speaker));\n+            }\n+\n+            if (transcript.getSegmentCount() > 0) {\n+                return transcript;\n+            } else {\n+                return null;\n+            }\n+\n+        } catch (org.json.JSONException e) {\n+            e.printStackTrace();\n+        }\n+        return null;\n+    }\n+}\ndiff --git a/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/SrtTranscriptParser.java b/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/SrtTranscriptParser.java\nnew file mode 100644\nindex 0000000000..098dadd994\n--- /dev/null\n+++ b/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/SrtTranscriptParser.java\n@@ -0,0 +1,118 @@\n+package de.danoeh.antennapod.parser.transcript;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.jsoup.internal.StringUtil;\n+\n+import java.util.Arrays;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+import de.danoeh.antennapod.model.feed.Transcript;\n+import de.danoeh.antennapod.model.feed.TranscriptSegment;\n+\n+public class SrtTranscriptParser {\n+    private static final Pattern TIMECODE_PATTERN = Pattern.compile(\"^([0-9]{2}):([0-9]{2}):([0-9]{2}),([0-9]{3})$\");\n+\n+    public static Transcript parse(String str) {\n+        if (StringUtils.isBlank(str)) {\n+            return null;\n+        }\n+        str = str.replaceAll(\"\\r\\n\", \"\\n\");\n+\n+        Transcript transcript = new Transcript();\n+        List<String> lines = Arrays.asList(str.split(\"\\n\"));\n+        Iterator<String> iter = lines.iterator();\n+        String speaker = \"\";\n+        StringBuilder body = new StringBuilder();\n+        String line;\n+        String segmentBody = \"\";\n+        long startTimecode = -1L;\n+        long spanStartTimecode = -1L;\n+        long endTimecode = -1L;\n+        long duration = 0L;\n+\n+        while (iter.hasNext()) {\n+            line = iter.next();\n+\n+            if (line.isEmpty()) {\n+                continue;\n+            }\n+\n+            if (line.contains(\"-->\")) {\n+                String[] timecodes = line.split(\"-->\");\n+                if (timecodes.length < 2) {\n+                    continue;\n+                }\n+                startTimecode = parseTimecode(timecodes[0].trim());\n+                endTimecode = parseTimecode(timecodes[1].trim());\n+                if (startTimecode == -1 || endTimecode == -1) {\n+                    continue;\n+                }\n+\n+                if (spanStartTimecode == -1) {\n+                    spanStartTimecode = startTimecode;\n+                }\n+                duration += endTimecode - startTimecode;\n+                do {\n+                    line = iter.next();\n+                    if (StringUtil.isBlank(line)) {\n+                        break;\n+                    }\n+                    body.append(line.strip());\n+                    body.append(\" \");\n+                } while (iter.hasNext());\n+            }\n+\n+            if (body.indexOf(\":\") != -1) {\n+                String [] parts = body.toString().trim().split(\":\");\n+                if (parts.length < 2) {\n+                    continue;\n+                }\n+                speaker = parts[0];\n+                body = new StringBuilder(parts[1].strip());\n+            }\n+            if (!StringUtil.isBlank(body.toString())) {\n+                segmentBody += \" \" + body;\n+                segmentBody = StringUtils.trim(segmentBody);\n+                if (duration >= TranscriptParser.MIN_SPAN && endTimecode > spanStartTimecode) {\n+                    transcript.addSegment(new TranscriptSegment(spanStartTimecode,\n+                            endTimecode,\n+                            segmentBody,\n+                            speaker));\n+                    duration = 0L;\n+                    spanStartTimecode = -1L;\n+                    segmentBody = \"\";\n+                }\n+                body = new StringBuilder();\n+            }\n+        }\n+\n+        if (!StringUtil.isBlank(segmentBody) && endTimecode > spanStartTimecode) {\n+            segmentBody = StringUtils.trim(segmentBody);\n+            transcript.addSegment(new TranscriptSegment(spanStartTimecode,\n+                    endTimecode,\n+                    segmentBody,\n+                    speaker));\n+        }\n+        if (transcript.getSegmentCount() > 0) {\n+            return transcript;\n+        } else {\n+            return null;\n+        }\n+    }\n+\n+    // Time format 00:00:00,000\n+    static long parseTimecode(String timecode) {\n+        Matcher matcher = TIMECODE_PATTERN.matcher(timecode);\n+        if (!matcher.matches()) {\n+            return -1;\n+        }\n+        long hours = Integer.parseInt(matcher.group(1));\n+        long minutes = Integer.parseInt(matcher.group(2));\n+        long seconds = Integer.parseInt(matcher.group(3));\n+        long milliseconds = Integer.parseInt(matcher.group(4));\n+        return (hours * 60 * 60 * 1000) + (minutes * 60 * 1000) + (seconds * 1000) + milliseconds;\n+    }\n+}\ndiff --git a/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/TranscriptParser.java b/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/TranscriptParser.java\nnew file mode 100644\nindex 0000000000..0a4025d96f\n--- /dev/null\n+++ b/parser/transcript/src/main/java/de/danoeh/antennapod/parser/transcript/TranscriptParser.java\n@@ -0,0 +1,24 @@\n+package de.danoeh.antennapod.parser.transcript;\n+\n+import org.apache.commons.lang3.StringUtils;\n+\n+import de.danoeh.antennapod.model.feed.Transcript;\n+\n+public class TranscriptParser {\n+    static final long MIN_SPAN = 1000L; // merge short segments together to form a span of 1 second\n+\n+    public static Transcript parse(String str, String type) {\n+        if (str == null || StringUtils.isBlank(str)) {\n+            return null;\n+        }\n+\n+        if (\"application/json\".equals(type)) {\n+            return JsonTranscriptParser.parse(str);\n+        }\n+\n+        if (\"application/srt\".equals(type) || \"application/srr\".equals(type) || \"application/x-subrip\".equals(type)) {\n+            return SrtTranscriptParser.parse(str);\n+        }\n+        return null;\n+    }\n+}\ndiff --git a/settings.gradle b/settings.gradle\nindex 3111771e8e..5b7b03d96f 100644\n--- a/settings.gradle\n+++ b/settings.gradle\n@@ -12,6 +12,7 @@ include ':net:sync:model'\n \n include ':parser:feed'\n include ':parser:media'\n+include ':parser:transcript'\n \n include ':playback:base'\n include ':playback:cast'\n", "test_patch": "diff --git a/parser/transcript/src/test/java/de/danoeh/antennapod/parser/transcript/JsonTranscriptParserTest.java b/parser/transcript/src/test/java/de/danoeh/antennapod/parser/transcript/JsonTranscriptParserTest.java\nnew file mode 100644\nindex 0000000000..48996f492c\n--- /dev/null\n+++ b/parser/transcript/src/test/java/de/danoeh/antennapod/parser/transcript/JsonTranscriptParserTest.java\n@@ -0,0 +1,84 @@\n+package de.danoeh.antennapod.parser.transcript;\n+\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.robolectric.RobolectricTestRunner;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+\n+import de.danoeh.antennapod.model.feed.Transcript;\n+\n+@RunWith(RobolectricTestRunner.class)\n+public class JsonTranscriptParserTest {\n+    private static String jsonStr = \"{'version': '1.0.0', \"\n+            + \"'segments': [ \"\n+            + \"{ 'speaker' : 'John Doe', 'startTime': 0.8, 'endTime': 1.9, 'body': 'And' },\"\n+            + \"{ 'speaker' : 'Sally Green', 'startTime': 1.91, 'endTime': 2.8, 'body': 'this merges' },\"\n+            + \"{ 'startTime': 2.9, 'endTime': 3.4, 'body': 'the' },\"\n+            + \"{ 'startTime': 3.5, 'endTime': 3.6, 'body': 'person' }]}\";\n+\n+    @Test\n+    public void testParseJson() {\n+        Transcript result = JsonTranscriptParser.parse(jsonStr);\n+\n+        assertEquals(result.getSegmentAtTime(0L), null);\n+        assertEquals(result.getSegmentAtTime(800L).getSpeaker(), \"John Doe\");\n+        assertEquals(result.getSegmentAtTime(800L).getStartTime(), 800L);\n+        assertEquals(result.getSegmentAtTime(800L).getEndTime(), 1900L);\n+        assertEquals(1910L, (long) result.getEntryAfterTime(1800L).getKey());\n+        // 2 segments get merged into at least 1 second\n+        assertEquals(\"this merges the\", result.getEntryAfterTime(1800L).getValue().getWords());\n+    }\n+\n+    @Test\n+    public void testParse() {\n+        String type = \"application/json\";\n+        Transcript result = TranscriptParser.parse(jsonStr, type);\n+        // There isn't a segment at 900L, so go backwards and get the segment at 800L\n+        assertEquals(result.getSegmentAtTime(900L).getSpeaker(), \"John Doe\");\n+        assertEquals(result.getSegmentAtTime(930L).getWords(), \"And\");\n+\n+        // blank string\n+        String blankStr = \"\";\n+        result = TranscriptParser.parse(blankStr, type);\n+        assertEquals(result, null);\n+\n+        result = TranscriptParser.parse(null, type);\n+        assertEquals(result, null);\n+\n+        // All blank lines\n+        String allNewlinesStr = \"\\r\\n\\r\\n\\r\\n\\r\\n\";\n+        result = TranscriptParser.parse(allNewlinesStr, type);\n+        assertEquals(result, null);\n+\n+        // segments is missing\n+        String jsonStrBad1 = \"{'version': '1.0.0', \"\n+                + \"'segmentsX': [ \"\n+                + \"{ 'speaker' : 'John Doe', 'startTime': 0.8, 'endTime': 1.9, 'body': 'And' },\"\n+                + \"{ 'startTime': 2.9, 'endTime': 3.4, 'body': 'the' },\"\n+                + \"{ 'startTime': 3.5, 'endTime': 3.6, 'body': 'person' }]}\";\n+        result = TranscriptParser.parse(jsonStrBad1, type);\n+        assertEquals(result, null);\n+\n+        // invalid time formatting\n+        String jsonStrBad2 = \"{'version': '1.0.0', \"\n+                + \"'segments': [ \"\n+                + \"{ 'speaker' : 'XJohn Doe', 'startTime': stringTime, 'endTime': stringTime, 'body': 'And' },\"\n+                + \"{ 'XstartTime': 2.9, 'XendTime': 3.4, 'body': 'the' },\"\n+                + \"{ 'startTime': '-2.9', 'endTime': '-3.4', 'body': 'the' },\"\n+                + \"{ 'startTime': 'bad_time', 'endTime': '-3.4', 'body': 'the' }]}\";\n+        result = TranscriptParser.parse(jsonStrBad2, type);\n+        assertNull(result);\n+\n+        // Just plain text\n+        String strBad3 = \"John Doe: Promoting your podcast in a new\\n\\n\"\n+                + \"way. The latest from PogNews.\";\n+        result = TranscriptParser.parse(strBad3, type);\n+        assertNull(result);\n+\n+        // passing the wrong type\n+        type = \"application/srt\";\n+        result = TranscriptParser.parse(jsonStr, type);\n+        assertEquals(result, null);\n+    }\n+}\ndiff --git a/parser/transcript/src/test/java/de/danoeh/antennapod/parser/transcript/SrtTranscriptParserTest.java b/parser/transcript/src/test/java/de/danoeh/antennapod/parser/transcript/SrtTranscriptParserTest.java\nnew file mode 100644\nindex 0000000000..f7854c5bf2\n--- /dev/null\n+++ b/parser/transcript/src/test/java/de/danoeh/antennapod/parser/transcript/SrtTranscriptParserTest.java\n@@ -0,0 +1,93 @@\n+package de.danoeh.antennapod.parser.transcript;\n+\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.robolectric.RobolectricTestRunner;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import de.danoeh.antennapod.model.feed.Transcript;\n+\n+@RunWith(RobolectricTestRunner.class)\n+public class SrtTranscriptParserTest {\n+    private static String srtStr = \"1\\n\"\n+            + \"00:00:00,000 --> 00:00:02,730\\n\"\n+            + \"John Doe: Promoting your podcast in a new\\n\\n\"\n+            + \"2\\n\"\n+            + \"00:00:02,730 --> 00:00:04,600\\n\"\n+            + \"way. The latest from PogNews.\\n\\n\"\n+            + \"00:00:04,730 --> 00:00:05,600\\n\"\n+            + \"way. The latest from PogNews.\";\n+\n+    @Test\n+    public void testParseSrt() {\n+        Transcript result = SrtTranscriptParser.parse(srtStr);\n+\n+        assertEquals(result.getSegmentAtTime(0L).getWords(), \"Promoting your podcast in a new\");\n+        assertEquals(result.getSegmentAtTime(0L).getSpeaker(), \"John Doe\");\n+        assertEquals(result.getSegmentAtTime(0L).getStartTime(), 0L);\n+        assertEquals(result.getSegmentAtTime(0L).getEndTime(), 2730L);\n+        assertEquals((long) result.getEntryAfterTime(1000L).getKey(), 2730L);\n+        assertEquals(result.getEntryAfterTime(1000L).getValue().getWords(), \"way. The latest from PogNews.\");\n+    }\n+\n+    @Test\n+    public void testParse() {\n+        String type = \"application/srr\";\n+        Transcript result;\n+\n+        result = TranscriptParser.parse(srtStr, type);\n+        // There isn't a segment at 800L, so go backwards and get the segment at 0L\n+        assertEquals(result.getSegmentAtTime(800L).getWords(), \"Promoting your podcast in a new\");\n+\n+        result = TranscriptParser.parse(null, type);\n+        assertEquals(result, null);\n+\n+        // blank string\n+        String blankStr = \"\";\n+        result = TranscriptParser.parse(blankStr, type);\n+        assertNull(result);\n+\n+        // All empty lines\n+        String allNewlinesStr = \"\\r\\n\\r\\n\\r\\n\\r\\n\";\n+        result = TranscriptParser.parse(allNewlinesStr, type);\n+        assertEquals(result, null);\n+\n+        // first segment has invalid time formatting, so the entire segment will be thrown out\n+        String srtStrBad1 = \"00:0000,000 --> 00:00:02,730\\n\"\n+                + \"John Doe: Promoting your podcast in a new\\n\\n\"\n+                + \"2\\n\"\n+                + \"00:00:02,730 --> 00:00:04,600\\n\"\n+                + \"way. The latest from PogNews.\";\n+        result = TranscriptParser.parse(srtStrBad1, type);\n+        assertEquals(result.getSegmentAtTime(2730L).getWords(), \"way. The latest from PogNews.\");\n+\n+        // first segment has invalid time in end time, 2nd segment has invalid time in both start time and end time\n+        String srtStrBad2 = \"00:00:00,000 --> 00:0002,730\\n\"\n+                + \"Jane Doe: Promoting your podcast in a new\\n\\n\"\n+                + \"2\\n\"\n+                + \"badstarttime --> badendtime\\n\"\n+                + \"way. The latest from PogNews.\\n\"\n+                + \"badstarttime -->\\n\"\n+                + \"Jane Doe says something\\n\"\n+                + \"00:00:00,000 --> 00:00:02,730\\n\"\n+                + \"Jane Doe:\";\n+        result = TranscriptParser.parse(srtStrBad2, type);\n+        assertNull(result);\n+\n+        // Just plain text\n+        String strBad3 = \"John Doe: Promoting your podcast in a new\\n\\n\"\n+                + \"way. The latest from PogNews.\";\n+        result = TranscriptParser.parse(strBad3, type);\n+        assertNull(result);\n+\n+        // passing the wrong type\n+        type = \"application/json\";\n+        result = TranscriptParser.parse(srtStr, type);\n+        assertEquals(result, null);\n+\n+        type = \"unknown\";\n+        result = TranscriptParser.parse(srtStr, type);\n+        assertEquals(result, null);\n+    }\n+}\n+\n", "problem_statement": "Support for podcast:transcript tag\n# Checklist\r\n<!-- Place an x in the boxes to tick them: [x] -->\r\n\r\n- [x] I have used the search function to see if someone else has already submitted the same feature request.\r\n- [x] I will only create one feature request per issue.\r\n- [x] I will describe the problem with as much detail as possible\r\n\r\n# Feature description\r\nSome podcasts include text transcript using `podcast:transcipt`\r\n\r\n**Suggested solution**:\r\nDisplay transcript and sync it with the audio.\r\n\r\nMeeting notes from Nov 2nd, 2023 https://github.com/AntennaPod/AntennaPod/issues/4935#issuecomment-1791614891\r\n\n", "hints_text": "@keunes or @ByteHamster please assign to me, since I have the podcastindex namespace parsing done in #4933, I could tackle `podcast:transcript`\nI have a a few suggestions for transcript related features I think  would be great to include in AntennaPod (originally mentioned in https://github.com/AntennaPod/AntennaPod/issues/5002):\r\n\r\n1. Optionally including timestamps when copying from the trancsript. This would be helpful when using a noteapp to write down interesting segments from the podcast as it makes it easier to go back to the podcast an relisten to the particular segment.\r\n2.  Having the transcript autoscroll as the episode is playing, so when switching to the transcript tab, the text is in the same position as the audio. This would facilitate notetaking while listening.\r\n3. Searching the transcript. I am referring to searching within a single transcript , which would make it easier to find interesting segments (which in turn could be navigated to if combined with the below item).\r\n4. Using the transcript for seeking in the audio (clicking sentences to jump to that position).\r\n\r\nThere are currently at least two podcast apps on iOS that provide some of these features, but none on Android as far as I know. Those apps are https://podcast9.com/ and https://www.airr.io/. They are labeling themselves as more educational / productive alternatives to regular podcast apps and their main value proposition is the ability to interact with and remember what you listen to as well as easily share your favorite bits with others.\r\n\r\nA future item to consider which might be out of scope currently is to automatically create transcripts for episodes that don't provide it, e.g. using the live transcribe feature on phones where it is available.\nNice ideas \ud83d\udc4d My guess would be that # 4 wouldn't be too difficult. But for the others I guess we (the app) would need to receive the timestamps with the transcript I think - as I reckon it's not feasible for AP to automatically match the text with the audio. Do you know if transcripts typically have such timestamps?\nThanks @keunes ! I am not very experienced with podcast data and metadata, but I looked around a bit and it seems like at least some transcripts provide this. The [example used on the podcastindex API docs](https://podcastindex-org.github.io/docs-api/#get-/episodes/byid) page includes this segment:\r\n\r\n```json\r\ntranscriptUrl: \"https://mp3s.nashownotes.com/NA-1322-Captions.srt\"\r\n```\r\n\r\nThat srt file includes timestamps which look like this:\r\n\r\n```srt\r\n1\r\n00:00:00,000 --> 00:00:05,340\r\nPull my mask over my nose. Adam\r\nCurry John C Dvorak, Thursday,\r\n\r\n2\r\n00:00:05,340 --> 00:00:09,030\r\nFebruary 18 2021. This is your\r\naward winning media\r\n\r\n3\r\n00:00:09,030 --> 00:00:13,380\r\nassassination Episode 13. This\r\nis no agenda.\r\n\r\n...\r\n```\r\n\r\nI am not sure how common it is, but at least it exists.\r\n\r\nA complimentary approach that is less robust but does not rely on external data could be to match the relative position of sentences in the transcript with the relative time of the audio file (when no timestamps are available). Even if this was only able to generate precision to the minute, I think it would be helpful for most items I mentioned above. For some, like the scrolling text, it would probably perform quite well since so much of the transcript would be shown on the screen that the matched position does not have to be exact. It would probably benefit from calculating the relative audio position without silences (I noted that there is already an option in AP to skip these when listening).\r\n\nI like to add an idea mentioned in the issue above: **hide empty tabs** - that could be empty transcripts and especially nonexistent chapters, if only one tab remains the tablayout itself should probably be hidden.\r\n\r\nI think thats a sensible solution, to not crowd the AudioPlayer with empty tabs and require to user to swipe a thousand times to get to the desired tab, makes the UX clearer :)\n@tonytamsf Any idea how to implement the data store? Downloading all transcripts of all episodes could result in a huge amount of text to be stored. We already have the problem that the database is pretty big. I think it would be better to only store the URLs and then load the transcript when actually viewing the transcript page in AntennaPod. We could enable caching with okhttp to reduce the number of web requests. \n> @tonytamsf Any idea how to implement the data store? Downloading all transcripts of all episodes could result in a huge amount of text to be stored. We already have the problem that the database is pretty big. I think it would be better to only store the URLs and then load the transcript when actually viewing the transcript page in AntennaPod. We could enable caching with okhttp to reduce the number of web requests.\r\n\r\nI like your idea, there is no need to store transcription.  Depending on the user, they may not want to be downloading transcript using mobile data, so we might have to get user consent to use mobile to download transcript.\nWhy not storing transcript on file text on device? Same way episodes are stored. They would be removed along with episodes and it would allow to make them available like episodes are.\r\n\r\nEdit :\r\nAnd it won't clutter database except maybe to put a flag to know there is transcript downloaded. I am not sure it's even needed as all logics would be parallel to what is done for downloaded episodes.\nSounds like a good idea. When streaming, users need a data connection anyways. When downloading, we can download the transcripts, too. :+1:\n> Why not storing transcript on file text on device?\n\nI'm just wondering: this wouldn't hinder 'processing' the info (esp. timestamps, for # 4 in OP).\n\n> When downloading, we can download the transcripts, too\n\nJust to throw an idea out: couldn't this be done, but then in the db? As in, download & store in db when episode is downloaded; remove from dB when file is deleted? (Don't know if this would have any actual benefit, see above).\nI don't think storing and using text files would cause any problem : it is what video player does with srt files for subtitles.\nStoring it in the database but only for downloaded episodes should work :) Then we don't need to store the file path, we can just store the transcript directly.\nDon't know if you saw how Podverse implemented transcript with search. For reference there is a video of what they did : https://twitter.com/Podverse/status/1413642917760184325?s=19\r\n\r\nIMHO about their screen : \r\n- I would prefer timecode on left side and with a smaller font and using grey as text color. So time code would be there but won't distract your eyes when reading transcription\r\n- I wouldn't separate block like they did. It's like there is an empty line beetween each segment which is annoying when reading\nThanks for sharing that @Matth7878!\r\n\r\n> I would prefer timecode on left side and with a smaller font and using grey as text color\r\n\r\nFully agree\r\n\r\n> I wouldn't separate block like they did\r\n\r\nI understand your point, but we can't really merge sentences that are separated into two blocks I think:\r\n* we don't know where we can stitch parts together, and where a hard enter should be kept (in the interface). If there's no whitespace, it might still be complicated to read:\r\n![Schermafdruk van 2021-07-11 10-45-14](https://user-images.githubusercontent.com/11229646/125188759-38432280-e235-11eb-89f0-e0ce24a2ffff.png)\r\n* if we do stitch together the sentences, there might be a situation where one line on the screen covers three lines in the transcript file. Then we can only display the first timestamp, which can be problematic in some cases (e.g. when there is a line with `[silence]` that takes a minute - you wouldn't be able to jump to the bit after the silence).\r\n\nLet me take a stab at getting the podcast:transcript tag to download and stored.  Then we can work on the UI on the next step\n> Let me take a stab at getting the podcast:transcript tag to download and stored. Then we can work on the UI on the next step\r\n\r\nSorry I have been taking a break from AntennaPod.  I'm un-assigning myself until I get back\n\r\n> Sorry I have been taking a break from AntennaPod. I'm un-assigning myself until I get back\r\n\r\nI'm back with my beloved AP app. I'll start working on downloading the transcript\nAny thoughts about the support of all 4 content types in the `<podcast:transcript>` tag?\r\n\r\nSpec: https://github.com/Podcastindex-org/podcast-namespace/blob/main/transcripts/transcripts.md\r\n\r\n* HTML - this format has no or limited timecode - I recommend that we ignore this\r\n* JSON - Much more flexible - we should fully support this, I'm searching for sample podcast that use this format (not seeing it yet)\r\n* SRT - great for video or audio, max number of lines 2, max chars 32 - I recommend we support this fully\r\n* WebVTT - for HTML on the web, I recommend we don't support this\r\n\r\nExample: https://podnews.net/rss\r\n\r\n```\r\n<podcast:transcript url=\"https://podnews.net/audio/podnews230310.mp3.vtt\" type=\"text/vtt\" />\r\n<podcast:transcript url=\"https://podnews.net/audio/podnews230310.mp3.srt\" type=\"application/srt\" />\r\n<podcast:transcript url=\"https://podnews.net/audio/podnews230310.mp3.txt\" type=\"text/plain\" />\r\n<podcast:transcript url=\"https://podnews.net/audio/podnews230310.mp3.srt\" type=\"application/x-subrip\" rel=\"captions\" />\r\n```\r\n\r\nIt looks like Podnews also provides `text/pain` which is not in the Podcast 2.0 spec\r\n\r\n@jamescridland I am a loyal listener of Podnews, is there a reason you don't have JSON version of `podcast:transcript`?  \r\n\r\nExample: Podcasting 2.0 https://feeds.podcastindex.org/pc20.xml\r\n\r\nIt uses the SRT format \r\n`<podcast:transcript url=\"https://mp3s.nashownotes.com/PC20-125-Captions.srt\" type=\"application/srt\" rel=\"captions\"/>`\n@ByteHamster - do you have objections if I pull in this code to parse SRT files? https://github.com/gusthavosouza/SRTParser.\r\n\r\nI'm contacting the author about the missing license file his source code.\r\n\r\nIf you prefer I write my parser, I could do that.  It's not that hard.  Before I embark, I wanted to hear your opinion.\n> HTML - this format has no or limited timecode - I recommend that we ignore this\n\nAgreed.\n\nSupporting JSON & SRT is quite nice already.\n@tonytamsf I can't generate JSON transcripts - whisper.cpp is what I use, and it doesn't make them.\r\n\r\nI agree that supporting all four is redundant, and would agree with your suggestion to cease support for VTT. VTT seems to have been chosen because of support from libraries; but it seems to me that we are offering too many formats here for sensible support. It's not complicated to make an SRT using the same tools as that might make a VTT.\r\n\r\n(Edited) I was under the impression that support for HTML was as a simple link to a full web page with a transcript. This doesn't appear to be the case, and I believe that we should also remove this. So, we end up with (in preference order):\r\n\r\n1. JSON files for word-by-word closed-captioning, editing, etc.\r\n2. SRT files for closed-captioning (max 32 char length)\r\n\r\n(I shall also go and remove the TXT format from the Podnews feed; but will keep the VTT file there).\n> Any thoughts about the support of all 4 content types in the `<podcast:transcript>` tag?\r\n> \r\n> Spec: https://github.com/Podcastindex-org/podcast-namespace/blob/main/transcripts/transcripts.md\r\n> \r\n> * HTML - this format has no or limited timecode - I recommend that we ignore this\r\n> * JSON - Much more flexible - we should fully support this, I'm searching for sample podcast that use this format (not seeing it yet)\r\n> * SRT - great for video or audio, max number of lines 2, max chars 32 - I recommend we support this fully\r\n> * WebVTT - for HTML on the web, I recommend we don't support this\r\n> \r\n> Example: https://podnews.net/rss\r\n> \r\n> ```\r\n> <podcast:transcript url=\"https://podnews.net/audio/podnews230310.mp3.vtt\" type=\"text/vtt\" />\r\n> <podcast:transcript url=\"https://podnews.net/audio/podnews230310.mp3.srt\" type=\"application/srt\" />\r\n> <podcast:transcript url=\"https://podnews.net/audio/podnews230310.mp3.txt\" type=\"text/plain\" />\r\n> <podcast:transcript url=\"https://podnews.net/audio/podnews230310.mp3.srt\" type=\"application/x-subrip\" rel=\"captions\" />\r\n> ```\r\n> \r\n> It looks like Podnews also provides `text/pain` which is not in the Podcast 2.0 spec\r\n> \r\n> @jamescridland I am a loyal listener of Podnews, is there a reason you don't have JSON version of `podcast:transcript`?\r\n> \r\n> Example: Podcasting 2.0 https://feeds.podcastindex.org/pc20.xml\r\n> \r\n> It uses the SRT format `<podcast:transcript url=\"https://mp3s.nashownotes.com/PC20-125-Captions.srt\" type=\"application/srt\" rel=\"captions\"/>`\r\n\r\n@tonytamsf, @jamescridland, `text/plain` is mentioned [here](https://github.com/Podcastindex-org/podcast-namespace/blob/main/docs/1.0.md#transcript) but not [here](https://github.com/Podcastindex-org/podcast-namespace/blob/main/transcripts/transcripts.md).\nI don't get this removing supported formats business.  VTT is the only format supported natively by browsers, and like SRT+ in many ways but a proper w3c standard.  If some of the first apps to take a stab at implementing don't support all formats, that's on them (and will improve with time) - no need to penalize everyone else by removing valuable stuff from the spec.  We should encourage the server side to push as much signal out to the world as they can.\n> I don't get this removing supported formats business. VTT is the only format supported natively by browsers\r\n\r\nNote that this issue is about support for the transcript tag in AntennaPod. First I thought that HTML was pointless, but I see now that it has a (different) use case - outside of the scope of this issue.\r\n\r\nMaybe let's create a separate issue in the PC namespace repo about this wider (PC namespace) topic.\nAh, sorry - followed a clickbaity link from [podnews](https://podnews.net/update/size-matters), and thought this was referring to the spec itself!\r\n\r\n> [Should we drop support for VTT and even HTML file support](https://github.com/AntennaPod/AntennaPod/issues/4935#issuecomment-1465273529?utm_source=podnews.net&utm_medium=web&utm_campaign=podnews.net:2023-03-13) for the podcast:transcript tag?\r\n\n> do you have objections if I pull in this code to parse SRT files? https://github.com/gusthavosouza/SRTParser.\r\n\r\nIf the license allows that, it should be okay. Probably needs some changes, though, because we only want English comments and maybe don't need all the features.\n> because we only want English comments\r\n\r\nDo we? With 'comments' do you refer to the actual transcripts (subtitles)? If a user has their device in French and there are transcripts/subtitles available in French, why not use that instead.\r\n\r\nSide note on implementation: I would be in favour of storing the transcript 'on drive' for downloaded episodes. As we've discussed for chapters, it's probably too big for in the database, and retrieving it only on playtime causes issues like #6062.\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/podcast-subtitles/3365/4\n\n@keunes - I'm done with the data parsing for JSON and working on the SRT format now for `<podcast:transcript>`.  After I'm done with the data storage, I would like some mockups on how transcription would work in the AP app.\r\n\r\n1. How does transcription display while an episode is being played?  Does it by default hover as an overlay and users can click on the words to jump into a full timecode view?\r\n2. In the timecode full transcription view, I assume the user can scroll back and forward to view the transcription and tap on a timecode to jump into the audio?  Would each word highlight to follow along the audio?\r\n3. The user can copy and paste any portion transcript?\r\n4. Without the overlay of the words, can users jump to view the transcript before listening, how would that work?\r\n5. Propose Phase 2 : Can users search the transcripts in one episode, across all episodes and subscriptions?\nYeey. That's great news @tonytamsf!\n\nLet me try to reply to some of your questions:\n\n> How does transcription display while an episode is being played? Does it by default hover as an overlay and users can click on the words to jump into a full timecode view?\n\nBy default this 'live subtitling' should be enabled/visible in the full player, for discoverability (there are not yet many feeds with this tag, so we want to show it when it's available). It should be possible via a setting in the UI section to disable this. (I expect that someone at some point will ask to make this a setting at podcast level, e.g. to only turn it on for their language learning, but let's see.)\n\nWe'll need a mock-up for this. We can probably take inspiration from some of the other apps who have enabled this already. To make it work nicely, we might have to make some design/UI changes.\n\n> In the timecode full transcription view, I assume the user can scroll back and forward to view the transcription and tap on a timecode to jump into the audio?\n\nYes. We'll need a mock-up for this.\n\n> Would each word highlight to follow along the audio?\n\nDepends. It's not always possible at word-level. E.g. SRT/VTT does not \u2013 here I think we should highlight each fragment.\n\nIn any case, I think the highlighting should be quite subtle (and I'm wondering if it's acceptable if e.g. highlight colour is not visible to visually impaired/does not comply with accessibility standards). We'll need a mock-up for this.\n\nhttps://github.com/Podcastindex-org/podcast-namespace/blob/main/transcripts/transcripts.md\n\n(~~Which transcript file types do you support at thi point?~~ I see it's SRT and JSON.)\n\n>  The user can copy and paste any portion transcript?\n\nYes.\n\n> Without the overlay of the words, can users jump to view the transcript before listening, how would that work?\n\nYes, this should be possible. I made a proposal a long time ago here, following user feedback on a beta version: https://forum.antennapod.org/t/user-feedback-swipe-navigation-from-player-screen-2-3-beta/1119\n\nIt's probably a lot of work to implement, bit I still stand behind the UX concept.\n\n(As a back-up, there should probably be an entry in the overflow menu.)\n\n> Propose Phase 2 : Can users search the transcripts in one episode, across all episodes and subscriptions?\n\nThat would be cool indeed. Certainly *within* the current episode (e.g. to find the section where they talk about X). Global search is an entirely separate thing.\n> I made a proposal a long time ago here... It's probably a lot of work to implement, bit I still stand behind the UX concept. (As a back-up, there should probably be an entry in the overflow menu.)\r\n\r\nThat's outside the scope of this PR (and would need some discussion). For now, I would do the overflow button. There is enough to discuss about the subtitles dialog/page itself\nI have a working PR that can parse, scroll through the transcript while following the audio.   Feel free to download a test version and give some feedback. \r\n I use `Podnews Daily` to do my test https://github.com/AntennaPod/AntennaPod/pull/6710\r\n\r\nUnfortunately, after sampling podcasts that I am subscribed to, the state of the transcript format is still not super well supported.  Here is a sample of of 104 feeds\r\n\r\n# Podcasts sampling\r\n- Roblox Tech Talk - `text/plain` https://share.transistor.fm/s/39ce510f/transcript.txt\r\n   -  parsable with timecoees\r\n-  Dev Interrupted - `text/html` https://feeds.buzzsprout.com/1422892/10190284/transcript\r\n   - not parsable\r\n- The Method - json & 'text/html' https://feeds.buzzsprout.com/1859927/9638130/transcript\r\n   - html not parsable\r\n   - json is fine https://feeds.buzzsprout.com/1859927/9638130/transcript.json\r\n   - (only 2 episode)\r\n- Radical Candor - `application/x-subrip` https://freepodcasttranscription.com/transcription/5e6070b67882e784d6b5baf4b19976bb717f1115.srt\r\n   - parsable\r\n- Indie Bites - `text/plain` https://share.transistor.fm/s/6cdce2f8/transcript.txt (no timecodes)\r\n  - not parsable\r\n- The Golden Hour - `text/html` https://www.podcastone.com/episode/Someones-Getting-Tased--The-Golden-Hour-51-w/-Brendan-Schaub-Erik-Griffin--Chris-DElia?view=transcript\r\n   - not parsable\nHi, really exciting times for AntennaPod and Podcsting in general. I've been doing some research about the use of transcript in the Podcasting 2.0 namespace.\r\n- I've found that even these mime types being equivalent `text/srt` `application/srt` `application/x-subrip` most player don't support all 3, so in in a \"test\" feed I declare all for the same file. \r\n- SRT is the most used format, then JSON, VTT and TXT (but these are usually full transcripts, not subtitle with parsable timecodes)\r\n\r\nIn case is useful, I have a feed with different options of redirect/hosting with different formats and mime-types if you want to test different edge cases, as discussed here : https://github.com/podverse/podverse-web/issues/1168#issuecomment-1695231077\r\nProbably the redirect / hosting part is no problem here as that part was for testing CORS in different web players. (Gitlab Pages works best with web players than Archive if something is interested)\r\n\r\n```\r\nEpisode 16\r\nOp3+ archive.org + vtt only\r\n\r\nEpisode 15\r\nOp3+ gitlab + vtt only\r\n\r\nEpisode 09\r\nOp3 + gitlab + vtt\r\nOp3 + archive + srt\r\n\r\nEpisode 08 (without OP3)\r\nGitlab + vtt\r\nArchive + srt\r\n\r\nEpisode Episode 00\r\nOp3 + gitlab + vtt/srt\r\n\r\nAll others\r\nOP3 + archive + vtt/srt\r\n```\r\nA problem that I've found with some player, in case you want to take it into account, is that if there is first a transcript tag with a file that doesn't work, some player won't try the next tag that would work.\r\n\r\nFeed:\r\nhttps://kdeexpress.gitlab.io/feed\r\n\r\n**TL;NR**\r\n\r\nI would prioritize SRT parsing, then JSON and if there is no much trouble VTT given the similarities with SRT. \r\nFor `text/html` and `text/plain` I would either show a new screen with all the text just assuming that is the full transcript to read or just offer a link to be open in the web browser.\nI'd jump in here and say two things:\r\n\r\nThe accurate stat is [contained here](https://stats.podcastindex.org/hourly_counts.json) - which at the time of writing is: \r\n\r\n>    \"feedsWithTranscripts\": 38,255\r\n>    \"episodesWithTranscripts\": 1,379,606\r\n\r\nThere's obviously a chicken and egg scenario with support. If AntennaPod supports transcripts, it would be a significant benefit to podcasting as a whole, but also to the uptake of this feature. But you'll get considerable promotion when this is launched. (I will, as one guarantee, give you a headline story in Podnews.)\r\n\r\nSecondly; might I suggest you ideally support these in this format:\r\n\r\n1. JSON - this is accurate to the word level, and allows [this kind of highlighted transcript](https://www.steno.fm/show/9b024349-ccf0-5f69-a609-6b82873eab3c/episode/aHR0cHM6Ly9wb2RuZXdzLm5ldC91cGRhdGUvZ2Vuei1mYXN0ZXN0LWdyb3dpbmc=), where the individual word being said is highlighted on screen. That also allows you to lay out closed-captions in a very bespoke way - allowing you to properly wordwrap them. It also allows more features in future like clipping, where you could highlight a word or sentence, and have the app specifically clip that accurately.\r\n\r\n2. SRT - these are accurate to about 32 characters, and therefore the timing isn't as perfect as it could be. [It works like this](https://www.steno.fm/show/917393e3-1b1e-5cef-ace4-edaa54e1f810/episode/YTQ2OWE5ZmQtMzVlOC00MDNhLWIzMDUtZGEyNmU3MDE1ZjBh). \r\n\r\nI'd, frankly, not support TXT or HTML unless you really want to - my suspicion is that these are relatively poorly supported anyway. But it doesn't seem like a heavy lift to simply open these in a webview. (I'm also very unclear if anyone is using VTT.)\r\n\r\nI hope that helps a bit!\n> If AntennaPod supports transcripts\r\n\r\nThanks for chipping in @jamescridland - one of our contributors is already working on this functionality. Hope we can coordinate re your coverage when it gets released. :-)\r\n\r\n> JSON \u2026 That also allows you to lay out closed-captions in a very bespoke way - allowing you to properly wordwrap them\r\n\r\nSee, that's what I was thinking. But I'm also wondering: how. Let's say it is at word level, how do you wrap that into the traditional two lines neatly? Starting from the first word (with its time stamp) and fill up the two lines until the screen is full, and take the end-time of the last word as the end-time for these two lines? Do you 'hard break' when there's a comma, or a period? What about speaker changes?\r\n\r\nI feel that SRT - given that it's the provider's responsibility to make it work with the character limit - often will provide a more logical view (even if less accurate).\r\n\r\nEither way - I'm very happy that both SRT & JSON already can be fetched and parsed \ud83d\ude00\nThank you @jamescridland for the details, it is helpful.\n\nWhat would be helpful for me when I am implementing the transcript feature is to look at other Android apps that are supporting the transcript tag.  Do you recommend an app that has implemented this feature well and taken advantage of the JSON word level time code? \n[Podverse](https://github.com/podverse) could be a reference. [The web displays](https://podverse.fm/es/episode/hazS_hcJz) 1 word per line :-1: , but the mobile (-rn repo) app shows the full sentence :+1: . So I assume it's using a word level JSON.\r\nIn the Android app each line on sentences is a placeholder for the audio timestamps, not exactly a word by word. [Steno.fm](https://www.steno.fm/show/396d9ae0-da7e-5557-b894-b606231fa3ea/episode/QnV6enNwcm91dC0xMzgwNjg5Nw==) is 1 by 1, but I don't think it's open source :-1: \r\n\r\n![imagen](https://github.com/AntennaPod/AntennaPod/assets/2069735/ae51a17b-13b0-4928-934c-9c49b2156130)\r\n![imagen](https://github.com/AntennaPod/AntennaPod/assets/2069735/2d31a517-72df-4b48-9da9-00c957dc6f04)\r\n\n> What would be helpful for me when I am implementing the transcript feature is to look at other Android apps that are supporting the transcript tag.\n\n@tonytamsf Sorry for the silence on my end. I've been doing a comparative analysis of all the We/Android apps that support the transcript tag and will at some point this weekend share a couple of nice examples.\nHello,\r\n\r\nI've thought and designed a bit more over the weekend. Please find below some recordings of (web) apps that I particularly liked, and a link to some mock-ups I made.\r\n\r\nInspiration\r\n---\r\nI tested all Android & web-[apps listed on the Podcast Index website](https://podcastindex.org/apps?appTypes=podcast+player&elements=Transcript) that support the Transcript tag and are accessible without log-in. I always checked  episode [1601 - \"Unkool & The Gang\"](https://podcastindex.org/podcast/41504?episode=15754728488) of No agenda. It has [this SRT captions file](https://mp3s.nashownotes.com/NA-1601-Captions.srt). Here is [the podcast's RSS feed](https://feeds.noagendaassets.com/noagenda.xml).\r\n\r\n### Podfriend **\r\nCool because: has nicely designed subtitles, with different colours, and speaker images.\r\n\r\nhttps://github.com/AntennaPod/AntennaPod/assets/11229646/aa6d70d0-77d6-42dd-9d5a-ec7557145dd6\r\n\r\n### Steno **\r\ncool because: grouping of source content into blocks per speaker, highlighting background of actively playing blocks as well as selected block (when paused or searching)\r\n[Try for yourself](https://www.steno.fm/show/856cd618-7f34-57ea-9b84-3600f1f65e7f/episode/aHR0cDovLzE2MDEubm9hZ2VuZGFub3Rlcy5jb20=) - my recording is too big for GitHub.\r\n\r\n### Podfans *\r\ncool because: has up/down arrows in search bar, nice design of timestamps (thin + lighter colour - should try that in my mock-ups too, althgouh they only seem to use mm:ss, not hh)\r\n![Screenshot from 2023-10-29 23-16-03 podfans](https://github.com/AntennaPod/AntennaPod/assets/11229646/e94b019e-d7ba-4824-8c67-de9c5a9459a0)\r\n\r\n### Fountain *\r\ncool because: has a little (i) icon with info about the transcript timings - noting they \"might not be accurate if the podcaster has dynamic ads.\" --> not in mock-ups yet\r\n![Screenshot from 2023-10-29 23-09-47 Fountain](https://github.com/AntennaPod/AntennaPod/assets/11229646/007f0bdd-4fe6-40af-8100-a4cac7b4c1af)\r\n\r\n### Anytime Player *\r\ncool because: has 'follow transcript' toggle, the way scrolling position follows active block\r\n![Screenshot from 2023-10-29 23-13-14 anytime player](https://github.com/AntennaPod/AntennaPod/assets/11229646/350b356a-f936-4b2f-8a55-20c0aae2038d)\r\n\r\n### Podcast Addict\r\ncool because: has option in the player settings to (de)activate subtitles\r\n\r\nMock-up & general considerations\r\n---\r\n\r\nPlease find here the mock-ups I have so far: https://design.penpot.app/#/view/e357a320-7535-11eb-8a88-eb0147e048f5?page-id=eae2ba44-fe23-80be-8003-5736fde8c987&section=interactions&index=0&share-id=b509ea44-7222-80be-8003-5db588cbed16\r\n\r\nSome notes:\r\n* Several apps leverage speaker indication (either name + colon in SRT, or as metadata in JSON). It would be really neat if we can do that too. \r\n  * Steno 'collates' blocks - [Nathan explained how](https://mastodon.social/@keunes/111305523569815424).\r\n  * Podfriend & Anytime Player somehow connect speaker info from the subtitles with info from the `person` tags within the item (episode)\r\n```\r\n<podcast:person href=\"http://curry.com/\" img=\"https://upload.wikimedia.org/wikipedia/commons/thumb/d/d5/Adam_Curry_2016.jpg/440px-Adam_Curry_2016.jpg\" group=\"cast\" role=\"host\">Adam Curry</podcast:person>\r\n<podcast:person href=\"http://dvorak.org/blog\" img=\"https://speaking.com/wp-content/uploads/2018/09/John-Dvorak.jpg\" group=\"cast\" role=\"host\">John C Dvorak</podcast:person>\r\n```\r\n* I think we'll have to first identify if we have or can extract speakers, and adjust the design of the player & transcript screens for it. Yet maybe speaker indication (especially on the player screen) might be out of scope for now.\r\n* I kept the playback controls visible on purpose - I think it's handy to be able to pause and rewind when viewing the transcript.\r\n\r\n_The first set of screens you'll see are  in case there are speakers extracted/known, which can be displayed on the player screen. Followed by some screens where this is not the case. There's also some other details. Maybe it's best if we have a call @tonytamsf & @ByteHamster to see what's feasible for now._\n@keunes Thanks for the great research and screen casts of other players.   I can try to join the next community call about this topic if finding time is difficult \nWe'll be meeting to discuss the mock-ups Thursday 2 November at 21:00 CET, over at https://meet.antennapod.org/transcripts. Anyone interested in this UX review is welcome to join.\nAs discussed and agreed during the meeting:\r\n* implement as full-screen dialog (https://m3.material.io/components/dialogs/overview)\r\n* what to do with landscape player view? For now, easy implementation on the right-hand side.\r\n* store transcript SRT/JSON in filesystem\r\n* if there's word-level JSON without speaker:\r\n  * collate text blocks\r\n    * Sentence-based (using periods & question marks)\r\n    * If long pause, start new block\r\n    * If long single block without period, then break it up after x (30?) seconds\r\n  * combine highlighting in blocks of min. 1 second (e.g. 2 words) to avoid words being skipped due to 1-second refresh rate.\r\n\r\nDesign change to do:\r\n* tap on CC in player, open transcript dialog\r\n* setting to show/hide closed caption (TBC if in player settings or only in global>UI settings)\r\n\r\nIn separate PRs:\r\n* playback controls in transcript view\r\n* option to reach transcript from ep. detail page; show 'can't jump to postion' warning\r\n* Search in transcript\r\n* Speaker tag (parse & store; display in ep. details; display speaker photo in player screen)\nWe will be targeting the `transcript` branch on Github for this work.  Starting with PR https://github.com/AntennaPod/AntennaPod/pull/6739\nI have a test build of how we can display transcripts in 2 lines of text on the player screen.\n\nIt works for JSON (word by word) or SRT (a few seconds of text).\n\nThe way I am able to nicely display the transcript is as follows\n\n- join up segments of text at least one second, most json segments are less than 1 second\n- string together N segments and display them on the two lines of TextView, which has support for ellipses \n- when I detect an ellipse in the TexView, which means words are cut off at the end, start trimming words from the end until the display does not have ellipses. \n- move the words that have been ellipsed to the next segment, and  trimming a little more to get some buffer\n- calculate a reasonable (percentage of words trimmed) new start time of the next segment \n- display the text sync to the position of the audio\n- move to the next segment\n\n@keunes I would like to give this test build to you and maybe just one of two others (maybe @jamescridland ) to test out against different podcasts which have transcripts to make sure the algorithm works. I would like to do this before the code reviews because that will take many weeks while we can fine tune how transcripts will function in the UI.  \n\nnote: detecting words will be difficult with languages like Chinese and Arabic\n@keunes - I have a test build of the transcript functionality in the 3rd PR, it will display 2 lines of transcript in the player screen.  When you have time, please check out it.  If you wanted more podcasts that have the transcript tag to see the variety of how folks format their transcripts, I have crawl all 4 million podcasts from podcastindex.org found the [15233 urls](https://github.com/tonytamsf/podcastindex_data/blob/main/data/transcripts.podcasts.txt) of the podcasts which have at least one podcast:transcript tag\r\n\r\n- PR 3 https://github.com/tonytamsf/AntennaPod/pull/6/checks\r\n- Artifact https://github.com/AntennaPod/AntennaPod/suites/17875428651/artifacts/1026186509", "created_at": "2024-01-02T17:47:24Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6846, "instance_id": "AntennaPod__AntennaPod-6846", "issue_numbers": ["6695"], "base_commit": "de8bc4ad30910d4b2429a95eb7358afa679728dd", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/dialog/SubscriptionsFilterDialog.java b/app/src/main/java/de/danoeh/antennapod/dialog/SubscriptionsFilterDialog.java\nindex cf77c28380..929e6b1ad6 100644\n--- a/app/src/main/java/de/danoeh/antennapod/dialog/SubscriptionsFilterDialog.java\n+++ b/app/src/main/java/de/danoeh/antennapod/dialog/SubscriptionsFilterDialog.java\n@@ -1,42 +1,49 @@\n package de.danoeh.antennapod.dialog;\n \n-import android.content.Context;\n+import android.app.Dialog;\n+import android.os.Bundle;\n import android.text.TextUtils;\n import android.view.LayoutInflater;\n import android.view.View;\n+import android.view.ViewGroup;\n import android.widget.Button;\n+import android.widget.FrameLayout;\n import android.widget.LinearLayout;\n-\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import com.google.android.material.bottomsheet.BottomSheetBehavior;\n+import com.google.android.material.bottomsheet.BottomSheetDialog;\n+import com.google.android.material.bottomsheet.BottomSheetDialogFragment;\n import com.google.android.material.button.MaterialButtonToggleGroup;\n-import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n-\n-import org.greenrobot.eventbus.EventBus;\n-\n-import java.util.Arrays;\n-import java.util.HashSet;\n-import java.util.Set;\n-\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.core.feed.SubscriptionsFilterGroup;\n+import de.danoeh.antennapod.databinding.FilterDialogBinding;\n import de.danoeh.antennapod.databinding.FilterDialogRowBinding;\n import de.danoeh.antennapod.event.UnreadItemsUpdateEvent;\n import de.danoeh.antennapod.model.feed.SubscriptionsFilter;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n+import org.greenrobot.eventbus.EventBus;\n \n-public class SubscriptionsFilterDialog {\n-    public static void showDialog(Context context) {\n-        SubscriptionsFilter subscriptionsFilter = UserPreferences.getSubscriptionsFilter();\n-        final Set<String> filterValues = new HashSet<>(Arrays.asList(subscriptionsFilter.getValues()));\n-        MaterialAlertDialogBuilder builder = new MaterialAlertDialogBuilder(context);\n-        builder.setTitle(context.getString(R.string.pref_filter_feed_title));\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.Set;\n \n-        LayoutInflater inflater = LayoutInflater.from(context);\n-        View layout = inflater.inflate(R.layout.filter_dialog, null, false);\n-        LinearLayout rows = layout.findViewById(R.id.filter_rows);\n-        builder.setView(layout);\n+public class SubscriptionsFilterDialog extends BottomSheetDialogFragment {\n+    private LinearLayout rows;\n+\n+    @Nullable\n+    @Override\n+    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container,\n+            @Nullable Bundle savedInstanceState) {\n+        SubscriptionsFilter subscriptionsFilter = UserPreferences.getSubscriptionsFilter();\n+        FilterDialogBinding dialogBinding = FilterDialogBinding.inflate(inflater);\n+        rows = dialogBinding.filterRows;\n \n         for (SubscriptionsFilterGroup item : SubscriptionsFilterGroup.values()) {\n             FilterDialogRowBinding binding = FilterDialogRowBinding.inflate(inflater);\n+            binding.getRoot().addOnButtonCheckedListener(\n+                    (group, checkedId, isChecked) -> updateFilter(getFilterValues()));\n             binding.buttonGroup.setWeightSum(item.values.length);\n             binding.filterButton1.setText(item.values[0].displayName);\n             binding.filterButton1.setTag(item.values[0].filterId);\n@@ -50,38 +57,72 @@ public static void showDialog(Context context) {\n             binding.filterButton1.setSingleLine(false);\n             binding.filterButton2.setMaxLines(3);\n             binding.filterButton2.setSingleLine(false);\n-            rows.addView(binding.getRoot());\n+            rows.addView(binding.getRoot(), rows.getChildCount() - 1);\n         }\n \n+        final Set<String> filterValues = new HashSet<>(Arrays.asList(subscriptionsFilter.getValues()));\n         for (String filterId : filterValues) {\n             if (!TextUtils.isEmpty(filterId)) {\n-                Button button = layout.findViewWithTag(filterId);\n+                Button button = dialogBinding.getRoot().findViewWithTag(filterId);\n                 if (button != null) {\n                     ((MaterialButtonToggleGroup) button.getParent()).check(button.getId());\n                 }\n             }\n         }\n \n-        builder.setPositiveButton(R.string.confirm_label, (dialog, which) -> {\n-            filterValues.clear();\n+        dialogBinding.confirmFiltermenu.setOnClickListener(view -> {\n+            updateFilter(getFilterValues());\n+            dismiss();\n+        });\n+        dialogBinding.resetFiltermenu.setOnClickListener(view -> {\n+            updateFilter(Collections.emptySet());\n             for (int i = 0; i < rows.getChildCount(); i++) {\n-                if (!(rows.getChildAt(i) instanceof MaterialButtonToggleGroup)) {\n-                    continue;\n-                }\n-                MaterialButtonToggleGroup group = (MaterialButtonToggleGroup) rows.getChildAt(i);\n-                if (group.getCheckedButtonId() == View.NO_ID) {\n-                    continue;\n-                }\n-                String tag = (String) group.findViewById(group.getCheckedButtonId()).getTag();\n-                if (tag == null) { // Clear buttons use no tag\n-                    continue;\n+                if (rows.getChildAt(i) instanceof MaterialButtonToggleGroup) {\n+                    ((MaterialButtonToggleGroup) rows.getChildAt(i)).clearChecked();\n                 }\n-                filterValues.add(tag);\n             }\n-            updateFilter(filterValues);\n         });\n-        builder.setNegativeButton(R.string.cancel_label, null);\n-        builder.show();\n+        return dialogBinding.getRoot();\n+    }\n+\n+    private Set<String> getFilterValues() {\n+        Set<String> filterValues = new HashSet<>();\n+        for (int i = 0; i < rows.getChildCount(); i++) {\n+            if (!(rows.getChildAt(i) instanceof MaterialButtonToggleGroup)) {\n+                continue;\n+            }\n+            MaterialButtonToggleGroup group = (MaterialButtonToggleGroup) rows.getChildAt(i);\n+            if (group.getCheckedButtonId() == View.NO_ID) {\n+                continue;\n+            }\n+            String tag = (String) group.findViewById(group.getCheckedButtonId()).getTag();\n+            if (tag == null) { // Clear buttons use no tag\n+                continue;\n+            }\n+            filterValues.add(tag);\n+        }\n+        return filterValues;\n+    }\n+\n+    @NonNull\n+    @Override\n+    public Dialog onCreateDialog(@Nullable Bundle savedInstanceState) {\n+        Dialog dialog = super.onCreateDialog(savedInstanceState);\n+        dialog.setOnShowListener(dialogInterface -> {\n+            BottomSheetDialog bottomSheetDialog = (BottomSheetDialog) dialogInterface;\n+            setupFullHeight(bottomSheetDialog);\n+        });\n+        return dialog;\n+    }\n+\n+    private void setupFullHeight(BottomSheetDialog bottomSheetDialog) {\n+        FrameLayout bottomSheet = bottomSheetDialog.findViewById(R.id.design_bottom_sheet);\n+        if (bottomSheet != null) {\n+            BottomSheetBehavior<FrameLayout> behavior = BottomSheetBehavior.from(bottomSheet);\n+            ViewGroup.LayoutParams layoutParams = bottomSheet.getLayoutParams();\n+            bottomSheet.setLayoutParams(layoutParams);\n+            behavior.setState(BottomSheetBehavior.STATE_EXPANDED);\n+        }\n     }\n \n     private static void updateFilter(Set<String> filterValues) {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/NavDrawerFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/NavDrawerFragment.java\nindex eeca181cfc..636c0245b6 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/NavDrawerFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/NavDrawerFragment.java\n@@ -382,7 +382,7 @@ public void onItemClick(int position) {\n                 }\n             } else if (UserPreferences.getSubscriptionsFilter().isEnabled()\n                     && navAdapter.showSubscriptionList) {\n-                SubscriptionsFilterDialog.showDialog(requireContext());\n+                new SubscriptionsFilterDialog().show(getChildFragmentManager(), \"filter\");\n             }\n         }\n \ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/SubscriptionFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/SubscriptionFragment.java\nindex 93ed4c2c97..7006edca9a 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/SubscriptionFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/SubscriptionFragment.java\n@@ -166,7 +166,8 @@ public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMen\n         });\n \n         feedsFilteredMsg = root.findViewById(R.id.feeds_filtered_message);\n-        feedsFilteredMsg.setOnClickListener((l) -> SubscriptionsFilterDialog.showDialog(requireContext()));\n+        feedsFilteredMsg.setOnClickListener((l) ->\n+                new SubscriptionsFilterDialog().show(getChildFragmentManager(), \"filter\"));\n \n         SwipeRefreshLayout swipeRefreshLayout = root.findViewById(R.id.swipeRefresh);\n         swipeRefreshLayout.setDistanceToTriggerSync(getResources().getInteger(R.integer.swipe_refresh_distance));\n@@ -221,7 +222,7 @@ public boolean onMenuItemClick(MenuItem item) {\n             FeedUpdateManager.runOnceOrAsk(requireContext());\n             return true;\n         } else if (itemId == R.id.subscriptions_filter) {\n-            SubscriptionsFilterDialog.showDialog(requireContext());\n+            new SubscriptionsFilterDialog().show(getChildFragmentManager(), \"filter\");\n             return true;\n         } else if (itemId == R.id.subscriptions_sort) {\n             FeedSortDialog.showDialog(requireContext());\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/UserInterfacePreferencesFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/UserInterfacePreferencesFragment.java\nindex 66f592af26..c8521caab8 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/UserInterfacePreferencesFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/UserInterfacePreferencesFragment.java\n@@ -71,7 +71,7 @@ private void setupInterfaceScreen() {\n                 });\n         findPreference(UserPreferences.PREF_FILTER_FEED)\n                 .setOnPreferenceClickListener((preference -> {\n-                    SubscriptionsFilterDialog.showDialog(requireContext());\n+                    new SubscriptionsFilterDialog().show(getChildFragmentManager(), \"filter\");\n                     return true;\n                 }));\n \n", "test_patch": "", "problem_statement": "Add reset button to subscriptions filter\n### Checklist\r\n\r\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\r\n\r\n### App version\r\n\r\n3.0\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Problem you may be having, or feature you want\r\n\r\nAdd reset button to bottom filter dialog located under episodes tab\r\n\r\n### Suggested solution\r\n\r\n_No response_\r\n\r\n### Screenshots / Drawings / Technical details\r\n\r\n_No response_\n", "hints_text": "", "created_at": "2024-01-02T07:32:00Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6843, "instance_id": "AntennaPod__AntennaPod-6843", "issue_numbers": ["6787"], "base_commit": "de8bc4ad30910d4b2429a95eb7358afa679728dd", "patch": "diff --git a/ui/echo/src/main/java/de/danoeh/antennapod/ui/echo/EchoActivity.java b/ui/echo/src/main/java/de/danoeh/antennapod/ui/echo/EchoActivity.java\nindex 00b03a2798..aec031d30f 100644\n--- a/ui/echo/src/main/java/de/danoeh/antennapod/ui/echo/EchoActivity.java\n+++ b/ui/echo/src/main/java/de/danoeh/antennapod/ui/echo/EchoActivity.java\n@@ -10,6 +10,7 @@\n import android.graphics.drawable.Drawable;\n import android.net.Uri;\n import android.os.Bundle;\n+import android.text.format.DateFormat;\n import android.util.Log;\n import android.util.Pair;\n import android.view.KeyEvent;\n@@ -268,7 +269,8 @@ private void loadScreen(int screen, boolean force) {\n                     viewBinding.aboveLabel.setText(\"\");\n                     viewBinding.largeLabel.setText(R.string.echo_thanks_large);\n                     if (oldestDate < jan1()) {\n-                        SimpleDateFormat dateFormat = new SimpleDateFormat(\"MMMM yyyy\", getEchoLanguage());\n+                        String skeleton = DateFormat.getBestDateTimePattern(getEchoLanguage(), \"MMMM yyyy\");\n+                        SimpleDateFormat dateFormat = new SimpleDateFormat(skeleton, getEchoLanguage());\n                         String dateFrom = dateFormat.format(new Date(oldestDate));\n                         viewBinding.belowLabel.setText(getString(R.string.echo_thanks_we_are_glad_old, dateFrom));\n                     } else {\ndiff --git a/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/subscriptions/PlaybackStatisticsListAdapter.java b/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/subscriptions/PlaybackStatisticsListAdapter.java\nindex 3936118caa..9b1f234c8b 100644\n--- a/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/subscriptions/PlaybackStatisticsListAdapter.java\n+++ b/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/subscriptions/PlaybackStatisticsListAdapter.java\n@@ -1,5 +1,6 @@\n package de.danoeh.antennapod.ui.statistics.subscriptions;\n \n+import android.text.format.DateFormat;\n import androidx.fragment.app.Fragment;\n import de.danoeh.antennapod.core.storage.StatisticsItem;\n import de.danoeh.antennapod.core.util.Converter;\n@@ -39,7 +40,8 @@ protected String getHeaderCaption() {\n         if (includeMarkedAsPlayed) {\n             return context.getString(R.string.statistics_counting_total);\n         }\n-        SimpleDateFormat dateFormat = new SimpleDateFormat(\"MMM yyyy\", Locale.getDefault());\n+        String skeleton = DateFormat.getBestDateTimePattern(Locale.getDefault(), \"MMM yyyy\");\n+        SimpleDateFormat dateFormat = new SimpleDateFormat(skeleton, Locale.getDefault());\n         String dateFrom = dateFormat.format(new Date(timeFilterFrom));\n         // FilterTo is first day of next month => Subtract one day\n         String dateTo = dateFormat.format(new Date(timeFilterTo - 24L * 3600000L));\ndiff --git a/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/subscriptions/StatisticsFilterDialog.java b/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/subscriptions/StatisticsFilterDialog.java\nindex 077883321a..e46e482403 100644\n--- a/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/subscriptions/StatisticsFilterDialog.java\n+++ b/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/subscriptions/StatisticsFilterDialog.java\n@@ -2,6 +2,7 @@\n \n import android.content.Context;\n import android.content.SharedPreferences;\n+import android.text.format.DateFormat;\n import android.view.LayoutInflater;\n import android.widget.ArrayAdapter;\n import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n@@ -114,7 +115,8 @@ private Pair<String[], Long[]> makeMonthlyList(long oldestDate, boolean inclusiv\n         date.set(Calendar.DAY_OF_MONTH, 1);\n         ArrayList<String> names = new ArrayList<>();\n         ArrayList<Long> timestamps = new ArrayList<>();\n-        SimpleDateFormat dateFormat = new SimpleDateFormat(\"MMM yyyy\", Locale.getDefault());\n+        String skeleton = DateFormat.getBestDateTimePattern(Locale.getDefault(), \"MMM yyyy\");\n+        SimpleDateFormat dateFormat = new SimpleDateFormat(skeleton, Locale.getDefault());\n         while (date.getTimeInMillis() < System.currentTimeMillis()) {\n             names.add(dateFormat.format(new Date(date.getTimeInMillis())));\n             if (!inclusive) {\n", "test_patch": "", "problem_statement": "Dates are not translated correctly\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.2.0-beta2\n\n### Where did you get the app from\n\nOther\n\n### Android version\n\nAndroid 10\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n_No response_\n\n### Expected behaviour\n\nIn Spanish (and probably in other languages), the dates on AntennaPod echo are not translated correctly. While the month is correctly translated, the formatting is kept as in English, making it unnatural to read, for example: _January 2024_ is translated to _enero 2023_, while it should be translated to _enero **de** 2023_\n\n### Current behaviour\n\n_No response_\n\n### Logs\n\n_No response_\n", "hints_text": "Looks like we need this: https://developer.android.com/reference/android/text/format/DateFormat#getBestDateTimePattern(java.util.Locale,%20java.lang.String) The documentation explicitly talks about Spanish. The starting point for the implementation would be EchoActivity. The same should probably also be done on the statistics screen, where we display a similar type of time stamp.", "created_at": "2024-01-01T15:05:36Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6842, "instance_id": "AntennaPod__AntennaPod-6842", "issue_numbers": ["6799"], "base_commit": "f476086114a56d214558f37b066849150a141390", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/fragment/QueueFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/QueueFragment.java\nindex a1aa7226d8..80933023e5 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/QueueFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/QueueFragment.java\n@@ -523,7 +523,7 @@ private void refreshInfoBar() {\n             }\n             info += \" \u2022 \";\n             info += getString(R.string.time_left_label);\n-            info += Converter.getDurationStringLocalized(getActivity(), timeLeft);\n+            info += Converter.getDurationStringLocalized(getResources(), timeLeft, false);\n         }\n         infoBar.setText(info);\n     }\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/util/Converter.java b/core/src/main/java/de/danoeh/antennapod/core/util/Converter.java\nindex d9c4a50980..30464969bc 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/util/Converter.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/util/Converter.java\n@@ -83,14 +83,16 @@ public static int durationStringShortToMs(String input, boolean durationIsInHour\n      * Converts milliseconds to a localized string containing hours and minutes.\n      */\n     public static String getDurationStringLocalized(Context context, long duration) {\n-        return getDurationStringLocalized(context.getResources(), duration);\n+        return getDurationStringLocalized(context.getResources(), duration, false);\n     }\n \n-    public static String getDurationStringLocalized(Resources resources, long duration) {\n+    public static String getDurationStringLocalized(Resources resources, long duration, boolean includeDays) {\n         String result = \"\";\n         int h = (int) (duration / HOURS_MIL);\n         int d = h / 24;\n-        if (d > 0) {\n+        if (!includeDays) {\n+            d = 0;\n+        } else if (d > 0) {\n             String days = resources.getQuantityString(R.plurals.time_days_quantified, d, d);\n             result += days.replace(\" \", \"\\u00A0\") + \" \";\n             h -= d * 24;\ndiff --git a/ui/echo/src/main/java/de/danoeh/antennapod/ui/echo/EchoActivity.java b/ui/echo/src/main/java/de/danoeh/antennapod/ui/echo/EchoActivity.java\nindex 92adaed2ed..50b34b6e38 100644\n--- a/ui/echo/src/main/java/de/danoeh/antennapod/ui/echo/EchoActivity.java\n+++ b/ui/echo/src/main/java/de/danoeh/antennapod/ui/echo/EchoActivity.java\n@@ -210,7 +210,7 @@ private void loadScreen(int screen, boolean force) {\n                     int daysUntil2024 = Math.max(356 - Calendar.getInstance().get(Calendar.DAY_OF_YEAR) + 1, 1);\n                     long secondsPerDay = queueSecondsLeft / daysUntil2024;\n                     String timePerDay = Converter.getDurationStringLocalized(\n-                            getLocalizedResources(this, getEchoLanguage()), secondsPerDay * 1000);\n+                            getLocalizedResources(this, getEchoLanguage()), secondsPerDay * 1000, true);\n                     double hoursPerDay = (double) (secondsPerDay / 3600);\n                     if (hoursPerDay < 1.5) {\n                         viewBinding.aboveLabel.setText(R.string.echo_queue_title_clean);\n@@ -235,7 +235,7 @@ private void loadScreen(int screen, boolean force) {\n                     }\n                     viewBinding.smallLabel.setText(getString(R.string.echo_listened_after_time,\n                             Converter.getDurationStringLocalized(\n-                                getLocalizedResources(this, getEchoLanguage()), timeBetweenReleaseAndPlay)));\n+                                getLocalizedResources(this, getEchoLanguage()), timeBetweenReleaseAndPlay, true)));\n                     currentDrawable = new RotatingSquaresScreen(this);\n                     break;\n                 case 4:\n", "test_patch": "", "problem_statement": "Allow to display the remaining duration of queued episode in hours\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.2.0\n\n### Where did you get the app from\n\nF-Droid\n\n### Problem you may be having, or feature you want\n\nSince the latest update, the remaining duration of queued episodes is displayed in days and hours instead of hours and minutes. I miss especially the minutes. If feel uncomfortable with it.\n\n### Suggested solution\n\nAdd an option in the menu to display the remaining in the old format.\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "> Add an option in the menu to display the remaining in the old format\n\nThis is so minor, that it doesn't deserve a setting. See also our project values here: https://antennapod.org/about/\n\n> Since the latest update, the remaining duration of queued episodes is displayed in days and hours instead of hours and minutes\n\nAs far as I'm aware, no changes were made to the display of the time left in the queue.\n\nThere is a threshold, however, at which we don't display the minutes anymore. I suspect that is when you have so many items in the queue that we display the number of days.\n\nI'm not in favour of changing this, because displaying the number of days and hours and minute, would make for a cluttered UI.\n\nWhat we might consider, is putting a higher threshold, such that we only start displaying the number of days starting from 49 hours.\n\n> I miss especially the minutes. If feel uncomfortable with it.\n\nAs a workaround, I would suggest listening to some episodes or removing some from your queue \ud83d\ude09\nThere actually was a change to the queue time display. It was not deliberate, it was caused by changes in Echo. But maybe we want to keep it. I don't know.\nI don't know what it was or now is, but what do you think of the following?\n\n> only start displaying the number of days starting from 49 hours\n\nSo that it would be like\n* 34 minutes\n* 3 hours 12 minutes\n* 48 hours 53 minutes\n* 2 days\n* 2 days 1 hour\nThe new format is:\r\n- 34 minutes\r\n- 3 hours 12 minutes\r\n- 1 day 3 hours \r\n\r\nThe previous format was only hours and minutes:\r\n- 34 minutes\r\n- 49 hours 53 minutes\r\n- 96 hours 27 minutes\r\n\r\nAs @ByteHamster said it was changed 2 weeks ago with Echo (https://github.com/AntennaPod/AntennaPod/pull/6780/files#diff-d70ca325eaa25ee01731c60b749c2014d1b7a1e7bcaaa26e18e0440e15330e83). The format hadn't changed prior to that since 2015.\r\n\r\nPersonally I queue up roughly 30 hours every week so this allows me gauge how many weeks I'm behind on my queue by dividing the time left hours by 30. When this is displayed in days this is no longer a simple calculation and a higher threshold doesn't solve this problem.\r\n\r\nI understand not wanting to add clutter to the UI as the original format was hours, minutes and seconds, so the change to only hours and minutes was an acceptable reduction. The current change to include days is a change in usability more than clutter and I would also prefer it to return to the previous hours and minutes format. \nI second being able to use the previous formatting, I usually use the remaining time to figure out how many times it fits into my transit, knowing i have about an hour-and-a-half a day. With the new formatting i just have to do more mental math.\r\n\r\nThat said, it is of course a minor foible, and i'll survive either way - Thanks for working on AntennaPod, I switched to it years ago now, and it's been rock solid!", "created_at": "2024-01-01T14:55:50Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6838, "instance_id": "AntennaPod__AntennaPod-6838", "issue_numbers": ["6806"], "base_commit": "c81157f0e6185d11f6a9e23106c87be846977c49", "patch": "diff --git a/app/src/main/res/layout/nextcloud_auth_dialog.xml b/app/src/main/res/layout/nextcloud_auth_dialog.xml\nindex c08c5b969b..0f25a271f5 100644\n--- a/app/src/main/res/layout/nextcloud_auth_dialog.xml\n+++ b/app/src/main/res/layout/nextcloud_auth_dialog.xml\n@@ -1,69 +1,75 @@\n <?xml version=\"1.0\" encoding=\"utf-8\"?>\n-<LinearLayout\n+<ScrollView\n     xmlns:android=\"http://schemas.android.com/apk/res/android\"\n     android:layout_width=\"match_parent\"\n-    android:layout_height=\"wrap_content\"\n-    android:padding=\"16dp\"\n-    android:orientation=\"vertical\"\n-    android:clipToPadding=\"false\">\n+    android:layout_height=\"wrap_content\">\n \n-    <TextView\n-        android:layout_width=\"wrap_content\"\n-        android:layout_height=\"wrap_content\"\n-        android:layout_marginBottom=\"16dp\"\n-        android:text=\"@string/synchronization_host_explanation\" />\n-\n-    <com.google.android.material.textfield.TextInputLayout\n-        android:id=\"@+id/serverUrlTextInput\"\n+    <LinearLayout\n         android:layout_width=\"match_parent\"\n         android:layout_height=\"wrap_content\"\n-        android:layout_marginBottom=\"16dp\"\n-        style=\"@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox\">\n+        android:padding=\"16dp\"\n+        android:orientation=\"vertical\"\n+        android:clipToPadding=\"false\">\n+\n+        <TextView\n+            android:layout_width=\"wrap_content\"\n+            android:layout_height=\"wrap_content\"\n+            android:layout_marginBottom=\"16dp\"\n+            android:text=\"@string/synchronization_host_explanation\" />\n \n-        <com.google.android.material.textfield.TextInputEditText\n-            android:id=\"@+id/serverUrlText\"\n+        <com.google.android.material.textfield.TextInputLayout\n+            android:id=\"@+id/serverUrlTextInput\"\n             android:layout_width=\"match_parent\"\n             android:layout_height=\"wrap_content\"\n-            android:hint=\"@string/synchronization_host_label\"\n-            android:inputType=\"textNoSuggestions\"\n-            android:lines=\"1\"\n-            android:imeOptions=\"actionNext|flagNoFullscreen\" />\n+            android:layout_marginBottom=\"16dp\"\n+            style=\"@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox\">\n \n-    </com.google.android.material.textfield.TextInputLayout>\n+            <com.google.android.material.textfield.TextInputEditText\n+                android:id=\"@+id/serverUrlText\"\n+                android:layout_width=\"match_parent\"\n+                android:layout_height=\"wrap_content\"\n+                android:hint=\"@string/synchronization_host_label\"\n+                android:inputType=\"textNoSuggestions\"\n+                android:lines=\"1\"\n+                android:imeOptions=\"actionNext|flagNoFullscreen\" />\n \n-    <LinearLayout\n-        android:id=\"@+id/loginProgressContainer\"\n-        android:layout_width=\"match_parent\"\n-        android:layout_height=\"wrap_content\"\n-        android:visibility=\"gone\"\n-        android:orientation=\"horizontal\"\n-        android:layout_gravity=\"center_vertical\">\n+        </com.google.android.material.textfield.TextInputLayout>\n \n-        <ProgressBar\n-            android:layout_width=\"wrap_content\"\n+        <LinearLayout\n+            android:id=\"@+id/loginProgressContainer\"\n+            android:layout_width=\"match_parent\"\n             android:layout_height=\"wrap_content\"\n-            android:layout_marginEnd=\"8dp\"\n-            android:layout_marginRight=\"8dp\" />\n+            android:visibility=\"gone\"\n+            android:orientation=\"horizontal\"\n+            android:layout_gravity=\"center_vertical\">\n+\n+            <ProgressBar\n+                android:layout_width=\"wrap_content\"\n+                android:layout_height=\"wrap_content\"\n+                android:layout_marginEnd=\"8dp\"\n+                android:layout_marginRight=\"8dp\" />\n+\n+            <TextView\n+                android:layout_width=\"wrap_content\"\n+                android:layout_height=\"wrap_content\"\n+                android:text=\"@string/synchronization_nextcloud_authenticate_browser\" />\n+\n+        </LinearLayout>\n \n         <TextView\n+            android:id=\"@+id/errorText\"\n             android:layout_width=\"wrap_content\"\n             android:layout_height=\"wrap_content\"\n-            android:text=\"@string/synchronization_nextcloud_authenticate_browser\" />\n+            android:visibility=\"gone\"\n+            android:textColor=\"?attr/icon_red\"\n+            android:layout_marginBottom=\"16dp\" />\n \n-    </LinearLayout>\n-\n-    <TextView\n-        android:id=\"@+id/errorText\"\n-        android:layout_width=\"wrap_content\"\n-        android:layout_height=\"wrap_content\"\n-        android:visibility=\"gone\"\n-        android:textColor=\"?attr/icon_red\"\n-        android:layout_marginBottom=\"16dp\" />\n+        <Button\n+            android:id=\"@+id/chooseHostButton\"\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"wrap_content\"\n+            android:text=\"@string/proceed_to_login_butLabel\" />\n \n-    <Button\n-        android:id=\"@+id/chooseHostButton\"\n-        android:layout_width=\"match_parent\"\n-        android:layout_height=\"wrap_content\"\n-        android:text=\"@string/proceed_to_login_butLabel\" />\n+    </LinearLayout>\n \n-</LinearLayout>\n+</ScrollView>\n", "test_patch": "", "problem_statement": "Proceed to Login button not visible on smaller screens\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.2.0(58081fe5b)\n\n### Where did you get the app from\n\nF-Droid\n\n### Android version\n\nAndroid Go 11 - Stock\n\n### Device model\n\nCat S22 Flip\n\n### First occurred\n\n12 December, 2023\n\n### Steps to reproduce\n\nOpen Antennapod app.\r\nnavigate to \r\nMenu --> Settings --> Synchronization --> Select Synchronization provider.\r\n\r\nSelect Nextcloud\r\n\r\nEnter nextcloud server URL. \r\n\r\nNo `Proceed to login` button visible. \r\n\r\n![Screenshot_20231212-145741](https://github.com/AntennaPod/AntennaPod/assets/2010120/83838575-95fb-4a21-b033-4485abc750d8)\r\n\r\n\r\n\r\nOnly the `Cancel` button is visible.\r\n\r\nI was wondering why there is no button to login is visible even after entering the URL. I later figured it out that the screen size is small for the app, and the login button is hidden because of the screen size.\r\nI had to decrease the font and display size device wide to see part of the display button with just the top part of it.\r\n\r\n![Screenshot_20231212-145946](https://github.com/AntennaPod/AntennaPod/assets/2010120/0f0ae421-38dd-44f6-b633-9b01d53fc30a)\r\n\r\n\r\n \r\n\r\n\n\n### Expected behaviour\n\nThe `proceed to login` button should be visible by default on smaller screens with less resolution. \r\nIt is a 2.8 inch screen with 480 x 640 pixels resolution. \r\n\r\n\n\n### Current behaviour\n\nI managed to login by clicking on top part of the button for proceed to login.   \r\n\r\nRequesting to support smaller screens, as there are many devices now with smaller screens and Android on them.  \n\n### Logs\n\n_No response_\n", "hints_text": "have you try to scroll the page, that maybe show the hidden views.\r\nsuchh as bellow:\r\n\n![Screenshot_20231212_232405](https://github.com/AntennaPod/AntennaPod/assets/13600573/5719c011-489e-41f9-8782-103b0f422e2c)\r\n\nI have tried scrolling, it was not scroll-able. \r\nI am used to scrolling, because in many apps, extra buttons often get visible when I scroll, because they don't expect a smaller screen size. \nAdding scrolling to that screen should be an easy task for new contributors ", "created_at": "2023-12-31T15:56:33Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6833, "instance_id": "AntennaPod__AntennaPod-6833", "issue_numbers": ["6800"], "base_commit": "9db26b7bab8a8b8cf5a1c655f082d46b81a97f95", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\nindex c5d656aa02..0311171700 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\n@@ -36,6 +36,7 @@\n import de.danoeh.antennapod.core.storage.DBTasks;\n import de.danoeh.antennapod.core.service.playback.PlaybackServiceInterface;\n import de.danoeh.antennapod.core.util.DownloadErrorLabel;\n+import de.danoeh.antennapod.databinding.EditTextDialogBinding;\n import de.danoeh.antennapod.databinding.OnlinefeedviewHeaderBinding;\n import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FeedListUpdateEvent;\n@@ -95,7 +96,7 @@\n public class OnlineFeedViewActivity extends AppCompatActivity {\n \n     public static final String ARG_FEEDURL = \"arg.feedurl\";\n-    // Optional argument: specify a title for the actionbar.\n+    public static final String ARG_WAS_MANUAL_URL = \"manual_url\";\n     private static final int RESULT_ERROR = 2;\n     private static final String TAG = \"OnlineFeedViewActivity\";\n     private static final String PREFS = \"OnlineFeedViewActivityPreferences\";\n@@ -598,7 +599,10 @@ private void showErrorDialog(String errorMsg, String details) {\n                 builder.setMessage(R.string.download_error_error_unknown);\n             }\n             builder.setPositiveButton(android.R.string.ok, (dialog, which) -> dialog.cancel());\n-            builder.setOnDismissListener(dialog -> {\n+            if (getIntent().getBooleanExtra(ARG_WAS_MANUAL_URL, false)) {\n+                builder.setNeutralButton(R.string.edit_url_menu, (dialog, which) -> editUrl());\n+            }\n+            builder.setOnCancelListener(dialog -> {\n                 setResult(RESULT_ERROR);\n                 finish();\n             });\n@@ -609,6 +613,26 @@ private void showErrorDialog(String errorMsg, String details) {\n         }\n     }\n \n+    private void editUrl() {\n+        MaterialAlertDialogBuilder builder = new MaterialAlertDialogBuilder(this);\n+        builder.setTitle(R.string.edit_url_menu);\n+        final EditTextDialogBinding dialogBinding = EditTextDialogBinding.inflate(getLayoutInflater());\n+        if (downloader != null) {\n+            dialogBinding.urlEditText.setText(downloader.getDownloadRequest().getSource());\n+        }\n+        builder.setView(dialogBinding.getRoot());\n+        builder.setPositiveButton(R.string.confirm_label, (dialog, which) -> {\n+            setLoadingLayout();\n+            lookupUrlAndDownload(dialogBinding.urlEditText.getText().toString());\n+        });\n+        builder.setNegativeButton(R.string.cancel_label, (dialog1, which) -> dialog1.cancel());\n+        builder.setOnCancelListener(dialog1 -> {\n+            setResult(RESULT_ERROR);\n+            finish();\n+        });\n+        builder.show();\n+    }\n+\n     @Subscribe(threadMode = ThreadMode.MAIN)\n     public void playbackStateChanged(PlayerStatusEvent event) {\n         boolean isPlayingPreview =\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/AddFeedFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/AddFeedFragment.java\nindex 29be41727b..20cdd27182 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/AddFeedFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/AddFeedFragment.java\n@@ -147,6 +147,7 @@ private void showAddViaUrlDialog() {\n     private void addUrl(String url) {\n         Intent intent = new Intent(getActivity(), OnlineFeedViewActivity.class);\n         intent.putExtra(OnlineFeedViewActivity.ARG_FEEDURL, url);\n+        intent.putExtra(OnlineFeedViewActivity.ARG_WAS_MANUAL_URL, true);\n         startActivity(intent);\n     }\n \n", "test_patch": "", "problem_statement": "Improve workflow for users manually adding podcasts by RSS address (and failing)\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\r\n\r\n### App version\r\n\r\n3.2.0\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Problem you may be having, or feature you want\r\n\r\nCurrently, the \"Add podcast by RSS address\" is pre-populated with the content of the user's clipboard, which is helpful in many cases. However, this can lead to a suboptimal workflow when a user is trying to add an RSS address manually - and especially when multiple attempts become necessary. In that case, this would happen:\r\n\r\n1. Tap on \"Add Podcast by RSS address\"\r\n2. (Delete the (irrelevant) pre-populated URL copied from the clipboard - _this step may or may not be necessary, depending on the user's clipboard settings_)\r\n3. Fill in the URL manually and tap Confirm\r\n4. Encounter an error, for any reason\r\n5. Steps 1-3 have to be repeated\r\n\r\nMore details on my use case: I rely on the \"Add podcast by RSS address\" feature when using non-indexed feeds (e.g. third party/unofficial feeds which are not openly advertised). Therefore, I usually \"assemble\" a URL based on a predefined syntax rather than simply copying it.\r\n\r\n### Suggested solution\r\n\r\nI can imagine at least two non-mutually exclusive ways to improve this workflow without making it less useful for feeds copied to the clipboard. However, I am not sure if there is any technical limitation which makes them not feasible:\r\n\r\n- Ignore the content of the clipboard if older than X minutes, or if the user has populated the RSS address field *after* copying something to clipboard (this would save users from Step 2 above). _(Edit: some keyboards allow a timeout setting for clipboard content, this also solves the issue to a large extent.)_\r\n- If a user has just populated the RSS address field and encountered an error, keep the last URL as pre-populated value (this would save users a lot of time in repeating Step 3 above, as they most likely will need to edit a small part of the URL).\r\n\r\n### Screenshots / Drawings / Technical details\r\n\r\n_No response_\n", "hints_text": "> Ignore the content of the clipboard if older than X minutes, or if the user has populated the RSS address field after copying something to clipboard\r\n\r\nWe cannot check the date of a clipboard entry, so we can't do that.\r\n\r\n> Therefore, I usually \"assemble\" a URL based on a predefined syntax rather than simply copying it.\r\n\r\nHow does that work? Does the website not show you the full URL that you could copy but it shows placeholder values? That feels like quite a usability problem on the end of the podcast creator. Does this happen on a specific hosting service?\nUsers have created different grassroots projects to work around the fact that a public broadcaster has stopped using RSS feeds. They usually work by converting JSON APIs into feeds. Rather than providing a list of all feeds, some of them provide instructions such as \"take the original URL and replace X with Y\".", "created_at": "2023-12-30T10:03:57Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6828, "instance_id": "AntennaPod__AntennaPod-6828", "issue_numbers": ["6499"], "base_commit": "b066c6e23c335f79b624e90f15aaeb32f8a1cf81", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/MediaDownloadedHandler.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/MediaDownloadedHandler.java\nindex 019f311d28..a3b17435a6 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/MediaDownloadedHandler.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/MediaDownloadedHandler.java\n@@ -10,6 +10,7 @@\n import org.greenrobot.eventbus.EventBus;\n \n import java.io.File;\n+import java.io.InterruptedIOException;\n import java.util.concurrent.ExecutionException;\n \n import de.danoeh.antennapod.event.UnreadItemsUpdateEvent;\n@@ -54,14 +55,18 @@ public void run() {\n         media.setSize(new File(request.getDestination()).length());\n         media.checkEmbeddedPicture(); // enforce check\n \n-        // check if file has chapters\n-        if (media.getItem() != null && !media.getItem().hasChapters()) {\n-            media.setChapters(ChapterUtils.loadChaptersFromMediaFile(media, context));\n+        try {\n+            // Cache chapters if file has them\n+            if (media.getItem() != null && !media.getItem().hasChapters()) {\n+                media.setChapters(ChapterUtils.loadChaptersFromMediaFile(media, context));\n+            }\n+            if (media.getItem() != null && media.getItem().getPodcastIndexChapterUrl() != null) {\n+                ChapterUtils.loadChaptersFromUrl(media.getItem().getPodcastIndexChapterUrl(), false);\n+            }\n+        } catch (InterruptedIOException ignore) {\n+            // Ignore\n         }\n \n-        if (media.getItem() != null && media.getItem().getPodcastIndexChapterUrl() != null) {\n-            ChapterUtils.loadChaptersFromUrl(media.getItem().getPodcastIndexChapterUrl(), false);\n-        }\n         // Get duration\n         String durationStr = null;\n         try (MediaMetadataRetrieverCompat mmr = new MediaMetadataRetrieverCompat()) {\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/util/ChapterUtils.java b/core/src/main/java/de/danoeh/antennapod/core/util/ChapterUtils.java\nindex 084b34e76a..9017719138 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/util/ChapterUtils.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/util/ChapterUtils.java\n@@ -28,6 +28,7 @@\n import java.io.FileInputStream;\n import java.io.IOException;\n import java.io.InputStream;\n+import java.io.InterruptedIOException;\n import java.util.Collections;\n import java.util.List;\n \n@@ -60,42 +61,50 @@ public static void loadChapters(Playable playable, Context context, boolean forc\n             return;\n         }\n \n-        List<Chapter> chaptersFromDatabase = null;\n-        List<Chapter> chaptersFromPodcastIndex = null;\n-        if (playable instanceof FeedMedia) {\n-            FeedMedia feedMedia = (FeedMedia) playable;\n-            if (feedMedia.getItem() == null) {\n-                feedMedia.setItem(DBReader.getFeedItem(feedMedia.getItemId()));\n-            }\n-            if (feedMedia.getItem().hasChapters()) {\n-                chaptersFromDatabase = DBReader.loadChaptersOfFeedItem(feedMedia.getItem());\n-            }\n+        try {\n+            List<Chapter> chaptersFromDatabase = null;\n+            List<Chapter> chaptersFromPodcastIndex = null;\n+            if (playable instanceof FeedMedia) {\n+                FeedMedia feedMedia = (FeedMedia) playable;\n+                if (feedMedia.getItem() == null) {\n+                    feedMedia.setItem(DBReader.getFeedItem(feedMedia.getItemId()));\n+                }\n+                if (feedMedia.getItem().hasChapters()) {\n+                    chaptersFromDatabase = DBReader.loadChaptersOfFeedItem(feedMedia.getItem());\n+                }\n+\n+                if (!TextUtils.isEmpty(feedMedia.getItem().getPodcastIndexChapterUrl())) {\n+                    chaptersFromPodcastIndex = ChapterUtils.loadChaptersFromUrl(\n+                            feedMedia.getItem().getPodcastIndexChapterUrl(), forceRefresh);\n+                }\n \n-            if (!TextUtils.isEmpty(feedMedia.getItem().getPodcastIndexChapterUrl())) {\n-                chaptersFromPodcastIndex = ChapterUtils.loadChaptersFromUrl(\n-                        feedMedia.getItem().getPodcastIndexChapterUrl(), forceRefresh);\n             }\n \n-        }\n-\n-        List<Chapter> chaptersFromMediaFile = ChapterUtils.loadChaptersFromMediaFile(playable, context);\n-        List<Chapter> chaptersMergePhase1 = ChapterMerger.merge(chaptersFromDatabase, chaptersFromMediaFile);\n-        List<Chapter> chapters = ChapterMerger.merge(chaptersMergePhase1, chaptersFromPodcastIndex);\n-        if (chapters == null) {\n-            // Do not try loading again. There are no chapters.\n-            playable.setChapters(Collections.emptyList());\n-        } else {\n-            playable.setChapters(chapters);\n+            List<Chapter> chaptersFromMediaFile = ChapterUtils.loadChaptersFromMediaFile(playable, context);\n+            List<Chapter> chaptersMergePhase1 = ChapterMerger.merge(chaptersFromDatabase, chaptersFromMediaFile);\n+            List<Chapter> chapters = ChapterMerger.merge(chaptersMergePhase1, chaptersFromPodcastIndex);\n+            if (chapters == null) {\n+                // Do not try loading again. There are no chapters or parsing failed.\n+                playable.setChapters(Collections.emptyList());\n+            } else {\n+                playable.setChapters(chapters);\n+            }\n+        } catch (InterruptedIOException e) {\n+            Log.d(TAG, \"Chapter loading interrupted\");\n+            playable.setChapters(null); // Allow later retry\n         }\n     }\n \n-    public static List<Chapter> loadChaptersFromMediaFile(Playable playable, Context context) {\n+    public static List<Chapter> loadChaptersFromMediaFile(Playable playable, Context context)\n+            throws InterruptedIOException {\n         try (CountingInputStream in = openStream(playable, context)) {\n             List<Chapter> chapters = readId3ChaptersFrom(in);\n             if (!chapters.isEmpty()) {\n                 Log.i(TAG, \"Chapters loaded\");\n                 return chapters;\n             }\n+        } catch (InterruptedIOException e) {\n+            throw e;\n         } catch (IOException | ID3ReaderException e) {\n             Log.e(TAG, \"Unable to load ID3 chapters: \" + e.getMessage());\n         }\n@@ -106,6 +115,8 @@ public static List<Chapter> loadChaptersFromMediaFile(Playable playable, Context\n                 Log.i(TAG, \"Chapters loaded\");\n                 return chapters;\n             }\n+        } catch (InterruptedIOException e) {\n+            throw e;\n         } catch (IOException | VorbisCommentReaderException e) {\n             Log.e(TAG, \"Unable to load vorbis chapters: \" + e.getMessage());\n         }\n@@ -135,7 +146,7 @@ private static CountingInputStream openStream(Playable playable, Context context\n         }\n     }\n \n-    public static List<Chapter> loadChaptersFromUrl(String url, boolean forceRefresh) {\n+    public static List<Chapter> loadChaptersFromUrl(String url, boolean forceRefresh) throws InterruptedIOException {\n         if (forceRefresh) {\n             return loadChaptersFromUrl(url, CacheControl.FORCE_NETWORK);\n         }\n@@ -147,7 +158,8 @@ public static List<Chapter> loadChaptersFromUrl(String url, boolean forceRefresh\n         return cachedChapters;\n     }\n \n-    private static List<Chapter> loadChaptersFromUrl(String url, CacheControl cacheControl) {\n+    private static List<Chapter> loadChaptersFromUrl(String url, CacheControl cacheControl)\n+            throws InterruptedIOException {\n         Response response = null;\n         try {\n             Request request = new Request.Builder().url(url).cacheControl(cacheControl).build();\n@@ -155,6 +167,8 @@ private static List<Chapter> loadChaptersFromUrl(String url, CacheControl cacheC\n             if (response.isSuccessful() && response.body() != null) {\n                 return PodcastIndexChapterParser.parse(response.body().string());\n             }\n+        } catch (InterruptedIOException e) {\n+            throw e;\n         } catch (IOException e) {\n             e.printStackTrace();\n         } finally {\n", "test_patch": "", "problem_statement": "Chapter button sometimes shows even if there are no chapters\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.0.2\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n11\n\n### Device model\n\nFP3\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Open app (after a night, semi-cold start)\r\n2. Press play on downloaded episode\r\n3. Tap on chapters button immediately after (before playback starts\n\n### Expected behaviour\n\nOpen chapters list and start playback (or the other way around).\n\n### Current behaviour\n\nChapters modal opens, spinner shows for a second or two, app crashes.\n\n### Logs\n\n## Crash info\r\nTime: 22-05-2023 00:09:32\r\nAntennaPod version: 3.0.2\r\n\r\n## StackTrace\r\n```\r\njava.lang.NullPointerException: Callable returned null\r\n\tat java.util.Objects.requireNonNull(Objects.java:245)\r\n\tat io.reactivex.internal.functions.ObjectHelper.requireNonNull(SourceFile:39)\r\n\tat io.reactivex.internal.operators.observable.ObservableFromCallable.subscribeActual(SourceFile:43)\r\n\tat io.reactivex.Observable.subscribe(SourceFile:12246)\r\n\tat io.reactivex.internal.operators.observable.ObservableSubscribeOn$SubscribeTask.run(SourceFile:96)\r\n\tat io.reactivex.Scheduler$DisposeTask.run(SourceFile:578)\r\n\tat io.reactivex.internal.schedulers.ScheduledRunnable.run(SourceFile:66)\r\n\tat io.reactivex.internal.schedulers.ScheduledRunnable.call(SourceFile:57)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:301)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:641)\r\n\tat java.lang.Thread.run(Thread.java:923)\r\n```\n", "hints_text": "Can you still reproduce this? Could you please export a full log when this is happening and send it to me?\nI just tried again, and couldn't reproduce.\nWhat happened now, though: chapter button becomes available, you tap on it, and then you get a snackbar saying 'No chapters'.\nSo I guess they weren't loaded yet, but the button was displayed based on episode metadata (?)\nI think we should change the working here: either download chapters like we'll do for the transcript, or display the button only when the chapters are actually available & loaded.\n\nNote: I tried with the Podcasting 2.0 podcast, on my new phone. This new phone is considerably faster, so I didn't manage to press the chapters button _before_ playback started, but only directly after playback started. When I get home I'll try again on my old phone, to see if I can replicate there.\nJust checked again on my old phone, and couldn't reproduce.\n\nKeeping this open because the chapters button should only be visible if they can be loaded; 'No chapters' snackbar shouldn't be shown.\nI can take this\nI also see this crash when I clicked on the previous chapter button before the chapter was loaded when I was streaming an episode of the `All In` podcast\r\n\r\n## Environment\r\nAndroid version: 14\r\nOS version: 4.19.278-g7b0944645172-ab10812814\r\nAntennaPod version: 3.2.0\r\nModel: Pixel 4a (5G)\r\nDevice: bramble\r\nProduct: bramble\r\n\r\n## Crash info\r\nTime: 27-12-2023 11:42:41\r\nAntennaPod version: 3.2.0\r\n\r\n## StackTrace\r\n```\r\njava.lang.IndexOutOfBoundsException: Index: 0\r\n\tat java.util.Collections$EmptyList.get(Collections.java:4669)\r\n\tat de.danoeh.antennapod.fragment.CoverFragment.getCurrentChapter(CoverFragment.java:204)\r\n\tat de.danoeh.antennapod.fragment.CoverFragment.seekToPrevChapter(CoverFragment.java:208)\r\n\tat de.danoeh.antennapod.fragment.CoverFragment.lambda$onCreateView$3$de-danoeh-antennapod-fragment-CoverFragment(CoverFragment.java:81)\r\n\tat de.danoeh.antennapod.fragment.CoverFragment$$ExternalSyntheticLambda1.onClick(Unknown Source:2)\r\n\tat android.view.View.performClick(View.java:7659)\r\n\tat android.view.View.performClickInternal(View.java:7636)\r\n\tat android.view.View.-$$Nest$mperformClickInternal(Unknown Source:0)\r\n\tat android.view.View$PerformClick.run(View.java:30156)\r\n\tat android.os.Handler.handleCallback(Handler.java:958)\r\n\tat android.os.Handler.dispatchMessage(Handler.java:99)\r\n\tat android.os.Looper.loopOnce(Looper.java:205)\r\n\tat android.os.Looper.loop(Looper.java:294)\r\n\tat android.app.ActivityThread.main(ActivityThread.java:8177)\r\n\tat java.lang.reflect.Method.invoke(Native Method)\r\n\tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:552)\r\n\tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:971)\r\n```", "created_at": "2023-12-28T07:21:09Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6825, "instance_id": "AntennaPod__AntennaPod-6825", "issue_numbers": ["6383"], "base_commit": "b066c6e23c335f79b624e90f15aaeb32f8a1cf81", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/dialog/ItemFilterDialog.java b/app/src/main/java/de/danoeh/antennapod/dialog/ItemFilterDialog.java\nindex 92c1439925..359c513af5 100644\n--- a/app/src/main/java/de/danoeh/antennapod/dialog/ItemFilterDialog.java\n+++ b/app/src/main/java/de/danoeh/antennapod/dialog/ItemFilterDialog.java\n@@ -18,11 +18,13 @@\n import com.google.android.material.bottomsheet.BottomSheetDialogFragment;\n import com.google.android.material.button.MaterialButtonToggleGroup;\n \n+import java.util.Collections;\n import java.util.HashSet;\n import java.util.Set;\n \n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.core.feed.FeedItemFilterGroup;\n+import de.danoeh.antennapod.databinding.FilterDialogBinding;\n import de.danoeh.antennapod.databinding.FilterDialogRowBinding;\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n \n@@ -36,24 +38,36 @@ public abstract class ItemFilterDialog extends BottomSheetDialogFragment {\n     public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container,\n                              @Nullable Bundle savedInstanceState) {\n         View layout = inflater.inflate(R.layout.filter_dialog, null, false);\n-        rows = layout.findViewById(R.id.filter_rows);\n+        FilterDialogBinding binding = FilterDialogBinding.bind(layout);\n+        rows = binding.filterRows;\n         FeedItemFilter filter = (FeedItemFilter) getArguments().getSerializable(ARGUMENT_FILTER);\n \n+        //add filter rows\n         for (FeedItemFilterGroup item : FeedItemFilterGroup.values()) {\n-            FilterDialogRowBinding binding = FilterDialogRowBinding.inflate(inflater);\n-            binding.getRoot().addOnButtonCheckedListener(\n+            FilterDialogRowBinding rowBinding = FilterDialogRowBinding.inflate(inflater);\n+            rowBinding.getRoot().addOnButtonCheckedListener(\n                     (group, checkedId, isChecked) -> onFilterChanged(getNewFilterValues()));\n-            binding.filterButton1.setText(item.values[0].displayName);\n-            binding.filterButton1.setTag(item.values[0].filterId);\n-            binding.filterButton2.setText(item.values[1].displayName);\n-            binding.filterButton2.setTag(item.values[1].filterId);\n-            binding.filterButton1.setMaxLines(3);\n-            binding.filterButton1.setSingleLine(false);\n-            binding.filterButton2.setMaxLines(3);\n-            binding.filterButton2.setSingleLine(false);\n-            rows.addView(binding.getRoot());\n+            rowBinding.filterButton1.setText(item.values[0].displayName);\n+            rowBinding.filterButton1.setTag(item.values[0].filterId);\n+            rowBinding.filterButton2.setText(item.values[1].displayName);\n+            rowBinding.filterButton2.setTag(item.values[1].filterId);\n+            rowBinding.filterButton1.setMaxLines(3);\n+            rowBinding.filterButton1.setSingleLine(false);\n+            rowBinding.filterButton2.setMaxLines(3);\n+            rowBinding.filterButton2.setSingleLine(false);\n+            rows.addView(rowBinding.getRoot(), rows.getChildCount() - 1);\n         }\n \n+        binding.confirmFiltermenu.setOnClickListener(view1 -> dismiss());\n+        binding.resetFiltermenu.setOnClickListener(view1 -> {\n+            onFilterChanged(Collections.emptySet());\n+            for (int i = 0; i < rows.getChildCount(); i++) {\n+                if (rows.getChildAt(i) instanceof MaterialButtonToggleGroup) {\n+                    ((MaterialButtonToggleGroup) rows.getChildAt(i)).clearChecked();\n+                }\n+            }\n+        });\n+\n         for (String filterId : filter.getValues()) {\n             if (!TextUtils.isEmpty(filterId)) {\n                 Button button = layout.findViewWithTag(filterId);\ndiff --git a/app/src/main/res/layout/filter_dialog.xml b/app/src/main/res/layout/filter_dialog.xml\nindex d700f0365d..e22ea4ffe0 100644\n--- a/app/src/main/res/layout/filter_dialog.xml\n+++ b/app/src/main/res/layout/filter_dialog.xml\n@@ -1,15 +1,42 @@\n <?xml version=\"1.0\" encoding=\"utf-8\"?>\n-<ScrollView xmlns:android=\"http://schemas.android.com/apk/res/android\"\n-        android:layout_width=\"match_parent\"\n-        android:layout_height=\"match_parent\">\n+<ScrollView\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"match_parent\">\n+\n     <LinearLayout\n-            android:id=\"@+id/filter_rows\"\n+        android:id=\"@+id/filter_rows\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:orientation=\"vertical\"\n+        android:paddingLeft=\"24dp\"\n+        android:paddingTop=\"24dp\"\n+        android:paddingRight=\"24dp\"\n+        android:paddingBottom=\"8dp\">\n+\n+        <LinearLayout\n             android:layout_width=\"match_parent\"\n-            android:layout_height=\"wrap_content\"\n-            android:orientation=\"vertical\"\n-            android:paddingLeft=\"24dp\"\n-            android:paddingTop=\"24dp\"\n-            android:paddingRight=\"24dp\"\n-            android:paddingBottom=\"8dp\">\n+            android:layout_height=\"match_parent\"\n+            android:orientation=\"horizontal\">\n+\n+            <com.google.android.material.button.MaterialButton\n+                android:id=\"@+id/resetFiltermenu\"\n+                android:layout_width=\"match_parent\"\n+                android:layout_height=\"wrap_content\"\n+                android:layout_weight=\"1\"\n+                android:text=\"@string/reset\"\n+                style=\"@style/Widget.MaterialComponents.Button.TextButton\" />\n+\n+            <com.google.android.material.button.MaterialButton\n+                android:id=\"@+id/confirmFiltermenu\"\n+                android:layout_width=\"match_parent\"\n+                android:layout_height=\"wrap_content\"\n+                android:layout_weight=\"1\"\n+                android:text=\"@string/confirm_label\"\n+                style=\"@style/Widget.MaterialComponents.Button.TextButton\" />\n+\n+        </LinearLayout>\n+\n     </LinearLayout>\n+\n </ScrollView>\n", "test_patch": "", "problem_statement": "Add reset button to episodes filter\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Problem you may be having, or feature you want\n\nAdd a reset all button to the filter bottom sheet\n\n### Suggested solution\n\n_No response_\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "I'm new to open source and I would like to work on this issue. But unable to run the application on android simulator in Android Studio.\r\nThe following error shows up:\r\n**The project is using an incompatible version (AGP 7.4.0) of the Android Gradle plugin. Latest supported version is AGP 7.3.1**\r\nNeeded some guidance.\r\n\r\n\nSorry, debugging your setup would take longer than just implementing the feature myself. You need to figure out how to fix your dev environment yourself.", "created_at": "2023-12-26T13:14:40Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6822, "instance_id": "AntennaPod__AntennaPod-6822", "issue_numbers": ["6818"], "base_commit": "db88dc10e642579191e4f7b1d27a24e085e0abdf", "patch": "diff --git a/ui/echo/src/main/java/de/danoeh/antennapod/ui/echo/EchoActivity.java b/ui/echo/src/main/java/de/danoeh/antennapod/ui/echo/EchoActivity.java\nindex 00b03a2798..7bf3a75d02 100644\n--- a/ui/echo/src/main/java/de/danoeh/antennapod/ui/echo/EchoActivity.java\n+++ b/ui/echo/src/main/java/de/danoeh/antennapod/ui/echo/EchoActivity.java\n@@ -209,7 +209,11 @@ private void loadScreen(int screen, boolean force) {\n                     viewBinding.largeLabel.setText(String.format(getEchoLanguage(), \"%d\", queueSecondsLeft / 3600));\n                     viewBinding.belowLabel.setText(getResources().getQuantityString(\n                             R.plurals.echo_queue_hours_waiting, queueNumEpisodes, queueNumEpisodes));\n-                    int daysUntilNextYear = Math.max(356 - Calendar.getInstance().get(Calendar.DAY_OF_YEAR) + 1, 1);\n+                    Calendar dec31 = Calendar.getInstance();\n+                    dec31.set(Calendar.DAY_OF_MONTH, 31);\n+                    dec31.set(Calendar.MONTH, Calendar.DECEMBER);\n+                    int daysUntilNextYear = Math.max(1,\n+                            dec31.get(Calendar.DAY_OF_YEAR) - Calendar.getInstance().get(Calendar.DAY_OF_YEAR) + 1);\n                     long secondsPerDay = queueSecondsLeft / daysUntilNextYear;\n                     String timePerDay = Converter.getDurationStringLocalized(\n                             getLocalizedResources(this, getEchoLanguage()), secondsPerDay * 1000);\n", "test_patch": "", "problem_statement": "AntennaPod Echo: Wrong hours left\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n### App version\r\n\r\n3.2.0 (58081fe5b)\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Android version\r\n\r\nAndroid OxygenOS 11.1.2.2\r\n\r\n### Device model\r\n\r\nOnePlus A6013\r\n\r\n### First occurred\r\n\r\naround 3days ago\r\n\r\n### Steps to reproduce\r\n\r\n* Open Antenna pod Echo\r\n* Waiting for 3rd Screen\r\n* Shows: 9hours waiting in queue from 7 episodes, that's  9 hour and 0 minutes each day until 2024 starts\r\n\r\n### Expected behaviour\r\n\r\n9 hours waiting and 7 episodes left and still 10days remaining is not 9hours per day. That's roughly 1hour per day.\r\n\r\nI thought this is due to having an episode at the very top waiting to be played, while only the second episode from the queue is playing, but moving the first episode around made no difference.\r\n\r\n### Current behaviour\r\n\r\nI hope these two screenshots explain it a little better \r\n\r\nscreenshots are taken on 2023-12-22\r\n\r\n<img src=\"https://github.com/AntennaPod/AntennaPod/assets/21309019/b344232e-1208-4323-8080-a05372e95bd0\" width=\"50%\" alt=\"Screenshot_20231222-001622\">\r\n<br />\r\n<br />\r\n<img src=\"https://github.com/AntennaPod/AntennaPod/assets/21309019/fb5dfb7a-e0b5-4360-ab23-583c5d1cf526\" width=\"50%\" alt=\"Screenshot_20231222-001613\">\r\n\r\nThe time left in the first screenshot is not static and counting down.\r\n\r\nBtw. Thanks for this great feature. Loving these little stats features \ud83d\ude0d\r\n\r\nLet me know if there is a way to provide you logs or something to debug this a little better\r\n\r\n### Logs\r\n\r\n_No response_\r\n\r\nedit 20231222 07:39 UTC: I resized the screenshots using html instead of markdown, making this issue more readable. also moved the sentence  `The time left is not static and counting down` from expected to current behaviour.\n", "hints_text": "", "created_at": "2023-12-23T12:54:29Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6821, "instance_id": "AntennaPod__AntennaPod-6821", "issue_numbers": ["6820"], "base_commit": "db88dc10e642579191e4f7b1d27a24e085e0abdf", "patch": "diff --git a/app/build.gradle b/app/build.gradle\nindex 9e93fc90a8..9601377ac0 100644\n--- a/app/build.gradle\n+++ b/app/build.gradle\n@@ -123,7 +123,7 @@ dependencies {\n     implementation \"com.joanzapata.iconify:android-iconify-fontawesome:$iconifyVersion\"\n     implementation \"com.joanzapata.iconify:android-iconify-material:$iconifyVersion\"\n     implementation 'com.leinardi.android:speed-dial:3.2.0'\n-    implementation 'com.github.ByteHamster:SearchPreference:v2.0.0'\n+    implementation 'com.github.ByteHamster:SearchPreference:v2.5.0'\n     implementation 'com.github.skydoves:balloon:1.5.3'\n     implementation 'com.github.xabaras:RecyclerViewSwipeDecorator:1.3'\n     implementation \"com.annimon:stream:$annimonStreamVersion\"\n", "test_patch": "", "problem_statement": "Minor Settings search quirk: Tapping near top/bottom of search box clears the query\n### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.2.0 (58081fe5b)\n\n### Where did you get the app from\n\nF-Droid\n\n### Android version\n\nAndroid 13, OxygenOS 13 (stock)\n\n### Device model\n\nOnePlus Nord CE\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Go to Settings\r\n2. Type in a search query\r\n3. Tap the top or bottom of the search field\n\n### Expected behaviour\n\nJust the cursor being repositioned, or perhaps nothing.\n\n### Current behaviour\n\nThe field is cleared, as if tapping the cross button on the right to clear the field.\r\n\r\nhttps://github.com/AntennaPod/AntennaPod/assets/4025899/6c263ba4-52ff-4765-8a2a-374da0d90575\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2023-12-23T12:50:17Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6816, "instance_id": "AntennaPod__AntennaPod-6816", "issue_numbers": ["6698"], "base_commit": "db88dc10e642579191e4f7b1d27a24e085e0abdf", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\nindex 0423cfa01b..3ef2e22144 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n@@ -326,7 +326,8 @@ public BrowserRoot onGetRoot(@NonNull String clientPackageName, int clientUid, B\n         if (rootHints != null && rootHints.getBoolean(BrowserRoot.EXTRA_RECENT)) {\n             Bundle extras = new Bundle();\n             extras.putBoolean(BrowserRoot.EXTRA_RECENT, true);\n-            return new BrowserRoot(getResources().getString(R.string.recently_played_episodes), extras);\n+            Log.d(TAG, \"OnGetRoot: Returning BrowserRoot \" + R.string.current_playing_episode);\n+            return new BrowserRoot(getResources().getString(R.string.current_playing_episode), extras);\n         }\n \n         // Name visible in Android Auto\n@@ -407,6 +408,11 @@ public void onLoadChildren(@NonNull String parentId,\n     private List<MediaBrowserCompat.MediaItem> loadChildrenSynchronous(@NonNull String parentId) {\n         List<MediaBrowserCompat.MediaItem> mediaItems = new ArrayList<>();\n         if (parentId.equals(getResources().getString(R.string.app_name))) {\n+            long currentlyPlaying = PlaybackPreferences.getCurrentPlayerStatus();\n+            if (currentlyPlaying == PlaybackPreferences.PLAYER_STATUS_PLAYING\n+                    || currentlyPlaying == PlaybackPreferences.PLAYER_STATUS_PAUSED) {\n+                mediaItems.add(createBrowsableMediaItem(R.string.current_playing_episode, R.drawable.ic_play_48dp, 1));\n+            }\n             mediaItems.add(createBrowsableMediaItem(R.string.queue_label, R.drawable.ic_playlist_play_black,\n                     DBReader.getTotalEpisodeCount(new FeedItemFilter(FeedItemFilter.QUEUED))));\n             mediaItems.add(createBrowsableMediaItem(R.string.downloads_label, R.drawable.ic_download_black,\n@@ -433,7 +439,7 @@ private List<MediaBrowserCompat.MediaItem> loadChildrenSynchronous(@NonNull Stri\n             long feedId = Long.parseLong(parentId.split(\":\")[1]);\n             Feed feed = DBReader.getFeed(feedId);\n             feedItems = DBReader.getFeedItemList(feed, FeedItemFilter.unfiltered(), feed.getSortOrder());\n-        } else if (parentId.equals(getString(R.string.recently_played_episodes))) {\n+        } else if (parentId.equals(getString(R.string.current_playing_episode))) {\n             Playable playable = PlaybackPreferences.createInstanceFromPreferences(this);\n             if (playable instanceof FeedMedia) {\n                 feedItems = Collections.singletonList(((FeedMedia) playable).getItem());\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 467570ba5c..9b5ddd07e2 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -26,7 +26,7 @@\n     <string name=\"episode_cache_full_message\">The episode cache limit has been reached. You can increase the cache size in the Settings.</string>\n     <string name=\"years_statistics_label\">Years</string>\n     <string name=\"notification_pref_fragment\">Notifications</string>\n-    <string name=\"recently_played_episodes\">Recently played episodes</string>\n+    <string name=\"current_playing_episode\">Current</string>\n     <string name=\"antennapod_echo\" translatable=\"false\">AntennaPod Echo</string>\n     <string name=\"antennapod_echo_year\" translatable=\"false\">AntennaPod Echo %d</string>\n \n", "test_patch": "", "problem_statement": "Inconsistent autoplay behavior when connected to Android Auto\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.1.1 (8073de55a)\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n13\n\n### Device model\n\nPixel 7 Pro\n\n### First occurred\n\nSince using the app\n\n### Steps to reproduce\n\nThis is difficult to reliably reproduce because it seems that it does this randomly and inconsistently, and I haven't figured out any sort of pattern to reproduce this.\r\n\r\nMost of the time, the intended behavior would be to simply resume my podcast in progress upon connecting to Android Auto. I already have AA setup to resume my media on connect. I would say about 80-90% of the time this is the observed behavior.\r\n\r\nI'm currently finding replacements for the soon-to-be-deprecated Google Podcasts app. This would pretty much be perfect if not for this bug. I will say that in the duration I've been using the app, I've always had at least something queued up, so the queue has never been empty.\n\n### Expected behaviour\n\nExpected it to always autoplay upon connecting to Android Auto.\n\n### Current behaviour\n\nWhat happens about 10-20% of the time is that it won't autoplay anything. The split-screen view will show 'For You', then I swipe that to view the AntennaPod session, and it says I have to tap to open it. At that point, I still have to go to the Queue tab and manually tap the topmost episode to continue playback.\n\n### Logs\n\nNext time I observe this happening, I will export logs and paste them.\n", "hints_text": "I doubt there's that much in the logs but here they are:\r\n\r\n```\r\n--------- beginning of main\r\n10-11 18:13:25.118 21429 21429 D PlaybackService: OnLoadChildren: parentMediaId=Queue\r\n10-11 18:13:25.118 21429 31131 D DBReader: getQueue() called\r\n10-11 18:13:25.118 21429 31131 D DBReader: getQueue()\r\n10-11 18:13:25.119 21429 31131 D DBReader: getFavoriteIDList() called\r\n10-11 18:13:25.119 21429 31131 D DBReader: getQueueIDList() called\r\n10-11 18:13:25.119 21429 31131 D DBReader: Extracting Feedlist\r\n10-11 18:13:25.126 21429 21429 D PlaybackService: OnLoadChildren: parentMediaId=Downloads\r\n10-11 18:13:25.126 21429 31142 D DBReader: getRecentlyPublishedEpisodes() called with: offset=0, limit=100\r\n10-11 18:13:25.127 21429 31142 D DBReader: getFavoriteIDList() called\r\n10-11 18:13:25.127 21429 31142 D DBReader: getQueueIDList() called\r\n10-11 18:13:25.127 21429 31142 D DBReader: Extracting Feedlist\r\n10-11 18:13:32.717 21429 21429 D TrafficStats: tagSocket(72) with statsTag=0xffffffff, statsUid=-1\r\n10-11 18:13:49.793 21429 21429 D TrafficStats: tagSocket(72) with statsTag=0xffffffff, statsUid=-1\r\n10-11 18:13:59.216 21429 21429 D TrafficStats: tagSocket(72) with statsTag=0xffffffff, statsUid=-1\r\n10-11 18:14:07.833 21429 21429 D TrafficStats: tagSocket(72) with statsTag=0xffffffff, statsUid=-1\r\n10-11 18:14:21.336 21429 21429 D TrafficStats: tagSocket(72) with statsTag=0xffffffff, statsUid=-1\r\n10-11 18:14:27.034 21429 21429 D TrafficStats: tagSocket(72) with statsTag=0xffffffff, statsUid=-1\r\n10-11 18:14:33.819 21429 21429 D TrafficStats: tagSocket(72) with statsTag=0xffffffff, statsUid=-1\r\n10-11 18:14:37.660 21429 21429 D TrafficStats: tagSocket(72) with statsTag=0xffffffff, statsUid=-1\r\n10-11 18:14:43.155 21429 21429 D TrafficStats: tagSocket(72) with statsTag=0xffffffff, statsUid=-1\r\n10-11 18:14:44.616 21429 21429 D TrafficStats: tagSocket(72) with statsTag=0xffffffff, statsUid=-1\r\n10-11 18:14:52.201 21429 21429 D TrafficStats: tagSocket(72) with statsTag=0xffffffff, statsUid=-1\r\n10-11 18:15:00.148 21429 21429 D TrafficStats: tagSocket(116) with statsTag=0xffffffff, statsUid=-1\r\n10-11 18:15:01.381 21429 21429 D UserPreferences: User data folder not writable or not set. Trying default.\r\n10-11 18:15:01.382 21429 21429 D BugReportActivity: No crash report recorded\r\n10-11 18:15:01.908 21429 21456 D OpenGLRenderer: endAllActiveAnimators on 0xb4000079b10b1d40 (RippleDrawable) with handle 0xb4000078c0df6ad0\r\n10-11 18:15:06.308 21429 21429 D TrafficStats: tagSocket(100) with statsTag=0xffffffff, statsUid=-1\r\n10-11 18:15:06.816 21429 21456 D OpenGLRenderer: endAllActiveAnimators on 0xb4000079b0f4c250 (MenuPopupWindow$MenuDropDownListView) with handle 0xb4000078c0ddc1c0\r\n10-11 18:15:10.495 21429 21429 D UserPreferences: User data folder not writable or not set. Trying default.\r\n10-11 18:15:10.518 21429 21456 D OpenGLRenderer: endAllActiveAnimators on 0xb4000079b0fd68d0 (RippleDrawable) with handle 0xb4000078c0defd50\r\n```\nUpon further testing, I noticed that:\r\n* If my car audio was last set to Android Auto - plugging my phone in will immediately start playing AntennaPod (assuming that was my last media app), and will continue off in my queue exactly where I left off. This is expected and desired.\r\n* If my car audio was *not* Android Auto - e.g. the radio - then I have to go through the \"tap to open\" and manually select my highest queue item to play. Keep in mind before this happens, the radio is still playing, which is expected.\r\n\r\nWith Google Podcasts in the below scenario, it would be ready to go with the player already open, set to resume my queue, and it was only awaiting me to manually tap play. Here, there's the extra step of tapping back into the app, then tapping the top of my queue to resume.\r\n\r\nSo it's a relatively minor setback in user workflow, and I'm partially willing to bet that it's because Google Podcasts was somehow more \"integrated\" with my phone (Pixel 7 Pro) than AntennaPod is.\r\n\r\nI would then just hope that AntennaPod knows by default to resume playback from the top of the queue without the extra intermediary manual step, but it's honestly a very minor issue in an otherwise excellent app.\nI can confirm that this is annoying 'bug' in Android Auto since I use AP frequently in my car and many others have chimed in https://forum.antennapod.org/t/android-auto-not-continuing-playback/3108?u=tonytamsf\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/android-auto-not-continuing-playback/3108/8\n\nIs anyone willing to test out a debug build that should address this bug\r\n\r\nThe apk is in the Checks tab here [Android auto resume by tonytamsf \u00b7 Pull Request #6766 \u00b7 AntennaPod/AntennaPod \u00b7 GitHub](https://github.com/AntennaPod/AntennaPod/pull/6766/checks)\r\n\r\ndownload it from https://github.com/AntennaPod/AntennaPod/suites/18235922573/artifacts/1053611078\n> Is anyone willing to test out a debug build that should address this bug\r\n> \r\n> The apk is in the Checks tab here [Android auto resume by tonytamsf \u00b7 Pull Request #6766 \u00b7 AntennaPod/AntennaPod \u00b7 GitHub](https://github.com/AntennaPod/AntennaPod/pull/6766/checks)\r\n> \r\n> download it from https://github.com/AntennaPod/AntennaPod/suites/18235922573/artifacts/1053611078\r\n\r\nApk is no longer available. \nI see this same behavior, but it is not inconsistent -- it is 100% consistent.  Every single time I use Antenna pod with Android Auto, I get the \"for you\" view, and nothing is playing.  Even if I was JUST playing a podcast on that vehicle, turned off the car (e.g. to refuel), and restarted the vehicle without ever disconnecting the USB cable to my phone.  \r\n\r\nI'd be happy to test a debug build.\n> I see this same behavior, but it is not inconsistent -- it is 100% consistent. Every single time I use Antenna pod with Android Auto, I get the \"for you\" view, and nothing is playing. Even if I was JUST playing a podcast on that vehicle, turned off the car (e.g. to refuel), and restarted the vehicle without ever disconnecting the USB cable to my phone.\r\n> \r\n> I'd be happy to test a debug build.\r\n\r\nThere is an apk to test in this pull request:\r\nhttps://github.com/AntennaPod/AntennaPod/pull/6766\n> There is an apk to test in this pull request: #6766\r\n\r\n@fakerli  - have you been able to use this APK in android auto?  I installed it to my phone, and of course, I then had two AntennaPod apps installed.  The android auto \"customize launcher\" only showed one, so I uninstalled my original play store AntennaPod, thinking maybe the customize tool didn't like two apps with the same name (although this debug APK does have \"Debug\" on the end of the name).  Now the customize launcher doesn't allow me to select AntennaPod.  I tried rebooting just in case, but still can't select AntennaPod for the AA launcher.  Is there something I need to do so I can add it to the launcher?\n@jpriebe My wife has my car at the moment. I'll get it back in about 24 hours :-D Will check then!\nI  can see it in the customization settings, but I have unknown sources enabled in AA developer settings. Try if this helps:\r\n\r\n1. Go to android auto settings\r\n2. Tap \"version\" 10 times\r\n3. Read the warning and enable developer settings\r\n4. Press the 3 dots in the top right corner\r\n5. Select \"developer settings\"\r\n6. Select \"unknown sources\".\r\n\r\nCheck if it works. Maybe you need to reinstall the apk.\r\n\r\nNote: I'm on a Dutch system, so names of options might not be exact, but you should be able to find them.\r\nNote 2: it's night over here, so I'll test it in the morning\n> I can see it in the customization settings, but I have unknown sources enabled in AA developer settings. Try if this helps:\r\n\r\nAhhh, developer mode -- that makes sense.  AA has its own safety mechanism to prevent sideloading.  Your steps worked perfectly.\r\n\r\nAfter I turned on unknown sources, I did have to uninstall and reinstall the apk for the launcher customizer to show the AntennaPod Debug application.\r\n\r\nThanks for such a useful comment!  Now to drive around with the new build and see what happens.\r\n\nI got the debug APK to show up in Android Auto, but it gives me an error when trying to open it. \nI did some tests with the debug APK and this is what I see:\r\nWhen android auto starts, the last played podcast always starts playing automatically, at the position it left of before. So this is good.\r\nHowever, the Android Auto setting that controls if music playing should be resumed automatically, is ignored completely. Even if this is set to off, the podcast starts playing.\r\nIn other apps, if this setting is of, the last track is loaded, but paused. This way, you only have to press \"play\" to start it. It would be nice if AntennaPod would respect this setting.\nSame experience.  To be transparent, I've only tested 2 times since getting the debug apk installed, so take that for what it's worth.\r\n\r\nI started the day by listening to a podcast on AntennaPod on my phone's speaker in the house.  I stopped the playback before leaving the house to get in the car.  I connected the phone to the car, and it immediately resumed playback (a little unexpected, but still better than showing the \"for you\" screen).\r\n\r\nAfter work, I connected the phone to the car again, and the playback started up again automatically.\r\n\r\nThis is an improvement, but I think it should honor the Android Auto setting for auto resume.\nFor the most part, my experience over a week or so with the debug build was pretty good.  Like I mentioned in my previous comment, it was not honoring the \"Start music automatically\" setting in Android Auto.  But auto playing is preferable to starting on the \"For You\" page and requiring a bunch of navigation to the episodes list to find your episode.\r\n\r\nI saw that https://github.com/AntennaPod/AntennaPod/pull/6766/files was closed.  Sounds like more investigation is required.  I hope that a fix will come soon.  The debug build doesn't seem to auto-download episodes (regardless of settings), so I'm back to the Play store version.\nThanks folks for testing it.  The PR fix I made was a bit hacky hence I closed it until I can figure out a better solution https://github.com/AntennaPod/AntennaPod/pull/6766", "created_at": "2023-12-20T09:55:35Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6808, "instance_id": "AntennaPod__AntennaPod-6808", "issue_numbers": ["6802"], "base_commit": "58081fe5bf7d9ad28f089cf10b2c17bfcfc8bbc7", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/preferences/VolumeAdaptationPreference.java b/app/src/main/java/de/danoeh/antennapod/preferences/VolumeAdaptationPreference.java\nnew file mode 100644\nindex 0000000000..584b7d90ec\n--- /dev/null\n+++ b/app/src/main/java/de/danoeh/antennapod/preferences/VolumeAdaptationPreference.java\n@@ -0,0 +1,27 @@\n+package de.danoeh.antennapod.preferences;\n+\n+import android.content.Context;\n+import android.util.AttributeSet;\n+\n+import java.util.Arrays;\n+\n+import de.danoeh.antennapod.model.feed.VolumeAdaptionSetting;\n+\n+public class VolumeAdaptationPreference extends MaterialListPreference {\n+    public VolumeAdaptationPreference(Context context) {\n+        super(context);\n+    }\n+\n+    public VolumeAdaptationPreference(Context context, AttributeSet attrs) {\n+        super(context, attrs);\n+    }\n+\n+    @Override\n+    public CharSequence[] getEntries() {\n+        if (VolumeAdaptionSetting.isBoostSupported()) {\n+            return super.getEntries();\n+        } else {\n+            return Arrays.copyOfRange(super.getEntries(), 0, 3);\n+        }\n+    }\n+}\ndiff --git a/app/src/main/res/xml/feed_settings.xml b/app/src/main/res/xml/feed_settings.xml\nindex fb9e2e4254..b322217ad8 100644\n--- a/app/src/main/res/xml/feed_settings.xml\n+++ b/app/src/main/res/xml/feed_settings.xml\n@@ -48,7 +48,7 @@\n         android:summary=\"@string/global_default\"\n         android:title=\"@string/auto_delete_label\" />\n \n-    <de.danoeh.antennapod.preferences.MaterialListPreference\n+    <de.danoeh.antennapod.preferences.VolumeAdaptationPreference\n         android:defaultValue=\"off\"\n         android:entries=\"@array/spnVolumeAdaptationItems\"\n         android:entryValues=\"@array/spnVolumeAdaptationValues\"\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/ExoPlayerWrapper.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/ExoPlayerWrapper.java\nindex 79cd97fd28..1900ed7f23 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/ExoPlayerWrapper.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/ExoPlayerWrapper.java\n@@ -7,6 +7,7 @@\n import android.util.Log;\n import android.view.SurfaceHolder;\n import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n import androidx.core.util.Consumer;\n import com.google.android.exoplayer2.C;\n import com.google.android.exoplayer2.DefaultLoadControl;\n@@ -37,6 +38,7 @@\n import com.google.android.exoplayer2.upstream.HttpDataSource;\n import de.danoeh.antennapod.core.ClientConfig;\n import de.danoeh.antennapod.core.R;\n+import de.danoeh.antennapod.model.feed.VolumeAdaptionSetting;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import de.danoeh.antennapod.core.service.download.AntennapodHttpClient;\n import de.danoeh.antennapod.core.service.download.HttpCredentialEncoder;\n@@ -69,7 +71,8 @@ public class ExoPlayerWrapper {\n     private PlaybackParameters playbackParameters;\n     private DefaultTrackSelector trackSelector;\n \n-    private LoudnessEnhancer loudnessEnhancer;\n+    @Nullable\n+    private LoudnessEnhancer loudnessEnhancer = null;\n \n     ExoPlayerWrapper(Context context) {\n         this.context = context;\n@@ -247,11 +250,15 @@ public void setPlaybackParams(float speed, boolean skipSilence) {\n     public void setVolume(float v, float v1) {\n         if (v > 1) {\n             exoPlayer.setVolume(1f);\n-            loudnessEnhancer.setEnabled(true);\n-            loudnessEnhancer.setTargetGain((int) (1000 * (v - 1)));\n+            if (loudnessEnhancer != null) {\n+                loudnessEnhancer.setEnabled(true);\n+                loudnessEnhancer.setTargetGain((int) (1000 * (v - 1)));\n+            }\n         } else {\n             exoPlayer.setVolume(v);\n-            loudnessEnhancer.setEnabled(false);\n+            if (loudnessEnhancer != null) {\n+                loudnessEnhancer.setEnabled(false);\n+            }\n         }\n     }\n \n@@ -354,6 +361,10 @@ void setOnBufferingUpdateListener(Consumer<Integer> bufferingUpdateListener) {\n     }\n \n     private void initLoudnessEnhancer(int audioStreamId) {\n+        if (!VolumeAdaptionSetting.isBoostSupported()) {\n+            return;\n+        }\n+\n         LoudnessEnhancer newEnhancer = new LoudnessEnhancer(audioStreamId);\n         LoudnessEnhancer oldEnhancer = this.loudnessEnhancer;\n         if (oldEnhancer != null) {\ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/VolumeAdaptionSetting.java b/model/src/main/java/de/danoeh/antennapod/model/feed/VolumeAdaptionSetting.java\nindex e71c5ad363..a9b1089f2b 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/feed/VolumeAdaptionSetting.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/VolumeAdaptionSetting.java\n@@ -1,5 +1,10 @@\n package de.danoeh.antennapod.model.feed;\n \n+import android.media.audiofx.AudioEffect;\n+\n+import androidx.annotation.Nullable;\n+import androidx.annotation.VisibleForTesting;\n+\n public enum VolumeAdaptionSetting {\n     OFF(0, 1.0f),\n     LIGHT_REDUCTION(1, 0.5f),\n@@ -32,4 +37,29 @@ public int toInteger() {\n     public float getAdaptionFactor() {\n         return adaptionFactor;\n     }\n+\n+    @Nullable\n+    private static Boolean boostSupported = null;\n+\n+    public static boolean isBoostSupported() {\n+        if (boostSupported != null) {\n+            return boostSupported;\n+        }\n+        final AudioEffect.Descriptor[] audioEffects = AudioEffect.queryEffects();\n+        if (audioEffects != null) {\n+            for (AudioEffect.Descriptor effect : audioEffects) {\n+                if (effect.type.equals(AudioEffect.EFFECT_TYPE_LOUDNESS_ENHANCER)) {\n+                    boostSupported = true;\n+                    return boostSupported;\n+                }\n+            }\n+        }\n+        boostSupported = false;\n+        return boostSupported;\n+    }\n+\n+    @VisibleForTesting\n+    public static void setBoostSupported(@Nullable Boolean boostSupported) {\n+        VolumeAdaptionSetting.boostSupported = boostSupported;\n+    }\n }\n", "test_patch": "diff --git a/core/src/test/java/de/danoeh/antennapod/core/feed/VolumeAdaptionSettingTest.java b/core/src/test/java/de/danoeh/antennapod/core/feed/VolumeAdaptionSettingTest.java\nindex 30767bdc88..966351a5e4 100644\n--- a/core/src/test/java/de/danoeh/antennapod/core/feed/VolumeAdaptionSettingTest.java\n+++ b/core/src/test/java/de/danoeh/antennapod/core/feed/VolumeAdaptionSettingTest.java\n@@ -1,6 +1,9 @@\n package de.danoeh.antennapod.core.feed;\n \n import de.danoeh.antennapod.model.feed.VolumeAdaptionSetting;\n+\n+import org.junit.After;\n+import org.junit.Before;\n import org.junit.Test;\n \n import static org.hamcrest.Matchers.equalTo;\n@@ -11,6 +14,16 @@\n \n public class VolumeAdaptionSettingTest {\n \n+    @Before\n+    public void setUp() throws Exception {\n+        VolumeAdaptionSetting.setBoostSupported(false);\n+    }\n+\n+    @After\n+    public void tearDown() throws Exception {\n+        VolumeAdaptionSetting.setBoostSupported(null);\n+    }\n+\n     @Test\n     public void mapOffToInteger() {\n         VolumeAdaptionSetting setting = VolumeAdaptionSetting.OFF;\n", "problem_statement": "Media wont play in Version 3.2.0 (3020095)\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n### App version\r\n\r\n3.2.0\r\n\r\n### Where did you get the app from\r\n\r\nF-Droid\r\n\r\n### Android version\r\n\r\n13 PixelExperience_topaz-13.0-20230714-1432-UNOFFICIAL\r\n\r\n### Device model\r\n\r\nRemi Note 12 4G\r\n\r\n### First occurred\r\n\r\nabout a week ago\r\n\r\n### Steps to reproduce\r\n\r\ninstall version 3.2.0\r\n\r\n### Expected behaviour\r\n\r\nmedia should play\r\n\r\n### Current behaviour\r\n\r\nmedia does not play neither downloaded nor stream, the player doesn't come up when clicking play. it works perfectly in 3.1.2 and below.\r\n\r\n### Logs\r\n\r\nI already downgraded back to 3.1.2 so I can't export the logs but I have this from logfox:\r\n\n```\r\n1702289036.344 10231  8418  8418 D ExternalPlayerFragment: Loading media info\r\n1702289036.348 10231  8418  8418 D QueueFragment: loadItems()\r\n1702289036.348 10231  8418 12216 D DBReader: getQueue() called\r\n1702289036.348 10231  8418 12216 D DBReader: getQueue()\r\n1702289036.350 10231  8418 12216 D DBReader: getFavoriteIDList() called\r\n1702289036.351 10231  8418 12216 D DBReader: getQueueIDList() called\r\n1702289036.352 10231  8418 12216 D DBReader: Extracting Feedlist\r\n1702289036.352 10231  8418  8418 D MainActivity: handleNavIntent()\r\n1702289036.352 10231  8418  8418 D NavDrawerFragment: getLastNavFragment() -> QueueFragment\r\n1702289036.353 10231  8418 12383 D DBReader: getNavDrawerData() called with:\r\n1702289036.363 10231  8418  9893 E OpenGLRenderer: Unable to match the desired swap behavior.\r\n1702289036.410 10231  8418 12383 D DBReader: getRecentlyPublishedEpisodes() called with: offset=0, limit=2147483647\r\n1702289036.549 10231  8418 12383 D DBReader: getFavoriteIDList() called\r\n1702289036.550 10231  8418 12383 D DBReader: getQueueIDList() called\r\n1702289036.551 10231  8418 12383 D DBReader: Extracting Feedlist\r\n1702289036.559 10231  8418  8418 D NavDrawerFragment: getLastNavFragment() -> QueueFragment\r\n1702289036.560 10231  8418  8418 D NavDrawerFragment: getLastNavFragment() -> QueueFragment\r\n1702289036.560 10231  8418  8418 D NavDrawerFragment: getLastNavFragment() -> QueueFragment\r\n1702289036.560 10231  8418  8418 D NavDrawerFragment: getLastNavFragment() -> QueueFragment\r\n1702289036.561 10231  8418  8418 D NavDrawerFragment: getLastNavFragment() -> QueueFragment\r\n1702289036.561 10231  8418  8418 D NavDrawerFragment: getLastNavFragment() -> QueueFragment\r\n1702289036.561 10231  8418  8418 D NavDrawerFragment: getLastNavFragment() -> QueueFragment\r\n1702289036.562 10231  8418  8418 D NavDrawerFragment: getLastNavFragment() -> QueueFragment\r\n1702289037.765 10231  8418  8418 D PlaybackService: Service created.\r\n1702289037.774 10231  8418  8418 D PlaybackController: Trying to connect to service\r\n1702289037.776 10231  8418  8418 D PlaybackController: Result for service binding: true\r\n1702289037.778 10231  8418  8418 D PlaybackController: Trying to connect to service\r\n1702289037.779 10231  8418  8418 D PlaybackController: Result for service binding: true\r\n1702289037.779 10231  8418  8418 D ExternalPlayerFragment: Loading media info\r\n1702289037.779 10231  8418  8418 D PlaybackService: OnStartCommand called\r\n1702289037.780 10231  8418  8418 D PlaybackSrvState: startForeground\r\n1702289037.783 10231  8418  8418 D PlaybackService: Received onBind event\r\n1702289037.783 10231  8418 12383 D DBReader: getFeedItem() called with: itemId = [1570]\r\n1702289037.783 10231  8418 12383 D DBReader: Loading feeditem with id 1570\r\n1702289037.783 10231  8418 12383 D DBReader: getFavoriteIDList() called\r\n1702289037.784 10231  8418 12383 D DBReader: getQueueIDList() called\r\n1702289037.784 10231  8418 12383 D DBReader: Extracting Feedlist\r\n1702289037.785 10231  8418  8418 D PlaybackController: Trying to connect to service\r\n1702289037.786 10231  8418  8418 D PlaybackController: Result for service binding: true\r\n1702289037.786 10231  8418  8418 D PlaybackController: Trying to connect to service\r\n1702289037.787 10231  8418  8418 D PlaybackController: Result for service binding: true\r\n1702289037.787 10231  8418  8418 D PlaybackController: Querying service info\r\n1702289037.787 10231  8418  8418 D PlaybackController: status: STOPPED\r\n1702289037.787 10231  8418  8418 D PlaybackController: Connection to Service established\r\n1702289037.787 10231  8418  8418 D PlaybackController: Querying service info\r\n1702289037.787 10231  8418  8418 D PlaybackController: status: STOPPED\r\n1702289037.787 10231  8418  8418 D ExternalPlayerFragment: Loading media info\r\n1702289037.787 10231  8418  8418 D PlaybackController: Connection to Service established\r\n1702289037.795 10231  8418  8418 D LclPlaybackSvcMPlayer: playMediaObject(...)\r\n1702289037.808 10231  8418  8418 I ExoPlayerImpl: Init 4a66ac [ExoPlayerLib/2.14.2] [tapas, 23021RAAEG, Xiaomi, 33]\r\n1702289037.813 10231  8418  8418 E AudioEffect: set(): AudioFlinger could not create effect fe3199be-aed0-413f-87bb-11260eb63cf1 / ec7178ec-e5e1-4432-a3f4-4657e6795210, status: -2\r\n1702289037.813 10231  8418  8418 E AudioEffects-JNI: AudioEffect initCheck failed -3\r\n1702289037.813 10231  8418  8418 E AudioEffect-JAVA: Error code -3 when initializing AudioEffect.\r\n1702289037.813 10231  8418  8418 W System.err: java.lang.RuntimeException: Cannot initialize effect engine for type: fe3199be-aed0-413f-87bb-11260eb63cf1 Error: -3\r\n1702289037.813 10231  8418  8418 W System.err: \tat android.media.audiofx.AudioEffect.<init>(AudioEffect.java:543)\r\n1702289037.813 10231  8418  8418 W System.err: \tat android.media.audiofx.AudioEffect.<init>(AudioEffect.java:501)\r\n1702289037.813 10231  8418  8418 W System.err: \tat android.media.audiofx.AudioEffect.<init>(AudioEffect.java:475)\r\n1702289037.814 10231  8418  8418 W System.err: \tat android.media.audiofx.LoudnessEnhancer.<init>(LoudnessEnhancer.java:80)\r\n1702289037.814 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.ExoPlayerWrapper.initLoudnessEnhancer(ExoPlayerWrapper.java:357)\r\n1702289037.814 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.ExoPlayerWrapper.createPlayer(ExoPlayerWrapper.java:146)\r\n1702289037.814 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.ExoPlayerWrapper.<init>(ExoPlayerWrapper.java:76)\r\n1702289037.814 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.LocalPSMP.createMediaPlayer(LocalPSMP.java:587)\r\n1702289037.814 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.LocalPSMP.playMediaObject(LocalPSMP.java:158)\r\n1702289037.814 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.LocalPSMP.playMediaObject(LocalPSMP.java:113)\r\n1702289037.814 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.startPlaying(PlaybackService.java:741)\r\n1702289037.814 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.lambda$onStartCommand$6(PlaybackService.java:526)\r\n1702289037.814 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.$r8$lambda$mOCf9qqsskaQGmxsaI_m2ZmJO2w(PlaybackService.java:0)\r\n1702289037.814 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService$$ExternalSyntheticLambda6.accept(R8$$SyntheticClass:0)\r\n1702289037.814 10231  8418  8418 W System.err: \tat io.reactivex.internal.observers.LambdaObserver.onNext(LambdaObserver.java:63)\r\n1702289037.814 10231  8418  8418 W System.err: \tat io.reactivex.internal.operators.observable.ObservableObserveOn$ObserveOnObserver.drainNormal(ObservableObserveOn.java:201)\r\n1702289037.814 10231  8418  8418 W System.err: \tat io.reactivex.internal.operators.observable.ObservableObserveOn$ObserveOnObserver.run(ObservableObserveOn.java:255)\r\n1702289037.814 10231  8418  8418 W System.err: \tat io.reactivex.android.schedulers.HandlerScheduler$ScheduledRunnable.run(HandlerScheduler.java:124)\r\n1702289037.814 10231  8418  8418 W System.err: \tat android.os.Handler.handleCallback(Handler.java:942)\r\n1702289037.814 10231  8418  8418 W System.err: \tat android.os.Handler.dispatchMessage(Handler.java:99)\r\n1702289037.814 10231  8418  8418 W System.err: \tat android.os.Looper.loopOnce(Looper.java:201)\r\n1702289037.814 10231  8418  8418 W System.err: \tat android.os.Looper.loop(Looper.java:288)\r\n1702289037.814 10231  8418  8418 W System.err: \tat android.app.ActivityThread.main(ActivityThread.java:7959)\r\n1702289037.814 10231  8418  8418 W System.err: \tat java.lang.reflect.Method.invoke(Native Method)\r\n1702289037.814 10231  8418  8418 W System.err: \tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548)\r\n1702289037.814 10231  8418  8418 W System.err: \tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:942)\r\n1702289037.814 10231  8418  8418 D PlaybackService: Playable was not found. Stopping service.\r\n1702289037.814 10231  8418  8418 W System.err: java.lang.RuntimeException: Cannot initialize effect engine for type: fe3199be-aed0-413f-87bb-11260eb63cf1 Error: -3\r\n1702289037.814 10231  8418  8418 W System.err: \tat android.media.audiofx.AudioEffect.<init>(AudioEffect.java:543)\r\n1702289037.814 10231  8418  8418 W System.err: \tat android.media.audiofx.AudioEffect.<init>(AudioEffect.java:501)\r\n1702289037.814 10231  8418  8418 W System.err: \tat android.media.audiofx.AudioEffect.<init>(AudioEffect.java:475)\r\n1702289037.814 10231  8418  8418 W System.err: \tat android.media.audiofx.LoudnessEnhancer.<init>(LoudnessEnhancer.java:80)\r\n1702289037.814 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.ExoPlayerWrapper.initLoudnessEnhancer(ExoPlayerWrapper.java:357)\r\n1702289037.814 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.ExoPlayerWrapper.createPlayer(ExoPlayerWrapper.java:146)\r\n1702289037.814 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.ExoPlayerWrapper.<init>(ExoPlayerWrapper.java:76)\r\n1702289037.815 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.LocalPSMP.createMediaPlayer(LocalPSMP.java:587)\r\n1702289037.815 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.LocalPSMP.playMediaObject(LocalPSMP.java:158)\r\n1702289037.815 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.LocalPSMP.playMediaObject(LocalPSMP.java:113)\r\n1702289037.815 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.startPlaying(PlaybackService.java:741)\r\n1702289037.815 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.lambda$onStartCommand$6(PlaybackService.java:526)\r\n1702289037.815 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.$r8$lambda$mOCf9qqsskaQGmxsaI_m2ZmJO2w(PlaybackService.java:0)\r\n1702289037.815 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService$$ExternalSyntheticLambda6.accept(R8$$SyntheticClass:0)\r\n1702289037.815 10231  8418  8418 W System.err: \tat io.reactivex.internal.observers.LambdaObserver.onNext(LambdaObserver.java:63)\r\n1702289037.815 10231  8418  8418 W System.err: \tat io.reactivex.internal.operators.observable.ObservableObserveOn$ObserveOnObserver.drainNormal(ObservableObserveOn.java:201)\r\n1702289037.815 10231  8418  8418 W System.err: \tat io.reactivex.internal.operators.observable.ObservableObserveOn$ObserveOnObserver.run(ObservableObserveOn.java:255)\r\n1702289037.815 10231  8418  8418 W System.err: \tat io.reactivex.android.schedulers.HandlerScheduler$ScheduledRunnable.run(HandlerScheduler.java:124)\r\n1702289037.815 10231  8418  8418 W System.err: \tat android.os.Handler.handleCallback(Handler.java:942)\r\n1702289037.815 10231  8418  8418 W System.err: \tat android.os.Handler.dispatchMessage(Handler.java:99)\r\n1702289037.815 10231  8418  8418 W System.err: \tat android.os.Looper.loopOnce(Looper.java:201)\r\n1702289037.815 10231  8418  8418 W System.err: \tat android.os.Looper.loop(Looper.java:288)\r\n1702289037.815 10231  8418  8418 W System.err: \tat android.app.ActivityThread.main(ActivityThread.java:7959)\r\n1702289037.815 10231  8418  8418 W System.err: \tat java.lang.reflect.Method.invoke(Native Method)\r\n1702289037.815 10231  8418  8418 W System.err: \tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548)\r\n1702289037.815 10231  8418  8418 W System.err: \tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:942)\r\n1702289037.815 10231  8418  8418 D PlaybackSrvState: stopService\r\n1702289037.815 10231  8418  8418 D PlaybackSrvState: stopForeground\r\n1702289037.821 10231  8418  8418 D PlaybackController: Disconnected from Service\r\n1702289037.821 10231  8418  8418 D PlaybackController: Disconnected from Service\r\n1702289037.821 10231  8418  8418 D PlaybackService: Received onUnbind event\r\n1702289037.821 10231  8418  8418 D PlaybackService: Service is about to be destroyed\r\n1702289037.821 10231  8418  8418 D PlaybackSrvState: stopForeground\r\n1702289039.176 10231  8418  8418 D PlaybackService: Service created.\r\n1702289039.188 10231  8418  8418 D PlaybackController: Trying to connect to service\r\n1702289039.189 10231  8418  8418 D PlaybackController: Result for service binding: true\r\n1702289039.189 10231  8418  8418 D PlaybackController: Trying to connect to service\r\n1702289039.190 10231  8418  8418 D PlaybackController: Result for service binding: true\r\n1702289039.190 10231  8418  8418 D PlaybackService: OnStartCommand called\r\n1702289039.191 10231  8418  8418 D PlaybackSrvState: startForeground\r\n1702289039.194 10231  8418  8418 D PlaybackService: Received onBind event\r\n1702289039.200 10231  8418  8418 D PlaybackController: Trying to connect to service\r\n1702289039.201 10231  8418  8418 D PlaybackController: Result for service binding: true\r\n1702289039.201 10231  8418  8418 D PlaybackController: Trying to connect to service\r\n1702289039.202 10231  8418  8418 D PlaybackController: Result for service binding: true\r\n1702289039.202 10231  8418  8418 D PlaybackController: Querying service info\r\n1702289039.202 10231  8418  8418 D PlaybackController: status: STOPPED\r\n1702289039.202 10231  8418  8418 D PlaybackController: Connection to Service established\r\n1702289039.202 10231  8418  8418 D PlaybackController: Querying service info\r\n1702289039.202 10231  8418  8418 D PlaybackController: status: STOPPED\r\n1702289039.202 10231  8418  8418 D ExternalPlayerFragment: Loading media info\r\n1702289039.202 10231  8418 12230 D DBReader: getFeedItem() called with: itemId = [1570]\r\n1702289039.202 10231  8418  8418 D PlaybackController: Connection to Service established\r\n1702289039.202 10231  8418 12230 D DBReader: Loading feeditem with id 1570\r\n1702289039.203 10231  8418 12230 D DBReader: getFavoriteIDList() called\r\n1702289039.204 10231  8418 12230 D DBReader: getQueueIDList() called\r\n1702289039.204 10231  8418 12230 D DBReader: Extracting Feedlist\r\n1702289039.215 10231  8418  8418 D LclPlaybackSvcMPlayer: playMediaObject(...)\r\n1702289039.219 10231  8418  8418 I ExoPlayerImpl: Init c5ceaba [ExoPlayerLib/2.14.2] [tapas, 23021RAAEG, Xiaomi, 33]\r\n1702289039.223 10231  8418  8418 E AudioEffect: set(): AudioFlinger could not create effect fe3199be-aed0-413f-87bb-11260eb63cf1 / ec7178ec-e5e1-4432-a3f4-4657e6795210, status: -2\r\n1702289039.224 10231  8418  8418 E AudioEffects-JNI: AudioEffect initCheck failed -3\r\n1702289039.224 10231  8418  8418 E AudioEffect-JAVA: Error code -3 when initializing AudioEffect.\r\n1702289039.224 10231  8418  8418 W System.err: java.lang.RuntimeException: Cannot initialize effect engine for type: fe3199be-aed0-413f-87bb-11260eb63cf1 Error: -3\r\n1702289039.224 10231  8418  8418 W System.err: \tat android.media.audiofx.AudioEffect.<init>(AudioEffect.java:543)\r\n1702289039.224 10231  8418  8418 W System.err: \tat android.media.audiofx.AudioEffect.<init>(AudioEffect.java:501)\r\n1702289039.224 10231  8418  8418 W System.err: \tat android.media.audiofx.AudioEffect.<init>(AudioEffect.java:475)\r\n1702289039.224 10231  8418  8418 W System.err: \tat android.media.audiofx.LoudnessEnhancer.<init>(LoudnessEnhancer.java:80)\r\n1702289039.224 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.ExoPlayerWrapper.initLoudnessEnhancer(ExoPlayerWrapper.java:357)\r\n1702289039.224 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.ExoPlayerWrapper.createPlayer(ExoPlayerWrapper.java:146)\r\n1702289039.224 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.ExoPlayerWrapper.<init>(ExoPlayerWrapper.java:76)\r\n1702289039.224 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.LocalPSMP.createMediaPlayer(LocalPSMP.java:587)\r\n1702289039.224 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.LocalPSMP.playMediaObject(LocalPSMP.java:158)\r\n1702289039.224 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.LocalPSMP.playMediaObject(LocalPSMP.java:113)\r\n1702289039.224 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.startPlaying(PlaybackService.java:741)\r\n1702289039.224 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.lambda$onStartCommand$6(PlaybackService.java:526)\r\n1702289039.224 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.$r8$lambda$mOCf9qqsskaQGmxsaI_m2ZmJO2w(PlaybackService.java:0)\r\n1702289039.224 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService$$ExternalSyntheticLambda6.accept(R8$$SyntheticClass:0)\r\n1702289039.224 10231  8418  8418 W System.err: \tat io.reactivex.internal.observers.LambdaObserver.onNext(LambdaObserver.java:63)\r\n1702289039.224 10231  8418  8418 W System.err: \tat io.reactivex.internal.operators.observable.ObservableObserveOn$ObserveOnObserver.drainNormal(ObservableObserveOn.java:201)\r\n1702289039.224 10231  8418  8418 W System.err: \tat io.reactivex.internal.operators.observable.ObservableObserveOn$ObserveOnObserver.run(ObservableObserveOn.java:255)\r\n1702289039.224 10231  8418  8418 W System.err: \tat io.reactivex.android.schedulers.HandlerScheduler$ScheduledRunnable.run(HandlerScheduler.java:124)\r\n1702289039.224 10231  8418  8418 W System.err: \tat android.os.Handler.handleCallback(Handler.java:942)\r\n1702289039.224 10231  8418  8418 W System.err: \tat android.os.Handler.dispatchMessage(Handler.java:99)\r\n1702289039.224 10231  8418  8418 W System.err: \tat android.os.Looper.loopOnce(Looper.java:201)\r\n1702289039.224 10231  8418  8418 W System.err: \tat android.os.Looper.loop(Looper.java:288)\r\n1702289039.224 10231  8418  8418 W System.err: \tat android.app.ActivityThread.main(ActivityThread.java:7959)\r\n1702289039.224 10231  8418  8418 W System.err: \tat java.lang.reflect.Method.invoke(Native Method)\r\n1702289039.224 10231  8418  8418 W System.err: \tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548)\r\n1702289039.224 10231  8418  8418 W System.err: \tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:942)\r\n1702289039.224 10231  8418  8418 D PlaybackService: Playable was not found. Stopping service.\r\n1702289039.225 10231  8418  8418 W System.err: java.lang.RuntimeException: Cannot initialize effect engine for type: fe3199be-aed0-413f-87bb-11260eb63cf1 Error: -3\r\n1702289039.225 10231  8418  8418 W System.err: \tat android.media.audiofx.AudioEffect.<init>(AudioEffect.java:543)\r\n1702289039.225 10231  8418  8418 W System.err: \tat android.media.audiofx.AudioEffect.<init>(AudioEffect.java:501)\r\n1702289039.225 10231  8418  8418 W System.err: \tat android.media.audiofx.AudioEffect.<init>(AudioEffect.java:475)\r\n1702289039.225 10231  8418  8418 W System.err: \tat android.media.audiofx.LoudnessEnhancer.<init>(LoudnessEnhancer.java:80)\r\n1702289039.225 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.ExoPlayerWrapper.initLoudnessEnhancer(ExoPlayerWrapper.java:357)\r\n1702289039.225 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.ExoPlayerWrapper.createPlayer(ExoPlayerWrapper.java:146)\r\n1702289039.225 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.ExoPlayerWrapper.<init>(ExoPlayerWrapper.java:76)\r\n1702289039.225 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.LocalPSMP.createMediaPlayer(LocalPSMP.java:587)\r\n1702289039.225 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.LocalPSMP.playMediaObject(LocalPSMP.java:158)\r\n1702289039.225 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.LocalPSMP.playMediaObject(LocalPSMP.java:113)\r\n1702289039.225 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.startPlaying(PlaybackService.java:741)\r\n1702289039.225 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.lambda$onStartCommand$6(PlaybackService.java:526)\r\n1702289039.225 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.$r8$lambda$mOCf9qqsskaQGmxsaI_m2ZmJO2w(PlaybackService.java:0)\r\n1702289039.225 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService$$ExternalSyntheticLambda6.accept(R8$$SyntheticClass:0)\r\n1702289039.225 10231  8418  8418 W System.err: \tat io.reactivex.internal.observers.LambdaObserver.onNext(LambdaObserver.java:63)\r\n1702289039.225 10231  8418  8418 W System.err: \tat io.reactivex.internal.operators.observable.ObservableObserveOn$ObserveOnObserver.drainNormal(ObservableObserveOn.java:201)\r\n1702289039.225 10231  8418  8418 W System.err: \tat io.reactivex.internal.operators.observable.ObservableObserveOn$ObserveOnObserver.run(ObservableObserveOn.java:255)\r\n1702289039.225 10231  8418  8418 W System.err: \tat io.reactivex.android.schedulers.HandlerScheduler$ScheduledRunnable.run(HandlerScheduler.java:124)\r\n1702289039.225 10231  8418  8418 W System.err: \tat android.os.Handler.handleCallback(Handler.java:942)\r\n1702289039.225 10231  8418  8418 W System.err: \tat android.os.Handler.dispatchMessage(Handler.java:99)\r\n1702289039.225 10231  8418  8418 W System.err: \tat android.os.Looper.loopOnce(Looper.java:201)\r\n1702289039.225 10231  8418  8418 W System.err: \tat android.os.Looper.loop(Looper.java:288)\r\n1702289039.225 10231  8418  8418 W System.err: \tat android.app.ActivityThread.main(ActivityThread.java:7959)\r\n1702289039.225 10231  8418  8418 W System.err: \tat java.lang.reflect.Method.invoke(Native Method)\r\n1702289039.225 10231  8418  8418 W System.err: \tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548)\r\n1702289039.225 10231  8418  8418 W System.err: \tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:942)\r\n1702289039.225 10231  8418  8418 D PlaybackSrvState: stopService\r\n1702289039.225 10231  8418  8418 D PlaybackSrvState: stopForeground\r\n1702289039.227 10231  8418  8418 D PlaybackController: Disconnected from Service\r\n1702289039.227 10231  8418  8418 D PlaybackController: Disconnected from Service\r\n1702289039.227 10231  8418  8418 D PlaybackService: Received onUnbind event\r\n1702289039.228 10231  8418  8418 D PlaybackService: Service is about to be destroyed\r\n1702289039.228 10231  8418  8418 D PlaybackSrvState: stopForeground\r\n1702289040.348 10231  8418  8418 D PlaybackService: Service created.\r\n1702289040.362 10231  8418  8418 D PlaybackController: Trying to connect to service\r\n1702289040.363 10231  8418  8418 D PlaybackController: Result for service binding: true\r\n1702289040.363 10231  8418  8418 D PlaybackController: Trying to connect to service\r\n1702289040.364 10231  8418  8418 D PlaybackController: Result for service binding: true\r\n1702289040.365 10231  8418  8418 D PlaybackService: OnStartCommand called\r\n1702289040.365 10231  8418  8418 D PlaybackSrvState: startForeground\r\n1702289040.368 10231  8418 12216 D DBReader: getFeedItem() called with: itemId = [1570]\r\n1702289040.368 10231  8418 12216 D DBReader: Loading feeditem with id 1570\r\n1702289040.369 10231  8418  8418 D PlaybackService: Received onBind event\r\n1702289040.370 10231  8418 12216 D DBReader: getFavoriteIDList() called\r\n1702289040.371 10231  8418 12216 D DBReader: getQueueIDList() called\r\n1702289040.371 10231  8418 12216 D DBReader: Extracting Feedlist\r\n1702289040.376 10231  8418  8418 D PlaybackController: Trying to connect to service\r\n1702289040.378 10231  8418  8418 D PlaybackController: Result for service binding: true\r\n1702289040.378 10231  8418  8418 D PlaybackController: Querying service info\r\n1702289040.378 10231  8418  8418 D PlaybackController: status: STOPPED\r\n1702289040.378 10231  8418  8418 D PlaybackController: Connection to Service established\r\n1702289040.378 10231  8418  8418 D PlaybackController: Trying to connect to service\r\n1702289040.379 10231  8418  8418 D PlaybackController: Result for service binding: true\r\n1702289040.379 10231  8418  8418 D PlaybackController: Querying service info\r\n1702289040.380 10231  8418  8418 D PlaybackController: status: STOPPED\r\n1702289040.380 10231  8418  8418 D ExternalPlayerFragment: Loading media info\r\n1702289040.380 10231  8418  8418 D PlaybackController: Connection to Service established\r\n1702289040.380 10231  8418  8418 D LclPlaybackSvcMPlayer: playMediaObject(...)\r\n1702289040.390 10231  8418  8418 I ExoPlayerImpl: Init c03e75b [ExoPlayerLib/2.14.2] [tapas, 23021RAAEG, Xiaomi, 33]\r\n1702289040.394 10231  8418  8418 E AudioEffect: set(): AudioFlinger could not create effect fe3199be-aed0-413f-87bb-11260eb63cf1 / ec7178ec-e5e1-4432-a3f4-4657e6795210, status: -2\r\n1702289040.394 10231  8418  8418 E AudioEffects-JNI: AudioEffect initCheck failed -3\r\n1702289040.394 10231  8418  8418 E AudioEffect-JAVA: Error code -3 when initializing AudioEffect.\r\n1702289040.394 10231  8418  8418 W System.err: java.lang.RuntimeException: Cannot initialize effect engine for type: fe3199be-aed0-413f-87bb-11260eb63cf1 Error: -3\r\n1702289040.394 10231  8418  8418 W System.err: \tat android.media.audiofx.AudioEffect.<init>(AudioEffect.java:543)\r\n1702289040.394 10231  8418  8418 W System.err: \tat android.media.audiofx.AudioEffect.<init>(AudioEffect.java:501)\r\n1702289040.394 10231  8418  8418 W System.err: \tat android.media.audiofx.AudioEffect.<init>(AudioEffect.java:475)\r\n1702289040.394 10231  8418  8418 W System.err: \tat android.media.audiofx.LoudnessEnhancer.<init>(LoudnessEnhancer.java:80)\r\n1702289040.394 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.ExoPlayerWrapper.initLoudnessEnhancer(ExoPlayerWrapper.java:357)\r\n1702289040.394 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.ExoPlayerWrapper.createPlayer(ExoPlayerWrapper.java:146)\r\n1702289040.394 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.ExoPlayerWrapper.<init>(ExoPlayerWrapper.java:76)\r\n1702289040.394 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.LocalPSMP.createMediaPlayer(LocalPSMP.java:587)\r\n1702289040.394 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.LocalPSMP.playMediaObject(LocalPSMP.java:158)\r\n1702289040.394 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.LocalPSMP.playMediaObject(LocalPSMP.java:113)\r\n1702289040.394 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.startPlaying(PlaybackService.java:741)\r\n1702289040.394 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.lambda$onStartCommand$6(PlaybackService.java:526)\r\n1702289040.395 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.$r8$lambda$mOCf9qqsskaQGmxsaI_m2ZmJO2w(PlaybackService.java:0)\r\n1702289040.395 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService$$ExternalSyntheticLambda6.accept(R8$$SyntheticClass:0)\r\n1702289040.395 10231  8418  8418 W System.err: \tat io.reactivex.internal.observers.LambdaObserver.onNext(LambdaObserver.java:63)\r\n1702289040.395 10231  8418  8418 W System.err: \tat io.reactivex.internal.operators.observable.ObservableObserveOn$ObserveOnObserver.drainNormal(ObservableObserveOn.java:201)\r\n1702289040.395 10231  8418  8418 W System.err: \tat io.reactivex.internal.operators.observable.ObservableObserveOn$ObserveOnObserver.run(ObservableObserveOn.java:255)\r\n1702289040.395 10231  8418  8418 W System.err: \tat io.reactivex.android.schedulers.HandlerScheduler$ScheduledRunnable.run(HandlerScheduler.java:124)\r\n1702289040.395 10231  8418  8418 W System.err: \tat android.os.Handler.handleCallback(Handler.java:942)\r\n1702289040.395 10231  8418  8418 W System.err: \tat android.os.Handler.dispatchMessage(Handler.java:99)\r\n1702289040.395 10231  8418  8418 W System.err: \tat android.os.Looper.loopOnce(Looper.java:201)\r\n1702289040.395 10231  8418  8418 W System.err: \tat android.os.Looper.loop(Looper.java:288)\r\n1702289040.395 10231  8418  8418 W System.err: \tat android.app.ActivityThread.main(ActivityThread.java:7959)\r\n1702289040.395 10231  8418  8418 W System.err: \tat java.lang.reflect.Method.invoke(Native Method)\r\n1702289040.395 10231  8418  8418 W System.err: \tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548)\r\n1702289040.395 10231  8418  8418 W System.err: \tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:942)\r\n1702289040.395 10231  8418  8418 D PlaybackService: Playable was not found. Stopping service.\r\n1702289040.395 10231  8418  8418 W System.err: java.lang.RuntimeException: Cannot initialize effect engine for type: fe3199be-aed0-413f-87bb-11260eb63cf1 Error: -3\r\n1702289040.395 10231  8418  8418 W System.err: \tat android.media.audiofx.AudioEffect.<init>(AudioEffect.java:543)\r\n1702289040.395 10231  8418  8418 W System.err: \tat android.media.audiofx.AudioEffect.<init>(AudioEffect.java:501)\r\n1702289040.395 10231  8418  8418 W System.err: \tat android.media.audiofx.AudioEffect.<init>(AudioEffect.java:475)\r\n1702289040.395 10231  8418  8418 W System.err: \tat android.media.audiofx.LoudnessEnhancer.<init>(LoudnessEnhancer.java:80)\r\n1702289040.395 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.ExoPlayerWrapper.initLoudnessEnhancer(ExoPlayerWrapper.java:357)\r\n1702289040.395 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.ExoPlayerWrapper.createPlayer(ExoPlayerWrapper.java:146)\r\n1702289040.395 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.ExoPlayerWrapper.<init>(ExoPlayerWrapper.java:76)\r\n1702289040.395 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.LocalPSMP.createMediaPlayer(LocalPSMP.java:587)\r\n1702289040.395 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.LocalPSMP.playMediaObject(LocalPSMP.java:158)\r\n1702289040.395 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.LocalPSMP.playMediaObject(LocalPSMP.java:113)\r\n1702289040.395 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.startPlaying(PlaybackService.java:741)\r\n1702289040.395 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.lambda$onStartCommand$6(PlaybackService.java:526)\r\n1702289040.395 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.$r8$lambda$mOCf9qqsskaQGmxsaI_m2ZmJO2w(PlaybackService.java:0)\r\n1702289040.395 10231  8418  8418 W System.err: \tat de.danoeh.antennapod.core.service.playback.PlaybackService$$ExternalSyntheticLambda6.accept(R8$$SyntheticClass:0)\r\n1702289040.395 10231  8418  8418 W System.err: \tat io.reactivex.internal.observers.LambdaObserver.onNext(LambdaObserver.java:63)\r\n1702289040.395 10231  8418  8418 W System.err: \tat io.reactivex.internal.operators.observable.ObservableObserveOn$ObserveOnObserver.drainNormal(ObservableObserveOn.java:201)\r\n1702289040.395 10231  8418  8418 W System.err: \tat io.reactivex.internal.operators.observable.ObservableObserveOn$ObserveOnObserver.run(ObservableObserveOn.java:255)\r\n1702289040.395 10231  8418  8418 W System.err: \tat io.reactivex.android.schedulers.HandlerScheduler$ScheduledRunnable.run(HandlerScheduler.java:124)\r\n1702289040.395 10231  8418  8418 W System.err: \tat android.os.Handler.handleCallback(Handler.java:942)\r\n1702289040.395 10231  8418  8418 W System.err: \tat android.os.Handler.dispatchMessage(Handler.java:99)\r\n1702289040.395 10231  8418  8418 W System.err: \tat android.os.Looper.loopOnce(Looper.java:201)\r\n1702289040.395 10231  8418  8418 W System.err: \tat android.os.Looper.loop(Looper.java:288)\r\n1702289040.395 10231  8418  8418 W System.err: \tat android.app.ActivityThread.main(ActivityThread.java:7959)\r\n1702289040.395 10231  8418  8418 W System.err: \tat java.lang.reflect.Method.invoke(Native Method)\r\n1702289040.395 10231  8418  8418 W System.err: \tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548)\r\n1702289040.395 10231  8418  8418 W System.err: \tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:942)\r\n1702289040.395 10231  8418  8418 D PlaybackSrvState: stopService\r\n1702289040.395 10231  8418  8418 D PlaybackSrvState: stopForeground\r\n1702289040.398 10231  8418  8418 D PlaybackController: Disconnected from Service\r\n1702289040.398 10231  8418  8418 D PlaybackController: Disconnected from Service\r\n1702289040.398 10231  8418  8418 D PlaybackService: Received onUnbind event\r\n1702289040.398 10231  8418  8418 D PlaybackService: Service is about to be destroyed\r\n1702289040.398 10231  8418  8418 D PlaybackSrvState: stopForeground\r\n1702289041.529 10231  8418  8418 D PlaybackController: Releasing PlaybackController\r\n1702289041.533 10231  8418  8418 D PlaybackController: Releasing PlaybackController\n```\n", "hints_text": "Ping @matejdro\nMy guess is that this device does not support the audio boost effect?\r\n\r\nFrom what I can read , we can query the effects via `android.media.audiofx.AudioEffect.queryEffects` and if there is not UUID of `android.media.audiofx.AudioEffect#EFFECT_TYPE_LOUDNESS_ENHANCER` in there, disable it in ExoPlayerWrapper and hide setting from settings (or disable it with a note saying \"Not supported on your device\"?).\r\n\r\nIt might also be worth try catching the whole thing just in case and log the exceptions somewhere.\r\n\r\nI can try doing a PR for this, but I'm not sure if I can do it within couple of days.", "created_at": "2023-12-13T07:36:26Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6789, "instance_id": "AntennaPod__AntennaPod-6789", "issue_numbers": ["6785"], "base_commit": "c1712fe2f55374d276d166ce02c9882a2300264a", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/dialog/IntraFeedSortDialog.java b/app/src/main/java/de/danoeh/antennapod/dialog/IntraFeedSortDialog.java\ndeleted file mode 100644\nindex dc8cf65ba6..0000000000\n--- a/app/src/main/java/de/danoeh/antennapod/dialog/IntraFeedSortDialog.java\n+++ /dev/null\n@@ -1,68 +0,0 @@\n-package de.danoeh.antennapod.dialog;\n-\n-import android.content.Context;\n-\n-import androidx.annotation.NonNull;\n-import androidx.annotation.Nullable;\n-import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n-\n-import de.danoeh.antennapod.R;\n-import de.danoeh.antennapod.model.feed.SortOrder;\n-\n-public abstract class IntraFeedSortDialog {\n-\n-    @Nullable\n-    protected SortOrder currentSortOrder;\n-    @NonNull\n-    protected Context context;\n-\n-    private final String[] sortItems;\n-    private final SortOrder[] sortValues;\n-\n-    public IntraFeedSortDialog(@NonNull Context context, @Nullable SortOrder sortOrder, @NonNull boolean isLocalFeed) {\n-        this.context = context;\n-        this.currentSortOrder = sortOrder;\n-\n-        if (isLocalFeed) {\n-            sortItems = context.getResources().getStringArray(R.array.local_feed_episodes_sort_options);\n-            final String[] localSortStringValues =\n-                    context.getResources().getStringArray(R.array.local_feed_episodes_sort_values);\n-            sortValues = SortOrder.valuesOf(localSortStringValues);\n-        } else {\n-            sortItems = context.getResources().getStringArray(R.array.feed_episodes_sort_options);\n-            final String[] commonSortStringValues =\n-                    context.getResources().getStringArray(R.array.feed_episodes_sort_values);\n-            sortValues = SortOrder.valuesOf(commonSortStringValues);\n-        }\n-    }\n-\n-    public void openDialog() {\n-        int idxCurrentSort = getCurrentSortOrderIndex();\n-\n-        MaterialAlertDialogBuilder builder =\n-                new MaterialAlertDialogBuilder(context)\n-                        .setTitle(R.string.sort)\n-                        .setSingleChoiceItems(sortItems, idxCurrentSort, (dialog, idxNewSort) -> {\n-                            updateSort(sortValues[idxNewSort]);\n-                            dialog.dismiss();\n-                        })\n-                        .setNegativeButton(R.string.cancel_label, null);\n-        builder.create().show();\n-    }\n-\n-    /**\n-     * Retrieves index of currentSortOrder index in values array.\n-     * @return if currentSortOrder is found in array - returns index of that element,\n-     *         otherwise returns 0, the default sort option;\n-     */\n-    private int getCurrentSortOrderIndex() {\n-        for (int i = 0; i < sortValues.length; i++) {\n-            if (currentSortOrder == sortValues[i]) {\n-                return i;\n-            }\n-        }\n-        return 0;\n-    }\n-\n-    protected abstract void updateSort(@NonNull SortOrder sortOrder);\n-}\ndiff --git a/app/src/main/java/de/danoeh/antennapod/dialog/ItemSortDialog.java b/app/src/main/java/de/danoeh/antennapod/dialog/ItemSortDialog.java\nnew file mode 100644\nindex 0000000000..3090dd6a56\n--- /dev/null\n+++ b/app/src/main/java/de/danoeh/antennapod/dialog/ItemSortDialog.java\n@@ -0,0 +1,102 @@\n+package de.danoeh.antennapod.dialog;\n+\n+import android.app.Dialog;\n+import android.os.Bundle;\n+import android.view.LayoutInflater;\n+import android.view.View;\n+import android.view.ViewGroup;\n+import android.widget.FrameLayout;\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import com.google.android.material.bottomsheet.BottomSheetBehavior;\n+import com.google.android.material.bottomsheet.BottomSheetDialog;\n+import com.google.android.material.bottomsheet.BottomSheetDialogFragment;\n+import de.danoeh.antennapod.R;\n+import de.danoeh.antennapod.databinding.SortDialogBinding;\n+import de.danoeh.antennapod.databinding.SortDialogItemActiveBinding;\n+import de.danoeh.antennapod.databinding.SortDialogItemBinding;\n+import de.danoeh.antennapod.model.feed.SortOrder;\n+\n+public class ItemSortDialog extends BottomSheetDialogFragment {\n+    protected SortOrder sortOrder;\n+    protected SortDialogBinding viewBinding;\n+\n+    @Nullable\n+    @Override\n+    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container,\n+                             @Nullable Bundle savedInstanceState) {\n+        viewBinding = SortDialogBinding.inflate(inflater);\n+        populateList();\n+        return viewBinding.getRoot();\n+    }\n+\n+    private void populateList() {\n+        viewBinding.gridLayout.removeAllViews();\n+        onAddItem(R.string.episode_title, SortOrder.EPISODE_TITLE_A_Z, SortOrder.EPISODE_TITLE_Z_A, true);\n+        onAddItem(R.string.feed_title, SortOrder.FEED_TITLE_A_Z, SortOrder.FEED_TITLE_Z_A, true);\n+        onAddItem(R.string.duration, SortOrder.DURATION_SHORT_LONG, SortOrder.DURATION_LONG_SHORT, true);\n+        onAddItem(R.string.date, SortOrder.DATE_OLD_NEW, SortOrder.DATE_NEW_OLD, false);\n+        onAddItem(R.string.size, SortOrder.SIZE_SMALL_LARGE, SortOrder.SIZE_LARGE_SMALL, false);\n+        onAddItem(R.string.filename, SortOrder.EPISODE_FILENAME_A_Z, SortOrder.EPISODE_FILENAME_Z_A, true);\n+        onAddItem(R.string.random, SortOrder.RANDOM, SortOrder.RANDOM, true);\n+        onAddItem(R.string.smart_shuffle, SortOrder.SMART_SHUFFLE_OLD_NEW, SortOrder.SMART_SHUFFLE_NEW_OLD, false);\n+    }\n+\n+    protected void onAddItem(int title, SortOrder ascending, SortOrder descending, boolean ascendingIsDefault) {\n+        if (sortOrder == ascending || sortOrder == descending) {\n+            SortDialogItemActiveBinding item = SortDialogItemActiveBinding.inflate(\n+                    getLayoutInflater(), viewBinding.gridLayout, false);\n+            SortOrder other;\n+            if (ascending == descending) {\n+                item.button.setText(title);\n+                other = ascending;\n+            } else if (sortOrder == ascending) {\n+                item.button.setText(getString(title) + \"\\u00A0\u25b2\");\n+                other = descending;\n+            } else {\n+                item.button.setText(getString(title) + \"\\u00A0\u25bc\");\n+                other = ascending;\n+            }\n+            item.button.setOnClickListener(v -> {\n+                sortOrder = other;\n+                populateList();\n+                onSelectionChanged();\n+            });\n+            viewBinding.gridLayout.addView(item.getRoot());\n+        } else {\n+            SortDialogItemBinding item = SortDialogItemBinding.inflate(\n+                    getLayoutInflater(), viewBinding.gridLayout, false);\n+            item.button.setText(title);\n+            item.button.setOnClickListener(v -> {\n+                sortOrder = ascendingIsDefault ? ascending : descending;\n+                populateList();\n+                onSelectionChanged();\n+            });\n+            viewBinding.gridLayout.addView(item.getRoot());\n+        }\n+    }\n+\n+    protected void onSelectionChanged() {\n+    }\n+\n+    @NonNull\n+    @Override\n+    public Dialog onCreateDialog(@Nullable Bundle savedInstanceState) {\n+        Dialog dialog = super.onCreateDialog(savedInstanceState);\n+        dialog.setOnShowListener(dialogInterface -> {\n+            BottomSheetDialog bottomSheetDialog = (BottomSheetDialog) dialogInterface;\n+            setupFullHeight(bottomSheetDialog);\n+        });\n+        return dialog;\n+    }\n+\n+    private void setupFullHeight(BottomSheetDialog bottomSheetDialog) {\n+        FrameLayout bottomSheet = bottomSheetDialog.findViewById(R.id.design_bottom_sheet);\n+        if (bottomSheet != null) {\n+            BottomSheetBehavior<FrameLayout> behavior = BottomSheetBehavior.from(bottomSheet);\n+            ViewGroup.LayoutParams layoutParams = bottomSheet.getLayoutParams();\n+            bottomSheet.setLayoutParams(layoutParams);\n+            behavior.setState(BottomSheetBehavior.STATE_EXPANDED);\n+        }\n+    }\n+}\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/AllEpisodesFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/AllEpisodesFragment.java\nindex 65693965b0..ab5039ec2f 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/AllEpisodesFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/AllEpisodesFragment.java\n@@ -6,15 +6,18 @@\n import android.view.View;\n import android.view.ViewGroup;\n import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.core.storage.DBReader;\n import de.danoeh.antennapod.dialog.AllEpisodesFilterDialog;\n+import de.danoeh.antennapod.dialog.ItemSortDialog;\n+import de.danoeh.antennapod.event.FeedListUpdateEvent;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n import de.danoeh.antennapod.model.feed.SortOrder;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n-\n import org.apache.commons.lang3.StringUtils;\n+import org.greenrobot.eventbus.EventBus;\n import org.greenrobot.eventbus.Subscribe;\n \n import java.util.ArrayList;\n@@ -33,7 +36,6 @@ public class AllEpisodesFragment extends EpisodesListFragment {\n     public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {\n         final View root = super.onCreateView(inflater, container, savedInstanceState);\n         toolbar.inflateMenu(R.menu.episodes);\n-        inflateSortMenu();\n         toolbar.setTitle(R.string.episodes_label);\n         updateToolbar();\n         updateFilterUi();\n@@ -42,18 +44,6 @@ public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container,\n         return root;\n     }\n \n-    private void inflateSortMenu() {\n-        MenuItem sortItem = toolbar.getMenu().findItem(R.id.episodes_sort);\n-        getActivity().getMenuInflater().inflate(R.menu.sort_menu, sortItem.getSubMenu());\n-\n-        // Remove the sorting options that are not needed in this fragment\n-        toolbar.getMenu().findItem(R.id.sort_episode_title).setVisible(false);\n-        toolbar.getMenu().findItem(R.id.sort_feed_title).setVisible(false);\n-        toolbar.getMenu().findItem(R.id.sort_random).setVisible(false);\n-        toolbar.getMenu().findItem(R.id.sort_smart_shuffle).setVisible(false);\n-        toolbar.getMenu().findItem(R.id.keep_sorted).setVisible(false);\n-    }\n-\n     @NonNull\n     @Override\n     protected List<FeedItem> loadData() {\n@@ -105,21 +95,13 @@ public boolean onMenuItemClick(MenuItem item) {\n             }\n             onFilterChanged(new AllEpisodesFilterDialog.AllEpisodesFilterChangedEvent(new HashSet<>(filter)));\n             return true;\n-        } else {\n-            SortOrder sortOrder = MenuItemToSortOrderConverter.convert(item);\n-            if (sortOrder != null) {\n-                saveSortOrderAndRefresh(sortOrder);\n-                return true;\n-            }\n+        } else if (item.getItemId() == R.id.episodes_sort) {\n+            new AllEpisodesSortDialog().show(getChildFragmentManager().beginTransaction(), \"SortDialog\");\n+            return true;\n         }\n         return false;\n     }\n \n-    private void saveSortOrderAndRefresh(SortOrder type) {\n-        UserPreferences.setAllEpisodesSortOrder(type);\n-        loadItems();\n-    }\n-\n     @Subscribe\n     public void onFilterChanged(AllEpisodesFilterDialog.AllEpisodesFilterChangedEvent event) {\n         UserPreferences.setPrefFilterAllEpisodes(StringUtils.join(event.filterValues, \",\"));\n@@ -140,4 +122,26 @@ private void updateFilterUi() {\n         toolbar.getMenu().findItem(R.id.action_favorites).setIcon(\n                 getFilter().showIsFavorite ? R.drawable.ic_star : R.drawable.ic_star_border);\n     }\n+\n+    public static class AllEpisodesSortDialog extends ItemSortDialog {\n+        @Override\n+        public void onCreate(@Nullable Bundle savedInstanceState) {\n+            super.onCreate(savedInstanceState);\n+            sortOrder = UserPreferences.getAllEpisodesSortOrder();\n+        }\n+\n+        @Override\n+        protected void onAddItem(int title, SortOrder ascending, SortOrder descending, boolean ascendingIsDefault) {\n+            if (ascending == SortOrder.DATE_OLD_NEW || ascending == SortOrder.DURATION_SHORT_LONG) {\n+                super.onAddItem(title, ascending, descending, ascendingIsDefault);\n+            }\n+        }\n+\n+        @Override\n+        protected void onSelectionChanged() {\n+            super.onSelectionChanged();\n+            UserPreferences.setAllEpisodesSortOrder(sortOrder);\n+            EventBus.getDefault().post(new FeedListUpdateEvent(0));\n+        }\n+    }\n }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/CompletedDownloadsFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/CompletedDownloadsFragment.java\nindex 730a391898..ec7a35466b 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/CompletedDownloadsFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/CompletedDownloadsFragment.java\n@@ -4,16 +4,14 @@\n import android.util.Log;\n import android.view.ContextMenu;\n import android.view.LayoutInflater;\n-import android.view.Menu;\n-import android.view.MenuInflater;\n import android.view.MenuItem;\n import android.view.View;\n import android.view.ViewGroup;\n import android.widget.ProgressBar;\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n-import com.google.android.material.appbar.MaterialToolbar;\n import androidx.fragment.app.Fragment;\n+import com.google.android.material.appbar.MaterialToolbar;\n import com.google.android.material.snackbar.Snackbar;\n import com.leinardi.android.speeddial.SpeedDialView;\n import de.danoeh.antennapod.R;\n@@ -25,6 +23,7 @@\n import de.danoeh.antennapod.core.storage.DBReader;\n import de.danoeh.antennapod.core.util.FeedItemUtil;\n import de.danoeh.antennapod.core.util.download.FeedUpdateManager;\n+import de.danoeh.antennapod.dialog.ItemSortDialog;\n import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FeedItemEvent;\n import de.danoeh.antennapod.event.PlayerStatusEvent;\n@@ -84,8 +83,6 @@ public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup c\n         toolbar = root.findViewById(R.id.toolbar);\n         toolbar.setTitle(R.string.downloads_label);\n         toolbar.inflateMenu(R.menu.downloads_completed);\n-        inflateSortMenu(toolbar);\n-\n         toolbar.setOnMenuItemClickListener(this);\n         toolbar.setOnLongClickListener(v -> {\n             recyclerView.scrollToPosition(5);\n@@ -148,20 +145,6 @@ public void onToggleChanged(boolean open) {\n         return root;\n     }\n \n-    private void inflateSortMenu(MaterialToolbar toolbar) {\n-        Menu menu = toolbar.getMenu();\n-        MenuItem downloadsItem = menu.findItem(R.id.downloads_sort);\n-        MenuInflater menuInflater = getActivity().getMenuInflater();\n-        menuInflater.inflate(R.menu.sort_menu, downloadsItem.getSubMenu());\n-\n-        // Remove the sorting options that are not needed in this fragment\n-        menu.findItem(R.id.sort_feed_title).setVisible(false);\n-        menu.findItem(R.id.sort_random).setVisible(false);\n-        menu.findItem(R.id.sort_smart_shuffle).setVisible(false);\n-        menu.findItem(R.id.keep_sorted).setVisible(false);\n-        menu.findItem(R.id.sort_size).setVisible(true);\n-    }\n-\n     @Override\n     public void onSaveInstanceState(@NonNull Bundle outState) {\n         outState.putBoolean(KEY_UP_ARROW, displayUpArrow);\n@@ -204,21 +187,13 @@ public boolean onMenuItemClick(MenuItem item) {\n         } else if (item.getItemId() == R.id.action_search) {\n             ((MainActivity) getActivity()).loadChildFragment(SearchFragment.newInstance());\n             return true;\n-        }  else {\n-            SortOrder sortOrder = MenuItemToSortOrderConverter.convert(item);\n-            if (sortOrder != null) {\n-                setSortOrder(sortOrder);\n-                return true;\n-            }\n+        } else if (item.getItemId() == R.id.downloads_sort) {\n+            new DownloadsSortDialog().show(getChildFragmentManager(), \"SortDialog\");\n+            return true;\n         }\n         return false;\n     }\n \n-    private void setSortOrder(SortOrder sortOrder) {\n-        UserPreferences.setDownloadsSortedOrder(sortOrder);\n-        loadItems();\n-    }\n-\n     @Subscribe(sticky = true, threadMode = ThreadMode.MAIN)\n     public void onEventMainThread(EpisodeDownloadEvent event) {\n         Set<String> newRunningDownloads = new HashSet<>();\n@@ -391,4 +366,27 @@ public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMen\n             MenuItemUtils.setOnClickListeners(menu, CompletedDownloadsFragment.this::onContextItemSelected);\n         }\n     }\n+\n+    public static class DownloadsSortDialog extends ItemSortDialog {\n+        @Override\n+        public void onCreate(@Nullable Bundle savedInstanceState) {\n+            super.onCreate(savedInstanceState);\n+            sortOrder = UserPreferences.getDownloadsSortedOrder();\n+        }\n+\n+        @Override\n+        protected void onAddItem(int title, SortOrder ascending, SortOrder descending, boolean ascendingIsDefault) {\n+            if (ascending == SortOrder.DATE_OLD_NEW || ascending == SortOrder.DURATION_SHORT_LONG\n+                    || ascending == SortOrder.EPISODE_TITLE_A_Z || ascending == SortOrder.SIZE_SMALL_LARGE) {\n+                super.onAddItem(title, ascending, descending, ascendingIsDefault);\n+            }\n+        }\n+\n+        @Override\n+        protected void onSelectionChanged() {\n+            super.onSelectionChanged();\n+            UserPreferences.setDownloadsSortedOrder(sortOrder);\n+            EventBus.getDefault().post(DownloadLogEvent.listUpdated());\n+        }\n+    }\n }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/FeedInfoFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/FeedInfoFragment.java\nindex bbb48b9d2c..f62bdaf848 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/FeedInfoFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/FeedInfoFragment.java\n@@ -22,24 +22,24 @@\n import androidx.activity.result.contract.ActivityResultContracts;\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n-import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import androidx.appcompat.content.res.AppCompatResources;\n-import com.google.android.material.appbar.MaterialToolbar;\n import androidx.documentfile.provider.DocumentFile;\n import androidx.fragment.app.Fragment;\n import com.bumptech.glide.Glide;\n import com.bumptech.glide.request.RequestOptions;\n import com.google.android.material.appbar.AppBarLayout;\n import com.google.android.material.appbar.CollapsingToolbarLayout;\n+import com.google.android.material.appbar.MaterialToolbar;\n+import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import com.google.android.material.snackbar.Snackbar;\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n import de.danoeh.antennapod.core.storage.DBReader;\n import de.danoeh.antennapod.core.storage.DBTasks;\n import de.danoeh.antennapod.core.util.IntentUtils;\n+import de.danoeh.antennapod.core.util.ShareUtils;\n import de.danoeh.antennapod.core.util.syndication.HtmlToPlainText;\n import de.danoeh.antennapod.dialog.EditUrlSettingsDialog;\n-import de.danoeh.antennapod.menuhandler.FeedMenuHandler;\n import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.model.feed.FeedFunding;\n import de.danoeh.antennapod.ui.glide.FastBlurTransformation;\n@@ -289,9 +289,11 @@ public boolean onMenuItemClick(MenuItem item) {\n                     R.string.please_wait_for_data, Toast.LENGTH_LONG);\n             return false;\n         }\n-        boolean handled = FeedMenuHandler.onOptionsItemClicked(getContext(), item, feed);\n-\n-        if (item.getItemId() == R.id.reconnect_local_folder) {\n+        if (item.getItemId() == R.id.visit_website_item) {\n+            IntentUtils.openInBrowser(getContext(), feed.getLink());\n+        } else if (item.getItemId() == R.id.share_item) {\n+            ShareUtils.shareFeedLink(getContext(), feed);\n+        } else if (item.getItemId() == R.id.reconnect_local_folder) {\n             MaterialAlertDialogBuilder alert = new MaterialAlertDialogBuilder(getContext());\n             alert.setMessage(R.string.reconnect_local_folder_warning);\n             alert.setPositiveButton(android.R.string.ok, (dialog, which) -> {\n@@ -303,10 +305,7 @@ public boolean onMenuItemClick(MenuItem item) {\n             });\n             alert.setNegativeButton(android.R.string.cancel, null);\n             alert.show();\n-            return true;\n-        }\n-\n-        if (item.getItemId() == R.id.edit_feed_url_item) {\n+        } else if (item.getItemId() == R.id.edit_feed_url_item) {\n             new EditUrlSettingsDialog(getActivity(), feed) {\n                 @Override\n                 protected void setUrl(String url) {\n@@ -315,11 +314,10 @@ protected void setUrl(String url) {\n                     txtvUrl.setCompoundDrawablesRelativeWithIntrinsicBounds(0, 0, R.drawable.ic_paperclip, 0);\n                 }\n             }.show();\n-\n-            return true;\n+        } else {\n+            return false;\n         }\n-\n-        return handled;\n+        return true;\n     }\n \n     private void addLocalFolderResult(final Uri uri) {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/FeedItemlistFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/FeedItemlistFragment.java\nindex 1c949218ab..4853c3daea 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/FeedItemlistFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/FeedItemlistFragment.java\n@@ -18,11 +18,11 @@\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n import androidx.appcompat.content.res.AppCompatResources;\n-import com.google.android.material.appbar.MaterialToolbar;\n import androidx.fragment.app.Fragment;\n import androidx.recyclerview.widget.RecyclerView;\n import com.bumptech.glide.Glide;\n import com.bumptech.glide.request.RequestOptions;\n+import com.google.android.material.appbar.MaterialToolbar;\n import com.google.android.material.snackbar.Snackbar;\n import com.joanzapata.iconify.Iconify;\n import com.leinardi.android.speeddial.SpeedDialView;\n@@ -32,14 +32,18 @@\n import de.danoeh.antennapod.core.feed.FeedEvent;\n import de.danoeh.antennapod.core.menuhandler.MenuItemUtils;\n import de.danoeh.antennapod.core.storage.DBReader;\n+import de.danoeh.antennapod.core.storage.DBWriter;\n import de.danoeh.antennapod.core.util.FeedItemPermutors;\n import de.danoeh.antennapod.core.util.FeedItemUtil;\n+import de.danoeh.antennapod.core.util.IntentUtils;\n+import de.danoeh.antennapod.core.util.ShareUtils;\n import de.danoeh.antennapod.core.util.download.FeedUpdateManager;\n import de.danoeh.antennapod.core.util.gui.MoreContentListFooterUtil;\n import de.danoeh.antennapod.databinding.FeedItemListFragmentBinding;\n import de.danoeh.antennapod.databinding.MultiSelectSpeedDialBinding;\n import de.danoeh.antennapod.dialog.DownloadLogDetailsDialog;\n import de.danoeh.antennapod.dialog.FeedItemFilterDialog;\n+import de.danoeh.antennapod.dialog.ItemSortDialog;\n import de.danoeh.antennapod.dialog.RemoveFeedDialog;\n import de.danoeh.antennapod.dialog.RenameItemDialog;\n import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n@@ -54,11 +58,11 @@\n import de.danoeh.antennapod.fragment.actions.EpisodeMultiSelectActionHandler;\n import de.danoeh.antennapod.fragment.swipeactions.SwipeActions;\n import de.danoeh.antennapod.menuhandler.FeedItemMenuHandler;\n-import de.danoeh.antennapod.menuhandler.FeedMenuHandler;\n import de.danoeh.antennapod.model.download.DownloadResult;\n import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n+import de.danoeh.antennapod.model.feed.SortOrder;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import de.danoeh.antennapod.ui.glide.FastBlurTransformation;\n import de.danoeh.antennapod.view.ToolbarIconTintManager;\n@@ -68,6 +72,7 @@\n import io.reactivex.android.schedulers.AndroidSchedulers;\n import io.reactivex.disposables.Disposable;\n import io.reactivex.schedulers.Schedulers;\n+import org.apache.commons.lang3.StringUtils;\n import org.apache.commons.lang3.Validate;\n import org.greenrobot.eventbus.EventBus;\n import org.greenrobot.eventbus.Subscribe;\n@@ -75,6 +80,7 @@\n \n import java.util.Collections;\n import java.util.List;\n+import java.util.concurrent.ExecutionException;\n \n /**\n  * Displays a list of FeedItems.\n@@ -240,8 +246,13 @@ private void updateToolbar() {\n             return;\n         }\n         viewBinding.toolbar.getMenu().findItem(R.id.visit_website_item).setVisible(feed.getLink() != null);\n-\n-        FeedMenuHandler.onPrepareOptionsMenu(viewBinding.toolbar.getMenu(), feed);\n+        viewBinding.toolbar.getMenu().findItem(R.id.refresh_complete_item).setVisible(feed.isPaged());\n+        if (StringUtils.isBlank(feed.getLink())) {\n+            viewBinding.toolbar.getMenu().findItem(R.id.visit_website_item).setVisible(false);\n+        }\n+        if (feed.isLocalFeed()) {\n+            viewBinding.toolbar.getMenu().findItem(R.id.share_item).setVisible(false);\n+        }\n     }\n \n     @Override\n@@ -260,26 +271,39 @@ public boolean onMenuItemClick(MenuItem item) {\n                     R.string.please_wait_for_data, Toast.LENGTH_LONG);\n             return true;\n         }\n-        boolean feedMenuHandled = FeedMenuHandler.onOptionsItemClicked(getActivity(), item, feed);\n-        if (feedMenuHandled) {\n-            return true;\n-        }\n-        final int itemId = item.getItemId();\n-        if (itemId == R.id.rename_item) {\n+        if (item.getItemId() == R.id.visit_website_item) {\n+            IntentUtils.openInBrowser(getContext(), feed.getLink());\n+        } else if (item.getItemId() == R.id.share_item) {\n+            ShareUtils.shareFeedLink(getContext(), feed);\n+        } else if (item.getItemId() == R.id.refresh_item) {\n+            FeedUpdateManager.runOnceOrAsk(getContext(), feed);\n+        } else if (item.getItemId() == R.id.refresh_complete_item) {\n+            new Thread(() -> {\n+                feed.setNextPageLink(feed.getDownload_url());\n+                feed.setPageNr(0);\n+                try {\n+                    DBWriter.resetPagedFeedPage(feed).get();\n+                    FeedUpdateManager.runOnce(getContext(), feed);\n+                } catch (ExecutionException | InterruptedException e) {\n+                    throw new RuntimeException(e);\n+                }\n+            }).start();\n+        } else if (item.getItemId() == R.id.sort_items) {\n+            SingleFeedSortDialog.newInstance(feed).show(getChildFragmentManager(), \"SortDialog\");\n+        } else if (item.getItemId() == R.id.rename_item) {\n             new RenameItemDialog(getActivity(), feed).show();\n-            return true;\n-        } else if (itemId == R.id.remove_feed) {\n+        } else if (item.getItemId() == R.id.remove_feed) {\n             RemoveFeedDialog.show(getContext(), feed, () -> {\n                 ((MainActivity) getActivity()).loadFragment(UserPreferences.getDefaultPage(), null);\n                 // Make sure fragment is hidden before actually starting to delete\n                 getActivity().getSupportFragmentManager().executePendingTransactions();\n             });\n-            return true;\n-        } else if (itemId == R.id.action_search) {\n+        } else if (item.getItemId() == R.id.action_search) {\n             ((MainActivity) getActivity()).loadChildFragment(SearchFragment.newInstance(feed.getId(), feed.getTitle()));\n-            return true;\n+        } else {\n+            return false;\n         }\n-        return false;\n+        return true;\n     }\n \n     @Override\n@@ -592,4 +616,45 @@ public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMen\n             MenuItemUtils.setOnClickListeners(menu, FeedItemlistFragment.this::onContextItemSelected);\n         }\n     }\n+\n+    public static class SingleFeedSortDialog extends ItemSortDialog {\n+        private static final String ARG_FEED_ID = \"feedId\";\n+        private static final String ARG_FEED_IS_LOCAL = \"isLocal\";\n+        private static final String ARG_SORT_ORDER = \"sortOrder\";\n+\n+        private static SingleFeedSortDialog newInstance(Feed feed) {\n+            Bundle bundle = new Bundle();\n+            bundle.putLong(ARG_FEED_ID, feed.getId());\n+            bundle.putBoolean(ARG_FEED_IS_LOCAL, feed.isLocalFeed());\n+            if (feed.getSortOrder() == null) {\n+                bundle.putString(ARG_SORT_ORDER, String.valueOf(SortOrder.DATE_NEW_OLD.code));\n+            } else {\n+                bundle.putString(ARG_SORT_ORDER, String.valueOf(feed.getSortOrder().code));\n+            }\n+            SingleFeedSortDialog dialog = new SingleFeedSortDialog();\n+            dialog.setArguments(bundle);\n+            return dialog;\n+        }\n+\n+        @Override\n+        public void onCreate(@Nullable Bundle savedInstanceState) {\n+            super.onCreate(savedInstanceState);\n+            sortOrder = SortOrder.fromCodeString(getArguments().getString(ARG_SORT_ORDER));\n+        }\n+\n+        @Override\n+        protected void onAddItem(int title, SortOrder ascending, SortOrder descending, boolean ascendingIsDefault) {\n+            if (ascending == SortOrder.DATE_OLD_NEW || ascending == SortOrder.DURATION_SHORT_LONG\n+                    || ascending == SortOrder.EPISODE_TITLE_A_Z\n+                    || (getArguments().getBoolean(ARG_FEED_IS_LOCAL) && ascending == SortOrder.EPISODE_FILENAME_A_Z)) {\n+                super.onAddItem(title, ascending, descending, ascendingIsDefault);\n+            }\n+        }\n+\n+        @Override\n+        protected void onSelectionChanged() {\n+            super.onSelectionChanged();\n+            DBWriter.setFeedItemSortOrder(getArguments().getLong(ARG_FEED_ID), sortOrder);\n+        }\n+    }\n }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/InboxFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/InboxFragment.java\nindex f8bcbb5322..497409e701 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/InboxFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/InboxFragment.java\n@@ -4,26 +4,25 @@\n import android.content.SharedPreferences;\n import android.os.Bundle;\n import android.view.LayoutInflater;\n-import android.view.Menu;\n-import android.view.MenuInflater;\n import android.view.MenuItem;\n import android.view.View;\n import android.view.ViewGroup;\n import android.widget.CheckBox;\n import android.widget.Toast;\n-\n import androidx.annotation.NonNull;\n-\n+import androidx.annotation.Nullable;\n import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n-\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n import de.danoeh.antennapod.core.storage.DBReader;\n import de.danoeh.antennapod.core.storage.DBWriter;\n+import de.danoeh.antennapod.dialog.ItemSortDialog;\n+import de.danoeh.antennapod.event.FeedListUpdateEvent;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n import de.danoeh.antennapod.model.feed.SortOrder;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n+import org.greenrobot.eventbus.EventBus;\n \n import java.util.List;\n \n@@ -42,8 +41,6 @@ public class InboxFragment extends EpisodesListFragment {\n     public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {\n         final View root = super.onCreateView(inflater, container, savedInstanceState);\n         toolbar.inflateMenu(R.menu.inbox);\n-        inflateSortMenu();\n-\n         toolbar.setTitle(R.string.inbox_label);\n         prefs = getActivity().getSharedPreferences(PREF_NAME, Context.MODE_PRIVATE);\n         updateToolbar();\n@@ -83,13 +80,9 @@ public boolean onMenuItemClick(MenuItem item) {\n                 showRemoveAllDialog();\n             }\n             return true;\n-        } else {\n-            SortOrder sortOrder = MenuItemToSortOrderConverter.convert(item);\n-            if (sortOrder != null) {\n-                UserPreferences.setInboxSortedOrder(sortOrder);\n-                loadItems();\n-                return true;\n-            }\n+        } else if (item.getItemId() == R.id.inbox_sort) {\n+            new InboxSortDialog().show(getChildFragmentManager(), \"SortDialog\");\n+            return true;\n         }\n         return false;\n     }\n@@ -118,20 +111,6 @@ private void removeAllFromInbox() {\n         ((MainActivity) getActivity()).showSnackbarAbovePlayer(R.string.removed_all_inbox_msg, Toast.LENGTH_SHORT);\n     }\n \n-    private void inflateSortMenu() {\n-        Menu menu = toolbar.getMenu();\n-        MenuItem downloadsItem = menu.findItem(R.id.inbox_sort);\n-        MenuInflater menuInflater = getActivity().getMenuInflater();\n-        menuInflater.inflate(R.menu.sort_menu, downloadsItem.getSubMenu());\n-\n-        // Remove the sorting options that are not needed in this fragment\n-        toolbar.getMenu().findItem(R.id.sort_episode_title).setVisible(false);\n-        toolbar.getMenu().findItem(R.id.sort_feed_title).setVisible(false);\n-        toolbar.getMenu().findItem(R.id.sort_random).setVisible(false);\n-        toolbar.getMenu().findItem(R.id.sort_smart_shuffle).setVisible(false);\n-        toolbar.getMenu().findItem(R.id.keep_sorted).setVisible(false);\n-    }\n-\n     private void showRemoveAllDialog() {\n         MaterialAlertDialogBuilder builder = new MaterialAlertDialogBuilder(getContext());\n         builder.setTitle(R.string.remove_all_inbox_label);\n@@ -149,4 +128,26 @@ private void showRemoveAllDialog() {\n         builder.setNegativeButton(R.string.cancel_label, null);\n         builder.show();\n     }\n+\n+    public static class InboxSortDialog extends ItemSortDialog {\n+        @Override\n+        public void onCreate(@Nullable Bundle savedInstanceState) {\n+            super.onCreate(savedInstanceState);\n+            sortOrder = UserPreferences.getInboxSortedOrder();\n+        }\n+\n+        @Override\n+        protected void onAddItem(int title, SortOrder ascending, SortOrder descending, boolean ascendingIsDefault) {\n+            if (ascending == SortOrder.DATE_OLD_NEW || ascending == SortOrder.DURATION_SHORT_LONG) {\n+                super.onAddItem(title, ascending, descending, ascendingIsDefault);\n+            }\n+        }\n+\n+        @Override\n+        protected void onSelectionChanged() {\n+            super.onSelectionChanged();\n+            UserPreferences.setInboxSortedOrder(sortOrder);\n+            EventBus.getDefault().post(new FeedListUpdateEvent(0));\n+        }\n+    }\n }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/MenuItemToSortOrderConverter.java b/app/src/main/java/de/danoeh/antennapod/fragment/MenuItemToSortOrderConverter.java\ndeleted file mode 100644\nindex d4150fbdb5..0000000000\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/MenuItemToSortOrderConverter.java\n+++ /dev/null\n@@ -1,44 +0,0 @@\n-package de.danoeh.antennapod.fragment;\n-\n-import android.view.MenuItem;\n-\n-import de.danoeh.antennapod.R;\n-import de.danoeh.antennapod.model.feed.SortOrder;\n-\n-public class MenuItemToSortOrderConverter {\n-\n-    public static SortOrder convert(MenuItem item) {\n-        final int itemId = item.getItemId();\n-\n-        if (itemId == R.id.sort_episode_title_asc) {\n-            return SortOrder.EPISODE_TITLE_A_Z;\n-        } else if (itemId == R.id.sort_episode_title_desc) {\n-            return SortOrder.EPISODE_TITLE_Z_A;\n-        } else if (itemId == R.id.sort_date_asc) {\n-            return SortOrder.DATE_OLD_NEW;\n-        } else if (itemId == R.id.sort_date_desc) {\n-            return SortOrder.DATE_NEW_OLD;\n-        } else if (itemId == R.id.sort_duration_asc) {\n-            return SortOrder.DURATION_SHORT_LONG;\n-        } else if (itemId == R.id.sort_duration_desc) {\n-            return SortOrder.DURATION_LONG_SHORT;\n-        } else if (itemId == R.id.sort_feed_title_asc) {\n-            return SortOrder.FEED_TITLE_A_Z;\n-        } else if (itemId == R.id.sort_feed_title_desc) {\n-            return SortOrder.FEED_TITLE_Z_A;\n-        } else if (itemId == R.id.sort_random) {\n-            return SortOrder.RANDOM;\n-        } else if (itemId == R.id.sort_smart_shuffle_asc) {\n-            return SortOrder.SMART_SHUFFLE_OLD_NEW;\n-        } else if (itemId == R.id.sort_smart_shuffle_desc) {\n-            return SortOrder.SMART_SHUFFLE_NEW_OLD;\n-        } else if (itemId == R.id.sort_size_small_large) {\n-            return SortOrder.SIZE_SMALL_LARGE;\n-        } else if (itemId == R.id.sort_size_large_small) {\n-            return SortOrder.SIZE_LARGE_SMALL;\n-        }\n-\n-        return null;\n-    }\n-\n-}\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/QueueFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/QueueFragment.java\nindex a1aa7226d8..dbaeb836c8 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/QueueFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/QueueFragment.java\n@@ -10,7 +10,6 @@\n import android.view.ContextMenu;\n import android.view.KeyEvent;\n import android.view.LayoutInflater;\n-import android.view.MenuInflater;\n import android.view.MenuItem;\n import android.view.View;\n import android.view.ViewGroup;\n@@ -18,6 +17,7 @@\n import android.widget.ProgressBar;\n import android.widget.TextView;\n import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n import androidx.fragment.app.Fragment;\n import androidx.recyclerview.widget.ItemTouchHelper;\n import androidx.recyclerview.widget.RecyclerView;\n@@ -39,6 +39,7 @@\n import de.danoeh.antennapod.core.util.Converter;\n import de.danoeh.antennapod.core.util.FeedItemUtil;\n import de.danoeh.antennapod.core.util.download.FeedUpdateManager;\n+import de.danoeh.antennapod.dialog.ItemSortDialog;\n import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FeedItemEvent;\n import de.danoeh.antennapod.event.FeedUpdateRunningEvent;\n@@ -159,6 +160,8 @@ public void onEventMainThread(QueueEvent event) {\n             case MOVED:\n                 return;\n         }\n+        recyclerAdapter.updateDragDropEnabled();\n+        refreshToolbarState();\n         recyclerView.saveScrollPosition(QueueFragment.TAG);\n         refreshInfoBar();\n     }\n@@ -258,8 +261,6 @@ private void refreshToolbarState() {\n         boolean keepSorted = UserPreferences.isQueueKeepSorted();\n         toolbar.getMenu().findItem(R.id.queue_lock).setChecked(UserPreferences.isQueueLocked());\n         toolbar.getMenu().findItem(R.id.queue_lock).setVisible(!keepSorted);\n-        toolbar.getMenu().findItem(R.id.sort_random).setVisible(!keepSorted);\n-        toolbar.getMenu().findItem(R.id.keep_sorted).setChecked(keepSorted);\n     }\n \n     @Subscribe(sticky = true, threadMode = ThreadMode.MAIN)\n@@ -273,6 +274,9 @@ public boolean onMenuItemClick(MenuItem item) {\n         if (itemId == R.id.queue_lock) {\n             toggleQueueLock();\n             return true;\n+        } else if (itemId == R.id.queue_sort) {\n+            new QueueSortDialog().show(getChildFragmentManager().beginTransaction(), \"SortDialog\");\n+            return true;\n         } else if (itemId == R.id.refresh_item) {\n             FeedUpdateManager.runOnceOrAsk(requireContext());\n             return true;\n@@ -291,28 +295,9 @@ public void onConfirmButtonPressed(\n             };\n             conDialog.createNewDialog().show();\n             return true;\n-        } else if (itemId == R.id.keep_sorted) {\n-            boolean keepSortedOld = UserPreferences.isQueueKeepSorted();\n-            boolean keepSortedNew = !keepSortedOld;\n-            UserPreferences.setQueueKeepSorted(keepSortedNew);\n-            if (keepSortedNew) {\n-                SortOrder sortOrder = UserPreferences.getQueueKeepSortedOrder();\n-                DBWriter.reorderQueue(sortOrder, true);\n-            }\n-            if (recyclerAdapter != null) {\n-                recyclerAdapter.updateDragDropEnabled();\n-            }\n-            refreshToolbarState();\n-            return true;\n         } else if (itemId == R.id.action_search) {\n             ((MainActivity) getActivity()).loadChildFragment(SearchFragment.newInstance());\n             return true;\n-        }  else {\n-            SortOrder sortOrder = MenuItemToSortOrderConverter.convert(item);\n-            if (sortOrder != null) {\n-                setSortOrder(sortOrder);\n-                return true;\n-            }\n         }\n         return false;\n     }\n@@ -359,16 +344,6 @@ private void setQueueLocked(boolean locked) {\n         }\n     }\n \n-    /**\n-     * This method is called if the user clicks on a sort order menu item.\n-     *\n-     * @param sortOrder New sort order.\n-     */\n-    private void setSortOrder(SortOrder sortOrder) {\n-        UserPreferences.setQueueKeepSortedOrder(sortOrder);\n-        DBWriter.reorderQueue(sortOrder, true);\n-    }\n-\n     @Override\n     public boolean onContextItemSelected(MenuItem item) {\n         Log.d(TAG, \"onContextItemSelected() called with: \" + \"item = [\" + item + \"]\");\n@@ -422,10 +397,6 @@ public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle sa\n         }\n         ((MainActivity) getActivity()).setupToolbarToggle(toolbar, displayUpArrow);\n         toolbar.inflateMenu(R.menu.queue);\n-\n-        MenuItem queueItem = toolbar.getMenu().findItem(R.id.queue_sort);\n-        MenuInflater menuInflater = getActivity().getMenuInflater();\n-        menuInflater.inflate(R.menu.sort_menu, queueItem.getSubMenu());\n         refreshToolbarState();\n         progressBar = root.findViewById(R.id.progressBar);\n         progressBar.setVisibility(View.VISIBLE);\n@@ -567,6 +538,40 @@ public void onEndSelectMode() {\n         swipeActions.attachTo(recyclerView);\n     }\n \n+    public static class QueueSortDialog extends ItemSortDialog {\n+        @Nullable\n+        @Override\n+        public View onCreateView(@NonNull LayoutInflater inflater,\n+                                 @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {\n+            if (UserPreferences.isQueueKeepSorted()) {\n+                sortOrder = UserPreferences.getQueueKeepSortedOrder();\n+            }\n+            View view = super.onCreateView(inflater, container, savedInstanceState);\n+            viewBinding.keepSortedCheckbox.setVisibility(View.VISIBLE);\n+            viewBinding.keepSortedCheckbox.setChecked(UserPreferences.isQueueKeepSorted());\n+            return view;\n+        }\n+\n+        @Override\n+        protected void onAddItem(int title, SortOrder ascending, SortOrder descending, boolean ascendingIsDefault) {\n+            if (ascending != SortOrder.EPISODE_FILENAME_A_Z && ascending != SortOrder.SIZE_SMALL_LARGE) {\n+                super.onAddItem(title, ascending, descending, ascendingIsDefault);\n+            }\n+        }\n+\n+        @Override\n+        protected void onSelectionChanged() {\n+            super.onSelectionChanged();\n+            viewBinding.keepSortedCheckbox.setEnabled(sortOrder != SortOrder.RANDOM);\n+            if (sortOrder == SortOrder.RANDOM) {\n+                viewBinding.keepSortedCheckbox.setChecked(false);\n+            }\n+            UserPreferences.setQueueKeepSorted(viewBinding.keepSortedCheckbox.isChecked());\n+            UserPreferences.setQueueKeepSortedOrder(sortOrder);\n+            DBWriter.reorderQueue(sortOrder, true);\n+        }\n+    }\n+\n     private class QueueSwipeActions extends SwipeActions {\n \n         // Position tracking whilst dragging\ndiff --git a/app/src/main/java/de/danoeh/antennapod/menuhandler/FeedMenuHandler.java b/app/src/main/java/de/danoeh/antennapod/menuhandler/FeedMenuHandler.java\nindex 7a9eb1bb59..eac1e93040 100644\n--- a/app/src/main/java/de/danoeh/antennapod/menuhandler/FeedMenuHandler.java\n+++ b/app/src/main/java/de/danoeh/antennapod/menuhandler/FeedMenuHandler.java\n@@ -1,103 +1,32 @@\n package de.danoeh.antennapod.menuhandler;\n \n+import android.annotation.SuppressLint;\n import android.content.Context;\n+import android.content.DialogInterface;\n import android.util.Log;\n-import android.view.Menu;\n-import android.view.MenuItem;\n import androidx.annotation.NonNull;\n-import de.danoeh.antennapod.R;\n-import de.danoeh.antennapod.core.storage.DBWriter;\n-import de.danoeh.antennapod.core.util.IntentUtils;\n-import de.danoeh.antennapod.core.util.ShareUtils;\n-import de.danoeh.antennapod.core.util.download.FeedUpdateManager;\n-import de.danoeh.antennapod.dialog.IntraFeedSortDialog;\n-import de.danoeh.antennapod.model.feed.Feed;\n-import de.danoeh.antennapod.model.feed.SortOrder;\n-import org.apache.commons.lang3.StringUtils;\n-import android.content.DialogInterface;\n-import android.annotation.SuppressLint;\n import androidx.fragment.app.Fragment;\n+import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.core.dialog.ConfirmationDialog;\n+import de.danoeh.antennapod.core.storage.DBWriter;\n import de.danoeh.antennapod.dialog.RemoveFeedDialog;\n import de.danoeh.antennapod.dialog.RenameItemDialog;\n import de.danoeh.antennapod.dialog.TagSettingsDialog;\n+import de.danoeh.antennapod.model.feed.Feed;\n import io.reactivex.Observable;\n import io.reactivex.android.schedulers.AndroidSchedulers;\n import io.reactivex.schedulers.Schedulers;\n+\n import java.util.Collections;\n import java.util.concurrent.Callable;\n-import java.util.concurrent.ExecutionException;\n import java.util.concurrent.Future;\n \n /**\n  * Handles interactions with the FeedItemMenu.\n  */\n-public class FeedMenuHandler {\n-\n-    private FeedMenuHandler(){ }\n-\n+public abstract class FeedMenuHandler {\n     private static final String TAG = \"FeedMenuHandler\";\n \n-    public static boolean onPrepareOptionsMenu(Menu menu, Feed selectedFeed) {\n-        if (selectedFeed == null) {\n-            return true;\n-        }\n-\n-        Log.d(TAG, \"Preparing options menu\");\n-\n-        menu.findItem(R.id.refresh_complete_item).setVisible(selectedFeed.isPaged());\n-        if (StringUtils.isBlank(selectedFeed.getLink())) {\n-            menu.findItem(R.id.visit_website_item).setVisible(false);\n-        }\n-        if (selectedFeed.isLocalFeed()) {\n-            // hide complete submenu \"Share...\" as both sub menu items are not visible\n-            menu.findItem(R.id.share_item).setVisible(false);\n-        }\n-\n-        return true;\n-    }\n-\n-    /**\n-     * NOTE: This method does not handle clicks on the 'remove feed' - item.\n-     */\n-    public static boolean onOptionsItemClicked(final Context context, final MenuItem item, final Feed selectedFeed) {\n-        final int itemId = item.getItemId();\n-        if (itemId == R.id.refresh_item) {\n-            FeedUpdateManager.runOnceOrAsk(context, selectedFeed);\n-        } else if (itemId == R.id.refresh_complete_item) {\n-            new Thread(() -> {\n-                selectedFeed.setNextPageLink(selectedFeed.getDownload_url());\n-                selectedFeed.setPageNr(0);\n-                try {\n-                    DBWriter.resetPagedFeedPage(selectedFeed).get();\n-                    FeedUpdateManager.runOnce(context, selectedFeed);\n-                } catch (ExecutionException | InterruptedException e) {\n-                    throw new RuntimeException(e);\n-                }\n-            }).start();\n-        } else if (itemId == R.id.sort_items) {\n-            showSortDialog(context, selectedFeed);\n-        } else if (itemId == R.id.visit_website_item) {\n-            IntentUtils.openInBrowser(context, selectedFeed.getLink());\n-        } else if (itemId == R.id.share_item) {\n-            ShareUtils.shareFeedLink(context, selectedFeed);\n-        } else {\n-            return false;\n-        }\n-        return true;\n-    }\n-\n-    private static void showSortDialog(Context context, Feed selectedFeed) {\n-        IntraFeedSortDialog sortDialog = new IntraFeedSortDialog(context, selectedFeed.getSortOrder(), selectedFeed.isLocalFeed()) {\n-            @Override\n-            protected void updateSort(@NonNull SortOrder sortOrder) {\n-                selectedFeed.setSortOrder(sortOrder);\n-                DBWriter.setFeedItemSortOrder(selectedFeed.getId(), sortOrder);\n-            }\n-        };\n-        sortDialog.openDialog();\n-    }\n-\n     public static boolean onMenuItemClicked(@NonNull Fragment fragment, int menuItemId,\n                                             @NonNull Feed selectedFeed, Runnable callback) {\n         @NonNull Context context = fragment.requireContext();\n@@ -131,5 +60,4 @@ public void onConfirmButtonPressed(DialogInterface clickedDialog) {\n         }\n         return true;\n     }\n-\n }\ndiff --git a/app/src/main/res/layout/sort_dialog.xml b/app/src/main/res/layout/sort_dialog.xml\nnew file mode 100644\nindex 0000000000..88eb61df56\n--- /dev/null\n+++ b/app/src/main/res/layout/sort_dialog.xml\n@@ -0,0 +1,28 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<LinearLayout\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    xmlns:tools=\"http://schemas.android.com/tools\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"wrap_content\"\n+    android:orientation=\"vertical\"\n+    android:padding=\"16dp\">\n+\n+    <androidx.gridlayout.widget.GridLayout\n+        android:id=\"@+id/gridLayout\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        app:columnCount=\"2\"\n+        app:rowOrderPreserved=\"false\"\n+        app:useDefaultMargins=\"true\"\n+        app:alignmentMode=\"alignBounds\" />\n+\n+    <CheckBox\n+        android:id=\"@+id/keepSortedCheckbox\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"match_parent\"\n+        android:visibility=\"gone\"\n+        android:text=\"@string/keep_sorted\"\n+        tools:visibility=\"visible\" />\n+\n+</LinearLayout>\ndiff --git a/app/src/main/res/layout/sort_dialog_item.xml b/app/src/main/res/layout/sort_dialog_item.xml\nnew file mode 100644\nindex 0000000000..570a66d269\n--- /dev/null\n+++ b/app/src/main/res/layout/sort_dialog_item.xml\n@@ -0,0 +1,10 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<Button\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    android:id=\"@+id/button\"\n+    android:layout_width=\"0dp\"\n+    android:layout_height=\"wrap_content\"\n+    app:layout_gravity=\"fill_horizontal|center_vertical\"\n+    app:layout_columnWeight=\"1\"\n+    style=\"@style/Widget.Material3.Button.OutlinedButton\" />\ndiff --git a/app/src/main/res/layout/sort_dialog_item_active.xml b/app/src/main/res/layout/sort_dialog_item_active.xml\nnew file mode 100644\nindex 0000000000..829ccdee20\n--- /dev/null\n+++ b/app/src/main/res/layout/sort_dialog_item_active.xml\n@@ -0,0 +1,10 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<Button\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    android:id=\"@+id/button\"\n+    android:layout_width=\"0dp\"\n+    android:layout_height=\"wrap_content\"\n+    app:layout_gravity=\"fill_horizontal|center_vertical\"\n+    app:layout_columnWeight=\"1\"\n+    style=\"@style/Widget.Material3.Button.TonalButton\" />\ndiff --git a/app/src/main/res/menu/downloads_completed.xml b/app/src/main/res/menu/downloads_completed.xml\nindex 08179de585..e4d82696f1 100644\n--- a/app/src/main/res/menu/downloads_completed.xml\n+++ b/app/src/main/res/menu/downloads_completed.xml\n@@ -24,8 +24,5 @@\n         app:showAsAction=\"always\" />\n     <item\n         android:id=\"@+id/downloads_sort\"\n-        android:title=\"@string/sort\">\n-        <menu></menu>\n-    </item>\n-\n+        android:title=\"@string/sort\" />\n </menu>\ndiff --git a/app/src/main/res/menu/episodes.xml b/app/src/main/res/menu/episodes.xml\nindex 358573c93f..5c7bd73519 100644\n--- a/app/src/main/res/menu/episodes.xml\n+++ b/app/src/main/res/menu/episodes.xml\n@@ -33,8 +33,6 @@\n     <item\n         android:id=\"@+id/episodes_sort\"\n         android:title=\"@string/sort\"\n-        custom:showAsAction=\"never\">\n-        <menu />\n-    </item>\n+        custom:showAsAction=\"never\" />\n \n </menu>\ndiff --git a/app/src/main/res/menu/inbox.xml b/app/src/main/res/menu/inbox.xml\nindex fba8eefdb9..50aee25f30 100644\n--- a/app/src/main/res/menu/inbox.xml\n+++ b/app/src/main/res/menu/inbox.xml\n@@ -17,9 +17,7 @@\n \n     <item\n         android:id=\"@+id/inbox_sort\"\n-        android:title=\"@string/sort\">\n-        <menu></menu>\n-    </item>\n+        android:title=\"@string/sort\" />\n \n     <item\n         android:id=\"@+id/remove_all_inbox_item\"\ndiff --git a/app/src/main/res/menu/queue.xml b/app/src/main/res/menu/queue.xml\nindex e4bb63808b..256069148e 100644\n--- a/app/src/main/res/menu/queue.xml\n+++ b/app/src/main/res/menu/queue.xml\n@@ -23,9 +23,7 @@\n \n     <item\n         android:id=\"@+id/queue_sort\"\n-        android:title=\"@string/sort\">\n-        <menu></menu>\n-    </item>\n+        android:title=\"@string/sort\" />\n \n     <item\n         android:id=\"@+id/clear_queue\"\ndiff --git a/app/src/main/res/menu/sort_menu.xml b/app/src/main/res/menu/sort_menu.xml\ndeleted file mode 100644\nindex 96ad4b9f6d..0000000000\n--- a/app/src/main/res/menu/sort_menu.xml\n+++ /dev/null\n@@ -1,99 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"utf-8\"?>\n-<menu xmlns:android=\"http://schemas.android.com/apk/res/android\">\n-\n-    <item\n-        android:id=\"@+id/sort_date\"\n-        android:title=\"@string/date\">\n-\n-        <menu>\n-            <item\n-                android:id=\"@+id/sort_date_asc\"\n-                android:title=\"@string/sort_old_new\"/>\n-            <item\n-                android:id=\"@+id/sort_date_desc\"\n-                android:title=\"@string/sort_new_old\"/>\n-        </menu>\n-    </item>\n-\n-    <item\n-        android:id=\"@+id/sort_duration\"\n-        android:title=\"@string/duration\">\n-\n-        <menu>\n-            <item\n-                android:id=\"@+id/sort_duration_asc\"\n-                android:title=\"@string/sort_short_long\"/>\n-            <item\n-                android:id=\"@+id/sort_duration_desc\"\n-                android:title=\"@string/sort_long_short\"/>\n-        </menu>\n-    </item>\n-\n-    <item\n-        android:id=\"@+id/sort_episode_title\"\n-        android:title=\"@string/episode_title\">\n-\n-        <menu>\n-            <item\n-                android:id=\"@+id/sort_episode_title_asc\"\n-                android:title=\"@string/sort_a_z\"/>\n-            <item\n-                android:id=\"@+id/sort_episode_title_desc\"\n-                android:title=\"@string/sort_z_a\"/>\n-        </menu>\n-    </item>\n-\n-    <item\n-        android:id=\"@+id/sort_feed_title\"\n-        android:title=\"@string/feed_title\">\n-\n-        <menu>\n-            <item\n-                android:id=\"@+id/sort_feed_title_asc\"\n-                android:title=\"@string/sort_a_z\"/>\n-            <item\n-                android:id=\"@+id/sort_feed_title_desc\"\n-                android:title=\"@string/sort_z_a\"/>\n-        </menu>\n-    </item>\n-\n-    <item\n-        android:id=\"@+id/sort_random\"\n-        android:title=\"@string/random\">\n-    </item>\n-\n-    <item\n-        android:id=\"@+id/sort_smart_shuffle\"\n-        android:title=\"@string/smart_shuffle\">\n-\n-        <menu>\n-            <item\n-                android:id=\"@+id/sort_smart_shuffle_asc\"\n-                android:title=\"@string/sort_old_new\"/>\n-            <item\n-                android:id=\"@+id/sort_smart_shuffle_desc\"\n-                android:title=\"@string/sort_new_old\"/>\n-        </menu>\n-    </item>\n-\n-    <item\n-        android:id=\"@+id/sort_size\"\n-        android:title=\"@string/size\"\n-        android:visible=\"false\">\n-\n-        <menu>\n-            <item\n-                android:id=\"@+id/sort_size_small_large\"\n-                android:title=\"@string/sort_small_large\"/>\n-            <item\n-                android:id=\"@+id/sort_size_large_small\"\n-                android:title=\"@string/sort_large_small\"/>\n-        </menu>\n-    </item>\n-\n-    <item\n-        android:id=\"@+id/keep_sorted\"\n-        android:title=\"@string/keep_sorted\"\n-        android:checkable=\"true\" />\n-\n-</menu>\ndiff --git a/core/src/main/res/values/arrays.xml b/core/src/main/res/values/arrays.xml\nindex 50afe630b7..f72a2e1080 100644\n--- a/core/src/main/res/values/arrays.xml\n+++ b/core/src/main/res/values/arrays.xml\n@@ -246,48 +246,6 @@\n         <item>DownloadsSection</item>\n     </string-array>\n \n-    <!-- sort for podcast screen, not for queue -->\n-    <string-array name=\"feed_episodes_sort_options\">\n-        <item>@string/sort_date_new_old</item>\n-        <item>@string/sort_date_old_new</item>\n-        <item>@string/sort_title_a_z</item>\n-        <item>@string/sort_title_z_a</item>\n-        <item>@string/sort_duration_short_long</item>\n-        <item>@string/sort_duration_long_short</item>\n-    </string-array>\n-\n-    <!-- sort for local feed screen -->\n-    <string-array name=\"local_feed_episodes_sort_options\">\n-        <item>@string/sort_date_new_old</item>\n-        <item>@string/sort_date_old_new</item>\n-        <item>@string/sort_title_a_z</item>\n-        <item>@string/sort_title_z_a</item>\n-        <item>@string/sort_duration_short_long</item>\n-        <item>@string/sort_duration_long_short</item>\n-        <item>@string/sort_filename_a_z</item>\n-        <item>@string/sort_filename_z_a</item>\n-    </string-array>\n-\n-    <string-array name=\"feed_episodes_sort_values\">\n-        <item>DATE_NEW_OLD</item>\n-        <item>DATE_OLD_NEW</item>\n-        <item>EPISODE_TITLE_A_Z</item>\n-        <item>EPISODE_TITLE_Z_A</item>\n-        <item>DURATION_SHORT_LONG</item>\n-        <item>DURATION_LONG_SHORT</item>\n-    </string-array>\n-\n-    <string-array name=\"local_feed_episodes_sort_values\">\n-        <item>DATE_NEW_OLD</item>\n-        <item>DATE_OLD_NEW</item>\n-        <item>EPISODE_TITLE_A_Z</item>\n-        <item>EPISODE_TITLE_Z_A</item>\n-        <item>DURATION_SHORT_LONG</item>\n-        <item>DURATION_LONG_SHORT</item>\n-        <item>EPISODE_FILENAME_A_Z</item>\n-        <item>EPISODE_FILENAME_Z_A</item>\n-    </string-array>\n-\n     <string-array name=\"compact_notification_buttons_options\">\n         <item>@string/rewind_label</item>\n         <item>@string/fast_forward_label</item>\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 493e8672c5..d28a73273a 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -767,25 +767,7 @@\n     <string name=\"not_paused\">Not paused</string>\n     <string name=\"hide_played_episodes_label\">Played</string>\n     <string name=\"not_played\">Not played</string>\n-\n-    <!-- Sort  -->\n-    <string name=\"sort_title_a_z\">Title (A \\u2192 Z)</string>\n-    <string name=\"sort_title_z_a\">Title (Z \\u2192 A)</string>\n-    <string name=\"sort_date_new_old\">Date (New \\u2192 Old)</string>\n-    <string name=\"sort_date_old_new\">Date (Old \\u2192 New)</string>\n-    <string name=\"sort_duration_short_long\">Duration (Short \\u2192 Long)</string>\n-    <string name=\"sort_duration_long_short\">Duration (Long \\u2192 Short)</string>\n-    <string name=\"sort_filename_a_z\">File Name (A \\u2192 Z)</string>\n-    <string name=\"sort_filename_z_a\">File Name (Z \\u2192 A)</string>\n-\n-    <string name=\"sort_a_z\">A \\u2192 Z</string>\n-    <string name=\"sort_z_a\">Z \\u2192 A</string>\n-    <string name=\"sort_new_old\">New \\u2192 Old</string>\n-    <string name=\"sort_old_new\">Old \\u2192 New</string>\n-    <string name=\"sort_short_long\">Short \\u2192 Long</string>\n-    <string name=\"sort_long_short\">Long \\u2192 Short</string>\n-    <string name=\"sort_small_large\">Small \\u2192 Large</string>\n-    <string name=\"sort_large_small\">Large \\u2192 Small</string>\n+    <string name=\"filename\">File name</string>\n \n     <!-- Share episode dialog -->\n     <string name=\"share_playback_position_dialog_label\">Include playback position</string>\n", "test_patch": "", "problem_statement": "Increase consistency between sorting UI\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same feature request.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the feature was already implemented and is just waiting to be released, or if the feature was rejected.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\r\n\r\n### App version\r\n\r\n3.1.2\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Problem you may be having, or feature you want\r\n\r\nOn the inbox/downloads screens, sorting takes four taps (three dots > Sort > {sort type} > {sort option}), whereas if you go to a podcast's specific page, it takes three taps (three dots > Sort > {sort option}) and the user gets a popup menu (below) to choose from\r\n\r\n<img width=\"250\" src=\"https://github.com/AntennaPod/AntennaPod/assets/44560551/33a44569-87c2-45d7-bed3-95430aff1f3c\" />\r\n\r\nThe second of these is better from an ease of use and appearance perspective\r\n\r\n### Suggested solution\r\n\r\nReplace the sort option selection UI that requires four taps with the one that requires three\r\n\r\n### Screenshots / Drawings / Technical details\r\n\r\nSee above\n", "hints_text": "Just a thought, I don't have much app dev experience but this seems like a fairly simple change(?) so if it's not an immediate priority, this would probably make a good \"good first issue\" issue\nThe queue has more sort options than the podcast screen. Showing all of these options in a flat structure like in that dialog would result in a very long list that is hard to use. I would rather use the sort menu that needs more taps but can be viewed at once instead of having to scroll.\r\n\r\nConsidering #6784, we maybe want none of the existing ones - we probably want a completely new sort UI that makes it possible to sort by multiple criteria. Making that easy to use without too many taps will be quite a challenge, though.\nAh interesting, I'll admit I've only had the app for a week or so, so I didn't spot the range of sort options in the queue...! \ud83d\udc40\r\n\r\nTaking inspiration from the sort menu in the gallery app [Simple Gallery](https://github.com/SimpleMobileTools/Simple-Gallery), maybe the sort criteria and the direction could be separated out into two sets? That would mean avoiding having two buttons for each sort option\r\n\r\n<img width=\"250\" src=\"https://github.com/AntennaPod/AntennaPod/assets/44560551/235458e2-e517-46d9-8974-c3f1683a88c2\" />\r\n\r\nThough this does mean losing the more intuitive labels like \"A->Z\" in favour of Alphabetical/Increasing... Maybe the inc/dec buttons could be relabeled on the fly depending on what sort option is selected? (Just spitballing, no idea about feasibility/usability)\nApparently I was the one who requested using \"A->Z\" instead of \"Ascending\" back then (#3987). So it seems like it wasn't a popular user request. Maybe if the list refreshes automatically behind the dialog, that's also easier to see then.\r\n\r\nI'm not a huge fan of Simple Gallery's dialog, though. It looks kind of cluttered, not very elegant. Maybe something like this could work. That also enables secondary sorting (eg grouping).\r\n\r\n<img width=\"250\" src=\"https://github.com/AntennaPod/AntennaPod/assets/5811634/45741720-99d8-4214-9939-4992b2c0c7dc\" />\r\n\r\nWith secondary sorting folded out:\r\n\r\n<img width=\"250\" src=\"https://github.com/AntennaPod/AntennaPod/assets/5811634/d41bda3f-9019-4032-bca8-1053bcf7a0d8\" />\r\n\r\nWhat do you think @keunes?\nThat's fair, my point was mostly just that you need not have two options for each option. I do like the look of your mock up more and it definitely fits the app style better.\n\nHowever, two things:\n\nI don't know if \"secondary sort order\" is super user understandable, I think it makes sense to those with a programming/logical background to imagine \"ok, it's sorts by the first criteria, and if there's any matches, it falls back to the second\" but I don't know if that's a more universal train of logic for most people? Maybe I'm overthinking though...\n\nSecondly, it seems to me that most of these options are redundant. Grouping by podcast title is the most clearly useful to me, date also makes some sense. But the chances of grouping by episode title, size or duration being useful seems vanishingly small since almost every group would have a single element. Not to mention sorting by Random/Random!\nNice, I love your mockup @ByteHamster. Make dialog more compact and it looks a lot better.\r\n\r\nI have a proposal which I think would avoid having to add secondary sort order as another block.\r\n@ImperialSquid you have to be able to at least have a secondary option because it's likely you would want a second sort criteria if you group by podcast for instance. What should be the second sort order and in which direction if default doesn't suit you.\r\n\r\nWhat I suggest instead of having a second block is just to add a little number before each sort name when you tap on it. That would allow to select multiple sort criteria and they would apply in the order user choose them.\r\n\r\nFor instance if I want to sort by podcast title then date : \r\n- When user tap podcast title a circled 1 appears : (1) Podcast title | A->Z\r\n- then user tap date and a circled 2 appears : (2) Date | New->Old\r\n\r\n\nHmm, @ImperialSquid has a point saying that most of the items don't really make sense as second-order. Maybe a simple checkbox \"group by feed\" on that dialog would indeed be the best option. Let's continue this over at #6784", "created_at": "2023-12-03T11:04:39Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6758, "instance_id": "AntennaPod__AntennaPod-6758", "issue_numbers": ["6757"], "base_commit": "7bfb53cc001dcb98a40a3fe327b9d53b4a60a144", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/storage/DBWriter.java b/core/src/main/java/de/danoeh/antennapod/core/storage/DBWriter.java\nindex 1453f701dc..c5c656705c 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/storage/DBWriter.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/storage/DBWriter.java\n@@ -116,7 +116,16 @@ private static boolean deleteFeedMediaSynchronous(@NonNull Context context, @Non\n         Log.i(TAG, String.format(Locale.US, \"Requested to delete FeedMedia [id=%d, title=%s, downloaded=%s\",\n                 media.getId(), media.getEpisodeTitle(), media.isDownloaded()));\n         boolean localDelete = false;\n-        if (media.isDownloaded() || media.getFile_url() != null) {\n+        if (media.getFile_url() != null && media.getFile_url().startsWith(\"content://\")) {\n+            // Local feed\n+            DocumentFile documentFile = DocumentFile.fromSingleUri(context, Uri.parse(media.getFile_url()));\n+            if (documentFile == null || !documentFile.exists() || !documentFile.delete()) {\n+                EventBus.getDefault().post(new MessageEvent(context.getString(R.string.delete_local_failed)));\n+                return false;\n+            }\n+            media.setFile_url(null);\n+            localDelete = true;\n+        } else if (media.getFile_url() != null) {\n             // delete downloaded media file\n             File mediaFile = new File(media.getFile_url());\n             if (mediaFile.exists() && !mediaFile.delete()) {\n@@ -131,15 +140,6 @@ private static boolean deleteFeedMediaSynchronous(@NonNull Context context, @Non\n             adapter.open();\n             adapter.setMedia(media);\n             adapter.close();\n-        } else if (media.getFile_url().startsWith(\"content://\")) {\n-            // Local feed\n-            DocumentFile documentFile = DocumentFile.fromSingleUri(\n-                    context, Uri.parse(media.getFile_url()));\n-            if (documentFile == null || !documentFile.exists() || !documentFile.delete()) {\n-                EventBus.getDefault().post(new MessageEvent(context.getString(R.string.delete_local_failed)));\n-                return false;\n-            }\n-            localDelete = true;\n         }\n \n         if (media.getId() == PlaybackPreferences.getCurrentlyPlayingFeedMediaId()) {\n@@ -224,10 +224,12 @@ private static void deleteFeedItemsSynchronous(@NonNull Context context, @NonNul\n                     PlaybackPreferences.writeNoMediaPlaying();\n                     IntentUtils.sendLocalBroadcast(context, PlaybackServiceInterface.ACTION_SHUTDOWN_PLAYBACK_SERVICE);\n                 }\n-                if (item.getMedia().isDownloaded()) {\n-                    deleteFeedMediaSynchronous(context, item.getMedia());\n+                if (!item.getFeed().isLocalFeed()) {\n+                    DownloadServiceInterface.get().cancel(context, item.getMedia());\n+                    if (item.getMedia().isDownloaded()) {\n+                        deleteFeedMediaSynchronous(context, item.getMedia());\n+                    }\n                 }\n-                DownloadServiceInterface.get().cancel(context, item.getMedia());\n             }\n         }\n \n", "test_patch": "", "problem_statement": "Cannot remove podcast from subscriptions\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.2.0-beta1\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Attempt to remove a podcast, either by long tapping on the Subscriptions screen or from the podcast screen\r\n2. Confirm that you intend to remove the podcast\n\n### Expected behaviour\n\n3a. The podcast is removed from your subscriptions\n\n### Current behaviour\n\n3b. The podcast is not removed\n\n### Logs\n\nNo crash involved\n", "hints_text": "", "created_at": "2023-11-12T14:06:12Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6756, "instance_id": "AntennaPod__AntennaPod-6756", "issue_numbers": ["6752"], "base_commit": "7bfb53cc001dcb98a40a3fe327b9d53b4a60a144", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/fragment/AllEpisodesFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/AllEpisodesFragment.java\nindex 7061a69f32..65693965b0 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/AllEpisodesFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/AllEpisodesFragment.java\n@@ -1,7 +1,5 @@\n package de.danoeh.antennapod.fragment;\n \n-import android.content.Context;\n-import android.content.SharedPreferences;\n import android.os.Bundle;\n import android.view.LayoutInflater;\n import android.view.MenuItem;\n@@ -14,6 +12,8 @@\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n import de.danoeh.antennapod.model.feed.SortOrder;\n+import de.danoeh.antennapod.storage.preferences.UserPreferences;\n+\n import org.apache.commons.lang3.StringUtils;\n import org.greenrobot.eventbus.Subscribe;\n \n@@ -26,10 +26,7 @@\n  */\n public class AllEpisodesFragment extends EpisodesListFragment {\n     public static final String TAG = \"EpisodesFragment\";\n-    private static final String PREF_NAME = \"PrefAllEpisodesFragment\";\n-    private static final String PREF_FILTER = \"filter\";\n-    public static final String PREF_SORT = \"prefEpisodesSort\";\n-    private SharedPreferences prefs;\n+    public static final String PREF_NAME = \"PrefAllEpisodesFragment\";\n \n     @NonNull\n     @Override\n@@ -40,7 +37,6 @@ public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container,\n         toolbar.setTitle(R.string.episodes_label);\n         updateToolbar();\n         updateFilterUi();\n-        prefs = getActivity().getSharedPreferences(PREF_NAME, Context.MODE_PRIVATE);\n         txtvInformation.setOnClickListener(\n                 v -> AllEpisodesFilterDialog.newInstance(getFilter()).show(getChildFragmentManager(), null));\n         return root;\n@@ -61,13 +57,15 @@ private void inflateSortMenu() {\n     @NonNull\n     @Override\n     protected List<FeedItem> loadData() {\n-        return DBReader.getEpisodes(0, page * EPISODES_PER_PAGE, getFilter(), getSortOrder());\n+        return DBReader.getEpisodes(0, page * EPISODES_PER_PAGE, getFilter(),\n+                UserPreferences.getAllEpisodesSortOrder());\n     }\n \n     @NonNull\n     @Override\n     protected List<FeedItem> loadMoreData(int page) {\n-        return DBReader.getEpisodes((page - 1) * EPISODES_PER_PAGE, EPISODES_PER_PAGE, getFilter(), getSortOrder());\n+        return DBReader.getEpisodes((page - 1) * EPISODES_PER_PAGE, EPISODES_PER_PAGE, getFilter(),\n+                UserPreferences.getAllEpisodesSortOrder());\n     }\n \n     @Override\n@@ -77,8 +75,7 @@ protected int loadTotalItemCount() {\n \n     @Override\n     protected FeedItemFilter getFilter() {\n-        SharedPreferences prefs = getActivity().getSharedPreferences(PREF_NAME, Context.MODE_PRIVATE);\n-        return new FeedItemFilter(prefs.getString(PREF_FILTER, \"\"));\n+        return new FeedItemFilter(UserPreferences.getPrefFilterAllEpisodes());\n     }\n \n     @Override\n@@ -119,13 +116,13 @@ public boolean onMenuItemClick(MenuItem item) {\n     }\n \n     private void saveSortOrderAndRefresh(SortOrder type) {\n-        prefs.edit().putString(PREF_SORT, \"\" + type.code).apply();\n+        UserPreferences.setAllEpisodesSortOrder(type);\n         loadItems();\n     }\n \n     @Subscribe\n     public void onFilterChanged(AllEpisodesFilterDialog.AllEpisodesFilterChangedEvent event) {\n-        prefs.edit().putString(PREF_FILTER, StringUtils.join(event.filterValues, \",\")).apply();\n+        UserPreferences.setPrefFilterAllEpisodes(StringUtils.join(event.filterValues, \",\"));\n         updateFilterUi();\n         page = 1;\n         loadItems();\n@@ -143,8 +140,4 @@ private void updateFilterUi() {\n         toolbar.getMenu().findItem(R.id.action_favorites).setIcon(\n                 getFilter().showIsFavorite ? R.drawable.ic_star : R.drawable.ic_star_border);\n     }\n-\n-    private SortOrder getSortOrder() {\n-        return SortOrder.fromCodeString(prefs.getString(PREF_SORT, \"\" + SortOrder.DATE_NEW_OLD.code));\n-    }\n }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/preferences/PreferenceUpgrader.java b/app/src/main/java/de/danoeh/antennapod/preferences/PreferenceUpgrader.java\nindex cc298b38d6..3a3063599d 100644\n--- a/app/src/main/java/de/danoeh/antennapod/preferences/PreferenceUpgrader.java\n+++ b/app/src/main/java/de/danoeh/antennapod/preferences/PreferenceUpgrader.java\n@@ -6,12 +6,15 @@\n import androidx.core.app.NotificationManagerCompat;\n import androidx.preference.PreferenceManager;\n \n+import org.apache.commons.lang3.StringUtils;\n+\n import java.util.concurrent.TimeUnit;\n \n import de.danoeh.antennapod.BuildConfig;\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.core.preferences.SleepTimerPreferences;\n import de.danoeh.antennapod.error.CrashReportWriter;\n+import de.danoeh.antennapod.fragment.AllEpisodesFragment;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import de.danoeh.antennapod.storage.preferences.UserPreferences.EnqueueLocation;\n import de.danoeh.antennapod.fragment.QueueFragment;\n@@ -149,5 +152,19 @@ private static void upgrade(int oldVersion, Context context) {\n         if (oldVersion < 3020000) {\n             NotificationManagerCompat.from(context).deleteNotificationChannel(\"auto_download\");\n         }\n+\n+        if (oldVersion < 3030000) {\n+            SharedPreferences allEpisodesPreferences =\n+                    context.getSharedPreferences(AllEpisodesFragment.PREF_NAME, Context.MODE_PRIVATE);\n+            String oldEpisodeSort = allEpisodesPreferences.getString(UserPreferences.PREF_SORT_ALL_EPISODES, \"\");\n+            if (!StringUtils.isAllEmpty(oldEpisodeSort)) {\n+                prefs.edit().putString(UserPreferences.PREF_SORT_ALL_EPISODES, oldEpisodeSort).apply();\n+            }\n+\n+            String oldEpisodeFilter = allEpisodesPreferences.getString(\"filter\", \"\");\n+            if (!StringUtils.isAllEmpty(oldEpisodeFilter)) {\n+                prefs.edit().putString(UserPreferences.PREF_FILTER_ALL_EPISODES, oldEpisodeFilter).apply();\n+            }\n+        }\n     }\n }\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\nindex c41ec93b12..29ff0d7b1e 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n@@ -89,7 +89,6 @@\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n import de.danoeh.antennapod.model.feed.FeedMedia;\n import de.danoeh.antennapod.model.feed.FeedPreferences;\n-import de.danoeh.antennapod.model.feed.SortOrder;\n import de.danoeh.antennapod.model.playback.MediaType;\n import de.danoeh.antennapod.model.playback.Playable;\n import de.danoeh.antennapod.playback.base.PlaybackServiceMediaPlayer;\n@@ -429,10 +428,11 @@ private List<MediaBrowserCompat.MediaItem> loadChildrenSynchronous(@NonNull Stri\n                     new FeedItemFilter(FeedItemFilter.DOWNLOADED), UserPreferences.getDownloadsSortedOrder());\n         } else if (parentId.equals(getResources().getString(R.string.episodes_label))) {\n             feedItems = DBReader.getEpisodes(0, MAX_ANDROID_AUTO_EPISODES_PER_FEED,\n-                    new FeedItemFilter(FeedItemFilter.UNPLAYED), SortOrder.DATE_NEW_OLD);\n+                    new FeedItemFilter(FeedItemFilter.UNPLAYED), UserPreferences.getAllEpisodesSortOrder());\n         } else if (parentId.startsWith(\"FeedId:\")) {\n             long feedId = Long.parseLong(parentId.split(\":\")[1]);\n-            feedItems = DBReader.getFeedItemList(DBReader.getFeed(feedId));\n+            Feed feed = DBReader.getFeed(feedId);\n+            feedItems = DBReader.getFeedItemList(feed, FeedItemFilter.unfiltered(), feed.getSortOrder());\n         } else if (parentId.equals(getString(R.string.recently_played_episodes))) {\n             Playable playable = PlaybackPreferences.createInstanceFromPreferences(this);\n             if (playable instanceof FeedMedia) {\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/storage/DBReader.java b/core/src/main/java/de/danoeh/antennapod/core/storage/DBReader.java\nindex d83557b0c7..1b1027c496 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/storage/DBReader.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/storage/DBReader.java\n@@ -15,9 +15,9 @@\n import java.util.List;\n import java.util.Map;\n \n+import de.danoeh.antennapod.core.util.FeedItemPermutors;\n import de.danoeh.antennapod.core.util.LongList;\n import de.danoeh.antennapod.core.util.comparator.DownloadResultComparator;\n-import de.danoeh.antennapod.core.util.comparator.FeedItemPubdateComparator;\n import de.danoeh.antennapod.core.util.comparator.PlaybackCompletionDateComparator;\n import de.danoeh.antennapod.model.feed.Chapter;\n import de.danoeh.antennapod.model.feed.Feed;\n@@ -170,13 +170,18 @@ public static List<FeedItem> getFeedItemList(final Feed feed) {\n     }\n \n     public static List<FeedItem> getFeedItemList(final Feed feed, final FeedItemFilter filter) {\n+        return getFeedItemList(feed, filter, SortOrder.DATE_NEW_OLD);\n+    }\n+\n+    public static List<FeedItem> getFeedItemList(final Feed feed, final FeedItemFilter filter, SortOrder sortOrder) {\n         Log.d(TAG, \"getFeedItemList() called with: \" + \"feed = [\" + feed + \"]\");\n \n         PodDBAdapter adapter = PodDBAdapter.getInstance();\n         adapter.open();\n         try (Cursor cursor = adapter.getItemsOfFeedCursor(feed, filter)) {\n             List<FeedItem> items = extractItemlistFromCursor(adapter, cursor);\n-            Collections.sort(items, new FeedItemPubdateComparator());\n+            FeedItemPermutors.getPermutor(sortOrder).reorder(items);\n+            feed.setItems(items);\n             for (FeedItem item : items) {\n                 item.setFeed(feed);\n             }\ndiff --git a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\nindex 80a58525d9..7b15584bad 100644\n--- a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n+++ b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n@@ -67,6 +67,10 @@ private UserPreferences(){}\n     private static final String PREF_DOWNLOADS_SORTED_ORDER = \"prefDownloadSortedOrder\";\n     private static final String PREF_INBOX_SORTED_ORDER = \"prefInboxSortedOrder\";\n \n+    // Episode\n+    public static final String PREF_SORT_ALL_EPISODES = \"prefEpisodesSort\";\n+    public static final String PREF_FILTER_ALL_EPISODES = \"prefEpisodesFilter\";\n+\n     // Playback\n     public static final String PREF_PAUSE_ON_HEADSET_DISCONNECT = \"prefPauseOnHeadsetDisconnect\";\n     public static final String PREF_UNPAUSE_ON_HEADSET_RECONNECT = \"prefUnpauseOnHeadsetReconnect\";\n@@ -867,4 +871,21 @@ public static void setSubscriptionsFilter(SubscriptionsFilter value) {\n     public static boolean shouldShowSubscriptionTitle() {\n         return prefs.getBoolean(PREF_SUBSCRIPTION_TITLE, false);\n     }\n+\n+    public static void setAllEpisodesSortOrder(SortOrder s) {\n+        prefs.edit().putString(PREF_SORT_ALL_EPISODES, \"\" + s.code).apply();\n+    }\n+\n+    public static SortOrder getAllEpisodesSortOrder() {\n+        return SortOrder.fromCodeString(prefs.getString(PREF_SORT_ALL_EPISODES,\n+                \"\" + SortOrder.DATE_NEW_OLD.code));\n+    }\n+\n+    public static String getPrefFilterAllEpisodes() {\n+        return prefs.getString(PREF_FILTER_ALL_EPISODES, \"\");\n+    }\n+\n+    public static void setPrefFilterAllEpisodes(String filter) {\n+        prefs.edit().putString(PREF_FILTER_ALL_EPISODES, filter).apply();\n+    }\n }\n", "test_patch": "", "problem_statement": "Android auto sort order error\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.1.2\n\n### Where did you get the app from\n\nF-Droid\n\n### Android version\n\n14\n\n### Device model\n\nPixel 7a\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n_No response_\n\n### Expected behaviour\n\nIn Android auto, if i select sort order oldest to newest ( in case of many episodes) , the order visualized on car display is oldest to newest.\n\n### Current behaviour\n\nIn Android auto, if i select sort order oldest to newest ( in case of many episodes) , the order visualized on car display is newest to older instead.  \n\n### Logs\n\n_No response_\n", "hints_text": "@lux70 I assume you are talking about the episode view for sort order?  I can confirm this bug.\r\nFor queue, the sort order seems to be honored\nYes. Exately.  And only in android auto. The app does not seems to have this bug \n\nIl 9 novembre 2023 17:52:56 CET, Tony Tam ***@***.***> ha scritto:\n>@lux70 I assume you are talking about the episode view for sort order?  I can confirm this bug.\n>For queue, the sort order seems to be honored\n>\n>-- \n>Reply to this email directly or view it on GitHub:\n>https://github.com/AntennaPod/AntennaPod/issues/6752#issuecomment-1804197050\n>You are receiving this because you were mentioned.\n>\n>Message ID: ***@***.***>", "created_at": "2023-11-12T05:10:02Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6753, "instance_id": "AntennaPod__AntennaPod-6753", "issue_numbers": ["6533"], "base_commit": "4d627cc3af6571c444b4f921f60a8e4a056e93b9", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\nindex c41ec93b12..5c8dead816 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n@@ -799,6 +799,10 @@ public void statusChanged(PlaybackServiceMediaPlayer.PSMPInfo newInfo) {\n                     updateNotificationAndMediaSession(newInfo.playable);\n                     break;\n                 case PREPARED:\n+                    if (mediaPlayer.getPSMPInfo().playable != null) {\n+                        PlaybackPreferences.writeMediaPlaying(mediaPlayer.getPSMPInfo().playable,\n+                                mediaPlayer.getPSMPInfo().playerStatus);\n+                    }\n                     taskManager.startChapterLoader(newInfo.playable);\n                     break;\n                 case PAUSED:\n", "test_patch": "", "problem_statement": "When playing podcasts with Google Maps navigation open playback stops at the end of each episode\nWhen playing podcasts with Google Maps navigation open and \"Auto Delete\" enabled in settings, at the end of each episode playback stops immediately after starting the next episode in the queue, and the playback controls in the Google Maps navigation UI disappear.\r\n\r\n### Steps to reproduce\r\n\r\n1. Go to Settings -> Storage and ensure \"Auto Delete\" is enabled\r\n2. Download two podcasts (that aren't in your favorites) and put them in your queue\r\n3. Hit play on the first podcast and skip towards the end\r\n4. Open Google Maps and navigate to any destination\r\n5. Wait for the first podcast to end\r\n\r\n### Expected behavior\r\n\r\nNext podcast in the queue starts playing and continues until paused or stopped\r\n\r\n### Current behavior\r\n\r\nThe first ~quarter second of the next podcast in the queue starts playing, then immediately stops and playback controls in Google Maps navigation disappear preventing you from resuming.\r\n\r\n### App version\r\n\r\n3.0.2, 3.1.1\r\n\r\n### Where did you get the app from\r\n\r\nF-Droid\r\n\r\n### Android version\r\n\r\n13\r\n\r\n### Device model\r\n\r\nPixel 6\r\n\r\n### First occurred\r\n\r\n~Years ago\n", "hints_text": "I have this same issue on my Pixel 7.  It does not make a difference if I'm connected to Bluetooth or not.  If I disable Auto Delete in settings, the next episode will play as normal.\nCan confirm the behaviour on samsung S22 with Android 13, didn't test the workaround proposed by k5tmt, though. \nAlso experiencing this on a Pixel 7a. Issue seems to disappear if you disable driving mode in Google maps, so I suspect there's some weird interaction happening there.\nI confirm this bug on Android 14, Pixel 4a, AP version 3.1.2.   I changed the label to `Confirmed Bug`, tell me if I should not be doing that @ByteHamster ", "created_at": "2023-11-10T05:25:39Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6746, "instance_id": "AntennaPod__AntennaPod-6746", "issue_numbers": ["6741"], "base_commit": "1d415c9f7f11a4454448c20e4ce1a17aaf20cbe7", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/ImportExportPreferencesFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/ImportExportPreferencesFragment.java\nindex 3b43684648..686be884c4 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/ImportExportPreferencesFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/ImportExportPreferencesFragment.java\n@@ -147,7 +147,7 @@ private void exportWithWriter(ExportWriter exportWriter, Uri uri, Export exportT\n                     .subscribe(output -> {\n                         Uri fileUri = FileProvider.getUriForFile(context.getApplicationContext(),\n                                 context.getString(R.string.provider_authority), output);\n-                        showExportSuccessDialog(output.toString(), fileUri, exportType);\n+                        showExportSuccessSnackbar(fileUri, exportType.contentType);\n                     }, this::showExportErrorDialog, progressDialog::dismiss);\n         } else {\n             DocumentFileExportWorker worker = new DocumentFileExportWorker(exportWriter, context, uri);\n@@ -155,7 +155,7 @@ private void exportWithWriter(ExportWriter exportWriter, Uri uri, Export exportT\n                     .subscribeOn(Schedulers.io())\n                     .observeOn(AndroidSchedulers.mainThread())\n                     .subscribe(output ->\n-                            showExportSuccessDialog(output.getUri().toString(), output.getUri(), exportType),\n+                            showExportSuccessSnackbar(output.getUri(), exportType.contentType),\n                             this::showExportErrorDialog, progressDialog::dismiss);\n         }\n     }\n@@ -191,20 +191,15 @@ private void showDatabaseImportSuccessDialog() {\n         builder.show();\n     }\n \n-    private void showExportSuccessDialog(String path, Uri streamUri, Export exportType) {\n-        final MaterialAlertDialogBuilder alert = new MaterialAlertDialogBuilder(getContext());\n-        alert.setNeutralButton(android.R.string.ok, (dialog, which) -> dialog.dismiss());\n-        alert.setTitle(R.string.export_success_title);\n-        alert.setMessage(getContext().getString(R.string.export_success_sum, path));\n-        alert.setPositiveButton(R.string.send_label, (dialog, which) -> {\n-            new ShareCompat.IntentBuilder(getContext())\n-                    .setType(exportType.contentType)\n-                    .setSubject(getString(exportType.labelResId))\n-                    .addStream(streamUri)\n-                    .setChooserTitle(R.string.send_label)\n-                    .startChooser();\n-        });\n-        alert.create().show();\n+    void showExportSuccessSnackbar(Uri uri, String mimeType) {\n+        Snackbar.make(getView(), R.string.export_success_title, Snackbar.LENGTH_LONG)\n+                .setAction(R.string.share_label, v ->\n+                        new ShareCompat.IntentBuilder(getContext())\n+                                .setType(mimeType)\n+                                .addStream(uri)\n+                                .setChooserTitle(R.string.share_label)\n+                                .startChooser())\n+                .show();\n     }\n \n     private void showExportErrorDialog(final Throwable error) {\n@@ -264,7 +259,7 @@ private void backupDatabaseResult(final Uri uri) {\n                 .subscribeOn(Schedulers.io())\n                 .observeOn(AndroidSchedulers.mainThread())\n                 .subscribe(() -> {\n-                    Snackbar.make(getView(), R.string.export_success_title, Snackbar.LENGTH_LONG).show();\n+                    showExportSuccessSnackbar(uri, \"application/x-sqlite3\");\n                     progressDialog.dismiss();\n                 }, this::showExportErrorDialog);\n     }\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex a35f5ab906..493e8672c5 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -138,7 +138,6 @@\n     <string name=\"feed_auto_download_never\">Never</string>\n     <string name=\"feed_new_episodes_action_add_to_inbox\">Add to inbox</string>\n     <string name=\"feed_new_episodes_action_nothing\">Nothing</string>\n-    <string name=\"send_label\">Send&#8230;</string>\n     <string name=\"episode_cleanup_never\">Never</string>\n     <string name=\"episode_cleanup_except_favorite_removal\">When not favorited</string>\n     <string name=\"episode_cleanup_queue_removal\">When not in queue</string>\n@@ -590,7 +589,6 @@\n     <string name=\"please_wait\">Please wait&#8230;</string>\n     <string name=\"export_error_label\">Export error</string>\n     <string name=\"export_success_title\">Export successful</string>\n-    <string name=\"export_success_sum\">The exported file was written to:\\n\\n%1$s</string>\n     <string name=\"opml_import_ask_read_permission\">Access to external storage is required to read the OPML file</string>\n     <string name=\"successful_import_label\">Import successful</string>\n     <string name=\"import_ok\">Please press OK to restart AntennaPod</string>\n", "test_patch": "", "problem_statement": "Allow Sharing Database when exported\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.1.2\n\n### Where did you get the app from\n\nGoogle Play\n\n### Problem you may be having, or feature you want\n\nInstead of (or in addition to) exporting the database, allow sharing with other apps.\n\n### Suggested solution\n\nTypically when I export my Antennapod database I am not doing any manipulation of the database on my phone. Instead I usually open a file manager (Solid Explorer or FolderSync) and have to find the file and share it with another app (typically KDE Connect or Nextcloud).\n\n### Screenshots / Drawings / Technical details\n\nHave another option in Settings -> Import/Export to share the database with another app (possibly called \"Share Database\")\n", "hints_text": "", "created_at": "2023-11-05T14:48:15Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6739, "instance_id": "AntennaPod__AntennaPod-6739", "issue_numbers": ["4935"], "base_commit": "2c3fb5610a98d80db25b85fdf0607bfc2b6216fc", "patch": "diff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItem.java b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItem.java\nindex a8570ea4e6..a614204807 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItem.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedItem.java\n@@ -1,8 +1,10 @@\n package de.danoeh.antennapod.model.feed;\n \n+import android.util.Log;\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n \n+import org.apache.commons.lang3.StringUtils;\n import org.apache.commons.lang3.builder.ToStringBuilder;\n import org.apache.commons.lang3.builder.ToStringStyle;\n \n@@ -20,6 +22,8 @@\n  */\n public class FeedItem extends FeedComponent implements Serializable {\n \n+    public static String TAG = \"FeedItem\";\n+\n     /** tag that indicates this item is in the queue */\n     public static final String TAG_QUEUE = \"Queue\";\n     /** tag that indicates this item is in favorites */\n@@ -42,6 +46,8 @@ public class FeedItem extends FeedComponent implements Serializable {\n     private transient Feed feed;\n     private long feedId;\n     private String podcastIndexChapterUrl;\n+    private String podcastIndexTranscriptUrl;\n+    private String podcastIndexTranscriptType;\n \n     private int state;\n     public static final int NEW = -1;\n@@ -82,7 +88,8 @@ public FeedItem() {\n      * */\n     public FeedItem(long id, String title, String link, Date pubDate, String paymentLink, long feedId,\n                     boolean hasChapters, String imageUrl, int state,\n-                    String itemIdentifier, long autoDownload, String podcastIndexChapterUrl) {\n+                    String itemIdentifier, long autoDownload, String podcastIndexChapterUrl,\n+                    String transcriptType, String transcriptUrl) {\n         this.id = id;\n         this.title = title;\n         this.link = link;\n@@ -95,6 +102,10 @@ public FeedItem(long id, String title, String link, Date pubDate, String payment\n         this.itemIdentifier = itemIdentifier;\n         this.autoDownload = autoDownload;\n         this.podcastIndexChapterUrl = podcastIndexChapterUrl;\n+        if (transcriptUrl != null) {\n+            this.podcastIndexTranscriptUrl = transcriptUrl;\n+            this.podcastIndexTranscriptType = transcriptType;\n+        }\n     }\n \n     /**\n@@ -162,6 +173,9 @@ public void updateFromOther(FeedItem other) {\n         if (other.podcastIndexChapterUrl != null) {\n             podcastIndexChapterUrl = other.podcastIndexChapterUrl;\n         }\n+        if (other.getPodcastIndexTranscriptUrl() != null) {\n+            podcastIndexTranscriptUrl = other.podcastIndexTranscriptUrl;\n+        }\n     }\n \n     /**\n@@ -440,6 +454,45 @@ public void setPodcastIndexChapterUrl(String url) {\n         podcastIndexChapterUrl = url;\n     }\n \n+    public void setPodcastIndexTranscriptUrl(String type, String url) {\n+        updateTranscriptPreferredFormat(type, url);\n+    }\n+\n+    public String getPodcastIndexTranscriptUrl() {\n+        return podcastIndexTranscriptUrl;\n+    }\n+\n+    public String getPodcastIndexTranscriptType() {\n+        return podcastIndexTranscriptType;\n+    }\n+\n+    public void updateTranscriptPreferredFormat(String type, String url) {\n+        if (StringUtils.isEmpty(type) || StringUtils.isEmpty(url)) {\n+            return;\n+        }\n+\n+        String canonicalSrr = \"application/srr\";\n+        String jsonType = \"application/json\";\n+\n+        switch (type) {\n+            case \"application/json\":\n+                podcastIndexTranscriptUrl = url;\n+                podcastIndexTranscriptType = type;\n+                break;\n+            case \"application/srr\":\n+            case \"application/srt\":\n+            case \"application/x-subrip\":\n+                if (podcastIndexTranscriptUrl == null || !podcastIndexTranscriptType.equals(jsonType)) {\n+                    podcastIndexTranscriptUrl = url;\n+                    podcastIndexTranscriptType = canonicalSrr;\n+                }\n+                break;\n+            default:\n+                Log.d(TAG, \"Invalid format for transcript \" + type);\n+                break;\n+        }\n+    }\n+\n     @NonNull\n     @Override\n     public String toString() {\ndiff --git a/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/namespace/PodcastIndex.java b/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/namespace/PodcastIndex.java\nindex 1f543a5ae5..dd11fb4e7b 100644\n--- a/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/namespace/PodcastIndex.java\n+++ b/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/namespace/PodcastIndex.java\n@@ -14,6 +14,8 @@ public class PodcastIndex extends Namespace {\n     private static final String URL = \"url\";\n     private static final String FUNDING = \"funding\";\n     private static final String CHAPTERS = \"chapters\";\n+    private static final String TRANSCRIPT = \"transcript\";\n+    private static final String TYPE = \"type\";\n \n     @Override\n     public SyndElement handleElementStart(String localName, HandlerState state,\n@@ -28,6 +30,12 @@ public SyndElement handleElementStart(String localName, HandlerState state,\n             if (!TextUtils.isEmpty(href)) {\n                 state.getCurrentItem().setPodcastIndexChapterUrl(href);\n             }\n+        } else if (TRANSCRIPT.equals(localName)) {\n+            String href = attributes.getValue(URL);\n+            String type = attributes.getValue(TYPE);\n+            if (!TextUtils.isEmpty(href) && !TextUtils.isEmpty(type)) {\n+                state.getCurrentItem().setPodcastIndexTranscriptUrl(type, href);\n+            }\n         }\n         return new SyndElement(localName, this);\n     }\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java\nindex e4a1f5a3dd..bde74948f5 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/DBUpgrader.java\n@@ -334,6 +334,12 @@ static void upgrade(final SQLiteDatabase db, final int oldVersion, final int new\n             db.execSQL(\"ALTER TABLE \" + PodDBAdapter.TABLE_NAME_FEEDS\n                     + \" ADD COLUMN \" + PodDBAdapter.KEY_NEW_EPISODES_ACTION + \" INTEGER DEFAULT 0\");\n         }\n+        if (oldVersion < 3030000) {\n+            db.execSQL(\"ALTER TABLE \" + PodDBAdapter.TABLE_NAME_FEED_ITEMS\n+                    + \" ADD COLUMN \" + PodDBAdapter.KEY_PODCASTINDEX_TRANSCRIPT_URL + \" TEXT\");\n+            db.execSQL(\"ALTER TABLE \" + PodDBAdapter.TABLE_NAME_FEED_ITEMS\n+                    + \" ADD COLUMN \" + PodDBAdapter.KEY_PODCASTINDEX_TRANSCRIPT_TYPE + \" TEXT\");\n+        }\n     }\n \n }\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\nindex 21f12e2230..3140fdd0ea 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n@@ -52,7 +52,7 @@ public class PodDBAdapter {\n \n     private static final String TAG = \"PodDBAdapter\";\n     public static final String DATABASE_NAME = \"Antennapod.db\";\n-    public static final int VERSION = 3010000;\n+    public static final int VERSION = 3030000;\n \n     /**\n      * Maximum number of arguments for IN-operator.\n@@ -120,6 +120,8 @@ public class PodDBAdapter {\n     public static final String KEY_EPISODE_NOTIFICATION = \"episode_notification\";\n     public static final String KEY_NEW_EPISODES_ACTION = \"new_episodes_action\";\n     public static final String KEY_PODCASTINDEX_CHAPTER_URL = \"podcastindex_chapter_url\";\n+    public static final String KEY_PODCASTINDEX_TRANSCRIPT_URL = \"podcastindex_transcript_url\";\n+    public static final String KEY_PODCASTINDEX_TRANSCRIPT_TYPE = \"podcastindex_transcript_type\";\n \n     // Table names\n     public static final String TABLE_NAME_FEEDS = \"Feeds\";\n@@ -172,7 +174,9 @@ public class PodDBAdapter {\n             + KEY_HAS_CHAPTERS + \" INTEGER,\" + KEY_ITEM_IDENTIFIER + \" TEXT,\"\n             + KEY_IMAGE_URL + \" TEXT,\"\n             + KEY_AUTO_DOWNLOAD_ATTEMPTS + \" INTEGER,\"\n-            + KEY_PODCASTINDEX_CHAPTER_URL + \" TEXT)\";\n+            + KEY_PODCASTINDEX_CHAPTER_URL + \" TEXT,\"\n+            + KEY_PODCASTINDEX_TRANSCRIPT_TYPE + \" TEXT,\"\n+            + KEY_PODCASTINDEX_TRANSCRIPT_URL + \" TEXT\" + \")\";\n \n     private static final String CREATE_TABLE_FEED_MEDIA = \"CREATE TABLE \"\n             + TABLE_NAME_FEED_MEDIA + \" (\" + TABLE_PRIMARY_KEY + KEY_DURATION\n@@ -260,7 +264,9 @@ public class PodDBAdapter {\n             + TABLE_NAME_FEED_ITEMS + \".\" + KEY_ITEM_IDENTIFIER + \", \"\n             + TABLE_NAME_FEED_ITEMS + \".\" + KEY_IMAGE_URL + \", \"\n             + TABLE_NAME_FEED_ITEMS + \".\" + KEY_AUTO_DOWNLOAD_ATTEMPTS + \", \"\n-            + TABLE_NAME_FEED_ITEMS + \".\" + KEY_PODCASTINDEX_CHAPTER_URL;\n+            + TABLE_NAME_FEED_ITEMS + \".\" + KEY_PODCASTINDEX_CHAPTER_URL + \", \"\n+            + TABLE_NAME_FEED_ITEMS + \".\" + KEY_PODCASTINDEX_TRANSCRIPT_TYPE + \", \"\n+            + TABLE_NAME_FEED_ITEMS + \".\" + KEY_PODCASTINDEX_TRANSCRIPT_URL;\n \n     private static final String KEYS_FEED_MEDIA =\n             TABLE_NAME_FEED_MEDIA + \".\" + KEY_ID + \" AS \" + SELECT_KEY_MEDIA_ID + \", \"\n@@ -656,6 +662,14 @@ private long updateOrInsertFeedItem(FeedItem item, boolean saveFeed) {\n         values.put(KEY_IMAGE_URL, item.getImageUrl());\n         values.put(KEY_PODCASTINDEX_CHAPTER_URL, item.getPodcastIndexChapterUrl());\n \n+        // We only store one transcript url, we prefer JSON if it exists\n+        String type = item.getPodcastIndexTranscriptType();\n+        String url = item.getPodcastIndexTranscriptUrl();\n+        if (url != null) {\n+            values.put(KEY_PODCASTINDEX_TRANSCRIPT_TYPE, type);\n+            values.put(KEY_PODCASTINDEX_TRANSCRIPT_URL, url);\n+        }\n+\n         if (item.getId() == 0) {\n             item.setId(db.insert(TABLE_NAME_FEED_ITEMS, null, values));\n         } else {\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemCursorMapper.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemCursorMapper.java\nindex fcf51e31ec..c4e271eb23 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemCursorMapper.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemCursorMapper.java\n@@ -28,6 +28,9 @@ public static FeedItem convert(@NonNull Cursor cursor) {\n         int indexAutoDownload = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_AUTO_DOWNLOAD_ATTEMPTS);\n         int indexImageUrl = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_IMAGE_URL);\n         int indexPodcastIndexChapterUrl = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_PODCASTINDEX_CHAPTER_URL);\n+        int indexPodcastIndexTranscriptUrl = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_PODCASTINDEX_TRANSCRIPT_URL);\n+        int indexPodcastIndexTranscriptType = cursor.getColumnIndexOrThrow(\n+                PodDBAdapter.KEY_PODCASTINDEX_TRANSCRIPT_TYPE);\n \n         long id = cursor.getInt(indexId);\n         String title = cursor.getString(indexTitle);\n@@ -41,8 +44,11 @@ public static FeedItem convert(@NonNull Cursor cursor) {\n         long autoDownload = cursor.getLong(indexAutoDownload);\n         String imageUrl = cursor.getString(indexImageUrl);\n         String podcastIndexChapterUrl = cursor.getString(indexPodcastIndexChapterUrl);\n+        String podcastIndexTranscriptUrl = cursor.getString(indexPodcastIndexTranscriptUrl);\n+        String podcastIndexTranscriptType = cursor.getString(indexPodcastIndexTranscriptType);\n \n         return new FeedItem(id, title, link, pubDate, paymentLink, feedId,\n-                hasChapters, imageUrl, state, itemIdentifier, autoDownload, podcastIndexChapterUrl);\n+                hasChapters, imageUrl, state, itemIdentifier, autoDownload, podcastIndexChapterUrl,\n+                podcastIndexTranscriptType, podcastIndexTranscriptUrl);\n     }\n }\n", "test_patch": "diff --git a/parser/feed/src/test/java/de/danoeh/antennapod/parser/feed/element/namespace/RssParserTest.java b/parser/feed/src/test/java/de/danoeh/antennapod/parser/feed/element/namespace/RssParserTest.java\nindex 88ac5c7314..4ce8911e92 100644\n--- a/parser/feed/src/test/java/de/danoeh/antennapod/parser/feed/element/namespace/RssParserTest.java\n+++ b/parser/feed/src/test/java/de/danoeh/antennapod/parser/feed/element/namespace/RssParserTest.java\n@@ -97,6 +97,14 @@ public void testMultipleFundingTags() throws Exception {\n         assertEquals(\"https://example.com/funding3\", feed.getPaymentLinks().get(2).url);\n     }\n \n+    @Test\n+    public void testPodcastIndexTranscript() throws Exception {\n+        File feedFile = FeedParserTestHelper.getFeedFile(\"feed-rss-testPodcastIndexTranscript.xml\");\n+        Feed feed = FeedParserTestHelper.runFeedParser(feedFile);\n+        assertEquals(\"https://podnews.net/audio/podnews231011.mp3.json\", feed.getItems().get(0).getPodcastIndexTranscriptUrl());\n+        assertEquals(\"application/json\", feed.getItems().get(0).getPodcastIndexTranscriptType());\n+    }\n+\n     @Test\n     public void testUnsupportedElements() throws Exception {\n         File feedFile = FeedParserTestHelper.getFeedFile(\"feed-rss-testUnsupportedElements.xml\");\ndiff --git a/parser/feed/src/test/resources/feed-rss-testPodcastIndexTranscript.xml b/parser/feed/src/test/resources/feed-rss-testPodcastIndexTranscript.xml\nnew file mode 100644\nindex 0000000000..f972ee2076\n--- /dev/null\n+++ b/parser/feed/src/test/resources/feed-rss-testPodcastIndexTranscript.xml\n@@ -0,0 +1,13 @@\n+<?xml version='1.0' encoding='UTF-8' ?>\n+<rss version=\"2.0\" xmlns:podcast=\"https://podcastindex.org/namespace/1.0\">\n+    <channel>\n+        <title>title</title>\n+        <item>\n+            <title>Podcasts in YouTube make it to the UK</title>\n+            <link>https://podnews.net/update/youtube-podcasts-uk</link>\n+            <pubDate>Tue, 10 Oct 2023 08:46:31 +0000</pubDate>\n+            <podcast:transcript url=\"https://podnews.net/audio/podnews231011.mp3.json\" type=\"application/json\" />\n+            <podcast:transcript url=\"https://podnews.net/audio/podnews231011.mp3.srt\" type=\"application/srt\" />\n+        </item>\n+    </channel>\n+</rss>\n", "problem_statement": "Support for podcast:transcript tag\n# Checklist\r\n<!-- Place an x in the boxes to tick them: [x] -->\r\n\r\n- [x] I have used the search function to see if someone else has already submitted the same feature request.\r\n- [x] I will only create one feature request per issue.\r\n- [x] I will describe the problem with as much detail as possible\r\n\r\n# Feature description\r\nSome podcasts include text transcript using `podcast:transcipt`\r\n\r\n**Suggested solution**:\r\nDisplay transcript and sync it with the audio.\r\n\r\nMeeting notes from Nov 2nd, 2023 https://github.com/AntennaPod/AntennaPod/issues/4935#issuecomment-1791614891\r\n\n", "hints_text": "@keunes or @ByteHamster please assign to me, since I have the podcastindex namespace parsing done in #4933, I could tackle `podcast:transcript`\nI have a a few suggestions for transcript related features I think  would be great to include in AntennaPod (originally mentioned in https://github.com/AntennaPod/AntennaPod/issues/5002):\r\n\r\n1. Optionally including timestamps when copying from the trancsript. This would be helpful when using a noteapp to write down interesting segments from the podcast as it makes it easier to go back to the podcast an relisten to the particular segment.\r\n2.  Having the transcript autoscroll as the episode is playing, so when switching to the transcript tab, the text is in the same position as the audio. This would facilitate notetaking while listening.\r\n3. Searching the transcript. I am referring to searching within a single transcript , which would make it easier to find interesting segments (which in turn could be navigated to if combined with the below item).\r\n4. Using the transcript for seeking in the audio (clicking sentences to jump to that position).\r\n\r\nThere are currently at least two podcast apps on iOS that provide some of these features, but none on Android as far as I know. Those apps are https://podcast9.com/ and https://www.airr.io/. They are labeling themselves as more educational / productive alternatives to regular podcast apps and their main value proposition is the ability to interact with and remember what you listen to as well as easily share your favorite bits with others.\r\n\r\nA future item to consider which might be out of scope currently is to automatically create transcripts for episodes that don't provide it, e.g. using the live transcribe feature on phones where it is available.\nNice ideas \ud83d\udc4d My guess would be that # 4 wouldn't be too difficult. But for the others I guess we (the app) would need to receive the timestamps with the transcript I think - as I reckon it's not feasible for AP to automatically match the text with the audio. Do you know if transcripts typically have such timestamps?\nThanks @keunes ! I am not very experienced with podcast data and metadata, but I looked around a bit and it seems like at least some transcripts provide this. The [example used on the podcastindex API docs](https://podcastindex-org.github.io/docs-api/#get-/episodes/byid) page includes this segment:\r\n\r\n```json\r\ntranscriptUrl: \"https://mp3s.nashownotes.com/NA-1322-Captions.srt\"\r\n```\r\n\r\nThat srt file includes timestamps which look like this:\r\n\r\n```srt\r\n1\r\n00:00:00,000 --> 00:00:05,340\r\nPull my mask over my nose. Adam\r\nCurry John C Dvorak, Thursday,\r\n\r\n2\r\n00:00:05,340 --> 00:00:09,030\r\nFebruary 18 2021. This is your\r\naward winning media\r\n\r\n3\r\n00:00:09,030 --> 00:00:13,380\r\nassassination Episode 13. This\r\nis no agenda.\r\n\r\n...\r\n```\r\n\r\nI am not sure how common it is, but at least it exists.\r\n\r\nA complimentary approach that is less robust but does not rely on external data could be to match the relative position of sentences in the transcript with the relative time of the audio file (when no timestamps are available). Even if this was only able to generate precision to the minute, I think it would be helpful for most items I mentioned above. For some, like the scrolling text, it would probably perform quite well since so much of the transcript would be shown on the screen that the matched position does not have to be exact. It would probably benefit from calculating the relative audio position without silences (I noted that there is already an option in AP to skip these when listening).\r\n\nI like to add an idea mentioned in the issue above: **hide empty tabs** - that could be empty transcripts and especially nonexistent chapters, if only one tab remains the tablayout itself should probably be hidden.\r\n\r\nI think thats a sensible solution, to not crowd the AudioPlayer with empty tabs and require to user to swipe a thousand times to get to the desired tab, makes the UX clearer :)\n@tonytamsf Any idea how to implement the data store? Downloading all transcripts of all episodes could result in a huge amount of text to be stored. We already have the problem that the database is pretty big. I think it would be better to only store the URLs and then load the transcript when actually viewing the transcript page in AntennaPod. We could enable caching with okhttp to reduce the number of web requests. \n> @tonytamsf Any idea how to implement the data store? Downloading all transcripts of all episodes could result in a huge amount of text to be stored. We already have the problem that the database is pretty big. I think it would be better to only store the URLs and then load the transcript when actually viewing the transcript page in AntennaPod. We could enable caching with okhttp to reduce the number of web requests.\r\n\r\nI like your idea, there is no need to store transcription.  Depending on the user, they may not want to be downloading transcript using mobile data, so we might have to get user consent to use mobile to download transcript.\nWhy not storing transcript on file text on device? Same way episodes are stored. They would be removed along with episodes and it would allow to make them available like episodes are.\r\n\r\nEdit :\r\nAnd it won't clutter database except maybe to put a flag to know there is transcript downloaded. I am not sure it's even needed as all logics would be parallel to what is done for downloaded episodes.\nSounds like a good idea. When streaming, users need a data connection anyways. When downloading, we can download the transcripts, too. :+1:\n> Why not storing transcript on file text on device?\n\nI'm just wondering: this wouldn't hinder 'processing' the info (esp. timestamps, for # 4 in OP).\n\n> When downloading, we can download the transcripts, too\n\nJust to throw an idea out: couldn't this be done, but then in the db? As in, download & store in db when episode is downloaded; remove from dB when file is deleted? (Don't know if this would have any actual benefit, see above).\nI don't think storing and using text files would cause any problem : it is what video player does with srt files for subtitles.\nStoring it in the database but only for downloaded episodes should work :) Then we don't need to store the file path, we can just store the transcript directly.\nDon't know if you saw how Podverse implemented transcript with search. For reference there is a video of what they did : https://twitter.com/Podverse/status/1413642917760184325?s=19\r\n\r\nIMHO about their screen : \r\n- I would prefer timecode on left side and with a smaller font and using grey as text color. So time code would be there but won't distract your eyes when reading transcription\r\n- I wouldn't separate block like they did. It's like there is an empty line beetween each segment which is annoying when reading\nThanks for sharing that @Matth7878!\r\n\r\n> I would prefer timecode on left side and with a smaller font and using grey as text color\r\n\r\nFully agree\r\n\r\n> I wouldn't separate block like they did\r\n\r\nI understand your point, but we can't really merge sentences that are separated into two blocks I think:\r\n* we don't know where we can stitch parts together, and where a hard enter should be kept (in the interface). If there's no whitespace, it might still be complicated to read:\r\n![Schermafdruk van 2021-07-11 10-45-14](https://user-images.githubusercontent.com/11229646/125188759-38432280-e235-11eb-89f0-e0ce24a2ffff.png)\r\n* if we do stitch together the sentences, there might be a situation where one line on the screen covers three lines in the transcript file. Then we can only display the first timestamp, which can be problematic in some cases (e.g. when there is a line with `[silence]` that takes a minute - you wouldn't be able to jump to the bit after the silence).\r\n\nLet me take a stab at getting the podcast:transcript tag to download and stored.  Then we can work on the UI on the next step\n> Let me take a stab at getting the podcast:transcript tag to download and stored. Then we can work on the UI on the next step\r\n\r\nSorry I have been taking a break from AntennaPod.  I'm un-assigning myself until I get back\n\r\n> Sorry I have been taking a break from AntennaPod. I'm un-assigning myself until I get back\r\n\r\nI'm back with my beloved AP app. I'll start working on downloading the transcript\nAny thoughts about the support of all 4 content types in the `<podcast:transcript>` tag?\r\n\r\nSpec: https://github.com/Podcastindex-org/podcast-namespace/blob/main/transcripts/transcripts.md\r\n\r\n* HTML - this format has no or limited timecode - I recommend that we ignore this\r\n* JSON - Much more flexible - we should fully support this, I'm searching for sample podcast that use this format (not seeing it yet)\r\n* SRT - great for video or audio, max number of lines 2, max chars 32 - I recommend we support this fully\r\n* WebVTT - for HTML on the web, I recommend we don't support this\r\n\r\nExample: https://podnews.net/rss\r\n\r\n```\r\n<podcast:transcript url=\"https://podnews.net/audio/podnews230310.mp3.vtt\" type=\"text/vtt\" />\r\n<podcast:transcript url=\"https://podnews.net/audio/podnews230310.mp3.srt\" type=\"application/srt\" />\r\n<podcast:transcript url=\"https://podnews.net/audio/podnews230310.mp3.txt\" type=\"text/plain\" />\r\n<podcast:transcript url=\"https://podnews.net/audio/podnews230310.mp3.srt\" type=\"application/x-subrip\" rel=\"captions\" />\r\n```\r\n\r\nIt looks like Podnews also provides `text/pain` which is not in the Podcast 2.0 spec\r\n\r\n@jamescridland I am a loyal listener of Podnews, is there a reason you don't have JSON version of `podcast:transcript`?  \r\n\r\nExample: Podcasting 2.0 https://feeds.podcastindex.org/pc20.xml\r\n\r\nIt uses the SRT format \r\n`<podcast:transcript url=\"https://mp3s.nashownotes.com/PC20-125-Captions.srt\" type=\"application/srt\" rel=\"captions\"/>`\n@ByteHamster - do you have objections if I pull in this code to parse SRT files? https://github.com/gusthavosouza/SRTParser.\r\n\r\nI'm contacting the author about the missing license file his source code.\r\n\r\nIf you prefer I write my parser, I could do that.  It's not that hard.  Before I embark, I wanted to hear your opinion.\n> HTML - this format has no or limited timecode - I recommend that we ignore this\n\nAgreed.\n\nSupporting JSON & SRT is quite nice already.\n@tonytamsf I can't generate JSON transcripts - whisper.cpp is what I use, and it doesn't make them.\r\n\r\nI agree that supporting all four is redundant, and would agree with your suggestion to cease support for VTT. VTT seems to have been chosen because of support from libraries; but it seems to me that we are offering too many formats here for sensible support. It's not complicated to make an SRT using the same tools as that might make a VTT.\r\n\r\n(Edited) I was under the impression that support for HTML was as a simple link to a full web page with a transcript. This doesn't appear to be the case, and I believe that we should also remove this. So, we end up with (in preference order):\r\n\r\n1. JSON files for word-by-word closed-captioning, editing, etc.\r\n2. SRT files for closed-captioning (max 32 char length)\r\n\r\n(I shall also go and remove the TXT format from the Podnews feed; but will keep the VTT file there).\n> Any thoughts about the support of all 4 content types in the `<podcast:transcript>` tag?\r\n> \r\n> Spec: https://github.com/Podcastindex-org/podcast-namespace/blob/main/transcripts/transcripts.md\r\n> \r\n> * HTML - this format has no or limited timecode - I recommend that we ignore this\r\n> * JSON - Much more flexible - we should fully support this, I'm searching for sample podcast that use this format (not seeing it yet)\r\n> * SRT - great for video or audio, max number of lines 2, max chars 32 - I recommend we support this fully\r\n> * WebVTT - for HTML on the web, I recommend we don't support this\r\n> \r\n> Example: https://podnews.net/rss\r\n> \r\n> ```\r\n> <podcast:transcript url=\"https://podnews.net/audio/podnews230310.mp3.vtt\" type=\"text/vtt\" />\r\n> <podcast:transcript url=\"https://podnews.net/audio/podnews230310.mp3.srt\" type=\"application/srt\" />\r\n> <podcast:transcript url=\"https://podnews.net/audio/podnews230310.mp3.txt\" type=\"text/plain\" />\r\n> <podcast:transcript url=\"https://podnews.net/audio/podnews230310.mp3.srt\" type=\"application/x-subrip\" rel=\"captions\" />\r\n> ```\r\n> \r\n> It looks like Podnews also provides `text/pain` which is not in the Podcast 2.0 spec\r\n> \r\n> @jamescridland I am a loyal listener of Podnews, is there a reason you don't have JSON version of `podcast:transcript`?\r\n> \r\n> Example: Podcasting 2.0 https://feeds.podcastindex.org/pc20.xml\r\n> \r\n> It uses the SRT format `<podcast:transcript url=\"https://mp3s.nashownotes.com/PC20-125-Captions.srt\" type=\"application/srt\" rel=\"captions\"/>`\r\n\r\n@tonytamsf, @jamescridland, `text/plain` is mentioned [here](https://github.com/Podcastindex-org/podcast-namespace/blob/main/docs/1.0.md#transcript) but not [here](https://github.com/Podcastindex-org/podcast-namespace/blob/main/transcripts/transcripts.md).\nI don't get this removing supported formats business.  VTT is the only format supported natively by browsers, and like SRT+ in many ways but a proper w3c standard.  If some of the first apps to take a stab at implementing don't support all formats, that's on them (and will improve with time) - no need to penalize everyone else by removing valuable stuff from the spec.  We should encourage the server side to push as much signal out to the world as they can.\n> I don't get this removing supported formats business. VTT is the only format supported natively by browsers\r\n\r\nNote that this issue is about support for the transcript tag in AntennaPod. First I thought that HTML was pointless, but I see now that it has a (different) use case - outside of the scope of this issue.\r\n\r\nMaybe let's create a separate issue in the PC namespace repo about this wider (PC namespace) topic.\nAh, sorry - followed a clickbaity link from [podnews](https://podnews.net/update/size-matters), and thought this was referring to the spec itself!\r\n\r\n> [Should we drop support for VTT and even HTML file support](https://github.com/AntennaPod/AntennaPod/issues/4935#issuecomment-1465273529?utm_source=podnews.net&utm_medium=web&utm_campaign=podnews.net:2023-03-13) for the podcast:transcript tag?\r\n\n> do you have objections if I pull in this code to parse SRT files? https://github.com/gusthavosouza/SRTParser.\r\n\r\nIf the license allows that, it should be okay. Probably needs some changes, though, because we only want English comments and maybe don't need all the features.\n> because we only want English comments\r\n\r\nDo we? With 'comments' do you refer to the actual transcripts (subtitles)? If a user has their device in French and there are transcripts/subtitles available in French, why not use that instead.\r\n\r\nSide note on implementation: I would be in favour of storing the transcript 'on drive' for downloaded episodes. As we've discussed for chapters, it's probably too big for in the database, and retrieving it only on playtime causes issues like #6062.\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/podcast-subtitles/3365/4\n\n@keunes - I'm done with the data parsing for JSON and working on the SRT format now for `<podcast:transcript>`.  After I'm done with the data storage, I would like some mockups on how transcription would work in the AP app.\r\n\r\n1. How does transcription display while an episode is being played?  Does it by default hover as an overlay and users can click on the words to jump into a full timecode view?\r\n2. In the timecode full transcription view, I assume the user can scroll back and forward to view the transcription and tap on a timecode to jump into the audio?  Would each word highlight to follow along the audio?\r\n3. The user can copy and paste any portion transcript?\r\n4. Without the overlay of the words, can users jump to view the transcript before listening, how would that work?\r\n5. Propose Phase 2 : Can users search the transcripts in one episode, across all episodes and subscriptions?\nYeey. That's great news @tonytamsf!\n\nLet me try to reply to some of your questions:\n\n> How does transcription display while an episode is being played? Does it by default hover as an overlay and users can click on the words to jump into a full timecode view?\n\nBy default this 'live subtitling' should be enabled/visible in the full player, for discoverability (there are not yet many feeds with this tag, so we want to show it when it's available). It should be possible via a setting in the UI section to disable this. (I expect that someone at some point will ask to make this a setting at podcast level, e.g. to only turn it on for their language learning, but let's see.)\n\nWe'll need a mock-up for this. We can probably take inspiration from some of the other apps who have enabled this already. To make it work nicely, we might have to make some design/UI changes.\n\n> In the timecode full transcription view, I assume the user can scroll back and forward to view the transcription and tap on a timecode to jump into the audio?\n\nYes. We'll need a mock-up for this.\n\n> Would each word highlight to follow along the audio?\n\nDepends. It's not always possible at word-level. E.g. SRT/VTT does not \u2013 here I think we should highlight each fragment.\n\nIn any case, I think the highlighting should be quite subtle (and I'm wondering if it's acceptable if e.g. highlight colour is not visible to visually impaired/does not comply with accessibility standards). We'll need a mock-up for this.\n\nhttps://github.com/Podcastindex-org/podcast-namespace/blob/main/transcripts/transcripts.md\n\n(~~Which transcript file types do you support at thi point?~~ I see it's SRT and JSON.)\n\n>  The user can copy and paste any portion transcript?\n\nYes.\n\n> Without the overlay of the words, can users jump to view the transcript before listening, how would that work?\n\nYes, this should be possible. I made a proposal a long time ago here, following user feedback on a beta version: https://forum.antennapod.org/t/user-feedback-swipe-navigation-from-player-screen-2-3-beta/1119\n\nIt's probably a lot of work to implement, bit I still stand behind the UX concept.\n\n(As a back-up, there should probably be an entry in the overflow menu.)\n\n> Propose Phase 2 : Can users search the transcripts in one episode, across all episodes and subscriptions?\n\nThat would be cool indeed. Certainly *within* the current episode (e.g. to find the section where they talk about X). Global search is an entirely separate thing.\n> I made a proposal a long time ago here... It's probably a lot of work to implement, bit I still stand behind the UX concept. (As a back-up, there should probably be an entry in the overflow menu.)\r\n\r\nThat's outside the scope of this PR (and would need some discussion). For now, I would do the overflow button. There is enough to discuss about the subtitles dialog/page itself\nI have a working PR that can parse, scroll through the transcript while following the audio.   Feel free to download a test version and give some feedback. \r\n I use `Podnews Daily` to do my test https://github.com/AntennaPod/AntennaPod/pull/6710\r\n\r\nUnfortunately, after sampling podcasts that I am subscribed to, the state of the transcript format is still not super well supported.  Here is a sample of of 104 feeds\r\n\r\n# Podcasts sampling\r\n- Roblox Tech Talk - `text/plain` https://share.transistor.fm/s/39ce510f/transcript.txt\r\n   -  parsable with timecoees\r\n-  Dev Interrupted - `text/html` https://feeds.buzzsprout.com/1422892/10190284/transcript\r\n   - not parsable\r\n- The Method - json & 'text/html' https://feeds.buzzsprout.com/1859927/9638130/transcript\r\n   - html not parsable\r\n   - json is fine https://feeds.buzzsprout.com/1859927/9638130/transcript.json\r\n   - (only 2 episode)\r\n- Radical Candor - `application/x-subrip` https://freepodcasttranscription.com/transcription/5e6070b67882e784d6b5baf4b19976bb717f1115.srt\r\n   - parsable\r\n- Indie Bites - `text/plain` https://share.transistor.fm/s/6cdce2f8/transcript.txt (no timecodes)\r\n  - not parsable\r\n- The Golden Hour - `text/html` https://www.podcastone.com/episode/Someones-Getting-Tased--The-Golden-Hour-51-w/-Brendan-Schaub-Erik-Griffin--Chris-DElia?view=transcript\r\n   - not parsable\nHi, really exciting times for AntennaPod and Podcsting in general. I've been doing some research about the use of transcript in the Podcasting 2.0 namespace.\r\n- I've found that even these mime types being equivalent `text/srt` `application/srt` `application/x-subrip` most player don't support all 3, so in in a \"test\" feed I declare all for the same file. \r\n- SRT is the most used format, then JSON, VTT and TXT (but these are usually full transcripts, not subtitle with parsable timecodes)\r\n\r\nIn case is useful, I have a feed with different options of redirect/hosting with different formats and mime-types if you want to test different edge cases, as discussed here : https://github.com/podverse/podverse-web/issues/1168#issuecomment-1695231077\r\nProbably the redirect / hosting part is no problem here as that part was for testing CORS in different web players. (Gitlab Pages works best with web players than Archive if something is interested)\r\n\r\n```\r\nEpisode 16\r\nOp3+ archive.org + vtt only\r\n\r\nEpisode 15\r\nOp3+ gitlab + vtt only\r\n\r\nEpisode 09\r\nOp3 + gitlab + vtt\r\nOp3 + archive + srt\r\n\r\nEpisode 08 (without OP3)\r\nGitlab + vtt\r\nArchive + srt\r\n\r\nEpisode Episode 00\r\nOp3 + gitlab + vtt/srt\r\n\r\nAll others\r\nOP3 + archive + vtt/srt\r\n```\r\nA problem that I've found with some player, in case you want to take it into account, is that if there is first a transcript tag with a file that doesn't work, some player won't try the next tag that would work.\r\n\r\nFeed:\r\nhttps://kdeexpress.gitlab.io/feed\r\n\r\n**TL;NR**\r\n\r\nI would prioritize SRT parsing, then JSON and if there is no much trouble VTT given the similarities with SRT. \r\nFor `text/html` and `text/plain` I would either show a new screen with all the text just assuming that is the full transcript to read or just offer a link to be open in the web browser.\nI'd jump in here and say two things:\r\n\r\nThe accurate stat is [contained here](https://stats.podcastindex.org/hourly_counts.json) - which at the time of writing is: \r\n\r\n>    \"feedsWithTranscripts\": 38,255\r\n>    \"episodesWithTranscripts\": 1,379,606\r\n\r\nThere's obviously a chicken and egg scenario with support. If AntennaPod supports transcripts, it would be a significant benefit to podcasting as a whole, but also to the uptake of this feature. But you'll get considerable promotion when this is launched. (I will, as one guarantee, give you a headline story in Podnews.)\r\n\r\nSecondly; might I suggest you ideally support these in this format:\r\n\r\n1. JSON - this is accurate to the word level, and allows [this kind of highlighted transcript](https://www.steno.fm/show/9b024349-ccf0-5f69-a609-6b82873eab3c/episode/aHR0cHM6Ly9wb2RuZXdzLm5ldC91cGRhdGUvZ2Vuei1mYXN0ZXN0LWdyb3dpbmc=), where the individual word being said is highlighted on screen. That also allows you to lay out closed-captions in a very bespoke way - allowing you to properly wordwrap them. It also allows more features in future like clipping, where you could highlight a word or sentence, and have the app specifically clip that accurately.\r\n\r\n2. SRT - these are accurate to about 32 characters, and therefore the timing isn't as perfect as it could be. [It works like this](https://www.steno.fm/show/917393e3-1b1e-5cef-ace4-edaa54e1f810/episode/YTQ2OWE5ZmQtMzVlOC00MDNhLWIzMDUtZGEyNmU3MDE1ZjBh). \r\n\r\nI'd, frankly, not support TXT or HTML unless you really want to - my suspicion is that these are relatively poorly supported anyway. But it doesn't seem like a heavy lift to simply open these in a webview. (I'm also very unclear if anyone is using VTT.)\r\n\r\nI hope that helps a bit!\n> If AntennaPod supports transcripts\r\n\r\nThanks for chipping in @jamescridland - one of our contributors is already working on this functionality. Hope we can coordinate re your coverage when it gets released. :-)\r\n\r\n> JSON \u2026 That also allows you to lay out closed-captions in a very bespoke way - allowing you to properly wordwrap them\r\n\r\nSee, that's what I was thinking. But I'm also wondering: how. Let's say it is at word level, how do you wrap that into the traditional two lines neatly? Starting from the first word (with its time stamp) and fill up the two lines until the screen is full, and take the end-time of the last word as the end-time for these two lines? Do you 'hard break' when there's a comma, or a period? What about speaker changes?\r\n\r\nI feel that SRT - given that it's the provider's responsibility to make it work with the character limit - often will provide a more logical view (even if less accurate).\r\n\r\nEither way - I'm very happy that both SRT & JSON already can be fetched and parsed \ud83d\ude00\nThank you @jamescridland for the details, it is helpful.\n\nWhat would be helpful for me when I am implementing the transcript feature is to look at other Android apps that are supporting the transcript tag.  Do you recommend an app that has implemented this feature well and taken advantage of the JSON word level time code? \n[Podverse](https://github.com/podverse) could be a reference. [The web displays](https://podverse.fm/es/episode/hazS_hcJz) 1 word per line :-1: , but the mobile (-rn repo) app shows the full sentence :+1: . So I assume it's using a word level JSON.\r\nIn the Android app each line on sentences is a placeholder for the audio timestamps, not exactly a word by word. [Steno.fm](https://www.steno.fm/show/396d9ae0-da7e-5557-b894-b606231fa3ea/episode/QnV6enNwcm91dC0xMzgwNjg5Nw==) is 1 by 1, but I don't think it's open source :-1: \r\n\r\n![imagen](https://github.com/AntennaPod/AntennaPod/assets/2069735/ae51a17b-13b0-4928-934c-9c49b2156130)\r\n![imagen](https://github.com/AntennaPod/AntennaPod/assets/2069735/2d31a517-72df-4b48-9da9-00c957dc6f04)\r\n\n> What would be helpful for me when I am implementing the transcript feature is to look at other Android apps that are supporting the transcript tag.\n\n@tonytamsf Sorry for the silence on my end. I've been doing a comparative analysis of all the We/Android apps that support the transcript tag and will at some point this weekend share a couple of nice examples.\nHello,\r\n\r\nI've thought and designed a bit more over the weekend. Please find below some recordings of (web) apps that I particularly liked, and a link to some mock-ups I made.\r\n\r\nInspiration\r\n---\r\nI tested all Android & web-[apps listed on the Podcast Index website](https://podcastindex.org/apps?appTypes=podcast+player&elements=Transcript) that support the Transcript tag and are accessible without log-in. I always checked  episode [1601 - \"Unkool & The Gang\"](https://podcastindex.org/podcast/41504?episode=15754728488) of No agenda. It has [this SRT captions file](https://mp3s.nashownotes.com/NA-1601-Captions.srt). Here is [the podcast's RSS feed](https://feeds.noagendaassets.com/noagenda.xml).\r\n\r\n### Podfriend **\r\nCool because: has nicely designed subtitles, with different colours, and speaker images.\r\n\r\nhttps://github.com/AntennaPod/AntennaPod/assets/11229646/aa6d70d0-77d6-42dd-9d5a-ec7557145dd6\r\n\r\n### Steno **\r\ncool because: grouping of source content into blocks per speaker, highlighting background of actively playing blocks as well as selected block (when paused or searching)\r\n[Try for yourself](https://www.steno.fm/show/856cd618-7f34-57ea-9b84-3600f1f65e7f/episode/aHR0cDovLzE2MDEubm9hZ2VuZGFub3Rlcy5jb20=) - my recording is too big for GitHub.\r\n\r\n### Podfans *\r\ncool because: has up/down arrows in search bar, nice design of timestamps (thin + lighter colour - should try that in my mock-ups too, althgouh they only seem to use mm:ss, not hh)\r\n![Screenshot from 2023-10-29 23-16-03 podfans](https://github.com/AntennaPod/AntennaPod/assets/11229646/e94b019e-d7ba-4824-8c67-de9c5a9459a0)\r\n\r\n### Fountain *\r\ncool because: has a little (i) icon with info about the transcript timings - noting they \"might not be accurate if the podcaster has dynamic ads.\" --> not in mock-ups yet\r\n![Screenshot from 2023-10-29 23-09-47 Fountain](https://github.com/AntennaPod/AntennaPod/assets/11229646/007f0bdd-4fe6-40af-8100-a4cac7b4c1af)\r\n\r\n### Anytime Player *\r\ncool because: has 'follow transcript' toggle, the way scrolling position follows active block\r\n![Screenshot from 2023-10-29 23-13-14 anytime player](https://github.com/AntennaPod/AntennaPod/assets/11229646/350b356a-f936-4b2f-8a55-20c0aae2038d)\r\n\r\n### Podcast Addict\r\ncool because: has option in the player settings to (de)activate subtitles\r\n\r\nMock-up & general considerations\r\n---\r\n\r\nPlease find here the mock-ups I have so far: https://design.penpot.app/#/view/e357a320-7535-11eb-8a88-eb0147e048f5?page-id=eae2ba44-fe23-80be-8003-5736fde8c987&section=interactions&index=0&share-id=b509ea44-7222-80be-8003-5db588cbed16\r\n\r\nSome notes:\r\n* Several apps leverage speaker indication (either name + colon in SRT, or as metadata in JSON). It would be really neat if we can do that too. \r\n  * Steno 'collates' blocks - [Nathan explained how](https://mastodon.social/@keunes/111305523569815424).\r\n  * Podfriend & Anytime Player somehow connect speaker info from the subtitles with info from the `person` tags within the item (episode)\r\n```\r\n<podcast:person href=\"http://curry.com/\" img=\"https://upload.wikimedia.org/wikipedia/commons/thumb/d/d5/Adam_Curry_2016.jpg/440px-Adam_Curry_2016.jpg\" group=\"cast\" role=\"host\">Adam Curry</podcast:person>\r\n<podcast:person href=\"http://dvorak.org/blog\" img=\"https://speaking.com/wp-content/uploads/2018/09/John-Dvorak.jpg\" group=\"cast\" role=\"host\">John C Dvorak</podcast:person>\r\n```\r\n* I think we'll have to first identify if we have or can extract speakers, and adjust the design of the player & transcript screens for it. Yet maybe speaker indication (especially on the player screen) might be out of scope for now.\r\n* I kept the playback controls visible on purpose - I think it's handy to be able to pause and rewind when viewing the transcript.\r\n\r\n_The first set of screens you'll see are  in case there are speakers extracted/known, which can be displayed on the player screen. Followed by some screens where this is not the case. There's also some other details. Maybe it's best if we have a call @tonytamsf & @ByteHamster to see what's feasible for now._\n@keunes Thanks for the great research and screen casts of other players.   I can try to join the next community call about this topic if finding time is difficult \nWe'll be meeting to discuss the mock-ups Thursday 2 November at 21:00 CET, over at https://meet.antennapod.org/transcripts. Anyone interested in this UX review is welcome to join.\nAs discussed and agreed during the meeting:\r\n* implement as full-screen dialog (https://m3.material.io/components/dialogs/overview)\r\n* what to do with landscape player view? For now, easy implementation on the right-hand side.\r\n* store transcript SRT/JSON in filesystem\r\n* if there's word-level JSON without speaker:\r\n  * collate text blocks\r\n    * Sentence-based (using periods & question marks)\r\n    * If long pause, start new block\r\n    * If long single block without period, then break it up after x (30?) seconds\r\n  * combine highlighting in blocks of min. 1 second (e.g. 2 words) to avoid words being skipped due to 1-second refresh rate.\r\n\r\nDesign change to do:\r\n* tap on CC in player, open transcript dialog\r\n* setting to show/hide closed caption (TBC if in player settings or only in global>UI settings)\r\n\r\nIn separate PRs:\r\n* playback controls in transcript view\r\n* option to reach transcript from ep. detail page; show 'can't jump to postion' warning\r\n* Search in transcript\r\n* Speaker tag (parse & store; display in ep. details; display speaker photo in player screen)", "created_at": "2023-11-02T23:42:47Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6734, "instance_id": "AntennaPod__AntennaPod-6734", "issue_numbers": ["6728"], "base_commit": "01f1927770b65bb9052fedd40068770c8abf15b1", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/dialog/VariableSpeedDialog.java b/app/src/main/java/de/danoeh/antennapod/dialog/VariableSpeedDialog.java\nindex 987206743a..0367e717b2 100644\n--- a/app/src/main/java/de/danoeh/antennapod/dialog/VariableSpeedDialog.java\n+++ b/app/src/main/java/de/danoeh/antennapod/dialog/VariableSpeedDialog.java\n@@ -98,7 +98,7 @@ public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup c\n     }\n \n     private void addCurrentSpeed() {\n-        float newSpeed = controller.getCurrentPlaybackSpeedMultiplier();\n+        float newSpeed = speedSeekBar.getCurrentSpeed();\n         if (selectedSpeeds.contains(newSpeed)) {\n             Snackbar.make(addCurrentSpeedChip,\n                     getString(R.string.preset_already_exists, newSpeed), Snackbar.LENGTH_LONG).show();\n", "test_patch": "", "problem_statement": "Trying to add New Playback Speed Gives Error\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.1.1\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n14\n\n### Device model\n\nPixel 8\n\n### First occurred\n\nToday\n\n### Steps to reproduce\n\n1. Install Fresh Version on Pixel 8\r\n2. Go to playback settings\r\n3. Go to playback speed\r\n4. Try to add a speed other than 1x\r\n5. Error says that you already have 1x\n\n### Expected behaviour\n\nGive me my playback speeds. I had several, but I got a new phone and now I can't add them on my new phone\n\n### Current behaviour\n\n_No response_\n\n### Logs\n\n## Environment\r\nAndroid version: 14\r\nOS version: 5.15.110-android14-11-ga6d7915820a0-ab10726252\r\nAntennaPod version: 3.1.1\r\nModel: Pixel 8\r\nDevice: shiba\r\nProduct: shiba\r\n\r\nNo crash report recorded\n", "hints_text": "Hi @baker-nicholas\nThanks for chipping in, ad sorry to hear about this experience.\n\nI just tried and can confirm. Note that this is only present in the global settings; this does not affect the same bottom screen when opened from the full-screen player.\n\nProbably related: the initial state of the 'add speed' button is empty (has no speed value), while it does have a value whe the bottom screen is opened from the full-screen player.\nHi @keunes ,\r\nYou have mentioned that the bug is only in global settings, but I have discovered that it is also in the speed bottom screen of the full-screen player.\r\n\r\n<img width=\"350\" src=\"https://github.com/AntennaPod/AntennaPod/assets/61724808/d77076d8-7d62-48ba-9a17-14afddb8c678\" />\r\n<img width=\"350\" src=\"https://github.com/AntennaPod/AntennaPod/assets/61724808/4c8eb650-6163-4772-86bf-0d59788d5e27\" />\nI've experienced something similar. I deleted the 1.25 preset and added a 1.30 preset. Then when I deleted the 1.5 and tried to add a 2.0 preset, the app tells me that there already is a 1.30 preset. It's like once you setup the preset speed you want to add for the first time, and add it, any subsequent changes aren't logged and it just keeps the first one.\nHi @vinodpatildev\nI couldn't reproduce that but I trust it's happening for you.\n\nI see that you have prepared code that might fix it?", "created_at": "2023-10-30T16:42:10Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6732, "instance_id": "AntennaPod__AntennaPod-6732", "issue_numbers": ["6220"], "base_commit": "01f1927770b65bb9052fedd40068770c8abf15b1", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\nindex bf8cf77781..468051f37b 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n@@ -1714,7 +1714,7 @@ public void onPlayFromSearch(String query, Bundle extras) {\n         public void onPause() {\n             Log.d(TAG, \"onPause()\");\n             if (getStatus() == PlayerStatus.PLAYING) {\n-                pause(!UserPreferences.isPersistNotify(), true);\n+                pause(!UserPreferences.isPersistNotify(), false);\n             }\n         }\n \n", "test_patch": "", "problem_statement": "Android auto issue (pause button)\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n2.7.0\n\n### Where did you get the app from\n\nOther\n\n### Android version\n\nandroid 12\n\n### Device model\n\ns21\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\nFind any episode on android auto, click the item to play, and click the pause button on the playback interface. At this time, the playback interface is closed (the expectation is not to close, the state of the play button changes), and then click the item to play, although it can be played normally , but the playback interface opens first and then closes automatically (expect to open the playback interface and not close it)\n\n### Expected behaviour\n\n_No response_\n\n### Current behaviour\n\n_No response_\n\n### Logs\n\n_No response_\n", "hints_text": "I am seeing this to. Can probably help debug it if necessary.\n> Can probably help debug it if necessary.\n\n@harshad1 If you know how to debug this on your own, that would be great. If you're happy to help but don't know how, we'd probably need the guidance from one of the contributors.\nI'll root through the source code tomorrow and see if I make any headway.\nPossibly related to  #4448\nI have the a similar issue with my car although it's not Android Auto, just regular Bluetooth - after about 90 seconds any paused playback disappears from the car's screen and from my Wear watch.\r\nBUT if I press play on the car display it does reappear and resume.\nI don't really understand what it means `At this time, the playback interface is closed` , could anyone take a photo of what it looks like when `paused playback disappears` ?\nThis seems to have stopped happening to me. But what when this used to happen, it looked like antennapod after a fresh start (no playback controls at all in the bottom bar)\n@tangxiangpi Do you still have this issue?\nI have this same issue. When using Android Auto, when I pause it, the player disappears and the only way to unpause is to do it on my phone, rather than through my vehicle's touchscreen. \nRe @tonytamsf  https://github.com/AntennaPod/AntennaPod/issues/6220#issuecomment-1432571959:\r\n\r\nPlayback interface open:\r\n\r\n![Screenshot of Google Maps navigation with media player open showing paused AntennaPod](https://user-images.githubusercontent.com/1876931/220164452-b31a39e7-f179-42c3-a610-3743d728497c.png)\r\n\r\nPlayback interface closed:\r\n\r\n![Screenshot of Google Maps navigation with no media player](https://user-images.githubusercontent.com/1876931/220164744-71b5ad14-ae0f-4953-be65-c770b0e0899f.png)\r\n\r\nThis was tested with AntennaPod 2.7.1, on a fully patched Pixel 6 running Android 13.\r\n\r\nIn my case, pausing doesn't immediately hide the media player, but the play button *is* greyed out (as shown in the screenshot) so I can't resume playback from the navigation UI, only from the notification shade or via the physical play button in my car. \r\n\r\nAt the end of an episode, before the next episode can start, playback stops and the playback interface disappears completely for me as described in the OP, which is what you see in the last screenshot. (That specific behavior of playback stopping between episodes might be fixed by #6293 but it's not released yet so I haven't had a chance to test.)\r\n\r\nThis behavior does not occur with other applications, such as Audible. Only with AntennaPod.\nAntennaPod 3.0 now supports media resumption (see #6350)\nSo I finally got the update to 3.0.2 through F-Droid. Lots of nice features, and at least in my initial tests media controls do seem more consistent (though hard to tell for sure since the problem was kinda intermittent before).\r\n\r\nHowever, the issue [in my comment above](https://github.com/AntennaPod/AntennaPod/issues/6220#issuecomment-1437322543) where the play button becomes greyed out after pausing is still occurring. (And that particular problem *is* consistent.) Maybe I should submit a different issue for that since it does seem slightly different from what the OP described with the playback interface disappearing completely.\r\n\r\n**Update:** The issue with the button becoming greyed out doesn't seem to be happening to me anymore (now running 3.1.1). However based on what I've seen I believe this to be a totally separate issue from the one described in the OP. I was using Google Maps navigation, not Android Auto. The only remaining issue I have with that is #6533, which might not be related.\nI have _finally_ gotten around to digging into this and have made some progress.\r\n\r\nThe bug only occurs when one plays a streaming podcast. Downloaded podcasts do not cause it.\r\n\r\nSee the following (running 3.1.1 from the play store)\r\n\r\n![output2](https://github.com/AntennaPod/AntennaPod/assets/1940940/e4c7ca86-6d8a-413e-beb2-03cf31553c20)\r\n\r\n@ByteHamster Can we reopen this ticket please? Any ideas of where to look would be quite helpful.\r\n\r\n\nAfter a little investigation I am believe this is related `pause(..., reset::true)` being called [here](https://github.com/AntennaPod/AntennaPod/blob/develop/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java#L1765-L1771)\r\n\r\nTriggering a `reinit()`  from the LocalPsmp [pause](https://github.com/AntennaPod/AntennaPod/blob/develop/core/src/main/java/de/danoeh/antennapod/core/service/playback/LocalPSMP.java#L237-L265)\r\n\r\nWhy is a reinit() necessary for streaming media? It appears to kill the remote media player?\r\n\r\n \nSorry for the late reply @harshad1. Did you change the call and test a debug version? Or how did you come to the conclusion that this is the place where something goes wrong? To be honest, I don't know why we call `reinit` there. The call has been there in the code since 2013.\nI just tried a debug version this appears to resolve the issue. Unsure what side effects it may have\r\n\r\n![image](https://github.com/AntennaPod/AntennaPod/assets/1940940/f5b24d2a-3af2-4039-8ca1-1b0aae310a60)\r\n\r\nI am going to create a PR.\n> Or how did you come to the conclusion that this is the place where something goes wrong\r\n\r\nMostly by following the code. Whatever is happening needs to happen\r\n\r\n1. Only when using android auto\r\n2. Only when streaming.\r\n\r\nNarrowed the search space down a lot", "created_at": "2023-10-30T05:10:38Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6722, "instance_id": "AntennaPod__AntennaPod-6722", "issue_numbers": ["6497"], "base_commit": "69be89881a7ceb7938209a532859050ff96bb257", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/menuhandler/FeedItemMenuHandler.java b/app/src/main/java/de/danoeh/antennapod/menuhandler/FeedItemMenuHandler.java\nindex 4de53ce1e5..de4cec8fea 100644\n--- a/app/src/main/java/de/danoeh/antennapod/menuhandler/FeedItemMenuHandler.java\n+++ b/app/src/main/java/de/danoeh/antennapod/menuhandler/FeedItemMenuHandler.java\n@@ -154,7 +154,7 @@ public static boolean onMenuItemClicked(@NonNull Fragment fragment, int menuItem\n         } else if (menuItemId == R.id.mark_read_item) {\n             selectedItem.setPlayed(true);\n             DBWriter.markItemPlayed(selectedItem, FeedItem.PLAYED, true);\n-            if (SynchronizationSettings.isProviderConnected()) {\n+            if (!selectedItem.getFeed().isLocalFeed() && SynchronizationSettings.isProviderConnected()) {\n                 FeedMedia media = selectedItem.getMedia();\n                 // not all items have media, Gpodder only cares about those that do\n                 if (media != null) {\n@@ -170,7 +170,7 @@ public static boolean onMenuItemClicked(@NonNull Fragment fragment, int menuItem\n         } else if (menuItemId == R.id.mark_unread_item) {\n             selectedItem.setPlayed(false);\n             DBWriter.markItemPlayed(selectedItem, FeedItem.UNPLAYED, false);\n-            if (selectedItem.getMedia() != null) {\n+            if (!selectedItem.getFeed().isLocalFeed() && selectedItem.getMedia() != null) {\n                 EpisodeAction actionNew = new EpisodeAction.Builder(selectedItem, EpisodeAction.NEW)\n                         .currentTimestamp()\n                         .build();\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/sync/queue/SynchronizationQueueSink.java b/core/src/main/java/de/danoeh/antennapod/core/sync/queue/SynchronizationQueueSink.java\nindex 12559539fd..cfe3798a7a 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/sync/queue/SynchronizationQueueSink.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/sync/queue/SynchronizationQueueSink.java\n@@ -64,7 +64,7 @@ public static void enqueueEpisodePlayedIfSynchronizationIsActive(Context context\n         if (!SynchronizationSettings.isProviderConnected()) {\n             return;\n         }\n-        if (media.getItem() == null) {\n+        if (media.getItem() == null || media.getItem().getFeed().isLocalFeed()) {\n             return;\n         }\n         if (media.getStartPosition() < 0 || (!completed && media.getStartPosition() >= media.getPosition())) {\n", "test_patch": "", "problem_statement": "NextCloud GPodder Sync Failure and Timeout in Sync Service\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.0.2\n\n### Where did you get the app from\n\nF-Droid\n\n### Android version\n\n13 (One UI 5.1)\n\n### Device model\n\nSamsung Galaxy S22 Ultra SM-S908W\n\n### First occurred\n\n~5 days ago (not sure)\n\n### Steps to reproduce\n\nSync via NextCloud Gpodder Sync\n\n### Expected behaviour\n\nThe sync service should perform without timing out, ensuring that the synchronization process completes successfully.\n\n### Current behaviour\n\nI have encountered persistant sync failures, and upon inspecting the logs, I noticed that the sync service is timing out. However, when I checked the server log of my NextCloud instance, I found that all requests were returning a status code of 200, and there were no error logs present.\r\n\r\nFurther investigation led me to the NextCloud server database, where I discovered that the same 300 or so episode actions were being repeatedly updated.\r\n\r\nProposed Actions:\r\n\r\n- Increase the timeout value for syncing to prevent timeouts during the sync process.\r\n- Improve the sync failure message to provide more detailed information instead of the generic \"Failed (0 minutes ago, xx:xx)\" message.\n\n### Logs\n\njava.net.SocketTimeoutException: timeout\n", "hints_text": "Do you have an extremely slow server? AntennaPod uploads the episode actions in batches of 30. It is quite surprising that this takes more than 30 seconds. How long does the sync take on your device?\nI do indeed have a slower setup as I am hosting my NextCloud instance on a Synology NAS alongside other open-source services. Unfortunately, I don't know how to measure the exact duration of the sync process on my device.\r\n\r\nIt would be helpful to have the option to customize the batch quantity or timeout value in AntennaPod. This flexibility would allow users to adjust the sync process according to their specific server capabilities and network conditions, potentially improving the overall synchronization performance.\r\n\r\nThank you for bringing up these points, and I appreciate your understanding regarding the issue.\nI have same issue, I have reported it here as well: https://github.com/thrillfall/nextcloud-gpodder/issues/129\r\n\r\nUnsure where the issue really lies in, but only AntennaPod fails during syncing while for example Kasts does not.\r\n\r\n\nWell, it seems deleting all antennapod data and cache, then uninstalling and reinstalling fixed the synchronising. Did a logout/login with Kasts too.\r\n\r\nNow both clients seem to work as usual. If it happens again I will report here and in the above linked issue.\nI have a similar issue using the [micro-gpodder-server](https://github.com/bohwaz/micro-gpodder-server):\r\n\r\nSyncs end with the generic \"Failed (0 minutes ago, xx:xx)\" error message mentioned above. I am not sure if increasing the timeout would be a solution in my case, as I get the error only after a few seconds.  \r\n\r\nLooking at the database, I discovered that the server only ever receives 2 batches per sync. Strangely, the identical 60 episode actions are added each sync (over and over again, but with fresh timecodes). \r\n\r\nIs there anything that I can do to support a fix?\nP.S. Whenever AntennaPod tries a background sync, I now get a Toast message with a little more information: \"Unable to connect to Gpodder.net (code 400: Bad Request)\". Which is a bit strange, as 1. I am connecting to my own domain and server and not Gpodder.net, and 2. there are multiple situations where the server generates 400 errors, but all with different messages to this one.  \r\n\r\nThe servers error log shows these entries:\r\n\r\n```\r\nmyip - myname [24/Jul/2023:01:09:20 +0200] \"POST /api/2/auth/myname/login.json HTTP/1.0\" 200 48 \"-\" \"AntennaPod/3.1.0-beta3\" mydomain\r\nmyip - - [24/Jul/2023:01:09:21 +0200] \"GET /api/2/subscriptions/myname/antennapod.json?since=1690148951 HTTP/1.0\" 200 87 \"-\" \"AntennaPod/3.1.0-beta3\" mydomain\r\nmyip - - [24/Jul/2023:01:09:22 +0200] \"GET /api/2/episodes/myname.json?since=0 HTTP/1.0\" 200 122734 \"-\" \"AntennaPod/3.1.0-beta3\" mydomain\r\nmyip - - [24/Jul/2023:01:09:25 +0200] \"POST /api/2/episodes/myname.json HTTP/1.0\" 200 54 \"-\" \"AntennaPod/3.1.0-beta3\" mydomain\r\nmyip - - [24/Jul/2023:01:09:26 +0200] \"POST /api/2/episodes/myname.json HTTP/1.0\" 200 54 \"-\" \"AntennaPod/3.1.0-beta3\" mydomain\r\nmyip - - [24/Jul/2023:01:09:26 +0200] \"POST /api/2/episodes/myname.json HTTP/1.0\" 400 155 \"-\" \"AntennaPod/3.1.0-beta3\" mydomain\r\n```\r\n\r\nSo it seems that something goes wrong whenever AntennaPod is trying to send the third increment. \nI added some debugging and could identify what caused the error in my case. It was content from local folders like these: \r\n\r\n```\r\n {\r\n      \"podcast\": \"antennapod_local:content://com.android.externalstorage.documents/tree/primary%3AAudiobooks%2FYouTube\",\r\n      \"episode\": \"content://com.android.externalstorage.documents/tree/primary%3AAudiobooks%2FYouTube/document/primary%3AAudiobooks%2FYouTube%2FA%20B%20vs%20C%20D%20(CC_%20E%20%26%20F).m4a\",\r\n      \"guid\": \"bab6aedb-2e39-481a-9713-66196424e44b\",\r\n      \"action\": \"play\",\r\n      \"timestamp\": \"2023-07-24T07:20:36\",\r\n      \"started\": 6214,\r\n      \"position\": 6214,\r\n      \"total\": 6214,\r\n      \"device\": \"antennapod\"\r\n    }\r\n``` \r\n\r\nAfter deleting the content from local folders in AntennaPod, the sync finally worked! \\o/", "created_at": "2023-10-22T13:41:19Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6721, "instance_id": "AntennaPod__AntennaPod-6721", "issue_numbers": ["6706"], "base_commit": "0b7403e1ddd9d1ef2910d4ffabfb377fe3b11b3c", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/dialog/SleepTimerDialog.java b/app/src/main/java/de/danoeh/antennapod/dialog/SleepTimerDialog.java\nindex 8314382cbb..67eb74fbc5 100644\n--- a/app/src/main/java/de/danoeh/antennapod/dialog/SleepTimerDialog.java\n+++ b/app/src/main/java/de/danoeh/antennapod/dialog/SleepTimerDialog.java\n@@ -10,6 +10,7 @@\n import android.widget.Button;\n import android.widget.CheckBox;\n import android.widget.EditText;\n+import android.widget.ImageView;\n import android.widget.LinearLayout;\n import android.widget.TextView;\n \n@@ -110,12 +111,13 @@ public Dialog onCreateDialog(Bundle savedInstanceState) {\n         final CheckBox cbShakeToReset = content.findViewById(R.id.cbShakeToReset);\n         final CheckBox cbVibrate = content.findViewById(R.id.cbVibrate);\n         chAutoEnable = content.findViewById(R.id.chAutoEnable);\n-        final TextView changeTimesButton = content.findViewById(R.id.changeTimes);\n+        final ImageView changeTimesButton = content.findViewById(R.id.changeTimesButton);\n \n         cbShakeToReset.setChecked(SleepTimerPreferences.shakeToReset());\n         cbVibrate.setChecked(SleepTimerPreferences.vibrate());\n         chAutoEnable.setChecked(SleepTimerPreferences.autoEnable());\n         changeTimesButton.setEnabled(chAutoEnable.isChecked());\n+        changeTimesButton.setAlpha(chAutoEnable.isChecked() ? 1.0f : 0.5f);\n \n         cbShakeToReset.setOnCheckedChangeListener((buttonView, isChecked)\n                 -> SleepTimerPreferences.setShakeToReset(isChecked));\n@@ -125,6 +127,7 @@ public Dialog onCreateDialog(Bundle savedInstanceState) {\n                 -> {\n             SleepTimerPreferences.setAutoEnable(isChecked);\n             changeTimesButton.setEnabled(isChecked);\n+            changeTimesButton.setAlpha(isChecked ? 1.0f : 0.5f);\n         });\n         updateAutoEnableText();\n \ndiff --git a/app/src/main/res/layout/time_dialog.xml b/app/src/main/res/layout/time_dialog.xml\nindex 1a8f02c7c2..263ac0c9c8 100644\n--- a/app/src/main/res/layout/time_dialog.xml\n+++ b/app/src/main/res/layout/time_dialog.xml\n@@ -2,6 +2,7 @@\n <LinearLayout\n     xmlns:android=\"http://schemas.android.com/apk/res/android\"\n     xmlns:tools=\"http://schemas.android.com/tools\"\n+    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n     android:layout_width=\"match_parent\"\n     android:layout_height=\"wrap_content\"\n     android:orientation=\"vertical\"\n@@ -135,19 +136,28 @@\n             android:layout_height=\"wrap_content\"\n             android:text=\"@string/timer_vibration_label\" />\n \n-        <CheckBox\n-            android:id=\"@+id/chAutoEnable\"\n+        <LinearLayout\n             android:layout_width=\"match_parent\"\n             android:layout_height=\"wrap_content\"\n-            android:text=\"@string/auto_enable_label\" />\n+            android:orientation=\"horizontal\"\n+            android:weightSum=\"1\">\n \n-        <Button\n-            android:id=\"@+id/changeTimes\"\n-            android:layout_width=\"wrap_content\"\n-            android:layout_height=\"wrap_content\"\n-            android:text=\"@string/auto_enable_change_times\"\n-            android:layout_gravity=\"center\"\n-            style=\"@style/Widget.MaterialComponents.Button.TextButton\" />\n+            <CheckBox\n+                android:id=\"@+id/chAutoEnable\"\n+                android:layout_width=\"0dp\"\n+                android:layout_height=\"wrap_content\"\n+                android:layout_weight=\"1\"\n+                android:text=\"@string/auto_enable_label\" />\n+\n+            <ImageView\n+                android:id=\"@+id/changeTimesButton\"\n+                android:layout_width=\"wrap_content\"\n+                android:layout_height=\"match_parent\"\n+                android:contentDescription=\"@string/auto_enable_change_times\"\n+                android:background=\"?attr/selectableItemBackgroundBorderless\"\n+                app:srcCompat=\"@drawable/ic_settings\" />\n+\n+        </LinearLayout>\n \n     </LinearLayout>\n \n", "test_patch": "", "problem_statement": "Sleep timer automatic activation UI issues (buttons not visible)\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.1.0 (087770026)\n\n### Where did you get the app from\n\nF-Droid\n\n### Android version\n\nsomething old\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\nPlay podcast before 22pm.\n\n### Expected behaviour\n\nI expect that the sleep timer is always auto-enabled - like it was in previous versions.\n\n### Current behaviour\n\nSleep timer is only enabled after 22pm.\n\n### Logs\n\n_No response_\n", "hints_text": "Hi @rkta\nA recent version added an option to automatically activate the sleep timer in a given interval. This is inactive by default, can you maybe check if you perhaps activated it by chance?\nOn Fri, Oct 13, 2023 at 03:44:04AM -0700, Keunes wrote:\n> Hi @rkta A recent version added an option to automatically activate\n> the sleep timer in a given interval. This is inactive by default, can\n> you maybe check if you perhaps activated it by chance?\n\nHi Keunes,\n\nbefore opening this bug report I searched through the settings, the\ndocumentation and also the forums.\n\nI could not find anything where to configure this. I did not configure\nit. The behaviour occurred after an upgrade.\n\nWhere should I look?\n\nThe default is to activate only 22-06.\r\n\r\n> Where should I look?\r\n\r\nPress the sleep timer icon on the player page \nMy screen when opening the sleep timer dialog while the timer is off:\r\n![Screenshot_20231016-133947_AntennaPod](https://github.com/AntennaPod/AntennaPod/assets/25690347/363656a8-6ced-4a97-8c61-9bf7aadb4a75)\r\n\r\nMy screen when the sleep timer is running:\r\n![Screenshot_20231016-133204_AntennaPod](https://github.com/AntennaPod/AntennaPod/assets/25690347/79c5f61b-2581-4b95-81b6-f1edaa316355)\r\n\r\nMy screen when the sleep timer is off and I pressed a button to remove the keyboard:\r\n![Screenshot_20231016-133155_AntennaPod](https://github.com/AntennaPod/AntennaPod/assets/25690347/01e6acdf-65c3-442b-bb16-282601191005)\r\n\r\nSearching for sleep in the documentation shows 'Sorry, nothing found :('.\r\n\r\nI still consider this a bug.\n@rkta I am correct you expect to have sleep timer always turning on no matter what time is it and not only after 22h?\r\nIf so you have to tap change time in sleep timer settings to make it always auto turn. Right know seeing your screenshots it is set to only turn on between 22h and 6h.\r\nIf not ignore my comment !\nOn Tue, Oct 17, 2023 at 09:37:48PM -0700, Matth78 wrote:\n\n> @rkta I am correct you expect to have sleep timer always turning on no matter what time is it and not only after 22h?\n> If so you have to tap change time in sleep timer settings to make it always auto turn. Right know seeing your screenshots it is set to only turn on between 22h and 6h.\n> If not ignore my comment !\n\nThe problem was, that I did not see the 'Change time' button because it\nwas either covered by my keyboard or it was not there because the sleep\ntimer was running.\n\nLooking into the settings and the documentation did not help.\n\nOnly after being told here where to look I double checked and had a look\nwith the sleep timer disabled.\n\nIn the meantime I changed the setting and got my expected behavior.", "created_at": "2023-10-22T11:34:54Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6719, "instance_id": "AntennaPod__AntennaPod-6719", "issue_numbers": ["6398"], "base_commit": "e9d190da1b925a48df0e88466c3661e4d3d07cf0", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/fragment/SearchFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/SearchFragment.java\nindex 307ef0af1a..30822e5c5b 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/SearchFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/SearchFragment.java\n@@ -24,6 +24,8 @@\n import androidx.recyclerview.widget.RecyclerView;\n \n import com.google.android.material.chip.Chip;\n+import com.google.android.material.snackbar.Snackbar;\n+import com.leinardi.android.speeddial.SpeedDialView;\n \n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n@@ -31,11 +33,13 @@\n import de.danoeh.antennapod.adapter.EpisodeItemListAdapter;\n import de.danoeh.antennapod.adapter.HorizontalFeedListAdapter;\n import de.danoeh.antennapod.core.menuhandler.MenuItemUtils;\n+import de.danoeh.antennapod.databinding.MultiSelectSpeedDialBinding;\n import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FeedItemEvent;\n import de.danoeh.antennapod.event.playback.PlaybackPositionEvent;\n import de.danoeh.antennapod.event.PlayerStatusEvent;\n import de.danoeh.antennapod.event.UnreadItemsUpdateEvent;\n+import de.danoeh.antennapod.fragment.actions.EpisodeMultiSelectActionHandler;\n import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.core.storage.FeedSearcher;\n@@ -63,7 +67,7 @@\n /**\n  * Performs a search operation on all feeds or one specific feed and displays the search result.\n  */\n-public class SearchFragment extends Fragment {\n+public class SearchFragment extends Fragment implements EpisodeItemListAdapter.OnSelectModeListener {\n     private static final String TAG = \"SearchFragment\";\n     private static final String ARG_QUERY = \"query\";\n     private static final String ARG_FEED = \"feed\";\n@@ -81,6 +85,9 @@ public class SearchFragment extends Fragment {\n     private SearchView searchView;\n     private Handler automaticSearchDebouncer;\n     private long lastQueryChange = 0;\n+    private MultiSelectSpeedDialBinding speedDialBinding;\n+    private boolean isOtherViewInFoucus = false;\n+\n \n     /**\n      * Create a new SearchFragment that searches all feeds.\n@@ -133,8 +140,8 @@ public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup c\n                              @Nullable Bundle savedInstanceState) {\n         View layout = inflater.inflate(R.layout.search_fragment, container, false);\n         setupToolbar(layout.findViewById(R.id.toolbar));\n+        speedDialBinding = MultiSelectSpeedDialBinding.bind(layout);\n         progressBar = layout.findViewById(R.id.progressBar);\n-\n         recyclerView = layout.findViewById(R.id.recyclerView);\n         recyclerView.setRecycledViewPool(((MainActivity) getActivity()).getRecycledViewPool());\n         registerForContextMenu(recyclerView);\n@@ -142,9 +149,13 @@ public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup c\n             @Override\n             public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMenuInfo menuInfo) {\n                 super.onCreateContextMenu(menu, v, menuInfo);\n+                if (!inActionMode()) {\n+                    menu.findItem(R.id.multi_select).setVisible(true);\n+                }\n                 MenuItemUtils.setOnClickListeners(menu, SearchFragment.this::onContextItemSelected);\n             }\n         };\n+        adapter.setOnSelectModeListener(this);\n         recyclerView.setAdapter(adapter);\n         recyclerView.addOnScrollListener(new LiftOnScrollListener(layout.findViewById(R.id.appbar)));\n \n@@ -180,7 +191,7 @@ public void onCreateContextMenu(ContextMenu contextMenu, View view,\n             search();\n         }\n         searchView.setOnQueryTextFocusChangeListener((view, hasFocus) -> {\n-            if (hasFocus) {\n+            if (hasFocus && !isOtherViewInFoucus) {\n                 showInputMethod(view.findFocus());\n             }\n         });\n@@ -195,6 +206,30 @@ public void onScrollStateChanged(@NonNull RecyclerView recyclerView, int newStat\n                 }\n             }\n         });\n+        speedDialBinding.fabSD.setOverlayLayout(speedDialBinding.fabSDOverlay);\n+        speedDialBinding.fabSD.inflate(R.menu.episodes_apply_action_speeddial);\n+        speedDialBinding.fabSD.setOnChangeListener(new SpeedDialView.OnChangeListener() {\n+            @Override\n+            public boolean onMainActionSelected() {\n+                return false;\n+            }\n+\n+            @Override\n+            public void onToggleChanged(boolean open) {\n+                if (open && adapter.getSelectedCount() == 0) {\n+                    ((MainActivity) getActivity())\n+                            .showSnackbarAbovePlayer(R.string.no_items_selected, Snackbar.LENGTH_SHORT);\n+                    speedDialBinding.fabSD.close();\n+                }\n+            }\n+        });\n+        speedDialBinding.fabSD.setOnActionSelectedListener(actionItem -> {\n+            new EpisodeMultiSelectActionHandler((MainActivity) getActivity(), actionItem.getId())\n+                    .handleAction(adapter.getSelectedItems());\n+            adapter.endSelectMode();\n+            return true;\n+        });\n+\n         return layout;\n     }\n \n@@ -260,8 +295,13 @@ public boolean onContextItemSelected(@NonNull MenuItem item) {\n             return true;\n         }\n         FeedItem selectedItem = adapter.getLongPressedItem();\n-        if (selectedItem != null && FeedItemMenuHandler.onMenuItemClicked(this, item.getItemId(), selectedItem)) {\n-            return true;\n+        if (selectedItem != null) {\n+            if (adapter.onContextItemSelected(item)) {\n+                return true;\n+            }\n+            if (FeedItemMenuHandler.onMenuItemClicked(this, item.getItemId(), selectedItem)) {\n+                return true;\n+            }\n         }\n         return super.onContextItemSelected(item);\n     }\n@@ -393,4 +433,30 @@ private void searchOnline() {\n         ((MainActivity) getActivity()).loadChildFragment(\n                 OnlineSearchFragment.newInstance(CombinedSearcher.class, query));\n     }\n+\n+    @Override\n+    public void onStartSelectMode() {\n+        searchViewFocusOff();\n+        speedDialBinding.fabSD.removeActionItemById(R.id.remove_from_inbox_batch);\n+        speedDialBinding.fabSD.removeActionItemById(R.id.remove_from_queue_batch);\n+        speedDialBinding.fabSD.removeActionItemById(R.id.delete_batch);\n+        speedDialBinding.fabSD.setVisibility(View.VISIBLE);\n+    }\n+\n+    @Override\n+    public void onEndSelectMode() {\n+        speedDialBinding.fabSD.close();\n+        speedDialBinding.fabSD.setVisibility(View.GONE);\n+        searchViewFocusOn();\n+    }\n+\n+    private void searchViewFocusOff() {\n+        isOtherViewInFoucus = true;\n+        searchView.clearFocus();\n+    }\n+\n+    private void searchViewFocusOn() {\n+        isOtherViewInFoucus = false;\n+        searchView.requestFocus();\n+    }\n }\ndiff --git a/app/src/main/res/layout/search_fragment.xml b/app/src/main/res/layout/search_fragment.xml\nindex ff5de0f9fe..17f679cc3b 100644\n--- a/app/src/main/res/layout/search_fragment.xml\n+++ b/app/src/main/res/layout/search_fragment.xml\n@@ -61,4 +61,7 @@\n         android:paddingTop=\"12dp\"\n         android:paddingHorizontal=\"@dimen/additional_horizontal_spacing\" />\n \n+    <include\n+        layout=\"@layout/multi_select_speed_dial\" />\n+\n </RelativeLayout>\n", "test_patch": "", "problem_statement": "Multi-select actions on search results\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n2.7.1 (d5f0ef244)\n\n### Where did you get the app from\n\nF-Droid\n\n### Problem you may be having, or feature you want\n\nA number of podcasts I subscribe to are effectively all-in-one feeds from a publisher/network. Within a given field or industry, they have daily news, and then one or two episodes a week on a major topic/theme, eg. \"Top 10 daily food news stories\", \"the weekly cheese newsletter\", \"this week in fruit\", \"steak-of-the-week\", \"fish, it's not just for fridays\", etc. Thankfully, all these different themes have a distinct prefix that I can search for.\r\n\r\nI do a search, get a list of all the matching episodes, and no episodes that didn't match my search. Awesome.\r\n\r\nUnfortunately when I long press on one of the search results to trigger multi-select, my only choices are \"Mark as played\", \"Add to Queue\", \"Add to Favorites\", and \"Share\".\r\n\r\nps. searching for issues relating to search is frustrating because all issues contain the word search in their template..\n\n### Suggested solution\n\nI would like to see multi-select for search results of a podcast's episodes, the same way multi-select works in the podcast view.\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "The implementation of this feature seems pretty simple as already an implementation exists on the podcast view page. But I'm curious about how this feels from the user's side. Like, should we close the keyboard when multi-select kicks in so they can see all the podcasts and the options menu? What do you think? @ByteHamster @keunes @ckuethe\nHi @ckuethe , I understood the issue , can I start my first open source contribution with this..?\n@ShashidharYes Sure, if you think this would be interesting to work on, go right ahead.\r\n\r\n@cdhiraj40 Yes, I'd say close the keyboard when multi-select kicks in. Tapping on the results implies that I've found a reasonable set of probably relevant matches and I'm no longer interested in interacting with the keyboard; Now I'm interested in operating on the results. If I don't like the results I can tap in the search field and change my search criteria.\nHello,\r\n\r\nI am able to recreate the problem, and it seems it has not been fixed. \r\nI will start working on this issue and will try to create pull-request when I am done.\n@ByteHamster Hello, I just want to confirm that I am able to be assigned this issue since it has the 'Good first issue' label.\r\nI have also been working on this issue and will make a pull request soon as well. ", "created_at": "2023-10-21T17:16:12Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6704, "instance_id": "AntennaPod__AntennaPod-6704", "issue_numbers": ["6480"], "base_commit": "c732ecba8b27860713b65d12e2e43b13d8801701", "patch": "diff --git a/playback/base/src/main/java/de/danoeh/antennapod/playback/base/PlaybackServiceMediaPlayer.java b/playback/base/src/main/java/de/danoeh/antennapod/playback/base/PlaybackServiceMediaPlayer.java\nindex ef15cef1d5..73b38c00c9 100644\n--- a/playback/base/src/main/java/de/danoeh/antennapod/playback/base/PlaybackServiceMediaPlayer.java\n+++ b/playback/base/src/main/java/de/danoeh/antennapod/playback/base/PlaybackServiceMediaPlayer.java\n@@ -215,6 +215,10 @@ public synchronized PlayerStatus getPlayerStatus() {\n     public abstract int getSelectedAudioTrack();\n \n     public void skip() {\n+        if (getPosition() < 1000) {\n+            Log.d(TAG, \"Ignoring skip, is in first second of playback\");\n+            return;\n+        }\n         endPlayback(false, true, true, true);\n     }\n \n", "test_patch": "", "problem_statement": "Skip Episode button needs timeout after changing episodes to prevent accidentally skipping the wrong episode\n### Checklist\r\n\r\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\r\n\r\n### App version\r\n\r\n2.7.1\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Problem you may be having, or feature you want\r\n\r\nNear the end of an episode, I wanted to skip the last few seconds of the episode (Episode A).  I reached for the Skip Episode button, and as my finger neared the screen, the episode I intended to skip reached its end, and the next episode in the queue (Episode B) began playing.  It was too late to stop my finger from touching the button, so rather than skipping Episode A, the player skipped Episode B.\r\n\r\n\r\n\r\n### Suggested solution\r\n\r\nThis is an unfortunately common problem in UI/UX across software and platforms nowadays.  But it's not a new problem, and solutions have been deployed for some time.  For example, in Web browsers, it's common for certain dialogs to have their buttons disabled for a few seconds after the dialog appears, to prevent users from clicking a button accidentally (e.g. a dialog to add a browser extension or execute a downloaded file).\r\n\r\nSo I'd suggest that the Skip Episode button be disabled for 2-3 seconds after the player changes to a different episode.\r\n\r\nAnother option could be to allow the action of skipping an episode to be undone, but that would likely be more complicated to implement and more complicated for the user to use.\r\n\r\nThanks for your work on AntennaPod.\n", "hints_text": "Sorry, we can't reliably add that feature. For many media files, we can't determine the exact duration (because of how some podcasters encode their files) and would then end up blocking the button far too long (which would lead to people complaining).\n@ByteHamster Forgive me, but I'm not sure if you understood my request.  I'm asking for this:\r\n\r\nThat the Skip Episode button be disabled for 2-3 seconds *after* the player changes to a different episode.  It shouldn't be necessary to calculate the duration or remaining time of an episode in order to do that.\r\n\r\nAs well, this behavior could be made optional, so if a few users actually do have episodes in their feed that are less than 3 seconds long and want to be able to rapidly skip them in the queue (which seems very unlikely, but anyway), they could do so.\r\n\r\nAs well, the duration of the button's being disabled could be configurable.  Even a 1-second delay would have prevented the mistake that happened to me.\r\n\r\nThe problem with not implementing a safeguard like this is that there is no way to undo skipping an episode, and it can take substantial time and effort to dig through a list of old, \"Marked as played\" episodes in order to find the one that was unintentionally skipped, unmark it as played, and add it back to the queue.\r\n\r\nAnd as the three upvotes by other users show, this doesn't just happen to me.  There are probably hundreds of users that this has happened to, users who don't even know that this issue tracker exists.\r\n\r\nSo, please reconsider this feature.  Without it, it's all too easy to essentially corrupt the queue, which has likely been carefully crafted by the user.\r\n\r\nThanks for your work.\n> Skip Episode button be disabled for 2-3 seconds after the player changes to a different episode\n\nTo be honest, 1 second is already largely enough. The reflex (muscle activity) you're describing takes less than a second and would probably initiate right at the end of an episode the latest.\n\n> this behavior could be made optional\n> \u2026\n> the duration of the button's being disabled could be configurable\n\nAntennaPod aims to be simple I use. Settings make the app more complex, and should only be introduced to enable major (conflicting) use-cases. That's not the case here so it's not worth adding a setting.\n> > Skip Episode button be disabled for 2-3 seconds after the player changes to a different episode\r\n> \r\n> To be honest, 1 second is already largely enough. The reflex (muscle activity) you're describing takes less than a second and would probably initiate right at the end of an episode the latest.\r\n\r\nAgreed, even 1 second would have prevented this accident.\r\n\r\n(FWIW, it wasn't a reflex--my finger was already moving toward the button when the episode changed.)\r\n\r\n> \r\n> > this behavior could be made optional\r\n> > \u2026\r\n> > the duration of the button's being disabled could be configurable\r\n> \r\n> AntennaPod aims to be simple I use. Settings make the app more complex, and should only be introduced to enable major (conflicting) use-cases. That's not the case here so it's not worth adding a setting.\r\n\r\nAlthough I'm an Emacs user and accustomed to lots of options, I agree.  :)\r\n\r\nThanks for your work!\n> FWIW, it wasn't a reflex\n\nYeah, wrong term :-)", "created_at": "2023-10-12T16:37:30Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6703, "instance_id": "AntennaPod__AntennaPod-6703", "issue_numbers": ["6696"], "base_commit": "c38b2634582d74fe3a7c7a4273cac8750dbc7e7d", "patch": "diff --git a/app/src/main/res/layout/horizontal_itemlist_item.xml b/app/src/main/res/layout/horizontal_itemlist_item.xml\nindex bb45d0ca16..3384096476 100644\n--- a/app/src/main/res/layout/horizontal_itemlist_item.xml\n+++ b/app/src/main/res/layout/horizontal_itemlist_item.xml\n@@ -33,7 +33,6 @@\n                 <LinearLayout\n                     android:layout_width=\"wrap_content\"\n                     android:layout_height=\"wrap_content\"\n-                    android:background=\"#dddddd\"\n                     android:orientation=\"vertical\">\n \n                     <FrameLayout\n@@ -87,7 +86,7 @@\n                         android:layout_gravity=\"bottom\"\n                         android:max=\"100\"\n                         style=\"?attr/progressBarTheme\"\n-                        tools:background=\"@android:color/holo_blue_light\" />\n+                        tools:progress=\"50\" />\n \n                 </LinearLayout>\n \n", "test_patch": "", "problem_statement": "Poorly visible progress bar colour in 'Continue listening' on 'Home' screen\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.1.1\n\n### Where did you get the app from\n\nF-Droid\n\n### Android version\n\nAndroid 13, SparkOS\n\n### Device model\n\nRedmi Note 10 Pro (sweet)\n\n### First occurred\n\nseems to be a continous issue\n\n### Steps to reproduce\n\n1. play a podcast for some time\r\n2. go to 'Home' screen with dynamic colours dark mode enabled\r\n3. progress bar is poorly visible due to pastel colours atop gray background **(red pen in the screenshot)**\n\n### Expected behaviour\n\nI believe the gray progress bar colour should be replaced with the dark gray from the bottom drawer player (green pen in the screenshot).\n\n### Current behaviour\n\n### Dark mode with dynamic colours but no full black\r\nGreen pen is the poorly visible progress bar, green pen is good.\r\n![Screenshot_20231011-103133_AntennaPod~2](https://github.com/AntennaPod/AntennaPod/assets/60844668/9712c25f-9387-411d-89d6-d4cd39c08511)\r\n### Dark mode with dynamic colours with full black\r\n![Screenshot_20231011-103705_AntennaPod](https://github.com/AntennaPod/AntennaPod/assets/60844668/c0e81448-9300-4b60-a061-e972b5679831)\r\n### Light mode without dynamic colours (good visibility, blue on gray)\r\n![Screenshot_20231011-103652_AntennaPod](https://github.com/AntennaPod/AntennaPod/assets/60844668/9a138d0d-8afb-42db-9d80-91136a31ef29)\r\n### Dark mode without dynamic colours but no full black (good visibility)\r\n![Screenshot_20231011-103644_AntennaPod](https://github.com/AntennaPod/AntennaPod/assets/60844668/697bf6aa-3f4a-4d7c-9d6d-7c097b4be705)\r\n### Dark mode without dynamic colours with full black (good visibility)\r\n![Screenshot_20231011-103633_AntennaPod](https://github.com/AntennaPod/AntennaPod/assets/60844668/bd071eb4-42f0-4d97-81de-617b6c846662)\r\n\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2023-10-12T16:13:32Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6684, "instance_id": "AntennaPod__AntennaPod-6684", "issue_numbers": ["6594"], "base_commit": "da200f61391d033c307879c9411c3c2752838980", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/dialog/VariableSpeedDialog.java b/app/src/main/java/de/danoeh/antennapod/dialog/VariableSpeedDialog.java\nindex 185120c0ed..0a964f0c6c 100644\n--- a/app/src/main/java/de/danoeh/antennapod/dialog/VariableSpeedDialog.java\n+++ b/app/src/main/java/de/danoeh/antennapod/dialog/VariableSpeedDialog.java\n@@ -23,7 +23,6 @@\n import org.greenrobot.eventbus.Subscribe;\n import org.greenrobot.eventbus.ThreadMode;\n \n-import java.text.DecimalFormat;\n import java.text.DecimalFormatSymbols;\n import java.util.ArrayList;\n import java.util.Collections;\n@@ -32,7 +31,6 @@\n \n public class VariableSpeedDialog extends BottomSheetDialogFragment {\n     private SpeedSelectionAdapter adapter;\n-    private final DecimalFormat speedFormat;\n     private PlaybackController controller;\n     private final List<Float> selectedSpeeds;\n     private PlaybackSpeedSeekBar speedSeekBar;\n@@ -41,7 +39,6 @@ public class VariableSpeedDialog extends BottomSheetDialogFragment {\n     public VariableSpeedDialog() {\n         DecimalFormatSymbols format = new DecimalFormatSymbols(Locale.US);\n         format.setDecimalSeparator('.');\n-        speedFormat = new DecimalFormat(\"0.00\", format);\n         selectedSpeeds = new ArrayList<>(UserPreferences.getPlaybackSpeedArray());\n     }\n \n@@ -69,7 +66,7 @@ public void onStop() {\n     @Subscribe(threadMode = ThreadMode.MAIN)\n     public void updateSpeed(SpeedChangedEvent event) {\n         speedSeekBar.updateSpeed(event.getNewSpeed());\n-        addCurrentSpeedChip.setText(speedFormat.format(event.getNewSpeed()));\n+        addCurrentSpeedChip.setText(String.format(Locale.getDefault(), \"%1$.2f\", event.getNewSpeed()));\n     }\n \n     @Nullable\n@@ -94,6 +91,7 @@ public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup c\n         addCurrentSpeedChip.setCloseIconVisible(true);\n         addCurrentSpeedChip.setCloseIconResource(R.drawable.ic_add);\n         addCurrentSpeedChip.setOnCloseIconClickListener(v -> addCurrentSpeed());\n+        addCurrentSpeedChip.setCloseIconContentDescription(getString(R.string.add_preset));\n         addCurrentSpeedChip.setOnClickListener(v -> addCurrentSpeed());\n         return root;\n     }\n@@ -125,7 +123,7 @@ public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {\n         public void onBindViewHolder(@NonNull ViewHolder holder, int position) {\n             float speed = selectedSpeeds.get(position);\n \n-            holder.chip.setText(speedFormat.format(speed));\n+            holder.chip.setText(String.format(Locale.getDefault(), \"%1$.2f\", speed));\n             holder.chip.setOnLongClickListener(v -> {\n                 selectedSpeeds.remove(speed);\n                 UserPreferences.setPlaybackSpeedArray(selectedSpeeds);\ndiff --git a/app/src/main/java/de/danoeh/antennapod/view/viewholder/HorizontalItemViewHolder.java b/app/src/main/java/de/danoeh/antennapod/view/viewholder/HorizontalItemViewHolder.java\nindex f809de175f..21a29a920e 100644\n--- a/app/src/main/java/de/danoeh/antennapod/view/viewholder/HorizontalItemViewHolder.java\n+++ b/app/src/main/java/de/danoeh/antennapod/view/viewholder/HorizontalItemViewHolder.java\n@@ -65,6 +65,7 @@ public void bind(FeedItem item) {\n                 .load();\n         title.setText(item.getTitle());\n         date.setText(DateFormatter.formatAbbrev(activity, item.getPubDate()));\n+        date.setContentDescription(DateFormatter.formatForAccessibility(item.getPubDate()));\n         ItemActionButton actionButton = ItemActionButton.forItem(item);\n         actionButton.configure(secondaryActionIcon, secondaryActionIcon, activity);\n         secondaryActionIcon.setFocusable(false);\ndiff --git a/app/src/main/res/layout/addfeed.xml b/app/src/main/res/layout/addfeed.xml\nindex 8082b9c8a1..f2b7bed635 100644\n--- a/app/src/main/res/layout/addfeed.xml\n+++ b/app/src/main/res/layout/addfeed.xml\n@@ -20,6 +20,7 @@\n             android:minHeight=\"?attr/actionBarSize\"\n             android:theme=\"?attr/actionBarTheme\"\n             app:title=\"@string/add_feed_label\"\n+            app:navigationContentDescription=\"@string/toolbar_back_button_content_description\"\n             app:navigationIcon=\"?homeAsUpIndicator\" />\n \n     </com.google.android.material.appbar.AppBarLayout>\ndiff --git a/app/src/main/res/layout/episodes_list_fragment.xml b/app/src/main/res/layout/episodes_list_fragment.xml\nindex 3d59bcddc4..19b21f4f6d 100644\n--- a/app/src/main/res/layout/episodes_list_fragment.xml\n+++ b/app/src/main/res/layout/episodes_list_fragment.xml\n@@ -16,6 +16,7 @@\n             android:id=\"@+id/toolbar\"\n             android:layout_width=\"match_parent\"\n             android:layout_height=\"?attr/actionBarSize\"\n+            app:navigationContentDescription=\"@string/toolbar_back_button_content_description\"\n             app:navigationIcon=\"?homeAsUpIndicator\" />\n \n         <TextView\ndiff --git a/app/src/main/res/layout/feed_item_list_fragment.xml b/app/src/main/res/layout/feed_item_list_fragment.xml\nindex a4288ef2d0..1072924d5c 100644\n--- a/app/src/main/res/layout/feed_item_list_fragment.xml\n+++ b/app/src/main/res/layout/feed_item_list_fragment.xml\n@@ -39,6 +39,7 @@\n                 android:minHeight=\"?attr/actionBarSize\"\n                 android:layout_alignParentTop=\"true\"\n                 app:navigationIcon=\"?homeAsUpIndicator\"\n+                app:navigationContentDescription=\"@string/toolbar_back_button_content_description\"\n                 app:layout_collapseMode=\"pin\" />\n \n         </com.google.android.material.appbar.CollapsingToolbarLayout>\ndiff --git a/app/src/main/res/layout/feeditemlist_header.xml b/app/src/main/res/layout/feeditemlist_header.xml\nindex 45f8e8ff89..0b7181cf25 100644\n--- a/app/src/main/res/layout/feeditemlist_header.xml\n+++ b/app/src/main/res/layout/feeditemlist_header.xml\n@@ -16,55 +16,6 @@\n         android:orientation=\"horizontal\"\n         android:gravity=\"bottom\">\n \n-        <LinearLayout\n-            android:layout_width=\"match_parent\"\n-            android:layout_height=\"wrap_content\"\n-            android:padding=\"8dp\"\n-            android:background=\"@color/image_readability_tint\"\n-            android:orientation=\"horizontal\"\n-            android:layout_alignParentBottom=\"true\">\n-\n-            <View\n-                android:layout_width=\"148dp\"\n-                android:layout_height=\"match_parent\" />\n-\n-            <ImageButton\n-                android:id=\"@+id/butShowInfo\"\n-                android:layout_width=\"40dp\"\n-                android:layout_height=\"40dp\"\n-                android:background=\"?attr/selectableItemBackground\"\n-                android:contentDescription=\"@string/show_info_label\"\n-                android:layout_marginLeft=\"-8dp\"\n-                android:layout_marginStart=\"-8dp\"\n-                android:scaleType=\"fitXY\"\n-                android:padding=\"8dp\"\n-                app:srcCompat=\"@drawable/ic_info_white\"\n-                tools:visibility=\"visible\" />\n-\n-            <ImageButton\n-                android:id=\"@+id/butFilter\"\n-                android:layout_width=\"40dp\"\n-                android:layout_height=\"40dp\"\n-                android:background=\"?attr/selectableItemBackground\"\n-                android:contentDescription=\"@string/filter\"\n-                android:scaleType=\"fitXY\"\n-                android:padding=\"8dp\"\n-                app:srcCompat=\"@drawable/ic_filter_white\"\n-                tools:visibility=\"visible\" />\n-\n-            <ImageButton\n-                android:id=\"@+id/butShowSettings\"\n-                android:layout_width=\"40dp\"\n-                android:layout_height=\"40dp\"\n-                android:background=\"?attr/selectableItemBackground\"\n-                android:contentDescription=\"@string/show_feed_settings_label\"\n-                android:scaleType=\"fitXY\"\n-                android:padding=\"8dp\"\n-                app:srcCompat=\"@drawable/ic_settings_white\"\n-                tools:visibility=\"visible\" />\n-\n-        </LinearLayout>\n-\n         <ImageView\n             android:layout_width=\"12dp\"\n             android:layout_height=\"12dp\"\n@@ -138,6 +89,55 @@\n \n         </LinearLayout>\n \n+        <LinearLayout\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"wrap_content\"\n+            android:padding=\"8dp\"\n+            android:background=\"@color/image_readability_tint\"\n+            android:orientation=\"horizontal\"\n+            android:layout_alignParentBottom=\"true\">\n+\n+            <View\n+                android:layout_width=\"148dp\"\n+                android:layout_height=\"match_parent\" />\n+\n+            <ImageButton\n+                android:id=\"@+id/butShowInfo\"\n+                android:layout_width=\"40dp\"\n+                android:layout_height=\"40dp\"\n+                android:background=\"?attr/selectableItemBackground\"\n+                android:contentDescription=\"@string/show_info_label\"\n+                android:layout_marginLeft=\"-8dp\"\n+                android:layout_marginStart=\"-8dp\"\n+                android:scaleType=\"fitXY\"\n+                android:padding=\"8dp\"\n+                app:srcCompat=\"@drawable/ic_info_white\"\n+                tools:visibility=\"visible\" />\n+\n+            <ImageButton\n+                android:id=\"@+id/butFilter\"\n+                android:layout_width=\"40dp\"\n+                android:layout_height=\"40dp\"\n+                android:background=\"?attr/selectableItemBackground\"\n+                android:contentDescription=\"@string/filter\"\n+                android:scaleType=\"fitXY\"\n+                android:padding=\"8dp\"\n+                app:srcCompat=\"@drawable/ic_filter_white\"\n+                tools:visibility=\"visible\" />\n+\n+            <ImageButton\n+                android:id=\"@+id/butShowSettings\"\n+                android:layout_width=\"40dp\"\n+                android:layout_height=\"40dp\"\n+                android:background=\"?attr/selectableItemBackground\"\n+                android:contentDescription=\"@string/show_feed_settings_label\"\n+                android:scaleType=\"fitXY\"\n+                android:padding=\"8dp\"\n+                app:srcCompat=\"@drawable/ic_settings_white\"\n+                tools:visibility=\"visible\" />\n+\n+        </LinearLayout>\n+\n     </RelativeLayout>\n \n     <com.joanzapata.iconify.widget.IconTextView\ndiff --git a/app/src/main/res/layout/fragment_itunes_search.xml b/app/src/main/res/layout/fragment_itunes_search.xml\nindex e4d2d7492a..4dd767d584 100644\n--- a/app/src/main/res/layout/fragment_itunes_search.xml\n+++ b/app/src/main/res/layout/fragment_itunes_search.xml\n@@ -21,6 +21,7 @@\n             android:minHeight=\"?attr/actionBarSize\"\n             android:theme=\"?attr/actionBarTheme\"\n             app:title=\"@string/discover\"\n+            app:navigationContentDescription=\"@string/toolbar_back_button_content_description\"\n             app:navigationIcon=\"?homeAsUpIndicator\" />\n \n     </com.google.android.material.appbar.AppBarLayout>\ndiff --git a/app/src/main/res/layout/fragment_subscriptions.xml b/app/src/main/res/layout/fragment_subscriptions.xml\nindex f60f925abd..ac40bf5a4a 100644\n--- a/app/src/main/res/layout/fragment_subscriptions.xml\n+++ b/app/src/main/res/layout/fragment_subscriptions.xml\n@@ -17,6 +17,7 @@\n             android:layout_width=\"match_parent\"\n             android:layout_height=\"?attr/actionBarSize\"\n             app:title=\"@string/subscriptions_label\"\n+            app:navigationContentDescription=\"@string/toolbar_back_button_content_description\"\n             app:navigationIcon=\"?homeAsUpIndicator\" />\n \n         <LinearLayout\ndiff --git a/app/src/main/res/layout/home_section.xml b/app/src/main/res/layout/home_section.xml\nindex a8885b514b..8a1e21907c 100644\n--- a/app/src/main/res/layout/home_section.xml\n+++ b/app/src/main/res/layout/home_section.xml\n@@ -39,6 +39,7 @@\n         android:layout_marginLeft=\"8dp\"\n         android:background=\"?attr/selectableItemBackgroundBorderless\"\n         android:visibility=\"gone\"\n+        android:contentDescription=\"@string/shuffle_suggestions\"\n         app:layout_constraintBottom_toBottomOf=\"@id/barrier\"\n         app:layout_constraintTop_toTopOf=\"parent\"\n         app:layout_constraintStart_toEndOf=\"@id/titleLabel\"\ndiff --git a/app/src/main/res/layout/queue_fragment.xml b/app/src/main/res/layout/queue_fragment.xml\nindex 67b8eda80a..50a0337fb6 100644\n--- a/app/src/main/res/layout/queue_fragment.xml\n+++ b/app/src/main/res/layout/queue_fragment.xml\n@@ -17,6 +17,7 @@\n             android:id=\"@+id/toolbar\"\n             android:layout_width=\"match_parent\"\n             android:layout_height=\"?attr/actionBarSize\"\n+            app:navigationContentDescription=\"@string/toolbar_back_button_content_description\"\n             app:navigationIcon=\"?homeAsUpIndicator\"\n             app:title=\"@string/queue_label\" />\n \ndiff --git a/app/src/main/res/layout/search_fragment.xml b/app/src/main/res/layout/search_fragment.xml\nindex 0d4ea65565..ff5de0f9fe 100644\n--- a/app/src/main/res/layout/search_fragment.xml\n+++ b/app/src/main/res/layout/search_fragment.xml\n@@ -19,6 +19,7 @@\n             android:minHeight=\"?attr/actionBarSize\"\n             android:theme=\"?attr/actionBarTheme\"\n             app:title=\"@string/search_label\"\n+            app:navigationContentDescription=\"@string/toolbar_back_button_content_description\"\n             app:navigationIcon=\"?homeAsUpIndicator\" />\n \n     </com.google.android.material.appbar.AppBarLayout>\ndiff --git a/app/src/main/res/layout/simple_list_fragment.xml b/app/src/main/res/layout/simple_list_fragment.xml\nindex fc08dccf2f..bcc43cfcc5 100644\n--- a/app/src/main/res/layout/simple_list_fragment.xml\n+++ b/app/src/main/res/layout/simple_list_fragment.xml\n@@ -15,6 +15,7 @@\n             android:id=\"@+id/toolbar\"\n             android:layout_width=\"match_parent\"\n             android:layout_height=\"?attr/actionBarSize\"\n+            app:navigationContentDescription=\"@string/toolbar_back_button_content_description\"\n             app:navigationIcon=\"?homeAsUpIndicator\" />\n \n     </com.google.android.material.appbar.AppBarLayout>\ndiff --git a/app/src/main/res/layout/subscription_item.xml b/app/src/main/res/layout/subscription_item.xml\nindex 0b689fa28b..d9a2800c12 100644\n--- a/app/src/main/res/layout/subscription_item.xml\n+++ b/app/src/main/res/layout/subscription_item.xml\n@@ -82,6 +82,7 @@\n                 android:gravity=\"start\"\n                 android:textColor=\"?android:attr/textColorPrimary\"\n                 android:lines=\"2\"\n+                android:importantForAccessibility=\"no\"\n                 tools:text=\"@sample/episodes.json/data/title\" />\n \n         </LinearLayout>\ndiff --git a/ui/common/build.gradle b/ui/common/build.gradle\nindex ff4bf83cf6..0603eb711d 100644\n--- a/ui/common/build.gradle\n+++ b/ui/common/build.gradle\n@@ -4,6 +4,8 @@ plugins {\n apply from: \"../../common.gradle\"\n \n dependencies {\n+    implementation project(\":ui:i18n\")\n+\n     annotationProcessor \"androidx.annotation:annotation:$annotationVersion\"\n     implementation \"androidx.appcompat:appcompat:$appcompatVersion\"\n     implementation \"androidx.viewpager2:viewpager2:$viewPager2Version\"\ndiff --git a/ui/common/src/main/res/layout/pager_fragment.xml b/ui/common/src/main/res/layout/pager_fragment.xml\nindex a5bf6c76e0..00525d57cf 100644\n--- a/ui/common/src/main/res/layout/pager_fragment.xml\n+++ b/ui/common/src/main/res/layout/pager_fragment.xml\n@@ -16,6 +16,7 @@\n             android:id=\"@+id/toolbar\"\n             android:layout_width=\"match_parent\"\n             android:layout_height=\"?attr/actionBarSize\"\n+            app:navigationContentDescription=\"@string/toolbar_back_button_content_description\"\n             app:navigationIcon=\"?homeAsUpIndicator\" />\n \n     </com.google.android.material.appbar.AppBarLayout>\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 73423f4b5c..a83ada10aa 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -685,6 +685,8 @@\n     <string name=\"play_chapter\">Play chapter</string>\n     <string name=\"prev_chapter\">Previous chapter</string>\n     <string name=\"next_chapter\">Next chapter</string>\n+    <string name=\"shuffle_suggestions\">Shuffle suggestions</string>\n+    <string name=\"add_preset\">Add preset</string>\n \n     <!-- Feed settings/information screen -->\n     <string name=\"authentication_label\">Authentication</string>\n", "test_patch": "", "problem_statement": "Talkback Reports Back/Navigate-Up Button as \"Unlabeled Button\"\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.1.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\nAndroid 12\n\n### Device model\n\nNokia 5.3 \n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\nWith Talkback turned on, going to subscriptions>XYZPod> brings up the podcast page.\r\nThe first item that Talkback has the focus on is the back/navigate-up button,  Talkback reports this as \"unlabeled\".\r\nThe same issue is also present when going to Subscriptions>Statistics> page.\n\n### Expected behaviour\n\nWhen Talkback's focus is on the navigate-up/back button, Talkback should report it as \"back button\".\n\n### Current behaviour\n\n_No response_\n\n### Logs\n\n_No response_\n", "hints_text": "Hello maintainers and community,\r\nThis is my first time submitting an issue here. I've tried to provide all the necessary details, but if there are any discrepancies or mistakes in my submission, please forgive me. I'm open to feedback.\nhello sir I would like to work on this issue@VoidCrater\r\n\r\n\r\n\nYou are already working on #6653, @shreyanshR7. Only one issue at a time.\nI found this issue as quick fix issue so I fixed it.@ByteHamster", "created_at": "2023-10-03T18:21:46Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6679, "instance_id": "AntennaPod__AntennaPod-6679", "issue_numbers": ["6653"], "base_commit": "c732ecba8b27860713b65d12e2e43b13d8801701", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/adapter/SubscriptionsRecyclerAdapter.java b/app/src/main/java/de/danoeh/antennapod/adapter/SubscriptionsRecyclerAdapter.java\nindex bfa37b6000..284f3e4681 100644\n--- a/app/src/main/java/de/danoeh/antennapod/adapter/SubscriptionsRecyclerAdapter.java\n+++ b/app/src/main/java/de/danoeh/antennapod/adapter/SubscriptionsRecyclerAdapter.java\n@@ -216,6 +216,7 @@ public class SubscriptionViewHolder extends RecyclerView.ViewHolder {\n         private final FrameLayout selectView;\n         private final CheckBox selectCheckbox;\n         private final CardView card;\n+        private final View errorIcon;\n \n         public SubscriptionViewHolder(@NonNull View itemView) {\n             super(itemView);\n@@ -226,6 +227,7 @@ public SubscriptionViewHolder(@NonNull View itemView) {\n             selectView = itemView.findViewById(R.id.selectContainer);\n             selectCheckbox = itemView.findViewById(R.id.selectCheckBox);\n             card = itemView.findViewById(R.id.outerContainer);\n+            errorIcon = itemView.findViewById(R.id.errorIcon);\n         }\n \n         public void bind(NavDrawerData.DrawerItem drawerItem) {\n@@ -249,9 +251,11 @@ public void bind(NavDrawerData.DrawerItem drawerItem) {\n                 textAndImageCombined = feed.isLocalFeed() && feed.getImageUrl() != null\n                         && feed.getImageUrl().startsWith(Feed.PREFIX_GENERATIVE_COVER);\n                 coverLoader.withUri(feed.getImageUrl());\n+                errorIcon.setVisibility(feed.hasLastUpdateFailed() ? View.VISIBLE : View.GONE);\n             } else {\n                 textAndImageCombined = true;\n                 coverLoader.withResource(R.drawable.ic_tag);\n+                errorIcon.setVisibility(View.GONE);\n             }\n             if (UserPreferences.shouldShowSubscriptionTitle()) {\n                 // No need for fallback title when already showing title\ndiff --git a/app/src/main/res/layout/nav_listitem.xml b/app/src/main/res/layout/nav_listitem.xml\nindex e0a7f9ed04..47d6e6c006 100644\n--- a/app/src/main/res/layout/nav_listitem.xml\n+++ b/app/src/main/res/layout/nav_listitem.xml\n@@ -57,6 +57,7 @@\n         android:layout_toStartOf=\"@id/txtvCount\"\n         android:layout_toLeftOf=\"@id/txtvCount\"\n         android:visibility=\"gone\"\n+        android:contentDescription=\"@string/refresh_failed_msg\"\n         app:srcCompat=\"@drawable/ic_error\"\n         app:tint=\"?attr/icon_red\"\n         tools:text=\"!\" />\ndiff --git a/app/src/main/res/layout/subscription_item.xml b/app/src/main/res/layout/subscription_item.xml\nindex 0b689fa28b..e4b228504e 100644\n--- a/app/src/main/res/layout/subscription_item.xml\n+++ b/app/src/main/res/layout/subscription_item.xml\n@@ -6,7 +6,8 @@\n     xmlns:tools=\"http://schemas.android.com/tools\"\n     android:layout_width=\"wrap_content\"\n     android:layout_height=\"wrap_content\"\n-    android:padding=\"4dp\">\n+    android:padding=\"4dp\"\n+    tools:layout_width=\"150dp\">\n \n     <androidx.cardview.widget.CardView\n         android:id=\"@+id/outerContainer\"\n@@ -70,6 +71,18 @@\n                         android:textSize=\"14sp\"\n                         style=\"@style/TextPill\" />\n \n+                    <ImageView\n+                        android:id=\"@+id/errorIcon\"\n+                        android:layout_width=\"24dp\"\n+                        android:layout_height=\"24dp\"\n+                        android:layout_alignParentEnd=\"true\"\n+                        android:layout_alignBottom=\"@id/coverImage\"\n+                        android:layout_margin=\"8dp\"\n+                        android:visibility=\"gone\"\n+                        android:contentDescription=\"@string/refresh_failed_msg\"\n+                        app:srcCompat=\"@drawable/ic_error\"\n+                        tools:visibility=\"visible\" />\n+\n                 </RelativeLayout>\n \n             </androidx.cardview.widget.CardView>\ndiff --git a/core/src/main/res/drawable/ic_error.xml b/core/src/main/res/drawable/ic_error.xml\nindex 402f224b21..fc4fa2b9ad 100644\n--- a/core/src/main/res/drawable/ic_error.xml\n+++ b/core/src/main/res/drawable/ic_error.xml\n@@ -4,6 +4,9 @@\n     android:viewportWidth=\"24\"\n     android:viewportHeight=\"24\">\n     <path\n-        android:fillColor=\"#FFFFFF\"\n+        android:fillColor=\"?android:attr/colorBackground\"\n+        android:pathData=\"M12 1C5.9 1 1 5.9 1 12s4.9 11 11 11 11-4.9 11-11S18.1 1 12 1z\" />\n+    <path\n+        android:fillColor=\"?attr/icon_red\"\n         android:pathData=\"M12,2C6.48,2 2,6.48 2,12s4.48,10 10,10 10,-4.48 10,-10S17.52,2 12,2zM13,17h-2v-2h2v2zM13,13h-2L11,7h2v6z\" />\n </vector>\n", "test_patch": "", "problem_statement": "Add warning icon to subscription list if last refresh failed\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.1.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Problem you may be having, or feature you want\n\nWhen the refresh of a subscription fails, the side drawer shows a warning icon next to the subscription. The subscriptions screen doesn't.\n\n### Suggested solution\n\nThe subscriptions screen should display a warning icon on the failed subscription as well.\n\n### Screenshots / Drawings / Technical details\n\nPart of #6609, also see discussion there. This is easier to implement than the whole of #6609, so I'm factoring this out into its own issue.\n", "hints_text": "please assign this issue to me , I want to work on this issue @ByteHamster .\r\n\r\n\nNo need to assign, your comment that you started working on it is enough :)\nok\r\n\ncan you please share some screenshots of the problem?@ByteHamster\r\n", "created_at": "2023-10-02T19:10:40Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6675, "instance_id": "AntennaPod__AntennaPod-6675", "issue_numbers": ["6669"], "base_commit": "e466bba01366ef5e96563d4acaea87e951a620c4", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\nindex 3812339bdc..d8225b6c20 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\n@@ -539,19 +539,24 @@ private void handleUpdatedFeedStatus() {\n             viewBinding.subscribeButton.setText(R.string.open_podcast);\n             if (didPressSubscribe) {\n                 didPressSubscribe = false;\n+\n+                Feed feed1 = DBReader.getFeed(getFeedId());\n+                FeedPreferences feedPreferences = feed1.getPreferences();\n                 if (UserPreferences.isEnableAutodownload()) {\n                     boolean autoDownload = viewBinding.autoDownloadCheckBox.isChecked();\n-\n-                    Feed feed1 = DBReader.getFeed(getFeedId());\n-                    FeedPreferences feedPreferences = feed1.getPreferences();\n                     feedPreferences.setAutoDownload(autoDownload);\n-                    DBWriter.setFeedPreferences(feedPreferences);\n \n                     SharedPreferences preferences = getSharedPreferences(PREFS, MODE_PRIVATE);\n                     SharedPreferences.Editor editor = preferences.edit();\n                     editor.putBoolean(PREF_LAST_AUTO_DOWNLOAD, autoDownload);\n                     editor.apply();\n                 }\n+                if (username != null) {\n+                    feedPreferences.setUsername(username);\n+                    feedPreferences.setPassword(password);\n+                }\n+                DBWriter.setFeedPreferences(feedPreferences);\n+\n                 openFeed();\n             }\n         } else {\n", "test_patch": "", "problem_statement": "Basic Auth Requires Entering User/Pass Twice\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.1.1\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\n_No response_\n\n### First occurred\n\nNow\n\n### Steps to reproduce\n\n1. Add an RSS feed manually that is protected by basic auth\r\n2. Enter basic auth info\r\n3. Subscribe to feed\r\n4. Try to download a file\n\n### Expected behaviour\n\nDownload the files, like I just gave you the password for this literally five second ago, and putting a password on a whole directory is pretty typical\n\n### Current behaviour\n\nAntennapod show 401 unauthorized by each file. \r\n\r\nThere is a workaround for this, which is to go into the podcast's settings and again enter the user/password. This is a nonobvious expectation, which I only figured out after trying to search through the documentation at https://antennapod.org/documentation/ (no hits for \"password\" or \"authentication\" at all), doing about five googles, and finally finding it in bug #2268 where someone mentions it in passing. \r\n\r\nCould you please consider either:\r\n\r\nA. Documenting basic auth in the documentation, including this workaround\r\nor\r\nB. Have the app use the password given at the time of subscribing not just for the RSS feed, but for the files in it. \r\n\r\nThanks for maintaining awesome open source software. \n\n### Logs\n\nn/a\n", "hints_text": "", "created_at": "2023-10-01T12:28:48Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6670, "instance_id": "AntennaPod__AntennaPod-6670", "issue_numbers": ["6664"], "base_commit": "8a011badd3253dde83769ec9dc3be3129528e4b7", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\nindex d8225b6c20..c5d656aa02 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\n@@ -17,7 +17,6 @@\n import android.view.ViewGroup;\n import android.widget.AdapterView;\n import android.widget.ArrayAdapter;\n-import android.widget.TextView;\n import android.widget.Toast;\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n@@ -37,6 +36,7 @@\n import de.danoeh.antennapod.core.storage.DBTasks;\n import de.danoeh.antennapod.core.service.playback.PlaybackServiceInterface;\n import de.danoeh.antennapod.core.util.DownloadErrorLabel;\n+import de.danoeh.antennapod.databinding.OnlinefeedviewHeaderBinding;\n import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FeedListUpdateEvent;\n import de.danoeh.antennapod.event.PlayerStatusEvent;\n@@ -100,6 +100,7 @@ public class OnlineFeedViewActivity extends AppCompatActivity {\n     private static final String TAG = \"OnlineFeedViewActivity\";\n     private static final String PREFS = \"OnlineFeedViewActivityPreferences\";\n     private static final String PREF_LAST_AUTO_DOWNLOAD = \"lastAutoDownload\";\n+    private static final int DESCRIPTION_MAX_LINES_COLLAPSED = 4;\n \n     private volatile List<Feed> feeds;\n     private String selectedDownloadUrl;\n@@ -117,6 +118,7 @@ public class OnlineFeedViewActivity extends AppCompatActivity {\n     private Disposable parser;\n     private Disposable updater;\n \n+    private OnlinefeedviewHeaderBinding headerBinding;\n     private OnlinefeedviewActivityBinding viewBinding;\n \n     @Override\n@@ -128,8 +130,10 @@ protected void onCreate(Bundle savedInstanceState) {\n         setContentView(viewBinding.getRoot());\n \n         viewBinding.transparentBackground.setOnClickListener(v -> finish());\n+        viewBinding.closeButton.setOnClickListener(view -> finish());\n         viewBinding.card.setOnClickListener(null);\n         viewBinding.card.setCardBackgroundColor(ThemeUtils.getColorFromAttr(this, R.attr.colorSurface));\n+        headerBinding = OnlinefeedviewHeaderBinding.inflate(getLayoutInflater());\n \n         String feedUrl = null;\n         if (getIntent().hasExtra(ARG_FEEDURL)) {\n@@ -416,14 +420,10 @@ private void showFeedInformation(final Feed feed, Map<String, String> alternateF\n \n         viewBinding.backgroundImage.setColorFilter(new LightingColorFilter(0xff828282, 0x000000));\n \n-        View header = View.inflate(this, R.layout.onlinefeedview_header, null);\n-\n-        viewBinding.listView.addHeaderView(header);\n+        viewBinding.listView.addHeaderView(headerBinding.getRoot());\n         viewBinding.listView.setSelector(android.R.color.transparent);\n         viewBinding.listView.setAdapter(new FeedItemlistDescriptionAdapter(this, 0, feed.getItems()));\n \n-        TextView description = header.findViewById(R.id.txtvDescription);\n-\n         if (StringUtils.isNotBlank(feed.getImageUrl())) {\n             Glide.with(this)\n                     .load(feed.getImageUrl())\n@@ -445,7 +445,7 @@ private void showFeedInformation(final Feed feed, Map<String, String> alternateF\n \n         viewBinding.titleLabel.setText(feed.getTitle());\n         viewBinding.authorLabel.setText(feed.getAuthor());\n-        description.setText(HtmlToPlainText.getPlainText(feed.getDescription()));\n+        headerBinding.txtvDescription.setText(HtmlToPlainText.getPlainText(feed.getDescription()));\n \n         viewBinding.subscribeButton.setOnClickListener(v -> {\n             if (feedInFeedlist()) {\n@@ -467,13 +467,12 @@ private void showFeedInformation(final Feed feed, Map<String, String> alternateF\n             viewBinding.autoDownloadCheckBox.setChecked(preferences.getBoolean(PREF_LAST_AUTO_DOWNLOAD, true));\n         }\n \n-        final int MAX_LINES_COLLAPSED = 10;\n-        description.setMaxLines(MAX_LINES_COLLAPSED);\n-        description.setOnClickListener(v -> {\n-            if (description.getMaxLines() > MAX_LINES_COLLAPSED) {\n-                description.setMaxLines(MAX_LINES_COLLAPSED);\n+        headerBinding.txtvDescription.setMaxLines(DESCRIPTION_MAX_LINES_COLLAPSED);\n+        headerBinding.txtvDescription.setOnClickListener(v -> {\n+            if (headerBinding.txtvDescription.getMaxLines() > DESCRIPTION_MAX_LINES_COLLAPSED) {\n+                headerBinding.txtvDescription.setMaxLines(DESCRIPTION_MAX_LINES_COLLAPSED);\n             } else {\n-                description.setMaxLines(2000);\n+                headerBinding.txtvDescription.setMaxLines(2000);\n             }\n         });\n \ndiff --git a/app/src/main/java/de/danoeh/antennapod/adapter/FeedItemlistDescriptionAdapter.java b/app/src/main/java/de/danoeh/antennapod/adapter/FeedItemlistDescriptionAdapter.java\nindex f790a57843..2827c25902 100644\n--- a/app/src/main/java/de/danoeh/antennapod/adapter/FeedItemlistDescriptionAdapter.java\n+++ b/app/src/main/java/de/danoeh/antennapod/adapter/FeedItemlistDescriptionAdapter.java\n@@ -29,7 +29,7 @@\n  * List adapter for showing a list of FeedItems with their title and description.\n  */\n public class FeedItemlistDescriptionAdapter extends ArrayAdapter<FeedItem> {\n-    private static final int MAX_LINES_COLLAPSED = 3;\n+    private static final int MAX_LINES_COLLAPSED = 2;\n \n     public FeedItemlistDescriptionAdapter(Context context, int resource, List<FeedItem> objects) {\n         super(context, resource, objects);\ndiff --git a/app/src/main/res/layout/itemdescription_listitem.xml b/app/src/main/res/layout/itemdescription_listitem.xml\nindex 6ed8567966..c3f8c24b8d 100644\n--- a/app/src/main/res/layout/itemdescription_listitem.xml\n+++ b/app/src/main/res/layout/itemdescription_listitem.xml\n@@ -1,46 +1,31 @@\n <?xml version=\"1.0\" encoding=\"utf-8\"?>\n-\n-<RelativeLayout\n+<LinearLayout\n     xmlns:android=\"http://schemas.android.com/apk/res/android\"\n     xmlns:tools=\"http://schemas.android.com/tools\"\n     android:layout_width=\"match_parent\"\n     android:layout_height=\"wrap_content\"\n-    android:paddingTop=\"8dp\"\n-    android:paddingLeft=\"16dp\"\n-    android:paddingRight=\"16dp\"\n-    android:paddingBottom=\"8dp\"\n-    tools:background=\"@android:color/holo_orange_light\">\n+    android:orientation=\"vertical\"\n+    android:paddingHorizontal=\"20dp\"\n+    android:paddingVertical=\"16dp\">\n \n     <TextView\n         android:id=\"@+id/txtvPubDate\"\n-        style=\"@android:style/TextAppearance.Small\"\n         android:layout_width=\"wrap_content\"\n         android:layout_height=\"wrap_content\"\n-        android:layout_alignParentRight=\"true\"\n-        android:layout_alignParentEnd=\"true\"\n-        android:layout_alignParentTop=\"true\"\n-        android:layout_marginLeft=\"8dp\"\n-        android:layout_marginStart=\"8dp\"\n-        android:textSize=\"14sp\"\n-        android:textColor=\"?android:textColorSecondary\"\n         android:ellipsize=\"end\"\n         android:lines=\"1\"\n+        style=\"@android:style/TextAppearance.Small\"\n         tools:text=\"22 Jan 2016\"\n         tools:background=\"@android:color/holo_green_dark\" />\n \n     <TextView\n         android:id=\"@+id/txtvTitle\"\n-        android:layout_width=\"wrap_content\"\n+        android:layout_width=\"match_parent\"\n         android:layout_height=\"wrap_content\"\n-        android:layout_alignParentLeft=\"true\"\n-        android:layout_alignParentStart=\"true\"\n-        android:layout_alignParentTop=\"true\"\n-        android:layout_toLeftOf=\"@id/txtvPubDate\"\n-        android:layout_toStartOf=\"@id/txtvPubDate\"\n-        android:textSize=\"16sp\"\n-        android:textColor=\"?android:attr/textColorPrimary\"\n+        android:layout_marginVertical=\"12dp\"\n         android:ellipsize=\"end\"\n         android:maxLines=\"2\"\n+        style=\"@style/AntennaPod.TextView.ListItemPrimaryTitle\"\n         tools:text=\"Feed item title\"\n         tools:background=\"@android:color/holo_green_dark\" />\n \n@@ -48,22 +33,19 @@\n         android:id=\"@+id/txtvDescription\"\n         android:layout_width=\"match_parent\"\n         android:layout_height=\"wrap_content\"\n-        android:layout_below=\"@id/txtvTitle\"\n-        android:textSize=\"14sp\"\n-        android:textColor=\"?android:attr/textColorSecondary\"\n         android:ellipsize=\"end\"\n-        android:maxLines=\"3\"\n+        android:maxLines=\"2\"\n+        style=\"@style/AntennaPod.TextView.ListItemBody\"\n         tools:text=\"Feed item description\"\n         tools:background=\"@android:color/holo_green_dark\" />\n \n     <Button\n         android:id=\"@+id/butPreview\"\n-        android:layout_below=\"@id/txtvDescription\"\n         android:layout_width=\"wrap_content\"\n         android:layout_height=\"wrap_content\"\n-        android:layout_alignParentStart=\"true\"\n-        android:layout_alignParentLeft=\"true\"\n-        style=\"@style/Widget.MaterialComponents.Button.TextButton\"\n-        android:text=\"@string/preview_episode\"/>\n+        android:layout_marginTop=\"8dp\"\n+        android:text=\"@string/preview_episode\"\n+        android:layout_gravity=\"end|right\"\n+        style=\"@style/Widget.MaterialComponents.Button.OutlinedButton\" />\n \n-</RelativeLayout>\n+</LinearLayout>\ndiff --git a/app/src/main/res/layout/itunes_podcast_listitem.xml b/app/src/main/res/layout/itunes_podcast_listitem.xml\nindex fe53e1944b..da2de457b7 100644\n--- a/app/src/main/res/layout/itunes_podcast_listitem.xml\n+++ b/app/src/main/res/layout/itunes_podcast_listitem.xml\n@@ -1,5 +1,4 @@\n <?xml version=\"1.0\" encoding=\"utf-8\"?>\n-\n <RelativeLayout\n     xmlns:android=\"http://schemas.android.com/apk/res/android\"\n     xmlns:tools=\"http://schemas.android.com/tools\"\n@@ -37,24 +36,23 @@\n \n         <TextView\n             android:id=\"@+id/txtvTitle\"\n-            style=\"@style/AntennaPod.TextView.ListItemPrimaryTitle2\"\n             android:layout_width=\"match_parent\"\n             android:layout_height=\"wrap_content\"\n-            android:maxLines=\"2\"\n+            style=\"@style/AntennaPod.TextView.ListItemPrimaryTitle\"\n             tools:background=\"@android:color/holo_green_dark\"\n             tools:text=\"Podcast title\" />\n \n         <TextView\n             android:id=\"@+id/txtvAuthor\"\n-            style=\"android:style/TextAppearance.Small\"\n             android:layout_width=\"match_parent\"\n             android:layout_height=\"wrap_content\"\n             android:textSize=\"14sp\"\n             android:textColor=\"?android:attr/textColorSecondary\"\n             android:ellipsize=\"middle\"\n             android:maxLines=\"2\"\n+            style=\"android:style/TextAppearance.Small\"\n             tools:text=\"author\"\n-            tools:background=\"@android:color/holo_green_dark\"/>\n+            tools:background=\"@android:color/holo_green_dark\" />\n \n     </LinearLayout>\n \ndiff --git a/app/src/main/res/layout/onlinefeedview_activity.xml b/app/src/main/res/layout/onlinefeedview_activity.xml\nindex c9ee91ead8..88b87da1af 100644\n--- a/app/src/main/res/layout/onlinefeedview_activity.xml\n+++ b/app/src/main/res/layout/onlinefeedview_activity.xml\n@@ -11,7 +11,7 @@\n         android:id=\"@+id/card\"\n         android:layout_width=\"match_parent\"\n         android:layout_height=\"match_parent\"\n-        android:layout_margin=\"32dp\"\n+        android:layout_margin=\"24dp\"\n         android:elevation=\"16dp\"\n         app:cardCornerRadius=\"8dp\">\n \n@@ -35,13 +35,14 @@\n \n                 <RelativeLayout\n                     android:layout_width=\"match_parent\"\n-                    android:layout_height=\"wrap_content\"\n+                    android:layout_height=\"@dimen/feeditemlist_header_height\"\n+                    android:layout_marginBottom=\"12dp\"\n                     android:background=\"@color/feed_image_bg\">\n \n                     <ImageView\n                         android:id=\"@+id/backgroundImage\"\n                         android:layout_width=\"match_parent\"\n-                        android:layout_height=\"@dimen/feeditemlist_header_height\"\n+                        android:layout_height=\"match_parent\"\n                         android:scaleType=\"centerCrop\" />\n \n                     <ImageView\n@@ -52,10 +53,12 @@\n                         android:layout_alignParentStart=\"true\"\n                         android:layout_alignParentTop=\"true\"\n                         android:layout_centerVertical=\"true\"\n-                        android:layout_marginBottom=\"16dp\"\n+                        android:layout_marginBottom=\"12dp\"\n                         android:layout_marginLeft=\"16dp\"\n                         android:layout_marginStart=\"16dp\"\n-                        android:layout_marginTop=\"16dp\"\n+                        android:layout_marginTop=\"24dp\"\n+                        android:background=\"@drawable/bg_rounded_corners\"\n+                        android:clipToOutline=\"true\"\n                         android:importantForAccessibility=\"no\"\n                         tools:src=\"@tools:sample/avatars\" />\n \n@@ -64,12 +67,12 @@\n                         android:layout_width=\"0dp\"\n                         android:layout_height=\"wrap_content\"\n                         android:layout_alignParentTop=\"true\"\n-                        android:layout_marginBottom=\"16dp\"\n+                        android:layout_marginBottom=\"8dp\"\n                         android:layout_marginLeft=\"16dp\"\n                         android:layout_marginStart=\"16dp\"\n-                        android:layout_marginTop=\"16dp\"\n-                        android:layout_marginRight=\"16dp\"\n-                        android:layout_marginEnd=\"16dp\"\n+                        android:layout_marginTop=\"24dp\"\n+                        android:layout_marginRight=\"24dp\"\n+                        android:layout_marginEnd=\"24dp\"\n                         android:layout_alignParentEnd=\"true\"\n                         android:layout_alignParentRight=\"true\"\n                         android:layout_toRightOf=\"@id/coverImage\"\n@@ -79,7 +82,8 @@\n                         android:shadowColor=\"@color/black\"\n                         android:shadowRadius=\"3\"\n                         android:textColor=\"@color/white\"\n-                        style=\"@style/AntennaPod.TextView.Heading\"\n+                        android:textSize=\"20sp\"\n+                        android:textFontWeight=\"800\"\n                         tools:text=\"Podcast title\" />\n \n                     <TextView\n@@ -104,21 +108,28 @@\n                         android:textSize=\"@dimen/text_size_small\"\n                         tools:text=\"Podcast author\" />\n \n+                    <ImageButton\n+                        android:id=\"@+id/closeButton\"\n+                        android:layout_width=\"16dp\"\n+                        android:layout_height=\"16dp\"\n+                        android:layout_alignParentRight=\"true\"\n+                        android:layout_marginTop=\"12dp\"\n+                        android:layout_marginRight=\"12dp\"\n+                        android:background=\"@android:color/transparent\"\n+                        android:src=\"@drawable/ic_close_white\" />\n+\n                 </RelativeLayout>\n \n                 <LinearLayout\n                     android:layout_width=\"match_parent\"\n                     android:layout_height=\"wrap_content\"\n-                    android:layout_marginStart=\"8dp\"\n-                    android:layout_marginEnd=\"8dp\"\n-                    android:layout_marginBottom=\"16dp\"\n+                    android:paddingHorizontal=\"16dp\"\n                     android:orientation=\"vertical\">\n \n                     <Spinner\n                         android:id=\"@+id/alternate_urls_spinner\"\n                         android:layout_width=\"match_parent\"\n                         android:layout_height=\"wrap_content\"\n-                        android:layout_marginTop=\"8dp\"\n                         android:dropDownWidth=\"match_parent\"\n                         android:padding=\"8dp\"\n                         android:textColor=\"?android:attr/textColorPrimary\"\n@@ -128,10 +139,7 @@\n                         android:id=\"@+id/subscribeButton\"\n                         android:layout_width=\"match_parent\"\n                         android:layout_height=\"wrap_content\"\n-                        android:layout_marginStart=\"8dp\"\n-                        android:layout_marginTop=\"16dp\"\n-                        android:layout_marginEnd=\"8dp\"\n-                        android:focusable=\"false\"\n+                        android:layout_marginTop=\"4dp\"\n                         android:text=\"@string/subscribe_label\" />\n \n                     <CheckBox\n@@ -139,8 +147,8 @@\n                         android:layout_width=\"match_parent\"\n                         android:layout_height=\"wrap_content\"\n                         android:layout_gravity=\"left\"\n-                        android:focusable=\"false\"\n                         android:checked=\"true\"\n+                        android:layout_marginTop=\"8dp\"\n                         android:text=\"@string/auto_download_label\"\n                         android:visibility=\"gone\"\n                         tools:visibility=\"visible\" />\n@@ -149,8 +157,7 @@\n                         android:id=\"@+id/stopPreviewButton\"\n                         android:layout_width=\"match_parent\"\n                         android:layout_height=\"wrap_content\"\n-                        android:layout_margin=\"8dp\"\n-                        android:focusable=\"false\"\n+                        android:layout_marginTop=\"4dp\"\n                         android:text=\"@string/stop_preview\"\n                         android:visibility=\"gone\"\n                         tools:visibility=\"visible\" />\n@@ -160,7 +167,9 @@\n                 <ListView\n                     android:id=\"@+id/listView\"\n                     android:layout_width=\"match_parent\"\n-                    android:layout_height=\"match_parent\" />\n+                    android:layout_height=\"match_parent\"\n+                    android:paddingTop=\"16dp\"\n+                    android:clipToPadding=\"false\" />\n \n             </LinearLayout>\n \ndiff --git a/app/src/main/res/layout/onlinefeedview_header.xml b/app/src/main/res/layout/onlinefeedview_header.xml\nindex aa690e1425..6d740c772b 100644\n--- a/app/src/main/res/layout/onlinefeedview_header.xml\n+++ b/app/src/main/res/layout/onlinefeedview_header.xml\n@@ -1,35 +1,36 @@\n <?xml version=\"1.0\" encoding=\"utf-8\"?>\n <LinearLayout\n-        xmlns:android=\"http://schemas.android.com/apk/res/android\"\n-        xmlns:tools=\"http://schemas.android.com/tools\"\n-        android:orientation=\"vertical\"\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:tools=\"http://schemas.android.com/tools\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"wrap_content\"\n+    android:orientation=\"vertical\"\n+    android:paddingLeft=\"20dp\"\n+    android:paddingRight=\"20dp\"\n+    android:layout_marginBottom=\"8dp\">\n+\n+    <TextView\n+        android:layout_width=\"wrap_content\"\n         android:layout_height=\"wrap_content\"\n-        android:layout_width=\"match_parent\">\n+        android:layout_marginBottom=\"8dp\"\n+        android:text=\"@string/description_label\"\n+        style=\"@style/TextAppearance.Material3.TitleMedium\" />\n \n     <TextView\n-            android:id=\"@+id/txtvDescription\"\n-            android:layout_width=\"wrap_content\"\n-            android:layout_height=\"wrap_content\"\n-            android:layout_marginBottom=\"16dp\"\n-            android:layout_marginLeft=\"16dp\"\n-            android:layout_marginStart=\"16dp\"\n-            android:layout_marginRight=\"16dp\"\n-            android:layout_marginEnd=\"16dp\"\n-            android:ellipsize=\"end\"\n-            android:textColor=\"?android:attr/textColorSecondary\"\n-            android:textSize=\"@dimen/text_size_small\"\n-            tools:text=\"@string/design_time_lorem_ipsum\"\n-            tools:background=\"@android:color/holo_green_dark\"/>\n+        android:id=\"@+id/txtvDescription\"\n+        android:layout_width=\"wrap_content\"\n+        android:layout_height=\"wrap_content\"\n+        android:layout_marginBottom=\"16dp\"\n+        android:ellipsize=\"end\"\n+        android:lineHeight=\"20dp\"\n+        style=\"@style/AntennaPod.TextView.ListItemBody\"\n+        tools:text=\"@string/design_time_lorem_ipsum\" />\n \n     <TextView\n-            android:layout_width=\"wrap_content\"\n-            android:layout_height=\"wrap_content\"\n-            android:layout_marginBottom=\"16dp\"\n-            android:layout_marginLeft=\"16dp\"\n-            android:layout_marginStart=\"16dp\"\n-            android:layout_marginRight=\"16dp\"\n-            android:layout_marginEnd=\"16dp\"\n-            android:textSize=\"@dimen/text_size_medium\"\n-            android:text=\"@string/episodes_label\"/>\n+        android:layout_width=\"wrap_content\"\n+        android:layout_height=\"wrap_content\"\n+        android:layout_marginBottom=\"16dp\"\n+        android:text=\"@string/episodes_label\"\n+        style=\"@style/TextAppearance.Material3.TitleMedium\" />\n \n-</LinearLayout>\n\\ No newline at end of file\n+</LinearLayout>\ndiff --git a/core/src/main/res/drawable/bg_rounded_corners.xml b/core/src/main/res/drawable/bg_rounded_corners.xml\nnew file mode 100644\nindex 0000000000..11b7710c40\n--- /dev/null\n+++ b/core/src/main/res/drawable/bg_rounded_corners.xml\n@@ -0,0 +1,6 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<shape\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    android:shape=\"rectangle\">\n+    <corners android:radius=\"8dp\" />\n+</shape>\ndiff --git a/core/src/main/res/drawable/ic_close_white.xml b/core/src/main/res/drawable/ic_close_white.xml\nnew file mode 100644\nindex 0000000000..d37d3f9632\n--- /dev/null\n+++ b/core/src/main/res/drawable/ic_close_white.xml\n@@ -0,0 +1,11 @@\n+<vector xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    android:width=\"24dp\"\n+    android:height=\"24dp\"\n+    android:viewportWidth=\"24\"\n+    android:viewportHeight=\"24\">\n+  <path\n+      android:pathData=\"M17.656,6.343L12,12M12,12L6.343,17.656M12,12L17.656,17.656M12,12L6.343,6.343\"\n+      android:strokeWidth=\"2\"\n+      android:fillColor=\"#00000000\"\n+      android:strokeColor=\"#ffffff\"/>\n+</vector>\ndiff --git a/core/src/main/res/values/dimens.xml b/core/src/main/res/values/dimens.xml\nindex cddff1c471..68d0e59ab4 100644\n--- a/core/src/main/res/values/dimens.xml\n+++ b/core/src/main/res/values/dimens.xml\n@@ -6,11 +6,10 @@\n     <dimen name=\"text_size_micro\">12sp</dimen>\n     <dimen name=\"text_size_small\">14sp</dimen>\n     <dimen name=\"text_size_navdrawer\">16sp</dimen>\n-    <dimen name=\"text_size_medium\">18sp</dimen>\n     <dimen name=\"text_size_large\">22sp</dimen>\n     <dimen name=\"thumbnail_length_itemlist\">56dp</dimen>\n     <dimen name=\"thumbnail_length_queue_item\">56dp</dimen>\n-    <dimen name=\"thumbnail_length_onlinefeedview\">100dp</dimen>\n+    <dimen name=\"thumbnail_length_onlinefeedview\">92dp</dimen>\n     <dimen name=\"feeditemlist_header_height\">132dp</dimen>\n     <dimen name=\"thumbnail_length_navlist\">40dp</dimen>\n     <dimen name=\"listitem_iconwithtext_height\">48dp</dimen>\ndiff --git a/core/src/main/res/values/styles.xml b/core/src/main/res/values/styles.xml\nindex 2b0d50267b..da227d1636 100644\n--- a/core/src/main/res/values/styles.xml\n+++ b/core/src/main/res/values/styles.xml\n@@ -237,24 +237,24 @@\n         <item name=\"android:fontFamily\">sans-serif-light</item>\n     </style>\n \n-    <style name=\"AntennaPod.TextView.ListItemPrimaryTitle\" parent=\"@android:style/TextAppearance.Small\">\n-        <item name=\"android:textSize\">16sp</item>\n-        <item name=\"android:textColor\">?android:attr/textColorPrimary</item>\n+    <style name=\"AntennaPod.TextView.ListItemPrimaryTitle\" parent=\"@style/TextAppearance.Material3.BodyLarge\">\n+        <item name=\"android:textColor\">?attr/colorOnSurface</item>\n         <item name=\"android:maxLines\">2</item>\n         <item name=\"android:ellipsize\">end</item>\n+        <item name=\"lineHeight\">20sp</item>\n+        <item name=\"android:lineHeight\" tools:targetApi=\"p\">20sp</item>\n     </style>\n \n-    <style name=\"AntennaPod.TextView.ListItemPrimaryTitle2\" parent=\"@android:style/TextAppearance.Small\">\n-        <item name=\"android:textSize\">16sp</item>\n-        <item name=\"android:textColor\">?android:attr/textColorPrimary</item>\n+    <style name=\"AntennaPod.TextView.ListItemSecondaryTitle\" parent=\"@style/TextAppearance.Material3.BodyMedium\">\n+        <item name=\"android:textColor\">?attr/colorOnSurfaceVariant</item>\n+        <item name=\"android:lines\">1</item>\n         <item name=\"android:ellipsize\">end</item>\n     </style>\n \n-    <style name=\"AntennaPod.TextView.ListItemSecondaryTitle\" parent=\"@android:style/TextAppearance.Small\">\n-        <item name=\"android:textSize\">14sp</item>\n-        <item name=\"android:textColor\">?android:attr/textColorSecondary</item>\n-        <item name=\"android:lines\">1</item>\n-        <item name=\"android:ellipsize\">end</item>\n+    <style name=\"AntennaPod.TextView.ListItemBody\" parent=\"@style/TextAppearance.Material3.BodyMedium\">\n+        <item name=\"android:textColor\">?attr/colorOnSurfaceVariant</item>\n+        <item name=\"lineHeight\">18sp</item>\n+        <item name=\"android:lineHeight\" tools:targetApi=\"p\">18sp</item>\n     </style>\n \n     <style name=\"OutlinedButtonBetterContrast\" parent=\"Widget.Material3.Button.OutlinedButton\">\n", "test_patch": "", "problem_statement": "Improve podcast dialog design hierarchy - hard readibility\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.1.1\n\n### Where did you get the app from\n\nGoogle Play\n\n### Problem you may be having, or feature you want\n\n![dialogss](https://github.com/AntennaPod/AntennaPod/assets/85757758/fcf93b44-e963-4182-85b9-568349be10f7)\r\n\r\nThe postcast dialog delivery hierarchy is not good and text colors and sizes blend each other, it's hard to differentiate different level of labels + this looks so full of text and not content, space optimised.\r\n\n\n### Suggested solution\n\nThe font weight of different texts can be fixed and the design could be more content optimised by showing limited amount of text and increasing the padding and margins. The button can be brought under the description, a cross button can be added to dialog.\n\n### Screenshots / Drawings / Technical details\n\n![dialog](https://github.com/AntennaPod/AntennaPod/assets/85757758/7f36eb6a-aee7-42b2-8860-7d7ad007af7c)\r\n![redesigned](https://github.com/AntennaPod/AntennaPod/assets/85757758/72482bee-79cb-44da-8415-3d329a0a673e)\r\n\r\nHere's a clean and better hierarchy design.\n", "hints_text": "does anybody working on this issue.\n@bhaskarblur Your design looks great! Is this a mock-up in a design software or did you code this?\r\n\r\n@SriMani-7 If you want to contribute, please have a look at the issues labelled \"good first issue\".\nI want to work on this! Please, i designed it in figma and i want to code it as well.\r\nPlease assign me so that i can implement it in code! Thanks\nI'm really looking forward to your PR!  :tada:  I saw that you also redesigned other screens. Please create the PR for only one screen, I think this screen here would be a great start. Redesigning multiple things at once makes the PR larger and therefore harder to get merged. Once the PR is merged, we can then work on the next one.\r\n\r\nAbout the bright green color: We should continue using the Material Design 3 dynamic colors, so I think the color needs to stay less bright.\r\n\r\nBy the way, do you know Hacktoberfest? If you open the PR in October, you can get a free T-Shirt: https://hacktoberfest.com/\r\n\r\n(@keunes Do we want the preview button to be so prominent?)\nThank you for the same and i'm happy that you liked my work and i will love to contribute more to the project.\r\nI'll follow you and start by creating PR For only Once screen change at a time,\r\nAs for green color, for now i'll go with the Material 3 green color that is being used currently.\r\n\r\nPlease assign me for this task otherwise i'll PR directly if that's fine.\nPlease let me know where can i ask small questions, thanks\n@ByteHamster Sorry for tagging, the current color that is being used is blue, in my design i thought to use material 3 green so should i use blue or green?\r\n\r\nAlso current font is sans-serif, what i've used is Roboto which is also material UI so should i use sans serif or roboto.\r\n\r\nOr how about we refract to Roboto for a test check if required?\n> the current color that is being used is blue, in my design i thought to use material 3 green so should i use blue or green?\r\n\r\nThe default color is blue. When selecting the \"use dynamic colors\" option, the color can be different, for example green, depending on user's wallpaper. To use this dynamic color, refer to the Material3 theme attributes like `?attr/colorPrimary`. There is a list here: https://developer.android.com/develop/ui/views/theming/dynamic-colors\r\n\r\n> Also current font is sans-serif, what i've used is Roboto which is also material UI so should i use sans serif or roboto.\r\n\r\nI assumed sans-serif to select Roboto. But if it isn't, feel free to change it. I think it should be possible to change the font using a theme attribute, and then reference standard material3 attributes, like here: https://developer.android.com/jetpack/compose/designsystems/material3#typography\nLet's do what is continue with sans-serif and maybe in future we can shift to roboto, otherwise i'll test on my end and see if roboto is looking better then i'll approach you all for your views on the changing the font.", "created_at": "2023-09-30T16:51:14Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6662, "instance_id": "AntennaPod__AntennaPod-6662", "issue_numbers": ["6649"], "base_commit": "0e52f08aa56a52cd5516cbeb2a85415a99d6963b", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/service/FeedUpdateWorker.java b/core/src/main/java/de/danoeh/antennapod/core/service/FeedUpdateWorker.java\nindex d71922e7be..659650bc19 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/FeedUpdateWorker.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/FeedUpdateWorker.java\n@@ -34,6 +34,7 @@\n import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n \n+import java.util.ArrayList;\n import java.util.Collections;\n import java.util.Iterator;\n import java.util.List;\n@@ -81,7 +82,8 @@ public Result doWork() {\n             if (!feed.isLocalFeed()) {\n                 allAreLocal = false;\n             }\n-            toUpdate = Collections.singletonList(feed);\n+            toUpdate = new ArrayList<>();\n+            toUpdate.add(feed); // Needs to be updatable, so no singletonList\n             force = true;\n         }\n \n", "test_patch": "", "problem_statement": "Notification hangs when refreshing individual feeds\n### Checklist\r\n\r\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n### App version\r\n\r\n3.1.1\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Android version\r\n\r\n12\r\n\r\n### Device model\r\n\r\nPixel 3a\r\n\r\n### First occurred\r\n\r\nI don't recall seeing this before 3.1.1 (and I use this feature regularly, so I should have noticed if that was the case)\r\n\r\n### Steps to reproduce\r\n\r\n1. Refresh a single subscription, using any method (both active and archived/paused feeds are equally affected)\r\n\r\n### Expected behaviour\r\n\r\n2. The feed is refreshed and the notification disappears as soon as the operation is completed\r\n\r\n### Current behaviour\r\n\r\n2. The feed is refreshed, but the notification hangs until the app is force stopped (or until a different feed is refreshed, in which case the new feed replaces the old one in the hanging notification)\r\n\r\n### Logs\r\n\r\n_No response_\n", "hints_text": "![Screenshot_20230921-082916.png](https://github.com/AntennaPod/AntennaPod/assets/16977507/21dc69cf-ff8e-4861-b956-65217a44daa5)\n\nI have the same bug. Added screenshot ", "created_at": "2023-09-27T19:54:07Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6659, "instance_id": "AntennaPod__AntennaPod-6659", "issue_numbers": ["6642"], "base_commit": "574ec1434c885429e0d9b4061dff765eb7284701", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/fragment/CompletedDownloadsFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/CompletedDownloadsFragment.java\nindex ba328adba7..730a391898 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/CompletedDownloadsFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/CompletedDownloadsFragment.java\n@@ -159,6 +159,7 @@ private void inflateSortMenu(MaterialToolbar toolbar) {\n         menu.findItem(R.id.sort_random).setVisible(false);\n         menu.findItem(R.id.sort_smart_shuffle).setVisible(false);\n         menu.findItem(R.id.keep_sorted).setVisible(false);\n+        menu.findItem(R.id.sort_size).setVisible(true);\n     }\n \n     @Override\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/MenuItemToSortOrderConverter.java b/app/src/main/java/de/danoeh/antennapod/fragment/MenuItemToSortOrderConverter.java\nindex 51911b1228..d4150fbdb5 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/MenuItemToSortOrderConverter.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/MenuItemToSortOrderConverter.java\n@@ -32,6 +32,10 @@ public static SortOrder convert(MenuItem item) {\n             return SortOrder.SMART_SHUFFLE_OLD_NEW;\n         } else if (itemId == R.id.sort_smart_shuffle_desc) {\n             return SortOrder.SMART_SHUFFLE_NEW_OLD;\n+        } else if (itemId == R.id.sort_size_small_large) {\n+            return SortOrder.SIZE_SMALL_LARGE;\n+        } else if (itemId == R.id.sort_size_large_small) {\n+            return SortOrder.SIZE_LARGE_SMALL;\n         }\n \n         return null;\ndiff --git a/app/src/main/res/menu/sort_menu.xml b/app/src/main/res/menu/sort_menu.xml\nindex f0a22042b0..96ad4b9f6d 100644\n--- a/app/src/main/res/menu/sort_menu.xml\n+++ b/app/src/main/res/menu/sort_menu.xml\n@@ -75,6 +75,22 @@\n                 android:title=\"@string/sort_new_old\"/>\n         </menu>\n     </item>\n+\n+    <item\n+        android:id=\"@+id/sort_size\"\n+        android:title=\"@string/size\"\n+        android:visible=\"false\">\n+\n+        <menu>\n+            <item\n+                android:id=\"@+id/sort_size_small_large\"\n+                android:title=\"@string/sort_small_large\"/>\n+            <item\n+                android:id=\"@+id/sort_size_large_small\"\n+                android:title=\"@string/sort_large_small\"/>\n+        </menu>\n+    </item>\n+\n     <item\n         android:id=\"@+id/keep_sorted\"\n         android:title=\"@string/keep_sorted\"\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/util/FeedItemPermutors.java b/core/src/main/java/de/danoeh/antennapod/core/util/FeedItemPermutors.java\nindex 12377791e2..ec9c9e55e4 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/util/FeedItemPermutors.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/util/FeedItemPermutors.java\n@@ -72,6 +72,12 @@ public static Permutor<FeedItem> getPermutor(@NonNull SortOrder sortOrder) {\n             case SMART_SHUFFLE_NEW_OLD:\n                 permutor = (queue) -> smartShuffle(queue, false);\n                 break;\n+            case SIZE_SMALL_LARGE:\n+                comparator = (f1, f2) -> Long.compare(size(f1), size(f2));\n+                break;\n+            case SIZE_LARGE_SMALL:\n+                comparator = (f1, f2) -> Long.compare(size(f2), size(f1));\n+                break;\n         }\n \n         if (comparator != null) {\n@@ -97,6 +103,10 @@ private static int duration(@Nullable FeedItem item) {\n         return (item != null && item.getMedia() != null) ? item.getMedia().getDuration() : 0;\n     }\n \n+    private static long size(@Nullable FeedItem item) {\n+        return (item != null && item.getMedia() != null) ? item.getMedia().getSize() : 0;\n+    }\n+\n     @NonNull\n     private static String itemLink(@Nullable FeedItem item) {\n         return (item != null && item.getLink() != null)\ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/SortOrder.java b/model/src/main/java/de/danoeh/antennapod/model/feed/SortOrder.java\nindex 1f9687b2ee..08504b4454 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/feed/SortOrder.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/SortOrder.java\n@@ -20,6 +20,8 @@ public enum SortOrder {\n     DURATION_LONG_SHORT(6, INTRA_FEED),\n     EPISODE_FILENAME_A_Z(7, INTRA_FEED),\n     EPISODE_FILENAME_Z_A(8, INTRA_FEED),\n+    SIZE_SMALL_LARGE(9, INTRA_FEED),\n+    SIZE_LARGE_SMALL(10, INTRA_FEED),\n     FEED_TITLE_A_Z(101, INTER_FEED),\n     FEED_TITLE_Z_A(102, INTER_FEED),\n     RANDOM(103, INTER_FEED),\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemSortQuery.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemSortQuery.java\nindex aae5154d3e..d4404a0820 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemSortQuery.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/FeedItemSortQuery.java\n@@ -25,6 +25,12 @@ public static String generateFrom(SortOrder sortOrder) {\n             case DURATION_LONG_SHORT:\n                 sortQuery = PodDBAdapter.TABLE_NAME_FEED_MEDIA + \".\" + PodDBAdapter.KEY_DURATION + \" \" + \"DESC\";\n                 break;\n+            case SIZE_SMALL_LARGE:\n+                sortQuery = PodDBAdapter.TABLE_NAME_FEED_MEDIA + \".\" + PodDBAdapter.KEY_SIZE + \" \" + \"ASC\";\n+                break;\n+            case SIZE_LARGE_SMALL:\n+                sortQuery = PodDBAdapter.TABLE_NAME_FEED_MEDIA + \".\" + PodDBAdapter.KEY_SIZE + \" \" + \"DESC\";\n+                break;\n             default:\n                 sortQuery = \"\";\n                 break;\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 0697a2f537..73423f4b5c 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -343,6 +343,7 @@\n     <string name=\"feed_title\">Podcast title</string>\n     <string name=\"random\">Random</string>\n     <string name=\"smart_shuffle\">Smart shuffle</string>\n+    <string name=\"size\">Size</string>\n     <string name=\"clear_queue_confirmation_msg\">Please confirm that you want to clear the queue of ALL of the episodes in it</string>\n     <string name=\"time_left_label\">Time left:\\u0020</string>\n \n@@ -771,6 +772,8 @@\n     <string name=\"sort_old_new\">Old \\u2192 New</string>\n     <string name=\"sort_short_long\">Short \\u2192 Long</string>\n     <string name=\"sort_long_short\">Long \\u2192 Short</string>\n+    <string name=\"sort_small_large\">Small \\u2192 Large</string>\n+    <string name=\"sort_large_small\">Large \\u2192 Small</string>\n \n     <!-- Share episode dialog -->\n     <string name=\"share_playback_position_dialog_label\">Include playback position</string>\n", "test_patch": "diff --git a/core/src/test/java/de/danoeh/antennapod/core/util/FeedItemPermutorsTest.java b/core/src/test/java/de/danoeh/antennapod/core/util/FeedItemPermutorsTest.java\nindex 9c48f8df7e..be4012cb6c 100644\n--- a/core/src/test/java/de/danoeh/antennapod/core/util/FeedItemPermutorsTest.java\n+++ b/core/src/test/java/de/danoeh/antennapod/core/util/FeedItemPermutorsTest.java\n@@ -112,6 +112,26 @@ public void testPermutorForRule_DURATION_DESC() {\n         assertTrue(checkIdOrder(itemList, 3, 2, 1)); // after sorting\n     }\n \n+    @Test\n+    public void testPermutorForRule_size_asc() {\n+        Permutor<FeedItem> permutor = FeedItemPermutors.getPermutor(SortOrder.SIZE_SMALL_LARGE);\n+\n+        List<FeedItem> itemList = getTestList();\n+        assertTrue(checkIdOrder(itemList, 1, 3, 2)); // before sorting\n+        permutor.reorder(itemList);\n+        assertTrue(checkIdOrder(itemList, 1, 2, 3)); // after sorting\n+    }\n+\n+    @Test\n+    public void testPermutorForRule_size_desc() {\n+        Permutor<FeedItem> permutor = FeedItemPermutors.getPermutor(SortOrder.SIZE_LARGE_SMALL);\n+\n+        List<FeedItem> itemList = getTestList();\n+        assertTrue(checkIdOrder(itemList, 1, 3, 2)); // before sorting\n+        permutor.reorder(itemList);\n+        assertTrue(checkIdOrder(itemList, 3, 2, 1)); // after sorting\n+    }\n+\n     @Test\n     public void testPermutorForRule_DURATION_DESC_NullMedia() {\n         Permutor<FeedItem> permutor = FeedItemPermutors.getPermutor(SortOrder.DURATION_LONG_SHORT);\n@@ -166,21 +186,21 @@ private List<FeedItem> getTestList() {\n         calendar.set(2019, 0, 1);  // January 1st\n         Feed feed1 = new Feed(null, null, \"Feed title 1\");\n         FeedItem feedItem1 = new FeedItem(1, \"Title 1\", null, null, calendar.getTime(), 0, feed1);\n-        FeedMedia feedMedia1 = new FeedMedia(0, feedItem1, 1000, 0, 0, null, null, null, true, null, 0, 0);\n+        FeedMedia feedMedia1 = new FeedMedia(0, feedItem1, 1000, 0, 100, null, null, null, true, null, 0, 0);\n         feedItem1.setMedia(feedMedia1);\n         itemList.add(feedItem1);\n \n         calendar.set(2019, 2, 1);  // March 1st\n         Feed feed2 = new Feed(null, null, \"Feed title 3\");\n         FeedItem feedItem2 = new FeedItem(3, \"Title 3\", null, null, calendar.getTime(), 0, feed2);\n-        FeedMedia feedMedia2 = new FeedMedia(0, feedItem2, 3000, 0, 0, null, null, null, true, null, 0, 0);\n+        FeedMedia feedMedia2 = new FeedMedia(0, feedItem2, 3000, 0, 300, null, null, null, true, null, 0, 0);\n         feedItem2.setMedia(feedMedia2);\n         itemList.add(feedItem2);\n \n         calendar.set(2019, 1, 1);  // February 1st\n         Feed feed3 = new Feed(null, null, \"Feed title 2\");\n         FeedItem feedItem3 = new FeedItem(2, \"Title 2\", null, null, calendar.getTime(), 0, feed3);\n-        FeedMedia feedMedia3 = new FeedMedia(0, feedItem3, 2000, 0, 0, null, null, null, true, null, 0, 0);\n+        FeedMedia feedMedia3 = new FeedMedia(0, feedItem3, 2000, 0, 200, null, null, null, true, null, 0, 0);\n         feedItem3.setMedia(feedMedia3);\n         itemList.add(feedItem3);\n \n", "problem_statement": "Sort downloads by size\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.1.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Problem you may be having, or feature you want\n\nThe Downloads pane supports sorting by date, duration and title, but it would be nice to be able to sort by size of the file, to see large episodes that are taking up space.\n\n### Suggested solution\n\nAdd a new sort\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "Hey @Julian . I would like to work on this issue!! Is this still open?\nYes, it is still open :)\nGreat!! I would like to work on it then.", "created_at": "2023-09-27T12:36:29Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6652, "instance_id": "AntennaPod__AntennaPod-6652", "issue_numbers": ["6596"], "base_commit": "8073de55af3c7cb749b6be2b80768bc07807e16c", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/CancelDownloadActionButton.java b/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/CancelDownloadActionButton.java\nindex 8b7a888739..c9500340b4 100644\n--- a/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/CancelDownloadActionButton.java\n+++ b/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/CancelDownloadActionButton.java\n@@ -32,7 +32,7 @@ public int getDrawable() {\n     @Override\n     public void onClick(Context context) {\n         FeedMedia media = item.getMedia();\n-        DownloadServiceInterface.get().cancel(context, media.getDownload_url());\n+        DownloadServiceInterface.get().cancel(context, media);\n         if (UserPreferences.isEnableAutodownload()) {\n             item.disableAutoDownload();\n             DBWriter.setFeedItem(item);\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceInterfaceImpl.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceInterfaceImpl.java\nindex 87cbeda847..894a7153b0 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceInterfaceImpl.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceInterfaceImpl.java\n@@ -7,12 +7,18 @@\n import androidx.work.NetworkType;\n import androidx.work.OneTimeWorkRequest;\n import androidx.work.OutOfQuotaPolicy;\n+import androidx.work.WorkInfo;\n import androidx.work.WorkManager;\n import de.danoeh.antennapod.core.storage.DBWriter;\n import de.danoeh.antennapod.model.feed.FeedItem;\n+import de.danoeh.antennapod.model.feed.FeedMedia;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n+import io.reactivex.Observable;\n+import io.reactivex.schedulers.Schedulers;\n \n+import java.util.List;\n+import java.util.concurrent.Future;\n import java.util.concurrent.TimeUnit;\n \n public class DownloadServiceInterfaceImpl extends DownloadServiceInterface {\n@@ -40,13 +46,11 @@ private static OneTimeWorkRequest.Builder getRequest(Context context, FeedItem i\n                 .setInitialDelay(0L, TimeUnit.MILLISECONDS)\n                 .addTag(DownloadServiceInterface.WORK_TAG)\n                 .addTag(DownloadServiceInterface.WORK_TAG_EPISODE_URL + item.getMedia().getDownload_url());\n-        Data.Builder builder = new Data.Builder();\n-        builder.putLong(WORK_DATA_MEDIA_ID, item.getMedia().getId());\n         if (!item.isTagged(FeedItem.TAG_QUEUE) && UserPreferences.enqueueDownloadedEpisodes()) {\n             DBWriter.addQueueItem(context, false, item.getId());\n-            builder.putBoolean(WORK_DATA_WAS_QUEUED, true);\n+            workRequest.addTag(DownloadServiceInterface.WORK_DATA_WAS_QUEUED);\n         }\n-        workRequest.setInputData(builder.build());\n+        workRequest.setInputData(new Data.Builder().putLong(WORK_DATA_MEDIA_ID, item.getMedia().getId()).build());\n         return workRequest;\n     }\n \n@@ -61,8 +65,26 @@ private static Constraints getConstraints() {\n     }\n \n     @Override\n-    public void cancel(Context context, String url) {\n-        WorkManager.getInstance(context).cancelAllWorkByTag(WORK_TAG_EPISODE_URL + url);\n+    public void cancel(Context context, FeedMedia media) {\n+        // This needs to be done here, not in the worker. Reason: The worker might or might not be running.\n+        DBWriter.deleteFeedMediaOfItem(context, media.getId()); // Remove partially downloaded file\n+        String tag = WORK_TAG_EPISODE_URL + media.getDownload_url();\n+        Future<List<WorkInfo>> future = WorkManager.getInstance(context).getWorkInfosByTag(tag);\n+        Observable.fromFuture(future)\n+                .subscribeOn(Schedulers.io())\n+                .observeOn(Schedulers.io())\n+                .subscribe(\n+                    workInfos -> {\n+                        for (WorkInfo info : workInfos) {\n+                            if (info.getTags().contains(DownloadServiceInterface.WORK_DATA_WAS_QUEUED)) {\n+                                DBWriter.removeQueueItem(context, false, media.getItem());\n+                            }\n+                        }\n+                        WorkManager.getInstance(context).cancelAllWorkByTag(tag);\n+                    }, exception -> {\n+                        WorkManager.getInstance(context).cancelAllWorkByTag(tag);\n+                        exception.printStackTrace();\n+                    });\n     }\n \n     @Override\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/EpisodeDownloadWorker.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/EpisodeDownloadWorker.java\nindex af5b5c9a41..976b3504a9 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/EpisodeDownloadWorker.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/download/EpisodeDownloadWorker.java\n@@ -93,6 +93,9 @@ public void run() {\n             e.printStackTrace();\n             result = Result.failure();\n         }\n+        if (result.equals(Result.failure()) && downloader != null) {\n+            FileUtils.deleteQuietly(new File(downloader.getDownloadRequest().getDestination()));\n+        }\n         progressUpdaterThread.interrupt();\n         try {\n             progressUpdaterThread.join();\n@@ -156,22 +159,15 @@ private Result performDownload(FeedMedia media, DownloadRequest request) {\n         } catch (Exception e) {\n             DBWriter.addDownloadStatus(downloader.getResult());\n             if (EventBus.getDefault().hasSubscriberForEvent(MessageEvent.class)) {\n-                sendMessage(request.getTitle(), false);\n+                sendMessage(request.getTitle(), true);\n             } else {\n                 sendErrorNotification();\n             }\n-            FileUtils.deleteQuietly(new File(downloader.getDownloadRequest().getDestination()));\n             return Result.failure();\n         }\n \n         if (downloader.cancelled) {\n-            if (getInputData().getBoolean(DownloadServiceInterface.WORK_DATA_WAS_QUEUED, false)) {\n-                try {\n-                    DBWriter.removeQueueItem(getApplicationContext(), false, media.getItem()).get();\n-                } catch (ExecutionException | InterruptedException e) {\n-                    e.printStackTrace();\n-                }\n-            }\n+            // This also happens when the worker was preempted, not just when the user cancelled it\n             return Result.success();\n         }\n \n@@ -188,10 +184,7 @@ private Result performDownload(FeedMedia media, DownloadRequest request) {\n                 && Integer.parseInt(status.getReasonDetailed()) == 416) {\n             Log.d(TAG, \"Requested invalid range, restarting download from the beginning\");\n             FileUtils.deleteQuietly(new File(downloader.getDownloadRequest().getDestination()));\n-            sendMessage(request.getTitle(), true);\n-            if (isLastRunAttempt()) {\n-                FileUtils.deleteQuietly(new File(downloader.getDownloadRequest().getDestination()));\n-            }\n+            sendMessage(request.getTitle(), false);\n             return retry3times();\n         }\n \n@@ -203,17 +196,13 @@ private Result performDownload(FeedMedia media, DownloadRequest request) {\n                 || status.getReason() == DownloadError.ERROR_IO_BLOCKED) {\n             // Fail fast, these are probably unrecoverable\n             if (EventBus.getDefault().hasSubscriberForEvent(MessageEvent.class)) {\n-                sendMessage(request.getTitle(), false);\n+                sendMessage(request.getTitle(), true);\n             } else {\n                 sendErrorNotification();\n             }\n-            FileUtils.deleteQuietly(new File(downloader.getDownloadRequest().getDestination()));\n             return Result.failure();\n         }\n-        sendMessage(request.getTitle(), true);\n-        if (isLastRunAttempt()) {\n-            FileUtils.deleteQuietly(new File(downloader.getDownloadRequest().getDestination()));\n-        }\n+        sendMessage(request.getTitle(), false);\n         return retry3times();\n     }\n \n@@ -230,7 +219,8 @@ private boolean isLastRunAttempt() {\n         return getRunAttemptCount() >= 2;\n     }\n \n-    private void sendMessage(String episodeTitle, boolean retrying) {\n+    private void sendMessage(String episodeTitle, boolean isImmediateFail) {\n+        boolean retrying = !isLastRunAttempt() && !isImmediateFail;\n         if (episodeTitle.length() > 20) {\n             episodeTitle = episodeTitle.substring(0, 19) + \"\u2026\";\n         }\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/storage/DBWriter.java b/core/src/main/java/de/danoeh/antennapod/core/storage/DBWriter.java\nindex 11e82af27b..b2cc46ee0f 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/storage/DBWriter.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/storage/DBWriter.java\n@@ -110,7 +110,7 @@ private static boolean deleteFeedMediaSynchronous(\n             @NonNull Context context, @NonNull FeedMedia media) {\n         Log.i(TAG, String.format(Locale.US, \"Requested to delete FeedMedia [id=%d, title=%s, downloaded=%s\",\n                 media.getId(), media.getEpisodeTitle(), media.isDownloaded()));\n-        if (media.isDownloaded()) {\n+        if (media.isDownloaded() || media.getFile_url() != null) {\n             // delete downloaded media file\n             File mediaFile = new File(media.getFile_url());\n             if (mediaFile.exists() && !mediaFile.delete()) {\n@@ -206,7 +206,7 @@ private static void deleteFeedItemsSynchronous(@NonNull Context context, @NonNul\n                 if (item.getMedia().isDownloaded()) {\n                     deleteFeedMediaSynchronous(context, item.getMedia());\n                 }\n-                DownloadServiceInterface.get().cancel(context, item.getMedia().getDownload_url());\n+                DownloadServiceInterface.get().cancel(context, item.getMedia());\n             }\n         }\n \ndiff --git a/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterface.java b/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterface.java\nindex 5fac79ce8b..a04c24ee45 100644\n--- a/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterface.java\n+++ b/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterface.java\n@@ -3,6 +3,7 @@\n import android.content.Context;\n import de.danoeh.antennapod.model.download.DownloadStatus;\n import de.danoeh.antennapod.model.feed.FeedItem;\n+import de.danoeh.antennapod.model.feed.FeedMedia;\n \n import java.util.HashMap;\n import java.util.Map;\n@@ -38,7 +39,7 @@ public void setCurrentDownloads(Map<String, DownloadStatus> currentDownloads) {\n      */\n     public abstract void download(Context context, FeedItem item);\n \n-    public abstract void cancel(Context context, String url);\n+    public abstract void cancel(Context context, FeedMedia media);\n \n     public abstract void cancelAll(Context context);\n \n", "test_patch": "diff --git a/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterfaceStub.java b/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterfaceStub.java\nindex 716d68d144..70f551a9c8 100644\n--- a/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterfaceStub.java\n+++ b/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterfaceStub.java\n@@ -2,6 +2,7 @@\n \n import android.content.Context;\n import de.danoeh.antennapod.model.feed.FeedItem;\n+import de.danoeh.antennapod.model.feed.FeedMedia;\n \n public class DownloadServiceInterfaceStub extends DownloadServiceInterface {\n \n@@ -14,7 +15,7 @@ public void download(Context context, FeedItem item) {\n     }\n \n     @Override\n-    public void cancel(Context context, String url) {\n+    public void cancel(Context context, FeedMedia media) {\n     }\n \n     @Override\n", "problem_statement": "Successful download auto-retry should honour queue settings\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.1.0 (91d5238f0)\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Have settings \"Enqueue downloaded\" and \"Delete removes from queue\" on\r\n2. Trigger an episode download which fails\r\n3. Notice that the episode, which was initially added to the queue, is removed from the queue\r\n4. Auto-retry download and succeed\n\n### Expected behaviour\n\n5. The episode is downloaded and added to the queue (either in the original position or as last)\n\n### Current behaviour\n\n5. The episode is downloaded, but it is not added to the queue\n\n### Logs\n\n_No response_\n", "hints_text": "Seeing the same behavior: some episodes downloaded but not added to the queue\nMy linked duplicate issue (#6641) added some more information:\r\n\r\nScenario: \"active wifi and inactive mobile network\" when wifi is turned off I even get a toast with \"download aborted, will be restarted later\"\r\nBut \"with wifi and mobile network\" when wifi is turned off the episode is removed from the queue.\r\n\r\nMy issue has also a stack trace of the buggy abort.\n@HolgerJeromin I think there are some lines missing from the log in the other issue. The lines say that the download was cancelled with a reason, but it doesn't give the reason. I suspect that the reason is below the last line you posted.\r\n\r\nWe make a distinction there: Cancelled downloads are removed from the queue again and failed downloads are kept in the queue and are retried. So we need to find out why the download on your device got cancelled instead of just failing.", "created_at": "2023-09-23T18:29:13Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6635, "instance_id": "AntennaPod__AntennaPod-6635", "issue_numbers": ["6631"], "base_commit": "087770026f63f83f2edd9aa236a37322ef3c94a4", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/DownloadActionButton.java b/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/DownloadActionButton.java\nindex 86a8047a95..4d5b0b6d53 100644\n--- a/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/DownloadActionButton.java\n+++ b/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/DownloadActionButton.java\n@@ -52,12 +52,17 @@ public void onClick(Context context) {\n         } else {\n             MaterialAlertDialogBuilder builder = new MaterialAlertDialogBuilder(context)\n                     .setTitle(R.string.confirm_mobile_download_dialog_title)\n-                    .setMessage(R.string.confirm_mobile_download_dialog_message)\n                     .setPositiveButton(R.string.confirm_mobile_download_dialog_download_later,\n                             (d, w) -> DownloadServiceInterface.get().downloadNow(context, item, false))\n                     .setNeutralButton(R.string.confirm_mobile_download_dialog_allow_this_time,\n                             (d, w) -> DownloadServiceInterface.get().downloadNow(context, item, true))\n                     .setNegativeButton(R.string.cancel_label, null);\n+            if (NetworkUtils.isNetworkRestricted() && NetworkUtils.isVpnOverWifi()) {\n+                builder.setMessage(R.string.confirm_mobile_download_dialog_message_vpn);\n+            } else {\n+                builder.setMessage(R.string.confirm_mobile_download_dialog_message);\n+            }\n+\n             builder.show();\n         }\n     }\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/util/NetworkUtils.java b/core/src/main/java/de/danoeh/antennapod/core/util/NetworkUtils.java\nindex 8be8a113bb..dfdc6c32ad 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/util/NetworkUtils.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/util/NetworkUtils.java\n@@ -78,18 +78,18 @@ public static boolean isNetworkRestricted() {\n \n     private static boolean isNetworkMetered() {\n         ConnectivityManager connManager = (ConnectivityManager) context.getSystemService(Context.CONNECTIVITY_SERVICE);\n+        return connManager.isActiveNetworkMetered();\n+    }\n \n-        if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.M) {\n-            NetworkCapabilities capabilities = connManager.getNetworkCapabilities(\n-                    connManager.getActiveNetwork());\n-\n-            if (capabilities != null\n-                    && capabilities.hasTransport(NetworkCapabilities.TRANSPORT_WIFI)\n-                    && capabilities.hasTransport(NetworkCapabilities.TRANSPORT_VPN)) {\n-                return false;\n-            }\n+    public static boolean isVpnOverWifi() {\n+        if (Build.VERSION.SDK_INT < Build.VERSION_CODES.M) {\n+            return false;\n         }\n-        return connManager.isActiveNetworkMetered();\n+        ConnectivityManager connManager = (ConnectivityManager) context.getSystemService(Context.CONNECTIVITY_SERVICE);\n+        NetworkCapabilities capabilities = connManager.getNetworkCapabilities(connManager.getActiveNetwork());\n+        return capabilities != null\n+                && capabilities.hasTransport(NetworkCapabilities.TRANSPORT_WIFI)\n+                && capabilities.hasTransport(NetworkCapabilities.TRANSPORT_VPN);\n     }\n \n     private static boolean isNetworkCellular() {\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/util/download/FeedUpdateManager.java b/core/src/main/java/de/danoeh/antennapod/core/util/download/FeedUpdateManager.java\nindex b09e58fad2..4fd75a6152 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/util/download/FeedUpdateManager.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/util/download/FeedUpdateManager.java\n@@ -98,7 +98,6 @@ public static void runOnceOrAsk(@NonNull Context context, @Nullable Feed feed) {\n     private static void confirmMobileRefresh(final Context context, @Nullable Feed feed) {\n         MaterialAlertDialogBuilder builder = new MaterialAlertDialogBuilder(context)\n                 .setTitle(R.string.feed_refresh_title)\n-                .setMessage(R.string.confirm_mobile_feed_refresh_dialog_message)\n                 .setPositiveButton(R.string.confirm_mobile_streaming_button_once,\n                         (dialog, which) -> runOnce(context, feed))\n                 .setNeutralButton(R.string.confirm_mobile_streaming_button_always, (dialog, which) -> {\n@@ -106,6 +105,11 @@ private static void confirmMobileRefresh(final Context context, @Nullable Feed f\n                     runOnce(context, feed);\n                 })\n                 .setNegativeButton(R.string.no, null);\n+        if (NetworkUtils.isNetworkRestricted() && NetworkUtils.isVpnOverWifi()) {\n+            builder.setMessage(R.string.confirm_mobile_feed_refresh_dialog_message_vpn);\n+        } else {\n+            builder.setMessage(R.string.confirm_mobile_feed_refresh_dialog_message);\n+        }\n         builder.show();\n     }\n \ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 6bdb836dd2..3a54246dae 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -201,6 +201,7 @@\n     <string name=\"add_tag\">Add tag</string>\n     <string name=\"rename_tag_label\">Rename tag</string>\n     <string name=\"confirm_mobile_feed_refresh_dialog_message\">Refreshing podcasts over mobile data connection is disabled in the settings.\\n\\nDo you want to refresh anyway?</string>\n+    <string name=\"confirm_mobile_feed_refresh_dialog_message_vpn\">Your VPN app pretends to be a mobile network (metered connection). Refreshing podcasts over mobile data connection is disabled in the settings.\\n\\nDo you want to refresh anyway? If you want this problem to be fixed, contact the creators of your VPN app.</string>\n \n     <!-- actions on feeditems -->\n     <string name=\"download_label\">Download</string>\n@@ -302,6 +303,7 @@\n     <string name=\"authentication_notification_title\">Authentication required</string>\n     <string name=\"confirm_mobile_download_dialog_title\">Confirm mobile download</string>\n     <string name=\"confirm_mobile_download_dialog_message\">Downloading over mobile data connection is disabled in the settings. AntennaPod can download the episode later automatically when Wi-Fi is available.</string>\n+    <string name=\"confirm_mobile_download_dialog_message_vpn\">Your VPN app pretends to be a mobile network (metered connection). Downloading over mobile data connection is disabled in the settings. If you want this problem to be fixed, contact the creators of your VPN app.</string>\n     <string name=\"confirm_mobile_download_dialog_download_later\">Download later</string>\n     <string name=\"confirm_mobile_download_dialog_allow_this_time\">Download anyway</string>\n     <string name=\"confirm_mobile_streaming_notification_title\">Confirm mobile streaming</string>\n", "test_patch": "", "problem_statement": "Cannot download over Cloudflare Warp\n### Checklist\r\n\r\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n### App version\r\n\r\n3.1.0\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Android version\r\n\r\n12\r\n\r\n### Device model\r\n\r\n_No response_\r\n\r\n### First occurred\r\n\r\npresent since last update\r\n\r\n### Steps to reproduce\r\n\r\n1. Enable Cloudflare Warp (free version)\r\n2. In AntennaPod, request a manual download of any episode\r\n\r\n### Expected behaviour\r\n\r\nEpisode downloads\r\n\r\n### Current behaviour\r\n\r\nThe progress circle turns dotted and sits in this state indefinitely. As soon as Cloudflare Warp is disabled, download begins.\r\n\r\n### Logs\r\n\r\n[your issue form is missing a box for additional notes, so I'm putting them here]\r\n\r\n- Cloudflare Warp app version 6.29.\r\n- Feed refresh does work over Warp.\r\n- Since last update, feed refresh seems to take much longer than before, with or without Warp (not necessarily a bug but a minor annoyance). [EDIT] Feel free to disregard this last item. I have not timed the refresh before upgrading the app, so this might be just a subjective perception.\n", "hints_text": "Do you have \"refresh+download over mobile data\" enabled in AntennaPod? Some VPN services pretend to be mobile networks in order to make apps use less traffic. In that case, AntennaPod waits until it has WiFi again (eg. VPN disabled) before starting the download.\nRefresh, yes. Download, no: it asks me every time if I'm on mobile data.\r\n\r\nJust tested:\r\n- on mobile data, Warp on, downloads over mobile disabled: a dialog pops up asking if I want to proceed\r\n- on WiFi, Warp on, downloads over mobile enabled: dowload commences immediately\r\n- on Wifi, Warp on, downloads over mobile disabled: no dialog and download doesn't start\r\n\r\nSo it seems your hypothesis is pointing in the right direction, but it's not the whole story: AntennaPod realises it's on WiFi so it doesn't show the dialog, but at the same time it thinks this wifi is \"sort of like\" mobile data and won't start the download.\r\n\r\nIs there any way for me to check if system reports current connection as metered? \nI looked into this a bit more. So the problem is that some VPNs report being metered connections. This is why on AntennaPod 3.0 and earlier, we had the following:\r\n\r\n- If VPN and WiFi somewhere in the network stack: Never metered, no matter what the Android system (eg the VPN app) tells us\r\n- Otherwise, do what the Android system tells us\r\n\r\nNow in 3.1, we have the same check but we rewrote the download service. The download is now handled by Android system components, which do not have the first VPN-specific check. That's why the following happens:\r\n\r\n- AntennaPod thinks it's not metered (because it works around misbehaving VPN apps)\r\n- It tells the Android system to start the download\r\n- The Android system waits until there is a non-metered connection\r\n\r\nSo, from AntennaPod's end, we need to use the same check as the Android system to fix this inconsistency. That means that users with misbehaving VPN apps will see the confirmation dialog on 3.1, while they got a direct download on 3.0. But at least it is no longer in an inconsistent state where we start a download that won't actually be scheduled by the system.\r\n\r\nIn the long term, VPN apps should stop messing with the network connection. This causes so much headache. People open VPN related issues every few days. And that's just because VPN companies are promising things that are straight up nonsense to make money from people not knowing what they are doing... (okay, enough rant about this VPN hype)", "created_at": "2023-09-10T23:19:23Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6633, "instance_id": "AntennaPod__AntennaPod-6633", "issue_numbers": ["6616"], "base_commit": "1e7c347cd2dfb68a5f42eefb878c12092659316a", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/service/FeedUpdateWorker.java b/core/src/main/java/de/danoeh/antennapod/core/service/FeedUpdateWorker.java\nindex b207db83b3..d71922e7be 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/FeedUpdateWorker.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/FeedUpdateWorker.java\n@@ -34,7 +34,6 @@\n import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n \n-import java.util.ArrayList;\n import java.util.Collections;\n import java.util.Iterator;\n import java.util.List;\n@@ -57,15 +56,10 @@ public Result doWork() {\n         ClientConfigurator.initialize(getApplicationContext());\n         newEpisodesNotification.loadCountersBeforeRefresh();\n \n-        if (!getInputData().getBoolean(FeedUpdateManager.EXTRA_EVEN_ON_MOBILE, false)) {\n-            if (!NetworkUtils.networkAvailable() || !NetworkUtils.isFeedRefreshAllowed()) {\n-                Log.d(TAG, \"Blocking automatic update: no wifi available / no mobile updates allowed\");\n-                return Result.retry();\n-            }\n-        }\n-\n         List<Feed> toUpdate;\n         long feedId = getInputData().getLong(FeedUpdateManager.EXTRA_FEED_ID, -1);\n+        boolean allAreLocal = true;\n+        boolean force = false;\n         if (feedId == -1) { // Update all\n             toUpdate = DBReader.getFeedList();\n             Iterator<Feed> itr = toUpdate.iterator();\n@@ -74,18 +68,31 @@ public Result doWork() {\n                 if (!feed.getPreferences().getKeepUpdated()) {\n                     itr.remove();\n                 }\n+                if (!feed.isLocalFeed()) {\n+                    allAreLocal = false;\n+                }\n             }\n             Collections.shuffle(toUpdate); // If the worker gets cancelled early, every feed has a chance to be updated\n-            refreshFeeds(toUpdate, false);\n         } else {\n-            toUpdate = new ArrayList<>();\n             Feed feed = DBReader.getFeed(feedId);\n             if (feed == null) {\n                 return Result.success();\n             }\n-            toUpdate.add(feed);\n-            refreshFeeds(toUpdate, true);\n+            if (!feed.isLocalFeed()) {\n+                allAreLocal = false;\n+            }\n+            toUpdate = Collections.singletonList(feed);\n+            force = true;\n         }\n+\n+        if (!getInputData().getBoolean(FeedUpdateManager.EXTRA_EVEN_ON_MOBILE, false) && !allAreLocal) {\n+            if (!NetworkUtils.networkAvailable() || !NetworkUtils.isFeedRefreshAllowed()) {\n+                Log.d(TAG, \"Blocking automatic update\");\n+                return Result.retry();\n+            }\n+        }\n+        refreshFeeds(toUpdate,  force);\n+\n         notificationManager.cancel(R.id.notification_updating_feeds);\n         DBTasks.autodownloadUndownloadedItems(getApplicationContext());\n         return Result.success();\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/util/download/FeedUpdateManager.java b/core/src/main/java/de/danoeh/antennapod/core/util/download/FeedUpdateManager.java\nindex b09e58fad2..f118409784 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/util/download/FeedUpdateManager.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/util/download/FeedUpdateManager.java\n@@ -47,7 +47,9 @@ public static void restartUpdateAlarm(Context context, boolean replace) {\n         } else {\n             PeriodicWorkRequest workRequest = new PeriodicWorkRequest.Builder(\n                     FeedUpdateWorker.class, UserPreferences.getUpdateInterval(), TimeUnit.HOURS)\n-                    .setConstraints(getConstraints())\n+                    .setConstraints(new Constraints.Builder()\n+                        .setRequiredNetworkType(UserPreferences.isAllowMobileFeedRefresh()\n+                            ? NetworkType.CONNECTED : NetworkType.UNMETERED).build())\n                     .build();\n             WorkManager.getInstance(context).enqueueUniquePeriodicWork(WORK_ID_FEED_UPDATE,\n                     replace ? ExistingPeriodicWorkPolicy.REPLACE : ExistingPeriodicWorkPolicy.KEEP, workRequest);\n@@ -66,9 +68,11 @@ public static void runOnce(Context context, Feed feed, boolean nextPage) {\n         OneTimeWorkRequest.Builder workRequest = new OneTimeWorkRequest.Builder(FeedUpdateWorker.class)\n                 .setInitialDelay(0L, TimeUnit.MILLISECONDS)\n                 .setExpedited(OutOfQuotaPolicy.RUN_AS_NON_EXPEDITED_WORK_REQUEST)\n-                .addTag(WORK_TAG_FEED_UPDATE)\n-                .setConstraints(new Constraints.Builder()\n+                .addTag(WORK_TAG_FEED_UPDATE);\n+        if (feed == null || !feed.isLocalFeed()) {\n+            workRequest.setConstraints(new Constraints.Builder()\n                     .setRequiredNetworkType(NetworkType.CONNECTED).build());\n+        }\n         Data.Builder builder = new Data.Builder();\n         builder.putBoolean(EXTRA_EVEN_ON_MOBILE, true);\n         if (feed != null) {\n@@ -86,7 +90,9 @@ public static void runOnceOrAsk(@NonNull Context context) {\n \n     public static void runOnceOrAsk(@NonNull Context context, @Nullable Feed feed) {\n         Log.d(TAG, \"Run auto update immediately in background.\");\n-        if (!NetworkUtils.networkAvailable()) {\n+        if (feed != null && feed.isLocalFeed()) {\n+            runOnce(context, feed);\n+        } else if (!NetworkUtils.networkAvailable()) {\n             EventBus.getDefault().post(new MessageEvent(context.getString(R.string.download_error_no_connection)));\n         } else if (NetworkUtils.isFeedRefreshAllowed()) {\n             runOnce(context, feed);\n@@ -108,16 +114,4 @@ private static void confirmMobileRefresh(final Context context, @Nullable Feed f\n                 .setNegativeButton(R.string.no, null);\n         builder.show();\n     }\n-\n-    private static Constraints getConstraints() {\n-        Constraints.Builder constraints = new Constraints.Builder();\n-\n-        if (UserPreferences.isAllowMobileFeedRefresh()) {\n-            constraints.setRequiredNetworkType(NetworkType.CONNECTED);\n-        } else {\n-            constraints.setRequiredNetworkType(NetworkType.UNMETERED);\n-        }\n-        return constraints.build();\n-    }\n-\n }\n", "test_patch": "", "problem_statement": "Adding local folder - content only added/updated when there is a network connection\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.1.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n9\n\n### Device model\n\nSamsung Galaxy XCover4\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Ensure that you have neither wifi nor data connection\r\n2. Add a local folder with suitable content\r\n3. Notice that the content in the folder isn't added/updated in the subscription view\r\n4. Upon switching on the data connection/wifi, and pressing refresh in the subscription, the local content is succesfully added.\r\n\r\nNote that (in principle) everything works. The bug is that, for whatever reason, the update on the (local) subscription content only works when there is a connection ... not sure why it should need that, that's why I'm filing it as a bug.\n\n### Expected behaviour\n\nAdding a local folder shouldn't require a data connection. So I thought it would be:\r\n\r\n1. Add local folder (without any form of data connection)\r\n2. and see the local content directly in the subscription/feed\n\n### Current behaviour\n\nsee error description above. I've tried it with various local folders/content and can see the (unexpectdly) requirement for a data connection in all of the local folders.\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2023-09-10T19:03:31Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6625, "instance_id": "AntennaPod__AntennaPod-6625", "issue_numbers": ["6612"], "base_commit": "8ebf1539705aa2251f0e7f795e72bb214e51750b", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/fragment/actions/FeedMultiSelectActionHandler.java b/app/src/main/java/de/danoeh/antennapod/fragment/actions/FeedMultiSelectActionHandler.java\nindex bbe78f4a22..78ddccf0b2 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/actions/FeedMultiSelectActionHandler.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/actions/FeedMultiSelectActionHandler.java\n@@ -36,6 +36,8 @@ public FeedMultiSelectActionHandler(MainActivity activity, List<Feed> selectedIt\n     public void handleAction(int id) {\n         if (id == R.id.remove_feed) {\n             RemoveFeedDialog.show(activity, selectedItems);\n+        } else if (id == R.id.notify_new_episodes) {\n+            notifyNewEpisodesPrefHandler();\n         } else if (id == R.id.keep_updated) {\n             keepUpdatedPrefHandler();\n         } else if (id == R.id.autodownload) {\n@@ -51,16 +53,21 @@ public void handleAction(int id) {\n         }\n     }\n \n+    private void notifyNewEpisodesPrefHandler() {\n+        PreferenceSwitchDialog preferenceSwitchDialog = new PreferenceSwitchDialog(activity,\n+                activity.getString(R.string.episode_notification),\n+                activity.getString(R.string.episode_notification_summary));\n+        preferenceSwitchDialog.setOnPreferenceChangedListener(enabled ->\n+                saveFeedPreferences(feedPreferences -> feedPreferences.setShowEpisodeNotification(enabled)));\n+        preferenceSwitchDialog.openDialog();\n+    }\n+\n     private void autoDownloadPrefHandler() {\n         PreferenceSwitchDialog preferenceSwitchDialog = new PreferenceSwitchDialog(activity,\n                 activity.getString(R.string.auto_download_settings_label),\n                 activity.getString(R.string.auto_download_label));\n-        preferenceSwitchDialog.setOnPreferenceChangedListener(new PreferenceSwitchDialog.OnPreferenceChangedListener() {\n-            @Override\n-            public void preferenceChanged(boolean enabled) {\n-                saveFeedPreferences(feedPreferences -> feedPreferences.setAutoDownload(enabled));\n-            }\n-        });\n+        preferenceSwitchDialog.setOnPreferenceChangedListener(enabled ->\n+                saveFeedPreferences(feedPreferences -> feedPreferences.setAutoDownload(enabled)));\n         preferenceSwitchDialog.openDialog();\n     }\n \n@@ -102,11 +109,8 @@ private void keepUpdatedPrefHandler() {\n         PreferenceSwitchDialog preferenceSwitchDialog = new PreferenceSwitchDialog(activity,\n                 activity.getString(R.string.kept_updated),\n                 activity.getString(R.string.keep_updated_summary));\n-        preferenceSwitchDialog.setOnPreferenceChangedListener(keepUpdated -> {\n-            saveFeedPreferences(feedPreferences -> {\n-                feedPreferences.setKeepUpdated(keepUpdated);\n-            });\n-        });\n+        preferenceSwitchDialog.setOnPreferenceChangedListener(keepUpdated ->\n+                saveFeedPreferences(feedPreferences -> feedPreferences.setKeepUpdated(keepUpdated)));\n         preferenceSwitchDialog.openDialog();\n     }\n \ndiff --git a/app/src/main/java/de/danoeh/antennapod/preferences/PreferenceUpgrader.java b/app/src/main/java/de/danoeh/antennapod/preferences/PreferenceUpgrader.java\nindex 0a1b56e25a..9fde8c1d9e 100644\n--- a/app/src/main/java/de/danoeh/antennapod/preferences/PreferenceUpgrader.java\n+++ b/app/src/main/java/de/danoeh/antennapod/preferences/PreferenceUpgrader.java\n@@ -3,6 +3,7 @@\n import android.content.Context;\n import android.content.SharedPreferences;\n import android.view.KeyEvent;\n+import androidx.core.app.NotificationManagerCompat;\n import androidx.preference.PreferenceManager;\n \n import java.util.concurrent.TimeUnit;\n@@ -147,5 +148,8 @@ private static void upgrade(int oldVersion, Context context) {\n                 prefs.edit().putString(UserPreferences.PREF_UPDATE_INTERVAL, \"12\").apply();\n             }\n         }\n+        if (oldVersion < 3020000) {\n+            NotificationManagerCompat.from(context).deleteNotificationChannel(\"auto_download\");\n+        }\n     }\n }\ndiff --git a/app/src/main/res/menu/nav_feed_action_speeddial.xml b/app/src/main/res/menu/nav_feed_action_speeddial.xml\nindex 15f2511fbe..250d12bc2a 100644\n--- a/app/src/main/res/menu/nav_feed_action_speeddial.xml\n+++ b/app/src/main/res/menu/nav_feed_action_speeddial.xml\n@@ -10,6 +10,11 @@\n         android:menuCategory=\"container\"\n         android:title=\"@string/keep_updated\"\n         android:icon=\"@drawable/ic_refresh\"/>\n+    <item\n+        android:id=\"@+id/notify_new_episodes\"\n+        android:menuCategory=\"container\"\n+        android:title=\"@string/episode_notification\"\n+        android:icon=\"@drawable/ic_notifications\"/>\n     <item\n         android:id=\"@+id/autodownload\"\n         android:menuCategory=\"container\"\ndiff --git a/app/src/main/res/xml/preferences_notifications.xml b/app/src/main/res/xml/preferences_notifications.xml\nindex 237ea5c993..34d3273401 100644\n--- a/app/src/main/res/xml/preferences_notifications.xml\n+++ b/app/src/main/res/xml/preferences_notifications.xml\n@@ -2,16 +2,6 @@\n <PreferenceScreen\n         xmlns:android=\"http://schemas.android.com/apk/res/android\">\n \n-    <PreferenceCategory\n-            android:title=\"@string/notification_group_news\">\n-        <SwitchPreferenceCompat\n-                android:defaultValue=\"false\"\n-                android:enabled=\"true\"\n-                android:key=\"prefShowAutoDownloadReport\"\n-                android:summary=\"@string/notification_channel_episode_auto_download\"\n-                android:title=\"@string/notification_channel_auto_download\" />\n-    </PreferenceCategory>\n-\n     <PreferenceCategory\n             android:title=\"@string/notification_group_errors\">\n         <SwitchPreferenceCompat\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/util/gui/NotificationUtils.java b/core/src/main/java/de/danoeh/antennapod/core/util/gui/NotificationUtils.java\nindex 79732ff327..d870cb1f86 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/util/gui/NotificationUtils.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/util/gui/NotificationUtils.java\n@@ -18,7 +18,6 @@ public class NotificationUtils {\n     public static final String CHANNEL_ID_PLAYING = \"playing\";\n     public static final String CHANNEL_ID_DOWNLOAD_ERROR = \"error\";\n     public static final String CHANNEL_ID_SYNC_ERROR = \"sync_error\";\n-    public static final String CHANNEL_ID_AUTO_DOWNLOAD = \"auto_download\";\n     public static final String CHANNEL_ID_EPISODE_NOTIFICATIONS = \"episode_notifications\";\n \n     public static final String GROUP_ID_ERRORS = \"group_errors\";\n@@ -38,7 +37,6 @@ public static void createChannels(final Context context) {\n                 createChannelPlaying(context),\n                 createChannelError(context),\n                 createChannelSyncError(context),\n-                createChannelAutoDownload(context),\n                 createChannelEpisodeNotification(context));\n         mNotificationManager.createNotificationChannelsCompat(channels);\n     }\n@@ -98,20 +96,6 @@ private static NotificationChannelCompat createChannelSyncError(final Context c)\n         return notificationChannel.build();\n     }\n \n-    private static NotificationChannelCompat createChannelAutoDownload(final Context c) {\n-        final NotificationChannelCompat.Builder notificationChannel = new NotificationChannelCompat.Builder(\n-                        CHANNEL_ID_AUTO_DOWNLOAD, NotificationManagerCompat.IMPORTANCE_NONE)\n-                .setName(c.getString(R.string.notification_channel_auto_download))\n-                .setDescription(c.getString(R.string.notification_channel_episode_auto_download))\n-                .setGroup(GROUP_ID_NEWS);\n-\n-        if (UserPreferences.getShowAutoDownloadReportRaw()) {\n-            // Migration from app managed setting: enable notification\n-            notificationChannel.setImportance(NotificationManagerCompat.IMPORTANCE_DEFAULT);\n-        }\n-        return notificationChannel.build();\n-    }\n-\n     private static NotificationChannelCompat createChannelEpisodeNotification(final Context c) {\n         return new NotificationChannelCompat.Builder(\n                         CHANNEL_ID_EPISODE_NOTIFICATIONS, NotificationManagerCompat.IMPORTANCE_DEFAULT)\ndiff --git a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\nindex f2b122fcca..c8ad3eec59 100644\n--- a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n+++ b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n@@ -56,7 +56,6 @@ private UserPreferences(){}\n     private static final String PREF_PERSISTENT_NOTIFICATION = \"prefPersistNotify\";\n     public static final String PREF_COMPACT_NOTIFICATION_BUTTONS = \"prefCompactNotificationButtons\";\n     private static final String PREF_SHOW_DOWNLOAD_REPORT = \"prefShowDownloadReport\";\n-    private static final String PREF_SHOW_AUTO_DOWNLOAD_REPORT = \"prefShowAutoDownloadReport\";\n     public static final String PREF_DEFAULT_PAGE = \"prefDefaultPage\";\n     public static final String PREF_FILTER_FEED = \"prefSubscriptionsFilter\";\n     public static final String PREF_SUBSCRIPTION_TITLE = \"prefSubscriptionTitle\";\n@@ -289,18 +288,6 @@ public static boolean isPersistNotify() {\n         return prefs.getBoolean(PREF_PERSISTENT_NOTIFICATION, true);\n     }\n \n-    /**\n-     * Returns true if download reports are shown\n-     *\n-     * @return {@code true} if download reports are shown, {@code false}  otherwise\n-     */\n-    public static boolean showDownloadReport() {\n-        if (Build.VERSION.SDK_INT >= 26) {\n-            return true; // System handles notification preferences\n-        }\n-        return prefs.getBoolean(PREF_SHOW_DOWNLOAD_REPORT, true);\n-    }\n-\n     /**\n      * Used for migration of the preference to system notification channels.\n      */\n@@ -308,31 +295,10 @@ public static boolean getShowDownloadReportRaw() {\n         return prefs.getBoolean(PREF_SHOW_DOWNLOAD_REPORT, true);\n     }\n \n-    public static boolean showAutoDownloadReport() {\n-        if (Build.VERSION.SDK_INT >= 26) {\n-            return true; // System handles notification preferences\n-        }\n-        return prefs.getBoolean(PREF_SHOW_AUTO_DOWNLOAD_REPORT, false);\n-    }\n-\n-    /**\n-     * Used for migration of the preference to system notification channels.\n-     */\n-    public static boolean getShowAutoDownloadReportRaw() {\n-        return prefs.getBoolean(PREF_SHOW_AUTO_DOWNLOAD_REPORT, false);\n-    }\n-\n     public static boolean enqueueDownloadedEpisodes() {\n         return prefs.getBoolean(PREF_ENQUEUE_DOWNLOADED, true);\n     }\n \n-    @VisibleForTesting\n-    public static void setEnqueueDownloadedEpisodes(boolean enqueueDownloadedEpisodes) {\n-        prefs.edit()\n-                .putBoolean(PREF_ENQUEUE_DOWNLOADED, enqueueDownloadedEpisodes)\n-                .apply();\n-    }\n-\n     public enum EnqueueLocation {\n         BACK, FRONT, AFTER_CURRENTLY_PLAYING, RANDOM\n     }\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 8178ec2207..51a9b143b5 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -811,8 +811,6 @@\n     <string name=\"notification_channel_download_error_description\">Shown when download or feed update fails.</string>\n     <string name=\"notification_channel_sync_error\">Synchronization failed</string>\n     <string name=\"notification_channel_sync_error_description\">Shown when gpodder synchronization fails.</string>\n-    <string name=\"notification_channel_auto_download\">Automatic download completed</string>\n-    <string name=\"notification_channel_episode_auto_download\">Shown when episodes have been automatically downloaded.</string>\n     <string name=\"notification_channel_new_episode\">New episode</string>\n     <string name=\"notification_channel_new_episode_description\">Shown when a new episode of a podcast was found, where notifications are enabled</string>\n \n", "test_patch": "", "problem_statement": "Remove redundant \"Automatic download completed\" notification setting\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.1.0 (91d5238f0)\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\nAndroid 13\n\n### Device model\n\nPixel 7\n\n### First occurred\n\nNot sure, might have been during one of the 3.1.0 betas\n\n### Steps to reproduce\n\n1. Ensure that the \"Automatic download completed\" notification is enabled\r\n2. Subscribe to at least one podcast\r\n3. Wait for new episodes to download\n\n### Expected behaviour\n\nA notification is shown reporting the newly-downloaded episode(s).\n\n### Current behaviour\n\nNo notification is shown.\n\n### Logs\n\n_No response_\n", "hints_text": "Now that we have the \"new episode notification\" setting, do we actually still need the auto-download notification? Feels like they both basically do the same thing.\nFor me personally I think it'd be fine indeed to remove this, agree it overlaps with new episode notifications.\nYeah, but I don't even get the \"New episode\" notification on 3.1.0. So I agree that they're redundant, but there's still something broken here.\n> Yeah, but I don't even get the \"New episode\" notification on 3.1.0.\r\n\r\nYou have to enable that notification on a per-podcast basis (you can also use multi-select for that).\nOh, I see now. Slightly unintuitive, and I didn't see a multi-select action for this in the Subscriptions view. In the end, I just exported the DB and used sqlite to enable the notifications for all my feeds, then re-imported the DB.\r\n\r\nWe can either close this issue, or rename it and use it to track the removal of the \"Automatic download completed\" option.\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/new-episode-notifications-not-coming-in/3400/3\n\n> I didn't see a multi-select action for this in the Subscriptions view.\r\n\r\nAh, right.\r\n\r\nSo what should be done here is the following:\r\n\r\n- [ ] Remove the \"automatic download completed\" setting\r\n- [ ] Add \"notify new episodes\" to the multi-select menu \nWould we also need a multi-select option to disable episode notifications?", "created_at": "2023-09-08T17:15:28Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6624, "instance_id": "AntennaPod__AntennaPod-6624", "issue_numbers": ["6622"], "base_commit": "8ebf1539705aa2251f0e7f795e72bb214e51750b", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/NewEpisodesNotification.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/NewEpisodesNotification.java\nindex c0cf9e0779..01038435d4 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/NewEpisodesNotification.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/download/NewEpisodesNotification.java\n@@ -94,7 +94,7 @@ private static void showGroupSummaryNotification(Context context, NotificationMa\n         intent.setAction(\"NewEpisodes\");\n         intent.setComponent(new ComponentName(context, \"de.danoeh.antennapod.activity.MainActivity\"));\n         intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);\n-        intent.putExtra(\"fragment_tag\", \"EpisodesFragment\");\n+        intent.putExtra(\"fragment_tag\", \"NewEpisodesFragment\");\n         PendingIntent pendingIntent = PendingIntent.getActivity(context, 0, intent,\n                 (Build.VERSION.SDK_INT >= 23 ? PendingIntent.FLAG_IMMUTABLE : 0));\n \n", "test_patch": "", "problem_statement": "Make notification about new episodes to open inbox\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.1.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Problem you may be having, or feature you want\n\nAntennaPod can notify about new episodes for podcasts. The current action when notification is tapped is to open the podcast which got new episodes.\r\nI guess when there is several podcasts notifying about new episodes there is also one notification per podcast?\r\n\r\nI only turned it on recently but it's really a nice feature and I am a lot less compelled to check inbox frequently to avoid starting a new episode when there is a podcast more interesting which released a new one.\r\n\r\nYet going to podcast screen is not really useful as afterward you would need to either : \r\n- go back to default screen,\r\n- tap x other notifications (if there is one for each podcast),\r\n- look at inbox for any other new episodes for which notifying hasn't been turned on.\n\n### Suggested solution\n\nIt would be nice and more logical (in my opinion) to have an unique notification listing all podcasts having new episodes (and for which notify as been turned on). If there is too many podcasts it would just say \"and x more\".\r\n\r\nWhen tapping it it should open inbox. So user would be on the correct screen to decide which new episodes to download / add to queue or remove from inbox.\r\n\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": ">  If there is too many podcasts it would just say \"and x more\".\n\nI think that's already what's supposed to happen (?)\nThere is one notification per podcast, but they are grouped together and collapsed down to a single notification by the Android system (just like it is done when you receive multiple emails). If you press the collapsed group, you get to the \"all episodes\" page. If you expand the group and press the feed-specific notification, you get to the feed-specific page.", "created_at": "2023-09-08T16:53:38Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6623, "instance_id": "AntennaPod__AntennaPod-6623", "issue_numbers": ["6606"], "base_commit": "8ebf1539705aa2251f0e7f795e72bb214e51750b", "patch": "diff --git a/core/src/main/res/values/styles.xml b/core/src/main/res/values/styles.xml\nindex f1dcd32008..c5cad7522b 100644\n--- a/core/src/main/res/values/styles.xml\n+++ b/core/src/main/res/values/styles.xml\n@@ -41,7 +41,7 @@\n         <item name=\"colorOnPrimaryContainer\">@color/white</item>\n         <item name=\"android:windowBackground\">@color/background_light</item>\n         <item name=\"colorSurface\">@color/background_light</item>\n-        <item name=\"colorSurfaceVariant\">#B8E4FF</item>\n+        <item name=\"colorSurfaceVariant\">#D3DCE0</item>\n     </style>\n \n     <style name=\"Theme.AntennaPod.Dynamic.Dark\" parent=\"Theme.Base.AntennaPod.Dynamic.Dark\">\n@@ -83,7 +83,7 @@\n         <item name=\"colorOnPrimaryContainer\">@color/black</item>\n         <item name=\"android:windowBackground\">@color/background_darktheme</item>\n         <item name=\"colorSurface\">@color/background_darktheme</item>\n-        <item name=\"colorSurfaceVariant\">#1B3B6A</item>\n+        <item name=\"colorSurfaceVariant\">#2F3B4F</item>\n     </style>\n \n     <style name=\"Theme.AntennaPod.Dynamic.TrueBlack\" parent=\"Theme.AntennaPod.Dynamic.Dark\">\n", "test_patch": "", "problem_statement": "New preference switches can be hard to interpret\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.1.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\nPixel 3a\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\nThere are some differences between the new preference switches implemented in #6475 and the ones used e.g. in system settings on my stock Android 12 device (see screenshot below - system settings on top, AP below). \r\n\r\nWhile I initially shrugged this off as merely a cosmetic difference, the more I use the new switches, the more I am convinced the AP version is confusing and makes it hard to tell whether a setting is on or off.\r\n\r\nWhen I check the Material Design guidelines on [switches](https://m3.material.io/components/switch/guidelines), I see they also include a checkmark when a setting is \"on\". Would it be possible to include that? (I assume that would be the easiest way to address the issue.)\r\n\r\n![screenshot](https://github.com/AntennaPod/AntennaPod/assets/25279797/70ea7bf9-5916-4113-b547-531bc738ac6a)\r\n\n\n### Expected behaviour\n\n_No response_\n\n### Current behaviour\n\n_No response_\n\n### Logs\n\n_No response_\n", "hints_text": "Hmm, I wouldn't add an icon to all of them because that adds visual clutter. Did you try turning on \"dynamic app colors\" in AntennaPod? That seems to have a much better contrast between on and off, which means that our default theme colors might be \"too blue\".\nYes, I confirm that turning on dynamic colours does alleviate the problem.\r\n\r\nThe issue with the default colours probably comes from the combination of two factors:\r\n- The \"off\" state doesn't look greyed out\r\n- The thumb in the \"on\" state is very dark.", "created_at": "2023-09-08T16:50:02Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6600, "instance_id": "AntennaPod__AntennaPod-6600", "issue_numbers": ["6566"], "base_commit": "4182f83367379f5da92ca3cf9bb53048fed71f74", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/synchronization/NextcloudAuthenticationFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/synchronization/NextcloudAuthenticationFragment.java\nindex 14440be476..2c9e555f1b 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/synchronization/NextcloudAuthenticationFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/synchronization/NextcloudAuthenticationFragment.java\n@@ -23,6 +23,7 @@\n public class NextcloudAuthenticationFragment extends DialogFragment\n         implements NextcloudLoginFlow.AuthenticationCallback {\n     public static final String TAG = \"NextcloudAuthenticationFragment\";\n+    private static final String EXTRA_LOGIN_FLOW = \"LoginFlow\";\n     private NextcloudAuthDialogBinding viewBinding;\n     private NextcloudLoginFlow nextcloudLoginFlow;\n     private boolean shouldDismiss = false;\n@@ -40,17 +41,34 @@ public Dialog onCreateDialog(@Nullable Bundle savedInstanceState) {\n         dialog.setView(viewBinding.getRoot());\n \n         viewBinding.chooseHostButton.setOnClickListener(v -> {\n-            viewBinding.errorText.setVisibility(View.GONE);\n-            viewBinding.chooseHostButton.setVisibility(View.GONE);\n-            viewBinding.loginProgressContainer.setVisibility(View.VISIBLE);\n             nextcloudLoginFlow = new NextcloudLoginFlow(AntennapodHttpClient.getHttpClient(),\n                     viewBinding.serverUrlText.getText().toString(), getContext(), this);\n-            nextcloudLoginFlow.start();\n+            startLoginFlow();\n         });\n-\n+        if (savedInstanceState != null && savedInstanceState.getStringArrayList(EXTRA_LOGIN_FLOW) != null) {\n+            nextcloudLoginFlow = NextcloudLoginFlow.fromInstanceState(AntennapodHttpClient.getHttpClient(),\n+                    getContext(), this, savedInstanceState.getStringArrayList(EXTRA_LOGIN_FLOW));\n+            startLoginFlow();\n+        }\n         return dialog.create();\n     }\n \n+    private void startLoginFlow() {\n+        viewBinding.errorText.setVisibility(View.GONE);\n+        viewBinding.chooseHostButton.setVisibility(View.GONE);\n+        viewBinding.loginProgressContainer.setVisibility(View.VISIBLE);\n+        viewBinding.serverUrlText.setEnabled(false);\n+        nextcloudLoginFlow.start();\n+    }\n+\n+    @Override\n+    public void onSaveInstanceState(@NonNull Bundle outState) {\n+        super.onSaveInstanceState(outState);\n+        if (nextcloudLoginFlow != null) {\n+            outState.putStringArrayList(EXTRA_LOGIN_FLOW, nextcloudLoginFlow.saveInstanceState());\n+        }\n+    }\n+\n     @Override\n     public void onDismiss(@NonNull DialogInterface dialog) {\n         super.onDismiss(dialog);\n@@ -75,7 +93,7 @@ public void onNextcloudAuthenticated(String server, String username, String pass\n         SynchronizationCredentials.setHosturl(server);\n         SynchronizationCredentials.setUsername(username);\n         SyncService.fullSync(getContext());\n-        if (isVisible()) {\n+        if (isResumed()) {\n             dismiss();\n         } else {\n             shouldDismiss = true;\n@@ -88,5 +106,6 @@ public void onNextcloudAuthError(String errorMessage) {\n         viewBinding.errorText.setVisibility(View.VISIBLE);\n         viewBinding.errorText.setText(errorMessage);\n         viewBinding.chooseHostButton.setVisibility(View.VISIBLE);\n+        viewBinding.serverUrlText.setEnabled(true);\n     }\n }\ndiff --git a/net/sync/gpoddernet/src/main/java/de/danoeh/antennapod/net/sync/nextcloud/NextcloudLoginFlow.java b/net/sync/gpoddernet/src/main/java/de/danoeh/antennapod/net/sync/nextcloud/NextcloudLoginFlow.java\nindex 3ad171f7fe..3d2374acf9 100644\n--- a/net/sync/gpoddernet/src/main/java/de/danoeh/antennapod/net/sync/nextcloud/NextcloudLoginFlow.java\n+++ b/net/sync/gpoddernet/src/main/java/de/danoeh/antennapod/net/sync/nextcloud/NextcloudLoginFlow.java\n@@ -21,6 +21,7 @@\n import java.io.IOException;\n import java.net.URI;\n import java.net.URL;\n+import java.util.ArrayList;\n import java.util.concurrent.TimeUnit;\n \n public class NextcloudLoginFlow {\n@@ -28,6 +29,7 @@ public class NextcloudLoginFlow {\n \n     private final OkHttpClient httpClient;\n     private final HostnameParser hostname;\n+    private final String rawHostUrl;\n     private final Context context;\n     private final AuthenticationCallback callback;\n     private String token;\n@@ -38,12 +40,33 @@ public class NextcloudLoginFlow {\n     public NextcloudLoginFlow(OkHttpClient httpClient, String hostUrl, Context context,\n                               AuthenticationCallback callback) {\n         this.httpClient = httpClient;\n+        this.rawHostUrl = hostUrl;\n         this.hostname = new HostnameParser(hostUrl);\n         this.context = context;\n         this.callback = callback;\n     }\n \n+    public static NextcloudLoginFlow fromInstanceState(OkHttpClient httpClient, Context context,\n+                               AuthenticationCallback callback, ArrayList<String> instanceState) {\n+        NextcloudLoginFlow flow = new NextcloudLoginFlow(httpClient, instanceState.get(0), context, callback);\n+        flow.token = instanceState.get(1);\n+        flow.endpoint = instanceState.get(2);\n+        return flow;\n+    }\n+\n+    public ArrayList<String> saveInstanceState() {\n+        ArrayList<String> state = new ArrayList<>();\n+        state.add(rawHostUrl);\n+        state.add(token);\n+        state.add(endpoint);\n+        return state;\n+    }\n+\n     public void start() {\n+        if (token != null) {\n+            poll();\n+            return;\n+        }\n         startDisposable = Observable.fromCallable(() -> {\n             URL url = new URI(hostname.scheme, null, hostname.host, hostname.port,\n                     hostname.subfolder + \"/index.php/login/v2\", null, null).toURL();\n@@ -62,6 +85,8 @@ public void start() {\n                         poll();\n                     }, error -> {\n                         Log.e(TAG, Log.getStackTraceString(error));\n+                        this.token = null;\n+                        this.endpoint = null;\n                         callback.onNextcloudAuthError(error.getLocalizedMessage());\n                     });\n     }\n@@ -74,7 +99,11 @@ private void poll() {\n                 .observeOn(AndroidSchedulers.mainThread())\n                 .subscribe(result -> callback.onNextcloudAuthenticated(\n                         result.getString(\"server\"), result.getString(\"loginName\"), result.getString(\"appPassword\")),\n-                    error -> callback.onNextcloudAuthError(error.getLocalizedMessage()));\n+                    error -> {\n+                        this.token = null;\n+                        this.endpoint = null;\n+                        callback.onNextcloudAuthError(error.getLocalizedMessage());\n+                    });\n     }\n \n     public void cancel() {\n", "test_patch": "", "problem_statement": "Can't setup sync with nextcloud, antennapod does not notice me logging in with firefox focus\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.0.2\n\n### Where did you get the app from\n\nF-Droid\n\n### Android version\n\n7\n\n### Device model\n\n_No response_\n\n### First occurred\n\nnow\n\n### Steps to reproduce\n\n1. go to settings -> sync -> add -> gpoddersync nextcloud\r\n2. enter my server's domain\r\n3. firefox focus opens with the login page\r\n4. I successfully log in with an app-token and nextcloud the site says I can now close the window\r\n5. I close the firefox window and switch back antenna pod\r\n6. Antennapod is still on the screen where I put in my server address.\r\n7. The login was not added to antennapod\n\n### Expected behaviour\n\nAfter I log into nextcloud, I get back to antenna pod and it has my server added for syncing.\r\n\r\nOr it would not open firefox focus in the first place and it lets me put my login into Antennapod itself.\n\n### Current behaviour\n\nAntenna pod does not notice me logging into nextcloud after it opens the firefox focus window.\r\nAntenna pod does not notice me closing firefox focus.\n\n### Logs\n\n_No response_\n", "hints_text": "Duplicate of #5841. @ByteHamster, would it be feasible to only open \"in-app browser\" for the sync authentication flows? And do you think it'd prevent this issue from happening? (I don't recall from our discussions if it would.)\n\nIf both answers are yes, then maybe we should reconsider our previous decision.\n@mxnemu Can you please, instead of going back in your step 5, follow these steps suggested by another user?\n\n> What worked for me was:\n>\n> Insert hostname and Firefox pops up\n> Login & authorize app as described above\n> When reading \"You can close your window now\", switch to AntennaPod with the task switcher\n> AntennaPod can login successfully\nThank you for the quick reply, and sorry for missing the duplicate.\r\n\r\n> @mxnemu Can you please, instead of going back in your step 5, follow these steps suggested by another user?\r\n> \r\n> > What worked for me was:\r\n> > Insert hostname and Firefox pops up\r\n> > Login & authorize app as described above\r\n> > When reading \"You can close your window now\", switch to AntennaPod with the task switcher\r\n> > AntennaPod can login successfully\r\n\r\nSadly that doesn't work for me. I just see the same thing on step 6.\r\nI also do not see the spinner from the OPs screenshot after coming back. The UI is back to the 'continue to sign on' button by then. \r\n\r\nAlso my nextcloud is reachable on a public domain, is not in a folder path, and has a valid letsencrypt cert. \r\n\r\n\nDid you change the \"background app limit\" stuff in the developer options of your device? Messing with that setting could have the effect you are seeing \n> Did you change the \"background app limit\" stuff in the developer options of your device? Messing with that setting could have the effect you are seeing\r\n\r\nNo, it's on \"default limit\". I tried setting it to 4 (the maximum offered) and saw no change. In the developer options -> inactive apps list both antennapod and firefox focus are listed as active.  ", "created_at": "2023-08-25T19:26:09Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6589, "instance_id": "AntennaPod__AntennaPod-6589", "issue_numbers": ["6583"], "base_commit": "5ae766b1a1557e2a54627e6b3c83c54c6578995d", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\nindex b66edc884a..b42fb6d5fa 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n@@ -37,6 +37,7 @@\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.core.preferences.ThemeSwitcher;\n import de.danoeh.antennapod.core.receiver.MediaButtonReceiver;\n+import de.danoeh.antennapod.core.sync.queue.SynchronizationQueueSink;\n import de.danoeh.antennapod.core.util.download.FeedUpdateManager;\n import de.danoeh.antennapod.dialog.RatingDialog;\n import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n@@ -165,6 +166,8 @@ public void onCreate(Bundle savedInstanceState) {\n         sheetBehavior.setBottomSheetCallback(bottomSheetCallback);\n \n         FeedUpdateManager.restartUpdateAlarm(this, false);\n+        SynchronizationQueueSink.syncNowIfNotSyncedRecently();\n+\n         WorkManager.getInstance(this)\n                 .getWorkInfosByTagLiveData(FeedUpdateManager.WORK_TAG_FEED_UPDATE)\n                 .observe(this, workInfos -> {\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/sync/queue/SynchronizationQueueSink.java b/core/src/main/java/de/danoeh/antennapod/core/sync/queue/SynchronizationQueueSink.java\nindex 55c415153b..12559539fd 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/sync/queue/SynchronizationQueueSink.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/sync/queue/SynchronizationQueueSink.java\n@@ -19,6 +19,12 @@ public static void syncNow() {\n         serviceStarterImpl.run();\n     }\n \n+    public static void syncNowIfNotSyncedRecently() {\n+        if (System.currentTimeMillis() - SynchronizationSettings.getLastSyncAttempt() > 1000 * 60 * 10) {\n+            syncNow();\n+        }\n+    }\n+\n     public static void clearQueue(Context context) {\n         LockingAsyncExecutor.executeLockedAsync(new SynchronizationQueueStorage(context)::clearQueue);\n     }\n", "test_patch": "", "problem_statement": "Sync upon app startup\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.0.2\n\n### Where did you get the app from\n\nF-Droid\n\n### Problem you may be having, or feature you want\n\nI'm wondering whether the current AntennaPod support syncing upon app startup. If not, I hope you can consider adding it as an option. The situation is I'm listening to podcasts across devices, and I've setup syncing the state via nextcloud, which is fine.  But now, If I've listened an episode on device A (perhaps in a PC), and I need to go and want to listen to continue what's left over on device B (e.g., a cellphone), I have to manually sync the state since the duration of these operation is not long enough to trigger the automatic sync operation of antennapod. Thus,  I think it would be nice to add an option to enable syncing upon the startup of antennapod in the cellphone, So we can continue listening the same podcast seamlessly. Hope I made the suggestion clear. Thanks in advance.\n\n### Suggested solution\n\n_No response_\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "I don't think there should be a setting - AntennaPod should just do that. There should be some kind of cool-down so if you open the app twice within, say, 1 hour, it should not sync the second time.\n> There should be some kind of cool-down so if you open the app twice within, say, 1 hour, it should not sync the second time.\n\nDoes it really hurt to quickly check in with the server to see if anything has changed on each start?\n\nAlso I was wondering what constitutes 'start the app'; from another issue I seem to remember that this hardly ever happens and/or is hard to determine.\nYeah, it's hard to define what users mean with \"start the app\". That's why I would check every time a user sees the app, but with some kind of timeout, so when users switch back and forth between apps, it does not check again and again.\n> Yeah, it's hard to define what users mean with \"start the app\".\r\n\r\nIn another thought, you're right, maybe it is really not clear to define the meaning of \"start the app\" considering different user behaviors. \r\n\r\n\r\nMy main point is to make sure the status is always up to date. Considering various situations that maybe the automatic syncing is not working well (maybe the network connection is weak or lost when AntennaPod start automatic syncing, \ud83e\udd23, in my personal experience, AntennaPod-to-server seems smooth, but server-to-AntennaPod sometimes goes wrong), would it be possible to add an option to manually trigger the syncing behavior with the server without going deep to the setting?  \r\n\r\n\r\nMaybe by triggering the syncing behavior when we pull down to update the episodes (except updating the information from the podcast server, but also communicating with the setup syncing server to update the listening status. Does the current pulling down already this way\ud83e\udd23)? In this way, when we open or switch to AntennaPod to check the episode updates, we can also fetch the latest status from the server. \r\n\r\nThanks.\r\n\r\n\r\n\r\n", "created_at": "2023-08-19T08:34:24Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6588, "instance_id": "AntennaPod__AntennaPod-6588", "issue_numbers": ["6577"], "base_commit": "ca9358234f9e806cbc6271159daed49f744942ca", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/EpisodeDownloadWorker.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/EpisodeDownloadWorker.java\nindex 2489ba2ba6..56aee63a2f 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/EpisodeDownloadWorker.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/download/EpisodeDownloadWorker.java\n@@ -62,10 +62,14 @@ public Result doWork() {\n         Thread progressUpdaterThread = new Thread() {\n             @Override\n             public void run() {\n-                while (!isInterrupted()) {\n+                while (true) {\n                     try {\n-                        Thread.sleep(1000);\n-                        notificationProgress.put(media.getEpisodeTitle(), request.getProgressPercent());\n+                        synchronized (notificationProgress) {\n+                            if (isInterrupted()) {\n+                                return;\n+                            }\n+                            notificationProgress.put(media.getEpisodeTitle(), request.getProgressPercent());\n+                        }\n                         setProgressAsync(\n                                 new Data.Builder()\n                                     .putInt(DownloadServiceInterface.WORK_DATA_PROGRESS, request.getProgressPercent())\n@@ -74,6 +78,7 @@ public void run() {\n                         NotificationManager nm = (NotificationManager) getApplicationContext()\n                                 .getSystemService(Context.NOTIFICATION_SERVICE);\n                         nm.notify(R.id.notification_downloading, generateProgressNotification());\n+                        Thread.sleep(1000);\n                     } catch (InterruptedException | ExecutionException e) {\n                         return;\n                     }\n@@ -94,11 +99,13 @@ public void run() {\n         } catch (InterruptedException e) {\n             e.printStackTrace();\n         }\n-        notificationProgress.remove(media.getEpisodeTitle());\n-        if (notificationProgress.isEmpty()) {\n-            NotificationManager nm = (NotificationManager) getApplicationContext()\n-                    .getSystemService(Context.NOTIFICATION_SERVICE);\n-            nm.cancel(R.id.notification_downloading);\n+        synchronized (notificationProgress) {\n+            notificationProgress.remove(media.getEpisodeTitle());\n+            if (notificationProgress.isEmpty()) {\n+                NotificationManager nm = (NotificationManager) getApplicationContext()\n+                        .getSystemService(Context.NOTIFICATION_SERVICE);\n+                nm.cancel(R.id.notification_downloading);\n+            }\n         }\n         Log.d(TAG, \"Worker for \" + media.getDownload_url() + \" returned.\");\n         return result;\n", "test_patch": "", "problem_statement": "[3.1.0-beta3] \"Downloading episodes\" notification sometimes fails to clear\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.1.0-beta3\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n13\n\n### Device model\n\nPixel 7\n\n### First occurred\n\nAfter upgradiing to 3.1.0-beta2 from 3.0\n\n### Steps to reproduce\n\n1. Wait for automatic downloads to start\n\n### Expected behaviour\n\n\"Downloading episodes\" notification goes away once downloads are completed\n\n### Current behaviour\n\nNotification fails to clear, even though downloads are completed. The only way to clear it is to go into AntennaPod's notification settings and disable/re-enable the \"Downloading\" notification.\r\n\r\nOne thing I noticed about this issue: the notification says that there are 2 downloads remaining, but when you expand the notification, only one episode shows up. See the screenshots below.\r\n\r\n![Screenshot_20230812-083010](https://github.com/AntennaPod/AntennaPod/assets/328598/7fa0fc2a-abee-465c-8fc5-7b2a6be45209)\r\n\r\n![Screenshot_20230812-083036](https://github.com/AntennaPod/AntennaPod/assets/328598/c5eb4da0-8233-47d9-9dd1-cd4394d4f6ce)\r\n\r\nWithout digging into the code, I suspect that there may be an off-by-one error in the code that manages the \"Downloading episodes\" notification.\r\n\r\nThere is no traceback, and no errors found in the debug log.\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2023-08-19T08:22:30Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6587, "instance_id": "AntennaPod__AntennaPod-6587", "issue_numbers": ["6556"], "base_commit": "ca9358234f9e806cbc6271159daed49f744942ca", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/view/NoRelayoutTextView.java b/app/src/main/java/de/danoeh/antennapod/view/NoRelayoutTextView.java\nindex 3f921b4452..cbb2ef0af5 100644\n--- a/app/src/main/java/de/danoeh/antennapod/view/NoRelayoutTextView.java\n+++ b/app/src/main/java/de/danoeh/antennapod/view/NoRelayoutTextView.java\n@@ -1,6 +1,5 @@\n package de.danoeh.antennapod.view;\n \n-import android.annotation.SuppressLint;\n import android.content.Context;\n import android.util.AttributeSet;\n import androidx.annotation.NonNull;\n@@ -8,6 +7,9 @@\n import androidx.appcompat.widget.AppCompatTextView;\n \n public class NoRelayoutTextView extends AppCompatTextView {\n+    private boolean requestLayoutEnabled = false;\n+    private float maxTextLength = 0;\n+\n     public NoRelayoutTextView(@NonNull Context context) {\n         super(context);\n     }\n@@ -20,9 +22,21 @@ public NoRelayoutTextView(@NonNull Context context, @Nullable AttributeSet attrs\n         super(context, attrs, defStyleAttr);\n     }\n \n-    @SuppressLint(\"MissingSuperCall\")\n     @Override\n     public void requestLayout() {\n-        // Deliberate no-op\n+        if (requestLayoutEnabled) {\n+            super.requestLayout();\n+        }\n+        requestLayoutEnabled = false;\n+    }\n+\n+    @Override\n+    public void setText(CharSequence text, BufferType type) {\n+        float textLength = getPaint().measureText(text.toString());\n+        if (textLength > maxTextLength) {\n+            maxTextLength = textLength;\n+            requestLayoutEnabled = true;\n+        }\n+        super.setText(text, type);\n     }\n }\n", "test_patch": "", "problem_statement": "Podcast time visual bug\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\napp version : 3.1.0-beta3\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\nAndoid 12\n\n### Device model\n\nRealme c31 (RMX3501)\n\n### First occurred\n\n2 days ago\n\n### Steps to reproduce\n\nPlay any podcast\n\n### Expected behaviour\n\n![Screenshot_20230725-110837](https://github.com/AntennaPod/AntennaPod/assets/140496950/ba91b859-7ce3-4025-9d7c-7d68f0e44ba6)\r\nTime of video works normal it shows 0:01:19\n\n### Current behaviour\n\n![Screenshot_20230725-110849](https://github.com/AntennaPod/AntennaPod/assets/140496950/64114488-7635-476d-870c-79214a038ac2)\r\nInstead it shows 0:1:1\n\n### Logs\n\n_No response_\n", "hints_text": "This issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/remaining-time-truncated-in-playback-screen/3219/9\n", "created_at": "2023-08-19T08:12:31Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6573, "instance_id": "AntennaPod__AntennaPod-6573", "issue_numbers": ["5286"], "base_commit": "5ae766b1a1557e2a54627e6b3c83c54c6578995d", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/fragment/FeedSettingsFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/FeedSettingsFragment.java\nindex ae9e003d50..0e4c883cfe 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/FeedSettingsFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/FeedSettingsFragment.java\n@@ -156,7 +156,7 @@ public void onCreatePreferences(Bundle savedInstanceState, String rootKey) {\n                         setupAutoDownloadPreference();\n                         setupKeepUpdatedPreference();\n                         setupAutoDeletePreference();\n-                        setupVolumeReductionPreferences();\n+                        setupVolumeAdaptationPreferences();\n                         setupNewEpisodesAction();\n                         setupAuthentificationPreference();\n                         setupEpisodeFilterPreference();\n@@ -166,7 +166,7 @@ public void onCreatePreferences(Bundle savedInstanceState, String rootKey) {\n                         setupTags();\n \n                         updateAutoDeleteSummary();\n-                        updateVolumeReductionValue();\n+                        updateVolumeAdaptationValue();\n                         updateAutoDownloadEnabled();\n                         updateNewEpisodesAction();\n \n@@ -317,9 +317,9 @@ private void updateAutoDeleteSummary() {\n             }\n         }\n \n-        private void setupVolumeReductionPreferences() {\n-            ListPreference volumeReductionPreference = findPreference(\"volumeReduction\");\n-            volumeReductionPreference.setOnPreferenceChangeListener((preference, newValue) -> {\n+        private void setupVolumeAdaptationPreferences() {\n+            ListPreference volumeAdaptationPreference = findPreference(\"volumeReduction\");\n+            volumeAdaptationPreference.setOnPreferenceChangeListener((preference, newValue) -> {\n                 switch ((String) newValue) {\n                     case \"off\":\n                         feedPreferences.setVolumeAdaptionSetting(VolumeAdaptionSetting.OFF);\n@@ -330,28 +330,46 @@ private void setupVolumeReductionPreferences() {\n                     case \"heavy\":\n                         feedPreferences.setVolumeAdaptionSetting(VolumeAdaptionSetting.HEAVY_REDUCTION);\n                         break;\n+                    case \"light_boost\":\n+                        feedPreferences.setVolumeAdaptionSetting(VolumeAdaptionSetting.LIGHT_BOOST);\n+                        break;\n+                    case \"medium_boost\":\n+                        feedPreferences.setVolumeAdaptionSetting(VolumeAdaptionSetting.MEDIUM_BOOST);\n+                        break;\n+                    case \"heavy_boost\":\n+                        feedPreferences.setVolumeAdaptionSetting(VolumeAdaptionSetting.HEAVY_BOOST);\n+                        break;\n                     default:\n                 }\n                 DBWriter.setFeedPreferences(feedPreferences);\n-                updateVolumeReductionValue();\n+                updateVolumeAdaptationValue();\n                 EventBus.getDefault().post(\n                         new VolumeAdaptionChangedEvent(feedPreferences.getVolumeAdaptionSetting(), feed.getId()));\n                 return false;\n             });\n         }\n \n-        private void updateVolumeReductionValue() {\n-            ListPreference volumeReductionPreference = findPreference(\"volumeReduction\");\n+        private void updateVolumeAdaptationValue() {\n+            ListPreference volumeAdaptationPreference = findPreference(\"volumeReduction\");\n \n             switch (feedPreferences.getVolumeAdaptionSetting()) {\n                 case OFF:\n-                    volumeReductionPreference.setValue(\"off\");\n+                    volumeAdaptationPreference.setValue(\"off\");\n                     break;\n                 case LIGHT_REDUCTION:\n-                    volumeReductionPreference.setValue(\"light\");\n+                    volumeAdaptationPreference.setValue(\"light\");\n                     break;\n                 case HEAVY_REDUCTION:\n-                    volumeReductionPreference.setValue(\"heavy\");\n+                    volumeAdaptationPreference.setValue(\"heavy\");\n+                    break;\n+                case LIGHT_BOOST:\n+                    volumeAdaptationPreference.setValue(\"light_boost\");\n+                    break;\n+                case MEDIUM_BOOST:\n+                    volumeAdaptationPreference.setValue(\"medium_boost\");\n+                    break;\n+                case HEAVY_BOOST:\n+                    volumeAdaptationPreference.setValue(\"heavy_boost\");\n                     break;\n             }\n         }\ndiff --git a/app/src/main/res/xml/feed_settings.xml b/app/src/main/res/xml/feed_settings.xml\nindex 619ab62966..fb9e2e4254 100644\n--- a/app/src/main/res/xml/feed_settings.xml\n+++ b/app/src/main/res/xml/feed_settings.xml\n@@ -50,12 +50,12 @@\n \n     <de.danoeh.antennapod.preferences.MaterialListPreference\n         android:defaultValue=\"off\"\n-        android:entries=\"@array/spnVolumeReductionItems\"\n-        android:entryValues=\"@array/spnVolumeReductionValues\"\n+        android:entries=\"@array/spnVolumeAdaptationItems\"\n+        android:entryValues=\"@array/spnVolumeAdaptationValues\"\n         android:icon=\"@drawable/ic_volume_adaption\"\n         android:key=\"volumeReduction\"\n-        android:summary=\"@string/feed_volume_reduction_summary\"\n-        android:title=\"@string/feed_volume_reduction\" />\n+        android:summary=\"@string/feed_volume_adaptation_summary\"\n+        android:title=\"@string/feed_volume_adapdation\" />\n \n     <de.danoeh.antennapod.preferences.MaterialListPreference\n         android:entries=\"@array/feedNewEpisodesActionItems\"\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/ExoPlayerWrapper.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/ExoPlayerWrapper.java\nindex e0c5da00bb..c275444d9a 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/ExoPlayerWrapper.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/ExoPlayerWrapper.java\n@@ -1,6 +1,7 @@\n package de.danoeh.antennapod.core.service.playback;\n \n import android.content.Context;\n+import android.media.audiofx.LoudnessEnhancer;\n import android.net.Uri;\n import android.text.TextUtils;\n import android.util.Log;\n@@ -68,6 +69,8 @@ public class ExoPlayerWrapper {\n     private PlaybackParameters playbackParameters;\n     private DefaultTrackSelector trackSelector;\n \n+    private LoudnessEnhancer loudnessEnhancer;\n+\n     ExoPlayerWrapper(Context context) {\n         this.context = context;\n         createPlayer();\n@@ -133,7 +136,14 @@ public void onPositionDiscontinuity(@NonNull Player.PositionInfo oldPosition,\n                     audioSeekCompleteListener.run();\n                 }\n             }\n+\n+            @Override\n+            public void onAudioSessionIdChanged(int audioSessionId) {\n+                initLoudnessEnhancer(audioSessionId);\n+            }\n         });\n+\n+        initLoudnessEnhancer(exoPlayer.getAudioSessionId());\n     }\n \n     public int getCurrentPosition() {\n@@ -235,7 +245,14 @@ public void setPlaybackParams(float speed, boolean skipSilence) {\n     }\n \n     public void setVolume(float v, float v1) {\n-        exoPlayer.setVolume(v);\n+        if (v > 1) {\n+            exoPlayer.setVolume(1f);\n+            loudnessEnhancer.setEnabled(true);\n+            loudnessEnhancer.setTargetGain((int) (1000 * (v - 1)));\n+        } else {\n+            exoPlayer.setVolume(v);\n+            loudnessEnhancer.setEnabled(false);\n+        }\n     }\n \n     public void start() {\n@@ -335,4 +352,16 @@ int getVideoHeight() {\n     void setOnBufferingUpdateListener(Consumer<Integer> bufferingUpdateListener) {\n         this.bufferingUpdateListener = bufferingUpdateListener;\n     }\n+\n+    private void initLoudnessEnhancer(int audioStreamId) {\n+        LoudnessEnhancer newEnhancer = new LoudnessEnhancer(audioStreamId);\n+        LoudnessEnhancer oldEnhancer = this.loudnessEnhancer;\n+        if (oldEnhancer != null) {\n+            newEnhancer.setEnabled(oldEnhancer.getEnabled());\n+            newEnhancer.setTargetGain((int) oldEnhancer.getTargetGain());\n+            oldEnhancer.release();\n+        }\n+\n+        this.loudnessEnhancer = newEnhancer;\n+    }\n }\ndiff --git a/core/src/main/res/values/arrays.xml b/core/src/main/res/values/arrays.xml\nindex 7749c6f3c8..50afe630b7 100644\n--- a/core/src/main/res/values/arrays.xml\n+++ b/core/src/main/res/values/arrays.xml\n@@ -13,16 +13,22 @@\n         <item>never</item>\n     </string-array>\n \n-    <string-array name=\"spnVolumeReductionItems\">\n-        <item>@string/feed_volume_reduction_off</item>\n-        <item>@string/feed_volume_reduction_light</item>\n+    <string-array name=\"spnVolumeAdaptationItems\">\n         <item>@string/feed_volume_reduction_heavy</item>\n+        <item>@string/feed_volume_reduction_light</item>\n+        <item>@string/feed_volume_reduction_off</item>\n+        <item>@string/feed_volume_boost_light</item>\n+        <item>@string/feed_volume_boost_medium</item>\n+        <item>@string/feed_volume_boost_heavy</item>\n     </string-array>\n \n-    <string-array name=\"spnVolumeReductionValues\">\n-        <item>off</item>\n-        <item>light</item>\n+    <string-array name=\"spnVolumeAdaptationValues\">\n         <item>heavy</item>\n+        <item>light</item>\n+        <item>off</item>\n+        <item>light_boost</item>\n+        <item>medium_boost</item>\n+        <item>heavy_boost</item>\n     </string-array>\n \n     <string-array name=\"feed_refresh_interval_entries\">\ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/VolumeAdaptionSetting.java b/model/src/main/java/de/danoeh/antennapod/model/feed/VolumeAdaptionSetting.java\nindex 67e30e5c81..e71c5ad363 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/feed/VolumeAdaptionSetting.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/VolumeAdaptionSetting.java\n@@ -3,7 +3,10 @@\n public enum VolumeAdaptionSetting {\n     OFF(0, 1.0f),\n     LIGHT_REDUCTION(1, 0.5f),\n-    HEAVY_REDUCTION(2, 0.2f);\n+    HEAVY_REDUCTION(2, 0.2f),\n+    LIGHT_BOOST(3, 1.5f),\n+    MEDIUM_BOOST(4, 2f),\n+    HEAVY_BOOST(5, 2.5f);\n \n     private final int value;\n     private float adaptionFactor;\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 6bdb836dd2..baed14c553 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -124,11 +124,14 @@\n     <string name=\"retry_label\">Retry</string>\n     <string name=\"auto_download_label\">Include in auto downloads</string>\n     <string name=\"auto_delete_label\">Auto delete episode</string>\n-    <string name=\"feed_volume_reduction\">Volume reduction</string>\n-    <string name=\"feed_volume_reduction_summary\">Turn down volume for episodes of this podcast: %1$s</string>\n-    <string name=\"feed_volume_reduction_off\">Off</string>\n-    <string name=\"feed_volume_reduction_light\">Light</string>\n-    <string name=\"feed_volume_reduction_heavy\">Heavy</string>\n+    <string name=\"feed_volume_adapdation\">Volume adaptation</string>\n+    <string name=\"feed_volume_adaptation_summary\">Turn volume for episodes of this podcast up or down: %1$s</string>\n+    <string name=\"feed_volume_reduction_off\">No adaption</string>\n+    <string name=\"feed_volume_reduction_light\">Light reduction</string>\n+    <string name=\"feed_volume_reduction_heavy\">Heavy reduction</string>\n+    <string name=\"feed_volume_boost_light\">Light boost</string>\n+    <string name=\"feed_volume_boost_medium\">Medium boost</string>\n+    <string name=\"feed_volume_boost_heavy\">Heavy boost</string>\n     <string name=\"feed_auto_download_always\">Always</string>\n     <string name=\"feed_auto_download_never\">Never</string>\n     <string name=\"feed_new_episodes_action_add_to_inbox\">Add to inbox</string>\n", "test_patch": "diff --git a/app/src/androidTest/java/de/test/antennapod/ui/FeedSettingsTest.java b/app/src/androidTest/java/de/test/antennapod/ui/FeedSettingsTest.java\nindex 861c62f1bf..187c9e16da 100644\n--- a/app/src/androidTest/java/de/test/antennapod/ui/FeedSettingsTest.java\n+++ b/app/src/androidTest/java/de/test/antennapod/ui/FeedSettingsTest.java\n@@ -73,7 +73,7 @@ public void testClickFeedSettings() {\n         clickPreference(R.string.auto_delete_label);\n         onView(withText(R.string.cancel_label)).perform(click());\n \n-        clickPreference(R.string.feed_volume_reduction);\n+        clickPreference(R.string.feed_volume_adapdation);\n         onView(withText(R.string.cancel_label)).perform(click());\n     }\n }\ndiff --git a/core/src/test/java/de/danoeh/antennapod/core/feed/VolumeAdaptionSettingTest.java b/core/src/test/java/de/danoeh/antennapod/core/feed/VolumeAdaptionSettingTest.java\nindex 4241707bc5..30767bdc88 100644\n--- a/core/src/test/java/de/danoeh/antennapod/core/feed/VolumeAdaptionSettingTest.java\n+++ b/core/src/test/java/de/danoeh/antennapod/core/feed/VolumeAdaptionSettingTest.java\n@@ -31,11 +31,35 @@ public void mapHeavyReductionToInteger() {\n         assertThat(setting.toInteger(), is(equalTo(2)));\n     }\n \n+    @Test\n+    public void mapLightBoostToInteger() {\n+        VolumeAdaptionSetting setting = VolumeAdaptionSetting.LIGHT_BOOST;\n+\n+        assertThat(setting.toInteger(), is(equalTo(3)));\n+    }\n+\n+    @Test\n+    public void mapMediumBoostToInteger() {\n+        VolumeAdaptionSetting setting = VolumeAdaptionSetting.MEDIUM_BOOST;\n+\n+        assertThat(setting.toInteger(), is(equalTo(4)));\n+    }\n+\n+    @Test\n+    public void mapHeavyBoostToInteger() {\n+        VolumeAdaptionSetting setting = VolumeAdaptionSetting.HEAVY_BOOST;\n+\n+        assertThat(setting.toInteger(), is(equalTo(5)));\n+    }\n+\n     @Test\n     public void mapIntegerToVolumeAdaptionSetting() {\n         assertThat(VolumeAdaptionSetting.fromInteger(0), is(equalTo(VolumeAdaptionSetting.OFF)));\n         assertThat(VolumeAdaptionSetting.fromInteger(1), is(equalTo(VolumeAdaptionSetting.LIGHT_REDUCTION)));\n         assertThat(VolumeAdaptionSetting.fromInteger(2), is(equalTo(VolumeAdaptionSetting.HEAVY_REDUCTION)));\n+        assertThat(VolumeAdaptionSetting.fromInteger(3), is(equalTo(VolumeAdaptionSetting.LIGHT_BOOST)));\n+        assertThat(VolumeAdaptionSetting.fromInteger(4), is(equalTo(VolumeAdaptionSetting.MEDIUM_BOOST)));\n+        assertThat(VolumeAdaptionSetting.fromInteger(5), is(equalTo(VolumeAdaptionSetting.HEAVY_BOOST)));\n     }\n \n     @Test(expected =  IllegalArgumentException.class)\n@@ -45,7 +69,7 @@ public void cannotMapNegativeValues() {\n \n     @Test(expected =  IllegalArgumentException.class)\n     public void cannotMapValuesOutOfRange() {\n-        VolumeAdaptionSetting.fromInteger(3);\n+        VolumeAdaptionSetting.fromInteger(6);\n     }\n \n     @Test\n@@ -62,4 +86,31 @@ public void lightReductionYieldsHigherValueThanHeavyReduction() {\n \n         assertTrue(\"Light reduction must have higher factor than heavy reduction\", lightReductionFactor > heavyReductionFactor);\n     }\n-}\n\\ No newline at end of file\n+\n+    @Test\n+    public void lightBoostYieldsHigherValueThanLightReduction() {\n+        float lightReductionFactor = VolumeAdaptionSetting.LIGHT_REDUCTION.getAdaptionFactor();\n+\n+        float lightBoostFactor = VolumeAdaptionSetting.LIGHT_BOOST.getAdaptionFactor();\n+\n+        assertTrue(\"Light boost must have higher factor than light reduction\", lightBoostFactor > lightReductionFactor);\n+    }\n+\n+    @Test\n+    public void mediumBoostYieldsHigherValueThanLightBoost() {\n+        float lightBoostFactor = VolumeAdaptionSetting.LIGHT_BOOST.getAdaptionFactor();\n+\n+        float mediumBoostFactor = VolumeAdaptionSetting.MEDIUM_BOOST.getAdaptionFactor();\n+\n+        assertTrue(\"Medium boost must have higher factor than light boost\", mediumBoostFactor > lightBoostFactor);\n+    }\n+\n+    @Test\n+    public void heavyBoostYieldsHigherValueThanMediumBoost() {\n+        float mediumBoostFactor = VolumeAdaptionSetting.MEDIUM_BOOST.getAdaptionFactor();\n+\n+        float heavyBoostFactor = VolumeAdaptionSetting.HEAVY_BOOST.getAdaptionFactor();\n+\n+        assertTrue(\"Heavy boost must have higher factor than medium boost\", heavyBoostFactor > mediumBoostFactor);\n+    }\n+}\n", "problem_statement": "Option to allow boosting audio volume over 100%\n# Checklist\r\n\r\n- [x ] I have used the search function to see if someone else has already submitted the same feature request.\r\n- [ x] I will only create one feature request per issue.\r\n- [x ] I will describe the problem with as much detail as possible.\r\n\r\n# System info\r\n\r\n**App version**: 2.2.1 (latest)\r\n\r\n**App source**: Google Play\r\n\r\n# Feature description\r\n\r\n**Problem you may be having, or feature you want**:\r\nSome of the episodes I have are using a lower audio volume, and even if I'm at 100% of the volume I cannot hear correctly.\r\n\r\n**Suggested solution**:\r\nMaybe we could implement an option that allow to boost audio volume over 100% ?\r\nFor safety reasons, it could be an option that is disabled by default and is available to be enabled in the advanced settings tab.\r\n\n", "hints_text": "Hi and thank you for writing this issue!\n\nIt looks like you did not follow our issue template. In case you accidentally deleted the template, you can find the version for bug reports [here](https://raw.githubusercontent.com/AntennaPod/AntennaPod/develop/.github/ISSUE_TEMPLATE/bug_report.md) and the version for feature requests [here](https://raw.githubusercontent.com/AntennaPod/AntennaPod/develop/.github/ISSUE_TEMPLATE/feature_request.md). Please copy the matching template and then edit your post to follow the template. Please also make sure to use the [search function](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue) to look for open **and** closed issues about the same topic.\n\nIn order to properly deal with the issue, we need the information requested in the template. Please note that dealing with duplicate issues and asking users to follow the issue template takes away a lot of time from the developers. That time can then not be spent to actually implement features.\nRelated: #2187\nInterested in seeing this feature happen.\nThis is the reason for me leaving this app that actually I like a lot.\r\n\r\nWhen driving a car, the traffic instructions are sometimes so much louder than a badly recorded hardly audible podcast that it blows my ears. For health reasons, I have to switch now. (I am not exaggerating - it is literally painful.)\r\n\r\nThanks for the great work so far!", "created_at": "2023-08-09T06:17:52Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6550, "instance_id": "AntennaPod__AntennaPod-6550", "issue_numbers": ["6548", "6518"], "base_commit": "5ae766b1a1557e2a54627e6b3c83c54c6578995d", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/feed/LocalFeedUpdater.java b/core/src/main/java/de/danoeh/antennapod/core/feed/LocalFeedUpdater.java\nindex 03881ee4f7..eae7a8426c 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/feed/LocalFeedUpdater.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/feed/LocalFeedUpdater.java\n@@ -28,6 +28,7 @@\n import androidx.documentfile.provider.DocumentFile;\n import de.danoeh.antennapod.core.R;\n import de.danoeh.antennapod.core.util.FastDocumentFile;\n+import de.danoeh.antennapod.model.MediaMetadataRetrieverCompat;\n import de.danoeh.antennapod.model.download.DownloadResult;\n import de.danoeh.antennapod.core.storage.DBReader;\n import de.danoeh.antennapod.core.storage.DBTasks;\n@@ -199,8 +200,8 @@ private static FeedItem createFeedItem(Feed feed, FastDocumentFile file, Context\n         return item;\n     }\n \n-    private static void loadMetadata(FeedItem item, FastDocumentFile file, Context context) throws IOException {\n-        try (MediaMetadataRetriever mediaMetadataRetriever = new MediaMetadataRetriever()) {\n+    private static void loadMetadata(FeedItem item, FastDocumentFile file, Context context) {\n+        try (MediaMetadataRetrieverCompat mediaMetadataRetriever = new MediaMetadataRetrieverCompat()) {\n             mediaMetadataRetriever.setDataSource(context, file.getUri());\n \n             String dateStr = mediaMetadataRetriever.extractMetadata(MediaMetadataRetriever.METADATA_KEY_DATE);\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/FeedUpdateWorker.java b/core/src/main/java/de/danoeh/antennapod/core/service/FeedUpdateWorker.java\nindex 59d9df8f5e..b207db83b3 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/FeedUpdateWorker.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/FeedUpdateWorker.java\n@@ -4,13 +4,17 @@\n import android.content.Context;\n import android.util.Log;\n import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n import androidx.core.app.NotificationCompat;\n import androidx.core.app.NotificationManagerCompat;\n+import androidx.work.ForegroundInfo;\n import androidx.work.WorkManager;\n import androidx.work.Worker;\n import androidx.work.WorkerParameters;\n import com.annimon.stream.Collectors;\n import com.annimon.stream.Stream;\n+import com.google.common.util.concurrent.Futures;\n+import com.google.common.util.concurrent.ListenableFuture;\n import de.danoeh.antennapod.core.ClientConfigurator;\n import de.danoeh.antennapod.core.R;\n import de.danoeh.antennapod.core.feed.LocalFeedUpdater;\n@@ -88,11 +92,15 @@ public Result doWork() {\n     }\n \n     @NonNull\n-    private Notification createNotification(List<Feed> toUpdate) {\n+    private Notification createNotification(@Nullable List<Feed> toUpdate) {\n         Context context = getApplicationContext();\n-        String contentText = context.getResources().getQuantityString(R.plurals.downloads_left,\n-                toUpdate.size(), toUpdate.size());\n-        String bigText = Stream.of(toUpdate).map(feed -> \"\u2022 \" + feed.getTitle()).collect(Collectors.joining(\"\\n\"));\n+        String contentText = \"\";\n+        String bigText = \"\";\n+        if (toUpdate != null) {\n+            contentText = context.getResources().getQuantityString(R.plurals.downloads_left,\n+                    toUpdate.size(), toUpdate.size());\n+            bigText = Stream.of(toUpdate).map(feed -> \"\u2022 \" + feed.getTitle()).collect(Collectors.joining(\"\\n\"));\n+        }\n         return new NotificationCompat.Builder(context, NotificationUtils.CHANNEL_ID_DOWNLOADING)\n                 .setContentTitle(context.getString(R.string.download_notification_title_feeds))\n                 .setContentText(contentText)\n@@ -104,6 +112,12 @@ private Notification createNotification(List<Feed> toUpdate) {\n                 .build();\n     }\n \n+    @NonNull\n+    @Override\n+    public ListenableFuture<ForegroundInfo> getForegroundInfoAsync() {\n+        return Futures.immediateFuture(new ForegroundInfo(R.id.notification_updating_feeds, createNotification(null)));\n+    }\n+\n     private void refreshFeeds(List<Feed> toUpdate, boolean force) {\n         while (!toUpdate.isEmpty()) {\n             if (isStopped()) {\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/EpisodeDownloadWorker.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/EpisodeDownloadWorker.java\nindex 62956894c0..2489ba2ba6 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/EpisodeDownloadWorker.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/download/EpisodeDownloadWorker.java\n@@ -1,5 +1,6 @@\n package de.danoeh.antennapod.core.service.download;\n \n+import android.app.Notification;\n import android.app.NotificationManager;\n import android.app.PendingIntent;\n import android.content.Context;\n@@ -9,8 +10,11 @@\n import androidx.annotation.NonNull;\n import androidx.core.app.NotificationCompat;\n import androidx.work.Data;\n+import androidx.work.ForegroundInfo;\n import androidx.work.Worker;\n import androidx.work.WorkerParameters;\n+import com.google.common.util.concurrent.Futures;\n+import com.google.common.util.concurrent.ListenableFuture;\n import de.danoeh.antennapod.core.ClientConfigurator;\n import de.danoeh.antennapod.core.R;\n import de.danoeh.antennapod.core.service.download.handler.MediaDownloadedHandler;\n@@ -67,7 +71,9 @@ public void run() {\n                                     .putInt(DownloadServiceInterface.WORK_DATA_PROGRESS, request.getProgressPercent())\n                                     .build())\n                                 .get();\n-                        sendProgressNotification();\n+                        NotificationManager nm = (NotificationManager) getApplicationContext()\n+                                .getSystemService(Context.NOTIFICATION_SERVICE);\n+                        nm.notify(R.id.notification_downloading, generateProgressNotification());\n                     } catch (InterruptedException | ExecutionException e) {\n                         return;\n                     }\n@@ -75,7 +81,13 @@ public void run() {\n             }\n         };\n         progressUpdaterThread.start();\n-        final Result result = performDownload(media, request);\n+        Result result;\n+        try {\n+            result = performDownload(media, request);\n+        } catch (Exception e) {\n+            e.printStackTrace();\n+            result = Result.failure();\n+        }\n         progressUpdaterThread.interrupt();\n         try {\n             progressUpdaterThread.join();\n@@ -100,6 +112,13 @@ public void onStopped() {\n         }\n     }\n \n+    @NonNull\n+    @Override\n+    public ListenableFuture<ForegroundInfo> getForegroundInfoAsync() {\n+        return Futures.immediateFuture(\n+                new ForegroundInfo(R.id.notification_downloading, generateProgressNotification()));\n+    }\n+\n     private Result performDownload(FeedMedia media, DownloadRequest request) {\n         File dest = new File(request.getDestination());\n         if (!dest.exists()) {\n@@ -242,7 +261,7 @@ private void sendErrorNotification() {\n         nm.notify(R.id.notification_download_report, builder.build());\n     }\n \n-    private void sendProgressNotification() {\n+    private Notification generateProgressNotification() {\n         StringBuilder bigTextB = new StringBuilder();\n         Map<String, Integer> progressCopy = new HashMap<>(notificationProgress);\n         for (Map.Entry<String, Integer> entry : progressCopy.entrySet()) {\n@@ -270,8 +289,6 @@ private void sendProgressNotification() {\n                 .setShowWhen(false)\n                 .setSmallIcon(R.drawable.ic_notification_sync)\n                 .setVisibility(NotificationCompat.VISIBILITY_PUBLIC);\n-        NotificationManager nm = (NotificationManager) getApplicationContext()\n-                .getSystemService(Context.NOTIFICATION_SERVICE);\n-        nm.notify(R.id.notification_downloading, builder.build());\n+        return builder.build();\n     }\n }\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/MediaDownloadedHandler.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/MediaDownloadedHandler.java\nindex a46b4c6d0d..019f311d28 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/MediaDownloadedHandler.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/MediaDownloadedHandler.java\n@@ -6,6 +6,7 @@\n \n import androidx.annotation.NonNull;\n \n+import de.danoeh.antennapod.model.MediaMetadataRetrieverCompat;\n import org.greenrobot.eventbus.EventBus;\n \n import java.io.File;\n@@ -63,7 +64,7 @@ public void run() {\n         }\n         // Get duration\n         String durationStr = null;\n-        try (MediaMetadataRetriever mmr = new MediaMetadataRetriever()) {\n+        try (MediaMetadataRetrieverCompat mmr = new MediaMetadataRetrieverCompat()) {\n             mmr.setDataSource(media.getFile_url());\n             durationStr = mmr.extractMetadata(MediaMetadataRetriever.METADATA_KEY_DURATION);\n             media.setDuration(Integer.parseInt(durationStr));\ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/MediaMetadataRetrieverCompat.java b/model/src/main/java/de/danoeh/antennapod/model/MediaMetadataRetrieverCompat.java\nnew file mode 100644\nindex 0000000000..f3173946d8\n--- /dev/null\n+++ b/model/src/main/java/de/danoeh/antennapod/model/MediaMetadataRetrieverCompat.java\n@@ -0,0 +1,18 @@\n+package de.danoeh.antennapod.model;\n+\n+import android.media.MediaMetadataRetriever;\n+\n+import java.io.IOException;\n+\n+/**\n+ * On SDK<29, this class does not have a close method yet, so the app crashes when using try-with-resources.\n+ */\n+public class MediaMetadataRetrieverCompat extends MediaMetadataRetriever {\n+    public void close() {\n+        try {\n+            release();\n+        } catch (IOException e) {\n+            e.printStackTrace();\n+        }\n+    }\n+}\ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedMedia.java b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedMedia.java\nindex 9e85830759..991b5f3db1 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/feed/FeedMedia.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/feed/FeedMedia.java\n@@ -2,13 +2,13 @@\n \n import android.content.Context;\n import android.content.SharedPreferences.Editor;\n-import android.media.MediaMetadataRetriever;\n import android.net.Uri;\n import android.os.Parcel;\n import android.os.Parcelable;\n import androidx.annotation.Nullable;\n import android.support.v4.media.MediaBrowserCompat;\n import android.support.v4.media.MediaDescriptionCompat;\n+import de.danoeh.antennapod.model.MediaMetadataRetrieverCompat;\n import de.danoeh.antennapod.model.playback.MediaType;\n import de.danoeh.antennapod.model.playback.Playable;\n import de.danoeh.antennapod.model.playback.RemoteMedia;\n@@ -458,11 +458,10 @@ public void checkEmbeddedPicture() {\n             hasEmbeddedPicture = Boolean.FALSE;\n             return;\n         }\n-        MediaMetadataRetriever mmr = new MediaMetadataRetriever();\n-        try {\n+        try (MediaMetadataRetrieverCompat mmr = new MediaMetadataRetrieverCompat()) {\n             mmr.setDataSource(getLocalMediaUrl());\n             byte[] image = mmr.getEmbeddedPicture();\n-            if(image != null) {\n+            if (image != null) {\n                 hasEmbeddedPicture = Boolean.TRUE;\n             } else {\n                 hasEmbeddedPicture = Boolean.FALSE;\ndiff --git a/ui/glide/src/main/java/de/danoeh/antennapod/ui/glide/AudioCoverFetcher.java b/ui/glide/src/main/java/de/danoeh/antennapod/ui/glide/AudioCoverFetcher.java\nindex d8e265ab56..309afa39d9 100644\n--- a/ui/glide/src/main/java/de/danoeh/antennapod/ui/glide/AudioCoverFetcher.java\n+++ b/ui/glide/src/main/java/de/danoeh/antennapod/ui/glide/AudioCoverFetcher.java\n@@ -2,13 +2,13 @@\n \n import android.content.ContentResolver;\n import android.content.Context;\n-import android.media.MediaMetadataRetriever;\n \n import android.net.Uri;\n import androidx.annotation.NonNull;\n import com.bumptech.glide.Priority;\n import com.bumptech.glide.load.DataSource;\n import com.bumptech.glide.load.data.DataFetcher;\n+import de.danoeh.antennapod.model.MediaMetadataRetrieverCompat;\n \n import java.io.ByteArrayInputStream;\n import java.io.InputStream;\n@@ -25,7 +25,7 @@ public AudioCoverFetcher(String path, Context context) {\n \n     @Override\n     public void loadData(@NonNull Priority priority, @NonNull DataCallback<? super InputStream> callback) {\n-        try (MediaMetadataRetriever retriever = new MediaMetadataRetriever()) {\n+        try (MediaMetadataRetrieverCompat retriever = new MediaMetadataRetrieverCompat()) {\n             if (path.startsWith(ContentResolver.SCHEME_CONTENT)) {\n                 retriever.setDataSource(context, Uri.parse(path));\n             } else {\n", "test_patch": "", "problem_statement": "Manual episodes refresh and manual episodes download not working on 3.1.0-beta2\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.1.0-beta2\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n11\n\n### Device model\n\nOnePlus 7\n\n### First occurred\n\nAfter updating to 3.1.0-beta2\n\n### Steps to reproduce\n\n1. Trigger an episode to download\n\n### Expected behaviour\n\nEpisode download\n\n### Current behaviour\n\nEpisode is added to queue but not download\r\nStreaming work. \r\n\r\nI tried with data mobile connection.\r\nI tried again with first disabling allow to use data connection and no matter if I choose to download anyway or when reconnecting it didn't work.\n\n### Logs\n\n_No response_\nAdding local folder as Podacast not working anymore\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.0.2\n\n### Where did you get the app from\n\nF-Droid\n\n### Android version\n\nLineage OS 15.1 / Android 8.1.0\n\n### Device model\n\nGalaxy S9\n\n### First occurred\n\nToday\n\n### Steps to reproduce\n\n1. Choose \"Add Podcast\"\r\n2. Choose \"Add local folder\"\r\n3. Drag list to refresh folder\r\n\r\n\n\n### Expected behaviour\n\nI expect the MP3 in the local folder to be listed as an epidsode in the \"local folder podcast\". \n\n### Current behaviour\n\nIf there is a mp3 in the folder, the refreshing circle next to the search icon does'nt stop (only the one in the list window). The mp3 will not appear in the episode list. \r\n\r\nA message stays in the tray: \"Refreshing Podcasts,Download (0/0)\". \r\n\r\nI tested with different folders and different MP3s. For example also with this news MP3 which is working in the standard RSS mode. \r\nhttps://download.deutschlandfunk.de/file/dradio/2023/06/19/nachrichten_dlf_20230619_1000_0daafa8c.mp3\r\n\r\nThe local folder used to work until this summer (can't exactly tell until which version). \n\n### Logs\n\n_No response_\n", "hints_text": "Looked at my log, I believe relevant parts are : \r\n\r\n07-17 21:28:56.680  9184  1656 E WM-WorkerWrapper: Work [ id=72a0d36a-2e31-415d-93f3-21c1080fcd8d, tags={ episodeDownload, de.danoeh.antennapod.core.service.download.EpisodeDownloadWorker, episodeUrl:https://rf.proxycast.org/d605c8cf-320f-4491-b2cf-54212d7d4f07/17309-17.07.2023-ITEMA_23440926-2023F28653S0198-22.mp3 } ] failed because it threw an exception/error\r\n07-17 21:28:56.680  9184  1656 E WM-WorkerWrapper: java.util.concurrent.ExecutionException: java.util.concurrent.ExecutionException: java.util.concurrent.ExecutionException: java.lang.IllegalStateException: Expedited WorkRequests require a ListenableWorker to provide an implementation for `getForegroundInfoAsync()`\r\n\r\nThen after bunch of  WM-WorkerWrapper messages :\r\n\r\n07-17 21:28:56.680  9184  1656 E WM-WorkerWrapper: Caused by: java.lang.IllegalStateException: Expedited WorkRequests require a ListenableWorker to provide an implementation for `getForegroundInfoAsync()`\r\n07-17 21:28:56.680  9184  1656 E WM-WorkerWrapper: \tat androidx.work.ListenableWorker.getForegroundInfoAsync(ListenableWorker.java:260)\r\n07-17 21:28:56.680  9184  1656 E WM-WorkerWrapper: \tat androidx.work.impl.utils.WorkForegroundRunnable$1.run(WorkForegroundRunnable.java:85)\r\n07-17 21:28:56.680  9184  1656 E WM-WorkerWrapper: \t... 7 more\r\n07-17 21:28:56.681  9184  1656 I WM-WorkerWrapper: Worker result FAILURE for Work [ id=72a0d36a-2e31-415d-93f3-21c1080fcd8d, tags={ episodeDownload, de.danoeh.antennapod.core.service.download.EpisodeDownloadWorker, episodeUrl:https://rf.proxycast.org/d605c8cf-320f-4491-b2cf-54212d7d4f07/17309-17.07.2023-ITEMA_23440926-2023F28653S0198-22.mp3 } ]\r\n\r\nI can send full logs if needed ?\nDownload curiously triggered themselves this morning!\r\nI have auto download off. Tried to download another, added to queue didn't work. I guess it will download itself at a later time.\r\n\r\nFelt like updating episodes is not working either. Switched update frequency to never. No change with updating or downloading. Turned it back to 12 hours and then updating happen then queued episode downloaded itself.\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/not-able-to-refresh-local-folder-after-update/3020/11\n\nCould you please try to add a folder and then export the detailed logs from the \"report bug\" screen? Maybe the logs contain some clues about why this happens. (note that the logs contain information about your subscriptions and maybe even playback behavior. If you do not want to post it publicly, you can also send me an email to `info@<my username>.com`)\nThanks for looking into it! I send it per mail. \nHmm, the logs don't contain a lot of information about local feeds, but it somehow looks like the feed gets updated and only the notification does not go away. But if you are saying that the files do not show up, I don't really know what is going on... It works on my phone, after all, so it is hard to debug.\nThanks! How can I help you find the error? I was able to reproduce the problem on my testing smartphone using a fresh install. The device has the debug bridge activated and I did a \u00b4adb shell logcat\u00b4, if that helps (I'm not a programmer but if you describe what I should do I'm sure I find out how to send you some more details). \r\n\r\nThis is from the moment just before selecting the local folder. It seems it repeats a call? \r\n\r\n```\r\n06-21 21:21:15.284   431   558 D audio_hw_primary: out_set_parameters: enter: usecase(1: low-latency-playback) kvpairs: routing=2\r\n06-21 21:21:15.285   431  1916 D audio_hw_primary: start_output_stream: enter: stream(0xb0a77f00)usecase(1: low-latency-playback) devices(0x2)\r\n06-21 21:21:15.285   431  1916 D audio_hw_primary: start_output_stream: enter: usecase(1: low-latency-playback) devices(0x2)\r\n06-21 21:21:15.285   431  1916 D audio_hw_primary: select_devices: out_snd_device(2: speaker) in_snd_device(0: )\r\n06-21 21:21:15.285   431  1916 W msm8974_platform: Codec backend bitwidth 16, samplerate 48000\r\n06-21 21:21:15.285   431  1916 D hardware_info: hw_info_append_hw_type : device_name = speaker\r\n06-21 21:21:15.285   431  1916 I msm8974_platform: platform_send_audio_calibration: sending audio calibration for snd_device(2) acdb_id(15)\r\n06-21 21:21:15.285   431  1916 D ACDB-LOADER: ACDB -> send_audio_cal, acdb_id = 15, path =  0\r\n06-21 21:21:15.285   431  1916 D ACDB-LOADER: ACDB -> send_adm_topology\r\n06-21 21:21:15.285   431  1916 D ACDB-LOADER: ACDB -> ACDB_CMD_GET_AUDPROC_COMMON_TOPOLOGY_ID\r\n06-21 21:21:15.285   431  1916 D ACDB-LOADER: ACDB -> send_asm_topology\r\n06-21 21:21:15.285   431  1916 D ACDB-LOADER: ACDB -> ACDB_CMD_GET_AUDPROC_STREAM_TOPOLOGY_ID\r\n06-21 21:21:15.285   431  1916 D ACDB-LOADER: ACDB -> send_audtable\r\n06-21 21:21:15.285   431  1916 D ACDB-LOADER: ACDB -> ACDB_CMD_GET_AUDPROC_COMMON_TABLE\r\n06-21 21:21:15.285   431  1916 D         : ACDBFILE_MGR:Read the devices count as zero, please check the acdb file\r\n06-21 21:21:15.285   431  1916 D ACDB-LOADER: ACDB -> AUDIO_SET_AUDPROC_CAL\r\n06-21 21:21:15.285   431  1916 D ACDB-LOADER: ACDB -> send_audvoltable\r\n06-21 21:21:15.285   431  1916 D ACDB-LOADER: ACDB -> ACDB_CMD_GET_AUDPROC_GAIN_DEP_STEP_TABLE\r\n06-21 21:21:15.285   431  1916 D         : ACDBFILE_MGR:Read the devices count as zero, please check the acdb file\r\n06-21 21:21:15.285   431  1916 D ACDB-LOADER: ACDB -> AUDIO_SET_AUDPROC_VOL_CAL\r\n06-21 21:21:15.285   431  1916 D ACDB-LOADER: ACDB -> send_afe_cal\r\n06-21 21:21:15.285   431  1916 D ACDB-LOADER: ACDB -> ACDB_CMD_GET_AFE_COMMON_TABLE\r\n06-21 21:21:15.285   431  1916 D         : ACDBFILE_MGR:Read the devices count as zero, please check the acdb file\r\n06-21 21:21:15.285   431  1916 D ACDB-LOADER: ACDB -> AUDIO_SET_AFE_CAL\r\n06-21 21:21:15.286   431  1916 D audio_route: Apply path: speaker\r\n06-21 21:21:15.292   431  1916 D audio_route: Apply path: low-latency-playback\r\n06-21 21:21:15.293   431  1916 D audio_hw_primary: select_devices: done\r\n06-21 21:21:15.306  7971  7971 D PickerActionHandler: onFinished() [content://com.android.providers.downloads.documents/tree/downloads]\r\n06-21 21:21:15.349 11909 11909 D ExternalPlayerFragment: Loading media info\r\n06-21 21:21:15.356 11909 11909 W Glide   : Load failed for null with size [0x0]\r\n06-21 21:21:15.356 11909 11909 W Glide   : class com.bumptech.glide.load.engine.GlideException: Received null model\r\n06-21 21:21:15.364   541  1029 D ConnectivityService: requestNetwork for uid/pid:10118/11909 NetworkRequest [ TRACK_DEFAULT id=50, [ Capabilities: INTERNET&NOT_RESTRICTED&TRUSTED&NOT_VPN] ]\r\n06-21 21:21:15.366   541   853 D Ethernet: got request NetworkRequest [ TRACK_DEFAULT id=50, [ Capabilities: INTERNET&NOT_RESTRICTED&TRUSTED&NOT_VPN] ] with score 60\r\n06-21 21:21:15.366   541   814 D WIFI_UT : got request NetworkRequest [ TRACK_DEFAULT id=50, [ Capabilities: INTERNET&NOT_RESTRICTED&TRUSTED&NOT_VPN] ] with score 60\r\n06-21 21:21:15.366   541   814 D WIFI    : got request NetworkRequest [ TRACK_DEFAULT id=50, [ Capabilities: INTERNET&NOT_RESTRICTED&TRUSTED&NOT_VPN] ] with score 60\r\n06-21 21:21:15.367  1052  1052 D PhoneSwitcherNetworkRequstListener: got request NetworkRequest [ TRACK_DEFAULT id=50, [ Capabilities: INTERNET&NOT_RESTRICTED&TRUSTED&NOT_VPN] ] with score 60\r\n06-21 21:21:15.375 11909 11950 D DBReader: getNavDrawerData() called with: \r\n06-21 21:21:15.389 11909 11938 I Adreno-EGL: <qeglDrvAPI_eglInitialize:379>: EGL 1.4 QUALCOMM build: Nondeterministic_AU_msm8974_LA.BF.1.1.3_RB1__release_AU (I741a3d36ca)\r\n06-21 21:21:15.389 11909 11938 I Adreno-EGL: OpenGL ES Shader Compiler Version: E031.29.00.00\r\n06-21 21:21:15.389 11909 11938 I Adreno-EGL: Build Date: 04/04/16 Mon\r\n06-21 21:21:15.389 11909 11938 I Adreno-EGL: Local Branch: mybranch19053788\r\n06-21 21:21:15.389 11909 11938 I Adreno-EGL: Remote Branch: quic/LA.BF.1.1.3_rb1.12\r\n06-21 21:21:15.389 11909 11938 I Adreno-EGL: Local Patches: NONE\r\n06-21 21:21:15.389 11909 11938 I Adreno-EGL: Reconstruct Branch: NOTHING\r\n06-21 21:21:15.389 11909 11938 I zygote  : android::hardware::configstore::V1_0::ISurfaceFlingerConfigs::hasWideColorDisplay retrieved: 0\r\n06-21 21:21:15.389 11909 11938 I OpenGLRenderer: Initialized EGL, version 1.4\r\n06-21 21:21:15.389 11909 11938 D OpenGLRenderer: Swap behavior 1\r\n06-21 21:21:15.392 11909 11937 D DBReader: Extracting Feedlist\r\n06-21 21:21:15.393 11909 11937 D DBTasks : Found no existing Feed with title Lokaler Ordner. Adding as new one.\r\n06-21 21:21:15.397 11909 11938 W Adreno-EGL: <qeglDrvAPI_eglGetConfigAttrib:607>: EGL_BAD_ATTRIBUTE\r\n06-21 21:21:15.397 11909 12007 D de.danoeh.antennapod.storage.database.PodDBAdapter@10666a5: Inserting new Feed into db\r\n06-21 21:21:15.399 11909 11938 W Adreno-EGL: <qeglDrvAPI_eglGetConfigAttrib:607>: EGL_BAD_ATTRIBUTE\r\n06-21 21:21:15.405 11909 11938 D vndksupport: Loading /vendor/lib/hw/gralloc.msm8974.so from current namespace instead of sphal namespace.\r\n06-21 21:21:15.406 11909 11909 W Glide   : Load failed for  with size [222x222]\r\n06-21 21:21:15.406 11909 11909 W Glide   : class com.bumptech.glide.load.engine.GlideException: Failed to load resource\r\n06-21 21:21:15.408 11909 11909 I chatty  : uid=10118(de.danoeh.antennapod) identical 7 lines\r\n06-21 21:21:15.409 11909 11909 W Glide   : Load failed for  with size [222x222]\r\n06-21 21:21:15.409 11909 11909 W Glide   : class com.bumptech.glide.load.engine.GlideException: Failed to load resource\r\n06-21 21:21:15.410 11909 11914 I zygote  : Do full code cache collection, code=504KB, data=384KB\r\n06-21 21:21:15.410 11909 11909 W Glide   : Load failed for  with size [222x222]\r\n06-21 21:21:15.410 11909 11909 W Glide   : class com.bumptech.glide.load.engine.GlideException: Failed to load resource\r\n06-21 21:21:15.410 11909 11909 I chatty  : uid=10118(de.danoeh.antennapod) identical 1 line\r\n06-21 21:21:15.411 11909 11909 W Glide   : Load failed for  with size [222x222]\r\n06-21 21:21:15.411 11909 11909 W Glide   : class com.bumptech.glide.load.engine.GlideException: Failed to load resource\r\n06-21 21:21:15.412 11909 11914 I zygote  : After code cache collection, code=406KB, data=285KB\r\n06-21 21:21:15.414 11909 11937 D DBReader: getFeed() called with: feedId = [3]\r\n06-21 21:21:15.418 11909 11937 D DBReader: getFeedItemList() called with: feed = [de.danoeh.antennapod.model.feed.Feed@3]\r\n06-21 21:21:15.421 11909 11937 D UserPreferences: User data folder not writable or not set. Trying default.\r\n06-21 21:21:15.426 11909 11937 D DownloadRequestCreat: Requesting download of url antennapod_local:content://com.android.providers.downloads.documents/tree/downloads\r\n06-21 21:21:15.488 11909 11951 D DBReader: getNavDrawerData() called with: \r\n06-21 21:21:15.489 11909 11909 D DownloadService: parallel downloads: 4\r\n06-21 21:21:15.490 11909 11909 D DownloadService: Service started\r\n06-21 21:21:15.492 11909 11909 D DownloadSvcNotification: Notification set up\r\n06-21 21:21:15.516 11909 11909 D DownloadService: Setting up notification updater\r\n06-21 21:21:15.517 11909 12149 D DownloadService: Received enqueue request. #requests=1\r\n06-21 21:21:15.517 11909 12149 D DownloadService: Add new request: antennapod_local:content://com.android.providers.downloads.documents/tree/downloads\r\n06-21 21:21:15.519 11909 12151 D DBReader: getFeed() called with: feedId = [3]\r\n06-21 21:21:15.522 11909 11909 D NavDrawerFragment: getLastNavFragment() -> AddFeedFragment\r\n06-21 21:21:15.522 11909 12151 D DBReader: getFeedItemList() called with: feed = [de.danoeh.antennapod.model.feed.Feed@3]\r\n06-21 21:21:15.522 11909 11909 D NavDrawerFragment: getLastNavFragment() -> AddFeedFragment\r\n06-21 21:21:15.523 11909 12149 D DownloadService: 1 downloads left\r\n06-21 21:21:15.523 11909 12149 D DBReader: getQueueIDList() called\r\n06-21 21:21:15.523 11909 11909 D NavDrawerFragment: getLastNavFragment() -> AddFeedFragment\r\n06-21 21:21:15.526 11909 11909 I chatty  : uid=10118(de.danoeh.antennapod) identical 4 lines\r\n06-21 21:21:15.526 11909 11909 D NavDrawerFragment: getLastNavFragment() -> AddFeedFragment\r\n06-21 21:21:15.566 11909 12151 D DBReader: getFeed() called with: feedId = [3]\r\n06-21 21:21:15.572 11909 12151 D DBReader: getFeedItemList() called with: feed = [de.danoeh.antennapod.model.feed.Feed@3]\r\n06-21 21:21:15.573 11909 12151 D DBTasks : Feed with title Lokaler Ordner already exists. Syncing new with existing one.\r\n06-21 21:21:15.574 11909 12007 D de.danoeh.antennapod.storage.database.PodDBAdapter@10666a5: Updating existing Feed in db\r\n06-21 21:21:15.679 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:15.681 11909 11950 D DBReader: getFeed() called with: feedId = [3]\r\n06-21 21:21:15.682 11909 11950 D DBReader: getFeedItemList() called with: feed = [de.danoeh.antennapod.model.feed.Feed@3]\r\n06-21 21:21:15.683 11909 11950 D DBReader: getFavoriteIDList() called\r\n06-21 21:21:15.683 11909 11950 D DBReader: getQueueIDList() called\r\n06-21 21:21:15.684 11909 11950 D DBReader: Extracting Feedlist\r\n06-21 21:21:15.702   440   440 E MetadataRetrieverClient: failed to extract an album art\r\n06-21 21:21:15.702 11909 12151 E MediaMetadataRetrieverJNI: getEmbeddedPicture: Call to getEmbeddedPicture failed.\r\n06-21 21:21:15.761 11909 11909 D NavDrawerFragment: getLastNavFragment() -> AddFeedFragment\r\n06-21 21:21:15.764 11909 11909 I chatty  : uid=10118(de.danoeh.antennapod) identical 6 lines\r\n06-21 21:21:15.765 11909 11909 D NavDrawerFragment: getLastNavFragment() -> AddFeedFragment\r\n06-21 21:21:15.768 11909 11909 W Glide   : Load failed for null with size [0x0]\r\n06-21 21:21:15.768 11909 11909 W Glide   : class com.bumptech.glide.load.engine.GlideException: Received null model\r\n06-21 21:21:15.768 11909 11909 D NavDrawerFragment: getLastNavFragment() -> AddFeedFragment\r\n06-21 21:21:15.790 11909 11909 W View    : requestLayout() improperly called by androidx.appcompat.view.menu.ActionMenuItemView{7224f51 VFED..C.. ......ID 0,12-144,156 #7f0a0045 app:id/action_search} during layout: running second layout pass\r\n06-21 21:21:15.790 11909 11909 W View    : requestLayout() improperly called by androidx.appcompat.view.menu.ActionMenuItemView{76ca3b6 VFED..C.. ......ID 144,12-288,156 #7f0a02a2 app:id/refresh_item} during layout: running second layout pass\r\n06-21 21:21:15.790 11909 11909 W View    : requestLayout() improperly called by androidx.appcompat.widget.ActionMenuView{7e758b7 V.E...... ......ID 672,12-1080,180} during layout: running second layout pass\r\n06-21 21:21:15.807 11909 11937 D DBReader: getNavDrawerData() called with: \r\n06-21 21:21:15.810 11909 11909 W Glide   : Load failed for null with size [0x0]\r\n06-21 21:21:15.810 11909 11909 W Glide   : class com.bumptech.glide.load.engine.GlideException: Received null model\r\n06-21 21:21:15.812 11909 11909 W Glide   : Load failed for null with size [0x0]\r\n06-21 21:21:15.812 11909 11909 W Glide   : class com.bumptech.glide.load.engine.GlideException: Received null model\r\n06-21 21:21:15.827 11909 11909 I zygote  : Deoptimizing android.view.View androidx.appcompat.widget.ActionMenuPresenter.getItemView(androidx.appcompat.view.menu.MenuItemImpl, android.view.View, android.view.ViewGroup) due to JIT inline cache\r\n06-21 21:21:15.827 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:15.830 11909 11909 I zygote  : Deoptimizing void androidx.appcompat.view.menu.BaseMenuPresenter.updateMenuView(boolean) due to JIT inline cache\r\n06-21 21:21:15.832 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:15.859 11909 11909 D NavDrawerFragment: getLastNavFragment() -> AddFeedFragment\r\n06-21 21:21:15.863 11909 11909 I chatty  : uid=10118(de.danoeh.antennapod) identical 6 lines\r\n06-21 21:21:15.865 11909 11909 D NavDrawerFragment: getLastNavFragment() -> AddFeedFragment\r\n06-21 21:21:15.868 11909 11909 W Glide   : Load failed for null with size [0x0]\r\n06-21 21:21:15.868 11909 11909 W Glide   : class com.bumptech.glide.load.engine.GlideException: Received null model\r\n06-21 21:21:15.869 11909 11909 D NavDrawerFragment: getLastNavFragment() -> AddFeedFragment\r\n06-21 21:21:16.663 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:16.664 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:16.767   876   876 W View    : requestLayout() improperly called by com.android.internal.widget.NotificationExpandButton{82cc9a1 VFED..C.. ......ID 324,48-366,93 #1020232 android:id/expand_button} during layout: running second layout pass\r\n06-21 21:21:16.768   876   876 W View    : requestLayout() improperly called by com.android.internal.widget.NotificationExpandButton{9ebf231 VFED..C.. ......ID 324,48-366,93 #1020232 android:id/expand_button} during layout: running second layout pass\r\n06-21 21:21:16.768   876   876 W View    : requestLayout() improperly called by com.android.internal.widget.NotificationExpandButton{4aafe76 VFED..C.. ......ID 324,48-366,93 #1020232 android:id/expand_button} during layout: running second layout pass\r\n06-21 21:21:17.589 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:17.593 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:18.530   431   558 D hardware_info: hw_info_append_hw_type : device_name = speaker\r\n06-21 21:21:18.582 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:18.582 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:19.574 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:19.577 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:20.608 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:20.610 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:21.609 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:21.610 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:22.613 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:22.613 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:22.661 11909 11922 D ConnectionStateMonitor: ConnectionStateMonitor::onNetworkActive network connection changed\r\n06-21 21:21:22.666 11909 11922 D NetworkConnectionChangeHandler: auto-dl network available, starting auto-download\r\n06-21 21:21:22.666 11909 11922 D DBTasks : autodownloadUndownloadedItems\r\n06-21 21:21:23.586 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:23.589 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:24.609 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:24.609 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:25.560 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:25.561 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:26.592 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:26.593 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:27.571 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:27.572 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:28.581 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:28.582 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:29.593 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:29.593 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:30.600 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:30.600 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:31.619 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:31.619 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:32.570 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:32.571 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:33.593 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:33.594 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:34.596 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:34.596 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:35.598 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:35.598 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:36.584 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:36.585 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:37.589 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:37.590 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:38.601 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:38.601 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:39.588 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:39.589 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:40.598 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:40.599 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:41.544 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:41.545 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:42.598 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:42.599 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:43.599 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:43.599 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:44.597 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:44.598 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:45.609 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:45.610 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:46.630 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:46.631 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:47.587 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:47.588 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:47.732 11909 11920 I zygote  : Background concurrent copying GC freed 32477(1636KB) AllocSpace objects, 0(0B) LOS objects, 57% free, 4MB/10MB, paused 1.619ms total 144.499ms\r\n06-21 21:21:48.614 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:48.615 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:49.618 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:49.619 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:50.576 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:50.577 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:51.572 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:51.573 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:52.598 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:52.599 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:53.598 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:53.603 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:54.597 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:54.597 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:55.607 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n06-21 21:21:55.608 11909 11909 D FeedMenuHandler: Preparing options menu\r\n06-21 21:21:56.557 11909 11909 D ItemlistFragment: onEventMainThread() called with: event = [DownloadEvent{update=DownloaderUpdate{downloaders=[de.danoeh.antennapod.core.service.download.LocalFeedStubDownloader@d0c8d14], feedIds=[3], mediaIds=[]}}]\r\n```\r\n\r\n\n> It seems it repeats a call?\r\n\r\nThat's just the service notifying outside components, not the actual refresh\nCan confirm. I'm having the same problem. Downgrading to 2.7.1 solved the issue\r\n\r\nTo elaborate:\r\n1.  when I add a local folder, antennapod adds the folder to the subscriptions page\r\n2.  it tries to synchronise the content of the folder\r\n3.  it starts the synchronisation (the arrow-thing pops up) ... and that's it. It never ends.\r\n4. besides the synchronisation not finishing, it also means that the content of the folder does **not** get added to the subscriptions, and thus the content can't be used\r\n\r\nNote that nothing crashes, so I don't see how to forward any crash/bug information.\r\n\r\nAs such, I'd think that there are two bugs, but related:\r\n* local folders actually are added, but\r\n* [ ] synchronisation doesn't end ... \r\n* [ ] and because the synchronisation doesn't end, the local content in the folder isn't added to the subscription page\r\n\r\nDevice/System:\r\n* Samung Xcover4\r\n* Android Version: 9\nI've added 'storage access permission', which (for whatever reason) was not granted ... but it doesn't change anything. It's loading the subscription page, the name of the folder, but fails at the sync of its folder content. Anything else I can/should try?\nI have encountered the same issue on `3.0.2`, had to go back to `2.7.1` in order to be able to add a new `local folder`. \r\n\r\nSomehow the contents of previously added/subscribed local folders while on `2.7.1` are still accessible after updating to `3.0.2`, but adding new folders doesn't work while on the most recent version, as OP and `@tmonz` clearly described it above.\r\n\r\n> But if you are saying that the files do not show up, I don't really know what is going on... It works on my phone, after all, so it is hard to debug.\r\n\r\nWithin the changelog of the recent release it says:\r\n\r\n> - Other improvements (e.g. for local feeds) and bugfixes\r\n\r\nThis must be it! Shouldn't be that hard to figure out what made this bug to appear. In fact this was my cue after everything else I tried failed.", "created_at": "2023-07-18T15:04:16Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6546, "instance_id": "AntennaPod__AntennaPod-6546", "issue_numbers": ["6545"], "base_commit": "019e3574c4a578cc8973b2ec2aea516f4869f299", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/PodcastApp.java b/app/src/main/java/de/danoeh/antennapod/PodcastApp.java\nindex bd93e3ea96..28b47c5709 100644\n--- a/app/src/main/java/de/danoeh/antennapod/PodcastApp.java\n+++ b/app/src/main/java/de/danoeh/antennapod/PodcastApp.java\n@@ -17,6 +17,7 @@\n import de.danoeh.antennapod.core.ClientConfigurator;\n import de.danoeh.antennapod.error.CrashReportWriter;\n import de.danoeh.antennapod.error.RxJavaErrorHandlerSetup;\n+import de.danoeh.antennapod.preferences.PreferenceUpgrader;\n import de.danoeh.antennapod.spa.SPAUtil;\n import org.greenrobot.eventbus.EventBus;\n \n@@ -52,6 +53,7 @@ public void onCreate() {\n         singleton = this;\n \n         ClientConfigurator.initialize(this);\n+        PreferenceUpgrader.checkUpgrades(this);\n \n         Iconify.with(new FontAwesomeModule());\n         Iconify.with(new MaterialModule());\ndiff --git a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\nindex d8e21e8c95..b66edc884a 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n@@ -58,7 +58,6 @@\n import de.danoeh.antennapod.model.download.DownloadStatus;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n import de.danoeh.antennapod.playback.cast.CastEnabledActivity;\n-import de.danoeh.antennapod.preferences.PreferenceUpgrader;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import de.danoeh.antennapod.ui.appstartintent.MainActivityStarter;\n import de.danoeh.antennapod.ui.common.ThemeUtils;\n@@ -160,7 +159,6 @@ public void onCreate(Bundle savedInstanceState) {\n         transaction.commit();\n \n         checkFirstLaunch();\n-        PreferenceUpgrader.checkUpgrades(this);\n         View bottomSheet = findViewById(R.id.audioplayerFragment);\n         sheetBehavior = (LockableBottomSheetBehavior) BottomSheetBehavior.from(bottomSheet);\n         sheetBehavior.setHideable(false);\ndiff --git a/app/src/main/java/de/danoeh/antennapod/preferences/PreferenceUpgrader.java b/app/src/main/java/de/danoeh/antennapod/preferences/PreferenceUpgrader.java\nindex 0a1b56e25a..275e9a279f 100644\n--- a/app/src/main/java/de/danoeh/antennapod/preferences/PreferenceUpgrader.java\n+++ b/app/src/main/java/de/danoeh/antennapod/preferences/PreferenceUpgrader.java\n@@ -13,7 +13,6 @@\n import de.danoeh.antennapod.error.CrashReportWriter;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import de.danoeh.antennapod.storage.preferences.UserPreferences.EnqueueLocation;\n-import de.danoeh.antennapod.core.util.download.FeedUpdateManager;\n import de.danoeh.antennapod.fragment.QueueFragment;\n import de.danoeh.antennapod.fragment.swipeactions.SwipeAction;\n import de.danoeh.antennapod.fragment.swipeactions.SwipeActions;\n@@ -31,7 +30,6 @@ public static void checkUpgrades(Context context) {\n         int newVersion = BuildConfig.VERSION_CODE;\n \n         if (oldVersion != newVersion) {\n-            FeedUpdateManager.restartUpdateAlarm(context, true);\n             CrashReportWriter.getFile().delete();\n \n             upgrade(oldVersion, context);\n", "test_patch": "", "problem_statement": "Instant crash with  3.1.0-beta 1\n### Checklist\r\n\r\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n### App version\r\n\r\n 3.1.0-beta 1\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Android version\r\n\r\n11\r\n\r\n### Device model\r\n\r\nOnePlus 7\r\n\r\n### First occurred\r\n\r\nAbout one hour ago, just after updating from Google Play\r\n\r\n### Steps to reproduce\r\n\r\n1. Open the app after updating to 3.1.0-beta 1\r\n\r\n### Expected behaviour\r\n\r\nApp open\r\n\r\n### Current behaviour\r\n\r\nApp crash\r\n\r\n### Logs\r\n\r\nI sent a report via dialog from Android after crashing.\n", "hints_text": "", "created_at": "2023-07-16T20:04:37Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6541, "instance_id": "AntennaPod__AntennaPod-6541", "issue_numbers": ["6536"], "base_commit": "8d1eb62f0bf3c5014a632acbbf98f06d07cf666e", "patch": "diff --git a/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/MediaInfoCreator.java b/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/MediaInfoCreator.java\nindex dd408d4a7a..f579d41107 100644\n--- a/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/MediaInfoCreator.java\n+++ b/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/MediaInfoCreator.java\n@@ -2,6 +2,7 @@\n \n import android.net.Uri;\n import android.text.TextUtils;\n+import androidx.annotation.Nullable;\n import com.google.android.gms.cast.MediaInfo;\n import com.google.android.gms.cast.MediaMetadata;\n import com.google.android.gms.common.images.WebImage;\n@@ -74,7 +75,6 @@ public static MediaInfo from(FeedMedia media) {\n         MediaMetadata metadata = new MediaMetadata(MediaMetadata.MEDIA_TYPE_GENERIC);\n         if (media.getItem() == null) {\n             throw new IllegalStateException(\"item is null\");\n-            //media.setItem(DBReader.getFeedItem(media.getItemId()));\n         }\n         FeedItem feedItem = media.getItem();\n         if (feedItem != null) {\n@@ -84,15 +84,15 @@ public static MediaInfo from(FeedMedia media) {\n                 metadata.putString(MediaMetadata.KEY_SUBTITLE, subtitle);\n             }\n \n+            final @Nullable Feed feed = feedItem.getFeed();\n             // Manual because cast does not support embedded images\n-            String url = feedItem.getImageUrl() == null ? feedItem.getFeed().getImageUrl() : feedItem.getImageUrl();\n+            String url = (feedItem.getImageUrl() == null && feed != null) ? feed.getImageUrl() : feedItem.getImageUrl();\n             if (!TextUtils.isEmpty(url)) {\n                 metadata.addImage(new WebImage(Uri.parse(url)));\n             }\n             Calendar calendar = Calendar.getInstance();\n             calendar.setTime(media.getItem().getPubDate());\n             metadata.putDate(MediaMetadata.KEY_RELEASE_DATE, calendar);\n-            Feed feed = feedItem.getFeed();\n             if (feed != null) {\n                 if (!TextUtils.isEmpty(feed.getAuthor())) {\n                     metadata.putString(MediaMetadata.KEY_ARTIST, feed.getAuthor());\n", "test_patch": "", "problem_statement": "Chromecast: crash when new episode is played after connecting from the playback screen of the last one\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.0.2\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n11\n\n### Device model\n\nOnePlus 7 pro\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Start the app (must have been terminated before)\r\n2. Connect to Chromecast from the playback screen of the last (finished) episode\r\n3. Immediately start playing another episode\n\n### Expected behaviour\n\nNo crash \n\n### Current behaviour\n\nApp crashes, but podcast plays on Chromecast\n\n### Logs\n\n`FATAL EXCEPTION: main\r\nProcess: de.danoeh.antennapod, PID: 5088\r\njava.lang.NullPointerException: Attempt to invoke virtual method 'java.lang.String de.danoeh.antennapod.model.feed.Feed.getImageUrl()' on a null object reference\r\n\tat de.danoeh.antennapod.playback.cast.MediaInfoCreator.from(SourceFile:88)\r\n\tat de.danoeh.antennapod.playback.cast.CastPsmp.remoteVersion(SourceFile:137)\r\n\tat de.danoeh.antennapod.playback.cast.CastPsmp.setPlayable(SourceFile:485)\r\n\tat de.danoeh.antennapod.playback.base.PlaybackServiceMediaPlayer.setPlayerStatus(SourceFile:313)\r\n\tat de.danoeh.antennapod.playback.base.PlaybackServiceMediaPlayer.setPlayerStatus(SourceFile:335)\r\n\tat de.danoeh.antennapod.playback.cast.CastPsmp.onRemoteMediaPlayerStatusUpdated(SourceFile:231)\r\n\tat de.danoeh.antennapod.playback.cast.CastPsmp.access$000(SourceFile:41)\r\n\tat de.danoeh.antennapod.playback.cast.CastPsmp$1.onStatusUpdated(SourceFile:101)\r\n\tat com.google.android.gms.cast.framework.media.zzbp.zzm(SourceFile:6)\r\n\tat com.google.android.gms.cast.internal.zzas.zzaa(SourceFile:1)\r\n\tat com.google.android.gms.cast.internal.zzas.zzQ(SourceFile:65)\r\n\tat com.google.android.gms.cast.framework.media.RemoteMediaClient.onMessageReceived(SourceFile:1)\r\n\tat com.google.android.gms.cast.zzbq.run(SourceFile:4)\r\n\tat android.os.Handler.handleCallback(Handler.java:938)\r\n\tat android.os.Handler.dispatchMessage(Handler.java:99)\r\n\tat android.os.Looper.loop(Looper.java:233)\r\n\tat android.app.ActivityThread.main(ActivityThread.java:8010)\r\n\tat java.lang.reflect.Method.invoke(Native Method)\r\n\tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:631)\r\n\tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:978)`\n", "hints_text": "", "created_at": "2023-07-15T14:32:55Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6535, "instance_id": "AntennaPod__AntennaPod-6535", "issue_numbers": ["2715"], "base_commit": "5ae766b1a1557e2a54627e6b3c83c54c6578995d", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\nindex 6fc9035cac..b98dbfad7f 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n@@ -20,7 +20,9 @@\n import android.os.Binder;\n import android.os.Build;\n import android.os.Bundle;\n+import android.os.Handler;\n import android.os.IBinder;\n+import android.os.Looper;\n import android.os.Vibrator;\n import android.service.quicksettings.TileService;\n import android.support.v4.media.MediaBrowserCompat;\n@@ -33,6 +35,7 @@\n import android.util.Pair;\n import android.view.KeyEvent;\n import android.view.SurfaceHolder;\n+import android.view.ViewConfiguration;\n import android.webkit.URLUtil;\n import android.widget.Toast;\n \n@@ -150,6 +153,8 @@ public class PlaybackService extends MediaBrowserServiceCompat {\n     private CastStateListener castStateListener;\n \n     private String autoSkippedFeedMediaId = null;\n+    private int clickCount = 0;\n+    private final Handler clickHandler = new Handler(Looper.getMainLooper());\n \n     /**\n      * Used for Lollipop notifications, Android Wear, and Android Auto.\n@@ -1823,7 +1828,24 @@ public boolean onMediaButtonEvent(final Intent mediaButton) {\n                 if (keyEvent != null &&\n                         keyEvent.getAction() == KeyEvent.ACTION_DOWN &&\n                         keyEvent.getRepeatCount() == 0) {\n-                    return handleKeycode(keyEvent.getKeyCode(), false);\n+                    int keyCode = keyEvent.getKeyCode();\n+                    if (keyCode == KeyEvent.KEYCODE_HEADSETHOOK || keyCode == KeyEvent.KEYCODE_MEDIA_PLAY_PAUSE) {\n+                        clickCount++;\n+                        clickHandler.removeCallbacksAndMessages(null);\n+                        clickHandler.postDelayed(() -> {\n+                            if (clickCount == 1) {\n+                                handleKeycode(KeyEvent.KEYCODE_MEDIA_PLAY_PAUSE, false);\n+                            } else if (clickCount == 2) {\n+                                onFastForward();\n+                            } else if (clickCount == 3) {\n+                                onRewind();\n+                            }\n+                            clickCount = 0;\n+                        }, ViewConfiguration.getDoubleTapTimeout());\n+                        return true;\n+                    } else {\n+                        return handleKeycode(keyCode, false);\n+                    }\n                 }\n             }\n             return false;\n", "test_patch": "", "problem_statement": "Using double/triple headset button press to fast forward/rewind\n**App version:** 1.6.5 (from F-Droid)\r\n\r\n**Android version**: 8.0\r\n**Device model**: Sony Xperia XZ2 Compact \r\n\r\nAs far as I can tell, there's no way to assign multiple headset button presses for fast forwarding or rewinding. Most music players allow to double press the headset button to skip to next song and triple press to skip to the previous one, so I assume it's a system-level setting that treats multiple presses as \"media next/media preview\" actions. It would be nice to see AntennaPod use do that too instead of just play/pause with a single tap. As far as I know, the only podcast player right now that supports both fast forward AND rewind is Castbox (proprietary).\n", "hints_text": "Related: #2592\nRelated: #2364 \nFYI, I use a 3rd-party paid app (you can find on play store) to do so, it can let you assign actions up to 4 clicks.\n> it can let you assign actions up to 4 clicks.\r\n\r\ngood to know that it is possible (though i'm suspicious at reliable 4-click detection considering implementations i've seen of home click vs double-click vs hold).\nOh man this is my number one request. \r\n\r\nIn the meantime, what app do you use orionlee?\nMany apps allow double tap and also hold to do different actions\n@mfietz @ByteHamster Can you make this feature a high priority considering that most podcast clients at least have the \"double tap to skip ahead\" function so that users don't have to even touch their phone to skip commercials and such? I think many people consider this essential to the playback experience these days, especially considering how many podcasts have commercials and how many users buy a headset just to skip such commercials. I also think this feature would require less work than most other suggested features, while pleasing many users and making Antennapod up to parity with other non-free clients. \nPlease keep in mind that all development happens in our free time. We do not work with priorities because everyone just implements the features they find important (except for fixing bugs). I do not need the feature, so it is unlikely that I will implement it. I would be very happy to review and test a pull request by someone who actually needs the feature.\nSome goes for me. I use my headphones a lot, but they only have touch controls, not buttons. I couldn't use this myself which quite lowers my motivation (I could not remember how double or twice tapping behaves, anyway...)\n@mfietz double tapping basically skips ahead, which is handy for podcasts with commercials. A triple tap skips back, and a single tap pauses and plays. Most podcast clients have it. It's a useful function for people with a single button mic headset, which are the most common kind out there since they are so cheap to produce and come with most premium phones. \r\n\r\n@ByteHamster Fair enough. I was just hoping somebody out there could implement it.\nI attempted something similar a while back with PR https://github.com/AntennaPod/AntennaPod/pull/2251 (for issue #2247). It only supports double-tap actions for forward/previous buttons but I think that could be extended to include play/pause.\r\n\r\nIf the maintainers are still open to the change, I can bring that branch up to date and make an attempt at adding play/pause support.\n@Forestmb As you can see, the maintainers have already said they would be happy to review and test your pull request, and you should definitely bring that branch up to date and attempt to add play/pause support since that is a feature every podcast client has except for Antennapod. Thanks very much for your work!\nSome apps use long-hold instead of triple tap.\r\n\r\nBut yes please. This is the only feature I really need from AP. I'd love to not take my phone out of my pocket every 15 minutes to skip ads. I can't use use thrid party app for this without jailbreaking. \n> Some apps use long-hold instead of triple tap.\r\n\r\nI think we can all agree that we just need pause/play with 1 tap, and double tap to skip forward. Triple tap to skip backwards should probably be done to ensure compatibility with different headsets. \n> In the meantime, what app do you use orionlee?\r\n\r\nI've tested [Button Mapper: Remap your keys](https://play.google.com/store/apps/details?id=flar2.homebutton). This allows you to bind double-click and long-hold. It works well enough to start with, but doesn't perform too well in the background. I did the old \"don't optimise app\" trick, but it still doesn't always seem to work. A native solution would be much better. In the meantime, you can launch this app every time and keep it in the foreground before switching the screen off, but that's obviously pretty annoying.\n@protist I agree. Hopefully @Forestmb comes through with updating his PR.\nI just noticed the app I am using, Headset Button Controller, is no longer on Play Store. It works well for me.\nCan someone merge this in?\n@tellemstevedave we have to wait for @Forestmb to get this done. I imagine a lot of people besides the ones in this thread would love it. \nTook a shot at bringing the old PR branch up-to-date with develop: [Forestmb/AntennaPod - c1e68fa](https://github.com/Forestmb/AntennaPod/commit/c1e68faedbc1ca0f35e92744e899400a0a1a9630)\r\n\r\nThe original feature set consisting of custom single/double-tap actions for the next and previous buttons has been working with my test device (my car's bluetooth controls).\r\n\r\nI also attempted to add headset button double/triple-tap. I have only tested it locally by sending the signal from the command line via adb. All the headsets I own already have custom behaviors for those actions that prevents AntennaPod from being able to detect that a double/triple-tap has occurred. If anyone in this thread is capable of testing my branch with their setup, I would really appreciate it.\nThat's a really huge commit. I will have a look at it in the next few weeks.\n> If anyone in this thread is capable of testing my branch with their setup, I would really appreciate it.\r\n\r\nThe button on my headphones no longer works on your branch. I get the following logcat output:\r\n\r\n```\r\n2019-10-23 21:45:19.210 19533-19533/de.danoeh.antennapod.debug D/MediaSessionCompat: onMediaButtonEvent(Intent { act=android.intent.action.MEDIA_BUTTON (has extras) })\r\n2019-10-23 21:45:19.210 19533-19533/de.danoeh.antennapod.debug D/PlaybackService: Handling keycode: 79\r\n2019-10-23 21:45:19.210 19533-19533/de.danoeh.antennapod.debug V/RepeatTapActionHandler: event(79, 0)\r\n2019-10-23 21:45:19.211 19533-19533/de.danoeh.antennapod.debug D/RepeatTapActionHandler: No actions specified, not running any actions\r\n```\r\n\r\nCould you please open a pull request, so we can discuss the changes more easily?\nHi, the problem with the double, triple rewind is that it's skip an audio.   \r\nI would like to rewind faster, like Youtube.   \r\n10 sec of rewind is not enough, can you set it to 30 sec?   \r\nThanks  \r\nRem: I don't listen to music but conferences.\n> 10 sec of rewind is not enough, can you set it to 30 sec?\r\n\r\nIt's going to be the same as what you set the skip time to. You can change it yourself. \n> @hotlittlewhitedog: 10 sec of rewind is not enough, can you set it to 30 sec? \r\n\r\nLong-press the skip buttons to change the durations.\nThanks Pentaphon :)\n\nOn Thu, 26 Dec 2019 at 18:28, H. Lehmann <notifications@github.com> wrote:\n\n> @hotlittlewhitedog <https://github.com/hotlittlewhitedog>: 10 sec of\n> rewind is not enough, can you set it to 30 sec?\n>\n> Long-press the skip buttons to change the durations.\n>\n> \u2014\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/AntennaPod/AntennaPod/issues/2715?email_source=notifications&email_token=AFMEE52MSV3UMSJUTJF3533Q2TSSVA5CNFSM4FCAIU42YY3PNVWWK3TUL52HS4DFVREXG43VMVBW63LNMVXHJKTDN5WW2ZLOORPWSZGOEHV3WGA#issuecomment-569096984>,\n> or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AFMEE563OQVHCRPFBQW7HNTQ2TSSVANCNFSM4FCAIU4Q>\n> .\n>\n\nshould i be able to do this 1.8.1\n> should i be able to do this 1.8.1\r\n\r\nNo, the feature is not included in 1.8.1. @Forestmb created a pull request (#3552) with the feature but the PR needs some improvements before merging. Unfortunately, there is not much activity in the PR, recently.\nHi there, as a recent newcomer from DoggCatcher, this is indeed a feature that I'm missing and the pull request was closed due to inactivity  :( \r\n\r\n\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/playback-control-with-3-button-cable-headset/173/2\n\nFor what it's worth the Pixel 4a on Android 11 seems to support double & triple headset clicks natively. Clicking like that sends next and previous respectively, which antennapod already can optionally handle as skip forward or back however many seconds. I've tested 3 different brands of ear buds with inline remotes and all three behave this way. Some apps ignore this feature (e.g. tsacdop) but many seem to accept the behavior (Podcast Addict; YT Music; Music Player Go; Oto Music) even when the screen is off. Does anyone know if this is a Pixel thing or an Android 11 feature or what?\r\n\r\nEdit:  I tested 3.5mm headsets, not USB or bluetooth\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/headset-buttons-multiple-push/935/2\n\nAndroid 11 Samsung Bluetooth also working\r\n\r\nI think maybe it also depends on the device, if it's sending the regular command or a custom one. I guess it's not standardized (especially Bluetooth) them a few years ago.\r\n\r\nSo I think this can be closed? \nThis shouldn't be closed, because many people aren't on Android 11 yet. And actually we've just received request to support this also via email. So if someone would still be willing to work on it, I'm sure that'd be appreciated by many :)\nJust as a small data point: around 1/3 of our users on Google Play run Android 11.\nA bit of an update to my comment above:  Moto G 2015 3.5mm headset works as expected with double and triple clicks. That's Android 6. I think this is a standard Android feature already since a long time.\r\n\r\nEdit:  forgot to add that my Galaxy S9, Android 10, also works with 3.5mm headsets. I have also tested 3 button USB C headsets on the Pixel 4a and Galaxy S9 with identical results as the 3.5mm.\n> This shouldn't be closed, because many people aren't on Android 11 yet\r\n\r\nMoreover, I purposefully use my old Android 6 device as a podcast player.\r\n\r\n@locuturus My Android 6 device just sends play/pause 3 times afaict. Assuming you're talking about the how to handle back/forward hardware buttons setting.\nAnother datapoint: my main device is Android 9, and multiple clicks just send multiple play/pause events.\n@Frenzie @protist I'm curious, what devices and what headset types? \r\n\r\nMy thinking is that phone OEM matters more than Android version, and the stock 2 click forward and 3 click back feature probably only works with 3.5mm or USB headsets with that ordinary generic play/pause/answer call button. The buttons on Bluetooth and 'smart' USB headsets look different to Android than the dumb buttons on simpler headsets.\nASUS Zenfone 2 with single-button 3.5 mm.\n@locuturus Moto G6 Plus running Resurrection Remix. I see it with any headphones I've used, both 3.5 mm (UIISII BA-T8S, V-Moda ZN) or Bluetooth (SoundPEATS True Wireless, Aftershokz Air).\nThis piqued my interest a little and here's a workaround, even if it feels like overkill. (On the plus side, it took me only a couple of minutes and I trying to implement it in AntennaPod would take me significantly longer.) Equivalents may exist.\r\n\r\n1. Install https://www.f-droid.org/en/packages/io.github.sds100.keymapper/\r\n2. Record triggers for pressing play/pause two and three times (or whatever other buttons you have and want to use)\r\n3. As action, choose <del>`KEYCODE_MEDIA_FAST_REWIND` and `KEYCODE_MEDIA_FAST_FORWARD`</del><ins>rewind and fast forward actions</ins> respectively. <del>On my device that's 89 and 90.</del>\r\n\r\nKeymapper will now send those keycodes when you press play/pause multiple times.\r\n\r\nAnyway, it's not exactly perfect, requires root for full functionality, etc. But perhaps it's better than nothing.\nGreat idea @Frenzie  \r\nOne suggestion though, is to pick next track or previous track actions from the system tab and not from the keycodes tab. Reason being that keycodes require the Key Mapper soft keyboard to be active. So no Gboard or whatever you usually use. Use the system tab actions and you won't have this problem. I personally like that you can have the phone vibrate when the command is recognized.\r\n\r\nPeople can also use the app to find out if their headset button is in fact a headset button. If it's labeled something else by Key Mapper then probably Android will not do all of the built in headset button features (if any exist on your phone in the first place) and Key Mapper is for sure the way to go.\r\n\r\nIf you don't have root, then this workaround is pretty good but will not function reliably when the screen is off. Also, depending on the phone, enabling any accessibility service can cause intermittent jank throughout the whole OS. As an aside one improvement in the Android 12 beta is a large reduction in this jank at least on the Pixel 4a.\n> If you don't have root, then this workaround is pretty good but will not function reliably when the screen is off.\n\nThanks for sharing that tip. Not useful for me, unfortunately, as on the bike my screen is off :)\n> Use the system tab actions and you won't have this problem.\r\n\r\nI hadn't noticed those, perhaps because for me they're in a tab called \"other\".\n> > Use the system tab actions and you won't have this problem.\r\n> \r\n> I hadn't noticed those, perhaps because for me they're in a tab called \"other\".\r\n\r\nAh yes I forgot I am on a preview version with some small UI changes.\nHey guys, \r\n\r\nGreat feature enhancement!\r\n\r\nCould you also consider not only double/triple pressing but long press as well? \r\n\r\nAnd with those to also adjust volume (up/down).\r\n\r\nThis would be wonderful for cases when you have a headset with only one playback button. \r\n\r\nThanks!\nConsider all bluetooth speakers have play/pause button and volume up/down. Doubletapping any of these to e.g. skip backward is ridiculously useful, and shouldn't require much work or refactoring - just script one event to a doubletap\r\n\r\nI mean pardon the blunt suggestion but:\r\nif app was paused and unpaused in <1s, then map a different event to that.\n> For what it's worth the Pixel 4a on Android 11 seems to support double & triple headset clicks natively. Clicking like that sends next and previous respectively, which antennapod already can optionally handle as skip forward or back however many seconds. I've tested 3 different brands of ear buds with inline remotes and all three behave this way. Some apps ignore this feature (e.g. tsacdop) but many seem to accept the behavior (Podcast Addict; YT Music; Music Player Go; Oto Music) even when the screen is off. Does anyone know if this is a Pixel thing or an Android 11 feature or what?\r\n> \r\n> Edit: I tested 3.5mm headsets, not USB or bluetooth\r\n\r\nI've learned some more since I wrote this. On Pixel phones and many others too, the Google app is configured by default to detect headset button presses. This is so it can activate Assistant with a long press. When you double or triple press, the Google app sends a next or previous track intent (I'm assuming it's an intent?) and if the active player understands this it may perform the action the user expects. AntennaPod reacts to this situation well and works out of the box for a lot of phones* to change tracks or FF/RW depending on in-app settings.\r\n\r\nIf you disable the Google app, don't have GMS, or set the device's Assistant app to none or something other than Google's then these built in headset control features stop working. Any app still has the option to capture headset button events and process them itself. Some apps do this and they continue to change tracks with double and triple button presses but many apps do not.\r\n\r\n*There is a big asterisk here which is that in my testing 3.5mm jacks reliably trigger Google to send the next/previous commands but my USB to 3.5mm dongles do not. USB C headsets also didn't work for me. The keycodes are different on these USB devices. Bluetooth devices also won't work with double and triple presses in my testing, but many have their own method to skip tracks.\nWhy is it such a big, 5-years-old problem? I don't get it. Because of lack of this feature I was forced to test many other players. During my testing period I tried dozens of audio players and, although they were not as good in managing podcasts, they all worked great with double/triple button presses. Some of them didn't allow to change the skip time duration but only in AntennaPod this function doesn't work at all. Making the matters worse, in settings we are able to customize what these standard \"previous\" and \"next\" headset commands have to do. And nothing. All button presses are treated as play/pause. Why? Why is this issue a thing?\r\nFor medical reasons I have serious attention span problems so skipping a couple seconds backwards is a must have for me. I use it more than you would believed. As of now I have to use AntennaPod to download podcast to phone memory, use different app to play it, and then go back to AntennaPod, find it, and delete it from memory. This gets super tedious really quick. And frustrating, I'm afraid.\n> Why is it such a big, 5-years-old problem? I don't get it. Because of lack of this feature I was forced to test many other players\n> \u2026\n> All button presses are treated as play/pause. Why? Why is this issue a thing?\n> \u2026\n> As of now I have to use AntennaPod to download podcast to phone memory, use different app to play it\n\nI understand it can be frustrating. Also I personally find it important that we consider users with special needs as good as possible.\n\nHowever, please remember that this whole project is run by volunteers who work on it in their spare time. Also, the app is provided 'as is' and for free, so nobody can claim any right to a functional product. Feel free to change apps if it doesn't suit your needs.\n\nI will be closing this issue for comments now, given that both the need and the support for it are clear.", "created_at": "2023-07-13T06:15:02Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6530, "instance_id": "AntennaPod__AntennaPod-6530", "issue_numbers": ["6460"], "base_commit": "75c3c4cf249b685d4c7ffc88b3db212963659df8", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadRequestCreator.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadRequestCreator.java\nindex 5ca904ff66..4d5f2883d0 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadRequestCreator.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadRequestCreator.java\n@@ -28,7 +28,6 @@ public static DownloadRequest.Builder create(Feed feed) {\n \n         return new DownloadRequest.Builder(dest.toString(), feed)\n                 .withAuthentication(username, password)\n-                .deleteOnFailure(true)\n                 .lastModified(feed.getLastUpdate());\n     }\n \n@@ -53,7 +52,6 @@ public static DownloadRequest.Builder create(FeedMedia media) {\n                 ? media.getItem().getFeed().getPreferences().getPassword() : null;\n \n         return new DownloadRequest.Builder(dest.toString(), media)\n-                .deleteOnFailure(false)\n                 .withAuthentication(username, password);\n     }\n \ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/EpisodeDownloadWorker.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/EpisodeDownloadWorker.java\nindex c428bc861e..62956894c0 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/EpisodeDownloadWorker.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/download/EpisodeDownloadWorker.java\n@@ -134,6 +134,7 @@ private Result performDownload(FeedMedia media, DownloadRequest request) {\n             } else {\n                 sendErrorNotification();\n             }\n+            FileUtils.deleteQuietly(new File(downloader.getDownloadRequest().getDestination()));\n             return Result.failure();\n         }\n \n@@ -162,6 +163,9 @@ private Result performDownload(FeedMedia media, DownloadRequest request) {\n             Log.d(TAG, \"Requested invalid range, restarting download from the beginning\");\n             FileUtils.deleteQuietly(new File(downloader.getDownloadRequest().getDestination()));\n             sendMessage(request.getTitle(), true);\n+            if (isLastRunAttempt()) {\n+                FileUtils.deleteQuietly(new File(downloader.getDownloadRequest().getDestination()));\n+            }\n             return retry3times();\n         }\n \n@@ -177,21 +181,29 @@ private Result performDownload(FeedMedia media, DownloadRequest request) {\n             } else {\n                 sendErrorNotification();\n             }\n+            FileUtils.deleteQuietly(new File(downloader.getDownloadRequest().getDestination()));\n             return Result.failure();\n         }\n         sendMessage(request.getTitle(), true);\n+        if (isLastRunAttempt()) {\n+            FileUtils.deleteQuietly(new File(downloader.getDownloadRequest().getDestination()));\n+        }\n         return retry3times();\n     }\n \n     private Result retry3times() {\n-        if (getRunAttemptCount() < 2) {\n-            return Result.retry();\n-        } else {\n+        if (isLastRunAttempt()) {\n             sendErrorNotification();\n             return Result.failure();\n+        } else {\n+            return Result.retry();\n         }\n     }\n \n+    private boolean isLastRunAttempt() {\n+        return getRunAttemptCount() >= 2;\n+    }\n+\n     private void sendMessage(String episodeTitle, boolean retrying) {\n         if (episodeTitle.length() > 20) {\n             episodeTitle = episodeTitle.substring(0, 19) + \"\u2026\";\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/HttpDownloader.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/HttpDownloader.java\nindex 6de5e70067..94cd81337f 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/HttpDownloader.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/download/HttpDownloader.java\n@@ -49,12 +49,6 @@ protected void download() {\n         File destination = new File(request.getDestination());\n         final boolean fileExists = destination.exists();\n \n-        if (request.isDeleteOnFailure() && fileExists) {\n-            Log.w(TAG, \"File already exists\");\n-            onSuccess();\n-            return;\n-        }\n-\n         RandomAccessFile out = null;\n         InputStream connection;\n         ResponseBody responseBody = null;\n@@ -309,31 +303,11 @@ private void onSuccess() {\n     private void onFail(DownloadError reason, String reasonDetailed) {\n         Log.d(TAG, \"onFail() called with: \" + \"reason = [\" + reason + \"], reasonDetailed = [\" + reasonDetailed + \"]\");\n         result.setFailed(reason, reasonDetailed);\n-        if (request.isDeleteOnFailure()) {\n-            cleanup();\n-        }\n     }\n \n     private void onCancelled() {\n         Log.d(TAG, \"Download was cancelled\");\n         result.setCancelled();\n         cancelled = true;\n-        cleanup();\n-    }\n-\n-    /**\n-     * Deletes unfinished downloads.\n-     */\n-    private void cleanup() {\n-        if (request.getDestination() != null) {\n-            File dest = new File(request.getDestination());\n-            if (dest.exists()) {\n-                boolean rc = dest.delete();\n-                Log.d(TAG, \"Deleted file \" + dest.getName() + \"; Result: \"\n-                        + rc);\n-            } else {\n-                Log.d(TAG, \"cleanup() didn't delete file: does not exist.\");\n-            }\n-        }\n     }\n }\ndiff --git a/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadRequest.java b/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadRequest.java\nindex 9f9737edce..962ecfc84e 100644\n--- a/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadRequest.java\n+++ b/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadRequest.java\n@@ -14,7 +14,6 @@\n \n public class DownloadRequest implements Parcelable {\n     public static final String REQUEST_ARG_PAGE_NR = \"page\";\n-    public static final String REQUEST_ARG_LOAD_ALL_PAGES = \"loadAllPages\";\n \n     private final String destination;\n     private final String source;\n@@ -22,7 +21,6 @@ public class DownloadRequest implements Parcelable {\n     private String username;\n     private String password;\n     private String lastModified;\n-    private final boolean deleteOnFailure;\n     private final long feedfileId;\n     private final int feedfileType;\n     private final Bundle arguments;\n@@ -35,26 +33,26 @@ public class DownloadRequest implements Parcelable {\n     private boolean initiatedByUser;\n \n     public DownloadRequest(@NonNull String destination, @NonNull String source, @NonNull String title, long feedfileId,\n-                           int feedfileType, String username, String password, boolean deleteOnFailure,\n+                           int feedfileType, String username, String password,\n                            Bundle arguments, boolean initiatedByUser) {\n-        this(destination, source, title, feedfileId, feedfileType, null, deleteOnFailure, username, password, false,\n-             arguments, initiatedByUser);\n+        this(destination, source, title, feedfileId, feedfileType, null, username, password, false,\n+                arguments, initiatedByUser);\n     }\n \n     private DownloadRequest(Builder builder) {\n         this(builder.destination, builder.source, builder.title, builder.feedfileId, builder.feedfileType,\n-             builder.lastModified, builder.deleteOnFailure, builder.username, builder.password, false,\n-             builder.arguments != null ? builder.arguments : new Bundle(), builder.initiatedByUser);\n+                builder.lastModified, builder.username, builder.password, false,\n+                builder.arguments, builder.initiatedByUser);\n     }\n \n     private DownloadRequest(Parcel in) {\n         this(in.readString(), in.readString(), in.readString(), in.readLong(), in.readInt(), in.readString(),\n-             in.readByte() > 0, nullIfEmpty(in.readString()), nullIfEmpty(in.readString()), in.readByte() > 0,\n-             in.readBundle(), in.readByte() > 0);\n+                nullIfEmpty(in.readString()), nullIfEmpty(in.readString()), in.readByte() > 0,\n+                in.readBundle(), in.readByte() > 0);\n     }\n \n     private DownloadRequest(String destination, String source, String title, long feedfileId, int feedfileType,\n-                            String lastModified, boolean deleteOnFailure, String username, String password,\n+                            String lastModified, String username, String password,\n                             boolean mediaEnqueued, Bundle arguments, boolean initiatedByUser) {\n         this.destination = destination;\n         this.source = source;\n@@ -62,7 +60,6 @@ private DownloadRequest(String destination, String source, String title, long fe\n         this.feedfileId = feedfileId;\n         this.feedfileType = feedfileType;\n         this.lastModified = lastModified;\n-        this.deleteOnFailure = deleteOnFailure;\n         this.username = username;\n         this.password = password;\n         this.mediaEnqueued = mediaEnqueued;\n@@ -83,7 +80,6 @@ public void writeToParcel(Parcel dest, int flags) {\n         dest.writeLong(feedfileId);\n         dest.writeInt(feedfileType);\n         dest.writeString(lastModified);\n-        dest.writeByte((deleteOnFailure) ? (byte) 1 : 0);\n         // in case of null username/password, still write an empty string\n         // (rather than skipping it). Otherwise, unmarshalling  a collection\n         // of them from a Parcel (from an Intent extra to submit a request to DownloadService) will fail.\n@@ -124,7 +120,6 @@ public boolean equals(Object o) {\n \n         if (lastModified != null ? !lastModified.equals(that.lastModified) : that.lastModified != null)\n             return false;\n-        if (deleteOnFailure != that.deleteOnFailure) return false;\n         if (feedfileId != that.feedfileId) return false;\n         if (feedfileType != that.feedfileType) return false;\n         if (progressPercent != that.progressPercent) return false;\n@@ -151,7 +146,6 @@ public int hashCode() {\n         result = 31 * result + (username != null ? username.hashCode() : 0);\n         result = 31 * result + (password != null ? password.hashCode() : 0);\n         result = 31 * result + (lastModified != null ? lastModified.hashCode() : 0);\n-        result = 31 * result + (deleteOnFailure ? 1 : 0);\n         result = 31 * result + (int) (feedfileId ^ (feedfileId >>> 32));\n         result = 31 * result + feedfileType;\n         result = 31 * result + arguments.hashCode();\n@@ -237,26 +231,6 @@ public String getLastModified() {\n         return lastModified;\n     }\n \n-    public boolean isDeleteOnFailure() {\n-        return deleteOnFailure;\n-    }\n-\n-    public boolean isMediaEnqueued() {\n-        return mediaEnqueued;\n-    }\n-\n-    public boolean isInitiatedByUser() {\n-        return initiatedByUser;\n-    }\n-\n-    /**\n-     * Set to true if the media is enqueued because of this download.\n-     * The state is helpful if the download is cancelled, and undoing the enqueue is needed.\n-     */\n-    public void setMediaEnqueued(boolean mediaEnqueued) {\n-        this.mediaEnqueued = mediaEnqueued;\n-    }\n-\n     public Bundle getArguments() {\n         return arguments;\n     }\n@@ -268,7 +242,6 @@ public static class Builder {\n         private String username;\n         private String password;\n         private String lastModified;\n-        private boolean deleteOnFailure = false;\n         private final long feedfileId;\n         private final int feedfileType;\n         private final Bundle arguments = new Bundle();\n@@ -306,11 +279,6 @@ public void setForce(boolean force) {\n             }\n         }\n \n-        public Builder deleteOnFailure(boolean deleteOnFailure) {\n-            this.deleteOnFailure = deleteOnFailure;\n-            return this;\n-        }\n-\n         public Builder lastModified(String lastModified) {\n             this.lastModified = lastModified;\n             return this;\n@@ -322,12 +290,6 @@ public Builder withAuthentication(String username, String password) {\n             return this;\n         }\n \n-        public void loadAllPages(boolean loadAllPages) {\n-            if (loadAllPages) {\n-                arguments.putBoolean(REQUEST_ARG_LOAD_ALL_PAGES, true);\n-            }\n-        }\n-\n         public DownloadRequest build() {\n             return new DownloadRequest(this);\n         }\n", "test_patch": "diff --git a/app/src/androidTest/java/de/test/antennapod/service/download/HttpDownloaderTest.java b/app/src/androidTest/java/de/test/antennapod/service/download/HttpDownloaderTest.java\nindex 76cba47066..aa55a1e59c 100644\n--- a/app/src/androidTest/java/de/test/antennapod/service/download/HttpDownloaderTest.java\n+++ b/app/src/androidTest/java/de/test/antennapod/service/download/HttpDownloaderTest.java\n@@ -72,12 +72,14 @@ private FeedFileImpl setupFeedFile(String downloadUrl, String title, boolean del\n     }\n \n     private Downloader download(String url, String title, boolean expectedResult) {\n-        return download(url, title, expectedResult, true, null, null, true);\n+        return download(url, title, expectedResult, true, null, null);\n     }\n \n-    private Downloader download(String url, String title, boolean expectedResult, boolean deleteExisting, String username, String password, boolean deleteOnFail) {\n+    private Downloader download(String url, String title, boolean expectedResult, boolean deleteExisting,\n+                                String username, String password) {\n         FeedFile feedFile = setupFeedFile(url, title, deleteExisting);\n-        DownloadRequest request = new DownloadRequest(feedFile.getFile_url(), url, title, 0, feedFile.getTypeAsInt(), username, password, deleteOnFail, null, false);\n+        DownloadRequest request = new DownloadRequest(feedFile.getFile_url(), url, title, 0, feedFile.getTypeAsInt(),\n+                username, password, null, false);\n         Downloader downloader = new HttpDownloader(request);\n         downloader.call();\n         DownloadResult status = downloader.getResult();\n@@ -112,7 +114,8 @@ public void test404() {\n     public void testCancel() {\n         final String url = httpServer.getBaseUrl() + \"/delay/3\";\n         FeedFileImpl feedFile = setupFeedFile(url, \"delay\", true);\n-        final Downloader downloader = new HttpDownloader(new DownloadRequest(feedFile.getFile_url(), url, \"delay\", 0, feedFile.getTypeAsInt(), null, null, true, null, false));\n+        final Downloader downloader = new HttpDownloader(new DownloadRequest(feedFile.getFile_url(), url, \"delay\", 0,\n+                feedFile.getTypeAsInt(), null, null, null, false));\n         Thread t = new Thread() {\n             @Override\n             public void run() {\n@@ -128,12 +131,11 @@ public void run() {\n         }\n         DownloadResult result = downloader.getResult();\n         assertFalse(result.isSuccessful());\n-        assertFalse(new File(feedFile.getFile_url()).exists());\n     }\n \n     @Test\n     public void testDeleteOnFailShouldDelete() {\n-        Downloader downloader = download(url404, \"testDeleteOnFailShouldDelete\", false, true, null, null, true);\n+        Downloader downloader = download(url404, \"testDeleteOnFailShouldDelete\", false, true, null, null);\n         assertFalse(new File(downloader.getDownloadRequest().getDestination()).exists());\n     }\n \n@@ -143,18 +145,18 @@ public void testDeleteOnFailShouldNotDelete() throws IOException {\n         File dest = new File(destDir, filename);\n         dest.delete();\n         assertTrue(dest.createNewFile());\n-        Downloader downloader = download(url404, filename, false, false, null, null, false);\n+        Downloader downloader = download(url404, filename, false, false, null, null);\n         assertTrue(new File(downloader.getDownloadRequest().getDestination()).exists());\n     }\n \n     @Test\n     public void testAuthenticationShouldSucceed() throws InterruptedException {\n-        download(urlAuth, \"testAuthSuccess\", true, true, \"user\", \"passwd\", true);\n+        download(urlAuth, \"testAuthSuccess\", true, true, \"user\", \"passwd\");\n     }\n \n     @Test\n     public void testAuthenticationShouldFail() {\n-        Downloader downloader = download(urlAuth, \"testAuthSuccess\", false, true, \"user\", \"Wrong passwd\", true);\n+        Downloader downloader = download(urlAuth, \"testAuthSuccess\", false, true, \"user\", \"Wrong passwd\");\n         assertEquals(DownloadError.ERROR_UNAUTHORIZED, downloader.getResult().getReason());\n     }\n \ndiff --git a/net/download/service-interface/src/test/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadRequestTest.java b/net/download/service-interface/src/test/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadRequestTest.java\nindex 2709744f7b..a48934cfeb 100644\n--- a/net/download/service-interface/src/test/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadRequestTest.java\n+++ b/net/download/service-interface/src/test/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadRequestTest.java\n@@ -41,17 +41,14 @@ public void downloadRequestTestEquals() {\n         String password = \"testPassword\";\n         FeedMedia item = createFeedItem(1);\n         DownloadRequest request1 = new DownloadRequest.Builder(destStr, item)\n-                .deleteOnFailure(true)\n                 .withAuthentication(username, password)\n                 .build();\n \n         DownloadRequest request2 = new DownloadRequest.Builder(destStr, item)\n-                .deleteOnFailure(true)\n                 .withAuthentication(username, password)\n                 .build();\n \n         DownloadRequest request3 = new DownloadRequest.Builder(destStr, item)\n-                .deleteOnFailure(true)\n                 .withAuthentication(\"diffUsername\", \"diffPassword\")\n                 .build();\n \n", "problem_statement": "Partial downloads that users do not retry are kept forever\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n2.7.1\n\n### Where did you get the app from\n\nGoogle Play\n\n### Problem you may be having, or feature you want\n\nThere are a number of issues around incomplete downloads but more than what to do about them I should first point out that they are invisible and take up space. This could happen when the app crashes while downloading or the storage fills up. Unless one downloads frequently from a relatively short backlog list of episodes and does one thing at a time, it's easy to lose track of what had been attempted. I imagine that over time these episodes add up to wasted space. I know that space is wasted because resuming a download does not start from scratch. Maybe these clear periodically but that would be also the wrong approach because the user could be roaming (data cost) or intended to hear something and the time spent spotting it again would be a waste.\r\n\r\nThe main issue is that there is hidden state. It's not obvious if any downloads are incomplete, and no easy / actionable list of such.\n\n### Suggested solution\n\nI see that there is a \"Download Log\" button at the top right, that I didn't notice before. I cannot tell if that would have helped because if the app doesn't crash, or the target space fills-up, things just continue downloading automatically. This log is fine showing everything, but the main issue as I see it is failed partial downloads that have started and are now incomplete. Several solutions are possible, all addressing the same issue in different ways, any one of the 1-3, and especially 2 or 3 would be great to have:\r\n\r\n1. a different icon for incomplete downloads as a visual cue to hit download again\r\n2. add a separate button (next to the Download Log button) with a list of just such downloads and with two options for each item -- resume or delete\r\n3. if a separate list is undesirable, perhaps add a filter for the various things in the log -- a second row of toggle buttons (union of category sets) or a menu (all vs select single category) -- my particular interest being the Incomplete category (all options should fit on a single line)\r\n4. Finally, perhaps there could be a summary about how much space incomplete downloads take up and a button to delete all of them (this is a nice-to-have that would make the #2 solution even better)\r\n\r\nAll of the above are complementary, some perhaps slightly easier. What's best would depend on the aesthetic preferences of the maintainers.\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "I can't believe I didn't notice this until just now; come to find out that partial downloads have been taking up 17 GB of internal storage!", "created_at": "2023-07-04T20:28:27Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6529, "instance_id": "AntennaPod__AntennaPod-6529", "issue_numbers": ["6491"], "base_commit": "6999a944bb3c1ce1547832ad15e401ff7cbbbe10", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/storage/DBWriter.java b/core/src/main/java/de/danoeh/antennapod/core/storage/DBWriter.java\nindex 4815737f40..11e82af27b 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/storage/DBWriter.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/storage/DBWriter.java\n@@ -360,6 +360,9 @@ public static Future<?> addQueueItem(final Context context, final FeedItem... it\n     public static Future<?> addQueueItem(final Context context, boolean markAsUnplayed, final FeedItem... items) {\n         LongList itemIds = new LongList(items.length);\n         for (FeedItem item : items) {\n+            if (!item.hasMedia()) {\n+                continue;\n+            }\n             itemIds.add(item.getId());\n             item.addTag(FeedItem.TAG_QUEUE);\n         }\n", "test_patch": "diff --git a/core/src/test/java/de/danoeh/antennapod/core/storage/DbWriterTest.java b/core/src/test/java/de/danoeh/antennapod/core/storage/DbWriterTest.java\nindex 08842e5fbd..fb7cad252d 100644\n--- a/core/src/test/java/de/danoeh/antennapod/core/storage/DbWriterTest.java\n+++ b/core/src/test/java/de/danoeh/antennapod/core/storage/DbWriterTest.java\n@@ -298,7 +298,6 @@ public void testDeleteFeedNoFeedMedia() throws Exception {\n         for (int i = 0; i < 10; i++) {\n             FeedItem item = new FeedItem(0, \"Item \" + i, \"Item\" + i, \"url\", new Date(), FeedItem.PLAYED, feed);\n             feed.getItems().add(item);\n-\n         }\n \n         PodDBAdapter adapter = PodDBAdapter.getInstance();\n@@ -444,6 +443,7 @@ public void testDeleteFeedItems() throws Exception {\n         // create items\n         for (int i = 0; i < 10; i++) {\n             FeedItem item = new FeedItem(0, \"Item \" + i, \"Item\" + i, \"url\", new Date(), FeedItem.PLAYED, feed);\n+            item.setMedia(new FeedMedia(item, \"\", 0, \"\"));\n             feed.getItems().add(item);\n         }\n \n@@ -522,6 +522,7 @@ private Feed queueTestSetupMultipleItems(final int numItems) throws Exception {\n         feed.setItems(new ArrayList<>());\n         for (int i = 0; i < numItems; i++) {\n             FeedItem item = new FeedItem(0, \"title \" + i, \"id \" + i, \"link \" + i, new Date(), FeedItem.PLAYED, feed);\n+            item.setMedia(new FeedMedia(item, \"\", 0, \"\"));\n             feed.getItems().add(item);\n         }\n \n@@ -548,6 +549,7 @@ public void testAddQueueItemSingleItem() throws Exception {\n         Feed feed = new Feed(\"url\", null, \"title\");\n         feed.setItems(new ArrayList<>());\n         FeedItem item = new FeedItem(0, \"title\", \"id\", \"link\", new Date(), FeedItem.PLAYED, feed);\n+        item.setMedia(new FeedMedia(item, \"\", 0, \"\"));\n         feed.getItems().add(item);\n \n         PodDBAdapter adapter = PodDBAdapter.getInstance();\n@@ -572,6 +574,7 @@ public void testAddQueueItemSingleItemAlreadyInQueue() throws Exception {\n         Feed feed = new Feed(\"url\", null, \"title\");\n         feed.setItems(new ArrayList<>());\n         FeedItem item = new FeedItem(0, \"title\", \"id\", \"link\", new Date(), FeedItem.PLAYED, feed);\n+        item.setMedia(new FeedMedia(item, \"\", 0, \"\"));\n         feed.getItems().add(item);\n \n         PodDBAdapter adapter = PodDBAdapter.getInstance();\n@@ -714,6 +717,7 @@ public void testMoveQueueItem() throws Exception {\n         for (int i = 0; i < numItems; i++) {\n             FeedItem item = new FeedItem(0, \"title \" + i, \"id \" + i, \"link \" + i,\n                     new Date(), FeedItem.PLAYED, feed);\n+            item.setMedia(new FeedMedia(item, \"\", 0, \"\"));\n             feed.getItems().add(item);\n         }\n \n@@ -762,6 +766,7 @@ public void testRemoveAllNewFlags() throws Exception {\n         for (int i = 0; i < numItems; i++) {\n             FeedItem item = new FeedItem(0, \"title \" + i, \"id \" + i, \"link \" + i,\n                     new Date(), FeedItem.NEW, feed);\n+            item.setMedia(new FeedMedia(item, \"\", 0, \"\"));\n             feed.getItems().add(item);\n         }\n \n@@ -788,6 +793,7 @@ private static Feed createTestFeed(int numItems) {\n         for (int i = 0; i < numItems; i++) {\n             FeedItem item = new FeedItem(0, \"title \" + i, \"id \" + i, \"link \" + i,\n                     new Date(), FeedItem.PLAYED, feed);\n+            item.setMedia(new FeedMedia(item, \"\", 0, \"\"));\n             feed.getItems().add(item);\n         }\n \n", "problem_statement": "It's possiblle to add contentless entry to queue with swipes, but not with menus.\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.0.2\n\n### Where did you get the app from\n\nF-Droid\n\n### Android version\n\n13\n\n### Device model\n\nSamsung Fold 2\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Make a podcast feed with an entry that doesn't specify content to download (those with checkmarks, any regular RSS podcastless feed should do for testing)\r\n2. Context menu on that entry won't offer the possibility to add the contentless entry to queue\r\n3. Configuring swipes to enqueue and swiping on them adds the contentless entry to queue\n\n### Expected behaviour\n\nConsistently either block or allow adding contentless entries.\r\n\r\nVariant A: Contentless entries can be enqueued either with swipes nor with context menus. When entry gains content on refresh, the tickbox changes to a dowloading indicator, then to playback button. Personally, I'd prefer this variant.\r\n\r\nVariant B: Contentless entries cannot be enqueued neither with swipes nor with context menus.\n\n### Current behaviour\n\nContentless entries cannot be enqueued with menus, but can be enqueued with swipes. When the entry gains content on refresh, it is correctly auto-downloaded (provided auto-downloading is enabled), but there's a visual glitch where it still displays the checkmark up until the downloading is completed.\n\n### Logs\n\n_No response_\n", "hints_text": "Thanks for pointing that out. I think we should consistently block.\n\nQuestion is: if your swipe action is 'add to queue' and that's not possible, what do we do? Block swipe? (That's not very user friendly, wouldn't do that.) Or choose a back-up action? (E.g. Remove from Inbox)\nDisplay the action icon in red, let the swipe through and do nothing?\n", "created_at": "2023-07-04T20:14:57Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6521, "instance_id": "AntennaPod__AntennaPod-6521", "issue_numbers": ["6512"], "base_commit": "7b5d366536b11f0829d4cdc447a015a8032e3179", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\nindex a55bfade31..d8e21e8c95 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n@@ -332,6 +332,10 @@ public void setPlayerVisible(boolean visible) {\n         params.setMargins(navigationBarInsets.left, 0, navigationBarInsets.right,\n                 navigationBarInsets.bottom + (visible ? externalPlayerHeight : 0));\n         mainView.setLayoutParams(params);\n+        FragmentContainerView playerView = findViewById(R.id.playerFragment);\n+        ViewGroup.MarginLayoutParams playerParams = (ViewGroup.MarginLayoutParams) playerView.getLayoutParams();\n+        playerParams.setMargins(navigationBarInsets.left, 0, navigationBarInsets.right, 0);\n+        playerView.setLayoutParams(playerParams);\n         findViewById(R.id.audioplayerFragment).setVisibility(visible ? View.VISIBLE : View.GONE);\n     }\n \n", "test_patch": "", "problem_statement": "Mini player in landscape mode missing the Play button\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.0.2\n\n### Where did you get the app from\n\nF-Droid\n\n### Android version\n\nLineageOS 20.0\n\n### Device model\n\nOnePlus 7T Pro\n\n### First occurred\n\nUpon V3 update\n\n### Steps to reproduce\n\n1. Open the app\r\n2. Put the phone in landscape mode\n\n### Expected behaviour\n\nCurrently playing podcast should have a Play button on it, so the resume is faster\n\n### Current behaviour\n\nThere is no Play button.\n\n### Logs\n\n_No response_\n", "hints_text": "![Screenshot_20230601-082806_AntennaPod](https://github.com/AntennaPod/AntennaPod/assets/31107370/136a0408-254b-46fb-92bb-3de4f00df1d8)\r\n\nThe button is actually missing in what we call the 'mini-player'. The button is not only missing on the Home screen, but in any screen when you have the mini-player open. I've updated the title accordingly.\nHii @keunes Button is not missing . But what actually happening is .. Button is hidden under the Bottom Navigation Bar.\r\nI had fixed this issue by adding some the margin(equals to width of Navigation Bar in landscape mode) dynamically.", "created_at": "2023-06-19T18:55:42Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6520, "instance_id": "AntennaPod__AntennaPod-6520", "issue_numbers": ["6513"], "base_commit": "7b5d366536b11f0829d4cdc447a015a8032e3179", "patch": "diff --git a/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/namespace/SimpleChapters.java b/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/namespace/SimpleChapters.java\nindex dd116e1898..67796d9bb2 100644\n--- a/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/namespace/SimpleChapters.java\n+++ b/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/namespace/SimpleChapters.java\n@@ -1,5 +1,6 @@\n package de.danoeh.antennapod.parser.feed.namespace;\n \n+import android.text.TextUtils;\n import android.util.Log;\n \n import de.danoeh.antennapod.model.feed.Chapter;\n@@ -31,7 +32,8 @@ public SyndElement handleElementStart(String localName, HandlerState state, Attr\n         if (currentItem != null) {\n             if (localName.equals(CHAPTERS)) {\n                 currentItem.setChapters(new ArrayList<>());\n-            } else if (localName.equals(CHAPTER)) {\n+            } else if (localName.equals(CHAPTER) && !TextUtils.isEmpty(attributes.getValue(START))) {\n+                // if the chapter's START is empty, we don't need to do anything\n                 try {\n                     long start = DateUtils.parseTimeString(attributes.getValue(START));\n                     String title = attributes.getValue(TITLE);\n", "test_patch": "", "problem_statement": "java.lang.NullPointerException for certain RSS-Feed\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.0.2\n\n### Where did you get the app from\n\nF-Droid\n\n### Android version\n\n12 / Graphene OS\n\n### Device model\n\nPixel 3a\n\n### First occurred\n\n8\n\n### Steps to reproduce\n\n1. Search for Podcast \"Netzbasteln\" or open Feed https://feed.netzbasteln.de/feed/mp3/ \r\n2. Click on the Logo to start importing the feed\r\n3. Error appears\n\n### Expected behaviour\n\nI thought I could listen and subscribe to the podcast.\n\n### Current behaviour\n\nIt shows an error \"java.lang.NullPointerException: Attempt to invoke virtual method 'java.lang.String[] java.lang.String.split(java.lang.String)' on a null object reference\"\r\n\r\n![grafik](https://github.com/AntennaPod/AntennaPod/assets/44298010/c7acfec3-9964-4bfc-9816-ffd88fc6a91f)\r\n\r\nThis bug is reproducable on different devices and I have listeners of my podcast complaing about it on social media.\r\n\n\n### Logs\n\n```\r\n06-14 14:57:28.654 17783 17783 D InputMethodManager: showSoftInput() view=androidx.appcompat.widget.AppCompatEditText{27d9673 VFED..CL. .F.P..ID 154,0-970,155 #7f0900ad app:id/combinedFeedSearchEditText aid=1073741824} flags=0 reason=SHOW_SOFT_INPUT\r\n06-14 14:57:28.762 17783 18098 D MtpDeviceJNI: register_android_mtp_MtpDevice\r\n06-14 14:57:29.092 17783 17783 D InsetsController: show(ime(), fromIme=true)\r\n06-14 14:57:29.249 17783 17783 D ShownotesWebView: Page finished\r\n06-14 14:57:29.299 17783 17783 D ItemDescriptionFragment: Restoring from preferences\r\n06-14 14:57:33.633 17783 18124 D DBWriter: updateFeedDownloadURL(original: http://feed.netzbasteln.de/img/Netzbasteln_Logo-M15-144.jpg, updated: https://feed.netzbasteln.de/img/Netzbasteln_Logo-M15-144.jpg)\r\n06-14 14:57:34.320 17783 17783 D UserPreferences: Using default data folder\r\n06-14 14:57:34.357 17783 17783 D OnlineFeedViewActivity: Activity was started with url https://feed.netzbasteln.de/feed/mp3/\r\n06-14 14:57:34.358 17783 18044 D OnlineFeedViewActivity: Starting feed download\r\n06-14 14:57:34.358 17783 18044 D UserPreferences: Using default data folder\r\n06-14 14:57:34.363 17783 18238 D DBReader: Extracting Feedlist\r\n06-14 14:57:34.454 17783 17783 W Choreographer: Frame time is 0.108397 ms in the future!  Check that graphics HAL is generating vsync timestamps using the correct timebase.\r\n06-14 14:57:34.558 17783 18238 D HttpDownloader: Response code is 200\r\n06-14 14:57:34.558 17783 18238 D UserPreferences: Using default data folder\r\n06-14 14:57:34.566 17783 18238 D HttpDownloader: Getting size of download\r\n06-14 14:57:34.566 17783 18238 D HttpDownloader: Size is -1\r\n06-14 14:57:34.566 17783 18238 D UserPreferences: Using default data folder\r\n06-14 14:57:34.568 17783 18238 D HttpDownloader: Free space is 43900653568\r\n06-14 14:57:34.568 17783 18238 D HttpDownloader: Starting download\r\n06-14 14:57:34.596 17783 18238 D HttpDownloader: Download was successful\r\n06-14 14:57:34.599 17783 17783 D OnlineFeedViewActivity: Parsing feed\r\n06-14 14:57:34.607 17783 18249 D TypeGetter: Recognized type RSS 2.0\r\n06-14 14:57:34.610 17783 18249 D SyndHandler: Recognized Atom namespace\r\n06-14 14:57:34.610 17783 18249 D SyndHandler: Recognized ITunes namespace\r\n06-14 14:57:34.611 17783 18249 D SyndHandler: Recognized Content namespace\r\n06-14 14:57:34.611 17783 18249 D SyndHandler: Recognized DublinCore namespace\r\n06-14 14:57:34.611 17783 18249 D SyndHandler: Recognized media namespace\r\n06-14 14:57:34.611 17783 18249 D SyndHandler: Recognized SimpleChapters namespace\r\n06-14 14:57:34.639 17783 18249 E OnlineFeedViewActivity: java.lang.NullPointerException: Attempt to invoke virtual method 'java.lang.String[] java.lang.String.split(java.lang.String)' on a null object reference\r\n06-14 14:57:34.639 17783 18249 E OnlineFeedViewActivity: \tat de.danoeh.antennapod.parser.feed.util.DateUtils.parseTimeString(SourceFile:148)\r\n06-14 14:57:34.639 17783 18249 E OnlineFeedViewActivity: \tat de.danoeh.antennapod.parser.feed.namespace.SimpleChapters.handleElementStart(SourceFile:36)\r\n06-14 14:57:34.639 17783 18249 E OnlineFeedViewActivity: \tat de.danoeh.antennapod.parser.feed.SyndHandler.startElement(SourceFile:41)\r\n06-14 14:57:34.639 17783 18249 E OnlineFeedViewActivity: \tat org.apache.harmony.xml.ExpatParser.startElement(ExpatParser.java:154)\r\n06-14 14:57:34.639 17783 18249 E OnlineFeedViewActivity: \tat org.apache.harmony.xml.ExpatParser.appendChars(Native Method)\r\n06-14 14:57:34.639 17783 18249 E OnlineFeedViewActivity: \tat org.apache.harmony.xml.ExpatParser.parseFragment(ExpatParser.java:510)\r\n06-14 14:57:34.639 17783 18249 E OnlineFeedViewActivity: \tat org.apache.harmony.xml.ExpatParser.parseDocument(ExpatParser.java:497)\r\n06-14 14:57:34.639 17783 18249 E OnlineFeedViewActivity: \tat org.apache.harmony.xml.ExpatReader.parse(ExpatReader.java:317)\r\n06-14 14:57:34.639 17783 18249 E OnlineFeedViewActivity: \tat org.apache.harmony.xml.ExpatReader.parse(ExpatReader.java:275)\r\n06-14 14:57:34.639 17783 18249 E OnlineFeedViewActivity: \tat javax.xml.parsers.SAXParser.parse(SAXParser.java:390)\r\n06-14 14:57:34.639 17783 18249 E OnlineFeedViewActivity: \tat de.danoeh.antennapod.parser.feed.FeedHandler.parseFeed(SourceFile:32)\r\n06-14 14:57:34.639 17783 18249 E OnlineFeedViewActivity: \tat de.danoeh.antennapod.activity.OnlineFeedViewActivity.doParseFeed(SourceFile:363)\r\n06-14 14:57:34.639 17783 18249 E OnlineFeedViewActivity: \tat de.danoeh.antennapod.activity.OnlineFeedViewActivity.lambda$8LjnVEdyNlyhhRVe3xJElvBXPoE(Unknown Source:0)\r\n06-14 14:57:34.639 17783 18249 E OnlineFeedViewActivity: \tat de.danoeh.antennapod.activity.-$$Lambda$OnlineFeedViewActivity$8LjnVEdyNlyhhRVe3xJElvBXPoE.call(Unknown Source:2)\r\n06-14 14:57:34.639 17783 18249 E OnlineFeedViewActivity: \tat io.reactivex.internal.operators.maybe.MaybeFromCallable.subscribeActual(SourceFile:46)\r\n06-14 14:57:34.639 17783 18249 E OnlineFeedViewActivity: \tat io.reactivex.Maybe.subscribe(SourceFile:4262)\r\n06-14 14:57:34.639 17783 18249 E OnlineFeedViewActivity: \tat io.reactivex.internal.operators.maybe.MaybeSubscribeOn$SubscribeTask.run(SourceFile:54)\r\n06-14 14:57:34.639 17783 18249 E OnlineFeedViewActivity: \tat io.reactivex.internal.schedulers.ScheduledDirectTask.call(SourceFile:38)\r\n06-14 14:57:34.639 17783 18249 E OnlineFeedViewActivity: \tat io.reactivex.internal.schedulers.ScheduledDirectTask.call(SourceFile:26)\r\n06-14 14:57:34.639 17783 18249 E OnlineFeedViewActivity: \tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n06-14 14:57:34.639 17783 18249 E OnlineFeedViewActivity: \tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:301)\r\n06-14 14:57:34.639 17783 18249 E OnlineFeedViewActivity: \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167)\r\n06-14 14:57:34.639 17783 18249 E OnlineFeedViewActivity: \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:641)\r\n06-14 14:57:34.639 17783 18249 E OnlineFeedViewActivity: \tat java.lang.Thread.run(Thread.java:920)\r\n06-14 14:57:34.640 17783 18249 D OnlineFeedViewActivity: Deleted feed source file. Result: true\r\n06-14 14:57:34.686 17783 17783 D OnlineFeedViewActivity: Feed parser exception: java.lang.NullPointerException: Attempt to invoke virtual method 'java.lang.String[] java.lang.String.split(java.lang.String)' on a null object reference\r\n06-14 14:57:34.686 17783 17783 D OnlineFeedViewActivity: \tat de.danoeh.antennapod.parser.feed.util.DateUtils.parseTimeString(SourceFile:148)\r\n06-14 14:57:34.686 17783 17783 D OnlineFeedViewActivity: \tat de.danoeh.antennapod.parser.feed.namespace.SimpleChapters.handleElementStart(SourceFile:36)\r\n06-14 14:57:34.686 17783 17783 D OnlineFeedViewActivity: \tat de.danoeh.antennapod.parser.feed.SyndHandler.startElement(SourceFile:41)\r\n06-14 14:57:34.686 17783 17783 D OnlineFeedViewActivity: \tat org.apache.harmony.xml.ExpatParser.startElement(ExpatParser.java:154)\r\n06-14 14:57:34.686 17783 17783 D OnlineFeedViewActivity: \tat org.apache.harmony.xml.ExpatParser.appendChars(Native Method)\r\n06-14 14:57:34.686 17783 17783 D OnlineFeedViewActivity: \tat org.apache.harmony.xml.ExpatParser.parseFragment(ExpatParser.java:510)\r\n06-14 14:57:34.686 17783 17783 D OnlineFeedViewActivity: \tat org.apache.harmony.xml.ExpatParser.parseDocument(ExpatParser.java:497)\r\n06-14 14:57:34.686 17783 17783 D OnlineFeedViewActivity: \tat org.apache.harmony.xml.ExpatReader.parse(ExpatReader.java:317)\r\n06-14 14:57:34.686 17783 17783 D OnlineFeedViewActivity: \tat org.apache.harmony.xml.ExpatReader.parse(ExpatReader.java:275)\r\n06-14 14:57:34.686 17783 17783 D OnlineFeedViewActivity: \tat javax.xml.parsers.SAXParser.parse(SAXParser.java:390)\r\n06-14 14:57:34.686 17783 17783 D OnlineFeedViewActivity: \tat de.danoeh.antennapod.parser.feed.FeedHandler.parseFeed(SourceFile:32)\r\n06-14 14:57:34.686 17783 17783 D OnlineFeedViewActivity: \tat de.danoeh.antennapod.activity.OnlineFeedViewActivity.doParseFeed(SourceFile:363)\r\n06-14 14:57:34.686 17783 17783 D OnlineFeedViewActivity: \tat de.danoeh.antennapod.activity.OnlineFeedViewActivity.lambda$8LjnVEdyNlyhhRVe3xJElvBXPoE(Unknown Source:0)\r\n06-14 14:57:34.686 17783 17783 D OnlineFeedViewActivity: \tat de.danoeh.antennapod.activity.-$$Lambda$OnlineFeedViewActivity$8LjnVEdyNlyhhRVe3xJElvBXPoE.call(Unknown Source:2)\r\n06-14 14:57:34.686 17783 17783 D OnlineFeedViewActivity: \tat io.reactivex.internal.operators.maybe.MaybeFromCallable.subscribeActual(SourceFile:46)\r\n06-14 14:57:34.686 17783 17783 D OnlineFeedViewActivity: \tat io.reactivex.Maybe.subscribe(SourceFile:4262)\r\n06-14 14:57:34.686 17783 17783 D OnlineFeedViewActivity: \tat io.reactivex.internal.operators.maybe.MaybeSubscribeOn$SubscribeTask.run(SourceFile:54)\r\n06-14 14:57:34.686 17783 17783 D OnlineFeedViewActivity: \tat io.reactivex.internal.schedulers.ScheduledDirectTask.call(SourceFile:38)\r\n06-14 14:57:34.686 17783 17783 D OnlineFeedViewActivity: \tat io.reactivex.internal.schedulers.ScheduledDirectTask.call(SourceFile:26)\r\n06-14 14:57:34.686 17783 17783 D OnlineFeedViewActivity: \tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n06-14 14:57:34.686 17783 17783 D OnlineFeedViewActivity: \tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:301)\r\n06-14 14:57:34.686 17783 17783 D OnlineFeedViewActivity: \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167)\r\n06-14 14:57:34.686 17783 17783 D OnlineFeedViewActivity: \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:641)\r\n06-14 14:57:34.686 17783 17783 D OnlineFeedViewActivity: \tat java.lang.Thread.run(Thread.java:920)\r\n06-14 14:57:36.044 17783 18028 D OpenGLRenderer: endAllActiveAnimators on 0x4253403a00 (RippleDrawable) with handle 0x3070cb4e10\r\n06-14 14:57:36.130 17783 17783 D UserPreferences: Using default data folder\r\n06-14 14:57:36.133 17783 18034 D DBReader: getNavDrawerData() called with: \r\n06-14 14:57:36.153 17783 17783 D NavDrawerFragment: getLastNavFragment() -> AddFeedFragment\r\n06-14 14:57:36.155 17783 17783 D NavDrawerFragment: getLastNavFragment() -> AddFeedFragment\r\n06-14 14:57:36.156 17783 17783 D NavDrawerFragment: getLastNavFragment() -> AddFeedFragment\r\n06-14 14:57:36.156 17783 17783 D NavDrawerFragment: getLastNavFragment() -> AddFeedFragment\r\n06-14 14:57:36.157 17783 17783 D NavDrawerFragment: getLastNavFragment() -> AddFeedFragment\r\n06-14 14:57:36.157 17783 17783 D NavDrawerFragment: getLastNavFragment() -> AddFeedFragment\r\n06-14 14:57:36.158 17783 17783 D NavDrawerFragment: getLastNavFragment() -> AddFeedFragment\r\n06-14 14:57:36.159 17783 17783 D NavDrawerFragment: getLastNavFragment() -> AddFeedFragment\r\n06-14 14:57:38.631 17783 17783 D PlaybackController: Releasing PlaybackController\r\n06-14 14:57:38.633 17783 17783 D PlaybackController: Releasing PlaybackController\r\n06-14 14:57:38.633 17783 17783 D PlaybackController: Releasing PlaybackController\r\n06-14 14:57:38.633 17783 17783 D PlaybackController: Releasing PlaybackController\r\n06-14 14:57:59.846 17783 17783 D ExternalPlayerFragment: Loading media info\r\n```\n", "hints_text": "Hi there - thanks for considering this bug. It happened after I moved my podcast feed to a new server (permanently moved redirect) and changed the feed. The feed works passes validation and works nicely in every other podcatcher though. Friends report the same problem, no matter if the former podcast was already subscribed or not. \nit will be fixed in next version,", "created_at": "2023-06-19T13:53:19Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6495, "instance_id": "AntennaPod__AntennaPod-6495", "issue_numbers": ["6492"], "base_commit": "d51e937e9651bcd5955055bee6abffcdefaa0c66", "patch": "diff --git a/app/src/free/java/de/danoeh/antennapod/dialog/RatingDialog.java b/app/src/free/java/de/danoeh/antennapod/dialog/RatingDialog.java\nindex e7951626e0..ec470eee62 100644\n--- a/app/src/free/java/de/danoeh/antennapod/dialog/RatingDialog.java\n+++ b/app/src/free/java/de/danoeh/antennapod/dialog/RatingDialog.java\n@@ -1,116 +1,13 @@\n package de.danoeh.antennapod.dialog;\n \n-import android.app.Dialog;\n import android.content.Context;\n-import android.content.SharedPreferences;\n-import androidx.annotation.Nullable;\n import androidx.annotation.VisibleForTesting;\n-import android.util.Log;\n-\n-import java.lang.ref.WeakReference;\n-import java.util.concurrent.TimeUnit;\n-\n-import androidx.appcompat.app.AlertDialog;\n-import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n-\n-import de.danoeh.antennapod.BuildConfig;\n-import de.danoeh.antennapod.R;\n-import de.danoeh.antennapod.core.util.IntentUtils;\n \n public class RatingDialog {\n+    public static void init(Context context) {}\n \n-    private RatingDialog(){}\n-\n-    private static final String TAG = RatingDialog.class.getSimpleName();\n-    private static final int AFTER_DAYS = 7;\n-\n-    private static WeakReference<Context> mContext;\n-    private static SharedPreferences mPreferences;\n-    private static Dialog mDialog;\n-\n-    private static final String PREFS_NAME = \"RatingPrefs\";\n-    private static final String KEY_RATED = \"KEY_WAS_RATED\";\n-    private static final String KEY_FIRST_START_DATE = \"KEY_FIRST_HIT_DATE\";\n-\n-    public static void init(Context context) {\n-        mContext = new WeakReference<>(context);\n-        mPreferences = context.getSharedPreferences(PREFS_NAME, Context.MODE_PRIVATE);\n-\n-        long firstDate = mPreferences.getLong(KEY_FIRST_START_DATE, 0);\n-        if (firstDate == 0) {\n-            resetStartDate();\n-        }\n-    }\n-\n-    public static void check() {\n-        if (mDialog != null && mDialog.isShowing()) {\n-            return;\n-        }\n-        if (shouldShow()) {\n-            try {\n-                mDialog = createDialog();\n-                if (mDialog != null) {\n-                    mDialog.show();\n-                }\n-            } catch (Exception e) {\n-                Log.e(TAG, Log.getStackTraceString(e));\n-            }\n-        }\n-    }\n-\n-    private static void rateNow() {\n-        Context context = mContext.get();\n-        if (context == null) {\n-            return;\n-        }\n-        IntentUtils.openInBrowser(context, \"https://play.google.com/store/apps/details?id=de.danoeh.antennapod\");\n-        saveRated();\n-    }\n-\n-    private static boolean rated() {\n-        return mPreferences.getBoolean(KEY_RATED, false);\n-    }\n+    public static void check() {}\n \n     @VisibleForTesting\n-    public static void saveRated() {\n-        mPreferences\n-                .edit()\n-                .putBoolean(KEY_RATED, true)\n-                .apply();\n-    }\n-\n-    private static void resetStartDate() {\n-        mPreferences\n-                .edit()\n-                .putLong(KEY_FIRST_START_DATE, System.currentTimeMillis())\n-                .apply();\n-    }\n-\n-    private static boolean shouldShow() {\n-        if (rated() || BuildConfig.DEBUG) {\n-            return false;\n-        }\n-\n-        long now = System.currentTimeMillis();\n-        long firstDate = mPreferences.getLong(KEY_FIRST_START_DATE, now);\n-        long diff = now - firstDate;\n-        long diffDays = TimeUnit.DAYS.convert(diff, TimeUnit.MILLISECONDS);\n-        return diffDays >= AFTER_DAYS;\n-    }\n-\n-    @Nullable\n-    private static AlertDialog createDialog() {\n-        Context context = mContext.get();\n-        if (context == null) {\n-            return null;\n-        }\n-        return new MaterialAlertDialogBuilder(context)\n-                .setTitle(R.string.rating_title)\n-                .setMessage(R.string.rating_message)\n-                .setPositiveButton(R.string.rating_now_label, (dialog, which) -> rateNow())\n-                .setNegativeButton(R.string.rating_never_label, (dialog, which) -> saveRated())\n-                .setNeutralButton(R.string.rating_later_label, (dialog, which) -> resetStartDate())\n-                .setOnCancelListener(dialog1 -> resetStartDate())\n-                .create();\n-    }\n+    public static void saveRated() {}\n }\n\\ No newline at end of file\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 1959a2252e..46f159b2d6 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -769,13 +769,6 @@\n     <string name=\"sort_short_long\">Short \\u2192 Long</string>\n     <string name=\"sort_long_short\">Long \\u2192 Short</string>\n \n-    <!-- Rating dialog -->\n-    <string name=\"rating_title\" tools:ignore=\"UnusedResources\">Like AntennaPod?</string>\n-    <string name=\"rating_message\" tools:ignore=\"UnusedResources\">We would appreciate it if you take the time to rate AntennaPod.</string>\n-    <string name=\"rating_never_label\" tools:ignore=\"UnusedResources\">Leave me alone</string>\n-    <string name=\"rating_later_label\" tools:ignore=\"UnusedResources\">Remind me later</string>\n-    <string name=\"rating_now_label\" tools:ignore=\"UnusedResources\">Sure, let\\'s do this!</string>\n-\n     <!-- Share episode dialog -->\n     <string name=\"share_playback_position_dialog_label\">Include playback position</string>\n     <string name=\"share_dialog_episode_website_label\">Episode webpage</string>\n", "test_patch": "", "problem_statement": "Don't ask F-Droid users to rate AntennaPod\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.0.2\n\n### Where did you get the app from\n\nF-Droid\n\n### Problem you may be having, or feature you want\n\nCurrently, when having AntennaPod installed through F-Droid, users are asked to review the app on Google (via a link). That feels a bit odd, and we don't need the reviews (we already have plenty positive ones from Google Play users).\n\n### Suggested solution\n\nRemove the request to end-users (keep empty rating class).\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "", "created_at": "2023-05-20T13:17:49Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6481, "instance_id": "AntennaPod__AntennaPod-6481", "issue_numbers": ["6468"], "base_commit": "c759eed50d9c07c2314ff28800a17ae5cac9d35c", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/activity/BugReportActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/BugReportActivity.java\nindex 4bf157560e..8d07eb9692 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/BugReportActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/BugReportActivity.java\n@@ -4,6 +4,7 @@\n import android.content.ClipboardManager;\n import android.content.Context;\n import android.net.Uri;\n+import android.os.Build;\n import android.os.Bundle;\n import android.util.Log;\n import com.google.android.material.snackbar.Snackbar;\n@@ -67,7 +68,10 @@ protected void onCreate(Bundle savedInstanceState) {\n             ClipboardManager clipboard = (ClipboardManager) getSystemService(Context.CLIPBOARD_SERVICE);\n             ClipData clip = ClipData.newPlainText(getString(R.string.bug_report_title), crashDetailsTextView.getText());\n             clipboard.setPrimaryClip(clip);\n-            Snackbar.make(findViewById(android.R.id.content), R.string.copied_to_clipboard, Snackbar.LENGTH_SHORT).show();\n+            if (Build.VERSION.SDK_INT < 32) {\n+                Snackbar.make(findViewById(android.R.id.content), R.string.copied_to_clipboard,\n+                        Snackbar.LENGTH_SHORT).show();\n+            }\n         });\n     }\n \ndiff --git a/app/src/main/java/de/danoeh/antennapod/dialog/DownloadLogDetailsDialog.java b/app/src/main/java/de/danoeh/antennapod/dialog/DownloadLogDetailsDialog.java\nindex 5e28639ddf..131c6363fe 100644\n--- a/app/src/main/java/de/danoeh/antennapod/dialog/DownloadLogDetailsDialog.java\n+++ b/app/src/main/java/de/danoeh/antennapod/dialog/DownloadLogDetailsDialog.java\n@@ -3,6 +3,7 @@\n import android.content.ClipData;\n import android.content.ClipboardManager;\n import android.content.Context;\n+import android.os.Build;\n import android.widget.TextView;\n import androidx.annotation.NonNull;\n import androidx.appcompat.app.AlertDialog;\n@@ -49,7 +50,9 @@ public DownloadLogDetailsDialog(@NonNull Context context, DownloadStatus status)\n                     .getSystemService(Context.CLIPBOARD_SERVICE);\n             ClipData clip = ClipData.newPlainText(context.getString(R.string.download_error_details), messageFull);\n             clipboard.setPrimaryClip(clip);\n-            EventBus.getDefault().post(new MessageEvent(context.getString(R.string.copied_to_clipboard)));\n+            if (Build.VERSION.SDK_INT < 32) {\n+                EventBus.getDefault().post(new MessageEvent(context.getString(R.string.copied_to_clipboard)));\n+            }\n         });\n     }\n \ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/CoverFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/CoverFragment.java\nindex f29f64b5c9..8bc88b8f77 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/CoverFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/CoverFragment.java\n@@ -10,6 +10,7 @@\n import android.content.res.Configuration;\n import android.graphics.ColorFilter;\n import android.graphics.drawable.Drawable;\n+import android.os.Build;\n import android.os.Bundle;\n import android.text.TextUtils;\n import android.util.Log;\n@@ -331,9 +332,10 @@ private boolean copyText(String text) {\n         if (clipboardManager != null) {\n             clipboardManager.setPrimaryClip(ClipData.newPlainText(\"AntennaPod\", text));\n         }\n-        ((MainActivity) requireActivity()).showSnackbarAbovePlayer(\n-                getResources().getString(R.string.copied_to_clipboard),\n-                Snackbar.LENGTH_SHORT);\n+        if (Build.VERSION.SDK_INT < 32) {\n+            ((MainActivity) requireActivity()).showSnackbarAbovePlayer(\n+                    getResources().getString(R.string.copied_to_clipboard), Snackbar.LENGTH_SHORT);\n+        }\n         return true;\n     }\n }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/FeedInfoFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/FeedInfoFragment.java\nindex 930440b39e..1ad55b2af6 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/FeedInfoFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/FeedInfoFragment.java\n@@ -7,6 +7,7 @@\n import android.content.res.Configuration;\n import android.graphics.LightingColorFilter;\n import android.net.Uri;\n+import android.os.Build;\n import android.os.Bundle;\n import android.text.TextUtils;\n import android.util.Log;\n@@ -98,7 +99,10 @@ public void onClick(View v) {\n                 android.content.ClipboardManager cm = (android.content.ClipboardManager) getContext()\n                         .getSystemService(Context.CLIPBOARD_SERVICE);\n                 cm.setPrimaryClip(clipData);\n-                ((MainActivity) getActivity()).showSnackbarAbovePlayer(R.string.copied_url_msg, Snackbar.LENGTH_SHORT);\n+                if (Build.VERSION.SDK_INT < 32) {\n+                    ((MainActivity) getActivity()).showSnackbarAbovePlayer(R.string.copied_to_clipboard,\n+                            Snackbar.LENGTH_SHORT);\n+                }\n             }\n         }\n     };\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/about/AboutFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/about/AboutFragment.java\nindex e85f600278..ad203d12af 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/about/AboutFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/about/AboutFragment.java\n@@ -3,6 +3,7 @@\n import android.content.ClipData;\n import android.content.ClipboardManager;\n import android.content.Context;\n+import android.os.Build;\n import android.os.Bundle;\n import androidx.preference.PreferenceFragmentCompat;\n import com.google.android.material.snackbar.Snackbar;\n@@ -24,7 +25,9 @@ public void onCreatePreferences(Bundle savedInstanceState, String rootKey) {\n             ClipData clip = ClipData.newPlainText(getString(R.string.bug_report_title),\n                     findPreference(\"about_version\").getSummary());\n             clipboard.setPrimaryClip(clip);\n-            Snackbar.make(getView(), R.string.copied_to_clipboard, Snackbar.LENGTH_SHORT).show();\n+            if (Build.VERSION.SDK_INT < 32) {\n+                Snackbar.make(getView(), R.string.copied_to_clipboard, Snackbar.LENGTH_SHORT).show();\n+            }\n             return true;\n         });\n         findPreference(\"about_contributors\").setOnPreferenceClickListener((preference) -> {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/view/ShownotesWebView.java b/app/src/main/java/de/danoeh/antennapod/view/ShownotesWebView.java\nindex b284aa2d67..a289e630af 100644\n--- a/app/src/main/java/de/danoeh/antennapod/view/ShownotesWebView.java\n+++ b/app/src/main/java/de/danoeh/antennapod/view/ShownotesWebView.java\n@@ -6,6 +6,7 @@\n import android.content.Intent;\n import android.graphics.Color;\n import android.net.Uri;\n+import android.os.Build;\n import android.util.AttributeSet;\n import android.util.Log;\n import android.view.ContextMenu;\n@@ -104,7 +105,7 @@ public boolean onLongClick(View v) {\n             if (clipboardManager != null) {\n                 clipboardManager.setPrimaryClip(ClipData.newPlainText(\"AntennaPod\", r.getExtra()));\n             }\n-            if (this.getContext() instanceof MainActivity) {\n+            if (Build.VERSION.SDK_INT < 32 && this.getContext() instanceof MainActivity) {\n                 ((MainActivity) this.getContext()).showSnackbarAbovePlayer(\n                         getResources().getString(R.string.copied_to_clipboard),\n                         Snackbar.LENGTH_SHORT);\n@@ -130,9 +131,11 @@ public boolean onContextItemSelected(MenuItem item) {\n             ClipboardManager cm = (ClipboardManager) getContext()\n                     .getSystemService(Context.CLIPBOARD_SERVICE);\n             cm.setPrimaryClip(clipData);\n-            Snackbar s = Snackbar.make(this, R.string.copied_url_msg, Snackbar.LENGTH_LONG);\n-            ViewCompat.setElevation(s.getView(), 100);\n-            s.show();\n+            if (Build.VERSION.SDK_INT < 32) {\n+                Snackbar s = Snackbar.make(this, R.string.copied_to_clipboard, Snackbar.LENGTH_LONG);\n+                ViewCompat.setElevation(s.getView(), 100);\n+                s.show();\n+            }\n         } else if (itemId == R.id.go_to_position_item) {\n             if (ShownotesCleaner.isTimecodeLink(selectedUrl) && timecodeSelectedListener != null) {\n                 timecodeSelectedListener.accept(ShownotesCleaner.getTimecodeLinkTime(selectedUrl));\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 2edce5df2d..7dd4024128 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -91,7 +91,6 @@\n     <string name=\"open_in_browser_label\">Open in Browser</string>\n     <string name=\"copy_url_label\">Copy URL</string>\n     <string name=\"share_url_label\">Share URL</string>\n-    <string name=\"copied_url_msg\">Copied URL to Clipboard</string>\n     <string name=\"go_to_position_label\">Go to this Position</string>\n \n     <!-- Playback history -->\n", "test_patch": "", "problem_statement": "Remove snackbar when copying text on Android 13\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n2.7.1\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n13\n\n### Device model\n\n_No response_\n\n### First occurred\n\nSince start of Android 13\n\n### Steps to reproduce\n\n1. Copy feed url\n\n### Expected behaviour\n\nI expect that AntennaPod doesn't show a snackbar on Android 13 when a text is copied to avoid duplicate notifications. Also see https://developer.android.com/develop/ui/views/touch-and-input/copy-paste?hl=en#duplicate-notifications\n\n### Current behaviour\n\nI see a duplicate notification.\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2023-05-10T11:27:57Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6477, "instance_id": "AntennaPod__AntennaPod-6477", "issue_numbers": ["6452"], "base_commit": "da16f13e8bcaa92333557823eef23f7c15636555", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/dialog/ItemFilterDialog.java b/app/src/main/java/de/danoeh/antennapod/dialog/ItemFilterDialog.java\nindex a122a7cec3..92c1439925 100644\n--- a/app/src/main/java/de/danoeh/antennapod/dialog/ItemFilterDialog.java\n+++ b/app/src/main/java/de/danoeh/antennapod/dialog/ItemFilterDialog.java\n@@ -47,6 +47,10 @@ public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup c\n             binding.filterButton1.setTag(item.values[0].filterId);\n             binding.filterButton2.setText(item.values[1].displayName);\n             binding.filterButton2.setTag(item.values[1].filterId);\n+            binding.filterButton1.setMaxLines(3);\n+            binding.filterButton1.setSingleLine(false);\n+            binding.filterButton2.setMaxLines(3);\n+            binding.filterButton2.setSingleLine(false);\n             rows.addView(binding.getRoot());\n         }\n \ndiff --git a/app/src/main/java/de/danoeh/antennapod/dialog/SubscriptionsFilterDialog.java b/app/src/main/java/de/danoeh/antennapod/dialog/SubscriptionsFilterDialog.java\nindex 1aedfcf8bd..cf77c28380 100644\n--- a/app/src/main/java/de/danoeh/antennapod/dialog/SubscriptionsFilterDialog.java\n+++ b/app/src/main/java/de/danoeh/antennapod/dialog/SubscriptionsFilterDialog.java\n@@ -46,6 +46,10 @@ public static void showDialog(Context context) {\n             } else {\n                 binding.filterButton2.setVisibility(View.GONE);\n             }\n+            binding.filterButton1.setMaxLines(3);\n+            binding.filterButton1.setSingleLine(false);\n+            binding.filterButton2.setMaxLines(3);\n+            binding.filterButton2.setSingleLine(false);\n             rows.addView(binding.getRoot());\n         }\n \ndiff --git a/app/src/main/res/layout/filter_dialog_row.xml b/app/src/main/res/layout/filter_dialog_row.xml\nindex cc397df02e..81185a1de2 100644\n--- a/app/src/main/res/layout/filter_dialog_row.xml\n+++ b/app/src/main/res/layout/filter_dialog_row.xml\n@@ -11,15 +11,15 @@\n     <Button\n         android:id=\"@+id/filterButton1\"\n         android:layout_width=\"0dp\"\n-        android:layout_height=\"wrap_content\"\n+        android:layout_height=\"match_parent\"\n         android:layout_weight=\"1\"\n-        style=\"?attr/materialButtonOutlinedStyle\" />\n+        style=\"@style/OutlinedButtonBetterContrast\" />\n \n     <Button\n         android:id=\"@+id/filterButton2\"\n         android:layout_width=\"0dp\"\n-        android:layout_height=\"wrap_content\"\n+        android:layout_height=\"match_parent\"\n         android:layout_weight=\"1\"\n-        style=\"?attr/materialButtonOutlinedStyle\" />\n+        style=\"@style/OutlinedButtonBetterContrast\" />\n \n </com.google.android.material.button.MaterialButtonToggleGroup>\ndiff --git a/core/src/main/res/color/button_bg_selector.xml b/core/src/main/res/color/button_bg_selector.xml\nnew file mode 100644\nindex 0000000000..f416daa72c\n--- /dev/null\n+++ b/core/src/main/res/color/button_bg_selector.xml\n@@ -0,0 +1,6 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<selector xmlns:android=\"http://schemas.android.com/apk/res/android\">\n+    <!-- Difference to Material Components: alpha is 0.3 instead of 0.08 -->\n+    <item android:alpha=\"0.3\" android:color=\"?attr/colorPrimary\" android:state_checked=\"true\"/>\n+    <item android:color=\"@android:color/transparent\" android:state_checked=\"false\"/>\n+</selector>\n\\ No newline at end of file\ndiff --git a/core/src/main/res/values/styles.xml b/core/src/main/res/values/styles.xml\nindex 6e1335706f..0ebf2aaf79 100644\n--- a/core/src/main/res/values/styles.xml\n+++ b/core/src/main/res/values/styles.xml\n@@ -253,6 +253,10 @@\n         <item name=\"android:ellipsize\">end</item>\n     </style>\n \n+    <style name=\"OutlinedButtonBetterContrast\" parent=\"Widget.Material3.Button.OutlinedButton\">\n+        <item name=\"backgroundTint\">@color/button_bg_selector</item>\n+    </style>\n+\n     <style name=\"ProgressBarLight\">\n         <item name=\"android:indeterminateOnly\">false</item>\n         <item name=\"android:progressDrawable\">@drawable/progress_bar_horizontal_light</item>\n", "test_patch": "", "problem_statement": "Text in \"subscription filter\" setting truncated\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\nLatest from develop branch\n\n### Where did you get the app from\n\nOther\n\n### Android version\n\nAPI 33\n\n### Device model\n\nPixel 4 emulator\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Open the \"subscription filter\" setting\n\n### Expected behaviour\n\nI can read the text inside the buttons.\n\n### Current behaviour\n\nI can't:\r\n\r\n\r\n![grafik](https://user-images.githubusercontent.com/22525368/234248748-a908c76b-3a1a-4816-b2f7-5aac1008ad84.png)\r\n\r\n\r\nThe \"counter greater 0\" button could be made wider. For the other buttons the text padding could be reduced. Especially the last setting unintelligible.\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2023-05-07T09:09:37Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6472, "instance_id": "AntennaPod__AntennaPod-6472", "issue_numbers": ["6440"], "base_commit": "ca0be76fdc18b308ee755ba0bd4aa4120cb09613", "patch": "diff --git a/app/src/main/res/xml/provider_paths.xml b/app/src/main/res/xml/provider_paths.xml\nindex 0e047cf5f0..404e9d4931 100644\n--- a/app/src/main/res/xml/provider_paths.xml\n+++ b/app/src/main/res/xml/provider_paths.xml\n@@ -3,4 +3,5 @@\n     <external-path name=\"external_storage\" path=\".\" />\n     <external-files-path name=\"external_file_storage\" path=\".\" />\n     <files-path name=\"name\" path=\".\" />\n+    <root-path name=\"root\" path=\".\" />\n </paths>\n", "test_patch": "", "problem_statement": "Exporting detailed logs not possible, wrong error message\n### Checklist\r\n\r\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n### App version\r\n\r\n3.0.1 Beta\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Android version\r\n\r\n10\r\n\r\n### Device model\r\n\r\nGalaxy S9\r\n\r\n### First occurred\r\n\r\nSeveral months ago\r\n\r\n### Steps to reproduce\r\n\r\n1. Go to Settings -> Report Bug\r\n2. Click on 'Export detailed logs' (3-dot menu)\r\n\r\n\r\n### Expected behaviour\r\n\r\nText file `full-logs.txt` should be shared to all apps that can handle `text/*`\r\n\r\n### Current behaviour\r\n\r\nToast message appears: 'no compatible apps found'\r\n\r\nAppeared suddenly, I don't know when specifically so I can't say what caused it.\r\n\r\nAfter deleting all app data and re-importing an exported database dump, sharing the detailed logs worked again. This shows that the error message is too unspecific, since I have compatible apps installed and the error has a different cause.\r\n\r\nThis issue wasn't introduced with the v3 beta, I already had it prior to it.\r\n\r\nFrom the logs (below), the exception comes from the `getUriForFile` call here: https://github.com/AntennaPod/AntennaPod/blob/ca0be76fdc18b308ee755ba0bd4aa4120cb09613/app/src/main/java/de/danoeh/antennapod/activity/BugReportActivity.java#L104\r\n\r\n### Logs\r\n\r\nInterestingly, after deleting all data and re-importing the database, the export-logs-function also contained entries from before the data deletion. Here is an interesting excerpt of the full logs, containing an exception thrown when trying to export the full logs:\r\n```\r\n04-17 16:08:28.420 22187 22187 W System.err: java.lang.IllegalArgumentException: Failed to find configured root that contains /storage/8B59-13F9/Android/data/de.danoeh.antennapod/files/full-logs.txt\r\n04-17 16:08:28.420 22187 22187 W System.err: \tat androidx.core.content.FileProvider$SimplePathStrategy.getUriForFile(SourceFile:800)\r\n04-17 16:08:28.420 22187 22187 W System.err: \tat androidx.core.content.FileProvider.getUriForFile(SourceFile:442)\r\n04-17 16:08:28.420 22187 22187 W System.err: \tat de.danoeh.antennapod.activity.BugReportActivity.exportLog(SourceFile:104)\r\n04-17 16:08:28.420 22187 22187 W System.err: \tat de.danoeh.antennapod.activity.BugReportActivity.lambda$onOptionsItemSelected$2(SourceFile:86)\r\n04-17 16:08:28.420 22187 22187 W System.err: \tat de.danoeh.antennapod.activity.BugReportActivity.lambda$onOptionsItemSelected$2$BugReportActivity(Unknown Source:0)\r\n04-17 16:08:28.420 22187 22187 W System.err: \tat de.danoeh.antennapod.activity.-$$Lambda$BugReportActivity$bB0J0FXSM_kbTZHgMSLJvO6Ltlc.onClick(Unknown Source:2)\r\n04-17 16:08:28.420 22187 22187 W System.err: \tat androidx.appcompat.app.AlertController$ButtonHandler.handleMessage(SourceFile:167)\r\n04-17 16:08:28.420 22187 22187 W System.err: \tat android.os.Handler.dispatchMessage(Handler.java:107)\r\n04-17 16:08:28.420 22187 22187 W System.err: \tat android.os.Looper.loop(Looper.java:237)\r\n04-17 16:08:28.420 22187 22187 W System.err: \tat android.app.ActivityThread.main(ActivityThread.java:8167)\r\n04-17 16:08:28.420 22187 22187 W System.err: \tat java.lang.reflect.Method.invoke(Native Method)\r\n04-17 16:08:28.420 22187 22187 W System.err: \tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:496)\r\n04-17 16:08:28.420 22187 22187 W System.err: \tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1100)\r\n```\n", "hints_text": "This is a known issue in the Android libraries, but Google doesn't care fixing it: https://issuetracker.google.com/issues/37125252\r\n\r\nThe library only looks at one of the external storage devices. If the exported log file doesn't happen to be stored on the first device, sharing it doesn't work.\nThat's really annoying...\r\n\r\nA workaround, if anyone else has this issue:\r\n1. Go to `Settings` > `Storage` > `Choose Data Folder`\r\n2. Select a data folder not currently selected (2 options for me, internal or SD card)\r\n4. Now exporting detailed logs works as expected (if you have more than 2, maybe test some more options)\r\n5. After exporting, change back the data folder to the one previously used\r\n\r\nWhen I select the SD card, I get this exception and when I select the internal storage, exporting logs works as expected\r\n\r\nThis workaround won't fit into a toast message, but maybe this exception should be catched separately to display a more precise error message. Otherwise, users might think that they just don't have the right app installed and will try installing various text editor apps.", "created_at": "2023-05-05T15:12:37Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6447, "instance_id": "AntennaPod__AntennaPod-6447", "issue_numbers": ["6439"], "base_commit": "4cdc5d14d9347cdb3be10553c9c545a045df1cec", "patch": "diff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\nindex 74fa6ecc45..35064b6051 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n@@ -1007,8 +1007,8 @@ public final Cursor getPausedQueueCursor(int limit) {\n                 + \" INNER JOIN \" + TABLE_NAME_FEED_ITEMS\n                 + \" ON \" + SELECT_KEY_ITEM_ID + \" = \" + TABLE_NAME_QUEUE + \".\" + KEY_FEEDITEM\n                 +  JOIN_FEED_ITEM_AND_MEDIA\n-                + \" ORDER BY IIF(\" + hasPositionOrRecentlyPlayed\n-                    + \", \" + TABLE_NAME_FEED_MEDIA + \".\" + KEY_LAST_PLAYED_TIME + \", 0) DESC , \"\n+                + \" ORDER BY (CASE WHEN \" + hasPositionOrRecentlyPlayed + \" THEN \"\n+                    + TABLE_NAME_FEED_MEDIA + \".\" + KEY_LAST_PLAYED_TIME + \" ELSE 0 END) DESC , \"\n                 + TABLE_NAME_QUEUE + \".\" + KEY_ID\n                 + \" LIMIT \" + limit;\n         return db.rawQuery(query, null);\n", "test_patch": "", "problem_statement": "Queue entries not loading on home screen in 3.0.1 beta\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.0.1 Beta\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n10\n\n### Device model\n\nGalaxy S9\n\n### First occurred\n\ntoday (17.4.23)\n\n### Steps to reproduce\n\n1. Put something into the queue\r\n2. Go to the home section\n\n### Expected behaviour\n\nLast played entries should show up under 'Continue listening'\n\n### Current behaviour\n\nNothing is shown under 'Continue listening'\r\n\r\n![Screenshot_AntennaPod](https://user-images.githubusercontent.com/11487762/232516264-ca53fe15-036f-4eb1-a374-a64f9a6b9dbf.png)\n\n### Logs\n\nExcerpt from detailed logs, the only exceptions thrown that could be connected to this:\r\n```\r\n04-17 16:14:36.922 24719 24719 E QueueSection: android.database.sqlite.SQLiteException: no such function: IIF (code 1 SQLITE_ERROR[1]): , while compiling: SELECT FeedItems.id AS item_id, FeedItems.title, FeedItems.pubDate, FeedItems.read, FeedItems.link, FeedItems.payment_link, FeedItems.media, FeedItems.feed, FeedItems.has_simple_chapters, FeedItems.item_identifier, FeedItems.image_url, FeedItems.auto_download, FeedItems.podcastindex_chapter_url, FeedMedia.id AS media_id, FeedMedia.duration, FeedMedia.file_url, FeedMedia.download_url, FeedMedia.downloaded, FeedMedia.position, FeedMedia.filesize, FeedMedia.mime_type, FeedMedia.playback_completion_date, FeedMedia.feeditem, FeedMedia.played_duration, FeedMedia.has_embedded_picture, FeedMedia.last_played_time FROM Queue INNER JOIN FeedItems ON item_id = Queue.feeditem LEFT JOIN FeedMedia ON FeedItems.id=FeedMedia.feeditem  ORDER BY IIF(FeedMedia.position >= 1000 OR FeedMedia.last_played_time >= 1681740846888, FeedMedia.last_played_time, 0) DESC , Queue.id LIMIT 8\r\n04-17 16:14:36.922 24719 24719 E QueueSection: \tat android.database.sqlite.SQLiteConnection.nativePrepareStatement(Native Method)\r\n04-17 16:14:36.922 24719 24719 E QueueSection: \tat android.database.sqlite.SQLiteConnection.acquirePreparedStatement(SQLiteConnection.java:1372)\r\n04-17 16:14:36.922 24719 24719 E QueueSection: \tat android.database.sqlite.SQLiteConnection.prepare(SQLiteConnection.java:811)\r\n04-17 16:14:36.922 24719 24719 E QueueSection: \tat android.database.sqlite.SQLiteSession.prepare(SQLiteSession.java:590)\r\n04-17 16:14:36.922 24719 24719 E QueueSection: \tat android.database.sqlite.SQLiteProgram.<init>(SQLiteProgram.java:62)\r\n04-17 16:14:36.922 24719 24719 E QueueSection: \tat android.database.sqlite.SQLiteQuery.<init>(SQLiteQuery.java:37)\r\n04-17 16:14:36.922 24719 24719 E QueueSection: \tat android.database.sqlite.SQLiteDirectCursorDriver.query(SQLiteDirectCursorDriver.java:46)\r\n04-17 16:14:36.922 24719 24719 E QueueSection: \tat android.database.sqlite.SQLiteDatabase.rawQueryWithFactory(SQLiteDatabase.java:1967)\r\n04-17 16:14:36.922 24719 24719 E QueueSection: \tat android.database.sqlite.SQLiteDatabase.rawQuery(SQLiteDatabase.java:1906)\r\n04-17 16:14:36.922 24719 24719 E QueueSection: \tat de.danoeh.antennapod.storage.database.PodDBAdapter.getPausedQueueCursor(SourceFile:1014)\r\n04-17 16:14:36.922 24719 24719 E QueueSection: \tat de.danoeh.antennapod.core.storage.DBReader.getPausedQueue(SourceFile:613)\r\n04-17 16:14:36.922 24719 24719 E QueueSection: \tat de.danoeh.antennapod.ui.home.sections.QueueSection.lambda$loadItems$0(SourceFile:157)\r\n04-17 16:14:36.922 24719 24719 E QueueSection: \tat de.danoeh.antennapod.ui.home.sections.-$$Lambda$QueueSection$T5F9vSiyxzZHE30rdx2l0GPY144.call(Unknown Source:0)\r\n04-17 16:14:36.922 24719 24719 E QueueSection: \tat io.reactivex.internal.operators.observable.ObservableFromCallable.subscribeActual(SourceFile:43)\r\n04-17 16:14:36.922 24719 24719 E QueueSection: \tat io.reactivex.Observable.subscribe(SourceFile:12246)\r\n04-17 16:14:36.922 24719 24719 E QueueSection: \tat io.reactivex.internal.operators.observable.ObservableSubscribeOn$SubscribeTask.run(SourceFile:96)\r\n04-17 16:14:36.922 24719 24719 E QueueSection: \tat io.reactivex.Scheduler$DisposeTask.run(SourceFile:578)\r\n04-17 16:14:36.922 24719 24719 E QueueSection: \tat io.reactivex.internal.schedulers.ScheduledRunnable.run(SourceFile:66)\r\n04-17 16:14:36.922 24719 24719 E QueueSection: \tat io.reactivex.internal.schedulers.ScheduledRunnable.call(SourceFile:57)\r\n04-17 16:14:36.922 24719 24719 E QueueSection: \tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n04-17 16:14:36.922 24719 24719 E QueueSection: \tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:301)\r\n04-17 16:14:36.922 24719 24719 E QueueSection: \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167)\r\n04-17 16:14:36.922 24719 24719 E QueueSection: \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:641)\r\n04-17 16:14:36.922 24719 24719 E QueueSection: \tat java.lang.Thread.run(Thread.java:919)\r\n```\n", "hints_text": "", "created_at": "2023-04-20T17:10:33Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6435, "instance_id": "AntennaPod__AntennaPod-6435", "issue_numbers": ["6388"], "base_commit": "a08f387c56aabe24250f0f932c7839e0677582a5", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/home/sections/SubscriptionsSection.java b/app/src/main/java/de/danoeh/antennapod/ui/home/sections/SubscriptionsSection.java\nindex b9a1bf8e86..9d56198456 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/home/sections/SubscriptionsSection.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/home/sections/SubscriptionsSection.java\n@@ -1,5 +1,7 @@\n package de.danoeh.antennapod.ui.home.sections;\n \n+import android.content.Context;\n+import android.content.SharedPreferences;\n import android.os.Bundle;\n import android.util.Log;\n import android.view.LayoutInflater;\n@@ -17,6 +19,7 @@\n import de.danoeh.antennapod.fragment.SubscriptionFragment;\n import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.ui.home.HomeSection;\n+import de.danoeh.antennapod.ui.statistics.StatisticsFragment;\n import io.reactivex.Observable;\n import io.reactivex.android.schedulers.AndroidSchedulers;\n import io.reactivex.disposables.Disposable;\n@@ -79,7 +82,10 @@ private void loadItems() {\n         if (disposable != null) {\n             disposable.dispose();\n         }\n-        disposable = Observable.fromCallable(() -> DBReader.getStatistics(true, 0, Long.MAX_VALUE).feedTime)\n+        SharedPreferences prefs = getContext().getSharedPreferences(StatisticsFragment.PREF_NAME, Context.MODE_PRIVATE);\n+        boolean includeMarkedAsPlayed = prefs.getBoolean(StatisticsFragment.PREF_INCLUDE_MARKED_PLAYED, false);\n+        disposable = Observable.fromCallable(() ->\n+                        DBReader.getStatistics(includeMarkedAsPlayed, 0, Long.MAX_VALUE).feedTime)\n                 .subscribeOn(Schedulers.io())\n                 .observeOn(AndroidSchedulers.mainThread())\n                 .subscribe(statisticsData -> {\n", "test_patch": "", "problem_statement": "'Classics' on home screen don't always match most listened subscriptions\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.0.0 (870fe2be5)\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\nPixel 3a\n\n### First occurred\n\nEver since the Home screen was introduced\n\n### Steps to reproduce\n\n1. Check the 'classics' displayed on the Home screen\r\n2. Compare with the most listened subscriptions on the Statistics screen\r\n3. Notice that the order and selection of subscriptions differs\n\n### Expected behaviour\n\n_No response_\n\n### Current behaviour\n\n_No response_\n\n### Logs\n\n_No response_\n", "hints_text": "This issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/call-for-ideas-showcasing-features-and-workflows-via-the-blog/2853/6\n\nDo you have a filter on the subscriptions screen? Or enabled the setting \"count marked as played\"? The home screen does not use the filter and never counts the ones marked as played.\nNo, I have neither a filter nor that setting enabled. I have \"smart mark as played\" on, but I think that's by default.\nOops, it's the other way around. The home screen includes episodes just marked as played.\nWould it be possible/feasible to follow the setting the user picks in the stats screen? I reckon that'd lead to the most expected behaviour.\n@ByteHamster Why did you remove the 'possible bug' label? From a functional perspective I would call it a bug. (But maybe the code is working as expected, so you'd rather call it an Enhancement?)\nThe code does what it is supposed to do. For me, it's only a bug if something does not do what it was designed to do. So yeah, for me this would rather be an enhancement.\n> Would it be possible/feasible to follow the setting the user picks in the stats screen? I reckon that'd lead to the most expected behaviour.\r\n\r\nI said this before, but I'm actually not sure any-more. I think it should be all-time; time filters applied in the settings screen should not be considered. However, I would expect the Home screen to follow the 'include marked as played' setting.\r\n\r\nThe 'all-time' (regardless stats) is already the case if I understand correctly. So that would only leave the enhancement to follow the 'include mark as played' as enhancement. Am I right @ByteHamster? (If confirmed we should update the issue title.)\n@keunes that's already how I had interpreted your comment (and what I was aiming at in my issue report). I don't think time-based filters matter here.", "created_at": "2023-04-15T09:38:14Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6434, "instance_id": "AntennaPod__AntennaPod-6434", "issue_numbers": ["5420"], "base_commit": "84e1ff248f6e6c437dd5ecaf8217a7ee6b5c1af5", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/activity/PreferenceActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/PreferenceActivity.java\nindex af8db0d796..b101c20c0b 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/PreferenceActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/PreferenceActivity.java\n@@ -23,10 +23,9 @@\n import de.danoeh.antennapod.fragment.preferences.AutoDownloadPreferencesFragment;\n import de.danoeh.antennapod.fragment.preferences.ImportExportPreferencesFragment;\n import de.danoeh.antennapod.fragment.preferences.MainPreferencesFragment;\n-import de.danoeh.antennapod.fragment.preferences.NetworkPreferencesFragment;\n+import de.danoeh.antennapod.fragment.preferences.DownloadsPreferencesFragment;\n import de.danoeh.antennapod.fragment.preferences.NotificationPreferencesFragment;\n import de.danoeh.antennapod.fragment.preferences.PlaybackPreferencesFragment;\n-import de.danoeh.antennapod.fragment.preferences.StoragePreferencesFragment;\n import de.danoeh.antennapod.fragment.preferences.synchronization.SynchronizationPreferencesFragment;\n import de.danoeh.antennapod.fragment.preferences.SwipePreferencesFragment;\n import de.danoeh.antennapod.fragment.preferences.UserInterfacePreferencesFragment;\n@@ -69,10 +68,8 @@ private PreferenceFragmentCompat getPreferenceScreen(int screen) {\n \n         if (screen == R.xml.preferences_user_interface) {\n             prefFragment = new UserInterfacePreferencesFragment();\n-        } else if (screen == R.xml.preferences_network) {\n-            prefFragment = new NetworkPreferencesFragment();\n-        } else if (screen == R.xml.preferences_storage) {\n-            prefFragment = new StoragePreferencesFragment();\n+        } else if (screen == R.xml.preferences_downloads) {\n+            prefFragment = new DownloadsPreferencesFragment();\n         } else if (screen == R.xml.preferences_import_export) {\n             prefFragment = new ImportExportPreferencesFragment();\n         } else if (screen == R.xml.preferences_autodownload) {\n@@ -90,14 +87,12 @@ private PreferenceFragmentCompat getPreferenceScreen(int screen) {\n     }\n \n     public static int getTitleOfPage(int preferences) {\n-        if (preferences == R.xml.preferences_network) {\n-            return R.string.network_pref;\n+        if (preferences == R.xml.preferences_downloads) {\n+            return R.string.downloads_pref;\n         } else if (preferences == R.xml.preferences_autodownload) {\n             return R.string.pref_automatic_download_title;\n         } else if (preferences == R.xml.preferences_playback) {\n             return R.string.playback_pref;\n-        } else if (preferences == R.xml.preferences_storage) {\n-            return R.string.storage_pref;\n         } else if (preferences == R.xml.preferences_import_export) {\n             return R.string.import_export_pref;\n         } else if (preferences == R.xml.preferences_user_interface) {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/NetworkPreferencesFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/DownloadsPreferencesFragment.java\nsimilarity index 76%\nrename from app/src/main/java/de/danoeh/antennapod/fragment/preferences/NetworkPreferencesFragment.java\nrename to app/src/main/java/de/danoeh/antennapod/fragment/preferences/DownloadsPreferencesFragment.java\nindex 94c85abfe0..c486089fc4 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/NetworkPreferencesFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/DownloadsPreferencesFragment.java\n@@ -8,25 +8,29 @@\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.PreferenceActivity;\n import de.danoeh.antennapod.core.util.download.FeedUpdateManager;\n+import de.danoeh.antennapod.dialog.ChooseDataFolderDialog;\n import de.danoeh.antennapod.dialog.ProxyDialog;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n \n+import java.io.File;\n \n-public class NetworkPreferencesFragment extends PreferenceFragmentCompat\n+\n+public class DownloadsPreferencesFragment extends PreferenceFragmentCompat\n         implements SharedPreferences.OnSharedPreferenceChangeListener {\n     private static final String PREF_SCREEN_AUTODL = \"prefAutoDownloadSettings\";\n     private static final String PREF_PROXY = \"prefProxy\";\n+    private static final String PREF_CHOOSE_DATA_DIR = \"prefChooseDataDir\";\n \n     @Override\n     public void onCreatePreferences(Bundle savedInstanceState, String rootKey) {\n-        addPreferencesFromResource(R.xml.preferences_network);\n+        addPreferencesFromResource(R.xml.preferences_downloads);\n         setupNetworkScreen();\n     }\n \n     @Override\n     public void onStart() {\n         super.onStart();\n-        ((PreferenceActivity) getActivity()).getSupportActionBar().setTitle(R.string.network_pref);\n+        ((PreferenceActivity) getActivity()).getSupportActionBar().setTitle(R.string.downloads_pref);\n         PreferenceManager.getDefaultSharedPreferences(getContext()).registerOnSharedPreferenceChangeListener(this);\n     }\n \n@@ -40,6 +44,7 @@ public void onStop() {\n     public void onResume() {\n         super.onResume();\n         setParallelDownloadsText(UserPreferences.getParallelDownloads());\n+        setDataFolderText();\n     }\n \n     private void setupNetworkScreen() {\n@@ -59,6 +64,13 @@ private void setupNetworkScreen() {\n             dialog.show();\n             return true;\n         });\n+        findPreference(PREF_CHOOSE_DATA_DIR).setOnPreferenceClickListener(preference -> {\n+            ChooseDataFolderDialog.showDialog(getContext(), path -> {\n+                UserPreferences.setDataFolder(path);\n+                setDataFolderText();\n+            });\n+            return true;\n+        });\n     }\n \n     private void setParallelDownloadsText(int downloads) {\n@@ -67,6 +79,13 @@ private void setParallelDownloadsText(int downloads) {\n         findPreference(UserPreferences.PREF_PARALLEL_DOWNLOADS).setSummary(s);\n     }\n \n+    private void setDataFolderText() {\n+        File f = UserPreferences.getDataFolder(null);\n+        if (f != null) {\n+            findPreference(PREF_CHOOSE_DATA_DIR).setSummary(f.getAbsolutePath());\n+        }\n+    }\n+\n     @Override\n     public void onSharedPreferenceChanged(SharedPreferences sharedPreferences, String key) {\n         if (UserPreferences.PREF_UPDATE_INTERVAL.equals(key)) {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/MainPreferencesFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/MainPreferencesFragment.java\nindex 7f5205db46..4d73132473 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/MainPreferencesFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/MainPreferencesFragment.java\n@@ -29,9 +29,9 @@ public class MainPreferencesFragment extends PreferenceFragmentCompat {\n \n     private static final String PREF_SCREEN_USER_INTERFACE = \"prefScreenInterface\";\n     private static final String PREF_SCREEN_PLAYBACK = \"prefScreenPlayback\";\n-    private static final String PREF_SCREEN_NETWORK = \"prefScreenNetwork\";\n+    private static final String PREF_SCREEN_DOWNLOADS = \"prefScreenDownloads\";\n+    private static final String PREF_SCREEN_IMPORT_EXPORT = \"prefScreenImportExport\";\n     private static final String PREF_SCREEN_SYNCHRONIZATION = \"prefScreenSynchronization\";\n-    private static final String PREF_SCREEN_STORAGE = \"prefScreenStorage\";\n     private static final String PREF_DOCUMENTATION = \"prefDocumentation\";\n     private static final String PREF_VIEW_FORUM = \"prefViewForum\";\n     private static final String PREF_SEND_BUG_REPORT = \"prefSendBugReport\";\n@@ -88,16 +88,16 @@ private void setupMainScreen() {\n             ((PreferenceActivity) getActivity()).openScreen(R.xml.preferences_playback);\n             return true;\n         });\n-        findPreference(PREF_SCREEN_NETWORK).setOnPreferenceClickListener(preference -> {\n-            ((PreferenceActivity) getActivity()).openScreen(R.xml.preferences_network);\n+        findPreference(PREF_SCREEN_DOWNLOADS).setOnPreferenceClickListener(preference -> {\n+            ((PreferenceActivity) getActivity()).openScreen(R.xml.preferences_downloads);\n             return true;\n         });\n         findPreference(PREF_SCREEN_SYNCHRONIZATION).setOnPreferenceClickListener(preference -> {\n             ((PreferenceActivity) getActivity()).openScreen(R.xml.preferences_synchronization);\n             return true;\n         });\n-        findPreference(PREF_SCREEN_STORAGE).setOnPreferenceClickListener(preference -> {\n-            ((PreferenceActivity) getActivity()).openScreen(R.xml.preferences_storage);\n+        findPreference(PREF_SCREEN_IMPORT_EXPORT).setOnPreferenceClickListener(preference -> {\n+            ((PreferenceActivity) getActivity()).openScreen(R.xml.preferences_import_export);\n             return true;\n         });\n         findPreference(PREF_NOTIFICATION).setOnPreferenceClickListener(preference -> {\n@@ -155,15 +155,12 @@ private void setupSearch() {\n                 .addBreadcrumb(PreferenceActivity.getTitleOfPage(R.xml.preferences_user_interface));\n         config.index(R.xml.preferences_playback)\n                 .addBreadcrumb(PreferenceActivity.getTitleOfPage(R.xml.preferences_playback));\n-        config.index(R.xml.preferences_network)\n-                .addBreadcrumb(PreferenceActivity.getTitleOfPage(R.xml.preferences_network));\n-        config.index(R.xml.preferences_storage)\n-                .addBreadcrumb(PreferenceActivity.getTitleOfPage(R.xml.preferences_storage));\n+        config.index(R.xml.preferences_downloads)\n+                .addBreadcrumb(PreferenceActivity.getTitleOfPage(R.xml.preferences_downloads));\n         config.index(R.xml.preferences_import_export)\n-                .addBreadcrumb(PreferenceActivity.getTitleOfPage(R.xml.preferences_storage))\n                 .addBreadcrumb(PreferenceActivity.getTitleOfPage(R.xml.preferences_import_export));\n         config.index(R.xml.preferences_autodownload)\n-                .addBreadcrumb(PreferenceActivity.getTitleOfPage(R.xml.preferences_network))\n+                .addBreadcrumb(PreferenceActivity.getTitleOfPage(R.xml.preferences_downloads))\n                 .addBreadcrumb(R.string.automation)\n                 .addBreadcrumb(PreferenceActivity.getTitleOfPage(R.xml.preferences_autodownload));\n         config.index(R.xml.preferences_synchronization)\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/StoragePreferencesFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/StoragePreferencesFragment.java\ndeleted file mode 100644\nindex 1801b107ff..0000000000\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/StoragePreferencesFragment.java\n+++ /dev/null\n@@ -1,58 +0,0 @@\n-package de.danoeh.antennapod.fragment.preferences;\n-\n-import android.os.Bundle;\n-import androidx.preference.PreferenceFragmentCompat;\n-import de.danoeh.antennapod.R;\n-import de.danoeh.antennapod.activity.PreferenceActivity;\n-import de.danoeh.antennapod.storage.preferences.UserPreferences;\n-import de.danoeh.antennapod.dialog.ChooseDataFolderDialog;\n-\n-import java.io.File;\n-\n-public class StoragePreferencesFragment extends PreferenceFragmentCompat {\n-    private static final String PREF_CHOOSE_DATA_DIR = \"prefChooseDataDir\";\n-    private static final String PREF_IMPORT_EXPORT = \"prefImportExport\";\n-\n-    @Override\n-    public void onCreatePreferences(Bundle savedInstanceState, String rootKey) {\n-        addPreferencesFromResource(R.xml.preferences_storage);\n-        setupStorageScreen();\n-    }\n-\n-    @Override\n-    public void onStart() {\n-        super.onStart();\n-        ((PreferenceActivity) getActivity()).getSupportActionBar().setTitle(R.string.storage_pref);\n-    }\n-\n-    @Override\n-    public void onResume() {\n-        super.onResume();\n-        setDataFolderText();\n-    }\n-\n-    private void setupStorageScreen() {\n-        findPreference(PREF_CHOOSE_DATA_DIR).setOnPreferenceClickListener(\n-                preference -> {\n-                    ChooseDataFolderDialog.showDialog(getContext(), path -> {\n-                        UserPreferences.setDataFolder(path);\n-                        setDataFolderText();\n-                    });\n-                    return true;\n-                }\n-        );\n-        findPreference(PREF_IMPORT_EXPORT).setOnPreferenceClickListener(\n-                preference -> {\n-                    ((PreferenceActivity) getActivity()).openScreen(R.xml.preferences_import_export);\n-                    return true;\n-                }\n-        );\n-    }\n-\n-    private void setDataFolderText() {\n-        File f = UserPreferences.getDataFolder(null);\n-        if (f != null) {\n-            findPreference(PREF_CHOOSE_DATA_DIR).setSummary(f.getAbsolutePath());\n-        }\n-    }\n-}\ndiff --git a/app/src/main/res/xml/preferences.xml b/app/src/main/res/xml/preferences.xml\nindex 9967d7fd11..24d50cc45c 100644\n--- a/app/src/main/res/xml/preferences.xml\n+++ b/app/src/main/res/xml/preferences.xml\n@@ -22,10 +22,10 @@\n             android:icon=\"@drawable/ic_play_24dp\" />\n \n     <Preference\n-            android:key=\"prefScreenNetwork\"\n-            android:title=\"@string/network_pref\"\n-            android:summary=\"@string/network_pref_sum\"\n-            android:icon=\"@drawable/ic_network\" />\n+            android:key=\"prefScreenDownloads\"\n+            android:title=\"@string/downloads_pref\"\n+            android:summary=\"@string/downloads_pref_sum\"\n+            android:icon=\"@drawable/ic_download_black\" />\n \n     <Preference\n             android:key=\"prefScreenSynchronization\"\n@@ -34,9 +34,9 @@\n             android:icon=\"@drawable/ic_cloud\" />\n \n     <Preference\n-            android:key=\"prefScreenStorage\"\n-            android:title=\"@string/storage_pref\"\n-            android:summary=\"@string/storage_sum\"\n+            android:key=\"prefScreenImportExport\"\n+            android:title=\"@string/import_export_pref\"\n+            android:summary=\"@string/import_export_summary\"\n             android:icon=\"@drawable/ic_storage\" />\n \n     <Preference\ndiff --git a/app/src/main/res/xml/preferences_downloads.xml b/app/src/main/res/xml/preferences_downloads.xml\nnew file mode 100644\nindex 0000000000..865748d200\n--- /dev/null\n+++ b/app/src/main/res/xml/preferences_downloads.xml\n@@ -0,0 +1,70 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<PreferenceScreen\n+        xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+        xmlns:numberpicker=\"http://schemas.android.com/apk/de.danoeh.antennapod\"\n+        xmlns:search=\"http://schemas.android.com/apk/com.bytehamster.lib.preferencesearch\">\n+\n+    <Preference\n+        android:title=\"@string/choose_data_directory\"\n+        android:key=\"prefChooseDataDir\"/>\n+\n+    <PreferenceCategory android:title=\"@string/automation\">\n+        <de.danoeh.antennapod.preferences.MaterialListPreference\n+            android:entryValues=\"@array/feed_refresh_interval_values\"\n+            android:entries=\"@array/feed_refresh_interval_entries\"\n+            android:key=\"prefAutoUpdateIntervall\"\n+            android:title=\"@string/feed_refresh_title\"\n+            android:summary=\"@string/feed_refresh_sum\"\n+            android:defaultValue=\"12\"/>\n+        <de.danoeh.antennapod.preferences.MaterialListPreference\n+            android:entryValues=\"@array/globalNewEpisodesActionValues\"\n+            android:entries=\"@array/globalNewEpisodesActionItems\"\n+            android:key=\"prefNewEpisodesAction\"\n+            android:title=\"@string/pref_new_episodes_action_title\"\n+            android:summary=\"@string/pref_new_episodes_action_sum\"\n+            android:defaultValue=\"1\"/>\n+        <Preference\n+            android:summary=\"@string/pref_automatic_download_sum\"\n+            android:key=\"prefAutoDownloadSettings\"\n+            android:title=\"@string/pref_automatic_download_title\"\n+            search:ignore=\"true\" />\n+        <SwitchPreferenceCompat\n+            android:defaultValue=\"false\"\n+            android:enabled=\"true\"\n+            android:key=\"prefAutoDelete\"\n+            android:summary=\"@string/pref_auto_delete_sum\"\n+            android:title=\"@string/pref_auto_delete_title\"/>\n+        <SwitchPreferenceCompat\n+            android:defaultValue=\"true\"\n+            android:enabled=\"true\"\n+            android:key=\"prefFavoriteKeepsEpisode\"\n+            android:summary=\"@string/pref_favorite_keeps_episodes_sum\"\n+            android:title=\"@string/pref_favorite_keeps_episodes_title\"/>\n+        <SwitchPreferenceCompat\n+            android:defaultValue=\"false\"\n+            android:enabled=\"true\"\n+            android:key=\"prefDeleteRemovesFromQueue\"\n+            android:summary=\"@string/pref_delete_removes_from_queue_sum\"\n+            android:title=\"@string/pref_delete_removes_from_queue_title\"/>\n+    </PreferenceCategory>\n+\n+    <PreferenceCategory android:title=\"@string/download_pref_details\">\n+        <MultiSelectListPreference\n+                android:defaultValue=\"@array/mobile_update_default_value\"\n+                android:entries=\"@array/mobile_update_entries\"\n+                android:entryValues=\"@array/mobile_update_values\"\n+                android:key=\"prefMobileUpdateTypes\"\n+                android:summary=\"@string/pref_mobileUpdate_sum\"\n+                android:title=\"@string/pref_mobileUpdate_title\"/>\n+        <de.danoeh.antennapod.preferences.NumberPickerPreference\n+                android:defaultValue=\"4\"\n+                numberpicker:minValue=\"1\"\n+                numberpicker:maxValue=\"50\"\n+                android:key=\"prefParallelDownloads\"\n+                android:title=\"@string/pref_parallel_downloads_title\"/>\n+        <Preference\n+                android:key=\"prefProxy\"\n+                android:summary=\"@string/pref_proxy_sum\"\n+                android:title=\"@string/pref_proxy_title\"/>\n+    </PreferenceCategory>\n+</PreferenceScreen>\ndiff --git a/app/src/main/res/xml/preferences_network.xml b/app/src/main/res/xml/preferences_network.xml\ndeleted file mode 100644\nindex f9cd15e685..0000000000\n--- a/app/src/main/res/xml/preferences_network.xml\n+++ /dev/null\n@@ -1,47 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"utf-8\"?>\n-<PreferenceScreen\n-        xmlns:android=\"http://schemas.android.com/apk/res/android\"\n-        xmlns:numberpicker=\"http://schemas.android.com/apk/de.danoeh.antennapod\"\n-        xmlns:search=\"http://schemas.android.com/apk/com.bytehamster.lib.preferencesearch\">\n-    <PreferenceCategory android:title=\"@string/automation\">\n-        <de.danoeh.antennapod.preferences.MaterialListPreference\n-                android:entryValues=\"@array/feed_refresh_interval_values\"\n-                android:entries=\"@array/feed_refresh_interval_entries\"\n-                android:key=\"prefAutoUpdateIntervall\"\n-                android:title=\"@string/feed_refresh_title\"\n-                android:summary=\"@string/feed_refresh_sum\"\n-                android:defaultValue=\"12\"/>\n-        <Preference\n-                android:summary=\"@string/pref_automatic_download_sum\"\n-                android:key=\"prefAutoDownloadSettings\"\n-                android:title=\"@string/pref_automatic_download_title\"\n-                search:ignore=\"true\" />\n-        <de.danoeh.antennapod.preferences.MaterialListPreference\n-                android:entryValues=\"@array/globalNewEpisodesActionValues\"\n-                android:entries=\"@array/globalNewEpisodesActionItems\"\n-                android:key=\"prefNewEpisodesAction\"\n-                android:title=\"@string/pref_new_episodes_action_title\"\n-                android:summary=\"@string/pref_new_episodes_action_sum\"\n-                android:defaultValue=\"1\"/>\n-    </PreferenceCategory>\n-\n-    <PreferenceCategory android:title=\"@string/download_pref_details\">\n-        <MultiSelectListPreference\n-                android:defaultValue=\"@array/mobile_update_default_value\"\n-                android:entries=\"@array/mobile_update_entries\"\n-                android:entryValues=\"@array/mobile_update_values\"\n-                android:key=\"prefMobileUpdateTypes\"\n-                android:summary=\"@string/pref_mobileUpdate_sum\"\n-                android:title=\"@string/pref_mobileUpdate_title\"/>\n-        <de.danoeh.antennapod.preferences.NumberPickerPreference\n-                android:defaultValue=\"4\"\n-                numberpicker:minValue=\"1\"\n-                numberpicker:maxValue=\"50\"\n-                android:key=\"prefParallelDownloads\"\n-                android:title=\"@string/pref_parallel_downloads_title\"/>\n-        <Preference\n-                android:key=\"prefProxy\"\n-                android:summary=\"@string/pref_proxy_sum\"\n-                android:title=\"@string/pref_proxy_title\"/>\n-    </PreferenceCategory>\n-</PreferenceScreen>\ndiff --git a/app/src/main/res/xml/preferences_storage.xml b/app/src/main/res/xml/preferences_storage.xml\ndeleted file mode 100644\nindex 89e8c4cf52..0000000000\n--- a/app/src/main/res/xml/preferences_storage.xml\n+++ /dev/null\n@@ -1,32 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"utf-8\"?>\n-<PreferenceScreen\n-        xmlns:android=\"http://schemas.android.com/apk/res/android\"\n-        xmlns:search=\"http://schemas.android.com/apk/com.bytehamster.lib.preferencesearch\">\n-\n-    <Preference\n-            android:title=\"@string/choose_data_directory\"\n-            android:key=\"prefChooseDataDir\"/>\n-    <SwitchPreferenceCompat\n-            android:defaultValue=\"false\"\n-            android:enabled=\"true\"\n-            android:key=\"prefAutoDelete\"\n-            android:summary=\"@string/pref_auto_delete_sum\"\n-            android:title=\"@string/pref_auto_delete_title\"/>\n-    <SwitchPreferenceCompat\n-            android:defaultValue=\"true\"\n-            android:enabled=\"true\"\n-            android:key=\"prefFavoriteKeepsEpisode\"\n-            android:summary=\"@string/pref_favorite_keeps_episodes_sum\"\n-            android:title=\"@string/pref_favorite_keeps_episodes_title\"/>\n-    <SwitchPreferenceCompat\n-            android:defaultValue=\"false\"\n-            android:enabled=\"true\"\n-            android:key=\"prefDeleteRemovesFromQueue\"\n-            android:summary=\"@string/pref_delete_removes_from_queue_sum\"\n-            android:title=\"@string/pref_delete_removes_from_queue_title\"/>\n-    <Preference\n-            android:title=\"@string/import_export_pref\"\n-            android:summary=\"@string/import_export_summary\"\n-            android:key=\"prefImportExport\"\n-            search:ignore=\"true\"/>\n-</PreferenceScreen>\ndiff --git a/core/src/main/res/drawable/ic_network.xml b/core/src/main/res/drawable/ic_network.xml\ndeleted file mode 100644\nindex 52f5889b84..0000000000\n--- a/core/src/main/res/drawable/ic_network.xml\n+++ /dev/null\n@@ -1,5 +0,0 @@\n-<vector android:height=\"24dp\"\n-    android:viewportHeight=\"24.0\" android:viewportWidth=\"24.0\"\n-    android:width=\"24dp\" xmlns:android=\"http://schemas.android.com/apk/res/android\">\n-    <path android:fillColor=\"?attr/action_icon_color\" android:pathData=\"M16,17.01V10h-2v7.01h-3L15,21l4,-3.99h-3zM9,3L5,6.99h3V14h2V6.99h3L9,3z\"/>\n-</vector>\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 1d11d45577..68bde475ce 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -370,8 +370,6 @@\n     <string name=\"no_subscriptions_label\">To subscribe to a podcast, press the plus icon below.</string>\n \n     <!-- Preferences -->\n-    <string name=\"storage_pref\">Storage</string>\n-    <string name=\"storage_sum\">Episode auto delete, Import, Export</string>\n     <string name=\"project_pref\">Project</string>\n     <string name=\"synchronization_pref\">Synchronization</string>\n     <string name=\"synchronization_sum\">Synchronize with other devices</string>\n@@ -411,8 +409,8 @@\n     <string name=\"pref_favorite_keeps_episodes_title\">Keep Favorite Episodes</string>\n     <string name=\"playback_pref\">Playback</string>\n     <string name=\"playback_pref_sum\">Headphone controls, Skip intervals, Queue</string>\n-    <string name=\"network_pref\">Network</string>\n-    <string name=\"network_pref_sum\">Update interval, Download controls, Mobile data</string>\n+    <string name=\"downloads_pref\">Downloads</string>\n+    <string name=\"downloads_pref_sum\">Update interval, Mobile data, Automatic download, Automatic deletion</string>\n     <string name=\"feed_refresh_title\">Refresh podcasts</string>\n     <string name=\"feed_refresh_sum\">Specify an interval at which AntennaPod looks for new episodes automatically</string>\n     <string name=\"feed_refresh_never\">Never</string>\n", "test_patch": "diff --git a/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java b/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java\nindex be947bc1e1..5940d511be 100644\n--- a/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java\n+++ b/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java\n@@ -193,7 +193,7 @@ public void testContinuousPlayback() {\n \n     @Test\n     public void testAutoDelete() {\n-        clickPreference(R.string.storage_pref);\n+        clickPreference(R.string.downloads_pref);\n         final boolean autoDelete = UserPreferences.isAutoDelete();\n         onView(withText(R.string.pref_auto_delete_title)).perform(click());\n         Awaitility.await().atMost(1000, MILLISECONDS)\n@@ -225,7 +225,7 @@ public void testPauseForInterruptions() {\n \n     @Test\n     public void testSetSequentialDownload() {\n-        clickPreference(R.string.network_pref);\n+        clickPreference(R.string.downloads_pref);\n         clickPreference(R.string.pref_parallel_downloads_title);\n         onView(isRoot()).perform(waitForView(withClassName(endsWith(\"EditText\")), 1000));\n         onView(withClassName(endsWith(\"EditText\"))).perform(replaceText(\"1\"));\n@@ -236,7 +236,7 @@ public void testSetSequentialDownload() {\n \n     @Test\n     public void testSetParallelDownloads() {\n-        clickPreference(R.string.network_pref);\n+        clickPreference(R.string.downloads_pref);\n         clickPreference(R.string.pref_parallel_downloads_title);\n         onView(isRoot()).perform(waitForView(withClassName(endsWith(\"EditText\")), 1000));\n         onView(withClassName(endsWith(\"EditText\"))).perform(replaceText(\"10\"));\n@@ -248,7 +248,7 @@ public void testSetParallelDownloads() {\n \n     @Test\n     public void testSetParallelDownloadsInvalidInput() {\n-        clickPreference(R.string.network_pref);\n+        clickPreference(R.string.downloads_pref);\n         clickPreference(R.string.pref_parallel_downloads_title);\n         onView(isRoot()).perform(waitForView(withClassName(endsWith(\"EditText\")), 1000));\n         onView(withClassName(endsWith(\"EditText\"))).perform(replaceText(\"0\"));\n@@ -263,7 +263,7 @@ public void testSetEpisodeCache() {\n         String[] values = res.getStringArray(R.array.episode_cache_size_values);\n         String entry = entries[entries.length / 2];\n         final int value = Integer.parseInt(values[values.length / 2]);\n-        clickPreference(R.string.network_pref);\n+        clickPreference(R.string.downloads_pref);\n         clickPreference(R.string.pref_automatic_download_title);\n         clickPreference(R.string.pref_episode_cache_title);\n         onView(isRoot()).perform(waitForView(withText(entry), 1000));\n@@ -279,7 +279,7 @@ public void testSetEpisodeCacheMin() {\n         String minEntry = entries[0];\n         final int minValue = Integer.parseInt(values[0]);\n \n-        clickPreference(R.string.network_pref);\n+        clickPreference(R.string.downloads_pref);\n         clickPreference(R.string.pref_automatic_download_title);\n         clickPreference(R.string.pref_episode_cache_title);\n         onView(withId(R.id.select_dialog_listview)).perform(swipeDown());\n@@ -294,7 +294,7 @@ public void testSetEpisodeCacheMax() {\n         String[] values = res.getStringArray(R.array.episode_cache_size_values);\n         String maxEntry = entries[entries.length - 1];\n         final int maxValue = Integer.parseInt(values[values.length - 1]);\n-        onView(withText(R.string.network_pref)).perform(click());\n+        onView(withText(R.string.downloads_pref)).perform(click());\n         onView(withText(R.string.pref_automatic_download_title)).perform(click());\n         onView(withText(R.string.pref_episode_cache_title)).perform(click());\n         onView(withId(R.id.select_dialog_listview)).perform(swipeUp());\n@@ -306,7 +306,7 @@ public void testSetEpisodeCacheMax() {\n     @Test\n     public void testAutomaticDownload() {\n         final boolean automaticDownload = UserPreferences.isEnableAutodownload();\n-        clickPreference(R.string.network_pref);\n+        clickPreference(R.string.downloads_pref);\n         clickPreference(R.string.pref_automatic_download_title);\n         clickPreference(R.string.pref_automatic_download_title);\n         Awaitility.await().atMost(1000, MILLISECONDS)\n@@ -327,7 +327,7 @@ public void testAutomaticDownload() {\n \n     @Test\n     public void testEpisodeCleanupFavoriteOnly() {\n-        clickPreference(R.string.network_pref);\n+        clickPreference(R.string.downloads_pref);\n         onView(withText(R.string.pref_automatic_download_title)).perform(click());\n         onView(withText(R.string.pref_episode_cleanup_title)).perform(click());\n         onView(withId(R.id.select_dialog_listview)).perform(swipeDown());\n@@ -338,7 +338,7 @@ public void testEpisodeCleanupFavoriteOnly() {\n \n     @Test\n     public void testEpisodeCleanupQueueOnly() {\n-        clickPreference(R.string.network_pref);\n+        clickPreference(R.string.downloads_pref);\n         onView(withText(R.string.pref_automatic_download_title)).perform(click());\n         onView(withText(R.string.pref_episode_cleanup_title)).perform(click());\n         onView(withId(R.id.select_dialog_listview)).perform(swipeDown());\n@@ -349,7 +349,7 @@ public void testEpisodeCleanupQueueOnly() {\n \n     @Test\n     public void testEpisodeCleanupNeverAlg() {\n-        clickPreference(R.string.network_pref);\n+        clickPreference(R.string.downloads_pref);\n         onView(withText(R.string.pref_automatic_download_title)).perform(click());\n         onView(withText(R.string.pref_episode_cleanup_title)).perform(click());\n         onView(withId(R.id.select_dialog_listview)).perform(swipeUp());\n@@ -360,7 +360,7 @@ public void testEpisodeCleanupNeverAlg() {\n \n     @Test\n     public void testEpisodeCleanupClassic() {\n-        clickPreference(R.string.network_pref);\n+        clickPreference(R.string.downloads_pref);\n         onView(withText(R.string.pref_automatic_download_title)).perform(click());\n         onView(withText(R.string.pref_episode_cleanup_title)).perform(click());\n         onView(withText(R.string.episode_cleanup_after_listening)).perform(click());\n@@ -377,7 +377,7 @@ public void testEpisodeCleanupClassic() {\n \n     @Test\n     public void testEpisodeCleanupNumDays() {\n-        clickPreference(R.string.network_pref);\n+        clickPreference(R.string.downloads_pref);\n         clickPreference(R.string.pref_automatic_download_title);\n         clickPreference(R.string.pref_episode_cleanup_title);\n         String search = res.getQuantityString(R.plurals.episode_cleanup_days_after_listening, 3, 3);\n@@ -437,7 +437,7 @@ public void testFastForwardChange() {\n \n     @Test\n     public void testDeleteRemovesFromQueue() {\n-        clickPreference(R.string.storage_pref);\n+        clickPreference(R.string.downloads_pref);\n         if (!UserPreferences.shouldDeleteRemoveFromQueue()) {\n             clickPreference(R.string.pref_delete_removes_from_queue_title);\n             Awaitility.await().atMost(1000, MILLISECONDS)\n", "problem_statement": "Move 'Import/Export' to its own setting category: 'Export & back-up'\n# Checklist\r\n<!-- Place an x in the boxes to tick them: [x] -->\r\n\r\n- [x ] I have used the search function to see if someone else has already submitted the same feature request.\r\n- [x ] I will only create one feature request per issue.\r\n- [x ] I will describe the problem with as much detail as possible.\r\n\r\n# System info\r\n\r\n**App version**: 2.3.2\r\n<!-- The latest version may be different depending on your device. You can find the version in AntennaPod's settings. -->\r\n\r\n**App source**: Google Play\r\n<!-- Please delete irrelevant answer or fill in the blank -->\r\n\r\n# Feature description\r\n\r\n**Problem you may be having, or feature you want**: The back-up option is quite hidden in the settings. Also, it is located under 'Storage' which doesn't really align (the other Storage items are more about the space AntennaPod occupies on the device).\r\n<!-- Give a brief explanation about the problem that may currently exist -->\r\n\r\n**Suggested solution**:\r\n* Move the current 'Import/Export' group up on level, so it's directly visible when reviewing the settings.\r\n* Rename to 'Export & back-up'\r\n This is to sign-post that's where back-ups can be made & restored. 'Import' can be dropped as it's partly covered by 'back-up' and OPML import (which might be back-up, might be not, depending on the use-case) is also accessible via the 'Add subscription' screen.\r\n* Use the [`backup-restore`](https://materialdesignicons.com/icon/backup-restore) icon for the new category.\r\n<!-- Describe how your requested feature solves this problem. Try to be as specific as possible. Please not only explain what the feature does, but also how. -->\r\n\r\n**Screenshots / Drawings / Technical details**:\r\n<!-- If your request is about (or includes) changing or extending the UI, describe what the UI would look like and how the user would interact with it. -->\r\n\n", "hints_text": "The number of top-level settings entries are getting a bit much for my taste lately (documentation, contribute, etc). If we display too many items on the main settings page, it is harder to actually find important items.\r\n\r\nI was also thinking about moving the \"automation\" related settings (auto delete, auto update, auto download) to a new top-level settings screen. When that is done, the \"network\" and \"storage\" screens will be mostly empty and should probably be re-organized. Maybe together with the import/export item?\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/settings-restructuring/2079/1\n\nHi @ByteHamster,\r\n\r\nWhile I agree that there are a lot of top-level setting entries, I think (after/with the removal of the Statistics) we have enough space to have an 'Export & back-up' setting.\r\n\r\nAn already happy user in [a review](https://play.google.com/console/u/0/developers/8008695526664634386/app/4974638472012894302/user-feedback/review-details?reviewId=41136731-7fe5-4b02-979d-02ec148f0021&corpus=PUBLIC_REVIEWS) suggested the following:\r\n> import/export should be a top-level settings category or merged with \"Synchronization\"\r\n\r\nSo I think it'd be good to implement this (ahead of any further restructuring under discussion in the forum). OK to remove the 'needs decision' label?\nHmm, not really happy but OK", "created_at": "2023-04-15T09:32:48Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6432, "instance_id": "AntennaPod__AntennaPod-6432", "issue_numbers": ["6421"], "base_commit": "a08f387c56aabe24250f0f932c7839e0677582a5", "patch": "diff --git a/core/src/main/res/values/styles.xml b/core/src/main/res/values/styles.xml\nindex 1cdb1c0c29..6ebef0bb21 100644\n--- a/core/src/main/res/values/styles.xml\n+++ b/core/src/main/res/values/styles.xml\n@@ -31,6 +31,7 @@\n \n     <style name=\"Theme.AntennaPod.Light\" parent=\"Theme.AntennaPod.Dynamic.Light\">\n         <item name=\"colorPrimary\">@color/accent_light</item>\n+        <item name=\"colorOnPrimary\">@color/white</item>\n         <item name=\"colorAccent\">@color/accent_light</item>\n         <item name=\"colorSecondary\">@color/accent_light</item>\n         <item name=\"colorOnSecondary\">@color/white</item>\n@@ -71,6 +72,7 @@\n \n     <style name=\"Theme.AntennaPod.Dark\" parent=\"Theme.AntennaPod.Dynamic.Dark\">\n         <item name=\"colorPrimary\">@color/accent_dark</item>\n+        <item name=\"colorOnPrimary\">@color/black</item>\n         <item name=\"colorAccent\">@color/accent_dark</item>\n         <item name=\"colorSecondary\">@color/accent_dark</item>\n         <item name=\"colorOnSecondary\">@color/black</item>\n", "test_patch": "", "problem_statement": "Add 'on primary' and 'on secondary'\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.0.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Problem you may be having, or feature you want\n\nThe buttons on the home screen in dark theme don't have much contrast.\n\n### Suggested solution\n\nMake sure the 'on primary' colour is defined.\n\n### Screenshots / Drawings / Technical details\n\nhttps://github.com/AntennaPod/AntennaPod/blob/2b22d4b6977f9a22abfd4bc2d269c79834551ee2/core/src/main/res/values/styles.xml\r\n\r\nCreate branch from master & target PR to master.\n", "hints_text": "", "created_at": "2023-04-15T09:14:19Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6420, "instance_id": "AntennaPod__AntennaPod-6420", "issue_numbers": ["1250", "3673"], "base_commit": "4c286931cd2dbd9038022f808f9d8a73ccbb6759", "patch": "diff --git a/app/src/main/AndroidManifest.xml b/app/src/main/AndroidManifest.xml\nindex 8c779db268..95b0c16148 100644\n--- a/app/src/main/AndroidManifest.xml\n+++ b/app/src/main/AndroidManifest.xml\n@@ -129,17 +129,6 @@\n             </intent-filter>\n         </activity>\n \n-        <activity\n-            android:name=\".activity.DownloadAuthenticationActivity\"\n-            android:theme=\"@style/Theme.AntennaPod.Dark.Translucent\"\n-            android:exported=\"false\"\n-            android:launchMode=\"singleInstance\">\n-            <intent-filter>\n-                <action android:name=\"de.danoeh.antennapod.intents.DOWNLOAD_AUTH_ACTIVITY\" />\n-                <category android:name=\"android.intent.category.DEFAULT\" />\n-            </intent-filter>\n-        </activity>\n-\n         <activity\n             android:name=\".activity.PreferenceActivity\"\n             android:configChanges=\"keyboardHidden|orientation|screenSize\"\ndiff --git a/app/src/main/java/de/danoeh/antennapod/activity/DownloadAuthenticationActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/DownloadAuthenticationActivity.java\ndeleted file mode 100644\nindex 176c3c9906..0000000000\n--- a/app/src/main/java/de/danoeh/antennapod/activity/DownloadAuthenticationActivity.java\n+++ /dev/null\n@@ -1,71 +0,0 @@\n-package de.danoeh.antennapod.activity;\n-\n-import android.os.Bundle;\n-import android.text.TextUtils;\n-import androidx.appcompat.app.AppCompatActivity;\n-import de.danoeh.antennapod.R;\n-import de.danoeh.antennapod.core.preferences.ThemeSwitcher;\n-import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n-import de.danoeh.antennapod.model.feed.FeedMedia;\n-import de.danoeh.antennapod.model.feed.FeedPreferences;\n-import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n-import de.danoeh.antennapod.core.storage.DBReader;\n-import de.danoeh.antennapod.core.storage.DBWriter;\n-import de.danoeh.antennapod.dialog.AuthenticationDialog;\n-import de.danoeh.antennapod.ui.appstartintent.DownloadAuthenticationActivityStarter;\n-import io.reactivex.Completable;\n-import io.reactivex.android.schedulers.AndroidSchedulers;\n-import io.reactivex.schedulers.Schedulers;\n-\n-\n-/**\n- * Shows a username and a password text field.\n- * The activity MUST be started with the ARG_DOWNlOAD_REQUEST argument set to a non-null value.\n- */\n-public class DownloadAuthenticationActivity extends AppCompatActivity {\n-    @Override\n-    protected void onCreate(Bundle savedInstanceState) {\n-        setTheme(ThemeSwitcher.getTranslucentTheme(this));\n-        super.onCreate(savedInstanceState);\n-\n-        DownloadRequest request = getIntent().getParcelableExtra(\n-                DownloadAuthenticationActivityStarter.EXTRA_DOWNLOAD_REQUEST);\n-\n-        new AuthenticationDialog(this, R.string.authentication_label, true, \"\", \"\") {\n-            @Override\n-            protected void onConfirmed(String username, String password) {\n-                Completable.fromAction(\n-                        () -> {\n-                            request.setUsername(username);\n-                            request.setPassword(password);\n-\n-                            if (request.getFeedfileType() == FeedMedia.FEEDFILETYPE_FEEDMEDIA) {\n-                                long mediaId = request.getFeedfileId();\n-                                FeedMedia media = DBReader.getFeedMedia(mediaId);\n-                                if (media != null) {\n-                                    FeedPreferences preferences = media.getItem().getFeed().getPreferences();\n-                                    if (TextUtils.isEmpty(preferences.getPassword())\n-                                            || TextUtils.isEmpty(preferences.getUsername())) {\n-                                        preferences.setUsername(username);\n-                                        preferences.setPassword(password);\n-                                        DBWriter.setFeedPreferences(preferences);\n-                                    }\n-                                }\n-                            }\n-                        })\n-                        .subscribeOn(Schedulers.io())\n-                        .observeOn(AndroidSchedulers.mainThread())\n-                        .subscribe(() -> {\n-                            DownloadServiceInterface.get()\n-                                    .download(DownloadAuthenticationActivity.this, false, request);\n-                            finish();\n-                        });\n-            }\n-\n-            @Override\n-            protected void onCancelled() {\n-                finish();\n-            }\n-        }.show();\n-    }\n-}\ndiff --git a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\nindex bd467076a8..a55bfade31 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n@@ -39,12 +39,14 @@\n import de.danoeh.antennapod.core.receiver.MediaButtonReceiver;\n import de.danoeh.antennapod.core.util.download.FeedUpdateManager;\n import de.danoeh.antennapod.dialog.RatingDialog;\n+import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FeedUpdateRunningEvent;\n import de.danoeh.antennapod.event.MessageEvent;\n import de.danoeh.antennapod.fragment.AddFeedFragment;\n import de.danoeh.antennapod.fragment.AllEpisodesFragment;\n import de.danoeh.antennapod.fragment.AudioPlayerFragment;\n import de.danoeh.antennapod.fragment.CompletedDownloadsFragment;\n+import de.danoeh.antennapod.fragment.DownloadLogFragment;\n import de.danoeh.antennapod.fragment.FeedItemlistFragment;\n import de.danoeh.antennapod.fragment.InboxFragment;\n import de.danoeh.antennapod.fragment.NavDrawerFragment;\n@@ -53,6 +55,8 @@\n import de.danoeh.antennapod.fragment.SearchFragment;\n import de.danoeh.antennapod.fragment.SubscriptionFragment;\n import de.danoeh.antennapod.fragment.TransitionEffect;\n+import de.danoeh.antennapod.model.download.DownloadStatus;\n+import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n import de.danoeh.antennapod.playback.cast.CastEnabledActivity;\n import de.danoeh.antennapod.preferences.PreferenceUpgrader;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n@@ -66,6 +70,9 @@\n import org.greenrobot.eventbus.Subscribe;\n import org.greenrobot.eventbus.ThreadMode;\n \n+import java.util.HashMap;\n+import java.util.Map;\n+\n /**\n  * The activity that is shown when the user launches the app.\n  */\n@@ -173,6 +180,39 @@ public void onCreate(Bundle savedInstanceState) {\n                     }\n                     EventBus.getDefault().postSticky(new FeedUpdateRunningEvent(isRefreshingFeeds));\n                 });\n+        WorkManager.getInstance(this)\n+                .getWorkInfosByTagLiveData(DownloadServiceInterface.WORK_TAG)\n+                .observe(this, workInfos -> {\n+                    Map<String, DownloadStatus> updatedEpisodes = new HashMap<>();\n+                    for (WorkInfo workInfo : workInfos) {\n+                        String downloadUrl = null;\n+                        for (String tag : workInfo.getTags()) {\n+                            if (tag.startsWith(DownloadServiceInterface.WORK_TAG_EPISODE_URL)) {\n+                                downloadUrl = tag.substring(DownloadServiceInterface.WORK_TAG_EPISODE_URL.length());\n+                            }\n+                        }\n+                        if (downloadUrl == null) {\n+                            continue;\n+                        }\n+                        int status;\n+                        if (workInfo.getState() == WorkInfo.State.RUNNING) {\n+                            status = DownloadStatus.STATE_RUNNING;\n+                        } else if (workInfo.getState() == WorkInfo.State.ENQUEUED\n+                                || workInfo.getState() == WorkInfo.State.BLOCKED) {\n+                            status = DownloadStatus.STATE_QUEUED;\n+                        } else {\n+                            status = DownloadStatus.STATE_COMPLETED;\n+                        }\n+                        int progress = workInfo.getProgress().getInt(DownloadServiceInterface.WORK_DATA_PROGRESS, -1);\n+                        if (progress == -1 && status != DownloadStatus.STATE_COMPLETED) {\n+                            status = DownloadStatus.STATE_QUEUED;\n+                            progress = 0;\n+                        }\n+                        updatedEpisodes.put(downloadUrl, new DownloadStatus(status, progress));\n+                    }\n+                    DownloadServiceInterface.get().setCurrentDownloads(updatedEpisodes);\n+                    EventBus.getDefault().postSticky(new EpisodeDownloadEvent(updatedEpisodes));\n+                });\n     }\n \n     @Override\n@@ -531,9 +571,9 @@ public void onBackPressed() {\n     public void onEventMainThread(MessageEvent event) {\n         Log.d(TAG, \"onEvent(\" + event + \")\");\n \n-        Snackbar snackbar = showSnackbarAbovePlayer(event.message, Snackbar.LENGTH_SHORT);\n+        Snackbar snackbar = showSnackbarAbovePlayer(event.message, Snackbar.LENGTH_LONG);\n         if (event.action != null) {\n-            snackbar.setAction(getString(R.string.undo), v -> event.action.run());\n+            snackbar.setAction(event.actionText, v -> event.action.accept(this));\n         }\n     }\n \n@@ -570,6 +610,9 @@ private void handleNavIntent() {\n         if (intent.getBooleanExtra(MainActivityStarter.EXTRA_OPEN_DRAWER, false) && drawerLayout != null) {\n             drawerLayout.open();\n         }\n+        if (intent.getBooleanExtra(MainActivityStarter.EXTRA_OPEN_DOWNLOAD_LOGS, false)) {\n+            new DownloadLogFragment().show(getSupportFragmentManager(), null);\n+        }\n         if (intent.getBooleanExtra(EXTRA_REFRESH_ON_START, false)) {\n             FeedUpdateManager.runOnceOrAsk(this);\n         }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\nindex f5f3d28f6b..3812339bdc 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\n@@ -31,20 +31,20 @@\n \n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.adapter.FeedItemlistDescriptionAdapter;\n-import de.danoeh.antennapod.core.event.DownloadEvent;\n import de.danoeh.antennapod.core.preferences.ThemeSwitcher;\n-import de.danoeh.antennapod.core.service.download.DownloadService;\n import de.danoeh.antennapod.core.service.download.DownloadRequestCreator;\n import de.danoeh.antennapod.core.feed.FeedUrlNotFoundException;\n import de.danoeh.antennapod.core.storage.DBTasks;\n import de.danoeh.antennapod.core.service.playback.PlaybackServiceInterface;\n import de.danoeh.antennapod.core.util.DownloadErrorLabel;\n+import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FeedListUpdateEvent;\n import de.danoeh.antennapod.event.PlayerStatusEvent;\n import de.danoeh.antennapod.core.preferences.PlaybackPreferences;\n+import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n-import de.danoeh.antennapod.model.download.DownloadStatus;\n+import de.danoeh.antennapod.model.download.DownloadResult;\n import de.danoeh.antennapod.core.service.download.Downloader;\n import de.danoeh.antennapod.core.service.download.HttpDownloader;\n import de.danoeh.antennapod.core.storage.DBReader;\n@@ -307,10 +307,7 @@ private void startFeedDownload(String url) {\n                 error -> Log.e(TAG, Log.getStackTraceString(error)));\n     }\n \n-    private void checkDownloadResult(@NonNull DownloadStatus status, String destination) {\n-        if (status.isCancelled()) {\n-            return;\n-        }\n+    private void checkDownloadResult(@NonNull DownloadResult status, String destination) {\n         if (status.isSuccessful()) {\n             parseFeed(destination);\n         } else if (status.getReason() == DownloadError.ERROR_UNAUTHORIZED) {\n@@ -341,9 +338,8 @@ public void onFeedListChanged(FeedListUpdateEvent event) {\n                 );\n     }\n \n-    @Subscribe(threadMode = ThreadMode.MAIN)\n-    public void onEventMainThread(DownloadEvent event) {\n-        Log.d(TAG, \"onEventMainThread() called with: \" + \"event = [\" + event + \"]\");\n+    @Subscribe(sticky = true, threadMode = ThreadMode.MAIN)\n+    public void onEventMainThread(EpisodeDownloadEvent event) {\n         handleUpdatedFeedStatus();\n     }\n \n@@ -535,7 +531,7 @@ private void openFeed() {\n     }\n \n     private void handleUpdatedFeedStatus() {\n-        if (DownloadService.isDownloadingFile(selectedDownloadUrl)) {\n+        if (DownloadServiceInterface.get().isDownloadingEpisode(selectedDownloadUrl)) {\n             viewBinding.subscribeButton.setEnabled(false);\n             viewBinding.subscribeButton.setText(R.string.subscribing_label);\n         } else if (feedInFeedlist()) {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/adapter/DownloadLogAdapter.java b/app/src/main/java/de/danoeh/antennapod/adapter/DownloadLogAdapter.java\nindex 8df3e39683..0fb6a7e7a9 100644\n--- a/app/src/main/java/de/danoeh/antennapod/adapter/DownloadLogAdapter.java\n+++ b/app/src/main/java/de/danoeh/antennapod/adapter/DownloadLogAdapter.java\n@@ -2,7 +2,6 @@\n \n import android.app.Activity;\n import android.text.format.DateUtils;\n-import android.text.format.Formatter;\n import android.util.Log;\n import android.view.View;\n import android.view.ViewGroup;\n@@ -10,18 +9,13 @@\n import android.widget.Toast;\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n-import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n-import de.danoeh.antennapod.core.service.download.DownloadRequestCreator;\n-import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n-import de.danoeh.antennapod.core.service.download.Downloader;\n+import de.danoeh.antennapod.adapter.actionbutton.DownloadActionButton;\n import de.danoeh.antennapod.core.storage.DBReader;\n import de.danoeh.antennapod.core.storage.DBTasks;\n-import de.danoeh.antennapod.core.storage.DBWriter;\n import de.danoeh.antennapod.core.util.DownloadErrorLabel;\n import de.danoeh.antennapod.model.download.DownloadError;\n-import de.danoeh.antennapod.model.download.DownloadStatus;\n+import de.danoeh.antennapod.model.download.DownloadResult;\n import de.danoeh.antennapod.model.feed.Feed;\n-import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedMedia;\n import de.danoeh.antennapod.ui.common.ThemeUtils;\n import de.danoeh.antennapod.view.viewholder.DownloadLogItemViewHolder;\n@@ -36,24 +30,18 @@ public class DownloadLogAdapter extends BaseAdapter {\n     private static final String TAG = \"DownloadLogAdapter\";\n \n     private final Activity context;\n-    private List<DownloadStatus> downloadLog = new ArrayList<>();\n-    private List<Downloader> runningDownloads = new ArrayList<>();\n+    private List<DownloadResult> downloadLog = new ArrayList<>();\n \n     public DownloadLogAdapter(Activity context) {\n         super();\n         this.context = context;\n     }\n \n-    public void setDownloadLog(List<DownloadStatus> downloadLog) {\n+    public void setDownloadLog(List<DownloadResult> downloadLog) {\n         this.downloadLog = downloadLog;\n         notifyDataSetChanged();\n     }\n \n-    public void setRunningDownloads(List<Downloader> runningDownloads) {\n-        this.runningDownloads = runningDownloads;\n-        notifyDataSetChanged();\n-    }\n-\n     @Override\n     public View getView(int position, View convertView, ViewGroup parent) {\n         DownloadLogItemViewHolder holder;\n@@ -63,17 +51,11 @@ public View getView(int position, View convertView, ViewGroup parent) {\n         } else {\n             holder = (DownloadLogItemViewHolder) convertView.getTag();\n         }\n-\n-        Object item = getItem(position);\n-        if (item instanceof DownloadStatus) {\n-            bind(holder, (DownloadStatus) item, position);\n-        } else if (item instanceof Downloader) {\n-            bind(holder, (Downloader) item, position);\n-        }\n+        bind(holder, getItem(position), position);\n         return holder.itemView;\n     }\n \n-    private void bind(DownloadLogItemViewHolder holder, DownloadStatus status, int position) {\n+    private void bind(DownloadLogItemViewHolder holder, DownloadResult status, int position) {\n         String statusText = \"\";\n         if (status.getFeedfileType() == Feed.FEEDFILETYPE_FEED) {\n             statusText += context.getString(R.string.download_type_feed);\n@@ -111,8 +93,7 @@ private void bind(DownloadLogItemViewHolder holder, DownloadStatus status, int p\n             holder.reason.setVisibility(View.VISIBLE);\n             holder.tapForDetails.setVisibility(View.VISIBLE);\n \n-            if (newerWasSuccessful(position - runningDownloads.size(),\n-                    status.getFeedfileType(), status.getFeedfileId())) {\n+            if (newerWasSuccessful(position, status.getFeedfileType(), status.getFeedfileId())) {\n                 holder.secondaryActionButton.setVisibility(View.INVISIBLE);\n                 holder.secondaryActionButton.setOnClickListener(null);\n                 holder.secondaryActionButton.setTag(null);\n@@ -138,8 +119,7 @@ private void bind(DownloadLogItemViewHolder holder, DownloadStatus status, int p\n                             Log.e(TAG, \"Could not find feed media for feed id: \" + status.getFeedfileId());\n                             return;\n                         }\n-                        DownloadServiceInterface.get()\n-                                .download(context, true, DownloadRequestCreator.create(media).build());\n+                        new DownloadActionButton(media.getItem()).onClick(context);\n                         ((MainActivity) context).showSnackbarAbovePlayer(\n                                 R.string.status_downloading_label, Toast.LENGTH_SHORT);\n                     });\n@@ -148,56 +128,9 @@ private void bind(DownloadLogItemViewHolder holder, DownloadStatus status, int p\n         }\n     }\n \n-    private void bind(DownloadLogItemViewHolder holder, Downloader downloader, int position) {\n-        DownloadRequest request = downloader.getDownloadRequest();\n-        holder.title.setText(request.getTitle());\n-        holder.secondaryActionIcon.setImageResource(R.drawable.ic_cancel);\n-        holder.secondaryActionButton.setContentDescription(context.getString(R.string.cancel_download_label));\n-        holder.secondaryActionButton.setVisibility(View.VISIBLE);\n-        holder.secondaryActionButton.setTag(downloader);\n-        holder.secondaryActionButton.setOnClickListener(v -> {\n-            DownloadServiceInterface.get().cancel(context, request.getSource());\n-            if (request.getFeedfileType() == FeedMedia.FEEDFILETYPE_FEEDMEDIA) {\n-                FeedMedia media = DBReader.getFeedMedia(request.getFeedfileId());\n-                FeedItem feedItem = media.getItem();\n-                feedItem.disableAutoDownload();\n-                DBWriter.setFeedItem(feedItem);\n-            }\n-        });\n-        holder.reason.setVisibility(View.GONE);\n-        holder.tapForDetails.setVisibility(View.GONE);\n-        holder.icon.setTextColor(ThemeUtils.getColorFromAttr(context, R.attr.colorPrimary));\n-        holder.icon.setText(\"{fa-arrow-circle-down}\");\n-        holder.icon.setContentDescription(context.getString(R.string.status_downloading_label));\n-\n-        boolean percentageWasSet = false;\n-        String status = \"\";\n-        if (request.getFeedfileType() == Feed.FEEDFILETYPE_FEED) {\n-            status += context.getString(R.string.download_type_feed);\n-        } else if (request.getFeedfileType() == FeedMedia.FEEDFILETYPE_FEEDMEDIA) {\n-            status += context.getString(R.string.download_type_media);\n-        }\n-        status += \" \u00b7 \";\n-        if (request.getSoFar() <= 0) {\n-            status += context.getString(R.string.download_pending);\n-        } else {\n-            status += Formatter.formatShortFileSize(context, request.getSoFar());\n-            if (request.getSize() != DownloadStatus.SIZE_UNKNOWN) {\n-                status += \" / \" + Formatter.formatShortFileSize(context, request.getSize());\n-                holder.secondaryActionProgress.setPercentage(\n-                        0.01f * Math.max(1, request.getProgressPercent()), request);\n-                percentageWasSet = true;\n-            }\n-        }\n-        if (!percentageWasSet) {\n-            holder.secondaryActionProgress.setPercentage(0, request);\n-        }\n-        holder.status.setText(status);\n-    }\n-\n     private boolean newerWasSuccessful(int downloadStatusIndex, int feedTypeId, long id) {\n         for (int i = 0; i < downloadStatusIndex; i++) {\n-            DownloadStatus status = downloadLog.get(i);\n+            DownloadResult status = downloadLog.get(i);\n             if (status.getFeedfileType() == feedTypeId && status.getFeedfileId() == id && status.isSuccessful()) {\n                 return true;\n             }\n@@ -207,15 +140,13 @@ private boolean newerWasSuccessful(int downloadStatusIndex, int feedTypeId, long\n \n     @Override\n     public int getCount() {\n-        return downloadLog.size() + runningDownloads.size();\n+        return downloadLog.size();\n     }\n \n     @Override\n-    public Object getItem(int position) {\n-        if (position < runningDownloads.size()) {\n-            return runningDownloads.get(position);\n-        } else if (position - runningDownloads.size() < downloadLog.size()) {\n-            return downloadLog.get(position - runningDownloads.size());\n+    public DownloadResult getItem(int position) {\n+        if (position < downloadLog.size()) {\n+            return downloadLog.get(position);\n         }\n         return null;\n     }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/DownloadActionButton.java b/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/DownloadActionButton.java\nindex 3b54efc035..86a8047a95 100644\n--- a/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/DownloadActionButton.java\n+++ b/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/DownloadActionButton.java\n@@ -2,20 +2,17 @@\n \n import android.content.Context;\n import android.view.View;\n-import android.widget.Toast;\n \n import androidx.annotation.DrawableRes;\n import androidx.annotation.NonNull;\n import androidx.annotation.StringRes;\n \n+import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import de.danoeh.antennapod.R;\n-import de.danoeh.antennapod.core.service.download.DownloadRequestCreator;\n-import de.danoeh.antennapod.core.service.download.DownloadService;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedMedia;\n import de.danoeh.antennapod.core.preferences.UsageStatistics;\n-import de.danoeh.antennapod.core.storage.DBWriter;\n import de.danoeh.antennapod.core.util.NetworkUtils;\n \n public class DownloadActionButton extends ItemActionButton {\n@@ -50,19 +47,23 @@ public void onClick(Context context) {\n \n         UsageStatistics.logAction(UsageStatistics.ACTION_DOWNLOAD);\n \n-        if (NetworkUtils.isEpisodeDownloadAllowed() || MobileDownloadHelper.userAllowedMobileDownloads()) {\n-            DownloadServiceInterface.get()\n-                    .download(context, false, DownloadRequestCreator.create(item.getMedia()).build());\n-        } else if (MobileDownloadHelper.userChoseAddToQueue() && !item.isTagged(FeedItem.TAG_QUEUE)) {\n-            DBWriter.addQueueItem(context, item);\n-            Toast.makeText(context, R.string.added_to_queue_label, Toast.LENGTH_SHORT).show();\n+        if (NetworkUtils.isEpisodeDownloadAllowed()) {\n+            DownloadServiceInterface.get().downloadNow(context, item, false);\n         } else {\n-            MobileDownloadHelper.confirmMobileDownload(context, item);\n+            MaterialAlertDialogBuilder builder = new MaterialAlertDialogBuilder(context)\n+                    .setTitle(R.string.confirm_mobile_download_dialog_title)\n+                    .setMessage(R.string.confirm_mobile_download_dialog_message)\n+                    .setPositiveButton(R.string.confirm_mobile_download_dialog_download_later,\n+                            (d, w) -> DownloadServiceInterface.get().downloadNow(context, item, false))\n+                    .setNeutralButton(R.string.confirm_mobile_download_dialog_allow_this_time,\n+                            (d, w) -> DownloadServiceInterface.get().downloadNow(context, item, true))\n+                    .setNegativeButton(R.string.cancel_label, null);\n+            builder.show();\n         }\n     }\n \n     private boolean shouldNotDownload(@NonNull FeedMedia media) {\n-        boolean isDownloading = DownloadService.isDownloadingFile(media.getDownload_url());\n+        boolean isDownloading = DownloadServiceInterface.get().isDownloadingEpisode(media.getDownload_url());\n         return isDownloading || media.isDownloaded();\n     }\n }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/ItemActionButton.java b/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/ItemActionButton.java\nindex e7a95c4047..613dd32f0a 100644\n--- a/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/ItemActionButton.java\n+++ b/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/ItemActionButton.java\n@@ -7,10 +7,10 @@\n import androidx.annotation.StringRes;\n import android.view.View;\n \n-import de.danoeh.antennapod.core.service.download.DownloadService;\n import de.danoeh.antennapod.core.util.PlaybackStatus;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedMedia;\n+import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n \n public abstract class ItemActionButton {\n@@ -39,7 +39,7 @@ public static ItemActionButton forItem(@NonNull FeedItem item) {\n             return new MarkAsPlayedActionButton(item);\n         }\n \n-        final boolean isDownloadingMedia = DownloadService.isDownloadingFile(media.getDownload_url());\n+        final boolean isDownloadingMedia = DownloadServiceInterface.get().isDownloadingEpisode(media.getDownload_url());\n         if (PlaybackStatus.isCurrentlyPlaying(media)) {\n             return new PauseActionButton(item);\n         } else if (item.getFeed().isLocalFeed()) {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/MobileDownloadHelper.java b/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/MobileDownloadHelper.java\ndeleted file mode 100644\nindex 015f463181..0000000000\n--- a/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/MobileDownloadHelper.java\n+++ /dev/null\n@@ -1,49 +0,0 @@\n-package de.danoeh.antennapod.adapter.actionbutton;\n-\n-import android.content.Context;\n-\n-import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n-import de.danoeh.antennapod.R;\n-import de.danoeh.antennapod.core.service.download.DownloadRequestCreator;\n-import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n-import de.danoeh.antennapod.model.feed.FeedItem;\n-import de.danoeh.antennapod.core.storage.DBReader;\n-import de.danoeh.antennapod.core.storage.DBWriter;\n-\n-class MobileDownloadHelper {\n-    private static long addToQueueTimestamp;\n-    private static long allowMobileDownloadTimestamp;\n-    private static final int TEN_MINUTES_IN_MILLIS = 10 * 60 * 1000;\n-\n-    static boolean userChoseAddToQueue() {\n-        return System.currentTimeMillis() - addToQueueTimestamp < TEN_MINUTES_IN_MILLIS;\n-    }\n-\n-    static boolean userAllowedMobileDownloads() {\n-        return System.currentTimeMillis() - allowMobileDownloadTimestamp < TEN_MINUTES_IN_MILLIS;\n-    }\n-\n-    static void confirmMobileDownload(final Context context, final FeedItem item) {\n-        MaterialAlertDialogBuilder builder = new MaterialAlertDialogBuilder(context)\n-                .setTitle(R.string.confirm_mobile_download_dialog_title)\n-                .setMessage(R.string.confirm_mobile_download_dialog_message)\n-                .setPositiveButton(context.getText(R.string.confirm_mobile_download_dialog_enable_temporarily),\n-                        (dialog, which) -> downloadFeedItems(context, item));\n-        if (!DBReader.getQueueIDList().contains(item.getId())) {\n-            builder.setMessage(R.string.confirm_mobile_download_dialog_message_not_in_queue)\n-                    .setNeutralButton(R.string.confirm_mobile_download_dialog_only_add_to_queue,\n-                            (dialog, which) -> addToQueue(context, item));\n-        }\n-        builder.show();\n-    }\n-\n-    private static void addToQueue(Context context, FeedItem item) {\n-        addToQueueTimestamp = System.currentTimeMillis();\n-        DBWriter.addQueueItem(context, item);\n-    }\n-\n-    private static void downloadFeedItems(Context context, FeedItem item) {\n-        allowMobileDownloadTimestamp = System.currentTimeMillis();\n-        DownloadServiceInterface.get().download(context, true, DownloadRequestCreator.create(item.getMedia()).build());\n-    }\n-}\n\\ No newline at end of file\ndiff --git a/app/src/main/java/de/danoeh/antennapod/dialog/DownloadLogDetailsDialog.java b/app/src/main/java/de/danoeh/antennapod/dialog/DownloadLogDetailsDialog.java\nindex 5e28639ddf..00936a38af 100644\n--- a/app/src/main/java/de/danoeh/antennapod/dialog/DownloadLogDetailsDialog.java\n+++ b/app/src/main/java/de/danoeh/antennapod/dialog/DownloadLogDetailsDialog.java\n@@ -9,7 +9,7 @@\n import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.core.util.DownloadErrorLabel;\n-import de.danoeh.antennapod.model.download.DownloadStatus;\n+import de.danoeh.antennapod.model.download.DownloadResult;\n import de.danoeh.antennapod.core.storage.DBReader;\n import de.danoeh.antennapod.event.MessageEvent;\n import de.danoeh.antennapod.model.feed.Feed;\n@@ -18,7 +18,7 @@\n \n public class DownloadLogDetailsDialog extends MaterialAlertDialogBuilder {\n \n-    public DownloadLogDetailsDialog(@NonNull Context context, DownloadStatus status) {\n+    public DownloadLogDetailsDialog(@NonNull Context context, DownloadResult status) {\n         super(context);\n \n         String url = \"unknown\";\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/CompletedDownloadsFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/CompletedDownloadsFragment.java\nindex 7379753892..ba328adba7 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/CompletedDownloadsFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/CompletedDownloadsFragment.java\n@@ -20,12 +20,12 @@\n import de.danoeh.antennapod.activity.MainActivity;\n import de.danoeh.antennapod.adapter.EpisodeItemListAdapter;\n import de.danoeh.antennapod.adapter.actionbutton.DeleteActionButton;\n-import de.danoeh.antennapod.core.event.DownloadEvent;\n import de.danoeh.antennapod.core.event.DownloadLogEvent;\n import de.danoeh.antennapod.core.menuhandler.MenuItemUtils;\n import de.danoeh.antennapod.core.storage.DBReader;\n import de.danoeh.antennapod.core.util.FeedItemUtil;\n import de.danoeh.antennapod.core.util.download.FeedUpdateManager;\n+import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FeedItemEvent;\n import de.danoeh.antennapod.event.PlayerStatusEvent;\n import de.danoeh.antennapod.event.UnreadItemsUpdateEvent;\n@@ -36,6 +36,7 @@\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n import de.danoeh.antennapod.model.feed.SortOrder;\n+import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import de.danoeh.antennapod.view.EmptyViewHandler;\n import de.danoeh.antennapod.view.EpisodeItemListRecyclerView;\n@@ -50,9 +51,10 @@\n import org.greenrobot.eventbus.ThreadMode;\n \n import java.util.ArrayList;\n-import java.util.Arrays;\n import java.util.Collections;\n+import java.util.HashSet;\n import java.util.List;\n+import java.util.Set;\n \n /**\n  * Displays all completed downloads and provides a button to delete them.\n@@ -63,7 +65,7 @@ public class CompletedDownloadsFragment extends Fragment\n     public static final String ARG_SHOW_LOGS = \"show_logs\";\n     private static final String KEY_UP_ARROW = \"up_arrow\";\n \n-    private long[] runningDownloads = new long[0];\n+    private Set<String> runningDownloads = new HashSet<>();\n     private List<FeedItem> items = new ArrayList<>();\n     private CompletedDownloadsListAdapter adapter;\n     private EpisodeItemListRecyclerView recyclerView;\n@@ -217,19 +219,22 @@ private void setSortOrder(SortOrder sortOrder) {\n     }\n \n     @Subscribe(sticky = true, threadMode = ThreadMode.MAIN)\n-    public void onEventMainThread(DownloadEvent event) {\n-        Log.d(TAG, \"onEventMainThread() called with: \" + \"event = [\" + event + \"]\");\n-        if (!Arrays.equals(event.update.mediaIds, runningDownloads)) {\n-            runningDownloads = event.update.mediaIds;\n+    public void onEventMainThread(EpisodeDownloadEvent event) {\n+        Set<String> newRunningDownloads = new HashSet<>();\n+        for (String url : event.getUrls()) {\n+            if (DownloadServiceInterface.get().isDownloadingEpisode(url)) {\n+                newRunningDownloads.add(url);\n+            }\n+        }\n+        if (!newRunningDownloads.equals(runningDownloads)) {\n+            runningDownloads = newRunningDownloads;\n             loadItems();\n             return; // Refreshed anyway\n         }\n-        if (event.update.mediaIds.length > 0) {\n-            for (long mediaId : event.update.mediaIds) {\n-                int pos = FeedItemUtil.indexOfItemWithMediaId(items, mediaId);\n-                if (pos >= 0) {\n-                    adapter.notifyItemChangedCompat(pos);\n-                }\n+        for (String downloadUrl : event.getUrls()) {\n+            int pos = FeedItemUtil.indexOfItemWithDownloadUrl(items, downloadUrl);\n+            if (pos >= 0) {\n+                adapter.notifyItemChangedCompat(pos);\n             }\n         }\n     }\n@@ -318,17 +323,17 @@ private void loadItems() {\n             List<FeedItem> downloadedItems = DBReader.getEpisodes(0, Integer.MAX_VALUE,\n                         new FeedItemFilter(FeedItemFilter.DOWNLOADED), sortOrder);\n \n-            List<Long> mediaIds = new ArrayList<>();\n+            List<String> mediaUrls = new ArrayList<>();\n             if (runningDownloads == null) {\n                 return downloadedItems;\n             }\n-            for (long id : runningDownloads) {\n-                if (FeedItemUtil.indexOfItemWithMediaId(downloadedItems, id) != -1) {\n+            for (String url : runningDownloads) {\n+                if (FeedItemUtil.indexOfItemWithDownloadUrl(downloadedItems, url) != -1) {\n                     continue; // Already in list\n                 }\n-                mediaIds.add(id);\n+                mediaUrls.add(url);\n             }\n-            List<FeedItem> currentDownloads = DBReader.getFeedItemsWithMedia(mediaIds.toArray(new Long[0]));\n+            List<FeedItem> currentDownloads = DBReader.getFeedItemsWithUrl(mediaUrls);\n             currentDownloads.addAll(downloadedItems);\n             return currentDownloads;\n         })\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/DownloadLogFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/DownloadLogFragment.java\nindex c27d8c058a..03913ff12e 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/DownloadLogFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/DownloadLogFragment.java\n@@ -14,15 +14,12 @@\n import com.google.android.material.bottomsheet.BottomSheetDialogFragment;\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.adapter.DownloadLogAdapter;\n-import de.danoeh.antennapod.core.event.DownloadEvent;\n import de.danoeh.antennapod.core.event.DownloadLogEvent;\n-import de.danoeh.antennapod.core.event.DownloaderUpdate;\n-import de.danoeh.antennapod.core.service.download.Downloader;\n import de.danoeh.antennapod.core.storage.DBReader;\n import de.danoeh.antennapod.core.storage.DBWriter;\n import de.danoeh.antennapod.databinding.DownloadLogFragmentBinding;\n import de.danoeh.antennapod.dialog.DownloadLogDetailsDialog;\n-import de.danoeh.antennapod.model.download.DownloadStatus;\n+import de.danoeh.antennapod.model.download.DownloadResult;\n import de.danoeh.antennapod.view.EmptyViewHandler;\n import io.reactivex.Observable;\n import io.reactivex.android.schedulers.AndroidSchedulers;\n@@ -30,7 +27,6 @@\n import io.reactivex.schedulers.Schedulers;\n import org.greenrobot.eventbus.EventBus;\n import org.greenrobot.eventbus.Subscribe;\n-import org.greenrobot.eventbus.ThreadMode;\n \n import java.util.ArrayList;\n import java.util.List;\n@@ -42,8 +38,7 @@ public class DownloadLogFragment extends BottomSheetDialogFragment\n         implements AdapterView.OnItemClickListener, MaterialToolbar.OnMenuItemClickListener {\n     private static final String TAG = \"DownloadLogFragment\";\n \n-    private List<DownloadStatus> downloadLog = new ArrayList<>();\n-    private List<Downloader> runningDownloads = new ArrayList<>();\n+    private List<DownloadResult> downloadLog = new ArrayList<>();\n     private DownloadLogAdapter adapter;\n     private Disposable disposable;\n     private DownloadLogFragmentBinding viewBinding;\n@@ -93,8 +88,8 @@ public void onDestroyView() {\n     @Override\n     public void onItemClick(AdapterView<?> parent, View view, int position, long id) {\n         Object item = adapter.getItem(position);\n-        if (item instanceof DownloadStatus) {\n-            new DownloadLogDetailsDialog(getContext(), (DownloadStatus) item).show();\n+        if (item instanceof DownloadResult) {\n+            new DownloadLogDetailsDialog(getContext(), (DownloadResult) item).show();\n         }\n     }\n \n@@ -119,14 +114,6 @@ public boolean onMenuItemClick(MenuItem item) {\n         return false;\n     }\n \n-    @Subscribe(sticky = true, threadMode = ThreadMode.MAIN)\n-    public void onEvent(DownloadEvent event) {\n-        Log.d(TAG, \"onEvent() called with: \" + \"event = [\" + event + \"]\");\n-        DownloaderUpdate update = event.update;\n-        runningDownloads = update.downloaders;\n-        adapter.setRunningDownloads(runningDownloads);\n-    }\n-\n     private void loadDownloadLog() {\n         if (disposable != null) {\n             disposable.dispose();\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/EpisodesListFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/EpisodesListFragment.java\nindex ef784e9ee2..00d671d36e 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/EpisodesListFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/EpisodesListFragment.java\n@@ -27,11 +27,10 @@\n import de.danoeh.antennapod.activity.MainActivity;\n import de.danoeh.antennapod.adapter.EpisodeItemListAdapter;\n import de.danoeh.antennapod.core.dialog.ConfirmationDialog;\n-import de.danoeh.antennapod.core.event.DownloadEvent;\n-import de.danoeh.antennapod.core.event.DownloaderUpdate;\n import de.danoeh.antennapod.core.menuhandler.MenuItemUtils;\n import de.danoeh.antennapod.core.util.FeedItemUtil;\n import de.danoeh.antennapod.core.util.download.FeedUpdateManager;\n+import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FeedItemEvent;\n import de.danoeh.antennapod.event.FeedListUpdateEvent;\n import de.danoeh.antennapod.event.FeedUpdateRunningEvent;\n@@ -387,16 +386,11 @@ public void onKeyUp(KeyEvent event) {\n     }\n \n     @Subscribe(sticky = true, threadMode = ThreadMode.MAIN)\n-    public void onEventMainThread(DownloadEvent event) {\n-        Log.d(TAG, \"onEventMainThread() called with: \" + \"event = [\" + event + \"]\");\n-        DownloaderUpdate update = event.update;\n-        updateToolbar();\n-        if (update.mediaIds.length > 0) {\n-            for (long mediaId : update.mediaIds) {\n-                int pos = FeedItemUtil.indexOfItemWithMediaId(episodes, mediaId);\n-                if (pos >= 0) {\n-                    listAdapter.notifyItemChangedCompat(pos);\n-                }\n+    public void onEventMainThread(EpisodeDownloadEvent event) {\n+        for (String downloadUrl : event.getUrls()) {\n+            int pos = FeedItemUtil.indexOfItemWithDownloadUrl(episodes, downloadUrl);\n+            if (pos >= 0) {\n+                listAdapter.notifyItemChangedCompat(pos);\n             }\n         }\n     }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/FeedItemlistFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/FeedItemlistFragment.java\nindex 61883afe7e..f59d5dbd48 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/FeedItemlistFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/FeedItemlistFragment.java\n@@ -29,8 +29,6 @@\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n import de.danoeh.antennapod.adapter.EpisodeItemListAdapter;\n-import de.danoeh.antennapod.core.event.DownloadEvent;\n-import de.danoeh.antennapod.core.event.DownloaderUpdate;\n import de.danoeh.antennapod.core.feed.FeedEvent;\n import de.danoeh.antennapod.core.menuhandler.MenuItemUtils;\n import de.danoeh.antennapod.core.storage.DBReader;\n@@ -45,6 +43,7 @@\n import de.danoeh.antennapod.dialog.FeedItemFilterDialog;\n import de.danoeh.antennapod.dialog.RemoveFeedDialog;\n import de.danoeh.antennapod.dialog.RenameItemDialog;\n+import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FavoritesEvent;\n import de.danoeh.antennapod.event.FeedItemEvent;\n import de.danoeh.antennapod.event.FeedListUpdateEvent;\n@@ -57,7 +56,7 @@\n import de.danoeh.antennapod.fragment.swipeactions.SwipeActions;\n import de.danoeh.antennapod.menuhandler.FeedItemMenuHandler;\n import de.danoeh.antennapod.menuhandler.FeedMenuHandler;\n-import de.danoeh.antennapod.model.download.DownloadStatus;\n+import de.danoeh.antennapod.model.download.DownloadResult;\n import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n@@ -330,16 +329,14 @@ public void onEventMainThread(FeedItemEvent event) {\n     }\n \n     @Subscribe(sticky = true, threadMode = ThreadMode.MAIN)\n-    public void onEventMainThread(DownloadEvent event) {\n-        Log.d(TAG, \"onEventMainThread() called with: \" + \"event = [\" + event + \"]\");\n-        DownloaderUpdate update = event.update;\n-        updateToolbar();\n-        if (update.mediaIds.length > 0 && feed != null) {\n-            for (long mediaId : update.mediaIds) {\n-                int pos = FeedItemUtil.indexOfItemWithMediaId(feed.getItems(), mediaId);\n-                if (pos >= 0) {\n-                    adapter.notifyItemChangedCompat(pos);\n-                }\n+    public void onEventMainThread(EpisodeDownloadEvent event) {\n+        if (feed == null) {\n+            return;\n+        }\n+        for (String downloadUrl : event.getUrls()) {\n+            int pos = FeedItemUtil.indexOfItemWithDownloadUrl(feed.getItems(), downloadUrl);\n+            if (pos >= 0) {\n+                adapter.notifyItemChangedCompat(pos);\n             }\n         }\n     }\n@@ -479,7 +476,7 @@ private void setupHeaderView() {\n     private void showErrorDetails() {\n         Maybe.fromCallable(\n                 () -> {\n-                    List<DownloadStatus> feedDownloadLog = DBReader.getFeedDownloadLog(feedID);\n+                    List<DownloadResult> feedDownloadLog = DBReader.getFeedDownloadLog(feedID);\n                     if (feedDownloadLog.size() == 0 || feedDownloadLog.get(0).isSuccessful()) {\n                         return null;\n                     }\n@@ -490,9 +487,7 @@ private void showErrorDetails() {\n                 .subscribe(\n                     downloadStatus -> new DownloadLogDetailsDialog(getContext(), downloadStatus).show(),\n                     error -> error.printStackTrace(),\n-                    () -> {\n-                        ((MainActivity) getActivity()).loadChildFragment(new DownloadLogFragment());\n-                    });\n+                    () -> new DownloadLogFragment().show(getChildFragmentManager(), null));\n     }\n \n     private void showFeedInfo() {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/ItemFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/ItemFragment.java\nindex df48c9a988..94877811e7 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/ItemFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/ItemFragment.java\n@@ -37,10 +37,7 @@\n import de.danoeh.antennapod.adapter.actionbutton.PlayLocalActionButton;\n import de.danoeh.antennapod.adapter.actionbutton.StreamActionButton;\n import de.danoeh.antennapod.adapter.actionbutton.VisitWebsiteActionButton;\n-import de.danoeh.antennapod.core.event.DownloadEvent;\n-import de.danoeh.antennapod.core.event.DownloaderUpdate;\n-import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n-import de.danoeh.antennapod.core.service.download.DownloadService;\n+import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.core.util.PlaybackStatus;\n import de.danoeh.antennapod.event.FeedItemEvent;\n import de.danoeh.antennapod.event.PlayerStatusEvent;\n@@ -49,8 +46,8 @@\n import de.danoeh.antennapod.model.feed.FeedMedia;\n import de.danoeh.antennapod.core.feed.util.ImageResourceUtils;\n import de.danoeh.antennapod.core.preferences.UsageStatistics;\n+import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n-import de.danoeh.antennapod.core.service.download.Downloader;\n import de.danoeh.antennapod.core.storage.DBReader;\n import de.danoeh.antennapod.core.util.Converter;\n import de.danoeh.antennapod.core.util.DateFormatter;\n@@ -63,12 +60,10 @@\n import io.reactivex.android.schedulers.AndroidSchedulers;\n import io.reactivex.disposables.Disposable;\n import io.reactivex.schedulers.Schedulers;\n-import org.apache.commons.lang3.ArrayUtils;\n import org.greenrobot.eventbus.EventBus;\n import org.greenrobot.eventbus.Subscribe;\n import org.greenrobot.eventbus.ThreadMode;\n \n-import java.util.List;\n import java.util.Locale;\n import java.util.Objects;\n \n@@ -98,7 +93,6 @@ public static ItemFragment newInstance(long feeditem) {\n     private long itemId;\n     private FeedItem item;\n     private String webviewData;\n-    private List<Downloader> downloaderList;\n \n     private ViewGroup root;\n     private ShownotesWebView webvDescription;\n@@ -309,14 +303,13 @@ private void updateAppearance() {\n \n     private void updateButtons() {\n         progbarDownload.setVisibility(View.GONE);\n-        if (item.hasMedia() && downloaderList != null) {\n-            for (Downloader downloader : downloaderList) {\n-                DownloadRequest request = downloader.getDownloadRequest();\n-                if (request.getFeedfileType() == FeedMedia.FEEDFILETYPE_FEEDMEDIA\n-                        && request.getFeedfileId() == item.getMedia().getId()) {\n-                    progbarDownload.setVisibility(View.VISIBLE);\n-                    progbarDownload.setPercentage(0.01f * Math.max(1, request.getProgressPercent()), request);\n-                }\n+        if (item.hasMedia()) {\n+            if (DownloadServiceInterface.get().isDownloadingEpisode(item.getMedia().getDownload_url())) {\n+                progbarDownload.setVisibility(View.VISIBLE);\n+                progbarDownload.setPercentage(0.01f * Math.max(1,\n+                        DownloadServiceInterface.get().getProgress(item.getMedia().getDownload_url())), item);\n+                progbarDownload.setIndeterminate(\n+                        DownloadServiceInterface.get().isEpisodeQueued(item.getMedia().getDownload_url()));\n             }\n         }\n \n@@ -341,7 +334,7 @@ private void updateButtons() {\n             } else {\n                 actionButton1 = new StreamActionButton(item);\n             }\n-            if (DownloadService.isDownloadingFile(media.getDownload_url())) {\n+            if (DownloadServiceInterface.get().isDownloadingEpisode(media.getDownload_url())) {\n                 actionButton2 = new CancelDownloadActionButton(item);\n             } else if (!media.isDownloaded()) {\n                 actionButton2 = new DownloadActionButton(item);\n@@ -386,18 +379,15 @@ public void onEventMainThread(FeedItemEvent event) {\n     }\n \n     @Subscribe(sticky = true, threadMode = ThreadMode.MAIN)\n-    public void onEventMainThread(DownloadEvent event) {\n-        Log.d(TAG, \"onEventMainThread() called with: \" + \"event = [\" + event + \"]\");\n-        DownloaderUpdate update = event.update;\n-        downloaderList = update.downloaders;\n+    public void onEventMainThread(EpisodeDownloadEvent event) {\n         if (item == null || item.getMedia() == null) {\n             return;\n         }\n-        long mediaId = item.getMedia().getId();\n-        if (ArrayUtils.contains(update.mediaIds, mediaId)) {\n-            if (itemsLoaded && getActivity() != null) {\n-                updateButtons();\n-            }\n+        if (!event.getUrls().contains(item.getMedia().getDownload_url())) {\n+            return;\n+        }\n+        if (itemsLoaded && getActivity() != null) {\n+            updateButtons();\n         }\n     }\n \ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/QueueFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/QueueFragment.java\nindex 6681df4c1f..a1aa7226d8 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/QueueFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/QueueFragment.java\n@@ -32,8 +32,6 @@\n import de.danoeh.antennapod.adapter.EpisodeItemListAdapter;\n import de.danoeh.antennapod.adapter.QueueRecyclerAdapter;\n import de.danoeh.antennapod.core.dialog.ConfirmationDialog;\n-import de.danoeh.antennapod.core.event.DownloadEvent;\n-import de.danoeh.antennapod.core.event.DownloaderUpdate;\n import de.danoeh.antennapod.core.feed.util.PlaybackSpeedUtils;\n import de.danoeh.antennapod.core.menuhandler.MenuItemUtils;\n import de.danoeh.antennapod.core.storage.DBReader;\n@@ -41,6 +39,7 @@\n import de.danoeh.antennapod.core.util.Converter;\n import de.danoeh.antennapod.core.util.FeedItemUtil;\n import de.danoeh.antennapod.core.util.download.FeedUpdateManager;\n+import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FeedItemEvent;\n import de.danoeh.antennapod.event.FeedUpdateRunningEvent;\n import de.danoeh.antennapod.event.PlayerStatusEvent;\n@@ -186,16 +185,14 @@ public void onEventMainThread(FeedItemEvent event) {\n     }\n \n     @Subscribe(sticky = true, threadMode = ThreadMode.MAIN)\n-    public void onEventMainThread(DownloadEvent event) {\n-        Log.d(TAG, \"onEventMainThread() called with DownloadEvent\");\n-        DownloaderUpdate update = event.update;\n-        refreshToolbarState();\n-        if (recyclerAdapter != null && update.mediaIds.length > 0) {\n-            for (long mediaId : update.mediaIds) {\n-                int pos = FeedItemUtil.indexOfItemWithMediaId(queue, mediaId);\n-                if (pos >= 0) {\n-                    recyclerAdapter.notifyItemChangedCompat(pos);\n-                }\n+    public void onEventMainThread(EpisodeDownloadEvent event) {\n+        if (queue == null) {\n+            return;\n+        }\n+        for (String downloadUrl : event.getUrls()) {\n+            int pos = FeedItemUtil.indexOfItemWithDownloadUrl(queue, downloadUrl);\n+            if (pos >= 0) {\n+                recyclerAdapter.notifyItemChangedCompat(pos);\n             }\n         }\n     }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/SearchFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/SearchFragment.java\nindex d2aa35549f..b85e34e7dd 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/SearchFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/SearchFragment.java\n@@ -28,9 +28,8 @@\n import de.danoeh.antennapod.activity.MainActivity;\n import de.danoeh.antennapod.adapter.EpisodeItemListAdapter;\n import de.danoeh.antennapod.adapter.HorizontalFeedListAdapter;\n-import de.danoeh.antennapod.core.event.DownloadEvent;\n-import de.danoeh.antennapod.core.event.DownloaderUpdate;\n import de.danoeh.antennapod.core.menuhandler.MenuItemUtils;\n+import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FeedItemEvent;\n import de.danoeh.antennapod.event.playback.PlaybackPositionEvent;\n import de.danoeh.antennapod.event.PlayerStatusEvent;\n@@ -295,15 +294,14 @@ public void onEventMainThread(FeedItemEvent event) {\n     }\n \n     @Subscribe(sticky = true, threadMode = ThreadMode.MAIN)\n-    public void onEventMainThread(DownloadEvent event) {\n-        Log.d(TAG, \"onEventMainThread() called with: \" + \"event = [\" + event + \"]\");\n-        DownloaderUpdate update = event.update;\n-        if (adapter != null && update.mediaIds.length > 0) {\n-            for (long mediaId : update.mediaIds) {\n-                int pos = FeedItemUtil.indexOfItemWithMediaId(results, mediaId);\n-                if (pos >= 0) {\n-                    adapter.notifyItemChangedCompat(pos);\n-                }\n+    public void onEventMainThread(EpisodeDownloadEvent event) {\n+        if (results == null) {\n+            return;\n+        }\n+        for (String downloadUrl : event.getUrls()) {\n+            int pos = FeedItemUtil.indexOfItemWithDownloadUrl(results, downloadUrl);\n+            if (pos >= 0) {\n+                adapter.notifyItemChangedCompat(pos);\n             }\n         }\n     }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/SubscriptionFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/SubscriptionFragment.java\nindex 490c79d473..a6daec2e70 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/SubscriptionFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/SubscriptionFragment.java\n@@ -36,7 +36,6 @@\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n import de.danoeh.antennapod.adapter.SubscriptionsRecyclerAdapter;\n-import de.danoeh.antennapod.core.event.DownloadEvent;\n import de.danoeh.antennapod.core.menuhandler.MenuItemUtils;\n import de.danoeh.antennapod.core.storage.DBReader;\n import de.danoeh.antennapod.core.storage.NavDrawerData;\n@@ -362,12 +361,6 @@ public void onUnreadItemsChanged(UnreadItemsUpdateEvent event) {\n         loadSubscriptions();\n     }\n \n-    @Subscribe(sticky = true, threadMode = ThreadMode.MAIN)\n-    public void onEventMainThread(DownloadEvent event) {\n-        Log.d(TAG, \"onEventMainThread() called with: \" + \"event = [\" + event + \"]\");\n-        refreshToolbarState();\n-    }\n-\n     @Override\n     public void onEndSelectMode() {\n         speedDialView.close();\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/actions/EpisodeMultiSelectActionHandler.java b/app/src/main/java/de/danoeh/antennapod/fragment/actions/EpisodeMultiSelectActionHandler.java\nindex e076d35b63..a14bfcd162 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/actions/EpisodeMultiSelectActionHandler.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/actions/EpisodeMultiSelectActionHandler.java\n@@ -6,13 +6,10 @@\n \n import com.google.android.material.snackbar.Snackbar;\n \n-import java.util.ArrayList;\n import java.util.List;\n \n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n-import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n-import de.danoeh.antennapod.core.service.download.DownloadRequestCreator;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n import de.danoeh.antennapod.core.storage.DBWriter;\n import de.danoeh.antennapod.core.util.LongList;\n@@ -93,14 +90,12 @@ private void markedCheckedUnplayed(List<FeedItem> items) {\n \n     private void downloadChecked(List<FeedItem> items) {\n         // download the check episodes in the same order as they are currently displayed\n-        List<DownloadRequest> requests = new ArrayList<>();\n         for (FeedItem episode : items) {\n             if (episode.hasMedia() && !episode.getFeed().isLocalFeed()) {\n-                requests.add(DownloadRequestCreator.create(episode.getMedia()).build());\n+                DownloadServiceInterface.get().download(activity, episode);\n             }\n         }\n-        DownloadServiceInterface.get().download(activity, true, requests.toArray(new DownloadRequest[0]));\n-        showMessage(R.plurals.downloading_batch_label, requests.size());\n+        showMessage(R.plurals.downloading_batch_label, items.size());\n     }\n \n     private void deleteChecked(List<FeedItem> items) {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/DownloadsPreferencesFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/DownloadsPreferencesFragment.java\nindex c486089fc4..7b0c3efdfe 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/DownloadsPreferencesFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/DownloadsPreferencesFragment.java\n@@ -1,7 +1,6 @@\n package de.danoeh.antennapod.fragment.preferences;\n \n import android.content.SharedPreferences;\n-import android.content.res.Resources;\n import android.os.Bundle;\n import androidx.preference.PreferenceFragmentCompat;\n import androidx.preference.PreferenceManager;\n@@ -43,7 +42,6 @@ public void onStop() {\n     @Override\n     public void onResume() {\n         super.onResume();\n-        setParallelDownloadsText(UserPreferences.getParallelDownloads());\n         setDataFolderText();\n     }\n \n@@ -52,12 +50,6 @@ private void setupNetworkScreen() {\n             ((PreferenceActivity) getActivity()).openScreen(R.xml.preferences_autodownload);\n             return true;\n         });\n-        findPreference(UserPreferences.PREF_PARALLEL_DOWNLOADS).setOnPreferenceChangeListener((preference, o) -> {\n-            if (o instanceof Integer) {\n-                setParallelDownloadsText((Integer) o);\n-            }\n-            return true;\n-        });\n         // validate and set correct value: number of downloads between 1 and 50 (inclusive)\n         findPreference(PREF_PROXY).setOnPreferenceClickListener(preference -> {\n             ProxyDialog dialog = new ProxyDialog(getActivity());\n@@ -73,12 +65,6 @@ private void setupNetworkScreen() {\n         });\n     }\n \n-    private void setParallelDownloadsText(int downloads) {\n-        final Resources res = getActivity().getResources();\n-        String s = res.getString(R.string.parallel_downloads, downloads);\n-        findPreference(UserPreferences.PREF_PARALLEL_DOWNLOADS).setSummary(s);\n-    }\n-\n     private void setDataFolderText() {\n         File f = UserPreferences.getDataFolder(null);\n         if (f != null) {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/preferences/NumberPickerPreference.java b/app/src/main/java/de/danoeh/antennapod/preferences/NumberPickerPreference.java\ndeleted file mode 100644\nindex a15c6d6b2d..0000000000\n--- a/app/src/main/java/de/danoeh/antennapod/preferences/NumberPickerPreference.java\n+++ /dev/null\n@@ -1,108 +0,0 @@\n-package de.danoeh.antennapod.preferences;\n-\n-import android.content.Context;\n-import androidx.appcompat.app.AlertDialog;\n-import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n-import androidx.preference.Preference;\n-import android.text.InputFilter;\n-import android.util.AttributeSet;\n-import android.view.View;\n-import android.view.WindowManager;\n-import android.widget.EditText;\n-\n-import de.danoeh.antennapod.R;\n-\n-public class NumberPickerPreference extends Preference {\n-    private Context context;\n-    private int defaultValue = 0;\n-    private int minValue = 0;\n-    private int maxValue = Integer.MAX_VALUE;\n-\n-    public NumberPickerPreference(Context context, AttributeSet attrs, int defStyleAttr, int defStyleRes) {\n-        super(context, attrs, defStyleAttr, defStyleRes);\n-        init(context, attrs);\n-    }\n-\n-    public NumberPickerPreference(Context context, AttributeSet attrs, int defStyleAttr) {\n-        super(context, attrs, defStyleAttr);\n-        init(context, attrs);\n-    }\n-\n-    public NumberPickerPreference(Context context, AttributeSet attrs) {\n-        super(context, attrs);\n-        init(context, attrs);\n-    }\n-\n-    public NumberPickerPreference(Context context) {\n-        super(context);\n-        this.context = context;\n-    }\n-\n-    private void init(Context context, AttributeSet attrs) {\n-        this.context = context;\n-\n-        for (int i = 0; i < attrs.getAttributeCount(); i++) {\n-            String name = attrs.getAttributeName(i);\n-            String value = attrs.getAttributeValue(i);\n-            switch (name) {\n-                case \"defaultValue\":\n-                    defaultValue = Integer.parseInt(value);\n-                    break;\n-                case \"minValue\":\n-                    minValue = Integer.parseInt(value);\n-                    break;\n-                case \"maxValue\":\n-                    maxValue = Integer.parseInt(value);\n-                    break;\n-            }\n-        }\n-    }\n-\n-    @Override\n-    protected void onClick() {\n-        super.onClick();\n-\n-        View view = View.inflate(context, R.layout.numberpicker, null);\n-        EditText number = view.findViewById(R.id.number);\n-        number.setText(getSharedPreferences().getString(getKey(), \"\"+defaultValue));\n-        number.setFilters(new InputFilter[]{(source, start, end, dest, dstart, dend) -> {\n-            try {\n-                String newVal = dest.toString().substring(0, dstart) + dest.toString().substring(dend);\n-                newVal = newVal.substring(0, dstart) + source.toString() + newVal.substring(dstart);\n-                int input = Integer.parseInt(newVal);\n-                if (input >= minValue && input <= maxValue) {\n-                    return null;\n-                }\n-            } catch (NumberFormatException nfe) {\n-                nfe.printStackTrace();\n-            }\n-            return \"\";\n-        }});\n-\n-        AlertDialog dialog = new MaterialAlertDialogBuilder(context)\n-                .setTitle(getTitle())\n-                .setView(view)\n-                .setNegativeButton(android.R.string.cancel, null)\n-                .setPositiveButton(android.R.string.ok, (dialogInterface, i) -> {\n-                    try {\n-                        String numberString = number.getText().toString();\n-                        int value = Integer.parseInt(numberString);\n-\n-                        if (value < minValue || value > maxValue) {\n-                            return;\n-                        }\n-\n-                        getSharedPreferences().edit().putString(getKey(), \"\" + value).apply();\n-\n-                        if (getOnPreferenceChangeListener() != null) {\n-                            getOnPreferenceChangeListener().onPreferenceChange(this, value);\n-                        }\n-                    } catch (NumberFormatException e) {\n-                        // Do not set value\n-                    }\n-                })\n-                .create();\n-        dialog.show();\n-        dialog.getWindow().setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_STATE_ALWAYS_VISIBLE);\n-    }\n-}\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/home/sections/EpisodesSurpriseSection.java b/app/src/main/java/de/danoeh/antennapod/ui/home/sections/EpisodesSurpriseSection.java\nindex 7e2c855e94..298bd05c5c 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/home/sections/EpisodesSurpriseSection.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/home/sections/EpisodesSurpriseSection.java\n@@ -13,11 +13,10 @@\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n import de.danoeh.antennapod.adapter.HorizontalItemListAdapter;\n-import de.danoeh.antennapod.core.event.DownloadEvent;\n-import de.danoeh.antennapod.core.event.DownloaderUpdate;\n import de.danoeh.antennapod.core.menuhandler.MenuItemUtils;\n import de.danoeh.antennapod.core.storage.DBReader;\n import de.danoeh.antennapod.core.util.FeedItemUtil;\n+import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FeedItemEvent;\n import de.danoeh.antennapod.event.PlayerStatusEvent;\n import de.danoeh.antennapod.event.playback.PlaybackPositionEvent;\n@@ -32,6 +31,7 @@\n import org.greenrobot.eventbus.Subscribe;\n import org.greenrobot.eventbus.ThreadMode;\n \n+import java.util.ArrayList;\n import java.util.List;\n import java.util.Random;\n \n@@ -41,7 +41,7 @@ public class EpisodesSurpriseSection extends HomeSection {\n     private static int seed = 0;\n     private HorizontalItemListAdapter listAdapter;\n     private Disposable disposable;\n-    private List<FeedItem> episodes;\n+    private List<FeedItem> episodes = new ArrayList<>();\n \n     @Nullable\n     @Override\n@@ -103,9 +103,6 @@ public void onPlayerStatusChanged(PlayerStatusEvent event) {\n     @Subscribe(threadMode = ThreadMode.MAIN)\n     public void onEventMainThread(FeedItemEvent event) {\n         Log.d(TAG, \"onEventMainThread() called with: \" + \"event = [\" + event + \"]\");\n-        if (episodes == null) {\n-            return;\n-        }\n         for (int i = 0, size = event.items.size(); i < size; i++) {\n             FeedItem item = event.items.get(i);\n             int pos = FeedItemUtil.indexOfItemWithId(episodes, item.getId());\n@@ -118,15 +115,11 @@ public void onEventMainThread(FeedItemEvent event) {\n     }\n \n     @Subscribe(sticky = true, threadMode = ThreadMode.MAIN)\n-    public void onEventMainThread(DownloadEvent event) {\n-        Log.d(TAG, \"onEventMainThread() called with DownloadEvent\");\n-        DownloaderUpdate update = event.update;\n-        if (listAdapter != null && update.mediaIds.length > 0) {\n-            for (long mediaId : update.mediaIds) {\n-                int pos = FeedItemUtil.indexOfItemWithMediaId(episodes, mediaId);\n-                if (pos >= 0) {\n-                    listAdapter.notifyItemChangedCompat(pos);\n-                }\n+    public void onEventMainThread(EpisodeDownloadEvent event) {\n+        for (String downloadUrl : event.getUrls()) {\n+            int pos = FeedItemUtil.indexOfItemWithDownloadUrl(episodes, downloadUrl);\n+            if (pos >= 0) {\n+                listAdapter.notifyItemChangedCompat(pos);\n             }\n         }\n     }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/home/sections/InboxSection.java b/app/src/main/java/de/danoeh/antennapod/ui/home/sections/InboxSection.java\nindex 8d343a16aa..fe9d15dc10 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/home/sections/InboxSection.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/home/sections/InboxSection.java\n@@ -14,11 +14,10 @@\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n import de.danoeh.antennapod.adapter.EpisodeItemListAdapter;\n-import de.danoeh.antennapod.core.event.DownloadEvent;\n-import de.danoeh.antennapod.core.event.DownloaderUpdate;\n import de.danoeh.antennapod.core.menuhandler.MenuItemUtils;\n import de.danoeh.antennapod.core.storage.DBReader;\n import de.danoeh.antennapod.core.util.FeedItemUtil;\n+import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FeedItemEvent;\n import de.danoeh.antennapod.event.FeedListUpdateEvent;\n import de.danoeh.antennapod.event.UnreadItemsUpdateEvent;\n@@ -35,6 +34,7 @@\n import org.greenrobot.eventbus.Subscribe;\n import org.greenrobot.eventbus.ThreadMode;\n \n+import java.util.ArrayList;\n import java.util.List;\n import java.util.Locale;\n \n@@ -42,7 +42,7 @@ public class InboxSection extends HomeSection {\n     public static final String TAG = \"InboxSection\";\n     private static final int NUM_EPISODES = 2;\n     private EpisodeItemListAdapter adapter;\n-    private List<FeedItem> items;\n+    private List<FeedItem> items = new ArrayList<>();\n     private Disposable disposable;\n \n     @Nullable\n@@ -97,15 +97,11 @@ public void onFeedListChanged(FeedListUpdateEvent event) {\n     }\n \n     @Subscribe(sticky = true, threadMode = ThreadMode.MAIN)\n-    public void onEventMainThread(DownloadEvent event) {\n-        Log.d(TAG, \"onEventMainThread() called with DownloadEvent\");\n-        DownloaderUpdate update = event.update;\n-        if (adapter != null && update.mediaIds.length > 0) {\n-            for (long mediaId : update.mediaIds) {\n-                int pos = FeedItemUtil.indexOfItemWithMediaId(items, mediaId);\n-                if (pos >= 0) {\n-                    adapter.notifyItemChangedCompat(pos);\n-                }\n+    public void onEventMainThread(EpisodeDownloadEvent event) {\n+        for (String downloadUrl : event.getUrls()) {\n+            int pos = FeedItemUtil.indexOfItemWithDownloadUrl(items, downloadUrl);\n+            if (pos >= 0) {\n+                adapter.notifyItemChangedCompat(pos);\n             }\n         }\n     }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/home/sections/QueueSection.java b/app/src/main/java/de/danoeh/antennapod/ui/home/sections/QueueSection.java\nindex 070d56ed63..33335f2bb0 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/home/sections/QueueSection.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/home/sections/QueueSection.java\n@@ -13,11 +13,10 @@\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n import de.danoeh.antennapod.adapter.HorizontalItemListAdapter;\n-import de.danoeh.antennapod.core.event.DownloadEvent;\n-import de.danoeh.antennapod.core.event.DownloaderUpdate;\n import de.danoeh.antennapod.core.menuhandler.MenuItemUtils;\n import de.danoeh.antennapod.core.storage.DBReader;\n import de.danoeh.antennapod.core.util.FeedItemUtil;\n+import de.danoeh.antennapod.event.EpisodeDownloadEvent;\n import de.danoeh.antennapod.event.FeedItemEvent;\n import de.danoeh.antennapod.event.PlayerStatusEvent;\n import de.danoeh.antennapod.event.QueueEvent;\n@@ -33,6 +32,7 @@\n import org.greenrobot.eventbus.Subscribe;\n import org.greenrobot.eventbus.ThreadMode;\n \n+import java.util.ArrayList;\n import java.util.List;\n \n public class QueueSection extends HomeSection {\n@@ -40,7 +40,7 @@ public class QueueSection extends HomeSection {\n     private static final int NUM_EPISODES = 8;\n     private HorizontalItemListAdapter listAdapter;\n     private Disposable disposable;\n-    private List<FeedItem> queue;\n+    private List<FeedItem> queue = new ArrayList<>();\n \n     @Nullable\n     @Override\n@@ -102,15 +102,11 @@ public void onEventMainThread(FeedItemEvent event) {\n     }\n \n     @Subscribe(sticky = true, threadMode = ThreadMode.MAIN)\n-    public void onEventMainThread(DownloadEvent event) {\n-        Log.d(TAG, \"onEventMainThread() called with DownloadEvent\");\n-        DownloaderUpdate update = event.update;\n-        if (listAdapter != null && update.mediaIds.length > 0) {\n-            for (long mediaId : update.mediaIds) {\n-                int pos = FeedItemUtil.indexOfItemWithMediaId(queue, mediaId);\n-                if (pos >= 0) {\n-                    listAdapter.notifyItemChangedCompat(pos);\n-                }\n+    public void onEventMainThread(EpisodeDownloadEvent event) {\n+        for (String downloadUrl : event.getUrls()) {\n+            int pos = FeedItemUtil.indexOfItemWithDownloadUrl(queue, downloadUrl);\n+            if (pos >= 0) {\n+                listAdapter.notifyItemChangedCompat(pos);\n             }\n         }\n     }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/view/viewholder/EpisodeItemViewHolder.java b/app/src/main/java/de/danoeh/antennapod/view/viewholder/EpisodeItemViewHolder.java\nindex fd3ec92991..03df844b16 100644\n--- a/app/src/main/java/de/danoeh/antennapod/view/viewholder/EpisodeItemViewHolder.java\n+++ b/app/src/main/java/de/danoeh/antennapod/view/viewholder/EpisodeItemViewHolder.java\n@@ -21,8 +21,6 @@\n import de.danoeh.antennapod.activity.MainActivity;\n import de.danoeh.antennapod.adapter.CoverLoader;\n import de.danoeh.antennapod.adapter.actionbutton.ItemActionButton;\n-import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n-import de.danoeh.antennapod.core.service.download.DownloadService;\n import de.danoeh.antennapod.core.util.PlaybackStatus;\n import de.danoeh.antennapod.core.util.download.MediaSizeLoader;\n import de.danoeh.antennapod.event.playback.PlaybackPositionEvent;\n@@ -31,6 +29,7 @@\n import de.danoeh.antennapod.model.feed.FeedMedia;\n import de.danoeh.antennapod.model.playback.MediaType;\n import de.danoeh.antennapod.core.feed.util.ImageResourceUtils;\n+import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import de.danoeh.antennapod.core.util.Converter;\n import de.danoeh.antennapod.core.util.NetworkUtils;\n@@ -117,6 +116,7 @@ public void bind(FeedItem item) {\n             bind(item.getMedia());\n         } else {\n             secondaryActionProgress.setPercentage(0, item);\n+            secondaryActionProgress.setIndeterminate(false);\n             isVideo.setVisibility(View.GONE);\n             progressBar.setVisibility(View.GONE);\n             duration.setVisibility(View.GONE);\n@@ -145,14 +145,17 @@ private void bind(FeedMedia media) {\n             itemView.setBackgroundResource(ThemeUtils.getDrawableFromAttr(activity, R.attr.selectableItemBackground));\n         }\n \n-        if (DownloadService.isDownloadingFile(media.getDownload_url())) {\n-            final DownloadRequest downloadRequest = DownloadService.findRequest(media.getDownload_url());\n-            float percent = 0.01f * downloadRequest.getProgressPercent();\n+        if (DownloadServiceInterface.get().isDownloadingEpisode(media.getDownload_url())) {\n+            float percent = 0.01f * DownloadServiceInterface.get().getProgress(media.getDownload_url());\n             secondaryActionProgress.setPercentage(Math.max(percent, 0.01f), item);\n+            secondaryActionProgress.setIndeterminate(\n+                    DownloadServiceInterface.get().isEpisodeQueued(media.getDownload_url()));\n         } else if (media.isDownloaded()) {\n             secondaryActionProgress.setPercentage(1, item); // Do not animate 100% -> 0%\n+            secondaryActionProgress.setIndeterminate(false);\n         } else {\n             secondaryActionProgress.setPercentage(0, item); // Animate X% -> 0%\n+            secondaryActionProgress.setIndeterminate(false);\n         }\n \n         duration.setText(Converter.getDurationStringLong(media.getDuration()));\n@@ -210,6 +213,7 @@ public void bindDummy() {\n         pubDate.setText(\"\u2588\u2588\u2588\u2588\");\n         duration.setText(\"\u2588\u2588\u2588\u2588\");\n         secondaryActionProgress.setPercentage(0, null);\n+        secondaryActionProgress.setIndeterminate(false);\n         progressBar.setVisibility(View.GONE);\n         position.setVisibility(View.GONE);\n         dragHandle.setVisibility(View.GONE);\ndiff --git a/app/src/main/java/de/danoeh/antennapod/view/viewholder/HorizontalItemViewHolder.java b/app/src/main/java/de/danoeh/antennapod/view/viewholder/HorizontalItemViewHolder.java\nindex 05240b371d..f809de175f 100644\n--- a/app/src/main/java/de/danoeh/antennapod/view/viewholder/HorizontalItemViewHolder.java\n+++ b/app/src/main/java/de/danoeh/antennapod/view/viewholder/HorizontalItemViewHolder.java\n@@ -14,13 +14,12 @@\n import de.danoeh.antennapod.adapter.CoverLoader;\n import de.danoeh.antennapod.adapter.actionbutton.ItemActionButton;\n import de.danoeh.antennapod.core.feed.util.ImageResourceUtils;\n-import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n-import de.danoeh.antennapod.core.service.download.DownloadService;\n import de.danoeh.antennapod.core.util.DateFormatter;\n import de.danoeh.antennapod.core.util.PlaybackStatus;\n import de.danoeh.antennapod.event.playback.PlaybackPositionEvent;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedMedia;\n+import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n import de.danoeh.antennapod.ui.common.CircularProgressBar;\n import de.danoeh.antennapod.ui.common.SquareImageView;\n import de.danoeh.antennapod.ui.common.ThemeUtils;\n@@ -85,14 +84,17 @@ public void bind(FeedItem item) {\n                 setProgressBar(false, 0);\n             }\n \n-            if (DownloadService.isDownloadingFile(media.getDownload_url())) {\n-                final DownloadRequest downloadRequest = DownloadService.findRequest(media.getDownload_url());\n-                float percent = 0.01f * downloadRequest.getProgressPercent();\n+            if (DownloadServiceInterface.get().isDownloadingEpisode(media.getDownload_url())) {\n+                float percent = 0.01f * DownloadServiceInterface.get().getProgress(media.getDownload_url());\n                 circularProgressBar.setPercentage(Math.max(percent, 0.01f), item);\n+                circularProgressBar.setIndeterminate(\n+                        DownloadServiceInterface.get().isEpisodeQueued(media.getDownload_url()));\n             } else if (media.isDownloaded()) {\n                 circularProgressBar.setPercentage(1, item); // Do not animate 100% -> 0%\n+                circularProgressBar.setIndeterminate(false);\n             } else {\n                 circularProgressBar.setPercentage(0, item); // Animate X% -> 0%\n+                circularProgressBar.setIndeterminate(false);\n             }\n         }\n     }\n@@ -107,6 +109,7 @@ public void bindDummy() {\n         date.setText(\"\u2588\u2588\u2588\");\n         secondaryActionIcon.setImageDrawable(null);\n         circularProgressBar.setPercentage(0, null);\n+        circularProgressBar.setIndeterminate(false);\n         setProgressBar(true, 50);\n     }\n \ndiff --git a/app/src/main/res/layout/numberpicker.xml b/app/src/main/res/layout/numberpicker.xml\ndeleted file mode 100644\nindex d493f2e6cf..0000000000\n--- a/app/src/main/res/layout/numberpicker.xml\n+++ /dev/null\n@@ -1,16 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"utf-8\"?>\n-<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n-              android:layout_width=\"match_parent\"\n-              android:layout_height=\"match_parent\"\n-              android:orientation=\"vertical\"\n-              android:padding=\"16dp\">\n-\n-    <EditText\n-            android:layout_width=\"match_parent\"\n-            android:layout_height=\"wrap_content\"\n-            android:inputType=\"numberDecimal\"\n-            android:ems=\"10\"\n-            android:selectAllOnFocus=\"true\"\n-            android:id=\"@+id/number\" />\n-\n-</LinearLayout>\ndiff --git a/app/src/main/res/xml/preferences_downloads.xml b/app/src/main/res/xml/preferences_downloads.xml\nindex 865748d200..18fc7df111 100644\n--- a/app/src/main/res/xml/preferences_downloads.xml\n+++ b/app/src/main/res/xml/preferences_downloads.xml\n@@ -1,7 +1,6 @@\n <?xml version=\"1.0\" encoding=\"utf-8\"?>\n <PreferenceScreen\n         xmlns:android=\"http://schemas.android.com/apk/res/android\"\n-        xmlns:numberpicker=\"http://schemas.android.com/apk/de.danoeh.antennapod\"\n         xmlns:search=\"http://schemas.android.com/apk/com.bytehamster.lib.preferencesearch\">\n \n     <Preference\n@@ -56,12 +55,6 @@\n                 android:key=\"prefMobileUpdateTypes\"\n                 android:summary=\"@string/pref_mobileUpdate_sum\"\n                 android:title=\"@string/pref_mobileUpdate_title\"/>\n-        <de.danoeh.antennapod.preferences.NumberPickerPreference\n-                android:defaultValue=\"4\"\n-                numberpicker:minValue=\"1\"\n-                numberpicker:maxValue=\"50\"\n-                android:key=\"prefParallelDownloads\"\n-                android:title=\"@string/pref_parallel_downloads_title\"/>\n         <Preference\n                 android:key=\"prefProxy\"\n                 android:summary=\"@string/pref_proxy_sum\"\ndiff --git a/core/src/main/AndroidManifest.xml b/core/src/main/AndroidManifest.xml\nindex 6f5508f273..e186a856fb 100644\n--- a/core/src/main/AndroidManifest.xml\n+++ b/core/src/main/AndroidManifest.xml\n@@ -16,10 +16,6 @@\n         android:icon=\"@mipmap/ic_launcher\"\n         android:supportsRtl=\"true\">\n \n-        <service\n-            android:name=\".service.download.DownloadService\"\n-            android:enabled=\"true\" />\n-\n         <service android:name=\".service.playback.PlaybackService\"\n             android:label=\"@string/app_name\"\n             android:enabled=\"true\"\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/event/DownloadEvent.java b/core/src/main/java/de/danoeh/antennapod/core/event/DownloadEvent.java\ndeleted file mode 100644\nindex efd53ab9d4..0000000000\n--- a/core/src/main/java/de/danoeh/antennapod/core/event/DownloadEvent.java\n+++ /dev/null\n@@ -1,35 +0,0 @@\n-package de.danoeh.antennapod.core.event;\n-\n-import androidx.annotation.NonNull;\n-\n-import java.util.ArrayList;\n-import java.util.List;\n-\n-import de.danoeh.antennapod.core.service.download.Downloader;\n-\n-public class DownloadEvent {\n-\n-    public final DownloaderUpdate update;\n-\n-    private DownloadEvent(DownloaderUpdate downloader) {\n-        this.update = downloader;\n-    }\n-\n-    public static DownloadEvent refresh(List<Downloader> list) {\n-        list = new ArrayList<>(list);\n-        DownloaderUpdate update = new DownloaderUpdate(list);\n-        return new DownloadEvent(update);\n-    }\n-\n-    @NonNull\n-    @Override\n-    public String toString() {\n-        return \"DownloadEvent{\" +\n-                \"update=\" + update +\n-                '}';\n-    }\n-\n-    public boolean hasChangedFeedUpdateStatus(boolean oldStatus) {\n-        return oldStatus != update.feedIds.length > 0;\n-    }\n-}\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/event/DownloaderUpdate.java b/core/src/main/java/de/danoeh/antennapod/core/event/DownloaderUpdate.java\ndeleted file mode 100644\nindex 1cab7e0f05..0000000000\n--- a/core/src/main/java/de/danoeh/antennapod/core/event/DownloaderUpdate.java\n+++ /dev/null\n@@ -1,58 +0,0 @@\n-package de.danoeh.antennapod.core.event;\n-\n-import androidx.annotation.NonNull;\n-\n-import java.util.Arrays;\n-import java.util.List;\n-\n-import de.danoeh.antennapod.model.feed.Feed;\n-import de.danoeh.antennapod.model.feed.FeedMedia;\n-import de.danoeh.antennapod.core.service.download.Downloader;\n-import de.danoeh.antennapod.core.util.LongList;\n-\n-public class DownloaderUpdate {\n-\n-    /* Downloaders that are currently running */\n-    @NonNull\n-    public final List<Downloader> downloaders;\n-\n-    /**\n-     * IDs of feeds that are currently being downloaded\n-     * Often used to show some progress wheel in the action bar\n-     */\n-    public final long[] feedIds;\n-\n-    /**\n-     * IDs of feed media that are currently being downloaded\n-     * Can be used to show and update download progress bars\n-     */\n-    public final long[] mediaIds;\n-\n-    DownloaderUpdate(@NonNull List<Downloader> downloaders) {\n-        this.downloaders = downloaders;\n-        LongList feedIds1 = new LongList();\n-        LongList mediaIds1 = new LongList();\n-        for(Downloader d1 : downloaders) {\n-            int type = d1.getDownloadRequest().getFeedfileType();\n-            long id = d1.getDownloadRequest().getFeedfileId();\n-            if(type == Feed.FEEDFILETYPE_FEED) {\n-                feedIds1.add(id);\n-            } else if(type == FeedMedia.FEEDFILETYPE_FEEDMEDIA) {\n-                mediaIds1.add(id);\n-            }\n-        }\n-\n-        this.feedIds = feedIds1.toArray();\n-        this.mediaIds = mediaIds1.toArray();\n-    }\n-\n-    @NonNull\n-    @Override\n-    public String toString() {\n-        return \"DownloaderUpdate{\" +\n-                \"downloaders=\" + downloaders +\n-                \", feedIds=\" + Arrays.toString(feedIds) +\n-                \", mediaIds=\" + Arrays.toString(mediaIds) +\n-                '}';\n-    }\n-}\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/feed/LocalFeedUpdater.java b/core/src/main/java/de/danoeh/antennapod/core/feed/LocalFeedUpdater.java\nindex d4d948b2a4..03881ee4f7 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/feed/LocalFeedUpdater.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/feed/LocalFeedUpdater.java\n@@ -28,7 +28,7 @@\n import androidx.documentfile.provider.DocumentFile;\n import de.danoeh.antennapod.core.R;\n import de.danoeh.antennapod.core.util.FastDocumentFile;\n-import de.danoeh.antennapod.model.download.DownloadStatus;\n+import de.danoeh.antennapod.model.download.DownloadResult;\n import de.danoeh.antennapod.core.storage.DBReader;\n import de.danoeh.antennapod.core.storage.DBTasks;\n import de.danoeh.antennapod.core.storage.DBWriter;\n@@ -246,8 +246,8 @@ private static void loadMetadata(FeedItem item, FastDocumentFile file, Context c\n     }\n \n     private static void reportError(Feed feed, String reasonDetailed) {\n-        DownloadStatus status = new DownloadStatus(feed, feed.getTitle(),\n-                DownloadError.ERROR_IO_ERROR, false, reasonDetailed, true);\n+        DownloadResult status = new DownloadResult(feed, feed.getTitle(),\n+                DownloadError.ERROR_IO_ERROR, false, reasonDetailed);\n         DBWriter.addDownloadStatus(status);\n         DBWriter.setFeedLastUpdateFailed(feed.getId(), true);\n     }\n@@ -256,8 +256,7 @@ private static void reportError(Feed feed, String reasonDetailed) {\n      * Reports a successful download status.\n      */\n     private static void reportSuccess(Feed feed) {\n-        DownloadStatus status = new DownloadStatus(feed, feed.getTitle(),\n-                DownloadError.SUCCESS, true, null, true);\n+        DownloadResult status = new DownloadResult(feed, feed.getTitle(), DownloadError.SUCCESS, true, null);\n         DBWriter.addDownloadStatus(status);\n         DBWriter.setFeedLastUpdateFailed(feed.getId(), false);\n     }\n@@ -266,21 +265,21 @@ private static void reportSuccess(Feed feed) {\n      * Answers if reporting success is needed for the given feed.\n      */\n     private static boolean mustReportDownloadSuccessful(Feed feed) {\n-        List<DownloadStatus> downloadStatuses = DBReader.getFeedDownloadLog(feed.getId());\n+        List<DownloadResult> downloadResults = DBReader.getFeedDownloadLog(feed.getId());\n \n-        if (downloadStatuses.isEmpty()) {\n+        if (downloadResults.isEmpty()) {\n             // report success if never reported before\n             return true;\n         }\n \n-        Collections.sort(downloadStatuses, (downloadStatus1, downloadStatus2) ->\n+        Collections.sort(downloadResults, (downloadStatus1, downloadStatus2) ->\n                 downloadStatus1.getCompletionDate().compareTo(downloadStatus2.getCompletionDate()));\n \n-        DownloadStatus lastDownloadStatus = downloadStatuses.get(downloadStatuses.size() - 1);\n+        DownloadResult lastDownloadResult = downloadResults.get(downloadResults.size() - 1);\n \n         // report success if the last update was not successful\n         // (avoid logging success again if the last update was ok)\n-        return !lastDownloadStatus.isSuccessful();\n+        return !lastDownloadResult.isSuccessful();\n     }\n \n     @FunctionalInterface\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/FeedUpdateWorker.java b/core/src/main/java/de/danoeh/antennapod/core/service/FeedUpdateWorker.java\nindex 8d9f046e29..5f59f0c41e 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/FeedUpdateWorker.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/FeedUpdateWorker.java\n@@ -20,12 +20,13 @@\n import de.danoeh.antennapod.core.service.download.NewEpisodesNotification;\n import de.danoeh.antennapod.core.service.download.handler.FeedSyncTask;\n import de.danoeh.antennapod.core.storage.DBReader;\n+import de.danoeh.antennapod.core.storage.DBTasks;\n import de.danoeh.antennapod.core.storage.DBWriter;\n import de.danoeh.antennapod.core.util.NetworkUtils;\n import de.danoeh.antennapod.core.util.download.FeedUpdateManager;\n import de.danoeh.antennapod.core.util.gui.NotificationUtils;\n import de.danoeh.antennapod.model.download.DownloadError;\n-import de.danoeh.antennapod.model.download.DownloadStatus;\n+import de.danoeh.antennapod.model.download.DownloadResult;\n import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n \n@@ -80,6 +81,7 @@ public Result doWork() {\n             refreshFeeds(toUpdate, true);\n         }\n         notificationManager.cancel(R.id.notification_updating_feeds);\n+        DBTasks.autodownloadUndownloadedItems(getApplicationContext());\n         return Result.success();\n     }\n \n@@ -115,8 +117,8 @@ private void refreshFeeds(List<Feed> toUpdate, boolean force) {\n                 }\n             } catch (Exception e) {\n                 DBWriter.setFeedLastUpdateFailed(feed.getId(), true);\n-                DownloadStatus status = new DownloadStatus(feed, feed.getTitle(),\n-                        DownloadError.ERROR_IO_ERROR, false, e.getMessage(), true);\n+                DownloadResult status = new DownloadResult(feed, feed.getTitle(),\n+                        DownloadError.ERROR_IO_ERROR, false, e.getMessage());\n                 DBWriter.addDownloadStatus(status);\n             }\n             toUpdate.remove(0);\n@@ -144,7 +146,7 @@ void refreshFeed(Feed feed, boolean force) throws Exception {\n         downloader.call();\n \n         if (!downloader.getResult().isSuccessful()) {\n-            if (downloader.getResult().isCancelled()) {\n+            if (downloader.cancelled) {\n                 return;\n             }\n             DBWriter.setFeedLastUpdateFailed(request.getFeedfileId(), true);\n@@ -165,7 +167,7 @@ void refreshFeed(Feed feed, boolean force) throws Exception {\n             return; // No download logs for new subscriptions\n         }\n         // we create a 'successful' download log if the feed's last refresh failed\n-        List<DownloadStatus> log = DBReader.getFeedDownloadLog(request.getFeedfileId());\n+        List<DownloadResult> log = DBReader.getFeedDownloadLog(request.getFeedfileId());\n         if (log.size() > 0 && !log.get(0).isSuccessful()) {\n             DBWriter.addDownloadStatus(feedSyncTask.getDownloadStatus());\n         }\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadRequestCreator.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadRequestCreator.java\nindex d6a4b83781..5ca904ff66 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadRequestCreator.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadRequestCreator.java\n@@ -21,9 +21,6 @@ public class DownloadRequestCreator {\n \n     public static DownloadRequest.Builder create(Feed feed) {\n         File dest = new File(getFeedfilePath(), getFeedfileName(feed));\n-        if (!isFilenameAvailable(dest.toString()) && !feed.isLocalFeed()) {\n-            dest = findUnusedFile(dest);\n-        }\n         Log.d(TAG, \"Requesting download of url \" + feed.getDownload_url());\n \n         String username = (feed.getPreferences() != null) ? feed.getPreferences().getUsername() : null;\n@@ -45,7 +42,7 @@ public static DownloadRequest.Builder create(FeedMedia media) {\n             dest = new File(getMediafilePath(media), getMediafilename(media));\n         }\n \n-        if (!isFilenameAvailable(dest.toString()) || (!partiallyDownloadedFileExists && dest.exists())) {\n+        if (dest.exists() && !partiallyDownloadedFileExists) {\n             dest = findUnusedFile(dest);\n         }\n         Log.d(TAG, \"Requesting download of url \" + media.getDownload_url());\n@@ -72,7 +69,7 @@ private static File findUnusedFile(File dest) {\n                     + FilenameUtils.getExtension(dest.getName());\n             Log.d(TAG, \"Testing filename \" + newName);\n             newDest = new File(dest.getParent(), newName);\n-            if (!newDest.exists() && isFilenameAvailable(newDest.toString())) {\n+            if (!newDest.exists()) {\n                 Log.d(TAG, \"File doesn't exist yet. Using \" + newName);\n                 break;\n             }\n@@ -80,19 +77,6 @@ private static File findUnusedFile(File dest) {\n         return newDest;\n     }\n \n-    /**\n-     * Returns true if a filename is available and false if it has already been\n-     * taken by another requested download.\n-     */\n-    private static boolean isFilenameAvailable(String path) {\n-        for (Downloader downloader : DownloadService.downloads) {\n-            if (downloader.request.getDestination().equals(path)) {\n-                return false;\n-            }\n-        }\n-        return true;\n-    }\n-\n     private static String getFeedfilePath() {\n         return UserPreferences.getDataFolder(FEED_DOWNLOADPATH).toString() + \"/\";\n     }\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadService.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadService.java\ndeleted file mode 100644\nindex 9c238137e8..0000000000\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadService.java\n+++ /dev/null\n@@ -1,536 +0,0 @@\n-package de.danoeh.antennapod.core.service.download;\n-\n-import android.app.Notification;\n-import android.app.NotificationManager;\n-import android.app.Service;\n-import android.content.BroadcastReceiver;\n-import android.content.Context;\n-import android.content.Intent;\n-import android.content.IntentFilter;\n-import android.os.IBinder;\n-import android.text.TextUtils;\n-import android.util.Log;\n-import androidx.annotation.NonNull;\n-import androidx.annotation.Nullable;\n-import androidx.annotation.VisibleForTesting;\n-import androidx.core.app.NotificationManagerCompat;\n-import androidx.core.app.ServiceCompat;\n-import de.danoeh.antennapod.core.R;\n-import de.danoeh.antennapod.core.event.DownloadEvent;\n-import de.danoeh.antennapod.core.service.download.handler.FailedDownloadHandler;\n-import de.danoeh.antennapod.core.service.download.handler.MediaDownloadedHandler;\n-import de.danoeh.antennapod.core.service.download.handler.PostDownloaderTask;\n-import de.danoeh.antennapod.core.storage.DBReader;\n-import de.danoeh.antennapod.core.storage.DBTasks;\n-import de.danoeh.antennapod.core.storage.DBWriter;\n-import de.danoeh.antennapod.core.storage.EpisodeCleanupAlgorithmFactory;\n-import de.danoeh.antennapod.core.util.download.ConnectionStateMonitor;\n-import de.danoeh.antennapod.event.FeedItemEvent;\n-import de.danoeh.antennapod.model.download.DownloadError;\n-import de.danoeh.antennapod.model.download.DownloadStatus;\n-import de.danoeh.antennapod.model.feed.FeedItem;\n-import de.danoeh.antennapod.model.feed.FeedMedia;\n-import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n-import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n-import de.danoeh.antennapod.storage.preferences.UserPreferences;\n-import org.apache.commons.io.FileUtils;\n-import org.greenrobot.eventbus.EventBus;\n-\n-import java.io.File;\n-import java.io.IOException;\n-import java.util.ArrayList;\n-import java.util.Collections;\n-import java.util.List;\n-import java.util.concurrent.CopyOnWriteArrayList;\n-import java.util.concurrent.ExecutionException;\n-import java.util.concurrent.ExecutorService;\n-import java.util.concurrent.Executors;\n-import java.util.concurrent.ScheduledFuture;\n-import java.util.concurrent.ScheduledThreadPoolExecutor;\n-import java.util.concurrent.TimeUnit;\n-\n-/**\n- * Manages the download of feedfiles in the app. Downloads can be enqueued via the startService intent.\n- * The argument of the intent is an instance of DownloadRequest in the EXTRA_REQUESTS field of\n- * the intent.\n- * After the downloads have finished, the downloaded object will be passed on to a specific handler, depending on the\n- * type of the feedfile.\n- */\n-public class DownloadService extends Service {\n-    private static final String TAG = \"DownloadService\";\n-    private static final int SCHED_EX_POOL_SIZE = 1;\n-    public static final String ACTION_CANCEL_DOWNLOAD = \"action.de.danoeh.antennapod.core.service.cancelDownload\";\n-    public static final String ACTION_CANCEL_ALL_DOWNLOADS = \"action.de.danoeh.antennapod.core.service.cancelAll\";\n-    public static final String EXTRA_DOWNLOAD_URL = \"downloadUrl\";\n-    public static final String EXTRA_REQUESTS = \"downloadRequests\";\n-    public static final String EXTRA_INITIATED_BY_USER = \"initiatedByUser\";\n-    public static final String EXTRA_CLEANUP_MEDIA = \"cleanupMedia\";\n-\n-    public static boolean isRunning = false;\n-\n-    // Can be modified from another thread while iterating. Both possible race conditions are not critical:\n-    // Remove while iterating: We think it is still downloading and don't start a new download with the same file.\n-    // Add while iterating: We think it is not downloading and might start a second download with the same file.\n-    static final List<Downloader> downloads = Collections.synchronizedList(new CopyOnWriteArrayList<>());\n-    private final ExecutorService downloadHandleExecutor;\n-    private final ExecutorService downloadEnqueueExecutor;\n-\n-    private final List<DownloadStatus> reportQueue = new ArrayList<>();\n-    private final List<DownloadRequest> failedRequestsForReport = new ArrayList<>();\n-    private DownloadServiceNotification notificationManager;\n-    private NotificationUpdater notificationUpdater;\n-    private ScheduledFuture<?> notificationUpdaterFuture;\n-    private ScheduledFuture<?> downloadPostFuture;\n-    private final ScheduledThreadPoolExecutor notificationUpdateExecutor;\n-    private static DownloaderFactory downloaderFactory = new DefaultDownloaderFactory();\n-    private ConnectionStateMonitor connectionMonitor;\n-\n-    @Override\n-    public IBinder onBind(Intent intent) {\n-        return null;\n-    }\n-\n-    public DownloadService() {\n-\n-        downloadEnqueueExecutor = Executors.newSingleThreadExecutor(r -> {\n-            Thread t = new Thread(r, \"EnqueueThread\");\n-            t.setPriority(Thread.MIN_PRIORITY);\n-            return t;\n-        });\n-        Log.d(TAG, \"parallel downloads: \" + UserPreferences.getParallelDownloads());\n-        downloadHandleExecutor = Executors.newFixedThreadPool(UserPreferences.getParallelDownloads(),\n-            r -> {\n-                Thread t = new Thread(r, \"DownloadThread\");\n-                t.setPriority(Thread.MIN_PRIORITY);\n-                return t;\n-            });\n-        notificationUpdateExecutor = new ScheduledThreadPoolExecutor(SCHED_EX_POOL_SIZE,\n-                r -> {\n-                    Thread t = new Thread(r, \"NotificationUpdateExecutor\");\n-                    t.setPriority(Thread.MIN_PRIORITY);\n-                    return t;\n-                }, (r, executor) -> Log.w(TAG, \"SchedEx rejected submission of new task\")\n-        );\n-    }\n-\n-    @Override\n-    public void onCreate() {\n-        Log.d(TAG, \"Service started\");\n-        isRunning = true;\n-        notificationManager = new DownloadServiceNotification(this);\n-\n-        IntentFilter cancelDownloadReceiverFilter = new IntentFilter();\n-        cancelDownloadReceiverFilter.addAction(ACTION_CANCEL_ALL_DOWNLOADS);\n-        cancelDownloadReceiverFilter.addAction(ACTION_CANCEL_DOWNLOAD);\n-        registerReceiver(cancelDownloadReceiver, cancelDownloadReceiverFilter);\n-\n-        connectionMonitor = new ConnectionStateMonitor();\n-        connectionMonitor.enable(getApplicationContext());\n-    }\n-\n-    public static boolean isDownloadingFile(String downloadUrl) {\n-        if (!isRunning) {\n-            return false;\n-        }\n-        for (Downloader downloader : downloads) {\n-            if (downloader.request.getSource().equals(downloadUrl) && !downloader.cancelled) {\n-                return true;\n-            }\n-        }\n-        return false;\n-    }\n-\n-    public static DownloadRequest findRequest(String downloadUrl) {\n-        for (Downloader downloader : downloads) {\n-            if (downloader.request.getSource().equals(downloadUrl)) {\n-                return downloader.request;\n-            }\n-        }\n-        return null;\n-    }\n-\n-    @Override\n-    public int onStartCommand(Intent intent, int flags, int startId) {\n-        if (intent != null && intent.hasExtra(EXTRA_REQUESTS)) {\n-            Notification notification = notificationManager.updateNotifications(downloads);\n-            startForeground(R.id.notification_downloading, notification);\n-            NotificationManagerCompat.from(this).cancel(R.id.notification_download_report);\n-            NotificationManagerCompat.from(this).cancel(R.id.notification_auto_download_report);\n-            setupNotificationUpdaterIfNecessary();\n-            downloadEnqueueExecutor.execute(() -> onDownloadQueued(intent));\n-        } else if (downloads.size() == 0) {\n-            shutdown();\n-        } else {\n-            Log.d(TAG, \"onStartCommand: Unknown intent\");\n-        }\n-        return Service.START_NOT_STICKY;\n-    }\n-\n-    @Override\n-    public void onDestroy() {\n-        Log.d(TAG, \"Service shutting down\");\n-        isRunning = false;\n-\n-        boolean showAutoDownloadReport = UserPreferences.showAutoDownloadReport();\n-        if (UserPreferences.showDownloadReport() || showAutoDownloadReport) {\n-            notificationManager.updateReport(reportQueue, showAutoDownloadReport, failedRequestsForReport);\n-            reportQueue.clear();\n-            failedRequestsForReport.clear();\n-        }\n-\n-        unregisterReceiver(cancelDownloadReceiver);\n-        connectionMonitor.disable(getApplicationContext());\n-\n-        EventBus.getDefault().postSticky(DownloadEvent.refresh(Collections.emptyList()));\n-        cancelNotificationUpdater();\n-        downloadEnqueueExecutor.shutdownNow();\n-        downloadHandleExecutor.shutdownNow();\n-        notificationUpdateExecutor.shutdownNow();\n-        if (downloadPostFuture != null) {\n-            downloadPostFuture.cancel(true);\n-        }\n-        downloads.clear();\n-\n-        // start auto download in case anything new has shown up\n-        DBTasks.autodownloadUndownloadedItems(getApplicationContext());\n-    }\n-\n-    /**\n-     * This method MUST NOT, in any case, throw an exception.\n-     * Otherwise, it hangs up the refresh thread pool.\n-     */\n-    private void performDownload(Downloader downloader) {\n-        try {\n-            downloader.call();\n-        } catch (Exception e) {\n-            e.printStackTrace();\n-        }\n-        try {\n-            if (downloader.getResult().isSuccessful()) {\n-                handleSuccessfulDownload(downloader);\n-            } else {\n-                handleFailedDownload(downloader);\n-            }\n-        } catch (Exception e) {\n-            e.printStackTrace();\n-        }\n-        downloadEnqueueExecutor.submit(() -> {\n-            downloads.remove(downloader);\n-            stopServiceIfEverythingDone();\n-        });\n-    }\n-\n-    private void handleSuccessfulDownload(Downloader downloader) {\n-        DownloadRequest request = downloader.getDownloadRequest();\n-        DownloadStatus status = downloader.getResult();\n-        final int type = status.getFeedfileType();\n-\n-        if (type == FeedMedia.FEEDFILETYPE_FEEDMEDIA) {\n-            Log.d(TAG, \"Handling completed FeedMedia Download\");\n-            MediaDownloadedHandler handler = new MediaDownloadedHandler(DownloadService.this, status, request);\n-            handler.run();\n-            saveDownloadStatus(handler.getUpdatedStatus(), downloader.getDownloadRequest());\n-        }\n-    }\n-\n-    private void handleFailedDownload(Downloader downloader) {\n-        DownloadStatus status = downloader.getResult();\n-        final int type = status.getFeedfileType();\n-\n-        if (!status.isCancelled()) {\n-            if (status.getReason() == DownloadError.ERROR_UNAUTHORIZED) {\n-                notificationManager.postAuthenticationNotification(downloader.getDownloadRequest());\n-            } else if (status.getReason() == DownloadError.ERROR_HTTP_DATA_ERROR\n-                    && Integer.parseInt(status.getReasonDetailed()) == 416) {\n-\n-                Log.d(TAG, \"Requested invalid range, restarting download from the beginning\");\n-                FileUtils.deleteQuietly(new File(downloader.getDownloadRequest().getDestination()));\n-                DownloadServiceInterface.get().download(this, false, downloader.getDownloadRequest());\n-            } else {\n-                Log.e(TAG, \"Download failed\");\n-                saveDownloadStatus(status, downloader.getDownloadRequest());\n-                new FailedDownloadHandler(downloader.getDownloadRequest()).run();\n-\n-                if (type == FeedMedia.FEEDFILETYPE_FEEDMEDIA) {\n-                    FeedItem item = getFeedItemFromId(status.getFeedfileId());\n-                    if (item == null) {\n-                        return;\n-                    }\n-                    item.increaseFailedAutoDownloadAttempts(System.currentTimeMillis());\n-                    DBWriter.setFeedItem(item);\n-                    // to make lists reload the failed item, we fake an item update\n-                    EventBus.getDefault().post(FeedItemEvent.updated(item));\n-                }\n-            }\n-        } else {\n-            // if FeedMedia download has been canceled, fake FeedItem update\n-            // so that lists reload that it\n-            if (status.getFeedfileType() == FeedMedia.FEEDFILETYPE_FEEDMEDIA) {\n-                FeedItem item = getFeedItemFromId(status.getFeedfileId());\n-                if (item == null) {\n-                    return;\n-                }\n-                EventBus.getDefault().post(FeedItemEvent.updated(item));\n-            }\n-        }\n-    }\n-\n-    private final BroadcastReceiver cancelDownloadReceiver = new BroadcastReceiver() {\n-\n-        @Override\n-        public void onReceive(Context context, Intent intent) {\n-            Log.d(TAG, \"cancelDownloadReceiver: \" + intent.getAction());\n-            if (!isRunning) {\n-                return;\n-            }\n-            if (TextUtils.equals(intent.getAction(), ACTION_CANCEL_DOWNLOAD)) {\n-                String url = intent.getStringExtra(EXTRA_DOWNLOAD_URL);\n-                if (url == null) {\n-                    throw new IllegalArgumentException(\"ACTION_CANCEL_DOWNLOAD intent needs download url extra\");\n-                }\n-                downloadEnqueueExecutor.execute(() -> {\n-                    doCancel(url);\n-                    postDownloaders();\n-                    stopServiceIfEverythingDone();\n-                });\n-            } else if (TextUtils.equals(intent.getAction(), ACTION_CANCEL_ALL_DOWNLOADS)) {\n-                downloadEnqueueExecutor.execute(() -> {\n-                    for (Downloader d : downloads) {\n-                        d.cancel();\n-                    }\n-                    Log.d(TAG, \"Cancelled all downloads\");\n-                    postDownloaders();\n-                    stopServiceIfEverythingDone();\n-                });\n-            }\n-        }\n-    };\n-\n-    private void doCancel(String url) {\n-        Log.d(TAG, \"Cancelling download with url \" + url);\n-        for (Downloader downloader : downloads) {\n-            if (downloader.cancelled || !downloader.getDownloadRequest().getSource().equals(url)) {\n-                continue;\n-            }\n-            downloader.cancel();\n-            DownloadRequest request = downloader.getDownloadRequest();\n-            FeedItem item = getFeedItemFromId(request.getFeedfileId());\n-            if (item != null) {\n-                EventBus.getDefault().post(FeedItemEvent.updated(item));\n-                // undo enqueue upon cancel\n-                if (request.isMediaEnqueued()) {\n-                    Log.v(TAG, \"Undoing enqueue upon cancelling download\");\n-                    DBWriter.removeQueueItem(getApplicationContext(), false, item);\n-                }\n-            }\n-        }\n-    }\n-\n-    private void onDownloadQueued(Intent intent) {\n-        List<DownloadRequest> requests = intent.getParcelableArrayListExtra(EXTRA_REQUESTS);\n-        if (requests == null) {\n-            throw new IllegalArgumentException(\"ACTION_ENQUEUE_DOWNLOAD intent needs request extra\");\n-        }\n-        Log.d(TAG, \"Received enqueue request. #requests=\" + requests.size());\n-\n-        if (intent.getBooleanExtra(EXTRA_CLEANUP_MEDIA, false)) {\n-            EpisodeCleanupAlgorithmFactory.build().makeRoomForEpisodes(getApplicationContext(), requests.size());\n-        }\n-\n-        for (DownloadRequest request : requests) {\n-            addNewRequest(request);\n-        }\n-        postDownloaders();\n-        stopServiceIfEverythingDone();\n-\n-        // Add to-download items to the queue before actual download completed\n-        // so that the resulting queue order is the same as when download is clicked\n-        enqueueFeedItems(requests);\n-    }\n-\n-    private void enqueueFeedItems(@NonNull List<DownloadRequest> requests) {\n-        List<FeedItem> feedItems = new ArrayList<>();\n-        for (DownloadRequest request : requests) {\n-            if (request.getFeedfileType() == FeedMedia.FEEDFILETYPE_FEEDMEDIA) {\n-                long mediaId = request.getFeedfileId();\n-                FeedMedia media = DBReader.getFeedMedia(mediaId);\n-                if (media == null) {\n-                    Log.w(TAG, \"enqueueFeedItems() : FeedFile Id \" + mediaId + \" is not found. ignore it.\");\n-                    continue;\n-                }\n-                feedItems.add(media.getItem());\n-            }\n-        }\n-        List<FeedItem> actuallyEnqueued = Collections.emptyList();\n-        try {\n-            actuallyEnqueued = DBTasks.enqueueFeedItemsToDownload(getApplicationContext(), feedItems);\n-        } catch (InterruptedException | ExecutionException e) {\n-            e.printStackTrace();\n-        }\n-\n-        for (DownloadRequest request : requests) {\n-            if (request.getFeedfileType() != FeedMedia.FEEDFILETYPE_FEEDMEDIA) {\n-                continue;\n-            }\n-            final long mediaId = request.getFeedfileId();\n-            for (FeedItem item : actuallyEnqueued) {\n-                if (item.getMedia() != null && item.getMedia().getId() == mediaId) {\n-                    request.setMediaEnqueued(true);\n-                }\n-            }\n-        }\n-    }\n-\n-    private void addNewRequest(@NonNull DownloadRequest request) {\n-        if (isDownloadingFile(request.getSource())) {\n-            Log.d(TAG, \"Skipped enqueueing request. Already running.\");\n-            return;\n-        } else if (downloadHandleExecutor.isShutdown()) {\n-            Log.d(TAG, \"Skipped enqueueing request. Service is already shutting down.\");\n-            return;\n-        }\n-        Log.d(TAG, \"Add new request: \" + request.getSource());\n-        writeFileUrl(request);\n-        Downloader downloader = downloaderFactory.create(request);\n-        if (downloader != null) {\n-            downloads.add(downloader);\n-            downloadHandleExecutor.submit(() -> performDownload(downloader));\n-        }\n-    }\n-\n-    @VisibleForTesting\n-    public static DownloaderFactory getDownloaderFactory() {\n-        return downloaderFactory;\n-    }\n-\n-    // public scope rather than package private,\n-    // because androidTest put classes in the non-standard de.test.antennapod hierarchy\n-    @VisibleForTesting\n-    public static void setDownloaderFactory(DownloaderFactory downloaderFactory) {\n-        DownloadService.downloaderFactory = downloaderFactory;\n-    }\n-\n-    /**\n-     * Adds a new DownloadStatus object to the list of completed downloads and\n-     * saves it in the database\n-     *\n-     * @param status the download that is going to be saved\n-     */\n-    private void saveDownloadStatus(@NonNull DownloadStatus status, @NonNull DownloadRequest request) {\n-        reportQueue.add(status);\n-        if (!status.isSuccessful() && !status.isCancelled()) {\n-            failedRequestsForReport.add(request);\n-        }\n-        DBWriter.addDownloadStatus(status);\n-    }\n-\n-    /**\n-     * Check if there's something else to download, otherwise stop.\n-     */\n-    private void stopServiceIfEverythingDone() {\n-        Log.d(TAG, downloads.size() + \" downloads left\");\n-        if (downloads.size() <= 0) {\n-            Log.d(TAG, \"Attempting shutdown\");\n-            shutdown();\n-        }\n-    }\n-\n-    @Nullable\n-    private FeedItem getFeedItemFromId(long id) {\n-        FeedMedia media = DBReader.getFeedMedia(id);\n-        if (media != null) {\n-            return media.getItem();\n-        } else {\n-            return null;\n-        }\n-    }\n-\n-    /**\n-     * Creates the destination file and writes FeedMedia File_url directly after starting download\n-     * to make it possible to resume download after the service was killed by the system.\n-     */\n-    private void writeFileUrl(DownloadRequest request) {\n-        if (request.getFeedfileType() != FeedMedia.FEEDFILETYPE_FEEDMEDIA) {\n-            return;\n-        }\n-\n-        File dest = new File(request.getDestination());\n-        if (!dest.exists()) {\n-            try {\n-                dest.createNewFile();\n-            } catch (IOException e) {\n-                Log.e(TAG, \"Unable to create file\");\n-            }\n-        }\n-\n-        if (dest.exists()) {\n-            Log.d(TAG, \"Writing file url\");\n-            FeedMedia media = DBReader.getFeedMedia(request.getFeedfileId());\n-            if (media == null) {\n-                Log.d(TAG, \"No media\");\n-                return;\n-            }\n-            media.setFile_url(request.getDestination());\n-            try {\n-                DBWriter.setFeedMedia(media).get();\n-            } catch (InterruptedException e) {\n-                Log.e(TAG, \"writeFileUrl was interrupted\");\n-            } catch (ExecutionException e) {\n-                Log.e(TAG, \"ExecutionException in writeFileUrl: \" + e.getMessage());\n-            }\n-        }\n-    }\n-\n-    /**\n-     * Schedules the notification updater task if it hasn't been scheduled yet.\n-     */\n-    private void setupNotificationUpdaterIfNecessary() {\n-        if (notificationUpdater == null) {\n-            Log.d(TAG, \"Setting up notification updater\");\n-            notificationUpdater = new NotificationUpdater();\n-            notificationUpdaterFuture = notificationUpdateExecutor\n-                    .scheduleAtFixedRate(notificationUpdater, 1, 1, TimeUnit.SECONDS);\n-        }\n-    }\n-\n-    private void cancelNotificationUpdater() {\n-        boolean result = false;\n-        if (notificationUpdaterFuture != null) {\n-            result = notificationUpdaterFuture.cancel(true);\n-        }\n-        notificationUpdater = null;\n-        notificationUpdaterFuture = null;\n-        Log.d(TAG, \"NotificationUpdater cancelled. Result: \" + result);\n-    }\n-\n-    private class NotificationUpdater implements Runnable {\n-        public void run() {\n-            Notification n = notificationManager.updateNotifications(downloads);\n-            if (n != null) {\n-                NotificationManager nm = (NotificationManager) getSystemService(Context.NOTIFICATION_SERVICE);\n-                nm.notify(R.id.notification_downloading, n);\n-            }\n-        }\n-    }\n-\n-    private void postDownloaders() {\n-        new PostDownloaderTask(downloads).run();\n-\n-        if (downloadPostFuture == null) {\n-            downloadPostFuture = notificationUpdateExecutor.scheduleAtFixedRate(\n-                    new PostDownloaderTask(downloads), 1, 1, TimeUnit.SECONDS);\n-        }\n-    }\n-\n-    private void shutdown() {\n-        // If the service was run for a very short time, the system may delay closing\n-        // the notification. Set the notification text now so that a misleading message\n-        // is not left on the notification.\n-        if (notificationUpdater != null) {\n-            notificationUpdater.run();\n-        }\n-        cancelNotificationUpdater();\n-        ServiceCompat.stopForeground(this, ServiceCompat.STOP_FOREGROUND_REMOVE);\n-        stopSelf();\n-    }\n-}\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceInterfaceImpl.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceInterfaceImpl.java\nindex 976d8255f9..87cbeda847 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceInterfaceImpl.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceInterfaceImpl.java\n@@ -1,74 +1,72 @@\n package de.danoeh.antennapod.core.service.download;\n \n import android.content.Context;\n-import android.content.Intent;\n-import androidx.core.content.ContextCompat;\n-import com.google.android.exoplayer2.util.Log;\n-import de.danoeh.antennapod.core.BuildConfig;\n-import de.danoeh.antennapod.core.util.download.FeedUpdateManager;\n-import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n+import androidx.work.Constraints;\n+import androidx.work.Data;\n+import androidx.work.ExistingWorkPolicy;\n+import androidx.work.NetworkType;\n+import androidx.work.OneTimeWorkRequest;\n+import androidx.work.OutOfQuotaPolicy;\n+import androidx.work.WorkManager;\n+import de.danoeh.antennapod.core.storage.DBWriter;\n+import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n+import de.danoeh.antennapod.storage.preferences.UserPreferences;\n \n-import java.util.ArrayList;\n-\n-import static de.danoeh.antennapod.core.service.download.DownloadService.isDownloadingFile;\n+import java.util.concurrent.TimeUnit;\n \n public class DownloadServiceInterfaceImpl extends DownloadServiceInterface {\n-    private static final String TAG = \"DownloadServiceInterface\";\n-\n-    public void download(Context context, boolean cleanupMedia, DownloadRequest... requests) {\n-        Intent intent = makeDownloadIntent(context, cleanupMedia, requests);\n-        if (intent != null) {\n-            ContextCompat.startForegroundService(context, intent);\n+    public void downloadNow(Context context, FeedItem item, boolean ignoreConstraints) {\n+        OneTimeWorkRequest.Builder workRequest = getRequest(context, item);\n+        workRequest.setExpedited(OutOfQuotaPolicy.RUN_AS_NON_EXPEDITED_WORK_REQUEST);\n+        if (ignoreConstraints) {\n+            workRequest.setConstraints(new Constraints.Builder().setRequiredNetworkType(NetworkType.CONNECTED).build());\n+        } else {\n+            workRequest.setConstraints(getConstraints());\n         }\n+        WorkManager.getInstance(context).enqueueUniqueWork(item.getMedia().getDownload_url(),\n+                ExistingWorkPolicy.KEEP, workRequest.build());\n     }\n \n-    public Intent makeDownloadIntent(Context context, boolean cleanupMedia, DownloadRequest... requests) {\n-        ArrayList<DownloadRequest> requestsToSend = new ArrayList<>();\n-        for (DownloadRequest request : requests) {\n-            if (!isDownloadingFile(request.getSource())) {\n-                requestsToSend.add(request);\n-            }\n-        }\n-        if (requestsToSend.isEmpty()) {\n-            return null;\n-        } else if (requestsToSend.size() > 100) {\n-            if (BuildConfig.DEBUG) {\n-                throw new IllegalArgumentException(\"Android silently drops intent payloads that are too large\");\n-            } else {\n-                Log.d(TAG, \"Too many download requests. Dropping some to avoid Android dropping all.\");\n-                requestsToSend = new ArrayList<>(requestsToSend.subList(0, 100));\n-            }\n-        }\n+    public void download(Context context, FeedItem item) {\n+        OneTimeWorkRequest.Builder workRequest = getRequest(context, item);\n+        workRequest.setConstraints(getConstraints());\n+        WorkManager.getInstance(context).enqueueUniqueWork(item.getMedia().getDownload_url(),\n+                ExistingWorkPolicy.KEEP, workRequest.build());\n+    }\n \n-        Intent launchIntent = new Intent(context, DownloadService.class);\n-        launchIntent.putParcelableArrayListExtra(DownloadService.EXTRA_REQUESTS, requestsToSend);\n-        if (cleanupMedia) {\n-            launchIntent.putExtra(DownloadService.EXTRA_CLEANUP_MEDIA, true);\n+    private static OneTimeWorkRequest.Builder getRequest(Context context, FeedItem item) {\n+        OneTimeWorkRequest.Builder workRequest = new OneTimeWorkRequest.Builder(EpisodeDownloadWorker.class)\n+                .setInitialDelay(0L, TimeUnit.MILLISECONDS)\n+                .addTag(DownloadServiceInterface.WORK_TAG)\n+                .addTag(DownloadServiceInterface.WORK_TAG_EPISODE_URL + item.getMedia().getDownload_url());\n+        Data.Builder builder = new Data.Builder();\n+        builder.putLong(WORK_DATA_MEDIA_ID, item.getMedia().getId());\n+        if (!item.isTagged(FeedItem.TAG_QUEUE) && UserPreferences.enqueueDownloadedEpisodes()) {\n+            DBWriter.addQueueItem(context, false, item.getId());\n+            builder.putBoolean(WORK_DATA_WAS_QUEUED, true);\n         }\n-        return launchIntent;\n+        workRequest.setInputData(builder.build());\n+        return workRequest;\n     }\n \n-    public void refreshAllFeeds(Context context, boolean initiatedByUser) {\n-        FeedUpdateManager.runOnce(context);\n+    private static Constraints getConstraints() {\n+        Constraints.Builder constraints = new Constraints.Builder();\n+        if (UserPreferences.isAllowMobileEpisodeDownload()) {\n+            constraints.setRequiredNetworkType(NetworkType.CONNECTED);\n+        } else {\n+            constraints.setRequiredNetworkType(NetworkType.UNMETERED);\n+        }\n+        return constraints.build();\n     }\n \n+    @Override\n     public void cancel(Context context, String url) {\n-        if (!DownloadService.isRunning) {\n-            return;\n-        }\n-        Intent cancelIntent = new Intent(DownloadService.ACTION_CANCEL_DOWNLOAD);\n-        cancelIntent.putExtra(DownloadService.EXTRA_DOWNLOAD_URL, url);\n-        cancelIntent.setPackage(context.getPackageName());\n-        context.sendBroadcast(cancelIntent);\n+        WorkManager.getInstance(context).cancelAllWorkByTag(WORK_TAG_EPISODE_URL + url);\n     }\n \n+    @Override\n     public void cancelAll(Context context) {\n-        if (!DownloadService.isRunning) {\n-            return;\n-        }\n-        Intent cancelIntent = new Intent(DownloadService.ACTION_CANCEL_ALL_DOWNLOADS);\n-        cancelIntent.setPackage(context.getPackageName());\n-        context.sendBroadcast(cancelIntent);\n+        WorkManager.getInstance(context).cancelAllWorkByTag(WORK_TAG);\n     }\n }\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceNotification.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceNotification.java\ndeleted file mode 100644\nindex b9846c06c0..0000000000\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceNotification.java\n+++ /dev/null\n@@ -1,306 +0,0 @@\n-package de.danoeh.antennapod.core.service.download;\n-\n-import android.app.Notification;\n-import android.app.NotificationManager;\n-import android.app.PendingIntent;\n-import android.content.Context;\n-import android.content.Intent;\n-import android.os.Build;\n-import android.util.Log;\n-import androidx.core.app.NotificationCompat;\n-import de.danoeh.antennapod.core.R;\n-import de.danoeh.antennapod.core.util.DownloadErrorLabel;\n-import de.danoeh.antennapod.model.download.DownloadStatus;\n-import de.danoeh.antennapod.model.feed.Feed;\n-import de.danoeh.antennapod.model.feed.FeedMedia;\n-import de.danoeh.antennapod.core.util.gui.NotificationUtils;\n-import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n-import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n-import de.danoeh.antennapod.ui.appstartintent.DownloadAuthenticationActivityStarter;\n-import de.danoeh.antennapod.ui.appstartintent.MainActivityStarter;\n-\n-import java.util.List;\n-\n-public class DownloadServiceNotification {\n-    private static final String TAG = \"DownloadSvcNotification\";\n-\n-    private final Context context;\n-    private NotificationCompat.Builder notificationCompatBuilder;\n-\n-    public DownloadServiceNotification(Context context) {\n-        this.context = context;\n-        setupNotificationBuilders();\n-    }\n-\n-    private void setupNotificationBuilders() {\n-        notificationCompatBuilder = new NotificationCompat.Builder(context, NotificationUtils.CHANNEL_ID_DOWNLOADING)\n-                .setOngoing(false)\n-                .setWhen(0)\n-                .setOnlyAlertOnce(true)\n-                .setShowWhen(false)\n-                .setContentIntent(getNotificationContentIntent(context))\n-                .setSmallIcon(R.drawable.ic_notification_sync)\n-                .setVisibility(NotificationCompat.VISIBILITY_PUBLIC);\n-        Log.d(TAG, \"Notification set up\");\n-    }\n-\n-    /**\n-     * Updates the contents of the service's notifications. Should be called\n-     * after setupNotificationBuilders.\n-     */\n-    public Notification updateNotifications(List<Downloader> downloads) {\n-        if (notificationCompatBuilder == null) {\n-            return null;\n-        }\n-\n-        String contentTitle;\n-        if (typeIsOnly(downloads, Feed.FEEDFILETYPE_FEED)) {\n-            contentTitle = context.getString(R.string.download_notification_title_feeds);\n-        } else if (typeIsOnly(downloads, FeedMedia.FEEDFILETYPE_FEEDMEDIA)) {\n-            contentTitle = context.getString(R.string.download_notification_title_episodes);\n-        } else {\n-            contentTitle = context.getString(R.string.download_notification_title);\n-        }\n-\n-        int numDownloads = getNumberOfRunningDownloads(downloads);\n-        String contentText = context.getString(R.string.completing);\n-        String bigText = context.getString(R.string.completing);\n-        notificationCompatBuilder.clearActions();\n-        if (numDownloads > 0) {\n-            bigText = compileNotificationString(downloads);\n-            if (numDownloads == 1) {\n-                contentText = bigText;\n-            } else {\n-                contentText = context.getResources().getQuantityString(R.plurals.downloads_left,\n-                        numDownloads, numDownloads);\n-            }\n-\n-            Intent cancelDownloadsIntent = new Intent(DownloadService.ACTION_CANCEL_ALL_DOWNLOADS);\n-            cancelDownloadsIntent.setPackage(context.getPackageName());\n-            PendingIntent cancelPendingIntent = PendingIntent.getBroadcast(context,\n-                    R.id.pending_intent_download_cancel_all, cancelDownloadsIntent, PendingIntent.FLAG_UPDATE_CURRENT\n-                            | (Build.VERSION.SDK_INT >= 23 ? PendingIntent.FLAG_IMMUTABLE : 0));\n-            notificationCompatBuilder.addAction(new NotificationCompat.Action(\n-                    R.drawable.ic_notification_cancel, context.getString(R.string.cancel_label), cancelPendingIntent));\n-        }\n-\n-        notificationCompatBuilder.setContentTitle(contentTitle);\n-        notificationCompatBuilder.setContentText(contentText);\n-        notificationCompatBuilder.setStyle(new NotificationCompat.BigTextStyle().bigText(bigText));\n-        return notificationCompatBuilder.build();\n-    }\n-\n-    private int getNumberOfRunningDownloads(List<Downloader> downloads) {\n-        int running = 0;\n-        for (Downloader downloader : downloads) {\n-            if (!downloader.cancelled && !downloader.isFinished()) {\n-                running++;\n-            }\n-        }\n-        return running;\n-    }\n-\n-    private boolean typeIsOnly(List<Downloader> downloads, int feedFileType) {\n-        for (Downloader downloader : downloads) {\n-            if (downloader.cancelled) {\n-                continue;\n-            }\n-            DownloadRequest request = downloader.getDownloadRequest();\n-            if (request.getFeedfileType() != feedFileType) {\n-                return false;\n-            }\n-        }\n-        return true;\n-    }\n-\n-    private static String compileNotificationString(List<Downloader> downloads) {\n-        StringBuilder stringBuilder = new StringBuilder();\n-        for (int i = 0; i < downloads.size(); i++) {\n-            Downloader downloader = downloads.get(i);\n-            if (downloader.cancelled) {\n-                continue;\n-            }\n-            stringBuilder.append(\"\u2022 \");\n-            DownloadRequest request = downloader.getDownloadRequest();\n-            if (request.getTitle() != null) {\n-                stringBuilder.append(request.getTitle());\n-            } else {\n-                stringBuilder.append(request.getSource());\n-            }\n-            if (request.getFeedfileType() == FeedMedia.FEEDFILETYPE_FEEDMEDIA) {\n-                stringBuilder.append(\" (\").append(request.getProgressPercent()).append(\"%)\");\n-            } else if (request.getSource().startsWith(Feed.PREFIX_LOCAL_FOLDER)) {\n-                stringBuilder.append(\" (\").append(request.getSoFar())\n-                        .append(\"/\").append(request.getSize()).append(\")\");\n-            }\n-            if (i != downloads.size() - 1) {\n-                stringBuilder.append(\"\\n\");\n-            }\n-        }\n-        return stringBuilder.toString();\n-    }\n-\n-    private static String createAutoDownloadNotificationContent(List<DownloadStatus> statuses) {\n-        int length = statuses.size();\n-        StringBuilder sb = new StringBuilder();\n-\n-        for (int i = 0; i < length; i++) {\n-            sb.append(\"\u2022 \").append(statuses.get(i).getTitle());\n-            if (i != length - 1) {\n-                sb.append(\"\\n\");\n-            }\n-        }\n-\n-        return sb.toString();\n-    }\n-\n-    private String createFailedDownloadNotificationContent(List<DownloadStatus> statuses) {\n-        StringBuilder sb = new StringBuilder();\n-\n-        for (int i = 0; i < statuses.size(); i++) {\n-            if (statuses.get(i) == null || statuses.get(i).isSuccessful()) {\n-                continue;\n-            }\n-            sb.append(\"\u2022 \").append(statuses.get(i).getTitle());\n-            if (statuses.get(i).getReason() != null) {\n-                sb.append(\": \").append(context.getString(DownloadErrorLabel.from(statuses.get(i).getReason())));\n-            }\n-            if (i != statuses.size() - 1) {\n-                sb.append(\"\\n\");\n-            }\n-        }\n-\n-        return sb.toString();\n-    }\n-\n-    /**\n-     * Creates a notification at the end of the service lifecycle to notify the\n-     * user about the number of completed downloads. A report will only be\n-     * created if there is at least one failed download excluding images\n-     */\n-    public void updateReport(List<DownloadStatus> reportQueue, boolean showAutoDownloadReport,\n-                             List<DownloadRequest> failedRequests) {\n-        // check if report should be created\n-        boolean createReport = false;\n-        int failedDownloads = 0;\n-\n-        // a download report is created if at least one download has failed\n-        // (excluding failed image downloads)\n-        for (DownloadStatus status : reportQueue) {\n-            if (status == null || status.isCancelled()) {\n-                continue;\n-            }\n-            if (status.isSuccessful()) {\n-                createReport |= showAutoDownloadReport && !status.isInitiatedByUser()\n-                        && status.getFeedfileType() == FeedMedia.FEEDFILETYPE_FEEDMEDIA;\n-            } else {\n-                failedDownloads++;\n-                createReport = true;\n-            }\n-        }\n-\n-        if (!createReport) {\n-            Log.d(TAG, \"No report is created\");\n-            return;\n-        }\n-        Log.d(TAG, \"Creating report\");\n-        if (failedDownloads == 0) {\n-            createAutoDownloadReportNotification(reportQueue);\n-        } else {\n-            createDownloadFailedNotification(reportQueue, failedRequests);\n-        }\n-        Log.d(TAG, \"Download report notification was posted\");\n-    }\n-\n-    private void createAutoDownloadReportNotification(List<DownloadStatus> reportQueue) {\n-        PendingIntent intent = getAutoDownloadReportNotificationContentIntent(context);\n-        String content = createAutoDownloadNotificationContent(reportQueue);\n-        NotificationCompat.Builder builder = new NotificationCompat.Builder(context,\n-                NotificationUtils.CHANNEL_ID_AUTO_DOWNLOAD);\n-        builder.setTicker(context.getString(R.string.auto_download_report_title))\n-                .setContentTitle(context.getString(R.string.auto_download_report_title))\n-                .setContentText(content)\n-                .setStyle(new NotificationCompat.BigTextStyle().bigText(content))\n-                .setSmallIcon(R.drawable.ic_notification_new)\n-                .setContentIntent(intent)\n-                .setAutoCancel(true)\n-                .setVisibility(NotificationCompat.VISIBILITY_PUBLIC);\n-        NotificationManager nm = (NotificationManager) context.getSystemService(Context.NOTIFICATION_SERVICE);\n-        nm.notify(R.id.notification_auto_download_report, builder.build());\n-    }\n-\n-    private void createDownloadFailedNotification(List<DownloadStatus> reportQueue,\n-                                                  List<DownloadRequest> failedRequests) {\n-        Intent retryIntent = DownloadServiceInterface.get().makeDownloadIntent(context,\n-                false, failedRequests.toArray(new DownloadRequest[0]));\n-        PendingIntent retryPendingIntent = null;\n-        if (retryIntent != null && Build.VERSION.SDK_INT >= 26) {\n-            retryPendingIntent = PendingIntent.getForegroundService(context, R.id.pending_intent_download_service_retry,\n-                    retryIntent, PendingIntent.FLAG_UPDATE_CURRENT | PendingIntent.FLAG_IMMUTABLE);\n-        } else if (retryIntent != null) {\n-            retryPendingIntent = PendingIntent.getService(context,\n-                    R.id.pending_intent_download_service_retry, retryIntent,\n-                    PendingIntent.FLAG_UPDATE_CURRENT\n-                            | (Build.VERSION.SDK_INT >= 23 ? PendingIntent.FLAG_IMMUTABLE : 0));\n-        }\n-        PendingIntent intent = getReportNotificationContentIntent(context);\n-        String content = createFailedDownloadNotificationContent(reportQueue);\n-        NotificationCompat.Builder builder = new NotificationCompat.Builder(context,\n-                NotificationUtils.CHANNEL_ID_DOWNLOAD_ERROR);\n-        builder.setTicker(context.getString(R.string.download_report_title))\n-                .setContentTitle(context.getString(R.string.download_report_title))\n-                .setContentText(content)\n-                .setStyle(new NotificationCompat.BigTextStyle().bigText(content))\n-                .setSmallIcon(R.drawable.ic_notification_sync_error)\n-                .setContentIntent(intent)\n-                .setAutoCancel(true);\n-        if (retryPendingIntent != null) {\n-            builder.addAction(new NotificationCompat.Action(\n-                    R.drawable.ic_notification_sync, context.getString(R.string.retry_label), retryPendingIntent));\n-        }\n-        builder.setVisibility(NotificationCompat.VISIBILITY_PUBLIC);\n-        NotificationManager nm = (NotificationManager) context.getSystemService(Context.NOTIFICATION_SERVICE);\n-        nm.notify(R.id.notification_download_report, builder.build());\n-    }\n-\n-    public void postAuthenticationNotification(final DownloadRequest downloadRequest) {\n-        final String resourceTitle = (downloadRequest.getTitle() != null) ?\n-                downloadRequest.getTitle() : downloadRequest.getSource();\n-\n-        NotificationCompat.Builder builder = new NotificationCompat.Builder(context, NotificationUtils.CHANNEL_ID_USER_ACTION);\n-        builder.setTicker(context.getText(R.string.authentication_notification_title))\n-                .setContentTitle(context.getText(R.string.authentication_notification_title))\n-                .setContentText(context.getText(R.string.authentication_notification_msg))\n-                .setStyle(new NotificationCompat.BigTextStyle().bigText(context.getText(R.string.authentication_notification_msg)\n-                        + \": \" + resourceTitle))\n-                .setSmallIcon(R.drawable.ic_notification_key)\n-                .setAutoCancel(true)\n-                .setContentIntent(new DownloadAuthenticationActivityStarter(\n-                        context, downloadRequest.getFeedfileId(), downloadRequest).getPendingIntent());\n-        builder.setVisibility(NotificationCompat.VISIBILITY_PUBLIC);\n-        NotificationManager nm = (NotificationManager) context.getSystemService(Context.NOTIFICATION_SERVICE);\n-        nm.notify(downloadRequest.getSource().hashCode(), builder.build());\n-    }\n-\n-    public PendingIntent getReportNotificationContentIntent(Context context) {\n-        Intent intent = new MainActivityStarter(context)\n-                .withFragmentLoaded(\"DownloadsFragment\")\n-                .withFragmentArgs(\"show_logs\", true)\n-                .getIntent();\n-        return PendingIntent.getActivity(context, R.id.pending_intent_download_service_report, intent,\n-                PendingIntent.FLAG_UPDATE_CURRENT | (Build.VERSION.SDK_INT >= 23 ? PendingIntent.FLAG_IMMUTABLE : 0));\n-    }\n-\n-    public PendingIntent getAutoDownloadReportNotificationContentIntent(Context context) {\n-        Intent intent = new MainActivityStarter(context).withFragmentLoaded(\"QueueFragment\").getIntent();\n-        return PendingIntent.getActivity(context, R.id.pending_intent_download_service_autodownload_report, intent,\n-                PendingIntent.FLAG_UPDATE_CURRENT | (Build.VERSION.SDK_INT >= 23 ? PendingIntent.FLAG_IMMUTABLE : 0));\n-    }\n-\n-    public PendingIntent getNotificationContentIntent(Context context) {\n-        Intent intent = new MainActivityStarter(context).withFragmentLoaded(\"DownloadsFragment\").getIntent();\n-        return PendingIntent.getActivity(context,\n-                R.id.pending_intent_download_service_notification, intent,\n-                PendingIntent.FLAG_UPDATE_CURRENT | (Build.VERSION.SDK_INT >= 23 ? PendingIntent.FLAG_IMMUTABLE : 0));\n-    }\n-}\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/Downloader.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/Downloader.java\nindex f7f5e8e9c1..35247509d0 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/Downloader.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/download/Downloader.java\n@@ -9,7 +9,7 @@\n \n import de.danoeh.antennapod.core.ClientConfig;\n import de.danoeh.antennapod.core.R;\n-import de.danoeh.antennapod.model.download.DownloadStatus;\n+import de.danoeh.antennapod.model.download.DownloadResult;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n \n /**\n@@ -25,15 +25,15 @@ public abstract class Downloader implements Callable<Downloader> {\n     @NonNull\n     final DownloadRequest request;\n     @NonNull\n-    final DownloadStatus result;\n+    final DownloadResult result;\n \n     Downloader(@NonNull DownloadRequest request) {\n         super();\n         this.request = request;\n         this.request.setStatusMsg(R.string.download_pending);\n         this.cancelled = false;\n-        this.result = new DownloadStatus(0, request.getTitle(), request.getFeedfileId(), request.getFeedfileType(),\n-                false, cancelled, false, null, new Date(), null, request.isInitiatedByUser());\n+        this.result = new DownloadResult(0, request.getTitle(), request.getFeedfileId(), request.getFeedfileType(),\n+                false, null, new Date(), null);\n     }\n \n     protected abstract void download();\n@@ -63,7 +63,7 @@ public DownloadRequest getDownloadRequest() {\n     }\n \n     @NonNull\n-    public DownloadStatus getResult() {\n+    public DownloadResult getResult() {\n         return result;\n     }\n \ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/EpisodeDownloadWorker.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/EpisodeDownloadWorker.java\nnew file mode 100644\nindex 0000000000..c428bc861e\n--- /dev/null\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/download/EpisodeDownloadWorker.java\n@@ -0,0 +1,265 @@\n+package de.danoeh.antennapod.core.service.download;\n+\n+import android.app.NotificationManager;\n+import android.app.PendingIntent;\n+import android.content.Context;\n+import android.content.Intent;\n+import android.os.Build;\n+import android.util.Log;\n+import androidx.annotation.NonNull;\n+import androidx.core.app.NotificationCompat;\n+import androidx.work.Data;\n+import androidx.work.Worker;\n+import androidx.work.WorkerParameters;\n+import de.danoeh.antennapod.core.ClientConfigurator;\n+import de.danoeh.antennapod.core.R;\n+import de.danoeh.antennapod.core.service.download.handler.MediaDownloadedHandler;\n+import de.danoeh.antennapod.core.storage.DBReader;\n+import de.danoeh.antennapod.core.storage.DBWriter;\n+import de.danoeh.antennapod.core.util.gui.NotificationUtils;\n+import de.danoeh.antennapod.event.MessageEvent;\n+import de.danoeh.antennapod.model.download.DownloadError;\n+import de.danoeh.antennapod.model.download.DownloadResult;\n+import de.danoeh.antennapod.model.feed.FeedMedia;\n+import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n+import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n+import de.danoeh.antennapod.ui.appstartintent.MainActivityStarter;\n+import org.apache.commons.io.FileUtils;\n+import org.greenrobot.eventbus.EventBus;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.HashMap;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.concurrent.ExecutionException;\n+\n+public class EpisodeDownloadWorker extends Worker {\n+    private static final String TAG = \"EpisodeDownloadWorker\";\n+    private static final Map<String, Integer> notificationProgress = new HashMap<>();\n+\n+    private Downloader downloader = null;\n+\n+    public EpisodeDownloadWorker(@NonNull Context context, @NonNull WorkerParameters params) {\n+        super(context, params);\n+    }\n+\n+    @Override\n+    @NonNull\n+    public Result doWork() {\n+        ClientConfigurator.initialize(getApplicationContext());\n+        long mediaId = getInputData().getLong(DownloadServiceInterface.WORK_DATA_MEDIA_ID, 0);\n+        FeedMedia media = DBReader.getFeedMedia(mediaId);\n+        if (media == null) {\n+            return Result.failure();\n+        }\n+\n+        DownloadRequest request = DownloadRequestCreator.create(media).build();\n+        Thread progressUpdaterThread = new Thread() {\n+            @Override\n+            public void run() {\n+                while (!isInterrupted()) {\n+                    try {\n+                        Thread.sleep(1000);\n+                        notificationProgress.put(media.getEpisodeTitle(), request.getProgressPercent());\n+                        setProgressAsync(\n+                                new Data.Builder()\n+                                    .putInt(DownloadServiceInterface.WORK_DATA_PROGRESS, request.getProgressPercent())\n+                                    .build())\n+                                .get();\n+                        sendProgressNotification();\n+                    } catch (InterruptedException | ExecutionException e) {\n+                        return;\n+                    }\n+                }\n+            }\n+        };\n+        progressUpdaterThread.start();\n+        final Result result = performDownload(media, request);\n+        progressUpdaterThread.interrupt();\n+        try {\n+            progressUpdaterThread.join();\n+        } catch (InterruptedException e) {\n+            e.printStackTrace();\n+        }\n+        notificationProgress.remove(media.getEpisodeTitle());\n+        if (notificationProgress.isEmpty()) {\n+            NotificationManager nm = (NotificationManager) getApplicationContext()\n+                    .getSystemService(Context.NOTIFICATION_SERVICE);\n+            nm.cancel(R.id.notification_downloading);\n+        }\n+        Log.d(TAG, \"Worker for \" + media.getDownload_url() + \" returned.\");\n+        return result;\n+    }\n+\n+    @Override\n+    public void onStopped() {\n+        super.onStopped();\n+        if (downloader != null) {\n+            downloader.cancel();\n+        }\n+    }\n+\n+    private Result performDownload(FeedMedia media, DownloadRequest request) {\n+        File dest = new File(request.getDestination());\n+        if (!dest.exists()) {\n+            try {\n+                dest.createNewFile();\n+            } catch (IOException e) {\n+                Log.e(TAG, \"Unable to create file\");\n+            }\n+        }\n+\n+        if (dest.exists()) {\n+            media.setFile_url(request.getDestination());\n+            try {\n+                DBWriter.setFeedMedia(media).get();\n+            } catch (Exception e) {\n+                Log.e(TAG, \"ExecutionException in writeFileUrl: \" + e.getMessage());\n+            }\n+        }\n+\n+        downloader = new DefaultDownloaderFactory().create(request);\n+        if (downloader == null) {\n+            Log.d(TAG, \"Unable to create downloader\");\n+            return Result.failure();\n+        }\n+\n+        try {\n+            downloader.call();\n+        } catch (Exception e) {\n+            DBWriter.addDownloadStatus(downloader.getResult());\n+            if (EventBus.getDefault().hasSubscriberForEvent(MessageEvent.class)) {\n+                sendMessage(request.getTitle(), false);\n+            } else {\n+                sendErrorNotification();\n+            }\n+            return Result.failure();\n+        }\n+\n+        if (downloader.cancelled) {\n+            if (getInputData().getBoolean(DownloadServiceInterface.WORK_DATA_WAS_QUEUED, false)) {\n+                try {\n+                    DBWriter.removeQueueItem(getApplicationContext(), false, media.getItem()).get();\n+                } catch (ExecutionException | InterruptedException e) {\n+                    e.printStackTrace();\n+                }\n+            }\n+            return Result.success();\n+        }\n+\n+        DownloadResult status = downloader.getResult();\n+        if (status.isSuccessful()) {\n+            MediaDownloadedHandler handler = new MediaDownloadedHandler(\n+                    getApplicationContext(), downloader.getResult(), request);\n+            handler.run();\n+            DBWriter.addDownloadStatus(handler.getUpdatedStatus());\n+            return Result.success();\n+        }\n+\n+        if (status.getReason() == DownloadError.ERROR_HTTP_DATA_ERROR\n+                && Integer.parseInt(status.getReasonDetailed()) == 416) {\n+            Log.d(TAG, \"Requested invalid range, restarting download from the beginning\");\n+            FileUtils.deleteQuietly(new File(downloader.getDownloadRequest().getDestination()));\n+            sendMessage(request.getTitle(), true);\n+            return retry3times();\n+        }\n+\n+        Log.e(TAG, \"Download failed\");\n+        DBWriter.addDownloadStatus(status);\n+        if (status.getReason() == DownloadError.ERROR_FORBIDDEN\n+                || status.getReason() == DownloadError.ERROR_NOT_FOUND\n+                || status.getReason() == DownloadError.ERROR_UNAUTHORIZED\n+                || status.getReason() == DownloadError.ERROR_IO_BLOCKED) {\n+            // Fail fast, these are probably unrecoverable\n+            if (EventBus.getDefault().hasSubscriberForEvent(MessageEvent.class)) {\n+                sendMessage(request.getTitle(), false);\n+            } else {\n+                sendErrorNotification();\n+            }\n+            return Result.failure();\n+        }\n+        sendMessage(request.getTitle(), true);\n+        return retry3times();\n+    }\n+\n+    private Result retry3times() {\n+        if (getRunAttemptCount() < 2) {\n+            return Result.retry();\n+        } else {\n+            sendErrorNotification();\n+            return Result.failure();\n+        }\n+    }\n+\n+    private void sendMessage(String episodeTitle, boolean retrying) {\n+        if (episodeTitle.length() > 20) {\n+            episodeTitle = episodeTitle.substring(0, 19) + \"\u2026\";\n+        }\n+        EventBus.getDefault().post(new MessageEvent(\n+                    getApplicationContext().getString(\n+                            retrying ? R.string.download_error_retrying : R.string.download_error_not_retrying,\n+                            episodeTitle), (ctx) -> new MainActivityStarter(ctx).withDownloadLogsOpen().start(),\n+                getApplicationContext().getString(R.string.download_error_details)));\n+    }\n+\n+    private PendingIntent getDownloadLogsIntent(Context context) {\n+        Intent intent = new MainActivityStarter(context).withDownloadLogsOpen().getIntent();\n+        return PendingIntent.getActivity(context, R.id.pending_intent_download_service_report, intent,\n+                PendingIntent.FLAG_UPDATE_CURRENT | (Build.VERSION.SDK_INT >= 23 ? PendingIntent.FLAG_IMMUTABLE : 0));\n+    }\n+\n+    private PendingIntent getDownloadsIntent(Context context) {\n+        Intent intent = new MainActivityStarter(context).withFragmentLoaded(\"DownloadsFragment\").getIntent();\n+        return PendingIntent.getActivity(context, R.id.pending_intent_download_service_notification, intent,\n+                PendingIntent.FLAG_UPDATE_CURRENT | (Build.VERSION.SDK_INT >= 23 ? PendingIntent.FLAG_IMMUTABLE : 0));\n+    }\n+\n+    private void sendErrorNotification() {\n+        NotificationCompat.Builder builder = new NotificationCompat.Builder(getApplicationContext(),\n+                NotificationUtils.CHANNEL_ID_DOWNLOAD_ERROR);\n+        builder.setTicker(getApplicationContext().getString(R.string.download_report_title))\n+                .setContentTitle(getApplicationContext().getString(R.string.download_report_title))\n+                .setContentText(getApplicationContext().getString(R.string.download_error_tap_for_details))\n+                .setSmallIcon(R.drawable.ic_notification_sync_error)\n+                .setContentIntent(getDownloadLogsIntent(getApplicationContext()))\n+                .setAutoCancel(true);\n+        builder.setVisibility(NotificationCompat.VISIBILITY_PUBLIC);\n+        NotificationManager nm = (NotificationManager) getApplicationContext()\n+                .getSystemService(Context.NOTIFICATION_SERVICE);\n+        nm.notify(R.id.notification_download_report, builder.build());\n+    }\n+\n+    private void sendProgressNotification() {\n+        StringBuilder bigTextB = new StringBuilder();\n+        Map<String, Integer> progressCopy = new HashMap<>(notificationProgress);\n+        for (Map.Entry<String, Integer> entry : progressCopy.entrySet()) {\n+            bigTextB.append(String.format(Locale.getDefault(), \"%s (%d%%)\\n\", entry.getKey(), entry.getValue()));\n+        }\n+        String bigText = bigTextB.toString().trim();\n+        String contentText;\n+        if (notificationProgress.size() == 1) {\n+            contentText = bigText;\n+        } else {\n+            contentText = getApplicationContext().getResources().getQuantityString(R.plurals.downloads_left,\n+                    notificationProgress.size(), notificationProgress.size());\n+        }\n+        NotificationCompat.Builder builder = new NotificationCompat.Builder(getApplicationContext(),\n+                NotificationUtils.CHANNEL_ID_DOWNLOADING);\n+        builder.setTicker(getApplicationContext().getString(R.string.download_notification_title_episodes))\n+                .setContentTitle(getApplicationContext().getString(R.string.download_notification_title_episodes))\n+                .setContentText(contentText)\n+                .setStyle(new NotificationCompat.BigTextStyle().bigText(bigText))\n+                .setContentIntent(getDownloadsIntent(getApplicationContext()))\n+                .setAutoCancel(false)\n+                .setOngoing(true)\n+                .setWhen(0)\n+                .setOnlyAlertOnce(true)\n+                .setShowWhen(false)\n+                .setSmallIcon(R.drawable.ic_notification_sync)\n+                .setVisibility(NotificationCompat.VISIBILITY_PUBLIC);\n+        NotificationManager nm = (NotificationManager) getApplicationContext()\n+                .getSystemService(Context.NOTIFICATION_SERVICE);\n+        nm.notify(R.id.notification_downloading, builder.build());\n+    }\n+}\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/HttpDownloader.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/HttpDownloader.java\nindex a0a0615cbf..949f9966b5 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/HttpDownloader.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/download/HttpDownloader.java\n@@ -5,7 +5,7 @@\n import android.util.Log;\n \n import de.danoeh.antennapod.core.util.NetworkUtils;\n-import de.danoeh.antennapod.model.download.DownloadStatus;\n+import de.danoeh.antennapod.model.download.DownloadResult;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n import okhttp3.CacheControl;\n import okhttp3.internal.http.StatusLine;\n@@ -149,12 +149,12 @@ && isContentTypeTextAndSmallerThan100kb(response)) {\n             request.setSize(responseBody.contentLength() + request.getSoFar());\n             Log.d(TAG, \"Size is \" + request.getSize());\n             if (request.getSize() < 0) {\n-                request.setSize(DownloadStatus.SIZE_UNKNOWN);\n+                request.setSize(DownloadResult.SIZE_UNKNOWN);\n             }\n \n             long freeSpace = StorageUtils.getFreeSpaceAvailable();\n             Log.d(TAG, \"Free space is \" + freeSpace);\n-            if (request.getSize() != DownloadStatus.SIZE_UNKNOWN && request.getSize() > freeSpace) {\n+            if (request.getSize() != DownloadResult.SIZE_UNKNOWN && request.getSize() > freeSpace) {\n                 onFail(DownloadError.ERROR_NOT_ENOUGH_SPACE, null);\n                 return;\n             }\n@@ -175,7 +175,7 @@ && isContentTypeTextAndSmallerThan100kb(response)) {\n             } else {\n                 // check if size specified in the response header is the same as the size of the\n                 // written file. This check cannot be made if compression was used\n-                if (!isGzip && request.getSize() != DownloadStatus.SIZE_UNKNOWN\n+                if (!isGzip && request.getSize() != DownloadResult.SIZE_UNKNOWN\n                         && request.getSoFar() != request.getSize()) {\n                     onFail(DownloadError.ERROR_IO_WRONG_SIZE, \"Download completed but size: \"\n                             + request.getSoFar() + \" does not equal expected size \" + request.getSize());\n@@ -267,7 +267,8 @@ private void callOnFailByResponseCode(Response response) {\n         } else if (response.code() == HttpURLConnection.HTTP_FORBIDDEN) {\n             error = DownloadError.ERROR_FORBIDDEN;\n             details = String.valueOf(response.code());\n-        } else if (response.code() == HttpURLConnection.HTTP_NOT_FOUND) {\n+        } else if (response.code() == HttpURLConnection.HTTP_NOT_FOUND\n+                || response.code() == HttpURLConnection.HTTP_GONE) {\n             error = DownloadError.ERROR_NOT_FOUND;\n             details = String.valueOf(response.code());\n         } else {\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/FailedDownloadHandler.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/FailedDownloadHandler.java\ndeleted file mode 100644\nindex 937f051ec7..0000000000\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/FailedDownloadHandler.java\n+++ /dev/null\n@@ -1,32 +0,0 @@\n-package de.danoeh.antennapod.core.service.download.handler;\n-\n-import android.util.Log;\n-import de.danoeh.antennapod.model.feed.Feed;\n-import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n-import de.danoeh.antennapod.core.storage.DBWriter;\n-\n-/**\n- * Handles failed downloads.\n- * <p/>\n- * If the file has been partially downloaded, this handler will set the file_url of the FeedFile to the location\n- * of the downloaded file.\n- * <p/>\n- * Currently, this handler only handles FeedMedia objects, because Feeds and FeedImages are deleted if the download fails.\n- */\n-public class FailedDownloadHandler implements Runnable {\n-    private static final String TAG = \"FailedDownloadHandler\";\n-    private final DownloadRequest request;\n-\n-    public FailedDownloadHandler(DownloadRequest request) {\n-        this.request = request;\n-    }\n-\n-    @Override\n-    public void run() {\n-        if (request.getFeedfileType() == Feed.FEEDFILETYPE_FEED) {\n-            DBWriter.setFeedLastUpdateFailed(request.getFeedfileId(), true);\n-        } else if (request.isDeleteOnFailure()) {\n-            Log.d(TAG, \"Ignoring failed download, deleteOnFailure=true\");\n-        }\n-    }\n-}\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/FeedParserTask.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/FeedParserTask.java\nindex 1118b93cd9..5da250e15f 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/FeedParserTask.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/FeedParserTask.java\n@@ -8,7 +8,7 @@\n import de.danoeh.antennapod.model.feed.FeedPreferences;\n import de.danoeh.antennapod.model.feed.VolumeAdaptionSetting;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n-import de.danoeh.antennapod.model.download.DownloadStatus;\n+import de.danoeh.antennapod.model.download.DownloadResult;\n import de.danoeh.antennapod.parser.feed.FeedHandler;\n import de.danoeh.antennapod.parser.feed.FeedHandlerResult;\n import de.danoeh.antennapod.parser.feed.UnsupportedFeedtypeException;\n@@ -25,15 +25,15 @@\n public class FeedParserTask implements Callable<FeedHandlerResult> {\n     private static final String TAG = \"FeedParserTask\";\n     private final DownloadRequest request;\n-    private DownloadStatus downloadStatus;\n+    private DownloadResult downloadResult;\n     private boolean successful = true;\n \n     public FeedParserTask(DownloadRequest request) {\n         this.request = request;\n-        downloadStatus = new DownloadStatus(\n+        downloadResult = new DownloadResult(\n         0, request.getTitle(), 0, request.getFeedfileType(), false,\n-                false, true, DownloadError.ERROR_REQUEST_ERROR, new Date(),\n-                \"Unknown error: Status not set\", request.isInitiatedByUser());\n+                DownloadError.ERROR_REQUEST_ERROR, new Date(),\n+                \"Unknown error: Status not set\");\n     }\n \n     @Override\n@@ -87,12 +87,12 @@ public FeedHandlerResult call() {\n         }\n \n         if (successful) {\n-            downloadStatus = new DownloadStatus(feed, feed.getHumanReadableIdentifier(), DownloadError.SUCCESS,\n-                                                successful, reasonDetailed, request.isInitiatedByUser());\n+            downloadResult = new DownloadResult(feed, feed.getHumanReadableIdentifier(), DownloadError.SUCCESS,\n+                                                successful, reasonDetailed);\n             return result;\n         } else {\n-            downloadStatus = new DownloadStatus(feed, feed.getHumanReadableIdentifier(), reason,\n-                                                successful, reasonDetailed, request.isInitiatedByUser());\n+            downloadResult = new DownloadResult(feed, feed.getHumanReadableIdentifier(), reason,\n+                                                successful, reasonDetailed);\n             return null;\n         }\n     }\n@@ -120,7 +120,7 @@ private void checkFeedItems(Feed feed) throws InvalidFeedException  {\n     }\n \n     @NonNull\n-    public DownloadStatus getDownloadStatus() {\n-        return downloadStatus;\n+    public DownloadResult getDownloadStatus() {\n+        return downloadResult;\n     }\n }\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/FeedSyncTask.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/FeedSyncTask.java\nindex 9cb1166b4c..3b72ed1641 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/FeedSyncTask.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/FeedSyncTask.java\n@@ -3,7 +3,7 @@\n import android.content.Context;\n import androidx.annotation.NonNull;\n import de.danoeh.antennapod.core.storage.DBTasks;\n-import de.danoeh.antennapod.model.download.DownloadStatus;\n+import de.danoeh.antennapod.model.download.DownloadResult;\n import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n import de.danoeh.antennapod.parser.feed.FeedHandlerResult;\n@@ -30,7 +30,7 @@ public boolean run() {\n     }\n \n     @NonNull\n-    public DownloadStatus getDownloadStatus() {\n+    public DownloadResult getDownloadStatus() {\n         return task.getDownloadStatus();\n     }\n \ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/MediaDownloadedHandler.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/MediaDownloadedHandler.java\nindex c632bf1e0a..a46b4c6d0d 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/MediaDownloadedHandler.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/MediaDownloadedHandler.java\n@@ -13,7 +13,7 @@\n \n import de.danoeh.antennapod.event.UnreadItemsUpdateEvent;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n-import de.danoeh.antennapod.model.download.DownloadStatus;\n+import de.danoeh.antennapod.model.download.DownloadResult;\n import de.danoeh.antennapod.core.storage.DBReader;\n import de.danoeh.antennapod.core.storage.DBWriter;\n import de.danoeh.antennapod.core.sync.queue.SynchronizationQueueSink;\n@@ -30,9 +30,9 @@ public class MediaDownloadedHandler implements Runnable {\n     private static final String TAG = \"MediaDownloadedHandler\";\n     private final DownloadRequest request;\n     private final Context context;\n-    private DownloadStatus updatedStatus;\n+    private DownloadResult updatedStatus;\n \n-    public MediaDownloadedHandler(@NonNull Context context, @NonNull DownloadStatus status,\n+    public MediaDownloadedHandler(@NonNull Context context, @NonNull DownloadResult status,\n                                   @NonNull DownloadRequest request) {\n         this.request = request;\n         this.context = context;\n@@ -94,8 +94,8 @@ public void run() {\n             Log.e(TAG, \"MediaHandlerThread was interrupted\");\n         } catch (ExecutionException e) {\n             Log.e(TAG, \"ExecutionException in MediaHandlerThread: \" + e.getMessage());\n-            updatedStatus = new DownloadStatus(media, media.getEpisodeTitle(),\n-                    DownloadError.ERROR_DB_ACCESS_ERROR, false, e.getMessage(), request.isInitiatedByUser());\n+            updatedStatus = new DownloadResult(media, media.getEpisodeTitle(),\n+                    DownloadError.ERROR_DB_ACCESS_ERROR, false, e.getMessage());\n         }\n \n         if (item != null) {\n@@ -107,7 +107,7 @@ public void run() {\n     }\n \n     @NonNull\n-    public DownloadStatus getUpdatedStatus() {\n+    public DownloadResult getUpdatedStatus() {\n         return updatedStatus;\n     }\n }\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/PostDownloaderTask.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/PostDownloaderTask.java\ndeleted file mode 100644\nindex 5d2c486790..0000000000\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/PostDownloaderTask.java\n+++ /dev/null\n@@ -1,29 +0,0 @@\n-package de.danoeh.antennapod.core.service.download.handler;\n-\n-import de.danoeh.antennapod.core.event.DownloadEvent;\n-import de.danoeh.antennapod.core.service.download.Downloader;\n-import org.greenrobot.eventbus.EventBus;\n-\n-import java.util.ArrayList;\n-import java.util.Collections;\n-import java.util.List;\n-\n-public class PostDownloaderTask implements Runnable {\n-    private List<Downloader> downloads;\n-\n-    public PostDownloaderTask(List<Downloader> downloads) {\n-        this.downloads = downloads;\n-    }\n-\n-    @Override\n-    public void run() {\n-        List<Downloader> runningDownloads = new ArrayList<>();\n-        for (Downloader downloader : downloads) {\n-            if (!downloader.cancelled) {\n-                runningDownloads.add(downloader);\n-            }\n-        }\n-        List<Downloader> list = Collections.unmodifiableList(runningDownloads);\n-        EventBus.getDefault().postSticky(DownloadEvent.refresh(list));\n-    }\n-}\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\nindex 42631296ba..6fc9035cac 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n@@ -824,7 +824,7 @@ public void statusChanged(PlaybackServiceMediaPlayer.PSMPInfo newInfo) {\n                             && SleepTimerPreferences.autoEnable() && autoEnableByTime && !sleepTimerActive()) {\n                         setSleepTimer(SleepTimerPreferences.timerMillis());\n                         EventBus.getDefault().post(new MessageEvent(getString(R.string.sleep_timer_enabled_label),\n-                                PlaybackService.this::disableSleepTimer));\n+                                (ctx) -> disableSleepTimer(), getString(R.string.undo)));\n                     }\n                     loadQueueForMediaSession();\n                     break;\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/storage/AutomaticDownloadAlgorithm.java b/core/src/main/java/de/danoeh/antennapod/core/storage/AutomaticDownloadAlgorithm.java\nindex 0f31215517..dbbfba379a 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/storage/AutomaticDownloadAlgorithm.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/storage/AutomaticDownloadAlgorithm.java\n@@ -9,12 +9,10 @@\n \n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n import de.danoeh.antennapod.model.feed.SortOrder;\n-import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n-import de.danoeh.antennapod.core.service.download.DownloadRequestCreator;\n-import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n import de.danoeh.antennapod.core.util.PlaybackStatus;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedPreferences;\n+import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import de.danoeh.antennapod.core.util.NetworkUtils;\n import de.danoeh.antennapod.core.util.PowerUtils;\n@@ -97,13 +95,9 @@ public Runnable autoDownloadUndownloadedItems(final Context context) {\n                 if (itemsToDownload.size() > 0) {\n                     Log.d(TAG, \"Enqueueing \" + itemsToDownload.size() + \" items for download\");\n \n-                    List<DownloadRequest> requests = new ArrayList<>();\n                     for (FeedItem episode : itemsToDownload) {\n-                        DownloadRequest.Builder request = DownloadRequestCreator.create(episode.getMedia());\n-                        request.withInitiatedByUser(false);\n-                        requests.add(request.build());\n+                        DownloadServiceInterface.get().download(context, episode);\n                     }\n-                    DownloadServiceInterface.get().download(context, false, requests.toArray(new DownloadRequest[0]));\n                 }\n             }\n         };\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/storage/DBReader.java b/core/src/main/java/de/danoeh/antennapod/core/storage/DBReader.java\nindex 94a7334f38..d83557b0c7 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/storage/DBReader.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/storage/DBReader.java\n@@ -16,10 +16,9 @@\n import java.util.Map;\n \n import de.danoeh.antennapod.core.util.LongList;\n-import de.danoeh.antennapod.core.util.comparator.DownloadStatusComparator;\n+import de.danoeh.antennapod.core.util.comparator.DownloadResultComparator;\n import de.danoeh.antennapod.core.util.comparator.FeedItemPubdateComparator;\n import de.danoeh.antennapod.core.util.comparator.PlaybackCompletionDateComparator;\n-import de.danoeh.antennapod.model.download.DownloadStatus;\n import de.danoeh.antennapod.model.feed.Chapter;\n import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.model.feed.FeedItem;\n@@ -28,14 +27,15 @@\n import de.danoeh.antennapod.model.feed.FeedPreferences;\n import de.danoeh.antennapod.model.feed.SortOrder;\n import de.danoeh.antennapod.model.feed.SubscriptionsFilter;\n+import de.danoeh.antennapod.storage.preferences.UserPreferences;\n+import de.danoeh.antennapod.model.download.DownloadResult;\n import de.danoeh.antennapod.storage.database.PodDBAdapter;\n import de.danoeh.antennapod.storage.database.mapper.ChapterCursorMapper;\n-import de.danoeh.antennapod.storage.database.mapper.DownloadStatusCursorMapper;\n+import de.danoeh.antennapod.storage.database.mapper.DownloadResultCursorMapper;\n import de.danoeh.antennapod.storage.database.mapper.FeedCursorMapper;\n import de.danoeh.antennapod.storage.database.mapper.FeedItemCursorMapper;\n import de.danoeh.antennapod.storage.database.mapper.FeedMediaCursorMapper;\n import de.danoeh.antennapod.storage.database.mapper.FeedPreferencesCursorMapper;\n-import de.danoeh.antennapod.storage.preferences.UserPreferences;\n \n /**\n  * Provides methods for reading data from the AntennaPod database.\n@@ -394,17 +394,17 @@ public static long getPlaybackHistoryLength() {\n      * @return A list with DownloadStatus objects that represent the download log.\n      * The size of the returned list is limited by {@link #DOWNLOAD_LOG_SIZE}.\n      */\n-    public static List<DownloadStatus> getDownloadLog() {\n+    public static List<DownloadResult> getDownloadLog() {\n         Log.d(TAG, \"getDownloadLog() called\");\n \n         PodDBAdapter adapter = PodDBAdapter.getInstance();\n         adapter.open();\n         try (Cursor cursor = adapter.getDownloadLogCursor(DOWNLOAD_LOG_SIZE)) {\n-            List<DownloadStatus> downloadLog = new ArrayList<>(cursor.getCount());\n+            List<DownloadResult> downloadLog = new ArrayList<>(cursor.getCount());\n             while (cursor.moveToNext()) {\n-                downloadLog.add(DownloadStatusCursorMapper.convert(cursor));\n+                downloadLog.add(DownloadResultCursorMapper.convert(cursor));\n             }\n-            Collections.sort(downloadLog, new DownloadStatusComparator());\n+            Collections.sort(downloadLog, new DownloadResultComparator());\n             return downloadLog;\n         } finally {\n             adapter.close();\n@@ -418,17 +418,17 @@ public static List<DownloadStatus> getDownloadLog() {\n      * @return A list with DownloadStatus objects that represent the feed's download log,\n      * newest events first.\n      */\n-    public static List<DownloadStatus> getFeedDownloadLog(long feedId) {\n+    public static List<DownloadResult> getFeedDownloadLog(long feedId) {\n         Log.d(TAG, \"getFeedDownloadLog() called with: \" + \"feed = [\" + feedId + \"]\");\n \n         PodDBAdapter adapter = PodDBAdapter.getInstance();\n         adapter.open();\n         try (Cursor cursor = adapter.getDownloadLog(Feed.FEEDFILETYPE_FEED, feedId)) {\n-            List<DownloadStatus> downloadLog = new ArrayList<>(cursor.getCount());\n+            List<DownloadResult> downloadLog = new ArrayList<>(cursor.getCount());\n             while (cursor.moveToNext()) {\n-                downloadLog.add(DownloadStatusCursorMapper.convert(cursor));\n+                downloadLog.add(DownloadResultCursorMapper.convert(cursor));\n             }\n-            Collections.sort(downloadLog, new DownloadStatusComparator());\n+            Collections.sort(downloadLog, new DownloadResultComparator());\n             return downloadLog;\n         } finally {\n             adapter.close();\n@@ -717,10 +717,10 @@ public static FeedMedia getFeedMedia(final long mediaId) {\n         }\n     }\n \n-    public static List<FeedItem> getFeedItemsWithMedia(Long[] mediaIds) {\n+    public static List<FeedItem> getFeedItemsWithUrl(List<String> urls) {\n         PodDBAdapter adapter = PodDBAdapter.getInstance();\n         adapter.open();\n-        try (Cursor itemCursor = adapter.getFeedItemCursorByMediaIds(mediaIds)) {\n+        try (Cursor itemCursor = adapter.getFeedItemCursorByUrl(urls)) {\n             List<FeedItem> items = extractItemlistFromCursor(adapter, itemCursor);\n             loadAdditionalFeedItemListData(items);\n             Collections.sort(items, new PlaybackCompletionDateComparator());\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/storage/DBTasks.java b/core/src/main/java/de/danoeh/antennapod/core/storage/DBTasks.java\nindex 8b79d594c6..e3ac7a7e18 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/storage/DBTasks.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/storage/DBTasks.java\n@@ -7,14 +7,13 @@\n import androidx.annotation.VisibleForTesting;\n import de.danoeh.antennapod.core.R;\n import de.danoeh.antennapod.core.sync.queue.SynchronizationQueueSink;\n-import de.danoeh.antennapod.core.util.LongList;\n import de.danoeh.antennapod.core.util.comparator.FeedItemPubdateComparator;\n import de.danoeh.antennapod.core.util.download.FeedUpdateManager;\n import de.danoeh.antennapod.event.FeedItemEvent;\n import de.danoeh.antennapod.event.FeedListUpdateEvent;\n import de.danoeh.antennapod.event.MessageEvent;\n import de.danoeh.antennapod.model.download.DownloadError;\n-import de.danoeh.antennapod.model.download.DownloadStatus;\n+import de.danoeh.antennapod.model.download.DownloadResult;\n import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedMedia;\n@@ -114,21 +113,6 @@ public static void notifyMissingFeedMediaFile(final Context context, final FeedM\n         EventBus.getDefault().post(new MessageEvent(context.getString(R.string.error_file_not_found)));\n     }\n \n-    public static List<FeedItem> enqueueFeedItemsToDownload(final Context context,\n-                       List<FeedItem> items) throws InterruptedException, ExecutionException {\n-        List<FeedItem> itemsToEnqueue = new ArrayList<>();\n-        if (UserPreferences.enqueueDownloadedEpisodes()) {\n-            LongList queueIDList = DBReader.getQueueIDList();\n-            for (FeedItem item : items) {\n-                if (!queueIDList.contains(item.getId())) {\n-                    itemsToEnqueue.add(item);\n-                }\n-            }\n-            DBWriter.addQueueItem(context, false, itemsToEnqueue.toArray(new FeedItem[0])).get();\n-        }\n-        return itemsToEnqueue;\n-    }\n-\n     /**\n      * Looks for non-downloaded episodes in the queue or list of unread items and request a download if\n      * 1. Network is available\n@@ -267,13 +251,13 @@ public static synchronized Feed updateFeed(Context context, Feed newFeed, boolea\n                 FeedItem possibleDuplicate = searchFeedItemGuessDuplicate(newFeed.getItems(), item);\n                 if (!newFeed.isLocalFeed() && possibleDuplicate != null && item != possibleDuplicate) {\n                     // Canonical episode is the first one returned (usually oldest)\n-                    DBWriter.addDownloadStatus(new DownloadStatus(savedFeed,\n+                    DBWriter.addDownloadStatus(new DownloadResult(savedFeed,\n                             item.getTitle(), DownloadError.ERROR_PARSER_EXCEPTION_DUPLICATE, false,\n                             \"The podcast host appears to have added the same episode twice. \"\n                                     + \"AntennaPod still refreshed the feed and attempted to repair it.\"\n                                     + \"\\n\\nOriginal episode:\\n\" + duplicateEpisodeDetails(item)\n                                     + \"\\n\\nSecond episode that is also in the feed:\\n\"\n-                                    + duplicateEpisodeDetails(possibleDuplicate), false));\n+                                    + duplicateEpisodeDetails(possibleDuplicate)));\n                     continue;\n                 }\n \n@@ -282,13 +266,13 @@ public static synchronized Feed updateFeed(Context context, Feed newFeed, boolea\n                     oldItem = searchFeedItemGuessDuplicate(savedFeed.getItems(), item);\n                     if (oldItem != null) {\n                         Log.d(TAG, \"Repaired duplicate: \" + oldItem + \", \" + item);\n-                        DBWriter.addDownloadStatus(new DownloadStatus(savedFeed,\n+                        DBWriter.addDownloadStatus(new DownloadResult(savedFeed,\n                                 item.getTitle(), DownloadError.ERROR_PARSER_EXCEPTION_DUPLICATE, false,\n                                 \"The podcast host changed the ID of an existing episode instead of just \"\n                                         + \"updating the episode itself. AntennaPod still refreshed the feed and \"\n                                         + \"attempted to repair it.\"\n                                         + \"\\n\\nOriginal episode:\\n\" + duplicateEpisodeDetails(oldItem)\n-                                        + \"\\n\\nNow the feed contains:\\n\" + duplicateEpisodeDetails(item), false));\n+                                        + \"\\n\\nNow the feed contains:\\n\" + duplicateEpisodeDetails(item)));\n                         oldItem.setItemIdentifier(item.getItemIdentifier());\n \n                         if (oldItem.isPlayed() && oldItem.getMedia() != null) {\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/storage/DBWriter.java b/core/src/main/java/de/danoeh/antennapod/core/storage/DBWriter.java\nindex dcee8a45a9..4815737f40 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/storage/DBWriter.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/storage/DBWriter.java\n@@ -36,7 +36,7 @@\n import de.danoeh.antennapod.core.feed.FeedEvent;\n import de.danoeh.antennapod.core.preferences.PlaybackPreferences;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n-import de.danoeh.antennapod.model.download.DownloadStatus;\n+import de.danoeh.antennapod.model.download.DownloadResult;\n import de.danoeh.antennapod.core.sync.queue.SynchronizationQueueSink;\n import de.danoeh.antennapod.core.util.FeedItemPermutors;\n import de.danoeh.antennapod.core.util.IntentUtils;\n@@ -299,7 +299,7 @@ public static Future<?> addItemToPlaybackHistory(final FeedMedia media, Date dat\n      *\n      * @param status The DownloadStatus object.\n      */\n-    public static Future<?> addDownloadStatus(final DownloadStatus status) {\n+    public static Future<?> addDownloadStatus(final DownloadResult status) {\n         return dbExec.submit(() -> {\n             PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/storage/ItemEnqueuePositionCalculator.java b/core/src/main/java/de/danoeh/antennapod/core/storage/ItemEnqueuePositionCalculator.java\nindex b81f281e8f..4ed17c43fc 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/storage/ItemEnqueuePositionCalculator.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/storage/ItemEnqueuePositionCalculator.java\n@@ -8,9 +8,9 @@\n import java.util.List;\n import java.util.Random;\n \n-import de.danoeh.antennapod.core.service.download.DownloadService;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedMedia;\n+import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n import de.danoeh.antennapod.storage.preferences.UserPreferences.EnqueueLocation;\n import de.danoeh.antennapod.model.playback.Playable;\n \n@@ -74,7 +74,7 @@ private boolean isItemAtPositionDownloading(int position, List<FeedItem> curQueu\n         }\n         return curItem != null\n                 && curItem.getMedia() != null\n-                && DownloadService.isDownloadingFile(curItem.getMedia().getDownload_url());\n+                && DownloadServiceInterface.get().isDownloadingEpisode(curItem.getMedia().getDownload_url());\n     }\n \n     private static int getCurrentlyPlayingPosition(@NonNull List<FeedItem> curQueue,\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/util/FeedItemUtil.java b/core/src/main/java/de/danoeh/antennapod/core/util/FeedItemUtil.java\nindex 50b4d411fb..d848b5a307 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/util/FeedItemUtil.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/util/FeedItemUtil.java\n@@ -24,10 +24,10 @@ public static int indexOfItemWithId(List<FeedItem> items, long id) {\n         return -1;\n     }\n \n-    public static int indexOfItemWithMediaId(List<FeedItem> items, long mediaId) {\n-        for(int i=0; i < items.size(); i++) {\n+    public static int indexOfItemWithDownloadUrl(List<FeedItem> items, String downloadUrl) {\n+        for (int i = 0; i < items.size(); i++) {\n             FeedItem item = items.get(i);\n-            if(item != null && item.getMedia() != null && item.getMedia().getId() == mediaId) {\n+            if (item != null && item.getMedia() != null && item.getMedia().getDownload_url().equals(downloadUrl)) {\n                 return i;\n             }\n         }\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/util/comparator/DownloadResultComparator.java b/core/src/main/java/de/danoeh/antennapod/core/util/comparator/DownloadResultComparator.java\nnew file mode 100644\nindex 0000000000..d1d50fc8a6\n--- /dev/null\n+++ b/core/src/main/java/de/danoeh/antennapod/core/util/comparator/DownloadResultComparator.java\n@@ -0,0 +1,14 @@\n+package de.danoeh.antennapod.core.util.comparator;\n+\n+import java.util.Comparator;\n+\n+import de.danoeh.antennapod.model.download.DownloadResult;\n+\n+/** Compares the completion date of two DownloadResult objects. */\n+public class DownloadResultComparator implements Comparator<DownloadResult> {\n+\n+    @Override\n+    public int compare(DownloadResult lhs, DownloadResult rhs) {\n+        return rhs.getCompletionDate().compareTo(lhs.getCompletionDate());\n+    }\n+}\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/util/comparator/DownloadStatusComparator.java b/core/src/main/java/de/danoeh/antennapod/core/util/comparator/DownloadStatusComparator.java\ndeleted file mode 100644\nindex 68b38ec7f0..0000000000\n--- a/core/src/main/java/de/danoeh/antennapod/core/util/comparator/DownloadStatusComparator.java\n+++ /dev/null\n@@ -1,15 +0,0 @@\n-package de.danoeh.antennapod.core.util.comparator;\n-\n-import java.util.Comparator;\n-\n-import de.danoeh.antennapod.model.download.DownloadStatus;\n-\n-/** Compares the completion date of two Downloadstatus objects. */\n-public class DownloadStatusComparator implements Comparator<DownloadStatus> {\n-\n-\t@Override\n-\tpublic int compare(DownloadStatus lhs, DownloadStatus rhs) {\n-\t\treturn rhs.getCompletionDate().compareTo(lhs.getCompletionDate());\n-\t}\n-\n-}\ndiff --git a/event/build.gradle b/event/build.gradle\nindex 033fc5a3c9..b1efac85de 100644\n--- a/event/build.gradle\n+++ b/event/build.gradle\n@@ -5,6 +5,7 @@ apply from: \"../common.gradle\"\n \n dependencies {\n     implementation project(':model')\n+    implementation \"androidx.core:core:$coreVersion\"\n \n     annotationProcessor \"androidx.annotation:annotation:$annotationVersion\"\n }\ndiff --git a/event/src/main/java/de/danoeh/antennapod/event/EpisodeDownloadEvent.java b/event/src/main/java/de/danoeh/antennapod/event/EpisodeDownloadEvent.java\nnew file mode 100644\nindex 0000000000..c9790d18a7\n--- /dev/null\n+++ b/event/src/main/java/de/danoeh/antennapod/event/EpisodeDownloadEvent.java\n@@ -0,0 +1,18 @@\n+package de.danoeh.antennapod.event;\n+\n+import de.danoeh.antennapod.model.download.DownloadStatus;\n+\n+import java.util.Map;\n+import java.util.Set;\n+\n+public class EpisodeDownloadEvent {\n+    private final Map<String, DownloadStatus> map;\n+\n+    public EpisodeDownloadEvent(Map<String, DownloadStatus> map) {\n+        this.map = map;\n+    }\n+\n+    public Set<String> getUrls() {\n+        return map.keySet();\n+    }\n+}\ndiff --git a/event/src/main/java/de/danoeh/antennapod/event/MessageEvent.java b/event/src/main/java/de/danoeh/antennapod/event/MessageEvent.java\nindex 3f6b2db32d..7f1cb20e28 100644\n--- a/event/src/main/java/de/danoeh/antennapod/event/MessageEvent.java\n+++ b/event/src/main/java/de/danoeh/antennapod/event/MessageEvent.java\n@@ -1,21 +1,27 @@\n package de.danoeh.antennapod.event;\n \n+import android.content.Context;\n import androidx.annotation.Nullable;\n \n+import androidx.core.util.Consumer;\n+\n public class MessageEvent {\n \n     public final String message;\n \n     @Nullable\n-    public final Runnable action;\n+    public final Consumer<Context> action;\n+\n+    @Nullable\n+    public final String actionText;\n \n     public MessageEvent(String message) {\n-        this(message, null);\n+        this(message, null, null);\n     }\n \n-    public MessageEvent(String message, Runnable action) {\n+    public MessageEvent(String message, Consumer<Context> action, String actionText) {\n         this.message = message;\n         this.action = action;\n+        this.actionText = actionText;\n     }\n-\n }\ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/download/DownloadResult.java b/model/src/main/java/de/danoeh/antennapod/model/download/DownloadResult.java\nnew file mode 100644\nindex 0000000000..66901cf650\n--- /dev/null\n+++ b/model/src/main/java/de/danoeh/antennapod/model/download/DownloadResult.java\n@@ -0,0 +1,128 @@\n+package de.danoeh.antennapod.model.download;\n+\n+import androidx.annotation.NonNull;\n+\n+import java.util.Date;\n+\n+import de.danoeh.antennapod.model.feed.FeedFile;\n+\n+/**\n+ * Contains status attributes for one download\n+ */\n+public class DownloadResult {\n+    /**\n+     * Downloaders should use this constant for the size attribute if necessary\n+     * so that the listadapters etc. can react properly.\n+     */\n+    public static final int SIZE_UNKNOWN = -1;\n+\n+    /**\n+     * A human-readable string which is shown to the user so that he can\n+     * identify the download. Should be the title of the item/feed/media or the\n+     * URL if the download has no other title.\n+     */\n+    private final String title;\n+    private final long feedfileId;\n+    /**\n+     * Is used to determine the type of the feedfile even if the feedfile does\n+     * not exist anymore. The value should be FEEDFILETYPE_FEED,\n+     * FEEDFILETYPE_FEEDIMAGE or FEEDFILETYPE_FEEDMEDIA\n+     */\n+    private final int feedfileType;\n+    /**\n+     * Unique id for storing the object in database.\n+     */\n+    private long id;\n+    private DownloadError reason;\n+    /**\n+     * A message which can be presented to the user to give more information.\n+     * Should be null if Download was successful.\n+     */\n+    private String reasonDetailed;\n+    private boolean successful;\n+    private final Date completionDate;\n+\n+    /**\n+     * Constructor for creating new completed downloads.\n+     */\n+    public DownloadResult(@NonNull FeedFile feedfile, String title, DownloadError reason, boolean successful,\n+                          String reasonDetailed) {\n+        this(0, title, feedfile.getId(), feedfile.getTypeAsInt(), successful, reason, new Date(),\n+                reasonDetailed);\n+    }\n+\n+    public DownloadResult(long id, String title, long feedfileId, int feedfileType, boolean successful,\n+                          DownloadError reason, Date completionDate,\n+                          String reasonDetailed) {\n+        this.id = id;\n+        this.title = title;\n+        this.feedfileId = feedfileId;\n+        this.reason = reason;\n+        this.successful = successful;\n+        this.completionDate = (Date) completionDate.clone();\n+        this.reasonDetailed = reasonDetailed;\n+        this.feedfileType = feedfileType;\n+    }\n+\n+    @Override\n+    @NonNull\n+    public String toString() {\n+        return \"DownloadStatus [id=\" + id + \", title=\" + title + \", reason=\"\n+                + reason + \", reasonDetailed=\" + reasonDetailed\n+                + \", successful=\" + successful + \", completionDate=\"\n+                + completionDate + \", feedfileId=\" + feedfileId\n+                + \", feedfileType=\" + feedfileType + \"]\";\n+    }\n+\n+    public long getId() {\n+        return id;\n+    }\n+\n+    public void setId(long id) {\n+        this.id = id;\n+    }\n+\n+    public String getTitle() {\n+        return title;\n+    }\n+\n+    public DownloadError getReason() {\n+        return reason;\n+    }\n+\n+    public String getReasonDetailed() {\n+        return reasonDetailed;\n+    }\n+\n+    public boolean isSuccessful() {\n+        return successful;\n+    }\n+\n+    public Date getCompletionDate() {\n+        return (Date) completionDate.clone();\n+    }\n+\n+    public long getFeedfileId() {\n+        return feedfileId;\n+    }\n+\n+    public int getFeedfileType() {\n+        return feedfileType;\n+    }\n+\n+    public void setSuccessful() {\n+        this.successful = true;\n+        this.reason = DownloadError.SUCCESS;\n+    }\n+\n+    public void setFailed(DownloadError reason, String reasonDetailed) {\n+        this.successful = false;\n+        this.reason = reason;\n+        this.reasonDetailed = reasonDetailed;\n+    }\n+\n+    public void setCancelled() {\n+        this.successful = false;\n+        this.reason = DownloadError.ERROR_DOWNLOAD_CANCELLED;\n+    }\n+}\n\\ No newline at end of file\ndiff --git a/model/src/main/java/de/danoeh/antennapod/model/download/DownloadStatus.java b/model/src/main/java/de/danoeh/antennapod/model/download/DownloadStatus.java\nindex 0a18973dfa..823c183d23 100644\n--- a/model/src/main/java/de/danoeh/antennapod/model/download/DownloadStatus.java\n+++ b/model/src/main/java/de/danoeh/antennapod/model/download/DownloadStatus.java\n@@ -1,153 +1,23 @@\n package de.danoeh.antennapod.model.download;\n \n-import androidx.annotation.NonNull;\n-\n-import java.util.Date;\n-\n-import de.danoeh.antennapod.model.feed.FeedFile;\n-\n-/**\n- * Contains status attributes for one download\n- */\n public class DownloadStatus {\n-    /**\n-     * Downloaders should use this constant for the size attribute if necessary\n-     * so that the listadapters etc. can react properly.\n-     */\n-    public static final int SIZE_UNKNOWN = -1;\n+    public static final int STATE_QUEUED = 0;\n+    public static final int STATE_COMPLETED = 1; // Both successful and not successful\n+    public static final int STATE_RUNNING = 2;\n \n-    // ----------------------------------- ATTRIBUTES STORED IN DB\n-    /**\n-     * A human-readable string which is shown to the user so that he can\n-     * identify the download. Should be the title of the item/feed/media or the\n-     * URL if the download has no other title.\n-     */\n-    private final String title;\n-    private final long feedfileId;\n-    /**\n-     * Is used to determine the type of the feedfile even if the feedfile does\n-     * not exist anymore. The value should be FEEDFILETYPE_FEED,\n-     * FEEDFILETYPE_FEEDIMAGE or FEEDFILETYPE_FEEDMEDIA\n-     */\n-    private final int feedfileType;\n-    private final boolean initiatedByUser;\n-    /**\n-     * Unique id for storing the object in database.\n-     */\n-    private long id;\n-    private DownloadError reason;\n-    /**\n-     * A message which can be presented to the user to give more information.\n-     * Should be null if Download was successful.\n-     */\n-    private String reasonDetailed;\n-    private boolean successful;\n-    private final Date completionDate;\n-    // ------------------------------------ NOT STORED IN DB\n-    private boolean done;\n-    private boolean cancelled;\n-\n-    /**\n-     * Constructor for creating new completed downloads.\n-     */\n-    public DownloadStatus(@NonNull FeedFile feedfile, String title, DownloadError reason, boolean successful,\n-                          String reasonDetailed, boolean initiatedByUser) {\n-        this(0, title, feedfile.getId(), feedfile.getTypeAsInt(), successful, false, true, reason, new Date(),\n-                reasonDetailed, initiatedByUser);\n-    }\n-\n-    public DownloadStatus(long id, String title, long feedfileId, int feedfileType, boolean successful,\n-                          boolean cancelled, boolean done, DownloadError reason, Date completionDate,\n-                          String reasonDetailed, boolean initiatedByUser) {\n-        this.id = id;\n-        this.title = title;\n-        this.feedfileId = feedfileId;\n-        this.reason = reason;\n-        this.successful = successful;\n-        this.cancelled = cancelled;\n-        this.done = done;\n-        this.completionDate = (Date) completionDate.clone();\n-        this.reasonDetailed = reasonDetailed;\n-        this.feedfileType = feedfileType;\n-        this.initiatedByUser = initiatedByUser;\n-    }\n-\n-    @Override\n-    @NonNull\n-    public String toString() {\n-        return \"DownloadStatus [id=\" + id + \", title=\" + title + \", reason=\"\n-                + reason + \", reasonDetailed=\" + reasonDetailed\n-                + \", successful=\" + successful + \", completionDate=\"\n-                + completionDate + \", feedfileId=\" + feedfileId\n-                + \", feedfileType=\" + feedfileType + \", done=\" + done\n-                + \", cancelled=\" + cancelled + \"]\";\n-    }\n-\n-    public long getId() {\n-        return id;\n-    }\n-\n-    public void setId(long id) {\n-        this.id = id;\n-    }\n-\n-    public String getTitle() {\n-        return title;\n-    }\n-\n-    public DownloadError getReason() {\n-        return reason;\n-    }\n-\n-    public String getReasonDetailed() {\n-        return reasonDetailed;\n-    }\n-\n-    public boolean isSuccessful() {\n-        return successful;\n-    }\n-\n-    public Date getCompletionDate() {\n-        return (Date) completionDate.clone();\n-    }\n-\n-    public long getFeedfileId() {\n-        return feedfileId;\n-    }\n-\n-    public int getFeedfileType() {\n-        return feedfileType;\n-    }\n-\n-    public boolean isInitiatedByUser() {\n-        return initiatedByUser;\n-    }\n-\n-    public boolean isDone() {\n-        return done;\n-    }\n-\n-    public boolean isCancelled() {\n-        return cancelled;\n-    }\n+    private final int state;\n+    private final int progress;\n \n-    public void setSuccessful() {\n-        this.successful = true;\n-        this.reason = DownloadError.SUCCESS;\n-        this.done = true;\n+    public DownloadStatus(int state, int progress) {\n+        this.state = state;\n+        this.progress = progress;\n     }\n \n-    public void setFailed(DownloadError reason, String reasonDetailed) {\n-        this.successful = false;\n-        this.reason = reason;\n-        this.reasonDetailed = reasonDetailed;\n-        this.done = true;\n+    public int getState() {\n+        return state;\n     }\n \n-    public void setCancelled() {\n-        this.successful = false;\n-        this.reason = DownloadError.ERROR_DOWNLOAD_CANCELLED;\n-        this.done = true;\n-        this.cancelled = true;\n+    public int getProgress() {\n+        return progress;\n     }\n-}\n\\ No newline at end of file\n+}\ndiff --git a/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterface.java b/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterface.java\nindex b5d0cd9914..5fac79ce8b 100644\n--- a/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterface.java\n+++ b/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterface.java\n@@ -1,10 +1,20 @@\n package de.danoeh.antennapod.net.download.serviceinterface;\n \n import android.content.Context;\n-import android.content.Intent;\n+import de.danoeh.antennapod.model.download.DownloadStatus;\n+import de.danoeh.antennapod.model.feed.FeedItem;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n \n public abstract class DownloadServiceInterface {\n+    public static final String WORK_TAG = \"episodeDownload\";\n+    public static final String WORK_TAG_EPISODE_URL = \"episodeUrl:\";\n+    public static final String WORK_DATA_PROGRESS = \"progress\";\n+    public static final String WORK_DATA_MEDIA_ID = \"media_id\";\n+    public static final String WORK_DATA_WAS_QUEUED = \"was_queued\";\n     private static DownloadServiceInterface impl;\n+    private Map<String, DownloadStatus> currentDownloads = new HashMap<>();\n \n     public static DownloadServiceInterface get() {\n         return impl;\n@@ -14,13 +24,35 @@ public static void setImpl(DownloadServiceInterface impl) {\n         DownloadServiceInterface.impl = impl;\n     }\n \n-    public abstract void download(Context context, boolean cleanupMedia, DownloadRequest... requests);\n+    public void setCurrentDownloads(Map<String, DownloadStatus> currentDownloads) {\n+        this.currentDownloads = currentDownloads;\n+    }\n \n-    public abstract Intent makeDownloadIntent(Context context, boolean cleanupMedia, DownloadRequest... requests);\n+    /**\n+     * Download immediately after user action.\n+     */\n+    public abstract void downloadNow(Context context, FeedItem item, boolean ignoreConstraints);\n \n-    public abstract void refreshAllFeeds(Context context, boolean initiatedByUser);\n+    /**\n+     * Download when device seems fit.\n+     */\n+    public abstract void download(Context context, FeedItem item);\n \n     public abstract void cancel(Context context, String url);\n \n     public abstract void cancelAll(Context context);\n+\n+    public boolean isDownloadingEpisode(String url) {\n+        return currentDownloads.containsKey(url)\n+                && currentDownloads.get(url).getState() != DownloadStatus.STATE_COMPLETED;\n+    }\n+\n+    public boolean isEpisodeQueued(String url) {\n+        return currentDownloads.containsKey(url)\n+                && currentDownloads.get(url).getState() == DownloadStatus.STATE_QUEUED;\n+    }\n+\n+    public int getProgress(String url) {\n+        return isDownloadingEpisode(url) ? currentDownloads.get(url).getProgress() : -1;\n+    }\n }\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\nindex 40933e8d14..21f12e2230 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n@@ -35,7 +35,7 @@\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n import de.danoeh.antennapod.model.feed.FeedMedia;\n import de.danoeh.antennapod.model.feed.FeedPreferences;\n-import de.danoeh.antennapod.model.download.DownloadStatus;\n+import de.danoeh.antennapod.model.download.DownloadResult;\n import de.danoeh.antennapod.model.feed.SortOrder;\n import de.danoeh.antennapod.storage.database.mapper.FeedItemFilterQuery;\n import de.danoeh.antennapod.storage.database.mapper.FeedItemSortQuery;\n@@ -757,7 +757,7 @@ public void setFeedCustomTitle(long feedId, String customTitle) {\n     /**\n      * Inserts or updates a download status.\n      */\n-    public long setDownloadStatus(DownloadStatus status) {\n+    public long setDownloadStatus(DownloadResult status) {\n         ContentValues values = new ContentValues();\n         values.put(KEY_FEEDFILE, status.getFeedfileId());\n         values.put(KEY_FEEDFILETYPE, status.getFeedfileType());\n@@ -1142,12 +1142,19 @@ public final Cursor getFeedItemCursor(final String[] ids) {\n         return db.rawQuery(query, null);\n     }\n \n-    public final Cursor getFeedItemCursorByMediaIds(final Long[] ids) {\n-        if (ids.length > IN_OPERATOR_MAXIMUM) {\n+    public final Cursor getFeedItemCursorByUrl(List<String> urls) {\n+        if (urls.size() > IN_OPERATOR_MAXIMUM) {\n             throw new IllegalArgumentException(\"number of IDs must not be larger than \" + IN_OPERATOR_MAXIMUM);\n         }\n+        StringBuilder urlsString = new StringBuilder();\n+        for (int i = 0; i < urls.size(); i++) {\n+            if (i != 0) {\n+                urlsString.append(\",\");\n+            }\n+            urlsString.append(DatabaseUtils.sqlEscapeString(urls.get(i)));\n+        }\n         final String query = SELECT_FEED_ITEMS_AND_MEDIA\n-                + \" WHERE \" + SELECT_KEY_MEDIA_ID + \" IN (\" + TextUtils.join(\",\", ids) + \")\";\n+                + \" WHERE \" + KEY_DOWNLOAD_URL + \" IN (\" + urlsString + \")\";\n         return db.rawQuery(query, null);\n     }\n \ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/DownloadStatusCursorMapper.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/DownloadResultCursorMapper.java\nsimilarity index 73%\nrename from storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/DownloadStatusCursorMapper.java\nrename to storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/DownloadResultCursorMapper.java\nindex 1b8f3c7263..d8f40d6a36 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/DownloadStatusCursorMapper.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/mapper/DownloadResultCursorMapper.java\n@@ -2,21 +2,21 @@\n \n import android.database.Cursor;\n import androidx.annotation.NonNull;\n-import de.danoeh.antennapod.model.download.DownloadStatus;\n+import de.danoeh.antennapod.model.download.DownloadResult;\n import de.danoeh.antennapod.model.download.DownloadError;\n import de.danoeh.antennapod.storage.database.PodDBAdapter;\n \n import java.util.Date;\n \n /**\n- * Converts a {@link Cursor} to a {@link DownloadStatus} object.\n+ * Converts a {@link Cursor} to a {@link DownloadResult} object.\n  */\n-public abstract class DownloadStatusCursorMapper {\n+public abstract class DownloadResultCursorMapper {\n     /**\n-     * Create a {@link DownloadStatus} instance from a database row (cursor).\n+     * Create a {@link DownloadResult} instance from a database row (cursor).\n      */\n     @NonNull\n-    public static DownloadStatus convert(@NonNull Cursor cursor) {\n+    public static DownloadResult convert(@NonNull Cursor cursor) {\n         int indexId = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_ID);\n         int indexTitle = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_DOWNLOADSTATUS_TITLE);\n         int indexFeedFile = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_FEEDFILE);\n@@ -26,10 +26,10 @@ public static DownloadStatus convert(@NonNull Cursor cursor) {\n         int indexCompletionDate = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_COMPLETION_DATE);\n         int indexReasonDetailed = cursor.getColumnIndexOrThrow(PodDBAdapter.KEY_REASON_DETAILED);\n \n-        return new DownloadStatus(cursor.getLong(indexId), cursor.getString(indexTitle), cursor.getLong(indexFeedFile),\n-                cursor.getInt(indexFileFileType), cursor.getInt(indexSuccessful) > 0, false, true,\n+        return new DownloadResult(cursor.getLong(indexId), cursor.getString(indexTitle), cursor.getLong(indexFeedFile),\n+                cursor.getInt(indexFileFileType), cursor.getInt(indexSuccessful) > 0,\n                 DownloadError.fromCode(cursor.getInt(indexReason)),\n                 new Date(cursor.getLong(indexCompletionDate)),\n-                cursor.getString(indexReasonDetailed), false);\n+                cursor.getString(indexReasonDetailed));\n     }\n }\ndiff --git a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\nindex 8a19300bb8..f2b122fcca 100644\n--- a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n+++ b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n@@ -90,7 +90,6 @@ private UserPreferences(){}\n     public static final String PREF_UPDATE_INTERVAL = \"prefAutoUpdateIntervall\";\n     private static final String PREF_MOBILE_UPDATE = \"prefMobileUpdateTypes\";\n     public static final String PREF_EPISODE_CLEANUP = \"prefEpisodeCleanup\";\n-    public static final String PREF_PARALLEL_DOWNLOADS = \"prefParallelDownloads\";\n     public static final String PREF_EPISODE_CACHE_SIZE = \"prefEpisodeCacheSize\";\n     public static final String PREF_ENABLE_AUTODL = \"prefEnableAutoDl\";\n     public static final String PREF_ENABLE_AUTODL_ON_BATTERY = \"prefEnableAutoDownloadOnBattery\";\n@@ -525,10 +524,6 @@ public static void setAllowMobileSync(boolean allow) {\n         setAllowMobileFor(\"sync\", allow);\n     }\n \n-    public static int getParallelDownloads() {\n-        return Integer.parseInt(prefs.getString(PREF_PARALLEL_DOWNLOADS, \"4\"));\n-    }\n-\n     /**\n      * Returns the capacity of the episode cache. This method will return the\n      * negative integer EPISODE_CACHE_SIZE_UNLIMITED if the cache size is set to\ndiff --git a/ui/app-start-intent/src/main/java/de/danoeh/antennapod/ui/appstartintent/DownloadAuthenticationActivityStarter.java b/ui/app-start-intent/src/main/java/de/danoeh/antennapod/ui/appstartintent/DownloadAuthenticationActivityStarter.java\ndeleted file mode 100644\nindex 03c5e915e2..0000000000\n--- a/ui/app-start-intent/src/main/java/de/danoeh/antennapod/ui/appstartintent/DownloadAuthenticationActivityStarter.java\n+++ /dev/null\n@@ -1,39 +0,0 @@\n-package de.danoeh.antennapod.ui.appstartintent;\n-\n-import android.app.PendingIntent;\n-import android.content.Context;\n-import android.content.Intent;\n-import android.os.Build;\n-import android.os.Parcelable;\n-\n-/**\n- * Launches the download authentication activity of the app with specific arguments.\n- * Does not require a dependency on the actual implementation of the activity.\n- */\n-public class DownloadAuthenticationActivityStarter {\n-    public static final String INTENT = \"de.danoeh.antennapod.intents.DOWNLOAD_AUTH_ACTIVITY\";\n-    public static final String EXTRA_DOWNLOAD_REQUEST = \"download_request\";\n-\n-    private final Intent intent;\n-    private final Context context;\n-    private final long feedFileId;\n-\n-    public DownloadAuthenticationActivityStarter(Context context, long feedFileId, Parcelable downloadRequest) {\n-        this.context = context;\n-        this.feedFileId = feedFileId;\n-        intent = new Intent(INTENT);\n-        intent.setAction(\"request\" + feedFileId);\n-        intent.putExtra(EXTRA_DOWNLOAD_REQUEST, downloadRequest);\n-        intent.setPackage(context.getPackageName());\n-    }\n-\n-    public Intent getIntent() {\n-        return intent;\n-    }\n-\n-    public PendingIntent getPendingIntent() {\n-        return PendingIntent.getActivity(context.getApplicationContext(),\n-                (\"downloadAuth\" + feedFileId).hashCode(), getIntent(),\n-                PendingIntent.FLAG_ONE_SHOT | (Build.VERSION.SDK_INT >= 23 ? PendingIntent.FLAG_IMMUTABLE : 0));\n-    }\n-}\ndiff --git a/ui/app-start-intent/src/main/java/de/danoeh/antennapod/ui/appstartintent/MainActivityStarter.java b/ui/app-start-intent/src/main/java/de/danoeh/antennapod/ui/appstartintent/MainActivityStarter.java\nindex 1463978ee5..c635ff0cc8 100644\n--- a/ui/app-start-intent/src/main/java/de/danoeh/antennapod/ui/appstartintent/MainActivityStarter.java\n+++ b/ui/app-start-intent/src/main/java/de/danoeh/antennapod/ui/appstartintent/MainActivityStarter.java\n@@ -17,6 +17,7 @@ public class MainActivityStarter {\n     public static final String EXTRA_ADD_TO_BACK_STACK = \"add_to_back_stack\";\n     public static final String EXTRA_FRAGMENT_TAG = \"fragment_tag\";\n     public static final String EXTRA_OPEN_DRAWER = \"open_drawer\";\n+    public static final String EXTRA_OPEN_DOWNLOAD_LOGS = \"open_download_logs\";\n     public static final String EXTRA_FRAGMENT_ARGS = \"fragment_args\";\n \n     private final Intent intent;\n@@ -30,6 +31,9 @@ public MainActivityStarter(Context context) {\n     }\n \n     public Intent getIntent() {\n+        if (fragmentArgs != null) {\n+            intent.putExtra(EXTRA_FRAGMENT_ARGS, fragmentArgs);\n+        }\n         return intent;\n     }\n \n@@ -67,6 +71,11 @@ public MainActivityStarter withDrawerOpen() {\n         return this;\n     }\n \n+    public MainActivityStarter withDownloadLogsOpen() {\n+        intent.putExtra(EXTRA_OPEN_DOWNLOAD_LOGS, true);\n+        return this;\n+    }\n+\n     public MainActivityStarter withFragmentArgs(String name, boolean value) {\n         if (fragmentArgs == null) {\n             fragmentArgs = new Bundle();\ndiff --git a/ui/common/src/main/java/de/danoeh/antennapod/ui/common/CircularProgressBar.java b/ui/common/src/main/java/de/danoeh/antennapod/ui/common/CircularProgressBar.java\nindex a693c28b07..42f63bd9d4 100644\n--- a/ui/common/src/main/java/de/danoeh/antennapod/ui/common/CircularProgressBar.java\n+++ b/ui/common/src/main/java/de/danoeh/antennapod/ui/common/CircularProgressBar.java\n@@ -4,7 +4,9 @@\n import android.content.res.TypedArray;\n import android.graphics.Canvas;\n import android.graphics.Color;\n+import android.graphics.DashPathEffect;\n import android.graphics.Paint;\n+import android.graphics.PathEffect;\n import android.graphics.RectF;\n import android.util.AttributeSet;\n import android.view.View;\n@@ -13,11 +15,13 @@\n public class CircularProgressBar extends View {\n     public static final float MINIMUM_PERCENTAGE = 0.005f;\n     public static final float MAXIMUM_PERCENTAGE = 1 - MINIMUM_PERCENTAGE;\n+    private static final PathEffect DASHED = new DashPathEffect(new float[] {5f, 5f}, 0f);\n \n     private final Paint paintBackground = new Paint();\n     private final Paint paintProgress = new Paint();\n     private float percentage = 0;\n     private float targetPercentage = 0;\n+    private boolean isIndeterminate = false;\n     private Object tag = null;\n     private final RectF bounds = new RectF();\n \n@@ -73,9 +77,10 @@ protected void onDraw(Canvas canvas) {\n \n         float padding = getHeight() * 0.07f;\n         paintBackground.setStrokeWidth(getHeight() * 0.02f);\n+        paintBackground.setPathEffect(isIndeterminate ? DASHED : null);\n         paintProgress.setStrokeWidth(padding);\n         bounds.set(padding, padding, getWidth() - padding, getHeight() - padding);\n-        canvas.drawArc(bounds, 0, 360, false, paintBackground);\n+        canvas.drawArc(bounds, -90, 360, false, paintBackground);\n \n         if (MINIMUM_PERCENTAGE <= percentage && percentage <= MAXIMUM_PERCENTAGE) {\n             canvas.drawArc(bounds, -90, percentage * 360, false, paintProgress);\n@@ -92,4 +97,8 @@ protected void onDraw(Canvas canvas) {\n             invalidate();\n         }\n     }\n+\n+    public void setIndeterminate(boolean indeterminate) {\n+        isIndeterminate = indeterminate;\n+    }\n }\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 59fc8b4e50..1959a2252e 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -130,7 +130,6 @@\n     <string name=\"feed_volume_reduction_off\">Off</string>\n     <string name=\"feed_volume_reduction_light\">Light</string>\n     <string name=\"feed_volume_reduction_heavy\">Heavy</string>\n-    <string name=\"parallel_downloads\">%1$d parallel downloads</string>\n     <string name=\"feed_auto_download_always\">Always</string>\n     <string name=\"feed_auto_download_never\">Never</string>\n     <string name=\"feed_new_episodes_action_add_to_inbox\">Add to Inbox</string>\n@@ -239,7 +238,6 @@\n         <item quantity=\"other\">%d episodes marked as unplayed.</item>\n     </plurals>\n     <string name=\"add_to_queue_label\">Add to Queue</string>\n-    <string name=\"added_to_queue_label\">Added to Queue</string>\n     <plurals name=\"added_to_queue_batch_label\">\n         <item quantity=\"one\">%d episode added to queue.</item>\n         <item quantity=\"other\">%d episodes added to queue.</item>\n@@ -266,6 +264,8 @@\n     <string name=\"download_running\">Download running</string>\n     <string name=\"download_error_details\">Details</string>\n     <string name=\"download_log_details_message\">%1$s \\n\\nTechnical reason: \\n%2$s \\n\\nFile URL:\\n%3$s</string>\n+    <string name=\"download_error_retrying\">Download of \\\"%1$s\\\" failed. Will be retried later.</string>\n+    <string name=\"download_error_not_retrying\">Download of \\\"%1$s\\\" failed.</string>\n     <string name=\"download_error_tap_for_details\">Tap to view details.</string>\n     <string name=\"download_error_device_not_found\">Storage Device not found</string>\n     <string name=\"download_error_insufficient_space\">There is not enough space left on your device.</string>\n@@ -277,7 +277,7 @@\n     <string name=\"download_error_not_found\">The podcast host\\'s server does not know where to find the file. It may have been deleted.</string>\n     <string name=\"download_error_connection_error\">Connection Error</string>\n     <string name=\"download_error_unknown_host\">Cannot find the server. Check if the address is typed correctly and if you have a working network connection.</string>\n-    <string name=\"download_error_unauthorized\">Authentication Error</string>\n+    <string name=\"download_error_unauthorized\">Authentication Error. Make sure that username and password are correct.</string>\n     <string name=\"download_error_file_type_type\">File Type Error</string>\n     <string name=\"download_error_forbidden\">The podcast host\\'s server refuses to respond.</string>\n     <string name=\"download_canceled_msg\">Download canceled</string>\n@@ -285,7 +285,6 @@\n     <string name=\"download_error_blocked\">The download was blocked by another app on your device (like a VPN or ad blocker).</string>\n     <string name=\"download_error_certificate\">Unable to establish a secure connection. This can mean that another app on your device (like a VPN or an ad blocker) blocked the download, or that something is wrong with the server certificates.</string>\n     <string name=\"download_report_title\">Downloads completed with error(s)</string>\n-    <string name=\"auto_download_report_title\">Auto-downloads completed</string>\n     <string name=\"download_error_io_error\">IO Error</string>\n     <string name=\"download_error_request_error\">Request Error</string>\n     <string name=\"download_error_db_access\">Database Access Error</string>\n@@ -293,8 +292,6 @@\n         <item quantity=\"one\">%d download left</item>\n         <item quantity=\"other\">%d downloads left</item>\n     </plurals>\n-    <string name=\"completing\">Completing\u2026</string>\n-    <string name=\"download_notification_title\">Downloading podcast data</string>\n     <string name=\"download_notification_title_feeds\">Refreshing podcasts</string>\n     <string name=\"download_notification_title_episodes\">Downloading episodes</string>\n     <string name=\"download_log_title_unknown\">Unknown Title</string>\n@@ -303,16 +300,14 @@\n     <string name=\"null_value_podcast_error\">No podcast was provided that could be shown.</string>\n     <string name=\"no_feed_url_podcast_found_by_search\">The suggested podcast did not have an RSS link, AntennaPod found a podcast that could match</string>\n     <string name=\"authentication_notification_title\">Authentication required</string>\n-    <string name=\"authentication_notification_msg\">The resource you requested requires a username and a password</string>\n     <string name=\"confirm_mobile_download_dialog_title\">Confirm Mobile Download</string>\n-    <string name=\"confirm_mobile_download_dialog_message_not_in_queue\">Downloading over mobile data connection is disabled in the settings.\\n\\nYou can choose to either only add the episode to the queue or you can allow downloading temporarily.\\n\\n<small>Your choice will be remembered for 10 minutes.</small></string>\n-    <string name=\"confirm_mobile_download_dialog_message\">Downloading over mobile data connection is disabled in the settings.\\n\\nDo you want to allow downloading temporarily?\\n\\n<small>Your choice will be remembered for 10 minutes.</small></string>\n+    <string name=\"confirm_mobile_download_dialog_message\">Downloading over mobile data connection is disabled in the settings. AntennaPod can download the episode later automatically when Wi-Fi is available.</string>\n+    <string name=\"confirm_mobile_download_dialog_download_later\">Download later</string>\n+    <string name=\"confirm_mobile_download_dialog_allow_this_time\">Download anyway</string>\n     <string name=\"confirm_mobile_streaming_notification_title\">Confirm Mobile streaming</string>\n     <string name=\"confirm_mobile_streaming_notification_message\">Streaming over mobile data connection is disabled in the settings. Tap to stream anyway.</string>\n     <string name=\"confirm_mobile_streaming_button_always\">Always</string>\n     <string name=\"confirm_mobile_streaming_button_once\">Once</string>\n-    <string name=\"confirm_mobile_download_dialog_only_add_to_queue\">Enqueue</string>\n-    <string name=\"confirm_mobile_download_dialog_enable_temporarily\">Allow temporarily</string>\n \n     <!-- Mediaplayer messages -->\n     <string name=\"playback_error_generic\"><![CDATA[The media file could not be played.\\n\\n- Try deleting and re-downloading the episode.\\n- Check your network connection, and make sure no VPN or login page is blocking access.\\n- Try long-pressing and sharing the \\\"Media address\\\" to your web browser to see if it can be played there. If not, contact the podcast creators.]]></string>\n@@ -453,7 +448,6 @@\n     <string name=\"pref_autodl_wifi_filter_sum\">Allow automatic download only for selected Wi-Fi networks.</string>\n     <string name=\"pref_automatic_download_on_battery_title\">Download when not charging</string>\n     <string name=\"pref_automatic_download_on_battery_sum\">Allow automatic download when the battery is not charging</string>\n-    <string name=\"pref_parallel_downloads_title\">Parallel Downloads</string>\n     <string name=\"pref_episode_cache_title\">Episode Cache</string>\n     <string name=\"pref_episode_cache_summary\">Total number of downloaded episodes cached on the device. Automatic download will be suspended if this number is reached.</string>\n     <string name=\"pref_episode_cover_title\">Use Episode Cover</string>\ndiff --git a/ui/png-icons/src/main/res/drawable/ic_notification_cancel.xml b/ui/png-icons/src/main/res/drawable/ic_notification_cancel.xml\ndeleted file mode 100644\nindex a5480c71f9..0000000000\n--- a/ui/png-icons/src/main/res/drawable/ic_notification_cancel.xml\n+++ /dev/null\n@@ -1,5 +0,0 @@\n-<vector android:height=\"24dp\"\n-    android:viewportHeight=\"24.0\" android:viewportWidth=\"24.0\"\n-    android:width=\"24dp\" xmlns:android=\"http://schemas.android.com/apk/res/android\">\n-    <path android:fillColor=\"#FFFFFFFF\" android:pathData=\"M12,2C6.47,2 2,6.47 2,12s4.47,10 10,10 10,-4.47 10,-10S17.53,2 12,2zM17,15.59L15.59,17 12,13.41 8.41,17 7,15.59 10.59,12 7,8.41 8.41,7 12,10.59 15.59,7 17,8.41 13.41,12 17,15.59z\"/>\n-</vector>\ndiff --git a/ui/png-icons/src/main/res/drawable/ic_notification_key.xml b/ui/png-icons/src/main/res/drawable/ic_notification_key.xml\ndeleted file mode 100644\nindex c8a817eeba..0000000000\n--- a/ui/png-icons/src/main/res/drawable/ic_notification_key.xml\n+++ /dev/null\n@@ -1,6 +0,0 @@\n-<vector xmlns:android=\"http://schemas.android.com/apk/res/android\"\n-        android:height=\"24dp\" android:viewportHeight=\"24.0\"\n-        android:viewportWidth=\"24.0\" android:width=\"24dp\">\n-    <path android:fillColor=\"#FFFFFFFF\"\n-          android:pathData=\"M12.65,10C11.83,7.67 9.61,6 7,6c-3.31,0 -6,2.69 -6,6s2.69,6 6,6c2.61,0 4.83,-1.67 5.65,-4H17v4h4v-4h2v-4H12.65zM7,14c-1.1,0 -2,-0.9 -2,-2s0.9,-2 2,-2 2,0.9 2,2 -0.9,2 -2,2z\"/>\n-</vector>\n", "test_patch": "diff --git a/app/src/androidTest/java/de/danoeh/antennapod/core/service/download/StubDownloader.java b/app/src/androidTest/java/de/danoeh/antennapod/core/service/download/StubDownloader.java\nindex 302301c85c..835af1f950 100644\n--- a/app/src/androidTest/java/de/danoeh/antennapod/core/service/download/StubDownloader.java\n+++ b/app/src/androidTest/java/de/danoeh/antennapod/core/service/download/StubDownloader.java\n@@ -2,7 +2,7 @@\n \n import androidx.annotation.NonNull;\n import androidx.core.util.Consumer;\n-import de.danoeh.antennapod.model.download.DownloadStatus;\n+import de.danoeh.antennapod.model.download.DownloadResult;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n \n public class StubDownloader extends Downloader {\n@@ -10,9 +10,10 @@ public class StubDownloader extends Downloader {\n     private final long downloadTime;\n \n     @NonNull\n-    private final Consumer<DownloadStatus> onDownloadComplete;\n+    private final Consumer<DownloadResult> onDownloadComplete;\n \n-    public StubDownloader(@NonNull DownloadRequest request, long downloadTime, @NonNull Consumer<DownloadStatus> onDownloadComplete) {\n+    public StubDownloader(@NonNull DownloadRequest request, long downloadTime,\n+                          @NonNull Consumer<DownloadResult> onDownloadComplete) {\n         super(request);\n         this.downloadTime = downloadTime;\n         this.onDownloadComplete = onDownloadComplete;\n@@ -36,7 +37,7 @@ public DownloadRequest getDownloadRequest() {\n \n     @NonNull\n     @Override\n-    public DownloadStatus getResult() {\n+    public DownloadResult getResult() {\n         return super.getResult();\n     }\n \ndiff --git a/app/src/androidTest/java/de/test/antennapod/EspressoTestUtils.java b/app/src/androidTest/java/de/test/antennapod/EspressoTestUtils.java\nindex d652896381..a7575862b1 100644\n--- a/app/src/androidTest/java/de/test/antennapod/EspressoTestUtils.java\n+++ b/app/src/androidTest/java/de/test/antennapod/EspressoTestUtils.java\n@@ -24,7 +24,6 @@\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n-import de.danoeh.antennapod.core.service.download.DownloadService;\n import de.danoeh.antennapod.core.service.playback.PlaybackService;\n import de.danoeh.antennapod.dialog.RatingDialog;\n import de.danoeh.antennapod.fragment.NavDrawerFragment;\n@@ -224,21 +223,6 @@ public static void tryKillPlaybackService() {\n         InstrumentationRegistry.getInstrumentation().waitForIdleSync();\n     }\n \n-    public static void tryKillDownloadService() {\n-        Context context = InstrumentationRegistry.getInstrumentation().getTargetContext();\n-        context.stopService(new Intent(context, DownloadService.class));\n-        try {\n-            // Android has no reliable way to stop a service instantly.\n-            // Calling stopSelf marks allows the system to destroy the service but the actual call\n-            // to onDestroy takes until the next GC of the system, which we can not influence.\n-            // Try to wait for the service at least a bit.\n-            Awaitility.await().atMost(10, TimeUnit.SECONDS).until(() -> !DownloadService.isRunning);\n-        } catch (ConditionTimeoutException e) {\n-            e.printStackTrace();\n-        }\n-        InstrumentationRegistry.getInstrumentation().waitForIdleSync();\n-    }\n-\n     public static Matcher<View> actionBarOverflow() {\n         return allOf(isDisplayed(), withContentDescription(\"More options\"));\n     }\ndiff --git a/app/src/androidTest/java/de/test/antennapod/service/download/DownloadServiceTest.java b/app/src/androidTest/java/de/test/antennapod/service/download/DownloadServiceTest.java\ndeleted file mode 100644\nindex 97499b24a9..0000000000\n--- a/app/src/androidTest/java/de/test/antennapod/service/download/DownloadServiceTest.java\n+++ /dev/null\n@@ -1,217 +0,0 @@\n-package de.test.antennapod.service.download;\n-\n-import android.content.Context;\n-import android.content.Intent;\n-import androidx.annotation.NonNull;\n-import androidx.annotation.Nullable;\n-import androidx.core.util.Consumer;\n-import androidx.test.platform.app.InstrumentationRegistry;\n-import androidx.test.ext.junit.runners.AndroidJUnit4;\n-\n-import de.danoeh.antennapod.core.service.download.DownloadRequestCreator;\n-import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n-import de.test.antennapod.EspressoTestUtils;\n-import org.awaitility.Awaitility;\n-import org.awaitility.core.ConditionTimeoutException;\n-import org.junit.After;\n-import org.junit.Before;\n-import org.junit.Test;\n-import org.junit.runner.RunWith;\n-\n-import java.util.ArrayList;\n-import java.util.Date;\n-import java.util.List;\n-import java.util.concurrent.TimeUnit;\n-\n-import de.danoeh.antennapod.model.feed.Feed;\n-import de.danoeh.antennapod.model.feed.FeedItem;\n-import de.danoeh.antennapod.model.feed.FeedMedia;\n-import de.danoeh.antennapod.storage.preferences.UserPreferences;\n-import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n-import de.danoeh.antennapod.core.service.download.DownloadService;\n-import de.danoeh.antennapod.model.download.DownloadStatus;\n-import de.danoeh.antennapod.core.service.download.Downloader;\n-import de.danoeh.antennapod.core.service.download.DownloaderFactory;\n-import de.danoeh.antennapod.core.service.download.StubDownloader;\n-import de.danoeh.antennapod.core.storage.DBReader;\n-import de.danoeh.antennapod.core.storage.DBWriter;\n-\n-import static de.test.antennapod.util.event.DownloadEventListener.withDownloadEventListener;\n-import static de.test.antennapod.util.event.FeedItemEventListener.withFeedItemEventListener;\n-import static org.junit.Assert.assertEquals;\n-import static org.junit.Assert.assertFalse;\n-import static org.junit.Assert.assertTrue;\n-import static org.junit.Assert.fail;\n-\n-/**\n- * @see HttpDownloaderTest for the test of actual download (and saving the file).\n- */\n-@RunWith(AndroidJUnit4.class)\n-public class DownloadServiceTest {\n-    private FeedMedia testMedia11 = null;\n-\n-    private DownloaderFactory origFactory = null;\n-\n-    @Before\n-    public void setUp() throws Exception {\n-        EspressoTestUtils.clearDatabase();\n-        EspressoTestUtils.clearPreferences();\n-        origFactory = DownloadService.getDownloaderFactory();\n-        Feed testFeed = setUpTestFeeds();\n-        testMedia11 = testFeed.getItemAtIndex(0).getMedia();\n-    }\n-\n-    private Feed setUpTestFeeds() throws Exception {\n-        // To avoid complication in case of test failures, leaving behind orphaned\n-        // media files: add a timestamp so that each test run will have its own directory for media files.\n-        Feed feed = new Feed(\"url\", null, \"Test Feed title 1 \" + System.currentTimeMillis());\n-        List<FeedItem> items = new ArrayList<>();\n-        feed.setItems(items);\n-        FeedItem item1 = new FeedItem(0, \"Item 1-1\", \"Item 1-1\", \"url\", new Date(), FeedItem.NEW, feed);\n-        items.add(item1);\n-        FeedMedia media1 = new FeedMedia(0, item1, 123, 1, 1, \"audio/mp3\", null, \"http://example.com/episode.mp3\", false, null, 0, 0);\n-        item1.setMedia(media1);\n-\n-        DBWriter.setFeedItem(item1).get();\n-        return feed;\n-    }\n-\n-\n-    @After\n-    public void tearDown() throws Exception {\n-        DownloadService.setDownloaderFactory(origFactory);\n-        Context context = InstrumentationRegistry.getInstrumentation().getTargetContext();\n-        DownloadServiceInterface.get().cancelAll(context);\n-        context.stopService(new Intent(context, DownloadService.class));\n-        EspressoTestUtils.tryKillDownloadService();\n-    }\n-\n-    @Test\n-    public void testEventsGeneratedCaseMediaDownloadSuccess_noEnqueue() throws Exception {\n-        doTestEventsGeneratedCaseMediaDownloadSuccess(false, 1);\n-    }\n-\n-    @Test\n-    public void testEventsGeneratedCaseMediaDownloadSuccess_withEnqueue() throws Exception {\n-        // enqueue itself generates additional FeedItem event\n-        doTestEventsGeneratedCaseMediaDownloadSuccess(true, 2);\n-    }\n-\n-    private void doTestEventsGeneratedCaseMediaDownloadSuccess(boolean enqueueDownloaded,\n-                                                               int numEventsExpected)\n-            throws Exception {\n-        // create a stub download that returns successful\n-        //\n-        // OPEN: Ideally, I'd like the download time long enough so that multiple in-progress DownloadEvents\n-        // are generated (to simulate typical download), but it'll make download time quite long (1-2 seconds)\n-        // to do so\n-        DownloadService.setDownloaderFactory(new StubDownloaderFactory(50, DownloadStatus::setSuccessful));\n-\n-        UserPreferences.setEnqueueDownloadedEpisodes(enqueueDownloaded);\n-        withFeedItemEventListener(feedItemEventListener -> {\n-            try {\n-                assertEquals(0, feedItemEventListener.getEvents().size());\n-                assertFalse(\"The media in test should not yet been downloaded\",\n-                        DBReader.getFeedMedia(testMedia11.getId()).isDownloaded());\n-\n-                DownloadServiceInterface.get()\n-                        .download(InstrumentationRegistry.getInstrumentation().getTargetContext(), false,\n-                        DownloadRequestCreator.create(testMedia11).build());\n-                Awaitility.await()\n-                        .atMost(5000, TimeUnit.MILLISECONDS)\n-                        .until(() -> feedItemEventListener.getEvents().size() >= numEventsExpected);\n-                assertTrue(\"After media download has completed, FeedMedia object in db should indicate so.\",\n-                        DBReader.getFeedMedia(testMedia11.getId()).isDownloaded());\n-                assertEquals(\"The FeedItem should have been \" + (enqueueDownloaded ? \"\" : \"not \") +  \"enqueued\",\n-                        enqueueDownloaded,\n-                        DBReader.getQueueIDList().contains(testMedia11.getItem().getId()));\n-            } catch (ConditionTimeoutException cte) {\n-                fail(\"The expected FeedItemEvent (for media download complete) has not been posted. \"\n-                        + cte.getMessage());\n-            }\n-        });\n-    }\n-\n-    @Test\n-    public void testCancelDownload_UndoEnqueue_Normal() throws Exception {\n-        doTestCancelDownload_UndoEnqueue(false);\n-    }\n-\n-    @Test\n-    public void testCancelDownload_UndoEnqueue_AlreadyInQueue() throws Exception {\n-        doTestCancelDownload_UndoEnqueue(true);\n-    }\n-\n-    private void doTestCancelDownload_UndoEnqueue(boolean itemAlreadyInQueue) throws Exception {\n-        Context context = InstrumentationRegistry.getInstrumentation().getTargetContext();\n-        // let download take longer to ensure the test can cancel the download in time\n-        DownloadService.setDownloaderFactory(\n-                new StubDownloaderFactory(30000, DownloadStatus::setSuccessful));\n-        UserPreferences.setEnqueueDownloadedEpisodes(true);\n-        UserPreferences.setEnableAutodownload(false);\n-\n-        final long item1Id = testMedia11.getItem().getId();\n-        if (itemAlreadyInQueue) {\n-            // simulate item already in queue condition\n-            DBWriter.addQueueItem(context, false, item1Id).get();\n-            assertTrue(DBReader.getQueueIDList().contains(item1Id));\n-        } else {\n-            assertFalse(DBReader.getQueueIDList().contains(item1Id));\n-        }\n-\n-        withFeedItemEventListener(feedItemEventListener -> {\n-            DownloadServiceInterface.get()\n-                    .download(InstrumentationRegistry.getInstrumentation().getTargetContext(), false,\n-                    DownloadRequestCreator.create(testMedia11).build());\n-            withDownloadEventListener(downloadEventListener ->\n-                    Awaitility.await(\"download is actually running\")\n-                        .atMost(5000, TimeUnit.MILLISECONDS)\n-                        .until(() -> downloadEventListener.getLatestEvent() != null\n-                                && downloadEventListener.getLatestEvent().update.mediaIds.length > 0\n-                                && downloadEventListener.getLatestEvent().update.mediaIds[0] == testMedia11.getId()));\n-\n-            if (itemAlreadyInQueue) {\n-                assertEquals(\"download service receives the request - no event is expected before cancel is issued\",\n-                        0, feedItemEventListener.getEvents().size());\n-            } else {\n-                Awaitility.await(\"item enqueue event\")\n-                        .atMost(2000, TimeUnit.MILLISECONDS)\n-                        .until(() -> feedItemEventListener.getEvents().size() >= 1);\n-            }\n-            DownloadServiceInterface.get().cancel(context, testMedia11.getDownload_url());\n-            final int totalNumEventsExpected = itemAlreadyInQueue ? 1 : 3;\n-            Awaitility.await(\"item dequeue event + download termination event\")\n-                    .atMost(2000, TimeUnit.MILLISECONDS)\n-                    .until(() -> feedItemEventListener.getEvents().size() >= totalNumEventsExpected);\n-            assertFalse(\"The download should have been canceled\",\n-                    DBReader.getFeedMedia(testMedia11.getId()).isDownloaded());\n-            if (itemAlreadyInQueue) {\n-                assertTrue(\"The FeedItem should still be in the queue after the download is cancelled.\"\n-                                + \" It's there before download.\",\n-                        DBReader.getQueueIDList().contains(item1Id));\n-            } else {\n-                assertFalse(\"The FeedItem should not be in the queue after the download is cancelled.\",\n-                        DBReader.getQueueIDList().contains(item1Id));\n-            }\n-        });\n-    }\n-\n-    private static class StubDownloaderFactory implements DownloaderFactory {\n-        private final long downloadTime;\n-\n-        @NonNull\n-        private final Consumer<DownloadStatus> onDownloadComplete;\n-\n-        StubDownloaderFactory(long downloadTime, @NonNull Consumer<DownloadStatus> onDownloadComplete) {\n-            this.downloadTime = downloadTime;\n-            this.onDownloadComplete = onDownloadComplete;\n-        }\n-\n-        @Nullable\n-        @Override\n-        public Downloader create(@NonNull DownloadRequest request) {\n-            return new StubDownloader(request, downloadTime, onDownloadComplete);\n-        }\n-    }\n-\n-}\ndiff --git a/app/src/androidTest/java/de/test/antennapod/service/download/HttpDownloaderTest.java b/app/src/androidTest/java/de/test/antennapod/service/download/HttpDownloaderTest.java\nindex f276434f6b..76cba47066 100644\n--- a/app/src/androidTest/java/de/test/antennapod/service/download/HttpDownloaderTest.java\n+++ b/app/src/androidTest/java/de/test/antennapod/service/download/HttpDownloaderTest.java\n@@ -10,7 +10,7 @@\n import de.danoeh.antennapod.model.feed.FeedFile;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n-import de.danoeh.antennapod.model.download.DownloadStatus;\n+import de.danoeh.antennapod.model.download.DownloadResult;\n import de.danoeh.antennapod.core.service.download.Downloader;\n import de.danoeh.antennapod.core.service.download.HttpDownloader;\n import de.danoeh.antennapod.model.download.DownloadError;\n@@ -80,10 +80,9 @@ private Downloader download(String url, String title, boolean expectedResult, bo\n         DownloadRequest request = new DownloadRequest(feedFile.getFile_url(), url, title, 0, feedFile.getTypeAsInt(), username, password, deleteOnFail, null, false);\n         Downloader downloader = new HttpDownloader(request);\n         downloader.call();\n-        DownloadStatus status = downloader.getResult();\n+        DownloadResult status = downloader.getResult();\n         assertNotNull(status);\n         assertEquals(expectedResult, status.isSuccessful());\n-        assertTrue(status.isDone());\n         // the file should not exist if the download has failed and deleteExisting was true\n         assertTrue(!deleteExisting || new File(feedFile.getFile_url()).exists() == expectedResult);\n         return downloader;\n@@ -127,10 +126,8 @@ public void run() {\n         } catch (InterruptedException e) {\n             e.printStackTrace();\n         }\n-        DownloadStatus result = downloader.getResult();\n-        assertTrue(result.isDone());\n+        DownloadResult result = downloader.getResult();\n         assertFalse(result.isSuccessful());\n-        assertTrue(result.isCancelled());\n         assertFalse(new File(feedFile.getFile_url()).exists());\n     }\n \ndiff --git a/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java b/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java\nindex 5940d511be..1f387b24b1 100644\n--- a/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java\n+++ b/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java\n@@ -27,8 +27,6 @@\n \n import static androidx.test.espresso.Espresso.onView;\n import static androidx.test.espresso.action.ViewActions.click;\n-import static androidx.test.espresso.action.ViewActions.closeSoftKeyboard;\n-import static androidx.test.espresso.action.ViewActions.replaceText;\n import static androidx.test.espresso.action.ViewActions.scrollTo;\n import static androidx.test.espresso.action.ViewActions.swipeDown;\n import static androidx.test.espresso.action.ViewActions.swipeUp;\n@@ -37,13 +35,11 @@\n import static androidx.test.espresso.matcher.ViewMatchers.isChecked;\n import static androidx.test.espresso.matcher.ViewMatchers.isDisplayed;\n import static androidx.test.espresso.matcher.ViewMatchers.isRoot;\n-import static androidx.test.espresso.matcher.ViewMatchers.withClassName;\n import static androidx.test.espresso.matcher.ViewMatchers.withId;\n import static androidx.test.espresso.matcher.ViewMatchers.withText;\n import static de.test.antennapod.EspressoTestUtils.clickPreference;\n import static de.test.antennapod.EspressoTestUtils.waitForView;\n import static java.util.concurrent.TimeUnit.MILLISECONDS;\n-import static org.hamcrest.Matchers.endsWith;\n import static org.hamcrest.Matchers.not;\n import static org.junit.Assert.assertTrue;\n \n@@ -223,40 +219,6 @@ public void testPauseForInterruptions() {\n                 .until(() -> pauseForFocusLoss == UserPreferences.shouldPauseForFocusLoss());\n     }\n \n-    @Test\n-    public void testSetSequentialDownload() {\n-        clickPreference(R.string.downloads_pref);\n-        clickPreference(R.string.pref_parallel_downloads_title);\n-        onView(isRoot()).perform(waitForView(withClassName(endsWith(\"EditText\")), 1000));\n-        onView(withClassName(endsWith(\"EditText\"))).perform(replaceText(\"1\"));\n-        onView(withText(android.R.string.ok)).perform(click());\n-        Awaitility.await().atMost(1000, MILLISECONDS)\n-                .until(() -> UserPreferences.getParallelDownloads() == 1);\n-    }\n-\n-    @Test\n-    public void testSetParallelDownloads() {\n-        clickPreference(R.string.downloads_pref);\n-        clickPreference(R.string.pref_parallel_downloads_title);\n-        onView(isRoot()).perform(waitForView(withClassName(endsWith(\"EditText\")), 1000));\n-        onView(withClassName(endsWith(\"EditText\"))).perform(replaceText(\"10\"));\n-        onView(withClassName(endsWith(\"EditText\"))).perform(closeSoftKeyboard());\n-        onView(withText(android.R.string.ok)).perform(click());\n-        Awaitility.await().atMost(1000, MILLISECONDS)\n-                .until(() -> UserPreferences.getParallelDownloads() == 10);\n-    }\n-\n-    @Test\n-    public void testSetParallelDownloadsInvalidInput() {\n-        clickPreference(R.string.downloads_pref);\n-        clickPreference(R.string.pref_parallel_downloads_title);\n-        onView(isRoot()).perform(waitForView(withClassName(endsWith(\"EditText\")), 1000));\n-        onView(withClassName(endsWith(\"EditText\"))).perform(replaceText(\"0\"));\n-        onView(withClassName(endsWith(\"EditText\"))).check(matches(withText(\"\")));\n-        onView(withClassName(endsWith(\"EditText\"))).perform(replaceText(\"100\"));\n-        onView(withClassName(endsWith(\"EditText\"))).check(matches(withText(\"\")));\n-    }\n-\n     @Test\n     public void testSetEpisodeCache() {\n         String[] entries = res.getStringArray(R.array.episode_cache_size_entries);\ndiff --git a/app/src/androidTest/java/de/test/antennapod/util/event/DownloadEventListener.java b/app/src/androidTest/java/de/test/antennapod/util/event/DownloadEventListener.java\ndeleted file mode 100644\nindex d322c1cbfb..0000000000\n--- a/app/src/androidTest/java/de/test/antennapod/util/event/DownloadEventListener.java\n+++ /dev/null\n@@ -1,45 +0,0 @@\n-package de.test.antennapod.util.event;\n-\n-import androidx.annotation.NonNull;\n-import androidx.annotation.Nullable;\n-import de.danoeh.antennapod.core.event.DownloadEvent;\n-import io.reactivex.functions.Consumer;\n-import org.greenrobot.eventbus.EventBus;\n-import org.greenrobot.eventbus.Subscribe;\n-\n-import java.util.ArrayList;\n-import java.util.List;\n-\n-/**\n- * Test helper to listen to {@link DownloadEvent} and handle them accordingly.\n- */\n-public class DownloadEventListener {\n-    private final List<DownloadEvent> events = new ArrayList<>();\n-\n-    /**\n-     * Provides an listener subscribing to {@link DownloadEvent} that the callers can use.\n-     * Note: it uses RxJava's version of {@link Consumer} because it allows exceptions to be thrown.\n-     */\n-    public static void withDownloadEventListener(@NonNull Consumer<DownloadEventListener> consumer) throws Exception {\n-        DownloadEventListener feedItemEventListener = new DownloadEventListener();\n-        try {\n-            EventBus.getDefault().register(feedItemEventListener);\n-            consumer.accept(feedItemEventListener);\n-        } finally {\n-            EventBus.getDefault().unregister(feedItemEventListener);\n-        }\n-    }\n-\n-    @Subscribe\n-    public void onEvent(DownloadEvent event) {\n-        events.add(event);\n-    }\n-\n-    @Nullable\n-    public DownloadEvent getLatestEvent() {\n-        if (events.size() == 0) {\n-            return null;\n-        }\n-        return events.get(events.size() - 1);\n-    }\n-}\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/LocalFeedStubDownloader.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/LocalFeedStubDownloader.java\ndeleted file mode 100644\nindex 7502559582..0000000000\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/LocalFeedStubDownloader.java\n+++ /dev/null\n@@ -1,18 +0,0 @@\n-package de.danoeh.antennapod.core.service.download;\n-\n-import androidx.annotation.NonNull;\n-import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n-\n-/**\n- * This does not actually download, but it keeps track of a local feed's refresh state.\n- */\n-public class LocalFeedStubDownloader extends Downloader {\n-\n-    public LocalFeedStubDownloader(@NonNull DownloadRequest request) {\n-        super(request);\n-    }\n-\n-    @Override\n-    protected void download() {\n-    }\n-}\n\\ No newline at end of file\ndiff --git a/core/src/test/java/de/danoeh/antennapod/core/storage/DbTasksTest.java b/core/src/test/java/de/danoeh/antennapod/core/storage/DbTasksTest.java\nindex d66bd23609..6a7e51bac2 100644\n--- a/core/src/test/java/de/danoeh/antennapod/core/storage/DbTasksTest.java\n+++ b/core/src/test/java/de/danoeh/antennapod/core/storage/DbTasksTest.java\n@@ -13,7 +13,6 @@\n import org.robolectric.RobolectricTestRunner;\n \n import java.util.ArrayList;\n-import java.util.Arrays;\n import java.util.Collections;\n import java.util.Date;\n import java.util.List;\n@@ -26,7 +25,6 @@\n import de.danoeh.antennapod.core.preferences.PlaybackPreferences;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n \n-import static de.danoeh.antennapod.core.util.FeedItemUtil.getIdList;\n import static java.util.Collections.singletonList;\n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertFalse;\n@@ -255,63 +253,6 @@ private void updatedFeedTest(final Feed newFeed, long feedID, List<Long> itemIDs\n         }\n     }\n \n-    @Test\n-    public void testAddQueueItemsInDownload_EnqueueEnabled() throws Exception {\n-        // Setup test data / environment\n-        UserPreferences.setEnqueueDownloadedEpisodes(true);\n-        UserPreferences.setEnqueueLocation(UserPreferences.EnqueueLocation.BACK);\n-\n-        List<FeedItem> fis1 = createSavedFeed(\"Feed 1\", 2).getItems();\n-        List<FeedItem> fis2 = createSavedFeed(\"Feed 2\", 3).getItems();\n-\n-        DBWriter.addQueueItem(context, fis1.get(0), fis2.get(0)).get();\n-        // the first item fis1.get(0) is already in the queue\n-        FeedItem[] itemsToDownload = new FeedItem[]{ fis1.get(0), fis1.get(1), fis2.get(2), fis2.get(1) };\n-\n-        // Expectations:\n-        List<FeedItem> expectedEnqueued = Arrays.asList(fis1.get(1), fis2.get(2), fis2.get(1));\n-        List<FeedItem> expectedQueue = new ArrayList<>();\n-        expectedQueue.addAll(DBReader.getQueue());\n-        expectedQueue.addAll(expectedEnqueued);\n-\n-        // Run actual test and assert results\n-        List<? extends FeedItem> actualEnqueued =\n-                DBTasks.enqueueFeedItemsToDownload(context, Arrays.asList(itemsToDownload));\n-\n-        assertEqualsByIds(\"Only items not in the queue are enqueued\", expectedEnqueued, actualEnqueued);\n-        assertEqualsByIds(\"Queue has new items appended\", expectedQueue, DBReader.getQueue());\n-    }\n-\n-    @Test\n-    public void testAddQueueItemsInDownload_EnqueueDisabled() throws Exception {\n-        // Setup test data / environment\n-        UserPreferences.setEnqueueDownloadedEpisodes(false);\n-\n-        List<FeedItem> fis1 = createSavedFeed(\"Feed 1\", 2).getItems();\n-        List<FeedItem> fis2 = createSavedFeed(\"Feed 2\", 3).getItems();\n-\n-        DBWriter.addQueueItem(context, fis1.get(0), fis2.get(0)).get();\n-        FeedItem[] itemsToDownload = new FeedItem[]{ fis1.get(0), fis1.get(1), fis2.get(2), fis2.get(1) };\n-\n-        // Expectations:\n-        List<FeedItem> expectedEnqueued = Collections.emptyList();\n-        List<FeedItem> expectedQueue = DBReader.getQueue();\n-\n-        // Run actual test and assert results\n-        List<? extends FeedItem> actualEnqueued =\n-                DBTasks.enqueueFeedItemsToDownload(context, Arrays.asList(itemsToDownload));\n-\n-        assertEqualsByIds(\"No item is enqueued\", expectedEnqueued, actualEnqueued);\n-        assertEqualsByIds(\"Queue is unchanged\", expectedQueue, DBReader.getQueue());\n-    }\n-\n-    private void assertEqualsByIds(String msg, List<? extends FeedItem> expected, List<? extends FeedItem> actual) {\n-        // assert only the IDs, so that any differences are easily to spot.\n-        List<Long> expectedIds = getIdList(expected);\n-        List<Long> actualIds = getIdList(actual);\n-        assertEquals(msg, expectedIds, actualIds);\n-    }\n-\n     private Feed createSavedFeed(String title, int numFeedItems) {\n         final Feed feed = new Feed(\"url\", null, title);\n \ndiff --git a/core/src/test/java/de/danoeh/antennapod/core/storage/ItemEnqueuePositionCalculatorTest.java b/core/src/test/java/de/danoeh/antennapod/core/storage/ItemEnqueuePositionCalculatorTest.java\nindex 376e0e65cb..2594fabf60 100644\n--- a/core/src/test/java/de/danoeh/antennapod/core/storage/ItemEnqueuePositionCalculatorTest.java\n+++ b/core/src/test/java/de/danoeh/antennapod/core/storage/ItemEnqueuePositionCalculatorTest.java\n@@ -1,7 +1,8 @@\n package de.danoeh.antennapod.core.storage;\n \n-import de.danoeh.antennapod.core.service.download.DownloadService;\n import de.danoeh.antennapod.model.playback.RemoteMedia;\n+import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n+import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterfaceStub;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n import org.junit.runners.Parameterized;\n@@ -21,8 +22,6 @@\n import de.danoeh.antennapod.core.feed.FeedMother;\n import de.danoeh.antennapod.storage.preferences.UserPreferences.EnqueueLocation;\n import de.danoeh.antennapod.model.playback.Playable;\n-import org.mockito.MockedStatic;\n-import org.mockito.Mockito;\n \n import static de.danoeh.antennapod.storage.preferences.UserPreferences.EnqueueLocation.AFTER_CURRENTLY_PLAYING;\n import static de.danoeh.antennapod.storage.preferences.UserPreferences.EnqueueLocation.BACK;\n@@ -74,6 +73,7 @@ public static Iterable<Object[]> data() {\n          */\n         @Test\n         public void test() {\n+            DownloadServiceInterface.setImpl(new DownloadServiceInterfaceStub());\n             ItemEnqueuePositionCalculator calculator = new ItemEnqueuePositionCalculator(options);\n \n             // shallow copy to which the test will add items\n@@ -128,95 +128,6 @@ Playable getCurrentlyPlaying() {\n \n     }\n \n-    @RunWith(Parameterized.class)\n-    public static class PreserveDownloadOrderTest {\n-        /**\n-         * The test covers the use case that when user initiates multiple downloads in succession,\n-         * resulting in multiple addQueueItem() calls in succession.\n-         * the items in the queue will be in the same order as the order user taps to download\n-         */\n-        @Parameters(name = \"{index}: case<{0}>\")\n-        public static Iterable<Object[]> data() {\n-            // Attempts to make test more readable by showing the expected list of ids\n-            // (rather than the expected positions)\n-            return Arrays.asList(new Object[][] {\n-                    {\"download order test, enqueue default\",\n-                            concat(QUEUE_DEFAULT_IDS, 101L),\n-                            concat(QUEUE_DEFAULT_IDS, list(101L, 102L)),\n-                            concat(QUEUE_DEFAULT_IDS, list(101L, 102L, 103L)),\n-                            BACK, QUEUE_DEFAULT, ID_CURRENTLY_PLAYING_NULL},\n-                    {\"download order test, enqueue at front (currently playing has no effect)\",\n-                            concat(101L, QUEUE_DEFAULT_IDS),\n-                            concat(list(101L, 102L), QUEUE_DEFAULT_IDS),\n-                            concat(list(101L, 103L, 102L), QUEUE_DEFAULT_IDS),\n-                            // ^ 103 is put ahead of 102, after 102 failed.\n-                            // It is a limitation as the logic can't tell 102 download has failed\n-                            // (as opposed to simply being enqueued)\n-                            FRONT, QUEUE_DEFAULT, 11L}, // 11 is at the front, currently playing\n-                    {\"download order test, enqueue after currently playing\",\n-                            list(11L, 101L, 12L, 13L, 14L),\n-                            list(11L, 101L, 102L, 12L, 13L, 14L),\n-                            list(11L, 101L, 103L, 102L, 12L, 13L, 14L),\n-                            AFTER_CURRENTLY_PLAYING, QUEUE_DEFAULT, 11L}  // 11 is at the front, currently playing\n-            });\n-        }\n-\n-        @Parameter\n-        public String message;\n-\n-        @Parameter(1)\n-        public List<Long> idsExpectedAfter101;\n-\n-        @Parameter(2)\n-        public List<Long> idsExpectedAfter102;\n-\n-        @Parameter(3)\n-        public List<Long> idsExpectedAfter103;\n-\n-        @Parameter(4)\n-        public EnqueueLocation options;\n-\n-        @Parameter(5)\n-        public List<FeedItem> queueInitial;\n-\n-        @Parameter(6)\n-        public long idCurrentlyPlaying;\n-\n-        @Test\n-        public void testQueueOrderWhenDownloading2Items() {\n-            ItemEnqueuePositionCalculator calculator = new ItemEnqueuePositionCalculator(options);\n-            try (MockedStatic<DownloadService> downloadServiceMock = Mockito.mockStatic(DownloadService.class)) {\n-                List<FeedItem> queue = new ArrayList<>(queueInitial);\n-\n-                // Test body\n-                Playable currentlyPlaying = getCurrentlyPlaying(idCurrentlyPlaying);\n-                // User clicks download on feed item 101\n-                FeedItem feedItem101 = createFeedItem(101);\n-                downloadServiceMock.when(() ->\n-                        DownloadService.isDownloadingFile(feedItem101.getMedia().getDownload_url())).thenReturn(true);\n-                doAddToQueueAndAssertResult(message + \" (1st download)\",\n-                        calculator, feedItem101, queue, currentlyPlaying, idsExpectedAfter101);\n-                // Then user clicks download on feed item 102\n-                FeedItem feedItem102 = createFeedItem(102);\n-                downloadServiceMock.when(() ->\n-                        DownloadService.isDownloadingFile(feedItem102.getMedia().getDownload_url())).thenReturn(true);\n-                doAddToQueueAndAssertResult(message + \" (2nd download, it should preserve order of download)\",\n-                        calculator, feedItem102, queue, currentlyPlaying, idsExpectedAfter102);\n-                // simulate download failure case for 102\n-                downloadServiceMock.when(() ->\n-                        DownloadService.isDownloadingFile(feedItem102.getMedia().getDownload_url())).thenReturn(false);\n-                // Then user clicks download on feed item 103\n-                FeedItem feedItem103 = createFeedItem(103);\n-                downloadServiceMock.when(() ->\n-                        DownloadService.isDownloadingFile(feedItem103.getMedia().getDownload_url())).thenReturn(true);\n-                doAddToQueueAndAssertResult(message\n-                                + \" (3rd download, with 2nd download failed; \"\n-                                + \"it should be behind 1st download (unless enqueueLocation is BACK)\",\n-                        calculator, feedItem103, queue, currentlyPlaying, idsExpectedAfter103);\n-            }\n-        }\n-    }\n-\n     static void doAddToQueueAndAssertResult(String message,\n                                             ItemEnqueuePositionCalculator calculator,\n                                             FeedItem itemToAdd,\ndiff --git a/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterfaceStub.java b/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterfaceStub.java\nindex 9477464858..716d68d144 100644\n--- a/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterfaceStub.java\n+++ b/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterfaceStub.java\n@@ -1,23 +1,23 @@\n package de.danoeh.antennapod.net.download.serviceinterface;\n \n import android.content.Context;\n-import android.content.Intent;\n+import de.danoeh.antennapod.model.feed.FeedItem;\n \n public class DownloadServiceInterfaceStub extends DownloadServiceInterface {\n \n-    public void download(Context context, boolean cleanupMedia, DownloadRequest... requests) {\n+    @Override\n+    public void downloadNow(Context context, FeedItem item, boolean ignoreConstraints) {\n     }\n \n-    public Intent makeDownloadIntent(Context context, boolean cleanupMedia, DownloadRequest... requests) {\n-        return null;\n-    }\n-\n-    public void refreshAllFeeds(Context context, boolean initiatedByUser) {\n+    @Override\n+    public void download(Context context, FeedItem item) {\n     }\n \n+    @Override\n     public void cancel(Context context, String url) {\n     }\n \n+    @Override\n     public void cancelAll(Context context) {\n     }\n }\n", "problem_statement": "Retry incomplete (failed) downloads automatically\n> IO Error: Download completed but size: 15988804 does not equal expected size 75595064\n\nAutomatically start to download non-local episodes in the play list, when WLAN comes available\nI have had the situation, that I added some episodes to the play list while I'm on mobile connection. So the app asked me, if it shall download it or just add to the playlist. I choosed \"just add\". Some times later I realized that playing stopped, because no downloaded episode was available.\r\n\r\nSo I recommend to automatically start the download of any episode in the play list, which has not yet a local file, when WLAN comes available.\r\n\r\n\r\n**App version**: 1.73b/f9e7e (from F-Droid)\r\n\n", "hints_text": "Yeah, that is too little information.\nI cannot do anything with that.\n\n@sttan, what episode of what podcast were you trying to download? Does this\nhappen every time? Does it only happen with one podcast or all of them?\n\nOn Wed, Oct 7, 2015, 10:43 AM Martin Fietz notifications@github.com wrote:\n\n> Yeah, that is too little information.\n> I cannot do anything with that.\n> \n> \u2014\n> Reply to this email directly or view it on GitHub\n> https://github.com/AntennaPod/AntennaPod/issues/1250#issuecomment-146119691\n> .\n\n@TomHennen @mfietz \n\nIt happens not every time, but frequently. \n\n![](https://i.imgur.com/sVExbwl.png)\n![](https://i.imgur.com/pObdbYY.png)\n\nEpisodes above are listed here: \n\nhttps://ipn.li/itgonglun/feed\n- 164: \u65f6\u95f4\u7ebf\u6cdb\u6ee5\u7684\u65f6\u4ee3 http://ipn.li/itgonglun/164/audio.mp3 (it will redirect to http://40f447ddeb.a.uxengine.net/itgonglun/itgonglun-ep164-96kbps.mp3 with 302 status code)\n- 45: \u540c\u6027\u604b\u4e0d\u662f\u75c5\uff0c\u8bf7\u653e\u5f03\u6cbb\u7597 http://ipn.li/itgonglun/162/audio.mp3 (302 to http://40f447ddeb.a.uxengine.net/itgonglun/itgonglun-ep162-96kbps.mp3)\n\n---\n\nhttps://ipn.li/taiyilaile/feed\n- 48: \u5bb6\u957f\u5230\u5e95\u80fd\u4e0d\u80fd\u6253\u5b69\u5b50\uff1f http://ipn.li/taiyilaile/48/audio.mp3 (302 to http://40f447ddeb.a.uxengine.net/taiyilaile/taiyilaile-ep48-96kbps.mp3)\n- 45: \u540c\u6027\u604b\u4e0d\u662f\u75c5\uff0c\u8bf7\u653e\u5f03\u6cbb\u7597 http://ipn.li/taiyilaile/45/audio.mp3 (http://40f447ddeb.a.uxengine.net/taiyilaile/taiyilaile-ep45-96kbps.mp3)\n\n---\n\nhttps://ipn.li/kernelpanic/feed\n- 23: \u7a0b\u5e8f\u5458\u4e4b\u8def http://ipn.li/kernelpanic/23/audio.mp3 (http://40f447ddeb.a.uxengine.net/kernelpanic/kernelpanic-ep23-96kbps.mp3)\n- 21: Debugging http://ipn.li/kernelpanic/21/audio.mp3 (http://40f447ddeb.a.uxengine.net/kernelpanic/kernelpanic-ep21-96kbps-fixed.mp3)\n\n---\n\nI don't know if it's my network problem because I'm using a system-wide proxy to forward any traffic between me and non-China IPs to my own proxy server. \n\nAnother test. \n\n![](https://i.imgur.com/N4uBhWv.jpg)\n\nAs far as I can tell, we cannot really distinguish between an actual complete download and when the connection is lost for whatever reason.\nThe error message just notes that the (expected) file size according to the server is much higher than the amount of bytes you actually received.\n\nWe don't have an automatic retry mechanism for failed downloads yet, which would also be really hard to implement and might lead to unexpected behavior.\n\nI don't think the downloaded partial file is deleted, hitting the retry button should resume where the download left off.\n\nAs this seems to happen with different servers, the problem is probably at your end. If you have access to them, you should probably check your proxies logs or google if someone else has similar issues with the same software.\n\n@TomHennen not sure what to do about this. Should be regard this as a FR to implement retrying/resuming a failed download? Better description (\"Unexpected size\" = \"Download failed\")\n\nI think that's right. Treat these as failed downloads and then let them get\nretried? Unless we need to worry about servers that lie about the size.\n\nOn Sun, Jan 17, 2016, 5:41 AM Martin Fietz notifications@github.com wrote:\n\n> @TomHennen https://github.com/TomHennen not sure what to do about this.\n> Should be regard this as a FR to implement retrying/resuming a failed\n> download? Better description (\"Unexpected size\" = \"Download failed\")\n> \n> \u2014\n> Reply to this email directly or view it on GitHub\n> https://github.com/AntennaPod/AntennaPod/issues/1250#issuecomment-172311202\n> .\n\nIt happens to me from time to time as well, especially on wifi network connections that are not so stable (1-2 bars). \r\n\r\nWhat's more, limiting parallel downloads seems to reduce the likelihood of the error appearing: I reduced the parallel downloads from 4 to 2, the error seems to not appear (at least not as frequently).\r\n\nI live in place with bad/intermittent Internet connection, and the lack of automatic resuming makes AntennaPod really hard to use.  Thank you for your work!\nThe pending PR #2714 coincidentally addresses many cases here. See https://github.com/AntennaPod/AntennaPod/pull/2714#issuecomment-466808239\nAs per #3381: it could be interesting to introduce an (advanced) setting to set the (max) number of retries that instructs antennapod how many times failed donloads should be reinitiated.\nWould really be nice to see this implemented. I'm also often on a instable Wifi and have to restart downloads a few times until they are complete. Spotify seems to manage this in the background.\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/how-to-get-rid-of-the-red-exclamation-mark-last-update-failed-warnings/1080/12\n\nI would love to see this. Most other podcasting apps I've used will not only retry downloads that failed, they also allow scheduling a download (which might be a positive side effect of this, depending how it's implemented). So, for example, if the phone has no internet, you can tap to download an episode, and the download will start the next time the phone has internet.\r\n\r\nIn addition, it would be nice not to have a noisy notification/toast if a download fails. Just show some subtle indicator in the app that it isn't downloaded and try again the next time the phone is connected to the internet. This is often indicated in other apps by an icon showing the rough percentage (a progress circle, for example) of the episode that's been downloaded.\r\n\r\nIt seems like I've seen other error notifications too (perhaps when refreshing a podcast when there's no/spotty internet? I don't recall off the top of my head). Instead of showing an error, it would be nice if it just tried again when the device has internet connectivity.\r\n\r\nThanks!\nHaha, yes +1. I don't need a remainder that my Wifi sucks. :D\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/download-setting-to-automatically-retry-download/2066/2\n\n+1 for just-fucking-retry-it-forever-until-it-downloads-successfully\r\n\r\nThe title of this ticket doesn't seem to ask for what I want, but another issue said that *this* issue is tracking a new feature to automatically retry downloading podcasts after failure.\r\n\r\n * https://github.com/AntennaPod/AntennaPod/issues/5869#issuecomment-1119979906\r\n\r\n### Background Context\r\n\r\nI don't have a SIM card, and I live in a city where wifi is abundant, yet spotty.\r\n\r\nAs I walk around the city on any given day, my Android phone will sit in my pocket and scan for wifi connections. Usually, when I do check my phone at some point after walking around, I notice that I have a bunch of unread messages on WhatsApp. That's because WhatsApp detected that I had internet and **automatically downloaded all my messages during the brief ~60 seconds during which I was walking past a wifi hotspot. This is great!**\r\n\r\nMoreover, once I notice the messages, I can proceed to write back replies, even if I don't have Internet at this time. In WhatsApp, this works fine. Whatsapp will just queue up the messages for sending. **The next time I walk by a wifi hotspot, it will blast all my previously-failed-to-send messages out to the Internet. This is great UX!**\r\n\r\n#### Expected Behaviour\r\n\r\nA lot of the grocery stores that I shop at have free wifi. As you walk around the store, the wiif quality varies from 5% packet loss to 100% packet loss. Even though the Internet is shitty, AntennaPod should be capable of gracefully handling downloads on such connections in the background *without any user interaction whatsoever*.\r\n\r\n**I expect to be able to walk into a grocery store that has free wifi with my phone in my pocket, do my shopping, and walk out with new podcasts downloaded. I should not have to take my phone out of my pocket for this to happen**\r\n\r\nI realize that achieving this is non-trivial, but it absolutely can be done. My Android phone will automatically connect to the wifi network. AntennaPod should be able to get notified about the change of network status and immediately begin attempting to download podcasts in the background. As I move to the back of the store to buy almond milk (and packet loss rises from 5% to 100%), AntennaPod should handle this. As I move back to the front of the store to the cash register (and packet loss drops from 100% to 5%), AntennaPod should automatically retry the downloads, [picking-up where they were left-off](https://developer.mozilla.org/en-US/docs/Web/HTTP/Range_requests).\n", "created_at": "2023-04-07T16:09:07Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6417, "instance_id": "AntennaPod__AntennaPod-6417", "issue_numbers": ["5733"], "base_commit": "9b989fed432b1c9b82d7a30429f12523e3f6b145", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\nindex 43ee326801..f207339bc8 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n@@ -767,8 +767,10 @@ public void statusChanged(PlaybackServiceMediaPlayer.PSMPInfo newInfo) {\n             updateMediaSession(newInfo.playerStatus);\n             switch (newInfo.playerStatus) {\n                 case INITIALIZED:\n-                    PlaybackPreferences.writeMediaPlaying(mediaPlayer.getPSMPInfo().playable,\n-                            mediaPlayer.getPSMPInfo().playerStatus);\n+                    if (mediaPlayer.getPSMPInfo().playable != null) {\n+                        PlaybackPreferences.writeMediaPlaying(mediaPlayer.getPSMPInfo().playable,\n+                                mediaPlayer.getPSMPInfo().playerStatus);\n+                    }\n                     updateNotificationAndMediaSession(newInfo.playable);\n                     break;\n                 case PREPARED:\n", "test_patch": "", "problem_statement": "Crash after initiating playback with Chromecast\nAntennaPod crashed. Steps I took:\r\n1. Open full player (episode was paused)\r\n1. Connecting to Chromecast\r\n2. Pressing play\r\n\r\nExtra context: before it was connected to Chromecast but I paused and after a while the connection/session got stopped automatically (as expected).\r\n\r\nWhile the app crashed, playback did initiate successfully on the cast device. After app restart the player didn't recognise the state, though (episode in player was paused).\r\n\r\n## Environment\r\nAndroid version: 10\r\nOS version: 4.9.218-perf+\r\nAntennaPod version: 2.5.0-beta3\r\nModel: FP3\r\nDevice: FP3\r\nProduct: FP3\r\n\r\n## Crash info\r\nTime: 19-02-2022 16:21:49\r\nAntennaPod version: 2.5.0-beta3\r\n\r\n## StackTrace\r\n```\r\njava.lang.NullPointerException: Attempt to invoke virtual method 'long de.danoeh.antennapod.model.feed.FeedComponent.getId()' on a null object reference\r\n\tat de.danoeh.antennapod.core.preferences.PlaybackPreferences.writeMediaPlaying(SourceFile:153)\r\n\tat de.danoeh.antennapod.core.service.playback.PlaybackService$3.statusChanged(SourceFile:816)\r\n\tat de.danoeh.antennapod.playback.base.PlaybackServiceMediaPlayer.setPlayerStatus(SourceFile:334)\r\n\tat de.danoeh.antennapod.playback.base.PlaybackServiceMediaPlayer.setPlayerStatus(SourceFile:346)\r\n\tat de.danoeh.antennapod.playback.cast.CastPsmp.onRemoteMediaPlayerStatusUpdated(SourceFile:228)\r\n\tat de.danoeh.antennapod.playback.cast.CastPsmp.access$000(SourceFile:41)\r\n\tat de.danoeh.antennapod.playback.cast.CastPsmp$1.onStatusUpdated(SourceFile:98)\r\n\tat com.google.android.gms.cast.framework.media.zzbo.zza(SourceFile:6)\r\n\tat com.google.android.gms.cast.internal.zzan.zzR(SourceFile:1)\r\n\tat com.google.android.gms.cast.internal.zzan.zzL(SourceFile:50)\r\n\tat com.google.android.gms.cast.framework.media.RemoteMediaClient.onMessageReceived(SourceFile:1)\r\n\tat com.google.android.gms.cast.zzbi.run(SourceFile:4)\r\n\tat android.os.Handler.handleCallback(Handler.java:883)\r\n\tat android.os.Handler.dispatchMessage(Handler.java:100)\r\n\tat android.os.Looper.loop(Looper.java:214)\r\n\tat android.app.ActivityThread.main(ActivityThread.java:7397)\r\n\tat java.lang.reflect.Method.invoke(Native Method)\r\n\tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:492)\r\n\tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:935)\r\n```\n", "hints_text": "", "created_at": "2023-04-06T17:26:49Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6416, "instance_id": "AntennaPod__AntennaPod-6416", "issue_numbers": ["6406"], "base_commit": "e9ba45e2bd33129758e8a358ccd4c20d34f45284", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/LocalPSMP.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/LocalPSMP.java\nindex 2945cb4750..6c803d33a2 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/LocalPSMP.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/LocalPSMP.java\n@@ -884,7 +884,7 @@ public void onAudioFocusChange(final int focusChange) {\n                                 // Still did not get back the audio focus. Now actually pause.\n                                 pause(true, false);\n                             }\n-                        }, 10000);\n+                        }, 30000);\n                     }\n                 } else if (focusChange == AudioManager.AUDIOFOCUS_GAIN) {\n                     Log.d(TAG, \"Gained audio focus\");\n", "test_patch": "", "problem_statement": "Not restarting after Strava audio updates\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.0.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n13\n\n### Device model\n\nPixel 7 pro\n\n### First occurred\n\nAbout 1 week ago\n\n### Steps to reproduce\n\nListen to a podcast while Strava is recording a run\r\nEnable Strava audio alerts\r\nWhen a Strava alert occurs, the podcast pauses, as expected\r\nBut after the audio alert, it fails to restart the podcast\r\nThis didn't used to be a problem\r\nIt is not a problem with other audio apps I use and Strava\n\n### Expected behaviour\n\nRestart playing the podcast once the Strava audio alert has finished\n\n### Current behaviour\n\nDoesn't restart - I have to click to get the podcast playing again\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2023-04-06T17:16:48Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6415, "instance_id": "AntennaPod__AntennaPod-6415", "issue_numbers": ["5908"], "base_commit": "9b989fed432b1c9b82d7a30429f12523e3f6b145", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/sync/EpisodeActionFilter.java b/core/src/main/java/de/danoeh/antennapod/core/sync/EpisodeActionFilter.java\nindex 184f247939..8250ab87e5 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/sync/EpisodeActionFilter.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/sync/EpisodeActionFilter.java\n@@ -25,8 +25,6 @@ public static Map<Pair<String, String>, EpisodeAction> getRemoteActionsOverridin\n             Pair<String, String> key = new Pair<>(remoteAction.getPodcast(), remoteAction.getEpisode());\n             switch (remoteAction.getAction()) {\n                 case NEW:\n-                    remoteActionsThatOverrideLocalActions.put(key, remoteAction);\n-                    break;\n                 case DOWNLOAD:\n                     break;\n                 case PLAY:\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/sync/SyncService.java b/core/src/main/java/de/danoeh/antennapod/core/sync/SyncService.java\nindex 2fd492cbda..7fe0c5e46b 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/sync/SyncService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/sync/SyncService.java\n@@ -274,10 +274,6 @@ private synchronized void processEpisodeActions(List<EpisodeAction> remoteAction\n                 Log.i(TAG, \"Feed item has no media: \" + action);\n                 continue;\n             }\n-            if (action.getAction() == EpisodeAction.NEW) {\n-                DBWriter.markItemPlayed(feedItem, FeedItem.UNPLAYED, true);\n-                continue;\n-            }\n             feedItem.getMedia().setPosition(action.getPosition() * 1000);\n             if (FeedItemUtil.hasAlmostEnded(feedItem.getMedia())) {\n                 Log.d(TAG, \"Marking as played: \" + action);\n", "test_patch": "", "problem_statement": "Gpodder nextcloud doesn't seem to be keeping things in sync\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n2.5.2\n\n### Where did you get the app from\n\nF-Droid\n\n### Android version\n\nAndroid 12 / CalyxOS 3.5.1\n\n### Device model\n\nPixel 4a\n\n### First occurred\n\nMany weeks ago\n\n### Steps to reproduce\n\n_No response_\n\n### Expected behaviour\n\nPodcasts that I have listened to on one device and marked completed should sync to other devic\n\n### Current behaviour\n\nPodcasts stay on the other device after they have been deleted from a device. The play position seems to be at least partially syncing as if you go into a podcast they have play positions in the middle of an episode, they just never seem to get to the end of the episode.\r\n\r\nI am frankly scared to try a 'force fully syncronisation' as when I first added another device to gpodder nextcloud sync it seemed to mark every episode as unplayed which led to me having to delete thousands of episodes.\r\n\r\n<img src=\"https://user-images.githubusercontent.com/43154960/169801048-4ad4a12c-4f1e-4037-9968-a91a1749bfd5.png\" width=20% height=20%>\r\n\r\n<img src=\"https://user-images.githubusercontent.com/43154960/169801041-aad9eb1c-57ea-41db-9a02-39b734038a5c.png\" width=20% height=20%>\n\n### Logs\n\n_No response_\n", "hints_text": "> Podcasts stay on the other device after they have been deleted from a device.\r\n\r\nDo you mean subscriptions or episodes?\r\n\r\n> I am frankly scared to try a 'force fully syncronisation' as when I first added another device to gpodder nextcloud sync it seemed to mark every episode as unplayed which led to me having to delete thousands of episodes.\r\n\r\nThis could be caused by the sync server saying that the episode is \"new\". What gpodder server do you use? What other device are you syncing to (also AntennaPod?)?\nI will reply, but I gave up on this a long time ago so I don't know if the issues still persist.\r\n\r\n> Do you mean subscriptions or episodes?\r\n\r\nEpisodes. You can see in the first image the up to date status of each subscription. The second image shows that there are many episodes that are still not marked as played (and therefore removed) even though they have be marked as played on the first device\r\n\r\n> This could be caused by the sync server saying that the episode is \"new\". What gpodder server do you use? What other device are you syncing to (also AntennaPod?)?\r\n\r\nI was using gpodder sync via nextcloud - https://apps.nextcloud.com/apps/gpoddersync. You can see in the images that is was Antennapod on another phone, but it was also the case for Antennapod on a tablet that I was trying to sync.\r\n\r\nI communicated this poorly though as there were 2 main issues;\r\n\r\n- Issue 1 was that the episode were not properly marked as played on other devices\r\n\r\n- Issue 2 was that when a new device was added to the sync, lots of old episodes would be marked as unplayed, so hundreds of old episodes would appear on all devices. So because of Issue 1 I would have to mark those episodes as played on every device which would take a long time - Hence why I was afraid to add a device or force a full sync\r\n\r\n", "created_at": "2023-04-06T17:12:25Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6407, "instance_id": "AntennaPod__AntennaPod-6407", "issue_numbers": ["6337"], "base_commit": "78f65349d597a2d3b251323f1ea4def77c4993d4", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/fragment/ItemPagerFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/ItemPagerFragment.java\nindex 762d919f49..f2cd02ceca 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/ItemPagerFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/ItemPagerFragment.java\n@@ -48,7 +48,7 @@ public static ItemPagerFragment newInstance(long[] feeditems, int feedItemPos) {\n         ItemPagerFragment fragment = new ItemPagerFragment();\n         Bundle args = new Bundle();\n         args.putLongArray(ARG_FEEDITEMS, feeditems);\n-        args.putInt(ARG_FEEDITEM_POS, feedItemPos);\n+        args.putInt(ARG_FEEDITEM_POS, Math.max(0, feedItemPos));\n         fragment.setArguments(args);\n         return fragment;\n     }\n", "test_patch": "", "problem_statement": "Crash when skipping quickly past the end of an episode\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.0.0 beta 5\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\nI triggered another unusual crash today. Getting quite talented at it. :)\r\n\r\nSteps:\r\n1. Played an episode (last in the queue)\r\n2. I first moved close to the end of the episode via the seek bar, then used the fast forward button to reach (past) the end. Both actions performed in very quick succession.\n\n### Expected behaviour\n\n_No response_\n\n### Current behaviour\n\n_No response_\n\n### Logs\n\n## Environment\r\nAndroid version: 12\r\nOS version: 4.9.292-gab4493f31457-ab8272301\r\nAntennaPod version: 3.0.0-beta5\r\nModel: Pixel 3a\r\nDevice: sargo\r\nProduct: sargo\r\n\r\n## Crash info\r\nTime: 21-02-2023 22:02:31\r\nAntennaPod version: 3.0.0-beta5\r\n\r\n## StackTrace\r\n```\r\njava.lang.ArrayIndexOutOfBoundsException: length=61; index=-1\r\n\tat de.danoeh.antennapod.fragment.ItemPagerFragment.onCreateView(SourceFile:89)\r\n\tat androidx.fragment.app.Fragment.performCreateView(SourceFile:2963)\r\n\tat androidx.fragment.app.FragmentStateManager.createView(SourceFile:518)\r\n\tat androidx.fragment.app.FragmentStateManager.moveToExpectedState(SourceFile:282)\r\n\tat androidx.fragment.app.FragmentManager.executeOpsTogether(SourceFile:2189)\r\n\tat androidx.fragment.app.FragmentManager.removeRedundantOperationsAndExecute(SourceFile:2100)\r\n\tat androidx.fragment.app.FragmentManager.execPendingActions(SourceFile:2002)\r\n\tat androidx.fragment.app.FragmentManager$5.run(SourceFile:524)\r\n\tat android.os.Handler.handleCallback(Handler.java:938)\r\n\tat android.os.Handler.dispatchMessage(Handler.java:99)\r\n\tat android.os.Looper.loopOnce(Looper.java:201)\r\n\tat android.os.Looper.loop(Looper.java:288)\r\n\tat android.app.ActivityThread.main(ActivityThread.java:7870)\r\n\tat java.lang.reflect.Method.invoke(Native Method)\r\n\tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548)\r\n\tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1003)\r\n```\r\n\r\n\n", "hints_text": "it seems impossible.\r\nfor the 'feedItemPos' initialed by 'getArguments().getInt(ARG_FEEDITEM_POS)', the getInt method will feedback value 0 in abnomal contidions.", "created_at": "2023-04-02T08:07:53Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6403, "instance_id": "AntennaPod__AntennaPod-6403", "issue_numbers": ["6156"], "base_commit": "214bf974cff3041dfc157360d026f61e371aa95e", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/storage/ItemEnqueuePositionCalculator.java b/core/src/main/java/de/danoeh/antennapod/core/storage/ItemEnqueuePositionCalculator.java\nindex 23d308c027..b81f281e8f 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/storage/ItemEnqueuePositionCalculator.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/storage/ItemEnqueuePositionCalculator.java\n@@ -6,6 +6,7 @@\n import androidx.annotation.Nullable;\n \n import java.util.List;\n+import java.util.Random;\n \n import de.danoeh.antennapod.core.service.download.DownloadService;\n import de.danoeh.antennapod.model.feed.FeedItem;\n@@ -46,6 +47,9 @@ public int calcPosition(@NonNull List<FeedItem> curQueue, @Nullable Playable cur\n                 int currentlyPlayingPosition = getCurrentlyPlayingPosition(curQueue, currentPlaying);\n                 return getPositionOfFirstNonDownloadingItem(\n                         currentlyPlayingPosition + 1, curQueue);\n+            case RANDOM:\n+                Random random = new Random();\n+                return random.nextInt(curQueue.size() + 1);\n             default:\n                 throw new AssertionError(\"calcPosition() : unrecognized enqueueLocation option: \" + enqueueLocation);\n         }\ndiff --git a/core/src/main/res/values/arrays.xml b/core/src/main/res/values/arrays.xml\nindex f3c0a0a3cb..7749c6f3c8 100644\n--- a/core/src/main/res/values/arrays.xml\n+++ b/core/src/main/res/values/arrays.xml\n@@ -161,6 +161,7 @@\n         <item>@string/enqueue_location_back</item>\n         <item>@string/enqueue_location_front</item>\n         <item>@string/enqueue_location_after_current</item>\n+        <item>@string/enqueue_location_random</item>\n     </string-array>\n \n     <string-array name=\"enqueue_location_values\">\n@@ -168,6 +169,7 @@\n         <item>BACK</item>\n         <item>FRONT</item>\n         <item>AFTER_CURRENTLY_PLAYING</item>\n+        <item>RANDOM</item>\n     </string-array>\n \n     <string-array name=\"episode_cleanup_values\">\ndiff --git a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\nindex 8a4d248eec..fda95ccd73 100644\n--- a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n+++ b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n@@ -345,7 +345,7 @@ public static void setEnqueueDownloadedEpisodes(boolean enqueueDownloadedEpisode\n     }\n \n     public enum EnqueueLocation {\n-        BACK, FRONT, AFTER_CURRENTLY_PLAYING\n+        BACK, FRONT, AFTER_CURRENTLY_PLAYING, RANDOM\n     }\n \n     @NonNull\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex e45cfd481d..2a2f7b6d1c 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -492,6 +492,7 @@\n     <string name=\"enqueue_location_back\">Back</string>\n     <string name=\"enqueue_location_front\">Front</string>\n     <string name=\"enqueue_location_after_current\">After current episode</string>\n+    <string name=\"enqueue_location_random\">Random</string>\n     <string name=\"pref_smart_mark_as_played_disabled\">Disabled</string>\n     <string name=\"documentation_support\">Documentation &amp; Support</string>\n     <string name=\"visit_user_forum\">User forum</string>\n", "test_patch": "diff --git a/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java b/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java\nindex 1b81003928..be947bc1e1 100644\n--- a/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java\n+++ b/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java\n@@ -123,6 +123,7 @@ public void testEnqueueLocation() {\n         doTestEnqueueLocation(R.string.enqueue_location_after_current, EnqueueLocation.AFTER_CURRENTLY_PLAYING);\n         doTestEnqueueLocation(R.string.enqueue_location_front, EnqueueLocation.FRONT);\n         doTestEnqueueLocation(R.string.enqueue_location_back, EnqueueLocation.BACK);\n+        doTestEnqueueLocation(R.string.enqueue_location_random, EnqueueLocation.RANDOM);\n     }\n \n     private void doTestEnqueueLocation(@StringRes int optionResId, EnqueueLocation expected) {\n", "problem_statement": "Add \"random place\" option to the the \"Insert into playlist position\" selection\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n2.7.1\n\n### Where did you get the app from\n\nGoogle Play\n\n### Problem you may be having, or feature you want\n\nYou can currently choose that new episodes should be added to the playlist automatically. You are given a few choices where you would like to add the new episode in.\r\n\r\nBut one choice that is missing that the new episodes should be added in a random place in the playlist, to keep a randomized playlist permanently randomized. (Choosing random sort order for the playlist is a one-time thing, and is destroyed when new episodes are added.)\n\n### Suggested solution\n\nAdd the option.\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "", "created_at": "2023-03-29T20:08:50Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6400, "instance_id": "AntennaPod__AntennaPod-6400", "issue_numbers": ["5603"], "base_commit": "5ae766b1a1557e2a54627e6b3c83c54c6578995d", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/DeleteActionButton.java b/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/DeleteActionButton.java\nindex 096d060c1f..16a5a161c9 100644\n--- a/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/DeleteActionButton.java\n+++ b/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/DeleteActionButton.java\n@@ -4,10 +4,14 @@\n import android.view.View;\n import androidx.annotation.DrawableRes;\n import androidx.annotation.StringRes;\n+\n+import java.util.Collections;\n+\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedMedia;\n import de.danoeh.antennapod.core.storage.DBWriter;\n+import de.danoeh.antennapod.view.LocalDeleteModal;\n \n public class DeleteActionButton extends ItemActionButton {\n \n@@ -33,11 +37,17 @@ public void onClick(Context context) {\n         if (media == null) {\n             return;\n         }\n-        DBWriter.deleteFeedMediaOfItem(context, media.getId());\n+\n+        LocalDeleteModal.showLocalFeedDeleteWarningIfNecessary(context, Collections.singletonList(item),\n+                () -> DBWriter.deleteFeedMediaOfItem(context, media.getId()));\n     }\n \n     @Override\n     public int getVisibility() {\n-        return (item.getMedia() != null && item.getMedia().isDownloaded()) ? View.VISIBLE : View.INVISIBLE;\n+        if (item.getMedia() != null && (item.getMedia().isDownloaded() || item.getFeed().isLocalFeed())) {\n+            return View.VISIBLE;\n+        }\n+\n+        return View.INVISIBLE;\n     }\n }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/AddFeedFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/AddFeedFragment.java\nindex 6a72348bc3..29be41727b 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/AddFeedFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/AddFeedFragment.java\n@@ -197,8 +197,8 @@ private void addLocalFolderResult(final Uri uri) {\n     }\n \n     private Feed addLocalFolder(Uri uri) {\n-        getActivity().getContentResolver()\n-                .takePersistableUriPermission(uri, Intent.FLAG_GRANT_READ_URI_PERMISSION);\n+        getActivity().getContentResolver().takePersistableUriPermission(uri,\n+                Intent.FLAG_GRANT_READ_URI_PERMISSION | Intent.FLAG_GRANT_WRITE_URI_PERMISSION);\n         DocumentFile documentFile = DocumentFile.fromTreeUri(getContext(), uri);\n         if (documentFile == null) {\n             throw new IllegalArgumentException(\"Unable to retrieve document tree\");\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/FeedItemlistFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/FeedItemlistFragment.java\nindex 6b6fedd1f9..1c949218ab 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/FeedItemlistFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/FeedItemlistFragment.java\n@@ -367,7 +367,6 @@ public void onStartSelectMode() {\n         swipeActions.detach();\n         if (feed.isLocalFeed()) {\n             speedDialBinding.fabSD.removeActionItemById(R.id.download_batch);\n-            speedDialBinding.fabSD.removeActionItemById(R.id.delete_batch);\n         }\n         speedDialBinding.fabSD.removeActionItemById(R.id.remove_all_inbox_item);\n         speedDialBinding.fabSD.setVisibility(View.VISIBLE);\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/FeedSettingsFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/FeedSettingsFragment.java\nindex ae9e003d50..45faba3336 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/FeedSettingsFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/FeedSettingsFragment.java\n@@ -172,7 +172,6 @@ public void onCreatePreferences(Bundle savedInstanceState, String rootKey) {\n \n                         if (feed.isLocalFeed()) {\n                             findPreference(PREF_AUTHENTICATION).setVisible(false);\n-                            findPreference(PREF_AUTO_DELETE).setVisible(false);\n                             findPreference(PREF_CATEGORY_AUTO_DOWNLOAD).setVisible(false);\n                         }\n \ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/actions/EpisodeMultiSelectActionHandler.java b/app/src/main/java/de/danoeh/antennapod/fragment/actions/EpisodeMultiSelectActionHandler.java\nindex a14bfcd162..618c411eac 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/actions/EpisodeMultiSelectActionHandler.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/actions/EpisodeMultiSelectActionHandler.java\n@@ -14,6 +14,7 @@\n import de.danoeh.antennapod.core.storage.DBWriter;\n import de.danoeh.antennapod.core.util.LongList;\n import de.danoeh.antennapod.model.feed.FeedItem;\n+import de.danoeh.antennapod.view.LocalDeleteModal;\n \n public class EpisodeMultiSelectActionHandler {\n     private static final String TAG = \"EpisodeSelectHandler\";\n@@ -41,7 +42,7 @@ public void handleAction(List<FeedItem> items) {\n         } else if (actionId == R.id.download_batch) {\n             downloadChecked(items);\n         } else if (actionId == R.id.delete_batch) {\n-            deleteChecked(items);\n+            LocalDeleteModal.showLocalFeedDeleteWarningIfNecessary(activity, items, () -> deleteChecked(items));\n         } else {\n             Log.e(TAG, \"Unrecognized speed dial action item. Do nothing. id=\" + actionId);\n         }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/DownloadsPreferencesFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/DownloadsPreferencesFragment.java\nindex 7b0c3efdfe..c17066fef2 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/DownloadsPreferencesFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/DownloadsPreferencesFragment.java\n@@ -2,8 +2,12 @@\n \n import android.content.SharedPreferences;\n import android.os.Bundle;\n+\n import androidx.preference.PreferenceFragmentCompat;\n import androidx.preference.PreferenceManager;\n+import androidx.preference.TwoStatePreference;\n+\n+import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.PreferenceActivity;\n import de.danoeh.antennapod.core.util.download.FeedUpdateManager;\n@@ -17,9 +21,12 @@\n public class DownloadsPreferencesFragment extends PreferenceFragmentCompat\n         implements SharedPreferences.OnSharedPreferenceChangeListener {\n     private static final String PREF_SCREEN_AUTODL = \"prefAutoDownloadSettings\";\n+    private static final String PREF_AUTO_DELETE_LOCAL = \"prefAutoDeleteLocal\";\n     private static final String PREF_PROXY = \"prefProxy\";\n     private static final String PREF_CHOOSE_DATA_DIR = \"prefChooseDataDir\";\n \n+    private boolean blockAutoDeleteLocal = true;\n+\n     @Override\n     public void onCreatePreferences(Bundle savedInstanceState, String rootKey) {\n         addPreferencesFromResource(R.xml.preferences_downloads);\n@@ -63,6 +70,14 @@ private void setupNetworkScreen() {\n             });\n             return true;\n         });\n+        findPreference(PREF_AUTO_DELETE_LOCAL).setOnPreferenceChangeListener((preference, newValue) -> {\n+            if (blockAutoDeleteLocal && newValue == Boolean.TRUE) {\n+                showAutoDeleteEnableDialog();\n+                return false;\n+            } else {\n+                return true;\n+            }\n+        });\n     }\n \n     private void setDataFolderText() {\n@@ -78,4 +93,16 @@ public void onSharedPreferenceChanged(SharedPreferences sharedPreferences, Strin\n             FeedUpdateManager.restartUpdateAlarm(getContext(), true);\n         }\n     }\n+\n+    private void showAutoDeleteEnableDialog() {\n+        new MaterialAlertDialogBuilder(requireContext())\n+            .setMessage(R.string.pref_auto_local_delete_dialog_body)\n+            .setPositiveButton(R.string.yes, (dialog, which) -> {\n+                blockAutoDeleteLocal = false;\n+                ((TwoStatePreference) findPreference(PREF_AUTO_DELETE_LOCAL)).setChecked(true);\n+                blockAutoDeleteLocal = true;\n+            })\n+            .setNegativeButton(R.string.cancel_label, null)\n+            .show();\n+    }\n }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/swipeactions/DeleteSwipeAction.java b/app/src/main/java/de/danoeh/antennapod/fragment/swipeactions/DeleteSwipeAction.java\nindex a4c69eb2bb..e196b96b47 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/swipeactions/DeleteSwipeAction.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/swipeactions/DeleteSwipeAction.java\n@@ -2,10 +2,14 @@\n \n import android.content.Context;\n import androidx.fragment.app.Fragment;\n+\n+import java.util.Collections;\n+\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.core.storage.DBWriter;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n+import de.danoeh.antennapod.view.LocalDeleteModal;\n \n public class DeleteSwipeAction implements SwipeAction {\n \n@@ -31,14 +35,16 @@ public String getTitle(Context context) {\n \n     @Override\n     public void performAction(FeedItem item, Fragment fragment, FeedItemFilter filter) {\n-        if (!item.isDownloaded()) {\n+        if (!item.isDownloaded() && !item.getFeed().isLocalFeed()) {\n             return;\n         }\n-        DBWriter.deleteFeedMediaOfItem(fragment.requireContext(), item.getMedia().getId());\n+        LocalDeleteModal.showLocalFeedDeleteWarningIfNecessary(\n+                fragment.requireContext(), Collections.singletonList(item),\n+                () -> DBWriter.deleteFeedMediaOfItem(fragment.requireContext(), item.getMedia().getId()));\n     }\n \n     @Override\n     public boolean willRemove(FeedItemFilter filter, FeedItem item) {\n-        return filter.showDownloaded && item.isDownloaded();\n+        return filter.showDownloaded && (item.isDownloaded() || item.getFeed().isLocalFeed());\n     }\n }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/menuhandler/FeedItemMenuHandler.java b/app/src/main/java/de/danoeh/antennapod/menuhandler/FeedItemMenuHandler.java\nindex 4de53ce1e5..e2852f8691 100644\n--- a/app/src/main/java/de/danoeh/antennapod/menuhandler/FeedItemMenuHandler.java\n+++ b/app/src/main/java/de/danoeh/antennapod/menuhandler/FeedItemMenuHandler.java\n@@ -12,10 +12,12 @@\n \n import com.google.android.material.snackbar.Snackbar;\n \n+import java.util.Arrays;\n+\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.MainActivity;\n import de.danoeh.antennapod.core.preferences.PlaybackPreferences;\n-import de.danoeh.antennapod.storage.preferences.UserPreferences;\n+import de.danoeh.antennapod.core.util.FeedUtil;\n import de.danoeh.antennapod.core.receiver.MediaButtonReceiver;\n import de.danoeh.antennapod.core.service.playback.PlaybackServiceInterface;\n import de.danoeh.antennapod.core.storage.DBWriter;\n@@ -29,6 +31,7 @@\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedMedia;\n import de.danoeh.antennapod.net.sync.model.EpisodeAction;\n+import de.danoeh.antennapod.view.LocalDeleteModal;\n \n /**\n  * Handles interactions with the FeedItemMenu.\n@@ -56,6 +59,7 @@ public static boolean onPrepareMenu(Menu menu, FeedItem selectedItem) {\n         final boolean isPlaying = hasMedia && PlaybackStatus.isPlaying(selectedItem.getMedia());\n         final boolean isInQueue = selectedItem.isTagged(FeedItem.TAG_QUEUE);\n         final boolean fileDownloaded = hasMedia && selectedItem.getMedia().fileExists();\n+        final boolean isLocalFile = hasMedia && selectedItem.getFeed().isLocalFeed();\n         final boolean isFavorite = selectedItem.isTagged(FeedItem.TAG_FAVORITE);\n \n         setItemVisibility(menu, R.id.skip_episode_item, isPlaying);\n@@ -80,7 +84,7 @@ public static boolean onPrepareMenu(Menu menu, FeedItem selectedItem) {\n \n         setItemVisibility(menu, R.id.add_to_favorites_item, !isFavorite);\n         setItemVisibility(menu, R.id.remove_from_favorites_item, isFavorite);\n-        setItemVisibility(menu, R.id.remove_item, fileDownloaded);\n+        setItemVisibility(menu, R.id.remove_item, fileDownloaded || isLocalFile);\n         return true;\n     }\n \n@@ -148,7 +152,8 @@ public static boolean onMenuItemClicked(@NonNull Fragment fragment, int menuItem\n         if (menuItemId == R.id.skip_episode_item) {\n             context.sendBroadcast(MediaButtonReceiver.createIntent(context, KeyEvent.KEYCODE_MEDIA_NEXT));\n         } else if (menuItemId == R.id.remove_item) {\n-            DBWriter.deleteFeedMediaOfItem(context, selectedItem.getMedia().getId());\n+            LocalDeleteModal.showLocalFeedDeleteWarningIfNecessary(context, Arrays.asList(selectedItem),\n+                    () -> DBWriter.deleteFeedMediaOfItem(context, selectedItem.getMedia().getId()));\n         } else if (menuItemId == R.id.remove_inbox_item) {\n             removeNewFlagWithUndo(fragment, selectedItem);\n         } else if (menuItemId == R.id.mark_read_item) {\n@@ -225,7 +230,8 @@ public static void markReadWithUndo(@NonNull Fragment fragment, FeedItem item,\n         final Handler h = new Handler(fragment.requireContext().getMainLooper());\n         final Runnable r = () -> {\n             FeedMedia media = item.getMedia();\n-            if (media != null && FeedItemUtil.hasAlmostEnded(media) && UserPreferences.isAutoDelete()) {\n+            boolean shouldAutoDelete = FeedUtil.shouldAutoDeleteItemsOnThatFeed(item.getFeed());\n+            if (media != null && FeedItemUtil.hasAlmostEnded(media) && shouldAutoDelete) {\n                 DBWriter.deleteFeedMediaOfItem(fragment.requireContext(), media.getId());\n             }\n         };\ndiff --git a/app/src/main/java/de/danoeh/antennapod/view/LocalDeleteModal.java b/app/src/main/java/de/danoeh/antennapod/view/LocalDeleteModal.java\nnew file mode 100644\nindex 0000000000..4241cadca3\n--- /dev/null\n+++ b/app/src/main/java/de/danoeh/antennapod/view/LocalDeleteModal.java\n@@ -0,0 +1,32 @@\n+package de.danoeh.antennapod.view;\n+\n+import android.content.Context;\n+\n+import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n+import de.danoeh.antennapod.ui.i18n.R;\n+import de.danoeh.antennapod.model.feed.FeedItem;\n+\n+public class LocalDeleteModal {\n+    public static void showLocalFeedDeleteWarningIfNecessary(Context context, Iterable<FeedItem> items,\n+                                                             Runnable deleteCommand) {\n+        boolean anyLocalFeed = false;\n+        for (FeedItem item : items) {\n+            if (item.getFeed().isLocalFeed()) {\n+                anyLocalFeed = true;\n+                break;\n+            }\n+        }\n+\n+        if (!anyLocalFeed) {\n+            deleteCommand.run();\n+            return;\n+        }\n+\n+        new MaterialAlertDialogBuilder(context)\n+            .setTitle(R.string.delete_episode_label)\n+            .setMessage(R.string.delete_local_feed_warning_body)\n+            .setPositiveButton(R.string.delete_label, (dialog, which) -> deleteCommand.run())\n+            .setNegativeButton(R.string.cancel_label, null)\n+            .show();\n+    }\n+}\ndiff --git a/app/src/main/res/xml/preferences_downloads.xml b/app/src/main/res/xml/preferences_downloads.xml\nindex 18fc7df111..ba7203566c 100644\n--- a/app/src/main/res/xml/preferences_downloads.xml\n+++ b/app/src/main/res/xml/preferences_downloads.xml\n@@ -33,6 +33,12 @@\n             android:key=\"prefAutoDelete\"\n             android:summary=\"@string/pref_auto_delete_sum\"\n             android:title=\"@string/pref_auto_delete_title\"/>\n+        <SwitchPreferenceCompat\n+            android:defaultValue=\"false\"\n+            android:enabled=\"true\"\n+            android:key=\"prefAutoDeleteLocal\"\n+            android:summary=\"@string/pref_auto_local_delete_sum\"\n+            android:title=\"@string/pref_auto_local_delete_title\"/>\n         <SwitchPreferenceCompat\n             android:defaultValue=\"true\"\n             android:enabled=\"true\"\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/feed/LocalFeedUpdater.java b/core/src/main/java/de/danoeh/antennapod/core/feed/LocalFeedUpdater.java\nindex 03881ee4f7..52b2d61dca 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/feed/LocalFeedUpdater.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/feed/LocalFeedUpdater.java\n@@ -37,7 +37,6 @@\n import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedMedia;\n-import de.danoeh.antennapod.model.feed.FeedPreferences;\n import de.danoeh.antennapod.model.playback.MediaType;\n import de.danoeh.antennapod.parser.feed.util.MimeTypeUtils;\n import de.danoeh.antennapod.parser.media.id3.ID3ReaderException;\n@@ -124,13 +123,9 @@ static void tryUpdateFeed(Feed feed, Context context, Uri folderUri,\n         feed.setImageUrl(getImageUrl(allFiles, folderUri));\n \n         feed.getPreferences().setAutoDownload(false);\n-        feed.getPreferences().setAutoDeleteAction(FeedPreferences.AutoDeleteAction.NEVER);\n         feed.setDescription(context.getString(R.string.local_feed_description));\n         feed.setAuthor(context.getString(R.string.local_folder));\n \n-        if (newItems.isEmpty()) {\n-            throw new IOException(\"Empty folder. Make sure that the folder is accessible and contains media files.\");\n-        }\n         DBTasks.updateFeed(context, feed, true);\n     }\n \ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\nindex 6fc9035cac..fa1bb7b184 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n@@ -65,6 +65,7 @@\n import de.danoeh.antennapod.core.storage.FeedSearcher;\n import de.danoeh.antennapod.core.sync.queue.SynchronizationQueueSink;\n import de.danoeh.antennapod.core.util.FeedItemUtil;\n+import de.danoeh.antennapod.core.util.FeedUtil;\n import de.danoeh.antennapod.core.util.IntentUtils;\n import de.danoeh.antennapod.core.util.NetworkUtils;\n import de.danoeh.antennapod.core.util.gui.NotificationUtils;\n@@ -1098,7 +1099,8 @@ private void onPostPlayback(final Playable playable, boolean ended, boolean skip\n                 FeedPreferences.AutoDeleteAction action =\n                         item.getFeed().getPreferences().getCurrentAutoDelete();\n                 boolean shouldAutoDelete = action == FeedPreferences.AutoDeleteAction.ALWAYS\n-                        || (action == FeedPreferences.AutoDeleteAction.GLOBAL && UserPreferences.isAutoDelete());\n+                        || (action == FeedPreferences.AutoDeleteAction.GLOBAL\n+                                && FeedUtil.shouldAutoDeleteItemsOnThatFeed(item.getFeed()));\n                 if (shouldAutoDelete && (!item.isTagged(FeedItem.TAG_FAVORITE)\n                         || !UserPreferences.shouldFavoriteKeepEpisode())) {\n                     DBWriter.deleteFeedMediaOfItem(PlaybackService.this, media.getId());\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/storage/DBWriter.java b/core/src/main/java/de/danoeh/antennapod/core/storage/DBWriter.java\nindex 11e82af27b..f7e8592e1f 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/storage/DBWriter.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/storage/DBWriter.java\n@@ -2,15 +2,22 @@\n \n import android.app.backup.BackupManager;\n import android.content.Context;\n+import android.net.Uri;\n import android.util.Log;\n \n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n import androidx.core.app.NotificationManagerCompat;\n+import androidx.documentfile.provider.DocumentFile;\n \n+import com.google.common.util.concurrent.Futures;\n+\n+import de.danoeh.antennapod.core.event.DownloadLogEvent;\n+import de.danoeh.antennapod.core.feed.LocalFeedUpdater;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n import de.danoeh.antennapod.core.service.playback.PlaybackServiceInterface;\n import de.danoeh.antennapod.storage.database.PodDBAdapter;\n+\n import org.greenrobot.eventbus.EventBus;\n \n import java.io.File;\n@@ -25,7 +32,6 @@\n import java.util.concurrent.TimeUnit;\n \n import de.danoeh.antennapod.core.R;\n-import de.danoeh.antennapod.core.event.DownloadLogEvent;\n import de.danoeh.antennapod.event.FavoritesEvent;\n import de.danoeh.antennapod.event.FeedItemEvent;\n import de.danoeh.antennapod.event.FeedListUpdateEvent;\n@@ -94,7 +100,7 @@ public static void tearDownTests() {\n      */\n     public static Future<?> deleteFeedMediaOfItem(@NonNull final Context context,\n                                                   final long mediaId) {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             final FeedMedia media = DBReader.getFeedMedia(mediaId);\n             if (media != null) {\n                 boolean result = deleteFeedMediaSynchronous(context, media);\n@@ -106,10 +112,10 @@ public static Future<?> deleteFeedMediaOfItem(@NonNull final Context context,\n         });\n     }\n \n-    private static boolean deleteFeedMediaSynchronous(\n-            @NonNull Context context, @NonNull FeedMedia media) {\n+    private static boolean deleteFeedMediaSynchronous(@NonNull Context context, @NonNull FeedMedia media) {\n         Log.i(TAG, String.format(Locale.US, \"Requested to delete FeedMedia [id=%d, title=%s, downloaded=%s\",\n                 media.getId(), media.getEpisodeTitle(), media.isDownloaded()));\n+        boolean localDelete = false;\n         if (media.isDownloaded()) {\n             // delete downloaded media file\n             File mediaFile = new File(media.getFile_url());\n@@ -125,23 +131,38 @@ private static boolean deleteFeedMediaSynchronous(\n             adapter.open();\n             adapter.setMedia(media);\n             adapter.close();\n+        } else if (media.getFile_url().startsWith(\"content://\")) {\n+            // Local feed\n+            DocumentFile documentFile = DocumentFile.fromSingleUri(\n+                    context, Uri.parse(media.getFile_url()));\n+            if (documentFile == null || !documentFile.exists() || !documentFile.delete()) {\n+                EventBus.getDefault().post(new MessageEvent(context.getString(R.string.delete_local_failed)));\n+                return false;\n+            }\n+            localDelete = true;\n+        }\n \n-            if (media.getId() == PlaybackPreferences.getCurrentlyPlayingFeedMediaId()) {\n-                PlaybackPreferences.writeNoMediaPlaying();\n-                IntentUtils.sendLocalBroadcast(context, PlaybackServiceInterface.ACTION_SHUTDOWN_PLAYBACK_SERVICE);\n+        if (media.getId() == PlaybackPreferences.getCurrentlyPlayingFeedMediaId()) {\n+            PlaybackPreferences.writeNoMediaPlaying();\n+            IntentUtils.sendLocalBroadcast(context, PlaybackServiceInterface.ACTION_SHUTDOWN_PLAYBACK_SERVICE);\n \n-                NotificationManagerCompat nm = NotificationManagerCompat.from(context);\n-                nm.cancel(R.id.notification_playing);\n-            }\n+            NotificationManagerCompat nm = NotificationManagerCompat.from(context);\n+            nm.cancel(R.id.notification_playing);\n+        }\n \n+        if (localDelete) {\n+            // Do full update of this feed to get rid of the item\n+            LocalFeedUpdater.updateFeed(media.getItem().getFeed(), context.getApplicationContext(), null);\n+        } else {\n             // Gpodder: queue delete action for synchronization\n             FeedItem item = media.getItem();\n             EpisodeAction action = new EpisodeAction.Builder(item, EpisodeAction.DELETE)\n                     .currentTimestamp()\n                     .build();\n             SynchronizationQueueSink.enqueueEpisodeActionIfSynchronizationIsActive(context, action);\n+\n+            EventBus.getDefault().post(FeedItemEvent.updated(media.getItem()));\n         }\n-        EventBus.getDefault().post(FeedItemEvent.updated(media.getItem()));\n         return true;\n     }\n \n@@ -152,7 +173,7 @@ private static boolean deleteFeedMediaSynchronous(\n      * @param feedId  ID of the Feed that should be deleted.\n      */\n     public static Future<?> deleteFeed(final Context context, final long feedId) {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             final Feed feed = DBReader.getFeed(feedId);\n             if (feed == null) {\n                 return;\n@@ -183,7 +204,7 @@ public static Future<?> deleteFeed(final Context context, final long feedId) {\n      */\n     @NonNull\n     public static Future<?> deleteFeedItems(@NonNull Context context, @NonNull List<FeedItem> items) {\n-        return dbExec.submit(() -> deleteFeedItemsSynchronous(context, items));\n+        return runOnDbThread(() -> deleteFeedItemsSynchronous(context, items));\n     }\n \n     /**\n@@ -235,7 +256,7 @@ private static void deleteFeedItemsSynchronous(@NonNull Context context, @NonNul\n      * Deletes the entire playback history.\n      */\n     public static Future<?> clearPlaybackHistory() {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n             adapter.clearPlaybackHistory();\n@@ -248,7 +269,7 @@ public static Future<?> clearPlaybackHistory() {\n      * Deletes the entire download log.\n      */\n     public static Future<?> clearDownloadLog() {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n             adapter.clearDownloadLog();\n@@ -281,7 +302,7 @@ public static Future<?> addItemToPlaybackHistory(FeedMedia media) {\n      * @param date PlaybackCompletionDate for <code>media</code>\n      */\n     public static Future<?> addItemToPlaybackHistory(final FeedMedia media, Date date) {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             Log.d(TAG, \"Adding item to playback history\");\n             media.setPlaybackCompletionDate(date);\n \n@@ -300,7 +321,7 @@ public static Future<?> addItemToPlaybackHistory(final FeedMedia media, Date dat\n      * @param status The DownloadStatus object.\n      */\n     public static Future<?> addDownloadStatus(final DownloadResult status) {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n             adapter.setDownloadStatus(status);\n@@ -322,7 +343,7 @@ public static Future<?> addDownloadStatus(final DownloadResult status) {\n      */\n     public static Future<?> addQueueItemAt(final Context context, final long itemId,\n                                            final int index, final boolean performAutoDownload) {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             final PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n             final List<FeedItem> queue = DBReader.getQueue(adapter);\n@@ -393,7 +414,7 @@ public static Future<?> addQueueItem(final Context context, final boolean perfor\n      */\n     public static Future<?> addQueueItem(final Context context, final boolean performAutoDownload,\n                                          final boolean markAsUnplayed, final long... itemIds) {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             if (itemIds.length < 1) {\n                 return;\n             }\n@@ -476,7 +497,7 @@ private static void applySortOrder(List<FeedItem> queue, List<QueueEvent> events\n      * Removes all FeedItem objects from the queue.\n      */\n     public static Future<?> clearQueue() {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n             adapter.clearQueue();\n@@ -495,12 +516,12 @@ public static Future<?> clearQueue() {\n      */\n     public static Future<?> removeQueueItem(final Context context,\n                                             final boolean performAutoDownload, final FeedItem item) {\n-        return dbExec.submit(() -> removeQueueItemSynchronous(context, performAutoDownload, item.getId()));\n+        return runOnDbThread(() -> removeQueueItemSynchronous(context, performAutoDownload, item.getId()));\n     }\n \n     public static Future<?> removeQueueItem(final Context context, final boolean performAutoDownload,\n                                             final long... itemIds) {\n-        return dbExec.submit(() -> removeQueueItemSynchronous(context, performAutoDownload, itemIds));\n+        return runOnDbThread(() -> removeQueueItemSynchronous(context, performAutoDownload, itemIds));\n     }\n \n     private static void removeQueueItemSynchronous(final Context context,\n@@ -562,7 +583,7 @@ public static Future<?> toggleFavoriteItem(final FeedItem item) {\n     }\n \n     public static Future<?> addFavoriteItem(final FeedItem item) {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             final PodDBAdapter adapter = PodDBAdapter.getInstance().open();\n             adapter.addFavoriteItem(item);\n             adapter.close();\n@@ -573,7 +594,7 @@ public static Future<?> addFavoriteItem(final FeedItem item) {\n     }\n \n     public static Future<?> removeFavoriteItem(final FeedItem item) {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             final PodDBAdapter adapter = PodDBAdapter.getInstance().open();\n             adapter.removeFavoriteItem(item);\n             adapter.close();\n@@ -590,7 +611,7 @@ public static Future<?> removeFavoriteItem(final FeedItem item) {\n      * @param broadcastUpdate true if this operation should trigger a QueueUpdateBroadcast. This option should be set to\n      */\n     public static Future<?> moveQueueItemToTop(final long itemId, final boolean broadcastUpdate) {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             LongList queueIdList = DBReader.getQueueIDList();\n             int index = queueIdList.indexOf(itemId);\n             if (index >= 0) {\n@@ -609,7 +630,7 @@ public static Future<?> moveQueueItemToTop(final long itemId, final boolean broa\n      */\n     public static Future<?> moveQueueItemToBottom(final long itemId,\n                                                   final boolean broadcastUpdate) {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             LongList queueIdList = DBReader.getQueueIDList();\n             int index = queueIdList.indexOf(itemId);\n             if (index >= 0) {\n@@ -632,7 +653,7 @@ public static Future<?> moveQueueItemToBottom(final long itemId,\n      */\n     public static Future<?> moveQueueItem(final int from,\n                                           final int to, final boolean broadcastUpdate) {\n-        return dbExec.submit(() -> moveQueueItemHelper(from, to, broadcastUpdate));\n+        return runOnDbThread(() -> moveQueueItemHelper(from, to, broadcastUpdate));\n     }\n \n     /**\n@@ -669,7 +690,7 @@ private static void moveQueueItemHelper(final int from,\n     }\n \n     public static Future<?> resetPagedFeedPage(Feed feed) {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             final PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n             adapter.resetPagedFeedPage(feed);\n@@ -699,7 +720,7 @@ public static Future<?> markItemPlayed(final int played, final long... itemIds)\n      */\n     public static Future<?> markItemPlayed(final int played, final boolean broadcastUpdate,\n                                            final long... itemIds) {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             final PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n             adapter.setFeedItemRead(played, itemIds);\n@@ -729,7 +750,7 @@ private static Future<?> markItemPlayed(final long itemId,\n                                             final int played,\n                                             final long mediaId,\n                                             final boolean resetMediaPosition) {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             final PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n             adapter.setFeedItemRead(played, itemId, mediaId,\n@@ -746,7 +767,7 @@ private static Future<?> markItemPlayed(final long itemId,\n      * @param feedId ID of the Feed.\n      */\n     public static Future<?> removeFeedNewFlag(final long feedId) {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             final PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n             adapter.setFeedItems(FeedItem.NEW, FeedItem.UNPLAYED, feedId);\n@@ -760,7 +781,7 @@ public static Future<?> removeFeedNewFlag(final long feedId) {\n      * Sets the 'read'-attribute of all NEW FeedItems to UNPLAYED.\n      */\n     public static Future<?> removeAllNewFlags() {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             final PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n             adapter.setFeedItems(FeedItem.NEW, FeedItem.UNPLAYED);\n@@ -771,7 +792,7 @@ public static Future<?> removeAllNewFlags() {\n     }\n \n     static Future<?> addNewFeed(final Context context, final Feed... feeds) {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             final PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n             adapter.setCompleteFeed(feeds);\n@@ -789,7 +810,7 @@ static Future<?> addNewFeed(final Context context, final Feed... feeds) {\n     }\n \n     static Future<?> setCompleteFeed(final Feed... feeds) {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n             adapter.setCompleteFeed(feeds);\n@@ -798,7 +819,7 @@ static Future<?> setCompleteFeed(final Feed... feeds) {\n     }\n \n     public static Future<?> setItemList(final List<FeedItem> items) {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n             adapter.storeFeedItemlist(items);\n@@ -814,7 +835,7 @@ public static Future<?> setItemList(final List<FeedItem> items) {\n      * @param media The FeedMedia object.\n      */\n     public static Future<?> setFeedMedia(final FeedMedia media) {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n             adapter.setMedia(media);\n@@ -828,7 +849,7 @@ public static Future<?> setFeedMedia(final FeedMedia media) {\n      * @param media The FeedMedia object.\n      */\n     public static Future<?> setFeedMediaPlaybackInformation(final FeedMedia media) {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n             adapter.setFeedMediaPlaybackInformation(media);\n@@ -843,7 +864,7 @@ public static Future<?> setFeedMediaPlaybackInformation(final FeedMedia media) {\n      * @param item The FeedItem object.\n      */\n     public static Future<?> setFeedItem(final FeedItem item) {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n             adapter.setSingleFeedItem(item);\n@@ -857,7 +878,7 @@ public static Future<?> setFeedItem(final FeedItem item) {\n      */\n     public static Future<?> updateFeedDownloadURL(final String original, final String updated) {\n         Log.d(TAG, \"updateFeedDownloadURL(original: \" + original + \", updated: \" + updated + \")\");\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n             adapter.setFeedDownloadUrl(original, updated);\n@@ -871,7 +892,7 @@ public static Future<?> updateFeedDownloadURL(final String original, final Strin\n      * @param preferences The FeedPreferences object.\n      */\n     public static Future<?> setFeedPreferences(final FeedPreferences preferences) {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n             adapter.setFeedPreferences(preferences);\n@@ -901,7 +922,7 @@ private static int indexInItemList(List<FeedItem> items, long itemId) {\n      */\n     public static Future<?> setFeedLastUpdateFailed(final long feedId,\n                                                     final boolean lastUpdateFailed) {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n             adapter.setFeedLastUpdateFailed(feedId, lastUpdateFailed);\n@@ -911,7 +932,7 @@ public static Future<?> setFeedLastUpdateFailed(final long feedId,\n     }\n \n     public static Future<?> setFeedCustomTitle(Feed feed) {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n             adapter.setFeedCustomTitle(feed.getId(), feed.getCustomTitle());\n@@ -930,10 +951,10 @@ public static Future<?> setFeedCustomTitle(Feed feed) {\n     public static Future<?> reorderQueue(@Nullable SortOrder sortOrder, final boolean broadcastUpdate) {\n         if (sortOrder == null) {\n             Log.w(TAG, \"reorderQueue() - sortOrder is null. Do nothing.\");\n-            return dbExec.submit(() -> { });\n+            return runOnDbThread(() -> { });\n         }\n         final Permutor<FeedItem> permutor = FeedItemPermutors.getPermutor(sortOrder);\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             final PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n             final List<FeedItem> queue = DBReader.getQueue(adapter);\n@@ -960,7 +981,7 @@ public static Future<?> reorderQueue(@Nullable SortOrder sortOrder, final boolea\n     public static Future<?> setFeedItemsFilter(final long feedId,\n                                                final Set<String> filterValues) {\n         Log.d(TAG, \"setFeedItemsFilter() called with: \" + \"feedId = [\" + feedId + \"], filterValues = [\" + filterValues + \"]\");\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n             adapter.setFeedItemFilter(feedId, filterValues);\n@@ -974,7 +995,7 @@ public static Future<?> setFeedItemsFilter(final long feedId,\n      *\n      */\n     public static Future<?> setFeedItemSortOrder(long feedId, @Nullable SortOrder sortOrder) {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n             adapter.setFeedItemSortOrder(feedId, sortOrder);\n@@ -988,11 +1009,24 @@ public static Future<?> setFeedItemSortOrder(long feedId, @Nullable SortOrder so\n      */\n     @NonNull\n     public static Future<?> resetStatistics() {\n-        return dbExec.submit(() -> {\n+        return runOnDbThread(() -> {\n             PodDBAdapter adapter = PodDBAdapter.getInstance();\n             adapter.open();\n             adapter.resetAllMediaPlayedDuration();\n             adapter.close();\n         });\n     }\n+\n+    /**\n+     * Submit to the DB thread only if caller is not already on the DB thread. Otherwise,\n+     * just execute synchronously\n+     */\n+    private static Future<?> runOnDbThread(Runnable runnable) {\n+        if (\"DatabaseExecutor\".equals(Thread.currentThread().getName())) {\n+            runnable.run();\n+            return Futures.immediateFuture(null);\n+        } else {\n+            return dbExec.submit(runnable);\n+        }\n+    }\n }\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/util/FeedUtil.java b/core/src/main/java/de/danoeh/antennapod/core/util/FeedUtil.java\nnew file mode 100644\nindex 0000000000..201207816d\n--- /dev/null\n+++ b/core/src/main/java/de/danoeh/antennapod/core/util/FeedUtil.java\n@@ -0,0 +1,13 @@\n+package de.danoeh.antennapod.core.util;\n+\n+import de.danoeh.antennapod.model.feed.Feed;\n+import de.danoeh.antennapod.storage.preferences.UserPreferences;\n+\n+public abstract class FeedUtil {\n+    public static boolean shouldAutoDeleteItemsOnThatFeed(Feed feed) {\n+        if (!UserPreferences.isAutoDelete()) {\n+            return false;\n+        }\n+        return !feed.isLocalFeed() || UserPreferences.isAutoDeleteLocal();\n+    }\n+}\ndiff --git a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\nindex f2b122fcca..d0dd77bc93 100644\n--- a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n+++ b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n@@ -78,6 +78,7 @@ private UserPreferences(){}\n     public static final String PREF_SKIP_KEEPS_EPISODE = \"prefSkipKeepsEpisode\";\n     private static final String PREF_FAVORITE_KEEPS_EPISODE = \"prefFavoriteKeepsEpisode\";\n     private static final String PREF_AUTO_DELETE = \"prefAutoDelete\";\n+    private static final String PREF_AUTO_DELETE_LOCAL = \"prefAutoDeleteLocal\";\n     public static final String PREF_SMART_MARK_AS_PLAYED_SECS = \"prefSmartMarkAsPlayedSecs\";\n     private static final String PREF_PLAYBACK_SPEED_ARRAY = \"prefPlaybackSpeedArray\";\n     public static final String PREF_PAUSE_PLAYBACK_FOR_FOCUS_LOSS = \"prefPauseForFocusLoss\";\n@@ -400,6 +401,10 @@ public static boolean isAutoDelete() {\n         return prefs.getBoolean(PREF_AUTO_DELETE, false);\n     }\n \n+    public static boolean isAutoDeleteLocal() {\n+        return prefs.getBoolean(PREF_AUTO_DELETE_LOCAL, false);\n+    }\n+\n     public static int getSmartMarkAsPlayedSecs() {\n         return Integer.parseInt(prefs.getString(PREF_SMART_MARK_AS_PLAYED_SECS, \"30\"));\n     }\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 6bdb836dd2..70c0ffa21f 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -213,6 +213,7 @@\n     <string name=\"stream_label\">Stream</string>\n     <string name=\"delete_label\">Delete</string>\n     <string name=\"delete_failed\">Unable to delete file. Rebooting the device could help.</string>\n+    <string name=\"delete_local_failed\">Unable to delete file. Try re-connecting the local folder from the podcast info screen.</string>\n     <string name=\"delete_episode_label\">Delete episode</string>\n     <plurals name=\"deleted_multi_episode_batch_label\">\n         <item quantity=\"one\">1 downloaded episode deleted.</item>\n@@ -256,6 +257,7 @@\n     <string name=\"skip_episode_label\">Skip episode</string>\n     <string name=\"reset_position\">Reset playback position</string>\n     <string name=\"no_items_selected\">No items selected</string>\n+    <string name=\"delete_local_feed_warning_body\">Deleting removes the episode from AntennaPod and deletes the media file from your device storage. It cannot be downloaded again through AntennaPod.</string>\n \n     <!-- Download messages and labels -->\n     <string name=\"download_successful\">successful</string>\n@@ -397,6 +399,9 @@\n     <string name=\"pref_followQueue_sum\">Jump to next queue item when playback completes</string>\n     <string name=\"pref_auto_delete_sum\">Delete episode when playback completes</string>\n     <string name=\"pref_auto_delete_title\">Auto delete</string>\n+    <string name=\"pref_auto_local_delete_title\">Auto delete from local folders</string>\n+    <string name=\"pref_auto_local_delete_sum\">Include local folders in Auto delete functionality</string>\n+    <string name=\"pref_auto_local_delete_dialog_body\">Note that for local folders this will remove episodes from AntennaPod and delete their media files from your device storage. They cannot be downloaded again through AntennaPod. Enable auto delete?</string>\n     <string name=\"pref_smart_mark_as_played_sum\">Mark episodes as played even if less than a certain amount of seconds of playing time is still left</string>\n     <string name=\"pref_smart_mark_as_played_title\">Smart mark as played</string>\n     <string name=\"pref_skip_keeps_episodes_sum\">Keep episodes when they are skipped</string>\n", "test_patch": "diff --git a/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java b/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java\nindex 1f387b24b1..24c20242a8 100644\n--- a/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java\n+++ b/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java\n@@ -41,6 +41,7 @@\n import static de.test.antennapod.EspressoTestUtils.waitForView;\n import static java.util.concurrent.TimeUnit.MILLISECONDS;\n import static org.hamcrest.Matchers.not;\n+import static org.junit.Assert.assertFalse;\n import static org.junit.Assert.assertTrue;\n \n @LargeTest\n@@ -199,6 +200,22 @@ public void testAutoDelete() {\n                 .until(() -> autoDelete == UserPreferences.isAutoDelete());\n     }\n \n+    @Test\n+    public void testAutoDeleteLocal() {\n+        clickPreference(R.string.downloads_pref);\n+        final boolean initialAutoDelete = UserPreferences.isAutoDeleteLocal();\n+        assertFalse(initialAutoDelete);\n+\n+        onView(withText(R.string.pref_auto_local_delete_title)).perform(click());\n+        onView(withText(R.string.yes)).perform(click());\n+        Awaitility.await().atMost(1000, MILLISECONDS)\n+                .until(() -> UserPreferences.isAutoDeleteLocal());\n+\n+        onView(withText(R.string.pref_auto_local_delete_title)).perform(click());\n+        Awaitility.await().atMost(1000, MILLISECONDS)\n+                .until(() -> !UserPreferences.isAutoDeleteLocal());\n+    }\n+\n     @Test\n     public void testPlaybackSpeeds() {\n         clickPreference(R.string.playback_pref);\n", "problem_statement": "Option to delete local files\n### Checklist\r\n\r\n- [X] I have used the search function to see if someone else has already submitted the same feature request.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\r\n\r\n### App version\r\n\r\n2.4.1\r\n\r\n### Where did you get the app from\r\n\r\nF-Droid\r\n\r\n### Problem you may be having, or feature you want\r\n\r\nLike online files that we have an option beside Play to delete files , please add same for local files.\r\n\r\n### Suggested solution\r\n\r\n_No response_\r\n\r\n### Screenshots / Drawings / Technical details\r\n\r\n_No response_\n", "hints_text": "This issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/deleting-files-from-antennapod/1939/4\n\nAs AntennaPod has already been granted access to the local folder, is there any roadblock left to adding a Delete button for Local Folder episodes?\r\n\r\nI do use the Local Folder option quite a bit for content that is unavailable directly through AP; as folders become more populated, locating the folder and then the file through an external file manager, becomes ever more jarring and time-consuming.\nI would like this too. Is it possible? Please if you have time implement this! Thank you for your time!", "created_at": "2023-03-29T09:55:18Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6390, "instance_id": "AntennaPod__AntennaPod-6390", "issue_numbers": ["6338"], "base_commit": "d51e937e9651bcd5955055bee6abffcdefaa0c66", "patch": "diff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex b5307afbde..271b3a85e4 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -5,10 +5,10 @@\n \n     <!-- Activity and fragment titles -->\n     <string name=\"provider_authority\" translatable=\"false\">de.danoeh.antennapod.provider</string>\n-    <string name=\"feed_update_receiver_name\">Update Subscriptions</string>\n+    <string name=\"feed_update_receiver_name\">Update subscriptions</string>\n     <string name=\"feeds_label\">Podcasts</string>\n     <string name=\"statistics_label\">Statistics</string>\n-    <string name=\"add_feed_label\">Add Podcast</string>\n+    <string name=\"add_feed_label\">Add podcast</string>\n     <string name=\"episodes_label\">Episodes</string>\n     <string name=\"home_label\">Home</string>\n     <string name=\"queue_label\">Queue</string>\n@@ -16,12 +16,12 @@\n     <string name=\"favorite_episodes_label\">Favorites</string>\n     <string name=\"settings_label\">Settings</string>\n     <string name=\"downloads_label\">Downloads</string>\n-    <string name=\"open_autodownload_settings\">Open Settings</string>\n-    <string name=\"downloads_log_label\">Download Log</string>\n+    <string name=\"open_autodownload_settings\">Open settings</string>\n+    <string name=\"downloads_log_label\">Download log</string>\n     <string name=\"subscriptions_label\">Subscriptions</string>\n-    <string name=\"subscriptions_list_label\">Subscriptions List</string>\n-    <string name=\"cancel_download_label\">Cancel Download</string>\n-    <string name=\"playback_history_label\">Playback History</string>\n+    <string name=\"subscriptions_list_label\">Subscriptions list</string>\n+    <string name=\"cancel_download_label\">Cancel download</string>\n+    <string name=\"playback_history_label\">Playback history</string>\n     <string name=\"episode_cache_full_title\">Episode cache full</string>\n     <string name=\"episode_cache_full_message\">The episode cache limit has been reached. You can increase the cache size in the Settings.</string>\n     <string name=\"years_statistics_label\">Years</string>\n@@ -32,11 +32,11 @@\n     <string name=\"app_action_not_found\">\\\"%1$s\\\" not found</string>\n \n     <!-- SwipeActions -->\n-    <string name=\"swipeactions_label\">Swipe Actions</string>\n+    <string name=\"swipeactions_label\">Swipe actions</string>\n     <string name=\"swipeactions_summary\">Choose what happens when swiping an episode in a list</string>\n-    <string name=\"swipe_right\">Swipe Right</string>\n-    <string name=\"swipe_left\">Swipe Left</string>\n-    <string name=\"enable_swipeactions\">Enable Swipe Actions for this Screen</string>\n+    <string name=\"swipe_right\">Swipe right</string>\n+    <string name=\"swipe_left\">Swipe left</string>\n+    <string name=\"enable_swipeactions\">Enable swipe actions for this screen</string>\n     <string name=\"change_setting\">Change</string>\n     <string name=\"individual_subscription\">Individual subscription</string>\n \n@@ -72,7 +72,7 @@\n     <!-- Main activity -->\n     <string name=\"drawer_open\">Open menu</string>\n     <string name=\"drawer_close\">Close menu</string>\n-    <string name=\"drawer_preferences\">Drawer Preferences</string>\n+    <string name=\"drawer_preferences\">Drawer preferences</string>\n     <string name=\"drawer_feed_order_unplayed_episodes\">Sort by counter</string>\n     <string name=\"drawer_feed_order_alphabetical\">Sort alphabetically</string>\n     <string name=\"drawer_feed_order_last_update\">Sort by publication date</string>\n@@ -89,13 +89,13 @@\n     <string name=\"confirm_export_log_dialog_message\">Detailed logs may contain sensitive information, such as your subscriptions list</string>\n \n     <!-- Webview actions -->\n-    <string name=\"open_in_browser_label\">Open in Browser</string>\n+    <string name=\"open_in_browser_label\">Open in browser</string>\n     <string name=\"copy_url_label\">Copy URL</string>\n     <string name=\"share_url_label\">Share URL</string>\n-    <string name=\"go_to_position_label\">Go to this Position</string>\n+    <string name=\"go_to_position_label\">Go to this position</string>\n \n     <!-- Playback history -->\n-    <string name=\"clear_history_label\">Clear History</string>\n+    <string name=\"clear_history_label\">Clear history</string>\n     <string name=\"clear_playback_history_msg\">This will clear the entire playback history. Are you sure you want to proceed?</string>\n     <string name=\"remove_history_label\">Remove from history</string>\n     <string name=\"removed_history_label\">Removed from history</string>\n@@ -109,7 +109,7 @@\n     <string name=\"global_default\">Global default</string>\n     <string name=\"url_label\">URL</string>\n     <string name=\"support_funding_label\">Support</string>\n-    <string name=\"support_podcast\">Support this Podcast</string>\n+    <string name=\"support_podcast\">Support this podcast</string>\n     <string name=\"error_label\">Error</string>\n     <string name=\"error_msg_prefix\">An error occurred:</string>\n     <string name=\"refresh_label\">Refresh</string>\n@@ -123,15 +123,15 @@\n     <string name=\"close_label\">Close</string>\n     <string name=\"retry_label\">Retry</string>\n     <string name=\"auto_download_label\">Include in auto downloads</string>\n-    <string name=\"auto_delete_label\">Auto Delete Episode</string>\n-    <string name=\"feed_volume_reduction\">Volume Reduction</string>\n+    <string name=\"auto_delete_label\">Auto delete episode</string>\n+    <string name=\"feed_volume_reduction\">Volume reduction</string>\n     <string name=\"feed_volume_reduction_summary\">Turn down volume for episodes of this podcast: %1$s</string>\n     <string name=\"feed_volume_reduction_off\">Off</string>\n     <string name=\"feed_volume_reduction_light\">Light</string>\n     <string name=\"feed_volume_reduction_heavy\">Heavy</string>\n     <string name=\"feed_auto_download_always\">Always</string>\n     <string name=\"feed_auto_download_never\">Never</string>\n-    <string name=\"feed_new_episodes_action_add_to_inbox\">Add to Inbox</string>\n+    <string name=\"feed_new_episodes_action_add_to_inbox\">Add to inbox</string>\n     <string name=\"feed_new_episodes_action_nothing\">Nothing</string>\n     <string name=\"send_label\">Send&#8230;</string>\n     <string name=\"episode_cleanup_never\">Never</string>\n@@ -154,15 +154,15 @@\n         <item quantity=\"one\">%d episode</item>\n         <item quantity=\"other\">%d episodes</item>\n     </plurals>\n-    <string name=\"episode_notification\">Episode Notifications</string>\n+    <string name=\"episode_notification\">Episode notifications</string>\n     <string name=\"episode_notification_summary\">Show a notification when a new episode is released.</string>\n     <plurals name=\"new_episode_notification_message\">\n         <item quantity=\"one\">%2$s has a new episode</item>\n         <item quantity=\"other\">%2$s has %1$d new episodes</item>\n     </plurals>\n     <plurals name=\"new_episode_notification_title\">\n-        <item quantity=\"one\">New Episode</item>\n-        <item quantity=\"other\">New Episodes</item>\n+        <item quantity=\"one\">New episode</item>\n+        <item quantity=\"other\">New episodes</item>\n     </plurals>\n     <string name=\"new_episode_notification_group_text\">Your subscriptions have new episodes.</string>\n \n@@ -178,7 +178,7 @@\n     <string name=\"rename_feed_label\">Rename podcast</string>\n     <string name=\"remove_feed_label\">Remove podcast</string>\n     <string name=\"share_label\">Share</string>\n-    <string name=\"share_file_label\">Share File</string>\n+    <string name=\"share_file_label\">Share file</string>\n     <string name=\"share_rss_address_label\">RSS address:</string>\n     <string name=\"feed_delete_confirmation_msg\">Please confirm that you want to delete the podcast \\\"%1$s\\\", ALL its episodes (including downloaded episodes), and its statistics.</string>\n     <string name=\"feed_delete_confirmation_msg_batch\">Please confirm that you want to remove the selected podcasts, ALL their episodes (including downloaded episodes), and its statistics.</string>\n@@ -189,8 +189,8 @@\n     <string name=\"select_all_above\">Select all above</string>\n     <string name=\"select_all_below\">Select all below</string>\n     <string name=\"filtered_label\">Filtered</string>\n-    <string name=\"refresh_failed_msg\">{fa-exclamation-circle} Last Refresh failed. Tap to view details.</string>\n-    <string name=\"open_podcast\">Open Podcast</string>\n+    <string name=\"refresh_failed_msg\">{fa-exclamation-circle} Last refresh failed. Tap to view details.</string>\n+    <string name=\"open_podcast\">Open podcast</string>\n     <string name=\"please_wait_for_data\">Please wait until the data is loaded</string>\n     <string name=\"updates_disabled_label\">Updates disabled</string>\n     <plurals name=\"updated_feeds_batch_label\">\n@@ -213,7 +213,7 @@\n     <string name=\"stream_label\">Stream</string>\n     <string name=\"delete_label\">Delete</string>\n     <string name=\"delete_failed\">Unable to delete file. Rebooting the device could help.</string>\n-    <string name=\"delete_episode_label\">Delete Episode</string>\n+    <string name=\"delete_episode_label\">Delete episode</string>\n     <plurals name=\"deleted_multi_episode_batch_label\">\n         <item quantity=\"one\">1 downloaded episode deleted.</item>\n         <item quantity=\"other\">%d downloaded episodes deleted.</item>\n@@ -236,12 +236,12 @@\n         <item quantity=\"one\">%d episode marked as unplayed.</item>\n         <item quantity=\"other\">%d episodes marked as unplayed.</item>\n     </plurals>\n-    <string name=\"add_to_queue_label\">Add to Queue</string>\n+    <string name=\"add_to_queue_label\">Add to queue</string>\n     <plurals name=\"added_to_queue_batch_label\">\n         <item quantity=\"one\">%d episode added to queue.</item>\n         <item quantity=\"other\">%d episodes added to queue.</item>\n     </plurals>\n-    <string name=\"remove_from_queue_label\">Remove from Queue</string>\n+    <string name=\"remove_from_queue_label\">Remove from queue</string>\n     <plurals name=\"removed_from_queue_batch_label\">\n         <item quantity=\"one\">%d episode removed from queue.</item>\n         <item quantity=\"other\">%d episodes removed from queue.</item>\n@@ -250,11 +250,11 @@\n         <item quantity=\"one\">%d episode removed from inbox.</item>\n         <item quantity=\"other\">%d episodes removed from inbox.</item>\n     </plurals>\n-    <string name=\"add_to_favorite_label\">Add to Favorites</string>\n-    <string name=\"remove_from_favorite_label\">Remove from Favorites</string>\n-    <string name=\"visit_website_label\">Visit Website</string>\n+    <string name=\"add_to_favorite_label\">Add to favorites</string>\n+    <string name=\"remove_from_favorite_label\">Remove from favorites</string>\n+    <string name=\"visit_website_label\">Visit website</string>\n     <string name=\"skip_episode_label\">Skip episode</string>\n-    <string name=\"reset_position\">Reset Playback Position</string>\n+    <string name=\"reset_position\">Reset playback position</string>\n     <string name=\"no_items_selected\">No items selected</string>\n \n     <!-- Download messages and labels -->\n@@ -268,42 +268,42 @@\n     <string name=\"download_error_tap_for_details\">Tap to view details.</string>\n     <string name=\"download_error_device_not_found\">Storage Device not found</string>\n     <string name=\"download_error_insufficient_space\">There is not enough space left on your device.</string>\n-    <string name=\"download_error_http_data_error\">HTTP Data Error</string>\n-    <string name=\"download_error_error_unknown\">Unknown Error</string>\n+    <string name=\"download_error_http_data_error\">HTTP data error</string>\n+    <string name=\"download_error_error_unknown\">Unknown error</string>\n     <string name=\"download_error_parser_exception\">The podcast host\\'s server sent a broken podcast feed.</string>\n-    <string name=\"download_error_unsupported_type\">Unsupported Feed Type</string>\n+    <string name=\"download_error_unsupported_type\">Unsupported feed type</string>\n     <string name=\"download_error_unsupported_type_html\">The podcast host\\'s server sent a website, not a podcast.</string>\n     <string name=\"download_error_not_found\">The podcast host\\'s server does not know where to find the file. It may have been deleted.</string>\n-    <string name=\"download_error_connection_error\">Connection Error</string>\n+    <string name=\"download_error_connection_error\">Connection error</string>\n     <string name=\"download_error_unknown_host\">Cannot find the server. Check if the address is typed correctly and if you have a working network connection.</string>\n-    <string name=\"download_error_unauthorized\">Authentication Error. Make sure that username and password are correct.</string>\n-    <string name=\"download_error_file_type_type\">File Type Error</string>\n+    <string name=\"download_error_unauthorized\">Authentication error. Make sure that username and password are correct.</string>\n+    <string name=\"download_error_file_type_type\">File type error</string>\n     <string name=\"download_error_forbidden\">The podcast host\\'s server refuses to respond.</string>\n     <string name=\"download_canceled_msg\">Download canceled</string>\n     <string name=\"download_error_wrong_size\">The server connection was lost before completing the download</string>\n     <string name=\"download_error_blocked\">The download was blocked by another app on your device (like a VPN or ad blocker).</string>\n     <string name=\"download_error_certificate\">Unable to establish a secure connection. This can mean that another app on your device (like a VPN or an ad blocker) blocked the download, or that something is wrong with the server certificates.</string>\n     <string name=\"download_report_title\">Downloads completed with error(s)</string>\n-    <string name=\"download_error_io_error\">IO Error</string>\n-    <string name=\"download_error_request_error\">Request Error</string>\n-    <string name=\"download_error_db_access\">Database Access Error</string>\n+    <string name=\"download_error_io_error\">IO error</string>\n+    <string name=\"download_error_request_error\">Request error</string>\n+    <string name=\"download_error_db_access\">Database access error</string>\n     <plurals name=\"downloads_left\">\n         <item quantity=\"one\">%d download left</item>\n         <item quantity=\"other\">%d downloads left</item>\n     </plurals>\n     <string name=\"download_notification_title_feeds\">Refreshing podcasts</string>\n     <string name=\"download_notification_title_episodes\">Downloading episodes</string>\n-    <string name=\"download_log_title_unknown\">Unknown Title</string>\n+    <string name=\"download_log_title_unknown\">Unknown title</string>\n     <string name=\"download_type_feed\">Feed</string>\n     <string name=\"download_type_media\">Media file</string>\n     <string name=\"null_value_podcast_error\">No podcast was provided that could be shown.</string>\n     <string name=\"no_feed_url_podcast_found_by_search\">The suggested podcast did not have an RSS link, AntennaPod found a podcast that could match</string>\n     <string name=\"authentication_notification_title\">Authentication required</string>\n-    <string name=\"confirm_mobile_download_dialog_title\">Confirm Mobile Download</string>\n+    <string name=\"confirm_mobile_download_dialog_title\">Confirm mobile download</string>\n     <string name=\"confirm_mobile_download_dialog_message\">Downloading over mobile data connection is disabled in the settings. AntennaPod can download the episode later automatically when Wi-Fi is available.</string>\n     <string name=\"confirm_mobile_download_dialog_download_later\">Download later</string>\n     <string name=\"confirm_mobile_download_dialog_allow_this_time\">Download anyway</string>\n-    <string name=\"confirm_mobile_streaming_notification_title\">Confirm Mobile streaming</string>\n+    <string name=\"confirm_mobile_streaming_notification_title\">Confirm mobile streaming</string>\n     <string name=\"confirm_mobile_streaming_notification_message\">Streaming over mobile data connection is disabled in the settings. Tap to stream anyway.</string>\n     <string name=\"confirm_mobile_streaming_button_always\">Always</string>\n     <string name=\"confirm_mobile_streaming_button_once\">Once</string>\n@@ -314,7 +314,7 @@\n     <string name=\"playback_error_unsupported\">Unsupported media type</string>\n     <string name=\"playback_error_timeout\">Operation timed out</string>\n     <string name=\"playback_error_source\">Unable to access media file</string>\n-    <string name=\"playback_error_unknown\">Unknown Error</string>\n+    <string name=\"playback_error_unknown\">Unknown error</string>\n     <string name=\"no_media_playing_label\">No media playing</string>\n     <string name=\"position_default_label\" translatable=\"false\">00:00:00</string>\n     <string name=\"unknown_media_key\">AntennaPod - Unknown media key: %1$d</string>\n@@ -322,12 +322,12 @@\n     <string name=\"no_media_label\">Item does not contain a media file</string>\n \n     <!-- Queue operations -->\n-    <string name=\"lock_queue\">Lock Queue</string>\n+    <string name=\"lock_queue\">Lock queue</string>\n     <string name=\"queue_locked\">Queue locked</string>\n     <string name=\"queue_unlocked\">Queue unlocked</string>\n     <string name=\"queue_lock_warning\">If you lock the queue, you can no longer swipe or reorder episodes.</string>\n     <string name=\"checkbox_do_not_show_again\">Do not show again</string>\n-    <string name=\"clear_queue_label\">Clear Queue</string>\n+    <string name=\"clear_queue_label\">Clear queue</string>\n     <string name=\"undo\">Undo</string>\n     <string name=\"move_to_top_label\">Move to top</string>\n     <string name=\"move_to_bottom_label\">Move to bottom</string>\n@@ -338,7 +338,7 @@\n     <string name=\"episode_title\">Episode title</string>\n     <string name=\"feed_title\">Podcast title</string>\n     <string name=\"random\">Random</string>\n-    <string name=\"smart_shuffle\">Smart Shuffle</string>\n+    <string name=\"smart_shuffle\">Smart shuffle</string>\n     <string name=\"clear_queue_confirmation_msg\">Please confirm that you want to clear the queue of ALL of the episodes in it</string>\n     <string name=\"time_left_label\">Time left:\\u0020</string>\n \n@@ -354,9 +354,9 @@\n     <string name=\"no_comp_downloads_label\">You can download episodes on the podcast details screen.</string>\n     <string name=\"no_log_downloads_head_label\">No download log</string>\n     <string name=\"no_log_downloads_label\">Download logs will appear here when available.</string>\n-    <string name=\"no_history_head_label\">No History</string>\n+    <string name=\"no_history_head_label\">No history</string>\n     <string name=\"no_history_label\">After you listen to an episode, it will appear here.</string>\n-    <string name=\"no_all_episodes_head_label\">No Episodes</string>\n+    <string name=\"no_all_episodes_head_label\">No episodes</string>\n     <string name=\"no_all_episodes_label\">When you add a podcast, the episodes will be shown here.</string>\n     <string name=\"no_all_episodes_filtered_label\">Try clearing the filter to see more episodes.</string>\n     <string name=\"no_inbox_head_label\">No episodes in the inbox</string>\n@@ -380,28 +380,28 @@\n     <string name=\"preference_search_hint\">Search\u2026</string>\n     <string name=\"preference_search_no_results\">No results</string>\n     <string name=\"preference_search_clear_history\">Clear history</string>\n-    <string name=\"pref_episode_cleanup_title\">Episode Cleanup</string>\n+    <string name=\"pref_episode_cleanup_title\">Episode cleanup</string>\n     <string name=\"pref_episode_cleanup_summary\">Episodes that should be eligible for removal if Auto Download needs space for new episodes</string>\n     <string name=\"pref_pauseOnDisconnect_sum\">Pause playback when headphones or bluetooth are disconnected</string>\n     <string name=\"pref_unpauseOnHeadsetReconnect_sum\">Resume playback when the headphones are reconnected</string>\n     <string name=\"pref_unpauseOnBluetoothReconnect_sum\">Resume playback when bluetooth reconnects</string>\n-    <string name=\"pref_hardware_forward_button_title\">Forward Button</string>\n+    <string name=\"pref_hardware_forward_button_title\">Forward button</string>\n     <string name=\"pref_hardware_forward_button_summary\">Customize the forward button behavior</string>\n-    <string name=\"pref_hardware_previous_button_title\">Previous Button</string>\n+    <string name=\"pref_hardware_previous_button_title\">Previous button</string>\n     <string name=\"pref_hardware_previous_button_summary\">Customize the previous button behavior</string>\n-    <string name=\"button_action_fast_forward\">Fast Forward</string>\n+    <string name=\"button_action_fast_forward\">Fast forward</string>\n     <string name=\"button_action_rewind\">Rewind</string>\n-    <string name=\"button_action_skip_episode\">Skip Episode</string>\n-    <string name=\"button_action_restart_episode\">Restart Episode</string>\n+    <string name=\"button_action_skip_episode\">Skip episode</string>\n+    <string name=\"button_action_restart_episode\">Restart episode</string>\n     <string name=\"pref_followQueue_sum\">Jump to next queue item when playback completes</string>\n     <string name=\"pref_auto_delete_sum\">Delete episode when playback completes</string>\n-    <string name=\"pref_auto_delete_title\">Auto Delete</string>\n+    <string name=\"pref_auto_delete_title\">Auto delete</string>\n     <string name=\"pref_smart_mark_as_played_sum\">Mark episodes as played even if less than a certain amount of seconds of playing time is still left</string>\n-    <string name=\"pref_smart_mark_as_played_title\">Smart Mark as Played</string>\n+    <string name=\"pref_smart_mark_as_played_title\">Smart mark as played</string>\n     <string name=\"pref_skip_keeps_episodes_sum\">Keep episodes when they are skipped</string>\n-    <string name=\"pref_skip_keeps_episodes_title\">Keep Skipped Episodes</string>\n-    <string name=\"pref_favorite_keeps_episodes_sum\">Keep episodes when they are marked Favorite</string>\n-    <string name=\"pref_favorite_keeps_episodes_title\">Keep Favorite Episodes</string>\n+    <string name=\"pref_skip_keeps_episodes_title\">Keep skipped episodes</string>\n+    <string name=\"pref_favorite_keeps_episodes_sum\">Keep episodes when they are marked favorite</string>\n+    <string name=\"pref_favorite_keeps_episodes_title\">Keep favorite episodes</string>\n     <string name=\"playback_pref\">Playback</string>\n     <string name=\"playback_pref_sum\">Headphone controls, Skip intervals, Queue</string>\n     <string name=\"downloads_pref\">Downloads</string>\n@@ -416,42 +416,42 @@\n     <string name=\"feed_every_12_hours\">Every 12 hours</string>\n     <string name=\"feed_every_24_hours\">Every day</string>\n     <string name=\"feed_every_72_hours\">Every 3 days</string>\n-    <string name=\"pref_followQueue_title\">Continuous Playback</string>\n+    <string name=\"pref_followQueue_title\">Continuous playback</string>\n     <string name=\"pref_pauseOnHeadsetDisconnect_title\">Headphones or Bluetooth disconnect</string>\n-    <string name=\"pref_unpauseOnHeadsetReconnect_title\">Headphones Reconnect</string>\n-    <string name=\"pref_unpauseOnBluetoothReconnect_title\">Bluetooth Reconnect</string>\n-    <string name=\"pref_stream_over_download_title\">Prefer Streaming</string>\n+    <string name=\"pref_unpauseOnHeadsetReconnect_title\">Headphones reconnect</string>\n+    <string name=\"pref_unpauseOnBluetoothReconnect_title\">Bluetooth reconnect</string>\n+    <string name=\"pref_stream_over_download_title\">Prefer streaming</string>\n     <string name=\"pref_stream_over_download_sum\">Display stream button instead of download button in lists.</string>\n-    <string name=\"pref_mobileUpdate_title\">Mobile Updates</string>\n+    <string name=\"pref_mobileUpdate_title\">Mobile updates</string>\n     <string name=\"pref_mobileUpdate_sum\">Select what should be allowed over the mobile data connection</string>\n     <string name=\"pref_mobileUpdate_refresh\">Podcast refresh</string>\n     <string name=\"pref_mobileUpdate_images\">Cover images</string>\n     <string name=\"pref_mobileUpdate_auto_download\">Auto download</string>\n     <string name=\"pref_mobileUpdate_episode_download\">Episode download</string>\n     <string name=\"pref_mobileUpdate_streaming\">Streaming</string>\n-    <string name=\"user_interface_label\">User Interface</string>\n-    <string name=\"user_interface_sum\">Appearance, Subscriptions, Lockscreen</string>\n-    <string name=\"pref_black_theme_title\">Full Black</string>\n+    <string name=\"user_interface_label\">User interface</string>\n+    <string name=\"user_interface_sum\">Appearance, subscriptions, lockscreen</string>\n+    <string name=\"pref_black_theme_title\">Full black</string>\n     <string name=\"pref_black_theme_message\">Use full black for the dark theme</string>\n-    <string name=\"pref_tinted_theme_title\">Use dynamic colors</string>\n+    <string name=\"pref_tinted_theme_title\">Dynamic colors</string>\n     <string name=\"pref_tinted_theme_message\">Adapt app colors based on the wallpaper</string>\n-    <string name=\"pref_nav_drawer_items_title\">Set Navigation Drawer items</string>\n+    <string name=\"pref_nav_drawer_items_title\">Set navigation drawer items</string>\n     <string name=\"pref_nav_drawer_items_sum\">Change which items appear in the navigation drawer.</string>\n-    <string name=\"pref_nav_drawer_feed_order_title\">Set Subscription Order</string>\n+    <string name=\"pref_nav_drawer_feed_order_title\">Set subscription order</string>\n     <string name=\"pref_nav_drawer_feed_order_sum\">Change the order of your subscriptions</string>\n-    <string name=\"pref_nav_drawer_feed_counter_title\">Set Subscription Counter</string>\n+    <string name=\"pref_nav_drawer_feed_counter_title\">Set subscription counter</string>\n     <string name=\"pref_nav_drawer_feed_counter_sum\">Change the information displayed by the subscription counter. Also affects the sorting of subscriptions if \\'Subscription Order\\' is set to \\'Counter\\'.</string>\n-    <string name=\"pref_automatic_download_title\">Automatic Download</string>\n+    <string name=\"pref_automatic_download_title\">Automatic download</string>\n     <string name=\"pref_automatic_download_sum\">Configure the automatic download of episodes.</string>\n     <string name=\"pref_autodl_wifi_filter_title\">Enable Wi-Fi filter</string>\n     <string name=\"pref_autodl_wifi_filter_sum\">Allow automatic download only for selected Wi-Fi networks.</string>\n     <string name=\"pref_automatic_download_on_battery_title\">Download when not charging</string>\n     <string name=\"pref_automatic_download_on_battery_sum\">Allow automatic download when the battery is not charging</string>\n-    <string name=\"pref_episode_cache_title\">Episode Cache</string>\n+    <string name=\"pref_episode_cache_title\">Episode cache</string>\n     <string name=\"pref_episode_cache_summary\">Total number of downloaded episodes cached on the device. Automatic download will be suspended if this number is reached.</string>\n-    <string name=\"pref_episode_cover_title\">Use Episode Cover</string>\n+    <string name=\"pref_episode_cover_title\">Use episode cover</string>\n     <string name=\"pref_episode_cover_summary\">Use the episode specific cover in lists whenever available. If unchecked, the app will always use the podcast cover image.</string>\n-    <string name=\"pref_show_remain_time_title\">Show Remaining Time</string>\n+    <string name=\"pref_show_remain_time_title\">Show remaining time</string>\n     <string name=\"pref_show_remain_time_summary\">Display remaining time of episodes when checked. If unchecked, display total duration of episodes.</string>\n     <string name=\"pref_theme_title_automatic\">Automatic</string>\n     <string name=\"pref_theme_title_light\">Light</string>\n@@ -459,7 +459,7 @@\n     <string name=\"pref_episode_cache_unlimited\">Unlimited</string>\n     <string name=\"pref_playback_speed_sum\">Customize the speeds available for variable speed playback</string>\n     <string name=\"pref_feed_playback_speed_sum\">The speed to use when starting audio playback for episodes in this podcast</string>\n-    <string name=\"pref_feed_skip\">Auto Skip</string>\n+    <string name=\"pref_feed_skip\">Auto skip</string>\n     <string name=\"pref_feed_skip_sum\">Skip introductions and ending credits.</string>\n     <string name=\"pref_feed_skip_ending\">Skip last</string>\n     <string name=\"pref_feed_skip_intro\">Skip first</string>\n@@ -467,26 +467,26 @@\n     <string name=\"pref_feed_skip_intro_toast\">Skipped first %d seconds</string>\n     <string name=\"pref_playback_time_respects_speed_title\">Adjust media info to playback speed</string>\n     <string name=\"pref_playback_time_respects_speed_sum\">Displayed position and duration are adapted to playback speed</string>\n-    <string name=\"pref_fast_forward\">Fast Forward Skip Time</string>\n+    <string name=\"pref_fast_forward\">Fast forward skip time</string>\n     <string name=\"pref_fast_forward_sum\">Customize the number of seconds to jump forward when the fast forward button is clicked</string>\n-    <string name=\"pref_rewind\">Rewind Skip Time</string>\n+    <string name=\"pref_rewind\">Rewind skip time</string>\n     <string name=\"pref_rewind_sum\">Customize the number of seconds to jump backwards when the rewind button is clicked</string>\n-    <string name=\"pref_expandNotify_title\">High Notification priority</string>\n+    <string name=\"pref_expandNotify_title\">High notification priority</string>\n     <string name=\"pref_expandNotify_sum\">This usually expands the notification to show playback buttons.</string>\n-    <string name=\"pref_persistNotify_title\">Persistent Playback Controls</string>\n+    <string name=\"pref_persistNotify_title\">Persistent playback controls</string>\n     <string name=\"pref_persistNotify_sum\">Keep notification and lockscreen controls when playback is paused.</string>\n-    <string name=\"pref_compact_notification_buttons_title\">Set Compact Notification Buttons</string>\n+    <string name=\"pref_compact_notification_buttons_title\">Set compact notification buttons</string>\n     <string name=\"pref_compact_notification_buttons_sum\">Change the playback buttons when the notification is collapsed. The play/pause button is always included.</string>\n     <string name=\"pref_compact_notification_buttons_dialog_title\">Select a maximum of %1$d items</string>\n     <string name=\"pref_compact_notification_buttons_dialog_error\">You can only select a maximum of %1$d items.</string>\n-    <string name=\"pref_enqueue_location_title\">Enqueue Location</string>\n+    <string name=\"pref_enqueue_location_title\">Enqueue location</string>\n     <string name=\"pref_enqueue_location_sum\">Add episodes to: %1$s</string>\n     <string name=\"enqueue_location_back\">Back</string>\n     <string name=\"enqueue_location_front\">Front</string>\n     <string name=\"enqueue_location_after_current\">After current episode</string>\n     <string name=\"enqueue_location_random\">Random</string>\n     <string name=\"pref_smart_mark_as_played_disabled\">Disabled</string>\n-    <string name=\"documentation_support\">Documentation &amp; Support</string>\n+    <string name=\"documentation_support\">Documentation &amp; support</string>\n     <string name=\"visit_user_forum\">User forum</string>\n     <string name=\"bug_report_title\">Report bug</string>\n     <string name=\"open_bug_tracker\">Open bug tracker</string>\n@@ -495,18 +495,18 @@\n     <string name=\"pref_proxy_title\">Proxy</string>\n     <string name=\"pref_proxy_sum\">Set a network proxy</string>\n     <string name=\"pref_no_browser_found\">No web browser found.</string>\n-    <string name=\"pref_enqueue_downloaded_title\">Enqueue Downloaded</string>\n+    <string name=\"pref_enqueue_downloaded_title\">Enqueue downloaded</string>\n     <string name=\"pref_enqueue_downloaded_summary\">Add downloaded episodes to the queue</string>\n-    <string name=\"pref_skip_silence_title\">Skip Silence in Audio</string>\n+    <string name=\"pref_skip_silence_title\">Skip silence in audio</string>\n     <string name=\"behavior\">Behavior</string>\n-    <string name=\"pref_default_page\">Default Page</string>\n+    <string name=\"pref_default_page\">Default page</string>\n     <string name=\"pref_default_page_sum\">Screen that is opened when starting AntennaPod.</string>\n     <string name=\"pref_back_button_opens_drawer\">Back button opens drawer</string>\n     <string name=\"pref_back_button_opens_drawer_summary\">Pressing the back button on the default page opens the navigation drawer</string>\n     <string name=\"remember_last_page\">Remember last page</string>\n-    <string name=\"pref_delete_removes_from_queue_title\">Delete removes from Queue</string>\n+    <string name=\"pref_delete_removes_from_queue_title\">Delete removes from queue</string>\n     <string name=\"pref_delete_removes_from_queue_sum\">Automatically remove an episode from the queue when it is deleted.</string>\n-    <string name=\"pref_filter_feed_title\">Subscription Filter</string>\n+    <string name=\"pref_filter_feed_title\">Subscription filter</string>\n     <string name=\"pref_filter_feed_sum\">Filter your subscriptions in navigation drawer and subscriptions screen.</string>\n     <string name=\"subscriptions_are_filtered\">Subscriptions are filtered.</string>\n     <string name=\"subscriptions_counter_greater_zero\">Counter greater than zero</string>\n@@ -518,9 +518,9 @@\n     <string name=\"new_episode_notification_disabled\">Notification disabled</string>\n     <string name=\"pref_feed_settings_dialog_msg\">This setting is unique to each podcast. You can change it by opening the podcast page.</string>\n     <string name=\"pref_contribute\">Contribute</string>\n-    <string name=\"pref_show_subscription_title\">Show Subscription Title</string>\n+    <string name=\"pref_show_subscription_title\">Show subscription title</string>\n     <string name=\"pref_show_subscription_title_summary\">Display the subscription title below the cover image.</string>\n-    <string name=\"pref_new_episodes_action_title\">New Episodes Action</string>\n+    <string name=\"pref_new_episodes_action_title\">New episodes action</string>\n     <string name=\"pref_new_episodes_action_sum\">Action to take for new episodes</string>\n \n     <!-- About screen -->\n@@ -651,11 +651,11 @@\n     <string name=\"gpodnetsync_username_characters_error\">Usernames may only contain letters, digits, hyphens and underscores.</string>\n \n     <!-- Directory chooser -->\n-    <string name=\"choose_data_directory\">Choose Data Folder</string>\n+    <string name=\"choose_data_directory\">Choose data folder</string>\n     <string name=\"choose_data_directory_message\">Please choose the base of your data folder. AntennaPod will create the appropriate sub-directories.</string>\n     <string name=\"choose_data_directory_available_space\">%1$s of %2$s free</string>\n     <string name=\"pref_pausePlaybackForFocusLoss_sum\">Pause playback instead of lowering volume when another app wants to play sounds</string>\n-    <string name=\"pref_pausePlaybackForFocusLoss_title\">Pause for Interruptions</string>\n+    <string name=\"pref_pausePlaybackForFocusLoss_title\">Pause for interruptions</string>\n \n     <!-- Online feed view -->\n     <string name=\"subscribe_label\">Subscribe</string>\n@@ -688,14 +688,14 @@\n     <string name=\"feed_tags_summary\">Change the tags of this podcast to help organize your subscriptions</string>\n     <string name=\"feed_folders_include_root\">Show this podcast in main list</string>\n     <string name=\"multi_feed_common_tags_info\">{fa-info-circle} Only common tags from all selected subscriptions are shown. Other tags stay unaffected.</string>\n-    <string name=\"auto_download_settings_label\">Auto Download Settings</string>\n-    <string name=\"episode_filters_label\">Episode Filter</string>\n+    <string name=\"auto_download_settings_label\">Auto download settings</string>\n+    <string name=\"episode_filters_label\">Episode filter</string>\n     <string name=\"episode_filters_description\">List of terms used to decide if an episode should be included or excluded when auto downloading</string>\n-    <string name=\"add_term\">Add Term</string>\n+    <string name=\"add_term\">Add term</string>\n     <string name=\"exclude_terms\">Exclude episodes containing any of the terms below</string>\n     <string name=\"include_terms\">Include only episodes containing any of the terms below</string>\n     <string name=\"exclude_episodes_shorter_than\">Exclude episodes shorter than</string>\n-    <string name=\"keep_updated\">Keep Updated</string>\n+    <string name=\"keep_updated\">Keep updated</string>\n     <string name=\"keep_updated_summary\">Include this podcast when (auto-)refreshing all podcasts</string>\n     <string name=\"auto_download_disabled_globally\">Auto download is disabled in the main AntennaPod settings</string>\n     <string name=\"statistics_time_played\">Time played:</string>\n@@ -785,8 +785,8 @@\n \n     <!-- Audio controls -->\n     <string name=\"audio_controls\">Audio controls</string>\n-    <string name=\"playback_speed\">Playback Speed</string>\n-    <string name=\"audio_effects\">Audio Effects</string>\n+    <string name=\"playback_speed\">Playback speed</string>\n+    <string name=\"audio_effects\">Audio effects</string>\n     <string name=\"player_switch_to_audio_only\">Switch to audio only</string>\n \n     <!-- proxy settings -->\n@@ -820,7 +820,7 @@\n     <string name=\"notification_channel_sync_error_description\">Shown when gpodder synchronization fails.</string>\n     <string name=\"notification_channel_auto_download\">Automatic download completed</string>\n     <string name=\"notification_channel_episode_auto_download\">Shown when episodes have been automatically downloaded.</string>\n-    <string name=\"notification_channel_new_episode\">New Episode</string>\n+    <string name=\"notification_channel_new_episode\">New episode</string>\n     <string name=\"notification_channel_new_episode_description\">Shown when a new episode of a podcast was found, where notifications are enabled</string>\n \n     <!-- Widget settings -->\n@@ -835,5 +835,5 @@\n \n     <string name=\"shortcut_subscription_label\">Subscription shortcut</string>\n     <string name=\"shortcut_select_subscription\">Select subscription</string>\n-    <string name=\"add_shortcut\">Add Shortcut</string>\n+    <string name=\"add_shortcut\">Add shortcut</string>\n </resources>\n", "test_patch": "", "problem_statement": "Use sentence case consistently for settings and other in-app text\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.0.0 beta 5\n\n### Where did you get the app from\n\nGoogle Play\n\n### Problem you may be having, or feature you want\n\nI was about to open a PR for a specific instance of this, but then I realised the issue is more general: we currently mix Title Case, Sentence case, And Sometimes a strange Mix between the Two.\r\n\r\nThis is particularly noticeable in the settings, but also applies to other screens. Outside of the settings, I spotted the following instances:\r\n- Playback History (screen title)\r\n- Add Podcast (screen title and \"Add Podcast by RSS address\" option)\r\n- Home: \"Configure Home Screen\" option\r\n- Queue: \"Clear Queue\", \"Lock Queue\" and \"Smart Shuffle\" options\r\n- Downloads: \"Download Log\"\n\n### Suggested solution\n\nOther mainstream apps use sentence case consistently, which is what I would find more natural and easier on the eye.\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "Decision from the 11/03/2023 Community Call: use Title Case. Whether to use Title or Sentence case is mainly an editorial decision with (as far as we know) little or no impact on readability/usability. Therefore we opted for Title Case which would cause a lower number of changes to be implemented by translators.\r\n\r\n@femmdi said he would make a list of affected strings.\nOn transifex would old translation still appears in history ?\n> On transifex would old translation still appears in history ?\r\n\r\nNormally yes\n> On transifex would old translation still appears in history ?\r\n\r\nIndeed they would (and based on my experience as a translator for other projects, it would be very quick to reuse them).\r\n\r\nBy the way, the Material Design guidelines and Google's developer documentation style guide favour sentence case:\r\n- https://m1.material.io/style/writing.html\r\n- https://m2.material.io/design/platform-guidance/android-settings.html#label-and-secondary-text\r\n- https://m3.material.io/components/buttons/overview\r\n- https://developers.google.com/style/capitalization", "created_at": "2023-03-20T07:48:29Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6385, "instance_id": "AntennaPod__AntennaPod-6385", "issue_numbers": ["6320"], "base_commit": "4f7f49e1e714ce41320fff569272a1423198b2f3", "patch": "diff --git a/app/src/main/res/xml/preferences_user_interface.xml b/app/src/main/res/xml/preferences_user_interface.xml\nindex ed3f5777af..02d15f6d4d 100644\n--- a/app/src/main/res/xml/preferences_user_interface.xml\n+++ b/app/src/main/res/xml/preferences_user_interface.xml\n@@ -73,12 +73,6 @@\n                 android:key=\"prefCompactNotificationButtons\"\n                 android:summary=\"@string/pref_compact_notification_buttons_sum\"\n                 android:title=\"@string/pref_compact_notification_buttons_title\"/>\n-        <SwitchPreferenceCompat\n-                android:defaultValue=\"true\"\n-                android:enabled=\"true\"\n-                android:key=\"prefLockscreenBackground\"\n-                android:summary=\"@string/pref_lockscreen_background_sum\"\n-                android:title=\"@string/pref_lockscreen_background_title\"/>\n     </PreferenceCategory>\n     <PreferenceCategory android:title=\"@string/behavior\">\n         <de.danoeh.antennapod.preferences.MaterialListPreference\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\nindex 4887246655..e512f413f7 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n@@ -13,7 +13,6 @@\n import android.content.Context;\n import android.content.Intent;\n import android.content.IntentFilter;\n-import android.content.SharedPreferences;\n import android.content.res.Configuration;\n import android.media.AudioManager;\n import android.net.Uri;\n@@ -43,7 +42,6 @@\n import androidx.core.app.NotificationCompat;\n import androidx.core.app.NotificationManagerCompat;\n import androidx.media.MediaBrowserServiceCompat;\n-import androidx.preference.PreferenceManager;\n \n import de.danoeh.antennapod.core.service.QuickSettingsTileService;\n import de.danoeh.antennapod.core.util.playback.PlayableUtils;\n@@ -221,9 +219,6 @@ public void onCreate() {\n         EventBus.getDefault().register(this);\n         taskManager = new PlaybackServiceTaskManager(this, taskManagerCallback);\n \n-        PreferenceManager.getDefaultSharedPreferences(this)\n-                .registerOnSharedPreferenceChangeListener(prefListener);\n-\n         recreateMediaSessionIfNeeded();\n         castStateListener = new CastStateListener(this) {\n             @Override\n@@ -302,7 +297,6 @@ public void onDestroy() {\n         castStateListener.destroy();\n \n         cancelPositionObserver();\n-        PreferenceManager.getDefaultSharedPreferences(this).unregisterOnSharedPreferenceChangeListener(prefListener);\n         if (mediaSession != null) {\n             mediaSession.release();\n             mediaSession = null;\n@@ -1244,11 +1238,25 @@ private void updateMediaSessionMetadata(final Playable p) {\n         builder.putString(MediaMetadataCompat.METADATA_KEY_DISPLAY_TITLE, p.getEpisodeTitle());\n         builder.putString(MediaMetadataCompat.METADATA_KEY_DISPLAY_SUBTITLE, p.getFeedTitle());\n \n-        if (UserPreferences.setLockscreenBackground() && notificationBuilder.isIconCached()) {\n+\n+        if (notificationBuilder.isIconCached()) {\n             builder.putBitmap(MediaMetadataCompat.METADATA_KEY_ART, notificationBuilder.getCachedIcon());\n-        } else if (isCasting && !TextUtils.isEmpty(p.getImageLocation())) {\n-            // In the absence of metadata art, the controller dialog takes care of creating it.\n-            builder.putString(MediaMetadataCompat.METADATA_KEY_DISPLAY_ICON_URI, p.getImageLocation());\n+        } else {\n+            String iconUri = p.getImageLocation();\n+            if (p instanceof FeedMedia) { // Don't use embedded cover etc, which Android can't load\n+                FeedMedia m = (FeedMedia) p;\n+                if (m.getItem() != null) {\n+                    FeedItem item = m.getItem();\n+                    if (item.getImageUrl() != null) {\n+                        iconUri = item.getImageUrl();\n+                    } else if (item.getFeed() != null) {\n+                        iconUri = item.getFeed().getImageUrl();\n+                    }\n+                }\n+            }\n+            if (!TextUtils.isEmpty(iconUri)) {\n+                builder.putString(MediaMetadataCompat.METADATA_KEY_DISPLAY_ICON_URI, iconUri);\n+            }\n         }\n \n         if (stateManager.hasReceivedValidStartCommand()) {\n@@ -1820,11 +1828,4 @@ public void onCustomAction(String action, Bundle extra) {\n             }\n         }\n     };\n-\n-    private final SharedPreferences.OnSharedPreferenceChangeListener prefListener =\n-            (sharedPreferences, key) -> {\n-                if (UserPreferences.PREF_LOCKSCREEN_BACKGROUND.equals(key)) {\n-                    updateNotificationAndMediaSession(getPlayable());\n-                }\n-            };\n }\ndiff --git a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\nindex 8a4d248eec..21b61fb89b 100644\n--- a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n+++ b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n@@ -55,7 +55,6 @@ private UserPreferences(){}\n     public static final String PREF_SHOW_TIME_LEFT = \"showTimeLeft\";\n     private static final String PREF_PERSISTENT_NOTIFICATION = \"prefPersistNotify\";\n     public static final String PREF_COMPACT_NOTIFICATION_BUTTONS = \"prefCompactNotificationButtons\";\n-    public static final String PREF_LOCKSCREEN_BACKGROUND = \"prefLockscreenBackground\";\n     private static final String PREF_SHOW_DOWNLOAD_REPORT = \"prefShowDownloadReport\";\n     private static final String PREF_SHOW_AUTO_DOWNLOAD_REPORT = \"prefShowAutoDownloadReport\";\n     public static final String PREF_DEFAULT_PAGE = \"prefDefaultPage\";\n@@ -291,15 +290,6 @@ public static boolean isPersistNotify() {\n         return prefs.getBoolean(PREF_PERSISTENT_NOTIFICATION, true);\n     }\n \n-    /**\n-     * Returns true if the lockscreen background should be set to the current episode's image\n-     *\n-     * @return {@code true} if the lockscreen background should be set, {@code false}  otherwise\n-     */\n-    public static boolean setLockscreenBackground() {\n-        return prefs.getBoolean(PREF_LOCKSCREEN_BACKGROUND, true);\n-    }\n-\n     /**\n      * Returns true if download reports are shown\n      *\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 32db0dcac3..c0301b59d4 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -485,8 +485,6 @@\n     <string name=\"pref_compact_notification_buttons_sum\">Change the playback buttons when the notification is collapsed. The play/pause button is always included.</string>\n     <string name=\"pref_compact_notification_buttons_dialog_title\">Select a maximum of %1$d items</string>\n     <string name=\"pref_compact_notification_buttons_dialog_error\">You can only select a maximum of %1$d items.</string>\n-    <string name=\"pref_lockscreen_background_title\">Set Lockscreen Background</string>\n-    <string name=\"pref_lockscreen_background_sum\">Set the lockscreen background to the current episode\\'s image. As a side effect, this will also show the image in third party apps.</string>\n     <string name=\"pref_enqueue_location_title\">Enqueue Location</string>\n     <string name=\"pref_enqueue_location_sum\">Add episodes to: %1$s</string>\n     <string name=\"enqueue_location_back\">Back</string>\n", "test_patch": "", "problem_statement": "Missing episode / podcast art in Android Auto\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n2.7.1\n\n### Where did you get the app from\n\nF-Droid\n\n### Android version\n\n13\n\n### Device model\n\nSamsung Galaxy S22 Ultra (SM-S908W)\n\n### First occurred\n\nDidn't notice it until coolwalk. But looking into old pictures, this problem exists at least since last year\n\n### Steps to reproduce\n\nPlay any episode when connected to Android Auto. It can either have an episode art or just podcast art. It doesn't matter.\n\n### Expected behaviour\n\nA cover art, like the one shown in app, will be shown on the screen\n\n### Current behaviour\n\n<img width=\"3200\" alt=\"Android Auto\" src=\"https://user-images.githubusercontent.com/77537216/218908676-d69e5f34-57b6-4eb6-939d-a1e3b1faa350.png\">\r\n\n\n### Logs\n\n_No response_\n", "hints_text": "@gthbusrr thanks for reporting this,  on the right-hand does it show up just like you have it or did you remove anything?\r\n\r\nIf you expand the AnntenaPod player such that it takes up the entire screen, does the artwork show up?\nAlso, does it happen for all podcasts or just some? On the phone, we are a bit more flexible in working around broken podcast feeds \n@tonytamsf Hi Tony, it just show up just like I have it. I've only removed the \"Podcast name\"\r\nI can not expand the AntennaPod player to full screen, but if I put it up to the main screen, It's a black screen with the episode name, etc, just without the artwork.\r\n\r\n@ByteHamster It happens to all podcasts on Android Auto that I subscribed , but not on the phone.\r\n\r\nSorry abt the late reply\nI have the same issue on Android Auto. To add some different demographic data, I have a Pixel 7 and I downloaded AntennaPod from the Google Play Store. However, I am also on 2.7.1 and Android 13 and it affects all of my feeds. I will say I don't think is a new development; I believe I have noticed this problem on Android Auto dating back to when I first downloaded AntennaPod in December.\r\n\r\nIf I can provide any additional information, please don't hesitate to ask. Any help would be appreciated.\nDid you disable the setting \"set lockscreen background\"?\n@ByteHamster Sorry for the delayed response, I had not been in the car since your reply until this afternoon.\r\n\r\nWelp.\r\n\r\nI don't remember previously touching that setting one way or another. But I enabled that setting, and my issue appears to have resolved. Not sure if OP will have similar luck. Thank you!\n@ByteHamster Sorry about the late response.\r\n\r\nI turned off **Set Lockscreen Background** because I thought it'll change my lockscreen background (as the name suggests). I turned it on and 1. it didn't change my lockscreen background, 2. Now episode / podcast art is showing in Android Auto.\r\n\r\nIt's either a bug (it didn't change my lockscreen background) or a misleading label. Either way, I like how it's showing episode / podcast art **without** changing my lockscreen background.\n> it didn't change my lockscreen background\n\nSame. Maybe this only works in certain Android versions? (I'm on A.11)\n\n> Now episode / podcast art is showing in Android Auto.\n\nThe description does say \"this will also show the image in third party apps\". But I wouldn't consider Android Auto as such.\nWe can either tell the Android system about the cover (which it then uses for different things, like Android Auto or possibly lockscreen background), or we don't tell the Android system. There is no \"show in x but not y\".\r\n\r\n@keunes I guess most users don't really understand what the setting does. Also, I think recent Android versions no longer set the lockscreen background anyway. How about removing that setting? That reduces the number of things users can \"misconfigure\".\n> How about removing that setting? That reduces the number of things users can \"misconfigure\".\n\nYeap. And then always enabled I suppose.", "created_at": "2023-03-19T10:39:31Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6384, "instance_id": "AntennaPod__AntennaPod-6384", "issue_numbers": ["6122"], "base_commit": "038847177e33d82669ff61dd730589fb58adbed4", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/dialog/SleepTimerDialog.java b/app/src/main/java/de/danoeh/antennapod/dialog/SleepTimerDialog.java\nindex 52e6f78078..ecbc1d8736 100644\n--- a/app/src/main/java/de/danoeh/antennapod/dialog/SleepTimerDialog.java\n+++ b/app/src/main/java/de/danoeh/antennapod/dialog/SleepTimerDialog.java\n@@ -4,6 +4,7 @@\n import android.app.Dialog;\n import android.content.Context;\n import android.os.Bundle;\n+import android.text.format.DateFormat;\n import android.view.View;\n import android.view.inputmethod.InputMethodManager;\n import android.widget.Button;\n@@ -11,19 +12,25 @@\n import android.widget.EditText;\n import android.widget.LinearLayout;\n import android.widget.TextView;\n+\n import androidx.annotation.NonNull;\n-import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import androidx.fragment.app.DialogFragment;\n+\n+import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import com.google.android.material.snackbar.Snackbar;\n+\n+import org.greenrobot.eventbus.EventBus;\n+import org.greenrobot.eventbus.Subscribe;\n+import org.greenrobot.eventbus.ThreadMode;\n+\n+import java.util.Locale;\n+\n import de.danoeh.antennapod.R;\n-import de.danoeh.antennapod.event.playback.SleepTimerUpdatedEvent;\n import de.danoeh.antennapod.core.preferences.SleepTimerPreferences;\n import de.danoeh.antennapod.core.service.playback.PlaybackService;\n import de.danoeh.antennapod.core.util.Converter;\n import de.danoeh.antennapod.core.util.playback.PlaybackController;\n-import org.greenrobot.eventbus.EventBus;\n-import org.greenrobot.eventbus.Subscribe;\n-import org.greenrobot.eventbus.ThreadMode;\n+import de.danoeh.antennapod.event.playback.SleepTimerUpdatedEvent;\n \n public class SleepTimerDialog extends DialogFragment {\n     private PlaybackController controller;\n@@ -31,6 +38,7 @@ public class SleepTimerDialog extends DialogFragment {\n     private LinearLayout timeSetup;\n     private LinearLayout timeDisplay;\n     private TextView time;\n+    private CheckBox chAutoEnable;\n \n     public SleepTimerDialog() {\n \n@@ -99,20 +107,38 @@ public Dialog onCreateDialog(Bundle savedInstanceState) {\n             imm.showSoftInput(etxtTime, InputMethodManager.SHOW_IMPLICIT);\n         }, 100);\n \n-        CheckBox cbShakeToReset = content.findViewById(R.id.cbShakeToReset);\n-        CheckBox cbVibrate = content.findViewById(R.id.cbVibrate);\n-        CheckBox chAutoEnable = content.findViewById(R.id.chAutoEnable);\n+        final CheckBox cbShakeToReset = content.findViewById(R.id.cbShakeToReset);\n+        final CheckBox cbVibrate = content.findViewById(R.id.cbVibrate);\n+        chAutoEnable = content.findViewById(R.id.chAutoEnable);\n+        final TextView changeTimesButton = content.findViewById(R.id.changeTimes);\n \n         cbShakeToReset.setChecked(SleepTimerPreferences.shakeToReset());\n         cbVibrate.setChecked(SleepTimerPreferences.vibrate());\n         chAutoEnable.setChecked(SleepTimerPreferences.autoEnable());\n+        changeTimesButton.setEnabled(chAutoEnable.isChecked());\n \n         cbShakeToReset.setOnCheckedChangeListener((buttonView, isChecked)\n                 -> SleepTimerPreferences.setShakeToReset(isChecked));\n         cbVibrate.setOnCheckedChangeListener((buttonView, isChecked)\n                 -> SleepTimerPreferences.setVibrate(isChecked));\n         chAutoEnable.setOnCheckedChangeListener((compoundButton, isChecked)\n-                -> SleepTimerPreferences.setAutoEnable(isChecked));\n+                -> {\n+            SleepTimerPreferences.setAutoEnable(isChecked);\n+            changeTimesButton.setEnabled(isChecked);\n+        });\n+        updateAutoEnableText();\n+\n+        changeTimesButton.setOnClickListener(changeTimesBtn -> {\n+            int from = SleepTimerPreferences.autoEnableFrom();\n+            int to = SleepTimerPreferences.autoEnableTo();\n+            TimeRangeDialog dialog = new TimeRangeDialog(getContext(), from, to);\n+            dialog.setOnDismissListener(v -> {\n+                SleepTimerPreferences.setAutoEnableFrom(dialog.getFrom());\n+                SleepTimerPreferences.setAutoEnableTo(dialog.getTo());\n+                updateAutoEnableText();\n+            });\n+            dialog.show();\n+        });\n \n         Button disableButton = content.findViewById(R.id.disableSleeptimerButton);\n         disableButton.setOnClickListener(v -> {\n@@ -144,6 +170,28 @@ public Dialog onCreateDialog(Bundle savedInstanceState) {\n         return builder.create();\n     }\n \n+    private void updateAutoEnableText() {\n+        String text;\n+        int from = SleepTimerPreferences.autoEnableFrom();\n+        int to = SleepTimerPreferences.autoEnableTo();\n+\n+        if (from == to) {\n+            text = getString(R.string.auto_enable_label);\n+        } else if (DateFormat.is24HourFormat(getContext())) {\n+            String formattedFrom = String.format(Locale.getDefault(), \"%02d:00\", from);\n+            String formattedTo = String.format(Locale.getDefault(), \"%02d:00\", to);\n+            text = getString(R.string.auto_enable_label_with_times, formattedFrom, formattedTo);\n+        } else {\n+            String formattedFrom = String.format(Locale.getDefault(), \"%02d:00 %s\",\n+                    from % 12, from >= 12 ? \"PM\" : \"AM\");\n+            String formattedTo = String.format(Locale.getDefault(), \"%02d:00 %s\",\n+                    to % 12, to >= 12 ? \"PM\" : \"AM\");\n+            text = getString(R.string.auto_enable_label_with_times, formattedFrom, formattedTo);\n+\n+        }\n+        chAutoEnable.setText(text);\n+    }\n+\n     @Subscribe(threadMode = ThreadMode.MAIN)\n     @SuppressWarnings(\"unused\")\n     public void timerUpdated(SleepTimerUpdatedEvent event) {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/dialog/TimeRangeDialog.java b/app/src/main/java/de/danoeh/antennapod/dialog/TimeRangeDialog.java\nnew file mode 100644\nindex 0000000000..85913043ea\n--- /dev/null\n+++ b/app/src/main/java/de/danoeh/antennapod/dialog/TimeRangeDialog.java\n@@ -0,0 +1,187 @@\n+package de.danoeh.antennapod.dialog;\n+\n+import android.content.Context;\n+import android.graphics.Canvas;\n+import android.graphics.Paint;\n+import android.graphics.Point;\n+import android.graphics.RectF;\n+import android.text.format.DateFormat;\n+import android.view.MotionEvent;\n+import android.view.View;\n+import androidx.annotation.NonNull;\n+import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n+import de.danoeh.antennapod.R;\n+import de.danoeh.antennapod.ui.common.ThemeUtils;\n+\n+import java.util.Locale;\n+\n+public class TimeRangeDialog extends MaterialAlertDialogBuilder {\n+    private final TimeRangeView view;\n+\n+    public TimeRangeDialog(@NonNull Context context, int from, int to) {\n+        super(context);\n+        view = new TimeRangeView(context, from, to);\n+        setView(view);\n+        setPositiveButton(android.R.string.ok, null);\n+    }\n+\n+    public int getFrom() {\n+        return view.from;\n+    }\n+\n+    public int getTo() {\n+        return view.to;\n+    }\n+\n+    static class TimeRangeView extends View {\n+        private static final int DIAL_ALPHA = 120;\n+        private final Paint paintDial = new Paint();\n+        private final Paint paintSelected = new Paint();\n+        private final Paint paintText = new Paint();\n+        private int from;\n+        private int to;\n+        private final RectF bounds = new RectF();\n+        int touching = 0;\n+\n+        public TimeRangeView(Context context) { // Used by Android tools\n+            this(context, 0, 0);\n+        }\n+\n+        public TimeRangeView(Context context, int from, int to) {\n+            super(context);\n+            this.from = from;\n+            this.to = to;\n+            setup();\n+        }\n+\n+        private void setup() {\n+            paintDial.setAntiAlias(true);\n+            paintDial.setStyle(Paint.Style.STROKE);\n+            paintDial.setStrokeCap(Paint.Cap.ROUND);\n+            paintDial.setColor(ThemeUtils.getColorFromAttr(getContext(), android.R.attr.textColorPrimary));\n+            paintDial.setAlpha(DIAL_ALPHA);\n+\n+            paintSelected.setAntiAlias(true);\n+            paintSelected.setStyle(Paint.Style.STROKE);\n+            paintSelected.setStrokeCap(Paint.Cap.ROUND);\n+            paintSelected.setColor(ThemeUtils.getColorFromAttr(getContext(), R.attr.colorAccent));\n+\n+            paintText.setAntiAlias(true);\n+            paintText.setStyle(Paint.Style.FILL);\n+            paintText.setColor(ThemeUtils.getColorFromAttr(getContext(), android.R.attr.textColorPrimary));\n+            paintText.setTextAlign(Paint.Align.CENTER);\n+        }\n+\n+        @Override\n+        protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {\n+            if (MeasureSpec.getMode(widthMeasureSpec) == MeasureSpec.EXACTLY\n+                    && MeasureSpec.getMode(heightMeasureSpec) == MeasureSpec.EXACTLY) {\n+                super.onMeasure(widthMeasureSpec, heightMeasureSpec);\n+            } else if (MeasureSpec.getMode(widthMeasureSpec) == MeasureSpec.EXACTLY) {\n+                super.onMeasure(widthMeasureSpec, widthMeasureSpec);\n+            } else if (MeasureSpec.getMode(heightMeasureSpec) == MeasureSpec.EXACTLY) {\n+                super.onMeasure(heightMeasureSpec, heightMeasureSpec);\n+            } else if (MeasureSpec.getSize(widthMeasureSpec) < MeasureSpec.getSize(heightMeasureSpec)) {\n+                super.onMeasure(widthMeasureSpec, widthMeasureSpec);\n+            } else {\n+                super.onMeasure(heightMeasureSpec, heightMeasureSpec);\n+            }\n+        }\n+\n+        @Override\n+        protected void onDraw(Canvas canvas) {\n+            super.onDraw(canvas);\n+\n+            float size = getHeight(); // square\n+            float padding = size * 0.1f;\n+            paintDial.setStrokeWidth(size * 0.005f);\n+            bounds.set(padding, padding, size - padding, size - padding);\n+\n+            paintText.setAlpha(DIAL_ALPHA);\n+            canvas.drawArc(bounds, 0, 360, false, paintDial);\n+            for (int i = 0; i < 24; i++) {\n+                paintDial.setStrokeWidth(size * 0.005f);\n+                if (i % 6 == 0) {\n+                    paintDial.setStrokeWidth(size * 0.01f);\n+                    Point textPos = radToPoint(i / 24.0f * 360.f, size / 2 - 2.5f * padding);\n+                    paintText.setTextSize(0.4f * padding);\n+                    canvas.drawText(String.valueOf(i), textPos.x,\n+                            textPos.y + (-paintText.descent() - paintText.ascent()) / 2, paintText);\n+                }\n+                Point outer = radToPoint(i / 24.0f * 360.f, size / 2 - 1.7f * padding);\n+                Point inner = radToPoint(i / 24.0f * 360.f, size / 2 - 1.9f * padding);\n+                canvas.drawLine(outer.x, outer.y, inner.x, inner.y, paintDial);\n+            }\n+            paintText.setAlpha(255);\n+\n+            float angleFrom = (float) from / 24 * 360 - 90;\n+            float angleDistance = (float) ((to - from + 24) % 24) / 24 * 360;\n+            paintSelected.setStrokeWidth(padding / 6);\n+            paintSelected.setStyle(Paint.Style.STROKE);\n+            canvas.drawArc(bounds, angleFrom, angleDistance, false, paintSelected);\n+            paintSelected.setStyle(Paint.Style.FILL);\n+            Point p1 = radToPoint(angleFrom + 90, size / 2 - padding);\n+            canvas.drawCircle(p1.x, p1.y, padding / 2, paintSelected);\n+            Point p2 = radToPoint(angleFrom + angleDistance + 90, size / 2 - padding);\n+            canvas.drawCircle(p2.x, p2.y, padding / 2, paintSelected);\n+\n+            paintText.setTextSize(0.6f * padding);\n+            String timeRange;\n+            if (from == to) {\n+                timeRange = getContext().getString(R.string.sleep_timer_always);\n+            } else if (DateFormat.is24HourFormat(getContext())) {\n+                timeRange = String.format(Locale.getDefault(), \"%02d:00 - %02d:00\", from, to);\n+            } else {\n+                timeRange = String.format(Locale.getDefault(), \"%02d:00 %s - %02d:00 %s\", from % 12,\n+                        from >= 12 ? \"PM\" : \"AM\", to % 12, to >= 12 ? \"PM\" : \"AM\");\n+            }\n+            canvas.drawText(timeRange, size / 2, (size - paintText.descent() - paintText.ascent()) / 2, paintText);\n+        }\n+\n+        protected Point radToPoint(float angle, float radius) {\n+            return new Point((int) (getWidth() / 2 + radius * Math.sin(-angle * Math.PI / 180 + Math.PI)),\n+                    (int) (getHeight() / 2 + radius * Math.cos(-angle * Math.PI / 180 + Math.PI)));\n+        }\n+\n+        @Override\n+        public boolean onTouchEvent(MotionEvent event) {\n+            getParent().requestDisallowInterceptTouchEvent(true);\n+            Point center = new Point(getWidth() / 2, getHeight() / 2);\n+            double angleRad = Math.atan2(center.y - event.getY(), center.x - event.getX());\n+            float angle = (float) (angleRad * (180 / Math.PI));\n+            angle += 360 + 360 - 90;\n+            angle %= 360;\n+\n+            if (event.getAction() == MotionEvent.ACTION_DOWN) {\n+                float fromDistance = Math.abs(angle - (float) from / 24 * 360);\n+                float toDistance = Math.abs(angle - (float) to / 24 * 360);\n+                if (fromDistance < 15 || fromDistance > (360 - 15)) {\n+                    touching = 1;\n+                    return true;\n+                } else if (toDistance < 15 || toDistance > (360 - 15)) {\n+                    touching = 2;\n+                    return true;\n+                }\n+            } else if (event.getAction() == MotionEvent.ACTION_MOVE) {\n+                int newTime = (int) (24 * (angle / 360.0));\n+                if (from == to && touching != 0) {\n+                    // Switch which handle is focussed such that selection is the smaller arc\n+                    touching = (((newTime - to + 24) % 24) < 12) ? 2 : 1;\n+                }\n+                if (touching == 1) {\n+                    from = newTime;\n+                    invalidate();\n+                    return true;\n+                } else if (touching == 2) {\n+                    to = newTime;\n+                    invalidate();\n+                    return true;\n+                }\n+            } else if (touching != 0) {\n+                touching = 0;\n+                return true;\n+            }\n+            return super.onTouchEvent(event);\n+        }\n+    }\n+}\ndiff --git a/app/src/main/res/layout/time_dialog.xml b/app/src/main/res/layout/time_dialog.xml\nindex 50001bf9cd..1a8f02c7c2 100644\n--- a/app/src/main/res/layout/time_dialog.xml\n+++ b/app/src/main/res/layout/time_dialog.xml\n@@ -141,6 +141,14 @@\n             android:layout_height=\"wrap_content\"\n             android:text=\"@string/auto_enable_label\" />\n \n+        <Button\n+            android:id=\"@+id/changeTimes\"\n+            android:layout_width=\"wrap_content\"\n+            android:layout_height=\"wrap_content\"\n+            android:text=\"@string/auto_enable_change_times\"\n+            android:layout_gravity=\"center\"\n+            style=\"@style/Widget.MaterialComponents.Button.TextButton\" />\n+\n     </LinearLayout>\n \n </LinearLayout>\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/preferences/SleepTimerPreferences.java b/core/src/main/java/de/danoeh/antennapod/core/preferences/SleepTimerPreferences.java\nindex b56e7e6f32..96ffe5cb66 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/preferences/SleepTimerPreferences.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/preferences/SleepTimerPreferences.java\n@@ -2,9 +2,10 @@\n \n import android.content.Context;\n import android.content.SharedPreferences;\n-import androidx.annotation.NonNull;\n import android.util.Log;\n \n+import androidx.annotation.NonNull;\n+\n import java.util.concurrent.TimeUnit;\n \n public class SleepTimerPreferences {\n@@ -17,8 +18,12 @@ public class SleepTimerPreferences {\n     private static final String PREF_VIBRATE = \"Vibrate\";\n     private static final String PREF_SHAKE_TO_RESET = \"ShakeToReset\";\n     private static final String PREF_AUTO_ENABLE = \"AutoEnable\";\n+    private static final String PREF_AUTO_ENABLE_FROM = \"AutoEnableFrom\";\n+    private static final String PREF_AUTO_ENABLE_TO = \"AutoEnableTo\";\n \n-    private static final String DEFAULT_VALUE = \"15\";\n+    private static final String DEFAULT_LAST_TIMER = \"15\";\n+    private static final int DEFAULT_AUTO_ENABLE_FROM = 22;\n+    private static final int DEFAULT_AUTO_ENABLE_TO = 6;\n \n     private static SharedPreferences prefs;\n \n@@ -37,7 +42,7 @@ public static void setLastTimer(String value) {\n     }\n \n     public static String lastTimerValue() {\n-        return prefs.getString(PREF_VALUE, DEFAULT_VALUE);\n+        return prefs.getString(PREF_VALUE, DEFAULT_LAST_TIMER);\n     }\n \n     public static long timerMillis() {\n@@ -69,4 +74,33 @@ public static boolean autoEnable() {\n         return prefs.getBoolean(PREF_AUTO_ENABLE, false);\n     }\n \n+    public static void setAutoEnableFrom(int hourOfDay) {\n+        prefs.edit().putInt(PREF_AUTO_ENABLE_FROM, hourOfDay).apply();\n+    }\n+\n+    public static int autoEnableFrom() {\n+        return prefs.getInt(PREF_AUTO_ENABLE_FROM, DEFAULT_AUTO_ENABLE_FROM);\n+    }\n+\n+    public static void setAutoEnableTo(int hourOfDay) {\n+        prefs.edit().putInt(PREF_AUTO_ENABLE_TO, hourOfDay).apply();\n+    }\n+\n+    public static int autoEnableTo() {\n+        return prefs.getInt(PREF_AUTO_ENABLE_TO, DEFAULT_AUTO_ENABLE_TO);\n+    }\n+\n+    public static boolean isInTimeRange(int from, int to, int current) {\n+        // Range covers one day\n+        if (from < to) {\n+            return from <= current && current < to;\n+        }\n+\n+        // Range covers two days\n+        if (from <= current) {\n+            return true;\n+        }\n+\n+        return current < to;\n+    }\n }\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\nindex 4887246655..259e8f7760 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n@@ -45,37 +45,22 @@\n import androidx.media.MediaBrowserServiceCompat;\n import androidx.preference.PreferenceManager;\n \n-import de.danoeh.antennapod.core.service.QuickSettingsTileService;\n-import de.danoeh.antennapod.core.util.playback.PlayableUtils;\n-import de.danoeh.antennapod.event.playback.BufferUpdateEvent;\n-import de.danoeh.antennapod.event.playback.PlaybackServiceEvent;\n-import de.danoeh.antennapod.event.PlayerErrorEvent;\n-import de.danoeh.antennapod.event.playback.SleepTimerUpdatedEvent;\n-import de.danoeh.antennapod.model.feed.FeedItemFilter;\n-import de.danoeh.antennapod.model.feed.SortOrder;\n-import de.danoeh.antennapod.playback.base.PlaybackServiceMediaPlayer;\n-import de.danoeh.antennapod.playback.base.PlayerStatus;\n-import de.danoeh.antennapod.playback.cast.CastPsmp;\n-import de.danoeh.antennapod.playback.cast.CastStateListener;\n-import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import org.greenrobot.eventbus.EventBus;\n import org.greenrobot.eventbus.Subscribe;\n import org.greenrobot.eventbus.ThreadMode;\n \n import java.util.ArrayList;\n+import java.util.Calendar;\n import java.util.Collections;\n+import java.util.GregorianCalendar;\n import java.util.List;\n import java.util.concurrent.TimeUnit;\n \n import de.danoeh.antennapod.core.R;\n-import de.danoeh.antennapod.event.MessageEvent;\n-import de.danoeh.antennapod.event.playback.PlaybackPositionEvent;\n-import de.danoeh.antennapod.event.settings.SkipIntroEndingChangedEvent;\n-import de.danoeh.antennapod.event.settings.SpeedPresetChangedEvent;\n-import de.danoeh.antennapod.event.settings.VolumeAdaptionChangedEvent;\n import de.danoeh.antennapod.core.preferences.PlaybackPreferences;\n import de.danoeh.antennapod.core.preferences.SleepTimerPreferences;\n import de.danoeh.antennapod.core.receiver.MediaButtonReceiver;\n+import de.danoeh.antennapod.core.service.QuickSettingsTileService;\n import de.danoeh.antennapod.core.storage.DBReader;\n import de.danoeh.antennapod.core.storage.DBWriter;\n import de.danoeh.antennapod.core.storage.FeedSearcher;\n@@ -84,14 +69,31 @@\n import de.danoeh.antennapod.core.util.IntentUtils;\n import de.danoeh.antennapod.core.util.NetworkUtils;\n import de.danoeh.antennapod.core.util.gui.NotificationUtils;\n+import de.danoeh.antennapod.core.util.playback.PlayableUtils;\n import de.danoeh.antennapod.core.util.playback.PlaybackServiceStarter;\n import de.danoeh.antennapod.core.widget.WidgetUpdater;\n+import de.danoeh.antennapod.event.MessageEvent;\n+import de.danoeh.antennapod.event.PlayerErrorEvent;\n+import de.danoeh.antennapod.event.playback.BufferUpdateEvent;\n+import de.danoeh.antennapod.event.playback.PlaybackPositionEvent;\n+import de.danoeh.antennapod.event.playback.PlaybackServiceEvent;\n+import de.danoeh.antennapod.event.playback.SleepTimerUpdatedEvent;\n+import de.danoeh.antennapod.event.settings.SkipIntroEndingChangedEvent;\n+import de.danoeh.antennapod.event.settings.SpeedPresetChangedEvent;\n+import de.danoeh.antennapod.event.settings.VolumeAdaptionChangedEvent;\n import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.model.feed.FeedItem;\n+import de.danoeh.antennapod.model.feed.FeedItemFilter;\n import de.danoeh.antennapod.model.feed.FeedMedia;\n import de.danoeh.antennapod.model.feed.FeedPreferences;\n+import de.danoeh.antennapod.model.feed.SortOrder;\n import de.danoeh.antennapod.model.playback.MediaType;\n import de.danoeh.antennapod.model.playback.Playable;\n+import de.danoeh.antennapod.playback.base.PlaybackServiceMediaPlayer;\n+import de.danoeh.antennapod.playback.base.PlayerStatus;\n+import de.danoeh.antennapod.playback.cast.CastPsmp;\n+import de.danoeh.antennapod.playback.cast.CastStateListener;\n+import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import de.danoeh.antennapod.ui.appstartintent.MainActivityStarter;\n import de.danoeh.antennapod.ui.appstartintent.VideoPlayerActivityStarter;\n import io.reactivex.Completable;\n@@ -799,8 +801,18 @@ public void statusChanged(PlaybackServiceMediaPlayer.PSMPInfo newInfo) {\n                     stateManager.validStartCommandWasReceived();\n                     stateManager.startForeground(R.id.notification_playing, notificationBuilder.build());\n                     // set sleep timer if auto-enabled\n+                    boolean autoEnableByTime = true;\n+                    int fromSetting = SleepTimerPreferences.autoEnableFrom();\n+                    int toSetting = SleepTimerPreferences.autoEnableTo();\n+                    if (fromSetting != toSetting) {\n+                        Calendar now = new GregorianCalendar();\n+                        now.setTimeInMillis(System.currentTimeMillis());\n+                        int currentHour = now.get(Calendar.HOUR_OF_DAY);\n+                        autoEnableByTime = SleepTimerPreferences.isInTimeRange(fromSetting, toSetting, currentHour);\n+                    }\n+\n                     if (newInfo.oldPlayerStatus != null && newInfo.oldPlayerStatus != PlayerStatus.SEEKING\n-                            && SleepTimerPreferences.autoEnable() && !sleepTimerActive()) {\n+                            && SleepTimerPreferences.autoEnable() && autoEnableByTime && !sleepTimerActive()) {\n                         setSleepTimer(SleepTimerPreferences.timerMillis());\n                         EventBus.getDefault().post(new MessageEvent(getString(R.string.sleep_timer_enabled_label),\n                                 PlaybackService.this::disableSleepTimer));\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 32db0dcac3..b92bf2eaeb 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -592,6 +592,7 @@\n     <string name=\"set_sleeptimer_label\">Set sleep timer</string>\n     <string name=\"disable_sleeptimer_label\">Disable sleep timer</string>\n     <string name=\"extend_sleep_timer_label\">+%d min</string>\n+    <string name=\"sleep_timer_always\">Always</string>\n     <string name=\"sleep_timer_label\">Sleep timer</string>\n     <string name=\"time_dialog_invalid_input\">Invalid input, time has to be an integer</string>\n     <string name=\"shake_to_reset_label\">Shake to reset</string>\n@@ -611,7 +612,9 @@\n         <item quantity=\"one\">1 hour</item>\n         <item quantity=\"other\">%d hours</item>\n     </plurals>\n-    <string name=\"auto_enable_label\">Auto-enable</string>\n+    <string name=\"auto_enable_label\">Automatically activate the sleep timer when pressing play</string>\n+    <string name=\"auto_enable_label_with_times\">Automatically activate the sleep timer when pressing play between %s and %s</string>\n+    <string name=\"auto_enable_change_times\">Change times</string>\n     <string name=\"sleep_timer_enabled_label\">Sleep timer enabled</string>\n \n     <!-- Synchronisation -->\n", "test_patch": "diff --git a/app/src/androidTest/java/de/test/antennapod/service/playback/SleepTimerPreferencesTest.java b/app/src/androidTest/java/de/test/antennapod/service/playback/SleepTimerPreferencesTest.java\nnew file mode 100644\nindex 0000000000..4339d6cd7e\n--- /dev/null\n+++ b/app/src/androidTest/java/de/test/antennapod/service/playback/SleepTimerPreferencesTest.java\n@@ -0,0 +1,22 @@\n+package de.test.antennapod.service.playback;\n+\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertTrue;\n+\n+import org.junit.Test;\n+\n+import de.danoeh.antennapod.core.preferences.SleepTimerPreferences;\n+\n+public class SleepTimerPreferencesTest {\n+    @Test\n+    public void testIsInTimeRange() {\n+        assertTrue(SleepTimerPreferences.isInTimeRange(0, 10, 8));\n+        assertTrue(SleepTimerPreferences.isInTimeRange(1, 10, 8));\n+        assertTrue(SleepTimerPreferences.isInTimeRange(1, 10, 1));\n+        assertTrue(SleepTimerPreferences.isInTimeRange(20, 10, 8));\n+        assertTrue(SleepTimerPreferences.isInTimeRange(20, 20, 8));\n+        assertFalse(SleepTimerPreferences.isInTimeRange(1, 6, 8));\n+        assertFalse(SleepTimerPreferences.isInTimeRange(1, 6, 6));\n+        assertFalse(SleepTimerPreferences.isInTimeRange(20, 6, 8));\n+    }\n+}\n", "problem_statement": "Option to auto-enable sleep timer within a specific time of day\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n2.7.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Problem you may be having, or feature you want\n\nHi. Big fan! :)\r\n\r\nLately I've been listening to podcasts while going to sleep. Unfortunately some times I go to sleep very late, and I think I turn on sleep timer, but I don't actually do it \u2013 or I even forget it outright. Because of this, I've had a few times where lots of episodes have been played while I slept, and I've lost where in the episodes I was.\n\n### Suggested solution\n\nSince we often can be forgetful or not all \"with it\" when we are very tired and sleepy, I'm sure this happens to more people. That's why I think an option to auto-enable the sleep timer within a specific time range would be very useful.\r\n\r\nIt would work like how night light on screens work. You set a start time and an end time, and between those times the sleep timer is set automatically when you press play on any episode. Then, during the day (or night if you work night shift, you set the time interval yourself), you can play episodes without the sleep timer being set automatically.\r\n\r\nHope that was clear, and that you also think this could be useful. Thanks! :) \n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "This would be great. Would save me from fiddling with my phone while driving during my commute when it inevitably pauses playback because I forgot to turn it off. Its a nice feature in other players.", "created_at": "2023-03-18T09:55:46Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6378, "instance_id": "AntennaPod__AntennaPod-6378", "issue_numbers": ["6377"], "base_commit": "870fe2be56ac4ad08432b63b553054a4b8efbf46", "patch": "diff --git a/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastPsmp.java b/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastPsmp.java\nindex 0858d4fc96..c4f135157a 100644\n--- a/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastPsmp.java\n+++ b/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastPsmp.java\n@@ -59,11 +59,14 @@ public static PlaybackServiceMediaPlayer getInstanceIfConnected(@NonNull Context\n         if (GoogleApiAvailability.getInstance().isGooglePlayServicesAvailable(context) != ConnectionResult.SUCCESS) {\n             return null;\n         }\n-        if (CastContext.getSharedInstance(context).getCastState() == CastState.CONNECTED) {\n-            return new CastPsmp(context, callback);\n-        } else {\n-            return null;\n+        try {\n+            if (CastContext.getSharedInstance(context).getCastState() == CastState.CONNECTED) {\n+                return new CastPsmp(context, callback);\n+            }\n+        } catch (Exception e) {\n+            e.printStackTrace();\n         }\n+        return null;\n     }\n \n     public CastPsmp(@NonNull Context context, @NonNull PSMPCallback callback) {\ndiff --git a/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastStateListener.java b/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastStateListener.java\nindex 39f54b11cd..c9e8c84aa2 100644\n--- a/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastStateListener.java\n+++ b/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastStateListener.java\n@@ -16,8 +16,15 @@ public CastStateListener(Context context) {\n             castContext = null;\n             return;\n         }\n-        castContext = CastContext.getSharedInstance(context);\n-        castContext.getSessionManager().addSessionManagerListener(this, CastSession.class);\n+        CastContext castCtx;\n+        try {\n+            castCtx = CastContext.getSharedInstance(context);\n+            castCtx.getSessionManager().addSessionManagerListener(this, CastSession.class);\n+        } catch (Exception e) {\n+            e.printStackTrace();\n+            castCtx = null;\n+        }\n+        castContext = castCtx;\n     }\n \n     public void destroy() {\n", "test_patch": "", "problem_statement": "Crash on HarmonyOS when play the episode\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.0.0\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n_No response_\n\n### Expected behaviour\n\n_No response_\n\n### Current behaviour\n\n_No response_\n\n### Logs\n\n03-13 09:03:04.674  2494  2494 E AndroidRuntime: FATAL EXCEPTION: main\r\n03-13 09:03:04.674  2494  2494 E AndroidRuntime: Process: de.danoeh.antennapod, PID: 2494\r\n03-13 09:03:04.674  2494  2494 E AndroidRuntime: java.lang.RuntimeException: Unable to create service de.danoeh.antennapod.core.service.playback.PlaybackService: java.lang.RuntimeException: com.google.android.gms.cast.framework.ModuleUnavailableException: com.google.android.gms.dynamite.DynamiteModule$LoadingException: Remote load failed. No local fallback found.\r\n03-13 09:03:04.674  2494  2494 E AndroidRuntime: \tat android.app.ActivityThread.handleCreateService(ActivityThread.java:5577)\r\n03-13 09:03:04.674  2494  2494 E AndroidRuntime: \tat android.app.ActivityThread.access$3200(ActivityThread.java:299)\r\n03-13 09:03:04.674  2494  2494 E AndroidRuntime: \tat android.app.ActivityThread$H.handleMessage(ActivityThread.java:2783)\r\n03-13 09:03:04.674  2494  2494 E AndroidRuntime: \tat android.os.Handler.dispatchMessage(Handler.java:117)\r\n03-13 09:03:04.674  2494  2494 E AndroidRuntime: \tat android.os.Looper.loopOnce(Looper.java:205)\r\n03-13 09:03:04.674  2494  2494 E AndroidRuntime: \tat android.os.Looper.loop(Looper.java:293)\r\n03-13 09:03:04.674  2494  2494 E AndroidRuntime: \tat android.app.ActivityThread.main(ActivityThread.java:9596)\r\n03-13 09:03:04.674  2494  2494 E AndroidRuntime: \tat java.lang.reflect.Method.invoke(Native Method)\r\n03-13 09:03:04.674  2494  2494 E AndroidRuntime: \tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:586)\r\n03-13 09:03:04.674  2494  2494 E AndroidRuntime: \tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1204)\r\n03-13 09:03:04.674  2494  2494 E AndroidRuntime: Caused by: java.lang.RuntimeException: com.google.android.gms.cast.framework.ModuleUnavailableException: com.google.android.gms.dynamite.DynamiteModule$LoadingException: Remote load failed. No local fallback found.\r\n03-13 09:03:04.674  2494  2494 E AndroidRuntime: \tat com.google.android.gms.cast.framework.CastContext.getSharedInstance(SourceFile:11)\r\n03-13 09:03:04.674  2494  2494 E AndroidRuntime: \tat de.danoeh.antennapod.playback.cast.CastPsmp.getInstanceIfConnected(SourceFile:62)\r\n03-13 09:03:04.674  2494  2494 E AndroidRuntime: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.recreateMediaPlayer(SourceFile:275)\r\n03-13 09:03:04.674  2494  2494 E AndroidRuntime: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.recreateMediaSessionIfNeeded(SourceFile:262)\r\n03-13 09:03:04.674  2494  2494 E AndroidRuntime: \tat de.danoeh.antennapod.core.service.playback.PlaybackService.onCreate(SourceFile:223)\r\n03-13 09:03:04.674  2494  2494 E AndroidRuntime: \tat android.app.ActivityThread.handleCreateService(ActivityThread.java:5562)\r\n03-13 09:03:04.674  2494  2494 E AndroidRuntime: \t... 9 more\r\n03-13 09:03:04.674  2494  2494 E AndroidRuntime: Caused by: com.google.android.gms.cast.framework.ModuleUnavailableException: com.google.android.gms.dynamite.DynamiteModule$LoadingException: Remote load failed. No local fallback found.\n", "hints_text": "", "created_at": "2023-03-13T21:00:27Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6373, "instance_id": "AntennaPod__AntennaPod-6373", "issue_numbers": ["6372"], "base_commit": "86c11584b599bced9980f8c188e2f5e94b37e718", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\nindex 62ddf969c0..4141e8bf30 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n@@ -1083,6 +1083,7 @@ private void onPostPlayback(final Playable playable, boolean ended, boolean skip\n                     DBWriter.deleteFeedMediaOfItem(PlaybackService.this, media.getId());\n                     Log.d(TAG, \"Episode Deleted\");\n                 }\n+                notifyChildrenChanged(getString(R.string.queue_label));\n             }\n         }\n \n@@ -1675,6 +1676,7 @@ private void addPlayableToQueue(Playable playable) {\n         if (playable instanceof FeedMedia) {\n             long itemId = ((FeedMedia) playable).getItem().getId();\n             DBWriter.addQueueItem(this, false, true, itemId);\n+            notifyChildrenChanged(getString(R.string.queue_label));\n         }\n     }\n \n", "test_patch": "", "problem_statement": "Queue still shows finished podcasts in Android Auto\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n2.7.1\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n13\n\n### Device model\n\nPixel 6\n\n### First occurred\n\nmonths\n\n### Steps to reproduce\n\n1. Open AntennaPod in Android Auto\r\n2. Play a podcast until it finishes\r\n3. Go back to the queue\n\n### Expected behaviour\n\nThe queue in Android Auto should not show the finished podcasts.\n\n### Current behaviour\n\nThe queue in still includes all the finished podcasts. There is no visual indication that a podcast has been already listened.\r\n\r\nA few months ago I could still force the UI update by clicking in \"Download\" tab, then goinb back to \"Queue\". But now, the only workaround is to start play in another AA app (like Spotify), then go back to AntennaPod.\r\nI'm not sure if what changed was Android Auto or Antennapod.\n\n### Logs\n\nNo crash, but I'll leave this here.\r\n\r\n## Environment\r\nAndroid version: 13\r\nOS version: 5.10.107-android13-4-00020-g02b5dfab573c-ab9358130\r\nAntennaPod version: 2.7.1\r\nModel: Pixel 6\r\nDevice: oriole\r\nProduct: oriole\r\n\r\nNo crash report recorded\n", "hints_text": "", "created_at": "2023-03-11T16:48:23Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6371, "instance_id": "AntennaPod__AntennaPod-6371", "issue_numbers": ["6205"], "base_commit": "95b97b6f49e96c659c2ef09a81c93b040a99f888", "patch": "diff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\nindex 825dea84ec..af76f4d9f9 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n@@ -1226,7 +1226,7 @@ public final Cursor getFeedStatisticsCursor(boolean includeMarkedAsPlayed, long\n                     + TABLE_NAME_FEED_MEDIA + \".\" + KEY_POSITION + \"> 0\";\n         }\n         final String timeFilter = lastPlayedTime + \">=\" + timeFilterFrom\n-                + \" AND \" + lastPlayedTime + \"<=\" + timeFilterTo;\n+                + \" AND \" + lastPlayedTime + \"<\" + timeFilterTo;\n         String playedTime = TABLE_NAME_FEED_MEDIA + \".\" + KEY_PLAYED_DURATION;\n         if (includeMarkedAsPlayed) {\n             playedTime = \"(CASE WHEN \" + playedTime + \" != 0\"\ndiff --git a/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/subscriptions/StatisticsFilterDialog.java b/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/subscriptions/StatisticsFilterDialog.java\nindex 8efdcf6036..077883321a 100644\n--- a/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/subscriptions/StatisticsFilterDialog.java\n+++ b/ui/statistics/src/main/java/de/danoeh/antennapod/ui/statistics/subscriptions/StatisticsFilterDialog.java\n@@ -107,6 +107,10 @@ public void show() {\n     private Pair<String[], Long[]> makeMonthlyList(long oldestDate, boolean inclusive) {\n         Calendar date = Calendar.getInstance();\n         date.setTimeInMillis(oldestDate);\n+        date.set(Calendar.HOUR_OF_DAY, 0);\n+        date.set(Calendar.MINUTE, 0);\n+        date.set(Calendar.SECOND, 0);\n+        date.set(Calendar.MILLISECOND, 0);\n         date.set(Calendar.DAY_OF_MONTH, 1);\n         ArrayList<String> names = new ArrayList<>();\n         ArrayList<Long> timestamps = new ArrayList<>();\n", "test_patch": "", "problem_statement": "Statistics shows different number of hours on Subscriptions tab and Years tab\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n2.7.1\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\nCalyxOS 4.3.0 (Android 13)\n\n### Device model\n\nFairphone 4\n\n### First occurred\n\nJust noticed it\n\n### Steps to reproduce\n\n1. Go to Statistics \r\n2. Filter to show only plays this year\r\n3. Look at the reported number of hours played between Jan 2022 and Dec 2022\r\n4. Go to the years tab and look at the reported number of hours played in 2022\n\n### Expected behaviour\n\nThe number should be the same\n\n### Current behaviour\n\nFor me on the Subscriptions tab it says I've played 1116.4 hours, while the Years tab says I've played 1121.0 hours this year. Playing something increases the number on both tabs.\r\n\r\nNot the biggest of deals, but would be nice if you have the time to look into this. Thanks for your great work!\n\n### Logs\n\n_No response_\n", "hints_text": "Have you enabled the option to count episodes that are just marked as played? That setting only applies to the subscriptions tab, not the years tab\nI did not check that box, no. And if that was enabled anyway by some bug, the number on the Subscriptions tab should be higher than on Years, not lower, right?\nIn my database, the numbers do match up. What did you select as the filter date range?\nAh, sorry. You already posted that. In case you still experience this, could you please send me your full database export via email? Then I can have a closer look. My address is `info@<my username>.com`. Note that the database export could contain sensitive information.\nThis issue will be closed when we don't get a reply within 15 days.", "created_at": "2023-03-08T20:08:32Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6365, "instance_id": "AntennaPod__AntennaPod-6365", "issue_numbers": ["6364"], "base_commit": "5e75c968ad146c6969db98d53be126c7bb74d5e3", "patch": "diff --git a/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastEnabledActivity.java b/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastEnabledActivity.java\nindex 83abd98b72..91ce3315c2 100644\n--- a/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastEnabledActivity.java\n+++ b/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastEnabledActivity.java\n@@ -20,7 +20,12 @@ protected void onCreate(Bundle savedInstanceState) {\n         super.onCreate(savedInstanceState);\n         canCast = GoogleApiAvailability.getInstance().isGooglePlayServicesAvailable(this) == ConnectionResult.SUCCESS;\n         if (canCast) {\n-            CastContext.getSharedInstance(this);\n+            try {\n+                CastContext.getSharedInstance(this);\n+            } catch (Exception e) {\n+                e.printStackTrace();\n+                canCast = false;\n+            }\n         }\n     }\n \n", "test_patch": "", "problem_statement": "Crash on HarmonyOS 3(base on android 12)\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.0.0-beta6\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\nHonor V30 Pro\n\n### First occurred\n\nabout 3 days ago\n\n### Steps to reproduce\n\n_No response_\n\n### Expected behaviour\n\n_No response_\n\n### Current behaviour\n\nUnable to start on the phone, when I click the icon ,it just crashes.\n\n### Logs\n\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: FATAL EXCEPTION: main\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: Process: de.danoeh.antennapod, PID: 18048\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: java.lang.RuntimeException: Unable to start activity ComponentInfo{de.danoeh.antennapod/de.danoeh.antennapod.activity.MainActivity}: java.lang.RuntimeException: com.google.android.gms.cast.framework.ModuleUnavailableException: com.google.android.gms.dynamite.DynamiteModule$LoadingException: Remote load failed. No local fallback found.\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat android.app.ActivityThread.performLaunchActivity(ActivityThread.java:4631)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:4842)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat android.app.servertransaction.LaunchActivityItem.execute(LaunchActivityItem.java:113)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat android.app.servertransaction.TransactionExecutor.executeCallbacks(TransactionExecutor.java:149)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat android.app.servertransaction.TransactionExecutor.execute(TransactionExecutor.java:103)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat android.app.ActivityThread$H.handleMessage(ActivityThread.java:2928)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat android.os.Handler.dispatchMessage(Handler.java:117)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat android.os.Looper.loopOnce(Looper.java:205)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat android.os.Looper.loop(Looper.java:293)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat android.app.ActivityThread.main(ActivityThread.java:9596)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat java.lang.reflect.Method.invoke(Native Method)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:586)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1204)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: Caused by: java.lang.RuntimeException: com.google.android.gms.cast.framework.ModuleUnavailableException: com.google.android.gms.dynamite.DynamiteModule$LoadingException: Remote load failed. No local fallback found.\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat com.google.android.gms.cast.framework.CastContext.getSharedInstance(SourceFile:11)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat de.danoeh.antennapod.playback.cast.CastEnabledActivity.onCreate(SourceFile:23)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat de.danoeh.antennapod.activity.MainActivity.onCreate(SourceFile:111)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat android.app.Activity.performCreate(Activity.java:8488)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat android.app.Activity.performCreate(Activity.java:8461)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1343)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat android.app.ActivityThread.performLaunchActivity(ActivityThread.java:4602)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \t... 12 more\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: Caused by: com.google.android.gms.cast.framework.ModuleUnavailableException: com.google.android.gms.dynamite.DynamiteModule$LoadingException: Remote load failed. No local fallback found.\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat com.google.android.gms.internal.cast.zzad.zzf(SourceFile:7)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat com.google.android.gms.internal.cast.zzad.zza(SourceFile:1)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat com.google.android.gms.cast.framework.CastContext.<init>(SourceFile:4)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat com.google.android.gms.cast.framework.CastContext.getSharedInstance(SourceFile:10)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \t... 18 more\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: Caused by: com.google.android.gms.dynamite.DynamiteModule$LoadingException: Remote load failed. No local fallback found.\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat com.google.android.gms.dynamite.DynamiteModule.load(SourceFile:58)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat com.google.android.gms.internal.cast.zzad.zzf(SourceFile:2)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \t... 21 more\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: Caused by: com.google.android.gms.dynamite.DynamiteModule$LoadingException: Failed to load remote module.\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \tat com.google.android.gms.dynamite.DynamiteModule.load(SourceFile:27)\r\n03-06 18:27:13.066 18048 18048 E AndroidRuntime: \t... 22 more\n", "hints_text": "", "created_at": "2023-03-06T20:01:28Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6358, "instance_id": "AntennaPod__AntennaPod-6358", "issue_numbers": ["6222"], "base_commit": "581e71b306bbc28dc504bde1d1bba6d6121e26e1", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/fragment/AllEpisodesFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/AllEpisodesFragment.java\nindex dfbaf96958..7061a69f32 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/AllEpisodesFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/AllEpisodesFragment.java\n@@ -61,15 +61,13 @@ private void inflateSortMenu() {\n     @NonNull\n     @Override\n     protected List<FeedItem> loadData() {\n-        return DBReader.getRecentlyPublishedEpisodes(0, page * EPISODES_PER_PAGE,\n-                getFilter(), getSortOrder());\n+        return DBReader.getEpisodes(0, page * EPISODES_PER_PAGE, getFilter(), getSortOrder());\n     }\n \n     @NonNull\n     @Override\n     protected List<FeedItem> loadMoreData(int page) {\n-        return DBReader.getRecentlyPublishedEpisodes((page - 1) * EPISODES_PER_PAGE,\n-                EPISODES_PER_PAGE, getFilter(), getSortOrder());\n+        return DBReader.getEpisodes((page - 1) * EPISODES_PER_PAGE, EPISODES_PER_PAGE, getFilter(), getSortOrder());\n     }\n \n     @Override\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/CompletedDownloadsFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/CompletedDownloadsFragment.java\nindex f615252bdf..dbc453301c 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/CompletedDownloadsFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/CompletedDownloadsFragment.java\n@@ -315,7 +315,8 @@ private void loadItems() {\n         emptyView.hide();\n         disposable = Observable.fromCallable(() -> {\n             SortOrder sortOrder = UserPreferences.getDownloadsSortedOrder();\n-            List<FeedItem> downloadedItems = DBReader.getDownloadedItems(sortOrder);\n+            List<FeedItem> downloadedItems = DBReader.getEpisodes(0, Integer.MAX_VALUE,\n+                        new FeedItemFilter(FeedItemFilter.DOWNLOADED), sortOrder);\n \n             List<Long> mediaIds = new ArrayList<>();\n             if (runningDownloads == null) {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/InboxFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/InboxFragment.java\nindex c04adee6d9..f8bcbb5322 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/InboxFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/InboxFragment.java\n@@ -97,14 +97,15 @@ public boolean onMenuItemClick(MenuItem item) {\n     @NonNull\n     @Override\n     protected List<FeedItem> loadData() {\n-        return DBReader.getNewItemsList(0, page * EPISODES_PER_PAGE, UserPreferences.getInboxSortedOrder());\n+        return DBReader.getEpisodes(0, page * EPISODES_PER_PAGE,\n+                new FeedItemFilter(FeedItemFilter.NEW),  UserPreferences.getInboxSortedOrder());\n     }\n \n     @NonNull\n     @Override\n     protected List<FeedItem> loadMoreData(int page) {\n-        return DBReader.getNewItemsList((page - 1) * EPISODES_PER_PAGE, EPISODES_PER_PAGE,\n-                UserPreferences.getInboxSortedOrder());\n+        return DBReader.getEpisodes((page - 1) * EPISODES_PER_PAGE, EPISODES_PER_PAGE,\n+                new FeedItemFilter(FeedItemFilter.NEW), UserPreferences.getInboxSortedOrder());\n     }\n \n     @Override\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/home/sections/DownloadsSection.java b/app/src/main/java/de/danoeh/antennapod/ui/home/sections/DownloadsSection.java\nindex 0053b0e829..1240546c45 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/home/sections/DownloadsSection.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/home/sections/DownloadsSection.java\n@@ -124,7 +124,8 @@ private void loadItems() {\n             disposable.dispose();\n         }\n         SortOrder sortOrder = UserPreferences.getDownloadsSortedOrder();\n-        disposable = Observable.fromCallable(() -> DBReader.getDownloadedItems(sortOrder))\n+        disposable = Observable.fromCallable(() -> DBReader.getEpisodes(0, Integer.MAX_VALUE,\n+                        new FeedItemFilter(FeedItemFilter.DOWNLOADED), sortOrder))\n                 .subscribeOn(Schedulers.io())\n                 .observeOn(AndroidSchedulers.mainThread())\n                 .subscribe(downloads -> {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/home/sections/InboxSection.java b/app/src/main/java/de/danoeh/antennapod/ui/home/sections/InboxSection.java\nindex 6baea05e68..8d343a16aa 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/home/sections/InboxSection.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/home/sections/InboxSection.java\n@@ -26,7 +26,6 @@\n import de.danoeh.antennapod.fragment.swipeactions.SwipeActions;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n-import de.danoeh.antennapod.storage.database.PodDBAdapter;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import de.danoeh.antennapod.ui.home.HomeSection;\n import io.reactivex.Observable;\n@@ -126,8 +125,9 @@ private void loadItems() {\n             disposable.dispose();\n         }\n         disposable = Observable.fromCallable(() ->\n-                        new Pair<>(DBReader.getNewItemsList(0, NUM_EPISODES, UserPreferences.getInboxSortedOrder()),\n-                                PodDBAdapter.getInstance().getNumberOfNewItems()))\n+                        new Pair<>(DBReader.getEpisodes(0, NUM_EPISODES,\n+                                new FeedItemFilter(FeedItemFilter.NEW), UserPreferences.getInboxSortedOrder()),\n+                                DBReader.getTotalEpisodeCount(new FeedItemFilter(FeedItemFilter.NEW))))\n                 .subscribeOn(Schedulers.io())\n                 .observeOn(AndroidSchedulers.mainThread())\n                 .subscribe(data -> {\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/export/favorites/FavoritesWriter.java b/core/src/main/java/de/danoeh/antennapod/core/export/favorites/FavoritesWriter.java\nindex 5ccfc93fed..649ec815aa 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/export/favorites/FavoritesWriter.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/export/favorites/FavoritesWriter.java\n@@ -43,7 +43,7 @@ public void writeDocument(List<Feed> feeds, Writer writer, Context context)\n         InputStream feedTemplateStream = context.getAssets().open(FEED_TEMPLATE);\n         String feedTemplate = IOUtils.toString(feedTemplateStream, UTF_8);\n \n-        List<FeedItem> allFavorites = DBReader.getRecentlyPublishedEpisodes(0, Integer.MAX_VALUE,\n+        List<FeedItem> allFavorites = DBReader.getEpisodes(0, Integer.MAX_VALUE,\n                 new FeedItemFilter(FeedItemFilter.IS_FAVORITE), SortOrder.DATE_NEW_OLD);\n         Map<Long, List<FeedItem>> favoriteByFeed = getFeedMap(allFavorites);\n \ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\nindex 62ddf969c0..053d852eb8 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n@@ -402,9 +402,9 @@ private List<MediaBrowserCompat.MediaItem> loadChildrenSynchronous(@NonNull Stri\n         List<MediaBrowserCompat.MediaItem> mediaItems = new ArrayList<>();\n         if (parentId.equals(getResources().getString(R.string.app_name))) {\n             mediaItems.add(createBrowsableMediaItem(R.string.queue_label, R.drawable.ic_playlist_play_black,\n-                    DBReader.getQueue().size()));\n+                    DBReader.getTotalEpisodeCount(new FeedItemFilter(FeedItemFilter.QUEUED))));\n             mediaItems.add(createBrowsableMediaItem(R.string.downloads_label, R.drawable.ic_download_black,\n-                    DBReader.getDownloadedItems(UserPreferences.getDownloadsSortedOrder()).size()));\n+                    DBReader.getTotalEpisodeCount(new FeedItemFilter(FeedItemFilter.DOWNLOADED))));\n             mediaItems.add(createBrowsableMediaItem(R.string.episodes_label, R.drawable.ic_feed_black,\n                     DBReader.getTotalEpisodeCount(new FeedItemFilter(FeedItemFilter.UNPLAYED))));\n             List<Feed> feeds = DBReader.getFeedList();\n@@ -418,10 +418,10 @@ private List<MediaBrowserCompat.MediaItem> loadChildrenSynchronous(@NonNull Stri\n         if (parentId.equals(getResources().getString(R.string.queue_label))) {\n             feedItems = DBReader.getQueue();\n         } else if (parentId.equals(getResources().getString(R.string.downloads_label))) {\n-            feedItems = DBReader.getDownloadedItems(UserPreferences.getDownloadsSortedOrder());\n+            feedItems = DBReader.getEpisodes(0, MAX_ANDROID_AUTO_EPISODES_PER_FEED,\n+                    new FeedItemFilter(FeedItemFilter.DOWNLOADED), UserPreferences.getDownloadsSortedOrder());\n         } else if (parentId.equals(getResources().getString(R.string.episodes_label))) {\n-            feedItems = DBReader.getRecentlyPublishedEpisodes(0,\n-                    MAX_ANDROID_AUTO_EPISODES_PER_FEED,\n+            feedItems = DBReader.getEpisodes(0, MAX_ANDROID_AUTO_EPISODES_PER_FEED,\n                     new FeedItemFilter(FeedItemFilter.UNPLAYED), SortOrder.DATE_NEW_OLD);\n         } else if (parentId.startsWith(\"FeedId:\")) {\n             long feedId = Long.parseLong(parentId.split(\":\")[1]);\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/storage/APCleanupAlgorithm.java b/core/src/main/java/de/danoeh/antennapod/core/storage/APCleanupAlgorithm.java\nindex 30c50b5760..1d2e3ffd25 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/storage/APCleanupAlgorithm.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/storage/APCleanupAlgorithm.java\n@@ -14,6 +14,7 @@\n import java.util.concurrent.ExecutionException;\n \n import de.danoeh.antennapod.model.feed.FeedItem;\n+import de.danoeh.antennapod.model.feed.FeedItemFilter;\n import de.danoeh.antennapod.model.feed.FeedMedia;\n import de.danoeh.antennapod.model.feed.SortOrder;\n \n@@ -89,7 +90,8 @@ Date calcMostRecentDateForDeletion(@NonNull Date currentDate) {\n     @NonNull\n     private List<FeedItem> getCandidates() {\n         List<FeedItem> candidates = new ArrayList<>();\n-        List<FeedItem> downloadedItems = DBReader.getDownloadedItems(SortOrder.DATE_NEW_OLD);\n+        List<FeedItem> downloadedItems = DBReader.getEpisodes(0, Integer.MAX_VALUE,\n+                new FeedItemFilter(FeedItemFilter.DOWNLOADED), SortOrder.DATE_NEW_OLD);\n \n         Date mostRecentDateForDeletion = calcMostRecentDateForDeletion(new Date());\n         for (FeedItem item : downloadedItems) {\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/storage/APQueueCleanupAlgorithm.java b/core/src/main/java/de/danoeh/antennapod/core/storage/APQueueCleanupAlgorithm.java\nindex 3241f37ef2..2bd840fd1f 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/storage/APQueueCleanupAlgorithm.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/storage/APQueueCleanupAlgorithm.java\n@@ -12,6 +12,7 @@\n import java.util.concurrent.ExecutionException;\n \n import de.danoeh.antennapod.model.feed.FeedItem;\n+import de.danoeh.antennapod.model.feed.FeedItemFilter;\n import de.danoeh.antennapod.model.feed.SortOrder;\n \n /**\n@@ -76,7 +77,8 @@ public int performCleanup(Context context, int numberOfEpisodesToDelete) {\n     @NonNull\n     private List<FeedItem> getCandidates() {\n         List<FeedItem> candidates = new ArrayList<>();\n-        List<FeedItem> downloadedItems = DBReader.getDownloadedItems(SortOrder.DATE_NEW_OLD);\n+        List<FeedItem> downloadedItems = DBReader.getEpisodes(0, Integer.MAX_VALUE,\n+                new FeedItemFilter(FeedItemFilter.DOWNLOADED), SortOrder.DATE_NEW_OLD);\n         for (FeedItem item : downloadedItems) {\n             if (item.hasMedia()\n                     && item.getMedia().isDownloaded()\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/storage/AutomaticDownloadAlgorithm.java b/core/src/main/java/de/danoeh/antennapod/core/storage/AutomaticDownloadAlgorithm.java\nindex c9f37fd009..0f31215517 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/storage/AutomaticDownloadAlgorithm.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/storage/AutomaticDownloadAlgorithm.java\n@@ -7,6 +7,7 @@\n import java.util.Iterator;\n import java.util.List;\n \n+import de.danoeh.antennapod.model.feed.FeedItemFilter;\n import de.danoeh.antennapod.model.feed.SortOrder;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n import de.danoeh.antennapod.core.service.download.DownloadRequestCreator;\n@@ -53,7 +54,8 @@ public Runnable autoDownloadUndownloadedItems(final Context context) {\n \n                 List<FeedItem> candidates;\n                 final List<FeedItem> queue = DBReader.getQueue();\n-                final List<FeedItem> newItems = DBReader.getNewItemsList(0, Integer.MAX_VALUE, SortOrder.DATE_NEW_OLD);\n+                final List<FeedItem> newItems = DBReader.getEpisodes(0, Integer.MAX_VALUE,\n+                        new FeedItemFilter(FeedItemFilter.NEW), SortOrder.DATE_NEW_OLD);\n                 candidates = new ArrayList<>(queue.size() + newItems.size());\n                 candidates.addAll(queue);\n                 for (FeedItem newItem : newItems) {\n@@ -77,7 +79,7 @@ public Runnable autoDownloadUndownloadedItems(final Context context) {\n                 }\n \n                 int autoDownloadableEpisodes = candidates.size();\n-                int downloadedEpisodes = DBReader.getNumberOfDownloadedEpisodes();\n+                int downloadedEpisodes = DBReader.getTotalEpisodeCount(new FeedItemFilter(FeedItemFilter.DOWNLOADED));\n                 int deletedEpisodes = EpisodeCleanupAlgorithmFactory.build()\n                         .makeRoomForEpisodes(context, autoDownloadableEpisodes);\n                 boolean cacheIsUnlimited =\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/storage/DBReader.java b/core/src/main/java/de/danoeh/antennapod/core/storage/DBReader.java\nindex b762843475..4a2c6148a5 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/storage/DBReader.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/storage/DBReader.java\n@@ -275,73 +275,6 @@ public static List<FeedItem> getQueue() {\n         }\n     }\n \n-    /**\n-     * Loads a list of FeedItems whose episode has been downloaded.\n-     *\n-     * @return A list of FeedItems whose episdoe has been downloaded.\n-     */\n-    @NonNull\n-    public static List<FeedItem> getDownloadedItems(@Nullable SortOrder sortOrder) {\n-        Log.d(TAG, \"getDownloadedItems() called\");\n-\n-        // Set a default sort order\n-        if (sortOrder == null) {\n-            sortOrder = SortOrder.DATE_NEW_OLD;\n-        }\n-\n-        PodDBAdapter adapter = PodDBAdapter.getInstance();\n-        adapter.open();\n-        try (Cursor cursor = adapter.getDownloadedItemsCursor(sortOrder)) {\n-            List<FeedItem> items = extractItemlistFromCursor(adapter, cursor);\n-            loadAdditionalFeedItemListData(items);\n-            return items;\n-        } finally {\n-            adapter.close();\n-        }\n-    }\n-\n-    /**\n-     * Loads a list of FeedItems whose episode has been played.\n-     *\n-     * @return A list of FeedItems whose episdoe has been played.\n-     */\n-    @NonNull\n-    public static List<FeedItem> getPlayedItems() {\n-        Log.d(TAG, \"getPlayedItems() called\");\n-\n-        PodDBAdapter adapter = PodDBAdapter.getInstance();\n-        adapter.open();\n-        try (Cursor cursor = adapter.getPlayedItemsCursor()) {\n-            List<FeedItem> items = extractItemlistFromCursor(adapter, cursor);\n-            loadAdditionalFeedItemListData(items);\n-            return items;\n-        } finally {\n-            adapter.close();\n-        }\n-    }\n-\n-    /**\n-     * Loads a list of FeedItems that are considered new.\n-     * Excludes items from feeds that do not have keep updated enabled.\n-     *\n-     * @param offset The first episode that should be loaded.\n-     * @param limit The maximum number of episodes that should be loaded.\n-     * @return A list of FeedItems that are considered new.\n-     */\n-    public static List<FeedItem> getNewItemsList(int offset, int limit, SortOrder sortOrder) {\n-        Log.d(TAG, \"getNewItemsList() called\");\n-\n-        PodDBAdapter adapter = PodDBAdapter.getInstance();\n-        adapter.open();\n-        try (Cursor cursor = adapter.getNewItemsCursor(offset, limit, sortOrder)) {\n-            List<FeedItem> items = extractItemlistFromCursor(adapter, cursor);\n-            loadAdditionalFeedItemListData(items);\n-            return items;\n-        } finally {\n-            adapter.close();\n-        }\n-    }\n-\n     private static LongList getFavoriteIDList() {\n         Log.d(TAG, \"getFavoriteIDList() called\");\n \n@@ -359,19 +292,17 @@ private static LongList getFavoriteIDList() {\n     }\n \n     /**\n-     * Loads a filtered list of FeedItems sorted by pubDate in descending order.\n      *\n      * @param offset The first episode that should be loaded.\n      * @param limit The maximum number of episodes that should be loaded.\n      * @param filter The filter describing which episodes to filter out.\n      */\n     @NonNull\n-    public static List<FeedItem> getRecentlyPublishedEpisodes(int offset, int limit,\n-                                                              FeedItemFilter filter, SortOrder sortOrder) {\n+    public static List<FeedItem> getEpisodes(int offset, int limit, FeedItemFilter filter, SortOrder sortOrder) {\n         Log.d(TAG, \"getRecentlyPublishedEpisodes() called with: offset=\" + offset + \", limit=\" + limit);\n         PodDBAdapter adapter = PodDBAdapter.getInstance();\n         adapter.open();\n-        try (Cursor cursor = adapter.getRecentlyPublishedItemsCursor(offset, limit, filter, sortOrder)) {\n+        try (Cursor cursor = adapter.getEpisodesCursor(offset, limit, filter, sortOrder)) {\n             List<FeedItem> items = extractItemlistFromCursor(adapter, cursor);\n             loadAdditionalFeedItemListData(items);\n             return items;\n@@ -380,26 +311,26 @@ public static List<FeedItem> getRecentlyPublishedEpisodes(int offset, int limit,\n         }\n     }\n \n-    public static List<FeedItem> getRandomEpisodes(int limit, int seed) {\n+    public static int getTotalEpisodeCount(FeedItemFilter filter) {\n         PodDBAdapter adapter = PodDBAdapter.getInstance();\n         adapter.open();\n-        try (Cursor cursor = adapter.getRandomEpisodesCursor(limit, seed)) {\n-            List<FeedItem> items = extractItemlistFromCursor(adapter, cursor);\n-            loadAdditionalFeedItemListData(items);\n-            return items;\n+        try (Cursor cursor = adapter.getEpisodeCountCursor(filter)) {\n+            if (cursor.moveToFirst()) {\n+                return cursor.getInt(0);\n+            }\n+            return -1;\n         } finally {\n             adapter.close();\n         }\n     }\n \n-    public static int getTotalEpisodeCount(FeedItemFilter filter) {\n+    public static List<FeedItem> getRandomEpisodes(int limit, int seed) {\n         PodDBAdapter adapter = PodDBAdapter.getInstance();\n         adapter.open();\n-        try (Cursor cursor = adapter.getTotalEpisodeCountCursor(filter)) {\n-            if (cursor.moveToFirst()) {\n-                return cursor.getInt(0);\n-            }\n-            return -1;\n+        try (Cursor cursor = adapter.getRandomEpisodesCursor(limit, seed)) {\n+            List<FeedItem> items = extractItemlistFromCursor(adapter, cursor);\n+            loadAdditionalFeedItemListData(items);\n+            return items;\n         } finally {\n             adapter.close();\n         }\n@@ -755,24 +686,6 @@ private static List<Chapter> loadChaptersOfFeedItem(PodDBAdapter adapter, FeedIt\n         }\n     }\n \n-    /**\n-     * Returns the number of downloaded episodes.\n-     *\n-     * @return The number of downloaded episodes.\n-     */\n-\n-    public static int getNumberOfDownloadedEpisodes() {\n-        Log.d(TAG, \"getNumberOfDownloadedEpisodes() called with: \" + \"\");\n-\n-        PodDBAdapter adapter = PodDBAdapter.getInstance();\n-        adapter.open();\n-        try {\n-            return adapter.getNumberOfDownloadedEpisodes();\n-        } finally {\n-            adapter.close();\n-        }\n-    }\n-\n     /**\n      * Searches the DB for a FeedMedia of the given id.\n      *\n@@ -959,9 +872,9 @@ public static NavDrawerData getNavDrawerData() {\n         }\n \n         Collections.sort(feeds, comparator);\n-        int queueSize = adapter.getQueueSize();\n-        int numNewItems = adapter.getNumberOfNewItems();\n-        int numDownloadedItems = adapter.getNumberOfDownloadedEpisodes();\n+        final int queueSize = adapter.getQueueSize();\n+        final int numNewItems = getTotalEpisodeCount(new FeedItemFilter(FeedItemFilter.NEW));\n+        final int numDownloadedItems = getTotalEpisodeCount(new FeedItemFilter(FeedItemFilter.DOWNLOADED));\n \n         List<NavDrawerData.DrawerItem> items = new ArrayList<>();\n         Map<String, NavDrawerData.TagDrawerItem> folders = new HashMap<>();\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/storage/EpisodeCleanupAlgorithm.java b/core/src/main/java/de/danoeh/antennapod/core/storage/EpisodeCleanupAlgorithm.java\nindex 84a0dd575a..e6d3b29175 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/storage/EpisodeCleanupAlgorithm.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/storage/EpisodeCleanupAlgorithm.java\n@@ -2,6 +2,7 @@\n \n import android.content.Context;\n \n+import de.danoeh.antennapod.model.feed.FeedItemFilter;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n \n public abstract class EpisodeCleanupAlgorithm {\n@@ -51,8 +52,7 @@ public int makeRoomForEpisodes(Context context, int amountOfRoomNeeded) {\n     int getNumEpisodesToCleanup(final int amountOfRoomNeeded) {\n         if (amountOfRoomNeeded >= 0\n                 && UserPreferences.getEpisodeCacheSize() != UserPreferences.EPISODE_CACHE_SIZE_UNLIMITED) {\n-            int downloadedEpisodes = DBReader\n-                    .getNumberOfDownloadedEpisodes();\n+            int downloadedEpisodes = DBReader.getTotalEpisodeCount(new FeedItemFilter(FeedItemFilter.DOWNLOADED));\n             if (downloadedEpisodes + amountOfRoomNeeded >= UserPreferences\n                     .getEpisodeCacheSize()) {\n \ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/storage/ExceptFavoriteCleanupAlgorithm.java b/core/src/main/java/de/danoeh/antennapod/core/storage/ExceptFavoriteCleanupAlgorithm.java\nindex 448cffeb94..da01a82f14 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/storage/ExceptFavoriteCleanupAlgorithm.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/storage/ExceptFavoriteCleanupAlgorithm.java\n@@ -13,6 +13,7 @@\n import java.util.concurrent.ExecutionException;\n \n import de.danoeh.antennapod.model.feed.FeedItem;\n+import de.danoeh.antennapod.model.feed.FeedItemFilter;\n import de.danoeh.antennapod.model.feed.SortOrder;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n \n@@ -75,7 +76,8 @@ public int performCleanup(Context context, int numberOfEpisodesToDelete) {\n     @NonNull\n     private List<FeedItem> getCandidates() {\n         List<FeedItem> candidates = new ArrayList<>();\n-        List<FeedItem> downloadedItems = DBReader.getDownloadedItems(SortOrder.DATE_NEW_OLD);\n+        List<FeedItem> downloadedItems = DBReader.getEpisodes(0, Integer.MAX_VALUE,\n+                new FeedItemFilter(FeedItemFilter.DOWNLOADED), SortOrder.DATE_NEW_OLD);\n         for (FeedItem item : downloadedItems) {\n             if (item.hasMedia()\n                     && item.getMedia().isDownloaded()\n@@ -90,7 +92,7 @@ private List<FeedItem> getCandidates() {\n     public int getDefaultCleanupParameter() {\n         int cacheSize = UserPreferences.getEpisodeCacheSize();\n         if (cacheSize != UserPreferences.EPISODE_CACHE_SIZE_UNLIMITED) {\n-            int downloadedEpisodes = DBReader.getNumberOfDownloadedEpisodes();\n+            int downloadedEpisodes = DBReader.getTotalEpisodeCount(new FeedItemFilter(FeedItemFilter.DOWNLOADED));\n             if (downloadedEpisodes > cacheSize) {\n                 return downloadedEpisodes - cacheSize;\n             }\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/sync/SyncService.java b/core/src/main/java/de/danoeh/antennapod/core/sync/SyncService.java\nindex 6e2658c1ca..73f4671544 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/sync/SyncService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/sync/SyncService.java\n@@ -20,6 +20,8 @@\n import androidx.work.Worker;\n import androidx.work.WorkerParameters;\n \n+import de.danoeh.antennapod.model.feed.FeedItemFilter;\n+import de.danoeh.antennapod.model.feed.SortOrder;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n import de.danoeh.antennapod.core.service.download.DownloadService;\n import de.danoeh.antennapod.core.service.download.DownloadRequestCreator;\n@@ -213,7 +215,8 @@ private void syncEpisodeActions(ISyncService syncServiceImpl) throws SyncService\n         List<EpisodeAction> queuedEpisodeActions = synchronizationQueueStorage.getQueuedEpisodeActions();\n         if (lastSync == 0) {\n             EventBus.getDefault().postSticky(new SyncServiceEvent(R.string.sync_status_upload_played));\n-            List<FeedItem> readItems = DBReader.getPlayedItems();\n+            List<FeedItem> readItems = DBReader.getEpisodes(0, Integer.MAX_VALUE,\n+                    new FeedItemFilter(FeedItemFilter.PLAYED), SortOrder.DATE_NEW_OLD);\n             Log.d(TAG, \"First sync. Upload state for all \" + readItems.size() + \" played episodes\");\n             for (FeedItem item : readItems) {\n                 FeedMedia media = item.getMedia();\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\nindex 825dea84ec..c870e35de3 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n@@ -45,8 +45,6 @@\n import static de.danoeh.antennapod.model.feed.FeedPreferences.SPEED_USE_GLOBAL;\n import static de.danoeh.antennapod.model.feed.SortOrder.toCodeString;\n \n-import de.danoeh.antennapod.storage.database.mapper.FeedItemSortQuery;\n-\n /**\n  * Implements methods for accessing the database\n  */\n@@ -1049,24 +1047,7 @@ public void setFeedItems(int oldState, int newState, long feedId) {\n         db.execSQL(sql);\n     }\n \n-    /**\n-     * Returns a cursor which contains all feed items that are considered new.\n-     * Excludes those feeds that do not have 'Keep Updated' enabled.\n-     * The returned cursor uses the FEEDITEM_SEL_FI_SMALL selection.\n-     */\n-    public final Cursor getNewItemsCursor(int offset, int limit, SortOrder sortOrder) {\n-        String sortQuery = FeedItemSortQuery.generateFrom(sortOrder);\n-        final String query = SELECT_FEED_ITEMS_AND_MEDIA\n-                + \" INNER JOIN \" + TABLE_NAME_FEEDS\n-                + \" ON \" + TABLE_NAME_FEED_ITEMS + \".\" + KEY_FEED + \"=\" + TABLE_NAME_FEEDS + \".\" + KEY_ID\n-                + \" WHERE \" + TABLE_NAME_FEED_ITEMS + \".\" + KEY_READ + \"=\" + FeedItem.NEW\n-                    + \" AND \" + TABLE_NAME_FEEDS + \".\" + KEY_KEEP_UPDATED + \" > 0\"\n-                + \" ORDER BY \" + sortQuery + \" LIMIT \" + offset + \", \" + limit;\n-        return db.rawQuery(query, null);\n-    }\n-\n-    public final Cursor getRecentlyPublishedItemsCursor(int offset, int limit,\n-                                                        FeedItemFilter filter, SortOrder sortOrder) {\n+    public final Cursor getEpisodesCursor(int offset, int limit, FeedItemFilter filter, SortOrder sortOrder) {\n         String orderByQuery = FeedItemSortQuery.generateFrom(sortOrder);\n         String filterQuery = FeedItemFilterQuery.generateFrom(filter);\n         String whereClause = \"\".equals(filterQuery) ? \"\" : \" WHERE \" + filterQuery;\n@@ -1075,6 +1056,14 @@ public final Cursor getRecentlyPublishedItemsCursor(int offset, int limit,\n         return db.rawQuery(query, null);\n     }\n \n+    public final Cursor getEpisodeCountCursor(FeedItemFilter filter) {\n+        String filterQuery = FeedItemFilterQuery.generateFrom(filter);\n+        String whereClause = \"\".equals(filterQuery) ? \"\" : \" WHERE \" + filterQuery;\n+        final String query = \"SELECT count(\" + TABLE_NAME_FEED_ITEMS + \".\" + KEY_ID + \") FROM \" + TABLE_NAME_FEED_ITEMS\n+                + JOIN_FEED_ITEM_AND_MEDIA + whereClause;\n+        return db.rawQuery(query, null);\n+    }\n+\n     public Cursor getRandomEpisodesCursor(int limit, int seed) {\n         final String allItemsRandomOrder = SELECT_FEED_ITEMS_AND_MEDIA\n                 + \" WHERE (\" + KEY_READ + \" = \" + FeedItem.NEW + \" OR \" + KEY_READ + \" = \" + FeedItem.UNPLAYED + \") \"\n@@ -1097,28 +1086,6 @@ private String randomEpisodeNumber(int seed) {\n         return \"((\" + SELECT_KEY_ITEM_ID + \" * \" + seed + \") % 46471)\";\n     }\n \n-    public final Cursor getTotalEpisodeCountCursor(FeedItemFilter filter) {\n-        String filterQuery = FeedItemFilterQuery.generateFrom(filter);\n-        String whereClause = \"\".equals(filterQuery) ? \"\" : \" WHERE \" + filterQuery;\n-        final String query = \"SELECT count(\" + TABLE_NAME_FEED_ITEMS + \".\" + KEY_ID + \") FROM \" + TABLE_NAME_FEED_ITEMS\n-                + JOIN_FEED_ITEM_AND_MEDIA + whereClause;\n-        return db.rawQuery(query, null);\n-    }\n-\n-    public Cursor getDownloadedItemsCursor(SortOrder sortOrder) {\n-        String sortQuery = FeedItemSortQuery.generateFrom(sortOrder);\n-        final String query = SELECT_FEED_ITEMS_AND_MEDIA\n-                + \" WHERE \" + TABLE_NAME_FEED_MEDIA + \".\" + KEY_DOWNLOADED + \" > 0\"\n-                + \" ORDER BY \" + sortQuery;\n-        return db.rawQuery(query, null);\n-    }\n-\n-    public Cursor getPlayedItemsCursor() {\n-        final String query = SELECT_FEED_ITEMS_AND_MEDIA\n-                + \"WHERE \" + TABLE_NAME_FEED_ITEMS + \".\" + KEY_READ + \"=\" + FeedItem.PLAYED;\n-        return db.rawQuery(query, null);\n-    }\n-\n     /**\n      * Returns a cursor which contains feed media objects with a playback\n      * completion date in ascending order.\n@@ -1267,25 +1234,6 @@ public int getQueueSize() {\n         return result;\n     }\n \n-    public final int getNumberOfNewItems() {\n-        Object[] args = new String[]{\n-                TABLE_NAME_FEED_ITEMS + \".\" + KEY_ID,\n-                TABLE_NAME_FEED_ITEMS,\n-                TABLE_NAME_FEEDS,\n-                TABLE_NAME_FEED_ITEMS + \".\" + KEY_FEED + \"=\" + TABLE_NAME_FEEDS + \".\" + KEY_ID,\n-                TABLE_NAME_FEED_ITEMS + \".\" + KEY_READ + \"=\" + FeedItem.NEW\n-                        + \" AND \" + TABLE_NAME_FEEDS + \".\" + KEY_KEEP_UPDATED + \" > 0\"\n-        };\n-        final String query = String.format(\"SELECT COUNT(%s) FROM %s INNER JOIN %s ON %s WHERE %s\", args);\n-        Cursor c = db.rawQuery(query, null);\n-        int result = 0;\n-        if (c.moveToFirst()) {\n-            result = c.getInt(0);\n-        }\n-        c.close();\n-        return result;\n-    }\n-\n     public final Map<Long, Integer> getFeedCounters(FeedCounter setting, long... feedIds) {\n         String whereRead;\n         switch (setting) {\n@@ -1371,19 +1319,6 @@ public final Map<Long, Long> getMostRecentItemDates() {\n         return result;\n     }\n \n-    public final int getNumberOfDownloadedEpisodes() {\n-        final String query = \"SELECT COUNT(DISTINCT \" + KEY_ID + \") AS count FROM \" + TABLE_NAME_FEED_MEDIA +\n-                \" WHERE \" + KEY_DOWNLOADED + \" > 0\";\n-\n-        Cursor c = db.rawQuery(query, null);\n-        int result = 0;\n-        if (c.moveToFirst()) {\n-            result = c.getInt(0);\n-        }\n-        c.close();\n-        return result;\n-    }\n-\n     /**\n      * Uses DatabaseUtils to escape a search query and removes ' at the\n      * beginning and the end of the string returned by the escape method.\n", "test_patch": "diff --git a/app/src/androidTest/java/de/test/antennapod/playback/PlaybackTest.java b/app/src/androidTest/java/de/test/antennapod/playback/PlaybackTest.java\nindex 735cff532e..16605d2023 100644\n--- a/app/src/androidTest/java/de/test/antennapod/playback/PlaybackTest.java\n+++ b/app/src/androidTest/java/de/test/antennapod/playback/PlaybackTest.java\n@@ -235,7 +235,7 @@ protected void startLocalPlayback() {\n         openNavDrawer();\n         onDrawerItem(withText(R.string.episodes_label)).perform(click());\n \n-        final List<FeedItem> episodes = DBReader.getRecentlyPublishedEpisodes(0, 10,\n+        final List<FeedItem> episodes = DBReader.getEpisodes(0, 10,\n                 FeedItemFilter.unfiltered(), SortOrder.DATE_NEW_OLD);\n         Matcher<View> allEpisodesMatcher = allOf(withId(R.id.recyclerView), isDisplayed(), hasMinimumChildCount(2));\n         onView(isRoot()).perform(waitForView(allEpisodesMatcher, 1000));\n@@ -271,7 +271,7 @@ protected void replayEpisodeCheck(boolean followQueue) throws Exception {\n         uiTestUtils.addLocalFeedData(true);\n         DBWriter.clearQueue().get();\n         activityTestRule.launchActivity(new Intent());\n-        final List<FeedItem> episodes = DBReader.getRecentlyPublishedEpisodes(0, 10,\n+        final List<FeedItem> episodes = DBReader.getEpisodes(0, 10,\n                 FeedItemFilter.unfiltered(), SortOrder.DATE_NEW_OLD);\n \n         startLocalPlayback();\ndiff --git a/core/src/test/java/de/danoeh/antennapod/core/storage/DbReaderTest.java b/core/src/test/java/de/danoeh/antennapod/core/storage/DbReaderTest.java\nindex 886c6821bc..3fadf7528b 100644\n--- a/core/src/test/java/de/danoeh/antennapod/core/storage/DbReaderTest.java\n+++ b/core/src/test/java/de/danoeh/antennapod/core/storage/DbReaderTest.java\n@@ -13,6 +13,7 @@\n \n import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.model.feed.FeedItem;\n+import de.danoeh.antennapod.model.feed.FeedItemFilter;\n import de.danoeh.antennapod.model.feed.FeedMedia;\n import de.danoeh.antennapod.model.feed.SortOrder;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n@@ -239,7 +240,8 @@ private List<FeedItem> saveDownloadedItems(int numItems) {\n         public void testGetDownloadedItems() {\n             final int numItems = 10;\n             List<FeedItem> downloaded = saveDownloadedItems(numItems);\n-            List<FeedItem> downloadedSaved = DBReader.getDownloadedItems(null);\n+            List<FeedItem> downloadedSaved = DBReader.getEpisodes(0, Integer.MAX_VALUE,\n+                    new FeedItemFilter(FeedItemFilter.DOWNLOADED), SortOrder.DATE_NEW_OLD);\n             assertNotNull(downloadedSaved);\n             assertEquals(downloaded.size(), downloadedSaved.size());\n             for (FeedItem item : downloadedSaved) {\n@@ -283,7 +285,8 @@ public void testGetNewItemIds() {\n             for (int i = 0; i < newItems.size(); i++) {\n                 unreadIds[i] = newItems.get(i).getId();\n             }\n-            List<FeedItem> newItemsSaved = DBReader.getNewItemsList(0, Integer.MAX_VALUE, SortOrder.DATE_NEW_OLD);\n+            List<FeedItem> newItemsSaved = DBReader.getEpisodes(0, Integer.MAX_VALUE,\n+                    new FeedItemFilter(FeedItemFilter.NEW), SortOrder.DATE_NEW_OLD);\n             assertNotNull(newItemsSaved);\n             assertEquals(newItemsSaved.size(), newItems.size());\n             for (FeedItem feedItem : newItemsSaved) {\n", "problem_statement": "Not keeping updated removes past episodes from Inbox\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.0 alpha\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n11\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Have a podcast with episodes in the Inbox\r\n2. Open this podcast's settings\r\n3. Deactivate 'Keep updated'\n\n### Expected behaviour\n\nEpisodes already in the Inbox stay there.\n\n### Current behaviour\n\nEpisodes already in the Inbox are removed from it.\n\n### Logs\n\n_No response_\n", "hints_text": "That was added because of #286. Keeping those episodes in the inbox would be a regression for that use case\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/monthly-community-call/1869/33\n", "created_at": "2023-02-28T21:17:04Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6353, "instance_id": "AntennaPod__AntennaPod-6353", "issue_numbers": ["6351"], "base_commit": "34553475d9a28f7eba1b0570370ab3370ce87fc0", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceNotification.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceNotification.java\nindex 6ba8348d65..b9846c06c0 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceNotification.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceNotification.java\n@@ -39,9 +39,8 @@ private void setupNotificationBuilders() {\n                 .setOnlyAlertOnce(true)\n                 .setShowWhen(false)\n                 .setContentIntent(getNotificationContentIntent(context))\n-                .setSmallIcon(R.drawable.ic_notification_sync);\n-        notificationCompatBuilder.setVisibility(NotificationCompat.VISIBILITY_PUBLIC);\n-\n+                .setSmallIcon(R.drawable.ic_notification_sync)\n+                .setVisibility(NotificationCompat.VISIBILITY_PUBLIC);\n         Log.d(TAG, \"Notification set up\");\n     }\n \n@@ -62,12 +61,27 @@ public Notification updateNotifications(List<Downloader> downloads) {\n         } else {\n             contentTitle = context.getString(R.string.download_notification_title);\n         }\n-        String contentText = (downloads.size() > 0)\n-                ? context.getResources().getQuantityString(R.plurals.downloads_left, downloads.size(), downloads.size())\n-                : context.getString(R.string.completing);\n-        String bigText = compileNotificationString(downloads);\n-        if (!bigText.contains(\"\\n\")) {\n-            contentText = bigText;\n+\n+        int numDownloads = getNumberOfRunningDownloads(downloads);\n+        String contentText = context.getString(R.string.completing);\n+        String bigText = context.getString(R.string.completing);\n+        notificationCompatBuilder.clearActions();\n+        if (numDownloads > 0) {\n+            bigText = compileNotificationString(downloads);\n+            if (numDownloads == 1) {\n+                contentText = bigText;\n+            } else {\n+                contentText = context.getResources().getQuantityString(R.plurals.downloads_left,\n+                        numDownloads, numDownloads);\n+            }\n+\n+            Intent cancelDownloadsIntent = new Intent(DownloadService.ACTION_CANCEL_ALL_DOWNLOADS);\n+            cancelDownloadsIntent.setPackage(context.getPackageName());\n+            PendingIntent cancelPendingIntent = PendingIntent.getBroadcast(context,\n+                    R.id.pending_intent_download_cancel_all, cancelDownloadsIntent, PendingIntent.FLAG_UPDATE_CURRENT\n+                            | (Build.VERSION.SDK_INT >= 23 ? PendingIntent.FLAG_IMMUTABLE : 0));\n+            notificationCompatBuilder.addAction(new NotificationCompat.Action(\n+                    R.drawable.ic_notification_cancel, context.getString(R.string.cancel_label), cancelPendingIntent));\n         }\n \n         notificationCompatBuilder.setContentTitle(contentTitle);\n@@ -76,6 +90,16 @@ public Notification updateNotifications(List<Downloader> downloads) {\n         return notificationCompatBuilder.build();\n     }\n \n+    private int getNumberOfRunningDownloads(List<Downloader> downloads) {\n+        int running = 0;\n+        for (Downloader downloader : downloads) {\n+            if (!downloader.cancelled && !downloader.isFinished()) {\n+                running++;\n+            }\n+        }\n+        return running;\n+    }\n+\n     private boolean typeIsOnly(List<Downloader> downloads, int feedFileType) {\n         for (Downloader downloader : downloads) {\n             if (downloader.cancelled) {\ndiff --git a/ui/app-start-intent/src/main/res/values/pending_intent.xml b/ui/app-start-intent/src/main/res/values/pending_intent.xml\nindex c0864046cd..30b35d9266 100644\n--- a/ui/app-start-intent/src/main/res/values/pending_intent.xml\n+++ b/ui/app-start-intent/src/main/res/values/pending_intent.xml\n@@ -2,6 +2,7 @@\n <resources>\n     <item name=\"pending_intent_download_service_notification\" type=\"id\"/>\n     <item name=\"pending_intent_download_service_retry\" type=\"id\"/>\n+    <item name=\"pending_intent_download_cancel_all\" type=\"id\"/>\n     <item name=\"pending_intent_download_service_auth\" type=\"id\"/>\n     <item name=\"pending_intent_download_service_report\" type=\"id\"/>\n     <item name=\"pending_intent_download_service_autodownload_report\" type=\"id\"/>\ndiff --git a/ui/png-icons/src/main/res/drawable/ic_notification_cancel.xml b/ui/png-icons/src/main/res/drawable/ic_notification_cancel.xml\nnew file mode 100644\nindex 0000000000..a5480c71f9\n--- /dev/null\n+++ b/ui/png-icons/src/main/res/drawable/ic_notification_cancel.xml\n@@ -0,0 +1,5 @@\n+<vector android:height=\"24dp\"\n+    android:viewportHeight=\"24.0\" android:viewportWidth=\"24.0\"\n+    android:width=\"24dp\" xmlns:android=\"http://schemas.android.com/apk/res/android\">\n+    <path android:fillColor=\"#FFFFFFFF\" android:pathData=\"M12,2C6.47,2 2,6.47 2,12s4.47,10 10,10 10,-4.47 10,-10S17.53,2 12,2zM17,15.59L15.59,17 12,13.41 8.41,17 7,15.59 10.59,12 7,8.41 8.41,7 12,10.59 15.59,7 17,8.41 13.41,12 17,15.59z\"/>\n+</vector>\n", "test_patch": "", "problem_statement": "Some sort of cancel or reset refresh function\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n2.7.1\n\n### Where did you get the app from\n\nF-Droid\n\n### Problem you may be having, or feature you want\n\nI would like some way to cancel or reset the refresh process in AntennaPod. This would come handy in two typical scenarios:\r\n\r\n1. Whenever the refresh process is triggered by mistake.\r\n2. AntennaPod can get stuck while refreshing podcasts. This may happen because of a problem with a specific podcast (some kind of malformed feed, I presume?), but also seemingly at random.\r\n\r\nIn the latter case, I see AntennaPod get stuck somewhat regularly while refreshing a local folder, with the same folder being refreshed OK after Force Stopping and restarting AP, and despite no changes to the folder itself.\r\n\r\nWhenever AP gets stuck on refreshing, it will no longer be possible to refresh one or all podcasts, so that breaks the periodic automatic refresh, too, until the user either restarts the device or the app.\r\n\r\nGetting stuck might also be having ill effects on power usage, too, like possibly preventing the phone from entering deep sleep (mostly unverified, though, ATM only a hypothesis based on some high screen off power consumption figures I've noticed recently)\n\n### Suggested solution\n\nWhen showing the 'Refreshing podcasts' notification, there could be a 'Cancel' text button to interrupt the stuck operation.\r\n\r\nAssuming there is a way to tell whether there is an outstanding refresh operation which is stuck, it would also be very convenient if starting a new refresh operation would cancel or reset the previous refresh; this would address the issue with automatic refreshes getting blocked.\n\n### Screenshots / Drawings / Technical details\n\nThere appears to be a number of issues that are similar to this one but the ones I've seen treat the issue as a bug, whereas this feature suggestion pertains an improvement that could handle scenarios not caused by AntennaPod itself.\n", "hints_text": "Normally, the feed refresh process should finish even if there are issues. At least that's how it works with true feeds. If that's not (always) the case with local folders, I think we should investigate the root problem and identity a solution or workaround (e.g. notice in the background that the process hung and restart automatically).\n\nSo, that issue, you mention it happens somewhat regularly; can you quantify that? Does it happen with a specific folder (if you have multiple ones)? Is it on an SD-card or the direct phone memory?\n\n> There appears to be a number of issues that are similar to this one but the ones I've seen treat the issue as a bug\n\nIf you can, it'd be helpful to mention them.", "created_at": "2023-02-25T10:24:04Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6350, "instance_id": "AntennaPod__AntennaPod-6350", "issue_numbers": ["6049", "4448"], "base_commit": "2833812238c19d16d464c337adeecc575ff484ba", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\nindex 434aa77e79..4f352aa151 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n@@ -316,9 +316,14 @@ public void onDestroy() {\n     public BrowserRoot onGetRoot(@NonNull String clientPackageName, int clientUid, Bundle rootHints) {\n         Log.d(TAG, \"OnGetRoot: clientPackageName=\" + clientPackageName +\n                 \"; clientUid=\" + clientUid + \" ; rootHints=\" + rootHints);\n-        return new BrowserRoot(\n-                getResources().getString(R.string.app_name), // Name visible in Android Auto\n-                null); // Bundle of optional extras\n+        if (rootHints != null && rootHints.getBoolean(BrowserRoot.EXTRA_RECENT)) {\n+            Bundle extras = new Bundle();\n+            extras.putBoolean(BrowserRoot.EXTRA_RECENT, true);\n+            return new BrowserRoot(getResources().getString(R.string.recently_played_episodes), extras);\n+        }\n+\n+        // Name visible in Android Auto\n+        return new BrowserRoot(getResources().getString(R.string.app_name), null);\n     }\n \n     private void loadQueueForMediaSession() {\n@@ -392,8 +397,7 @@ public void onLoadChildren(@NonNull String parentId,\n                     });\n     }\n \n-    private List<MediaBrowserCompat.MediaItem> loadChildrenSynchronous(@NonNull String parentId)\n-            throws InterruptedException {\n+    private List<MediaBrowserCompat.MediaItem> loadChildrenSynchronous(@NonNull String parentId) {\n         List<MediaBrowserCompat.MediaItem> mediaItems = new ArrayList<>();\n         if (parentId.equals(getResources().getString(R.string.app_name))) {\n             mediaItems.add(createBrowsableMediaItem(R.string.queue_label, R.drawable.ic_playlist_play_black,\n@@ -421,6 +425,13 @@ private List<MediaBrowserCompat.MediaItem> loadChildrenSynchronous(@NonNull Stri\n         } else if (parentId.startsWith(\"FeedId:\")) {\n             long feedId = Long.parseLong(parentId.split(\":\")[1]);\n             feedItems = DBReader.getFeedItemList(DBReader.getFeed(feedId));\n+        } else if (parentId.equals(getString(R.string.recently_played_episodes))) {\n+            Playable playable = PlaybackPreferences.createInstanceFromPreferences(this);\n+            if (playable instanceof FeedMedia) {\n+                feedItems = Collections.singletonList(((FeedMedia) playable).getItem());\n+            } else {\n+                return null;\n+            }\n         } else {\n             Log.e(TAG, \"Parent ID not found: \" + parentId);\n             return null;\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 184ceeabde..4943f5a1e0 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -26,6 +26,7 @@\n     <string name=\"episode_cache_full_message\">The episode cache limit has been reached. You can increase the cache size in the Settings.</string>\n     <string name=\"years_statistics_label\">Years</string>\n     <string name=\"notification_pref_fragment\">Notifications</string>\n+    <string name=\"recently_played_episodes\">Recently played episodes</string>\n \n     <!-- Google Assistant -->\n     <string name=\"app_action_not_found\">\\\"%1$s\\\" not found</string>\n", "test_patch": "", "problem_statement": "Player in the notification shade disappears if interacted with while app is in background\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n2.6.2 (9e87cf611)\n\n### Where did you get the app from\n\nF-Droid\n\n### Android version\n\n13\n\n### Device model\n\nGoogle Pixel 6a\n\n### First occurred\n\nwhen moving to android 13 I THINK\n\n### Steps to reproduce\n\n1. Go to home screen.\r\n2. Open notification tray\r\n3. Press \"Play\"\r\n\n\n### Expected behaviour\n\nMini player should always exist in the notification shade when podcast is playing. \n\n### Current behaviour\n\nMini player disappears after pressing play. See video below:\r\n\r\nhttps://photos.app.goo.gl/wWdYxQtyrVaZAd2p6\n\n### Logs\n\n_No response_\nMedia controls disappear / missing buttons\n# Checklist\r\n<!-- Place an x in the boxes to tick them: [x] -->\r\n\r\n- [x] I have used the search function to see if someone else has already submitted the same bug report.\r\n- [x] I will describe the problem with as much detail as possible.\r\n- [ ] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n# System info\r\n<!-- The following information is very important to fill out because some bugs may only occur on certain devices or versions of Android. -->\r\n\r\n**App version**: 1.8.1 (6e6a64f50) from Google Play Store\r\n\r\n**Android version**: 11 (RP1A.200720.009)\r\n\r\n**Device model**: Google Pixel 3a\r\n\r\n# Bug description\r\nSince I updated to Android 11 the lock screen controls disappear sometimes and won't reappear until I force shut the app and start it again.\r\n\r\n(Also the tray icon disappeared but I am not sure if this is maybe intended behavior, because the podcast control moved to another place).  \r\n\r\n\r\n**Steps to reproduce**:\r\nPlay podcasts on Android 11.\r\n\r\nMay be it is also relevant to mention that most of the time my android is in `Do Not Disturb` mode, but disabling it did not change anything for me.\r\n\r\n**Expected behaviour**:\r\nAlways show lock screen display and controls\r\n\r\n**Current behaviour**:\r\n<!-- What did AntennaPod do instead? Screenshots might help. Usually, you can take a screenshot of your smartphone by pressing *Power* + *Volume down* for a few seconds. -->\r\nLock screen controls disappear after some time \r\n\r\n**First occurred**: After update to Android 11\r\n```\r\n\n", "hints_text": "I've been noticing this too. It definitely started after upgrading to Android 13. In my case, once the notification removes the ability to scrub (in other words, it looks the same as when it's normally paused, except that it doesn't have the little dot on the seekbar that tells you where you currently are in the audio), pressing the play button removes the notification entirely.\r\n\r\nI could also see this being the same thing as [this topic](https://forum.antennapod.org/t/android-13-update-causing-issues-with-lock-screen-and-menu-miniplayer/2330) on the forums.\n@awbooze on rare occasions, pressing play would cause the notification to disappear and then reappear with the scrubber maybe half a second later. But most of the time it just disappears and does not return\r\n\r\nIt seems to be better since the latest Android 13 update. However, before that, I was experimenting with the battery settings for the app. When \"restricted\" from background use, the notification will lose the scrubber if playing is paused and then you close the app. If unrestricted, it seems that the scrubber never disappears, although after some time the notification will disappear but still be available in the 2nd pulldown of the notification/control center. If optimized, then the scrubber will disappear after some idle time\r\n\r\nThere may be more to it than that, but this has been my observation so far\ngetting this often since A13. here is a log, issue occured at 08:50, pressing play from the notification, playback resumed but notification dissappeared. i think the same can happen if podcast is playing, and you press pause, notification disappears.\r\n[full-logs.txt](https://github.com/AntennaPod/AntennaPod/files/9605303/full-logs.txt)\r\n\r\nalso have another issue relating to notifications, which I dont think is new to A13, where occasionally, the notification appears to \"stale\" in that it is showing an episode which i finished listening to previously, and not the most recently paused item, so pressing play results in resuming a completed podcast at some random mid-point, instead of resuming the one you were last listening to. Will try and get a log for that one and raise a new issue\r\n\nI have the same issue, but not only in the notification tray, but also on the lock screen. I'm guessing it's the same bug, but wanted to mention it just in case that's important for you to know. Thanks!\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/play-controls-disappear-on-pixel-7-pro-android-13/2597/5\n\nI have been facing this issue since upgrading to Android 13. I recently captured a bunch of logs via ADB, how much of which is relevant I don't know. This was done with simply `adb logcat` and then reproducing it; i don't know what in here is relevant but I see a lot of things in there that look suspicious, in particular the stack trace in \"no vorbis identification header found\" (which another issue mentions is not relevant and may be removed) and the CCodecConfig saying state is corrupted, but I don't know if that has anything to do with the notification in the shade; i'm just attaching an excerpt from my logs in case it's helpful. I can attach more if needed. Just hoping to help figure this out.\r\n\r\n```\r\n12-26 21:53:20.144 11989 11989 D PlaybackService: startForegroundIfPlaying: PLAYING\r\n12-26 21:53:20.144 11989 29420 D CCodec  : [c2.android.mp3.decoder] buffers are bound to CCodec for this session\r\n12-26 21:53:20.144 11989 29420 D CCodecConfig: no c2 equivalents for flags\r\n12-26 21:53:20.149 11989 29420 D CCodecConfig: config failed => CORRUPTED\r\n12-26 21:53:20.149 11989 29420 W Codec2Client: query -- param skipped: index = 1107298332.\r\n12-26 21:53:20.149 11989 29420 D CCodec  : client requested max input size 4096, which is smaller than what component recommended (8192); overriding with comp>\r\n12-26 21:53:20.149 11989 29420 W CCodec  : This behavior is subject to change. It is recommended that app developers double check whether the requested max in>\r\n12-26 21:53:20.149 11989 29420 D CCodec  : encoding statistics level = 0\r\n12-26 21:53:20.149 11989 29420 D CCodec  : setup formats input: AMessage(what = 0x00000000) = {\r\n12-26 21:53:20.149 11989 29420 D CCodec  :   int32_t bitrate = 64000\r\n12-26 21:53:20.149 11989 29420 D CCodec  :   int32_t channel-count = 2\r\n12-26 21:53:20.149 11989 29420 D CCodec  :   int32_t max-input-size = 8192\r\n12-26 21:53:20.149 11989 29420 D CCodec  :   string mime = \"audio/mpeg\"\r\n12-26 21:53:20.149 11989 29420 D CCodec  :   int32_t sample-rate = 44100\r\n12-26 21:53:20.149 11989 29420 D CCodec  : }\r\n12-26 21:53:20.150 11989 29420 D CCodec  : setup formats output: AMessage(what = 0x00000000) = {\r\n12-26 21:53:20.150 11989 29420 D CCodec  :   int32_t channel-count = 2\r\n12-26 21:53:20.150 11989 29420 D CCodec  :   string mime = \"audio/raw\"\r\n12-26 21:53:20.150 11989 29420 D CCodec  :   int32_t sample-rate = 44100\r\n12-26 21:53:20.150 11989 29420 D CCodec  :   int32_t android._config-pcm-encoding = 2\r\n12-26 21:53:20.150 11989 29420 D CCodec  : }\r\n12-26 21:53:20.150 11989 29420 I CCodecConfig: query failed after returning 7 values (BAD_INDEX)\r\n12-26 21:53:20.151 11989 29420 W Codec2Client: query -- param skipped: index = 1342179345.\r\n12-26 21:53:20.151 11989 29420 W Codec2Client: query -- param skipped: index = 2415921170.\r\n```\r\n\r\n[dl2.txt](https://github.com/AntennaPod/AntennaPod/files/10306211/dl2.txt)\r\n\n> It seems to be better since the latest Android 13 update. However, before that, I was experimenting with the battery settings for the app. When \"restricted\" from background use, the notification will lose the scrubber if playing is paused and then you close the app. If unrestricted, it seems that the scrubber never disappears, although after some time the notification will disappear but still be available in the 2nd pulldown of the notification/control center. If optimized, then the scrubber will disappear after some idle time\r\n\r\n\r\nThis is for sure what the issue is. Setting \"App battery usage\" to Unrestricted fixes the behavior and the scrubber never disappears. Both Optimized and Restricted cause the notification to disappear if the app is not in the foreground.\nThanks for your findings! That seems to be a functional workaround. But there must be a way to fix the root cause of this issue, or is this the solution for Android 13+ devices? A podcast player with unrestricted battery usage?\nSame issue happening for me.\r\n\r\nSystem info\r\nApp version: 1.8.3 from FDroid\r\nAndroid version: 11 (RP1A.200720.009)\r\nDevice model: Google Pixel 3a\nSame here after Android update. \n\nAndroid version: 11\nAntennaPod version: 1.8.0-RC8\nModel: Pixel 2\nDevice: walleye\n\n\n\nI just noticed this too.  If I'm actively using antennapod, the controls stay around.  If I leave a podcast paused for a bit (unsure exactly how long), the controls go away and only return when I start playing it again.  Then the controls will stick around, and disappear again.\r\n\r\nKinda wondered if it was related to the adaptive battery option (which is enabled on my phone)\r\n\r\nSystem info\r\nApp version: 1.8.1 (From Google Play store)\r\nAndroid version: 11 with October 5 2020 security update\r\nDevice model: Google Pixel 3a\nI updated my build to 2.0.1\nThe issue remains.\n\nAside from the lock screen controls, the same happens with the media controls in the quick settings drop-down menu. After a while they are gone.\n\nI.e. if the sounds/media setting is set to Hide player after session ends. If this option is disabled, old podcast episodes will clutter the media controls but without possibility to dismiss or start playback. This might be another issue though, I'm not sure\n> I updated my build to 2.0.1\r\n> The issue remains.\r\n\r\nSame here\r\n\r\n\nDoesn't seem to be fixed in 2.02\nHaving the same issue on android 11.\nSame problem with 2.0.3 on the Pixel 4a.\nApparently this is a problem with Android 11 as it affects other media players too. See here: https://support.google.com/pixelphone/thread/70342792?hl=en\r\n\r\nKnown symptoms are:\r\n- no player controls on lockscreen\r\n- no episode picture lockscreen background\r\n- player controls in quick settings only visible after swiping down twice\nSame issue here.\r\n\r\nSystem info\r\nApp version: 2.1.2 (a87cec5d2) (from Google Play store)\r\nAndroid version: 11 (1 January 2021 security update)\r\nDevice model: Samsung Galaxy S10e\nThe problem seems to have been fixed somewhat fixed with the latest updates at least on my Pixel 4a.\r\n\r\nRemaining problems:\r\n- no episode picture on lockscreen background\r\n- player controls on lockscreen seem to vanish sometimes (e.g. over night), but are there after you interacted with the podcast application\r\n\r\nThe player controls seem to consistently show up in quick settings after the first down-swipe.\nJust noticed the issue today and after googling found this issue. So for me this issue still exists.\r\nOS: Android 11 (ver: April 5th)\r\nDevice: Pixel 5\r\n\r\nA weird this is that I still see Spotify in the quick settings, but swiping left/right shows no further registered player, even though Antennapod is playing in that moment.\nSadly this is still an issue \ud83d\ude22 \r\n\r\nApp-Version: 2.3.2\r\nAndroid: 11 (1st August 2021)\r\nDevice: Motorola edge\r\n\r\nWorks fine until i update from android 10 to android 11.\r\n\r\n\r\n\nIssue continues to persist on Android 12. Most media players I use regularly have this working on Android 11 and I have had no issue from most on 12 as well. Unsure what the priority is on this given it's been an open \"Possible Bug\" for over a year.\r\n\r\nSystem info\r\nApp version: 2.3.2 from FDroid\r\nAndroid version: 12\r\nDevice model: Google Pixel 3A XL\nI don't know if it's the same bug, but I've found that if Android 12 has AntennaPod as the focused task _underneath_ the lock-screen, the controls may disappear. It doesn't happen if another app or the launcher is the focused task. **Basically, if AP was the last thing I used before locking, I sometimes encounter the problem.**\r\n\r\nIf I unlock the screen, open a different app (or go to launcher), and lock the screen again, I see the lock-screen controls. My expectation is that Android tries not to clutter the pull-down-from-status-bar menu with things that are right there on your screen, but it forgets that the thing on your screen with an unlocked device is no longer on-screen with a locked device.\r\n\r\nThis is annoying because an obvious use case is \"Select a podcast to play. Turn off screen.\" which may result in missing lock-screen controls.\nApologies for bumping the ticket, but I'm curious if this is still happening to people. It's happening to me still. If you see this in the next month or two, please \"react\" to this post with\r\n\r\n- \ud83c\udf89 if the problem is gone\r\n- \ud83d\ude15 if you still experience disappearing controls\r\n\r\nso that there aren't a stack of \"Yes\" and \"No\" comments.\nStill disappear from time to time on Android 13\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/play-controls-disappear-on-pixel-7-pro-android-13/2597/7\n\nAntennaPod seems to have a _lot_ of unusual behavior with Android [Media Controls](https://developer.android.com/guide/topics/media/media-controls) (see the issues referenced above, three of which I have also personally experienced in addition to this bug). I wonder if these issues all have the same underlying root cause, because I've never experienced them with other media player apps.\r\n\r\nIs AntennaPod perhaps doing something wrong or unusual in its use of the [Media Player](https://developer.android.com/guide/topics/media/mediaplayer) API? For example (and this is just a total guess by someone who's never worked with that API before), is AntennaPod releasing the MediaPlayer at the end of each episode and trying to create a new one for the next episode, rather than reuse the existing one? Or making incorrect assumptions about under what circumstances Android will kill background processes, or allow them to be started?\r\n\r\nIt might be worth carefully reviewing the documentation at https://developer.android.com/guide/topics/media/mediaplayer and https://developer.android.com/guide/topics/media-apps/audio-app/building-an-audio-app to ensure AntennaPod is following the recommendations there. My instincts tell me something is likely amiss with that.\nI just tried a bit to reproduce this:\r\n\r\n[Android 13 (LineageOS 20), AntennaPod 2.7.1]\r\n\r\n1. Open AntennaPod and start playing a podcast\r\n2. Pause playback\r\n3. Lock the screen\r\n4. Wait a minute (probably going into some deeper sleep state)\r\n5. Open lock screen and press play on the lock screen controls\r\n6. *Podcast starts playing, but the lock screen controls disappear*\r\n\r\nEdit: Same thing happens if instead of (5) you unlock, pull down notifications and press play on the media player controls.\r\n\r\n\r\nThese seem to be the relevant logcat lines:\r\n```\r\n02-03 13:51:29.653  1357  2621 I ActivityManager: Background started FGS: Allowed [callingPackage: de.danoeh.antennapod; callingUid: 10149; uidState: TPSL; intent: Intent { act=MediaCode126 cmp=de.danoeh.antennapod/.core.service.playback.PlaybackService (has extras) }; code:START_ACTIVITY_FLAG; tempAllowListReason:<setPendingIntentAllowlistDuration,reason:NotificationManagerService,pendingintent:u0a124:MediaCode126,reasonCode:NOTIFICATION_SERVICE,duration:30000,callingUid:10124>; targetSdkVersion:30; callerTargetSdkVersion:30; startForegroundCount:0; bindFromPackage:null]\r\n02-03 13:51:29.659  7885  7885 D PlaybackService: Service created.\r\n02-03 13:51:29.665  1357  2621 D MediaSessionService: Media button session is changed to de.danoeh.antennapod/PlaybackService (userId=0)\r\n02-03 13:51:29.667  2769  2769 W MediaPlayerList: onMediaKeyEventSessionChanged(Token): Addressed Player changed to a player we didn't have a session for\r\n02-03 13:51:29.669  2769  2769 I MediaPlayerList: Adding wrapped media player: de.danoeh.antennapod at key: 2\r\n02-03 13:51:29.669  2769  2769 I MediaPlayerList: onMediaKeyEventSessionChanged: token=de.danoeh.antennapod\r\n02-03 13:51:29.669  7885  7885 D PlaybackService: OnStartCommand called\r\n02-03 13:51:29.671  2769  2769 D MediaPlayerList: setActivePlayer(): setting player to de.danoeh.antennapod\r\n02-03 13:51:29.671  2769  2769 D MediaPlayerList: sendMediaUpdate\r\n02-03 13:51:29.671  2769  2769 I MediaPlayerList: sendMediaUpdate: Creating a one item queue for a player with no queue\r\n02-03 13:51:29.671  2769  2769 D MediaPlayerList: sendMediaUpdate state=null\r\n02-03 13:51:29.671  2769  2769 D AvrcpNativeInterface: sendMediaUpdate: metadata=false playStatus=false queue=false\r\n02-03 13:51:29.671  2769  2769 D AvrcpTargetJni: sendMediaUpdateNative\r\n02-03 13:51:29.672  2769  2769 V MediaPlayerList: onActiveSessionsChanged: number of controllers: 0\r\n02-03 13:51:29.672  2769  2769 V MediaPlayerList: onActiveSessionsChanged: number of controllers: 1\r\n02-03 13:51:29.672  2769  2769 D MediaPlayerList: onActiveSessionsChanged: controller: de.danoeh.antennapod\r\n02-03 13:51:29.672  2769  2769 D MediaPlayerList: Already have a controller for the player: de.danoeh.antennapod, updating instead\r\n02-03 13:51:29.673  7885  7885 D PlaybackService: Received media button event\r\n02-03 13:51:29.673  7885  7885 D PlaybackService: Handling keycode: 126\r\n02-03 13:51:29.673  1357  1650 I ActivityManager: Deferring FGS notification in legacy app de.danoeh.antennapod/u0a149 : Notification(channel=playing shortcut=null contentView=null vibrate=null sound=null defaults=0x0 flags=0x48 color=0x00000000 vis=PUBLIC)\r\n02-03 13:51:29.925  1357  1357 I NotificationService: Cannot find enqueued record for key: 0|de.danoeh.antennapod|2131362351|null|10149\r\n02-03 13:51:29.935  1357  1357 I NotificationService: Cannot find enqueued record for key: 0|de.danoeh.antennapod|2131362351|null|10149\r\n02-03 13:51:29.937  1357  1357 I NotificationService: Cannot find enqueued record for key: 0|de.danoeh.antennapod|2131362351|null|10149\r\n02-03 13:51:29.949  1357  1357 I NotificationService: Cannot find enqueued record for key: 0|de.danoeh.antennapod|2131362351|null|10149\r\n02-03 13:51:29.964  1357  1357 I NotificationService: Cannot find enqueued record for key: 0|de.danoeh.antennapod|2131362351|null|10149\r\n02-03 13:51:29.974  1357  1357 I NotificationService: Cannot find enqueued record for key: 0|de.danoeh.antennapod|2131362351|null|10149\r\n02-03 13:51:29.985  1357  1357 I NotificationService: Cannot find enqueued record for key: 0|de.danoeh.antennapod|2131362351|null|10149\r\n```\nStill happening on 3.0 beta 6\nWhat would it take to change this from a \"Possible Bug\" to a \"Confirmed Bug\" ? Is deterministic reproducibility required?", "created_at": "2023-02-24T22:01:25Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6349, "instance_id": "AntennaPod__AntennaPod-6349", "issue_numbers": ["5999"], "base_commit": "59253db2e4ec8cced94541d97111429760c72a3d", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/preferences/PreferenceUpgrader.java b/app/src/main/java/de/danoeh/antennapod/preferences/PreferenceUpgrader.java\nindex 79d06de599..f38e58e830 100644\n--- a/app/src/main/java/de/danoeh/antennapod/preferences/PreferenceUpgrader.java\n+++ b/app/src/main/java/de/danoeh/antennapod/preferences/PreferenceUpgrader.java\n@@ -140,6 +140,7 @@ private static void upgrade(int oldVersion, Context context) {\n                         .putBoolean(UserPreferences.PREF_THEME_BLACK, true)\n                         .apply();\n             }\n+            UserPreferences.setAllowMobileSync(true);\n         }\n     }\n }\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/sync/SyncService.java b/core/src/main/java/de/danoeh/antennapod/core/sync/SyncService.java\nindex c4a9ec5813..6e2658c1ca 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/sync/SyncService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/sync/SyncService.java\n@@ -325,7 +325,7 @@ private void updateErrorNotification(Exception exception) {\n \n     private static OneTimeWorkRequest.Builder getWorkRequest() {\n         Constraints.Builder constraints = new Constraints.Builder();\n-        if (UserPreferences.isAllowMobileFeedRefresh()) {\n+        if (UserPreferences.isAllowMobileSync()) {\n             constraints.setRequiredNetworkType(NetworkType.CONNECTED);\n         } else {\n             constraints.setRequiredNetworkType(NetworkType.UNMETERED);\ndiff --git a/core/src/main/res/values/arrays.xml b/core/src/main/res/values/arrays.xml\nindex b8b9d3d6d7..9d8065b865 100644\n--- a/core/src/main/res/values/arrays.xml\n+++ b/core/src/main/res/values/arrays.xml\n@@ -93,6 +93,7 @@\n         <item>@string/pref_mobileUpdate_auto_download</item>\n         <item>@string/pref_mobileUpdate_streaming</item>\n         <item>@string/pref_mobileUpdate_images</item>\n+        <item>@string/synchronization_pref</item>\n     </string-array>\n \n     <string-array name=\"mobile_update_values\">\n@@ -101,10 +102,12 @@\n         <item>auto_download</item>\n         <item>streaming</item>\n         <item>images</item>\n+        <item>sync</item>\n     </string-array>\n \n     <string-array name=\"mobile_update_default_value\">\n         <item>images</item>\n+        <item>sync</item>\n     </string-array>\n \n     <string-array name=\"episode_cleanup_entries\">\ndiff --git a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\nindex 37cfb4f197..09835a5282 100644\n--- a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n+++ b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n@@ -507,6 +507,10 @@ public static boolean isAllowMobileFeedRefresh() {\n         return isAllowMobileFor(\"feed_refresh\");\n     }\n \n+    public static boolean isAllowMobileSync() {\n+        return isAllowMobileFor(\"sync\");\n+    }\n+\n     public static boolean isAllowMobileEpisodeDownload() {\n         return isAllowMobileFor(\"episode_download\");\n     }\n@@ -556,6 +560,10 @@ public static void setAllowMobileImages(boolean allow) {\n         setAllowMobileFor(\"images\", allow);\n     }\n \n+    public static void setAllowMobileSync(boolean allow) {\n+        setAllowMobileFor(\"sync\", allow);\n+    }\n+\n     public static int getParallelDownloads() {\n         return Integer.parseInt(prefs.getString(PREF_PARALLEL_DOWNLOADS, \"4\"));\n     }\n", "test_patch": "", "problem_statement": "Add setting for allowing sync (nextcloud, etc) on mobile networks\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n2.6.1\n\n### Where did you get the app from\n\nF-Droid\n\n### Android version\n\n9\n\n### Device model\n\nMoto E6 Plus\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\nI'm currently writing a new [minimalist GPodder server](https://github.com/bohwaz/micro-gpodder-server) that would support the GPodder API as well as the new NextCloud API.\r\n\r\nIf I connect AntennaPod either via the GPodder API or NextCloud API, connecting is fine, but then nothing happens. Even if I tap the \"Sync now\" button, nothing. Looking at the server logs, AntennaPod doesn't make any request to the server, even after waiting for more than 10 minutes.\r\n\r\nAntennaPod is showing \"Sync started\", but nothing is happening in reality.\r\n\r\nMaybe it's something to do with being on a data connection? I don't have wifi, I just have 4G. Maybe the service is actually waiting for wifi to be enabled to sync?\r\n\r\nIf that's the case, then the \"Mobile updates\" config option should have an option to enable sync without wi-fi, and also warn the user that sync will not work until wifi is available, as the \"Sync is started\" message is misleading.\n\n### Expected behaviour\n\nStart sync with server \"now\" well like right now, not some undefined time in the future :)\n\n### Current behaviour\n\nNothing happens :)\n\n### Logs\n\nNothing, there is nothing happening in the logs when hitting \"sync now\" :(\n", "hints_text": "Do you have some kind of battery saver enabled? Then Android might decide to schedule background tasks later than usual.\r\n\r\n> If that's the case, then the \"Mobile updates\" config option should have an option to enable sync without wi-fi, \r\n\r\nSynchronization re-uses the \"feed refresh\" mobile network setting because that one uses a similar amount of data.\n> Do you have some kind of battery saver enabled? Then Android might decide to schedule background tasks later than usual.\r\n\r\nNo I have put AntennaPod on the white list.\r\n\r\n> Synchronization re-uses the \"feed refresh\" mobile network setting because that one uses a similar amount of data.\r\n\r\nAh! That did it! Thanks!\r\n\r\nI disabled the feed refresh yeah but did not expect that it would also disable sync.\r\n\r\nIMHO these are different actions, I might not want to have feeds refreshed in background, but still would like to have my feeds synced while I'm listening to them. I have around 100 feeds, so it takes a long time to refresh them, but sync should not take that much data once the first update of subscriptions has been done, only the state of episodes will be updated, that's much less than pulling 100 feeds I think :)\r\n\r\nOr at least it would be nice to have the sync screen say that sync won't work until you enable that setting.\r\n\r\nEdit : and it works well now, thanks! Takes less than 2 seconds to sync 866 episodes, that's great.\nI'm interested in contributing to this issue, so before I start working it, would you mind sparing your time explaining what the fix will be like and pointing me to some resources to get started.\r\n\nShould be somewhere on `SyncService.java` when setting up the WorkRequest. The idea is to add an additional checkbox to the popup dialog on the \"Mobile networks\" setting.", "created_at": "2023-02-24T17:40:58Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6348, "instance_id": "AntennaPod__AntennaPod-6348", "issue_numbers": ["6145"], "base_commit": "6d72d7cebf351fb172338f780f91c34f1409085e", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/activity/VideoplayerActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/VideoplayerActivity.java\nindex 034fd71fcb..30f281479b 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/VideoplayerActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/VideoplayerActivity.java\n@@ -41,6 +41,7 @@\n import de.danoeh.antennapod.event.PlayerErrorEvent;\n import de.danoeh.antennapod.event.playback.PlaybackServiceEvent;\n import de.danoeh.antennapod.event.playback.SleepTimerUpdatedEvent;\n+import de.danoeh.antennapod.fragment.ChaptersFragment;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import de.danoeh.antennapod.core.service.playback.PlaybackService;\n import de.danoeh.antennapod.core.storage.DBReader;\n@@ -561,6 +562,7 @@ public boolean onPrepareOptionsMenu(Menu menu) {\n         menu.findItem(R.id.player_switch_to_audio_only).setVisible(true);\n         menu.findItem(R.id.audio_controls).setIcon(R.drawable.ic_sliders);\n         menu.findItem(R.id.playback_speed).setVisible(true);\n+        menu.findItem(R.id.player_show_chapters).setVisible(true);\n         return true;\n     }\n \n@@ -570,13 +572,15 @@ public boolean onOptionsItemSelected(MenuItem item) {\n             switchToAudioOnly = true;\n             finish();\n             return true;\n-        }\n-        if (item.getItemId() == android.R.id.home) {\n+        } else if (item.getItemId() == android.R.id.home) {\n             Intent intent = new Intent(VideoplayerActivity.this, MainActivity.class);\n             intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP  | Intent.FLAG_ACTIVITY_NEW_TASK);\n             startActivity(intent);\n             finish();\n             return true;\n+        } else if (item.getItemId() == R.id.player_show_chapters) {\n+            new ChaptersFragment().show(getSupportFragmentManager(), ChaptersFragment.TAG);\n+            return true;\n         }\n \n         if (controller == null) {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/ChaptersFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/ChaptersFragment.java\nindex 809ca96c59..ae18fecdad 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/ChaptersFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/ChaptersFragment.java\n@@ -8,6 +8,7 @@\n import android.view.LayoutInflater;\n import android.view.View;\n import android.widget.ProgressBar;\n+import android.widget.Toast;\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n import androidx.appcompat.app.AlertDialog;\n@@ -158,8 +159,9 @@ private void onMediaChanged(Playable media) {\n         if (adapter == null) {\n             return;\n         }\n-        if (media.getChapters() != null && media.getChapters().size() <= 0) {\n+        if (media.getChapters() != null && media.getChapters().size() == 0) {\n             dismiss();\n+            Toast.makeText(getContext(), R.string.no_chapters_label, Toast.LENGTH_LONG).show();\n         } else {\n             progressBar.setVisibility(View.GONE);\n         }\ndiff --git a/app/src/main/res/menu/mediaplayer.xml b/app/src/main/res/menu/mediaplayer.xml\nindex ebb0befb05..5f60fe6f57 100644\n--- a/app/src/main/res/menu/mediaplayer.xml\n+++ b/app/src/main/res/menu/mediaplayer.xml\n@@ -65,6 +65,13 @@\n         android:visible=\"false\">\n     </item>\n \n+    <item\n+        android:id=\"@+id/player_show_chapters\"\n+        custom:showAsAction=\"never\"\n+        android:title=\"@string/chapters_label\"\n+        android:visible=\"false\">\n+    </item>\n+\n     <item\n         android:id=\"@+id/share_item\"\n         android:menuCategory=\"container\"\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex a12119a6c3..ab74d6b45c 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -110,6 +110,7 @@\n     <string name=\"error_msg_prefix\">An error occurred:</string>\n     <string name=\"refresh_label\">Refresh</string>\n     <string name=\"chapters_label\">Chapters</string>\n+    <string name=\"no_chapters_label\">No chapters</string>\n     <string name=\"chapter_duration\">Duration: %1$s</string>\n     <string name=\"description_label\">Description</string>\n     <string name=\"shownotes_label\">Shownotes</string>\n", "test_patch": "", "problem_statement": "Video player UI doesn't have chapter navigation\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n2.6.2\n\n### Where did you get the app from\n\nF-Droid\n\n### Problem you may be having, or feature you want\n\nI see that there's support for [http://podlove.org/simple-chapters](https://github.com/podlove/podlove-specifications/blob/master/podlove-simple-chapters.md) in the audio player UI (chapters button), but I can't find any UI to trigger chapter navigation in a video player.\n\n### Suggested solution\n\nIt'd be cool if video player interface also started supporting chapter navigation.\n\n### Screenshots / Drawings / Technical details\n\nVideo player might gain\r\n* a chapter selection button that brings up the same dialog as in the audio player (preferred)\r\n* next/previous chapter buttons\r\n* both\r\n\r\nAlternatively, if 'switch to audio only' would've shown audio player UI with chapters button present and functional, that'd work too.\n", "hints_text": "", "created_at": "2023-02-24T17:29:16Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6347, "instance_id": "AntennaPod__AntennaPod-6347", "issue_numbers": ["956"], "base_commit": "59253db2e4ec8cced94541d97111429760c72a3d", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/activity/OpmlImportActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/OpmlImportActivity.java\nindex c8d9f9b31e..64a6b66325 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/OpmlImportActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/OpmlImportActivity.java\n@@ -28,7 +28,7 @@\n import de.danoeh.antennapod.core.export.opml.OpmlReader;\n import de.danoeh.antennapod.core.preferences.ThemeSwitcher;\n \n-import de.danoeh.antennapod.core.service.download.DownloadRequestCreator;\n+import de.danoeh.antennapod.core.storage.DBTasks;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n import de.danoeh.antennapod.databinding.OpmlSelectionBinding;\n import de.danoeh.antennapod.model.feed.Feed;\n@@ -43,6 +43,7 @@\n import java.io.InputStreamReader;\n import java.io.Reader;\n import java.util.ArrayList;\n+import java.util.Collections;\n import java.util.List;\n \n /**\n@@ -95,9 +96,12 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {\n                         continue;\n                     }\n                     OpmlElement element = readElements.get(checked.keyAt(i));\n-                    Feed feed = new Feed(element.getXmlUrl(), null, element.getText());\n-                    DownloadServiceInterface.get().download(this, false, DownloadRequestCreator.create(feed).build());\n+                    Feed feed = new Feed(element.getXmlUrl(), null,\n+                            element.getText() != null ? element.getText() : \"Unknown podcast\");\n+                    feed.setItems(Collections.emptyList());\n+                    DBTasks.updateFeed(this, feed, false);\n                 }\n+                DownloadServiceInterface.get().refreshAllFeeds(this, true);\n             })\n                     .subscribeOn(Schedulers.io())\n                     .observeOn(AndroidSchedulers.mainThread())\n@@ -109,6 +113,7 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {\n                                 startActivity(intent);\n                                 finish();\n                             }, e -> {\n+                                e.printStackTrace();\n                                 viewBinding.progressBar.setVisibility(View.GONE);\n                                 Toast.makeText(this, e.getMessage(), Toast.LENGTH_LONG).show();\n                             });\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/storage/DBTasks.java b/core/src/main/java/de/danoeh/antennapod/core/storage/DBTasks.java\nindex bf03ebff10..18f1579082 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/storage/DBTasks.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/storage/DBTasks.java\n@@ -322,7 +322,7 @@ public static synchronized Feed updateFeed(Context context, Feed newFeed, boolea\n \n             // get the most recent date now, before we start changing the list\n             FeedItem priorMostRecent = savedFeed.getMostRecentItem();\n-            Date priorMostRecentDate = null;\n+            Date priorMostRecentDate = new Date();\n             if (priorMostRecent != null) {\n                 priorMostRecentDate = priorMostRecent.getPubDate();\n             }\n", "test_patch": "", "problem_statement": "Does not add the podcast if the connection fails (OPML import)\nHi\n\nMaybe it makes sense to not to add a podcast, but the thing is there could be temporary connection issues with the podcast providers. \n\nHere is a scenario. I have 60 podcasts in an opml file. I import it and some of them fail during import and APod does not add them. They are not listed. Well what if the connection issue is temporary from the server? Sometimes the providers might get hit with lots of request which disables their response?\n\nI think that it will make more sense if APod adds the all the podcasts during import but show some icon or gray it out next to the listing (not in downloads window) to show that it failed during the import. And maybe it will come back during another refresh.\n\nIt is a bit confusing this way because hard to keep track of which ones made it back whioch ones are not. \n\n", "hints_text": "You can always re-import the opml\n\nOn Wed, Jun 24, 2015, 11:42 AM gerroon notifications@github.com wrote:\n\n> Hi\n> \n> Maybe it makes sense to not to add a podcast, but the thing is there could\n> be temporary connection issues with the podcast providers.\n> \n> Here is a scenario. I have 60 podcasts in an opml file. I import it and\n> some of them fail during import and APod does not add them. They are not\n> listed. Well what if the connection issue is temporary from the server?\n> Sometimes the providers might get hit with lots of request which disables\n> their response?\n> \n> I think that it will make more sense if APod adds the all the podcasts\n> during import but show some icon or gray it out next to the listing (not in\n> downloads window) to show that it failed during the import. And maybe it\n> will come back during another refresh.\n> \n> It is a bit confusing this way because hard to keep track of which ones\n> made it back whioch ones are not.\n> \n> \u2014\n> Reply to this email directly or view it on GitHub\n> https://github.com/AntennaPod/AntennaPod/issues/956.\n\n@TomHennen \n\nYeah that is what I do but it would be more streamlined if the podcast is listed anyways.  For example Podcast addicts does it that way. It lets the user know that the podcast is still offline if it cant connect to the server.\n\nI had the same problem while #854. \nEspecially if the feed comes from a backup or directory (itunes) it would be nicer if we could add the feed and hope for success in the future.\n\nWhy would Apod care if a podcast fail or not? It should add all the podcasts in an opml because this is what the user wants when importing an opml. antennapod should not outsmart the user.\n\nWell, why this is done this way is a lot about code sanity. At the moment, we can be sure that the feed was read successfully at least once and that all the fields in the corresponding database entry have meaningful values. We read the feed first and _then_ save this information to the database. If the feed cannot be read, we save nothing. \n\nIf you cannot assume that most attributes have meaningful values, things become far more complicated. Not only do you have to display the information you don't have somehow, you also have to take precautions the user can understand what is happening here. When the server is not responding in time, we cannot even make sure, that the provided feed URL exists - if we actually find out, we devs have to come up with a way to tell the user that, as well.\n\nI'm not saying this is not possible. For now, I have far more important things on my todo list - This requires several error prone changes to the code base and I see only little gain in usability.\n\n@mfietz \n\nI understand that the current behavior makes sense from the dev point of if but for the user it is a dreadful experience (because I frequently get failed but online podcasts  even when I add from Itunes sometimes). It would be nice if APod adds whatever in the opml file regardless of the connection. This can also be said for adding opml when there is no net connection available.\n\nWould not be possible to fill the database for those failed podcast with generic names and fill it with the real values later if the podcasts were to come back to life at some point? So for a real icon, we put \"error\" images, therefor the user also can see that there has been an error with the connection for that cast. The image can be replaced later if the podcasts makes a proper connection.\n\nIt may be possible but it isn't a high priority.  I'll leave this issue open so that one day someone can get around to it, but I don't think @mfietz and I will get to it for the next milestone.  Someone else is welcome to try.\n", "created_at": "2023-02-24T17:09:19Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6346, "instance_id": "AntennaPod__AntennaPod-6346", "issue_numbers": ["6302"], "base_commit": "59253db2e4ec8cced94541d97111429760c72a3d", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/activity/VideoplayerActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/VideoplayerActivity.java\nindex 034fd71fcb..bacb5972f9 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/VideoplayerActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/VideoplayerActivity.java\n@@ -30,11 +30,11 @@\n import android.widget.FrameLayout;\n import android.widget.SeekBar;\n import androidx.annotation.Nullable;\n-import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import androidx.core.view.WindowCompat;\n import androidx.interpolator.view.animation.FastOutSlowInInterpolator;\n import com.bumptech.glide.Glide;\n import de.danoeh.antennapod.R;\n+import de.danoeh.antennapod.dialog.MediaPlayerErrorDialog;\n import de.danoeh.antennapod.dialog.VariableSpeedDialog;\n import de.danoeh.antennapod.event.playback.BufferUpdateEvent;\n import de.danoeh.antennapod.event.playback.PlaybackPositionEvent;\n@@ -514,11 +514,7 @@ public void onPlaybackServiceChanged(PlaybackServiceEvent event) {\n \n     @Subscribe(threadMode = ThreadMode.MAIN)\n     public void onMediaPlayerError(PlayerErrorEvent event) {\n-        final MaterialAlertDialogBuilder errorDialog = new MaterialAlertDialogBuilder(VideoplayerActivity.this);\n-        errorDialog.setTitle(R.string.error_label);\n-        errorDialog.setMessage(event.getMessage());\n-        errorDialog.setNeutralButton(android.R.string.ok, (dialog, which) -> finish());\n-        errorDialog.show();\n+        MediaPlayerErrorDialog.show(this, event);\n     }\n \n     @Override\ndiff --git a/app/src/main/java/de/danoeh/antennapod/dialog/MediaPlayerErrorDialog.java b/app/src/main/java/de/danoeh/antennapod/dialog/MediaPlayerErrorDialog.java\nnew file mode 100644\nindex 0000000000..ab5dde92da\n--- /dev/null\n+++ b/app/src/main/java/de/danoeh/antennapod/dialog/MediaPlayerErrorDialog.java\n@@ -0,0 +1,37 @@\n+package de.danoeh.antennapod.dialog;\n+\n+import android.app.Activity;\n+import android.text.Spannable;\n+import android.text.SpannableString;\n+import android.text.style.ForegroundColorSpan;\n+import com.google.android.material.bottomsheet.BottomSheetBehavior;\n+import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n+import com.google.android.material.snackbar.Snackbar;\n+import de.danoeh.antennapod.R;\n+import de.danoeh.antennapod.activity.MainActivity;\n+import de.danoeh.antennapod.event.PlayerErrorEvent;\n+import de.danoeh.antennapod.storage.preferences.UserPreferences;\n+\n+public class MediaPlayerErrorDialog {\n+    public static void show(Activity activity, PlayerErrorEvent event) {\n+        final MaterialAlertDialogBuilder errorDialog = new MaterialAlertDialogBuilder(activity);\n+        errorDialog.setTitle(R.string.error_label);\n+\n+        String genericMessage = activity.getString(R.string.playback_error_generic);\n+        SpannableString errorMessage = new SpannableString(genericMessage + \"\\n\\n\" + event.getMessage());\n+        errorMessage.setSpan(new ForegroundColorSpan(0x88888888),\n+                genericMessage.length(), errorMessage.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);\n+\n+        errorDialog.setMessage(errorMessage);\n+        errorDialog.setPositiveButton(android.R.string.ok, (dialog, which) ->\n+                ((MainActivity) activity).getBottomSheet().setState(BottomSheetBehavior.STATE_COLLAPSED));\n+        if (!UserPreferences.useExoplayer()) {\n+            errorDialog.setNeutralButton(R.string.media_player_switch_to_exoplayer, (dialog, which) -> {\n+                UserPreferences.enableExoplayer();\n+                ((MainActivity) activity).showSnackbarAbovePlayer(\n+                        R.string.media_player_switched_to_exoplayer, Snackbar.LENGTH_LONG);\n+            });\n+        }\n+        errorDialog.create().show();\n+    }\n+}\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/AudioPlayerFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/AudioPlayerFragment.java\nindex e93db2d2a6..5c2336c7ef 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/AudioPlayerFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/AudioPlayerFragment.java\n@@ -15,7 +15,6 @@\n \n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n-import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import com.google.android.material.appbar.MaterialToolbar;\n import androidx.cardview.widget.CardView;\n import androidx.fragment.app.Fragment;\n@@ -25,10 +24,10 @@\n \n import com.google.android.material.bottomsheet.BottomSheetBehavior;\n import com.google.android.material.elevation.SurfaceColors;\n-import com.google.android.material.snackbar.Snackbar;\n \n import de.danoeh.antennapod.core.receiver.MediaButtonReceiver;\n import de.danoeh.antennapod.core.util.playback.PlaybackController;\n+import de.danoeh.antennapod.dialog.MediaPlayerErrorDialog;\n import de.danoeh.antennapod.event.playback.BufferUpdateEvent;\n import de.danoeh.antennapod.event.playback.PlaybackServiceEvent;\n import de.danoeh.antennapod.event.PlayerErrorEvent;\n@@ -396,19 +395,7 @@ public void favoritesChanged(FavoritesEvent event) {\n \n     @Subscribe(threadMode = ThreadMode.MAIN)\n     public void mediaPlayerError(PlayerErrorEvent event) {\n-        final MaterialAlertDialogBuilder errorDialog = new MaterialAlertDialogBuilder(getContext());\n-        errorDialog.setTitle(R.string.error_label);\n-        errorDialog.setMessage(event.getMessage());\n-        errorDialog.setPositiveButton(android.R.string.ok, (dialog, which) ->\n-                ((MainActivity) getActivity()).getBottomSheet().setState(BottomSheetBehavior.STATE_COLLAPSED));\n-        if (!UserPreferences.useExoplayer()) {\n-            errorDialog.setNeutralButton(R.string.media_player_switch_to_exoplayer, (dialog, which) -> {\n-                UserPreferences.enableExoplayer();\n-                ((MainActivity) getActivity()).showSnackbarAbovePlayer(\n-                        R.string.media_player_switched_to_exoplayer, Snackbar.LENGTH_LONG);\n-            });\n-        }\n-        errorDialog.create().show();\n+        MediaPlayerErrorDialog.show(getActivity(), event);\n     }\n \n     @Override\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex a12119a6c3..5fb6e00635 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -309,6 +309,7 @@\n     <string name=\"confirm_mobile_download_dialog_enable_temporarily\">Allow temporarily</string>\n \n     <!-- Mediaplayer messages -->\n+    <string name=\"playback_error_generic\"><![CDATA[The media file could not be played.\\n\\n- Try deleting and re-downloading the episode.\\n- Check your network connection, and make sure no VPN or login page is blocking access.\\n- Try long-pressing and sharing the \\\"Media address\\\" to your web browser to see if it can be played there. If not, contact the podcast creators.]]></string>\n     <string name=\"playback_error_server_died\">Server died</string>\n     <string name=\"playback_error_unsupported\">Unsupported media type</string>\n     <string name=\"playback_error_timeout\">Operation timed out</string>\n", "test_patch": "", "problem_statement": "Provide some context when showing error message about media file not playable \n### Checklist\r\n\r\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\r\n\r\n### App version\r\n\r\n2.7.1\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Problem you may be having, or feature you want\r\n\r\nUser experience ([Google Play review ](https://play.google.com/apps/publish?account=8008695526664634386#ReviewDetailsPlace:p=de.danoeh.antennapod&reviewid=3a7c7a46-f8bf-4b0c-8d61-ca2238dcee61) ):\r\n> Suddenly stopped working: \"no extractor available\". No explanation, no update available. Bad. Do I have to look for another provider?\r\n\r\nAnd https://twitter.com/camsticky/status/1617031274777952258\r\n\r\nIn other words: the error message isn't clear enough about the cause or the solution.\r\n\r\n### Suggested solution\r\n\r\nImprove the error message. Suggested text:\r\n\r\n**Error: cannot play media file**\r\nThe media file of the episode _[ep. title]_ could not be played. This may have several causes. Please try the following:\r\n* The downloaded file may be broken. Please delete and re-download the episode.\r\n* Something may be interfering when streaming. Please check your connection, and make sure no 'captive portal' is blocking access.\r\n* The media file provided by the podcast is broken. Please 'share' the 'Media address' to your browser to see if it can be played there. If not, please contact the podcaster(s).\r\n\r\n---\r\n\r\nNote: I didn't include the case of the SD card as the text is long enough already, and some of the cases would already be fixed with the delete & redownload.\r\n\r\n### Screenshots / Drawings / Technical details\r\n\r\n![20230202_080518](https://user-images.githubusercontent.com/11229646/216255188-6349e870-a99a-471f-8ca2-58baf387659b.jpg)\r\n\n", "hints_text": "", "created_at": "2023-02-24T16:50:41Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6345, "instance_id": "AntennaPod__AntennaPod-6345", "issue_numbers": ["6339"], "base_commit": "e20d11e130938dd4bf30c2500fb5afc0993a7ed7", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/dialog/SwipeActionsDialog.java b/app/src/main/java/de/danoeh/antennapod/dialog/SwipeActionsDialog.java\nindex 02336949e8..4e579fce45 100644\n--- a/app/src/main/java/de/danoeh/antennapod/dialog/SwipeActionsDialog.java\n+++ b/app/src/main/java/de/danoeh/antennapod/dialog/SwipeActionsDialog.java\n@@ -77,7 +77,7 @@ public void show(Callback prefsChanged) {\n                         && !a.getId().equals(SwipeAction.START_DOWNLOAD)).toList();\n                 break;\n             case FeedItemlistFragment.TAG:\n-                forFragment = context.getString(R.string.feeds_label);\n+                forFragment = context.getString(R.string.individual_subscription);\n                 keys = Stream.of(keys).filter(a -> !a.getId().equals(SwipeAction.REMOVE_FROM_HISTORY)).toList();\n                 break;\n             case QueueFragment.TAG:\ndiff --git a/app/src/main/res/xml/preferences_swipe.xml b/app/src/main/res/xml/preferences_swipe.xml\nindex d555e70e60..10ac102dd8 100644\n--- a/app/src/main/res/xml/preferences_swipe.xml\n+++ b/app/src/main/res/xml/preferences_swipe.xml\n@@ -23,6 +23,6 @@\n \n     <Preference\n         android:key=\"prefSwipeFeed\"\n-        android:title=\"@string/feeds_label\"/>\n+        android:title=\"@string/individual_subscription\"/>\n \n </PreferenceScreen>\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex a12119a6c3..d1ee356425 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -37,6 +37,7 @@\n     <string name=\"swipe_left\">Swipe Left</string>\n     <string name=\"enable_swipeactions\">Enable Swipe Actions for this Screen</string>\n     <string name=\"change_setting\">Change</string>\n+    <string name=\"individual_subscription\">Individual subscription</string>\n \n     <!-- Statistics fragment -->\n     <string name=\"statistics_include_marked\">Include duration of episodes that are just marked as played</string>\n", "test_patch": "", "problem_statement": "Clarify where \"Swipe Actions - Podcasts\" are used\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.0.0 beta 5\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\nI just tried to find out which screen this setting refers to, but failed. The name implies it is a higher level than Episodes, but the actions offered all refer to episodes. Is it part of a planned or removed feature? \ud83e\udd14\n\n### Expected behaviour\n\n_No response_\n\n### Current behaviour\n\n_No response_\n\n### Logs\n\n_No response_\n", "hints_text": "It's on the screen that shows an individual subscription. Any idea for a better name? \"Individual subscription\" sounds a bit weird\n\"Individual subscription\" might be a bit clunky, but it does make it clearer.\r\n\r\nAnother option would be to merge this setting with Swipe Actions - Episodes, I can't imagine using these two in a different way. Or did users ask for more granular controls?", "created_at": "2023-02-24T15:52:51Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6342, "instance_id": "AntennaPod__AntennaPod-6342", "issue_numbers": ["5673"], "base_commit": "240737e3acee6d6c56ce8ca782b99f54205a4ea9", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/fragment/AudioPlayerFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/AudioPlayerFragment.java\nindex e93db2d2a6..51cb28eb80 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/AudioPlayerFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/AudioPlayerFragment.java\n@@ -528,7 +528,7 @@ public void fadePlayerToToolbar(float slideOffset) {\n         float playerFadeProgress = Math.max(0.0f, Math.min(0.2f, slideOffset - 0.2f)) / 0.2f;\n         View player = getView().findViewById(R.id.playerFragment);\n         player.setAlpha(1 - playerFadeProgress);\n-        player.setVisibility(playerFadeProgress > 0.99f ? View.GONE : View.VISIBLE);\n+        player.setVisibility(playerFadeProgress > 0.99f ? View.INVISIBLE : View.VISIBLE);\n         float toolbarFadeProgress = Math.max(0.0f, Math.min(0.2f, slideOffset - 0.6f)) / 0.2f;\n         toolbar.setAlpha(toolbarFadeProgress);\n         toolbar.setVisibility(toolbarFadeProgress < 0.01f ? View.INVISIBLE : View.VISIBLE);\ndiff --git a/app/src/main/java/de/danoeh/antennapod/view/NoRelayoutTextView.java b/app/src/main/java/de/danoeh/antennapod/view/NoRelayoutTextView.java\nnew file mode 100644\nindex 0000000000..3f921b4452\n--- /dev/null\n+++ b/app/src/main/java/de/danoeh/antennapod/view/NoRelayoutTextView.java\n@@ -0,0 +1,28 @@\n+package de.danoeh.antennapod.view;\n+\n+import android.annotation.SuppressLint;\n+import android.content.Context;\n+import android.util.AttributeSet;\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import androidx.appcompat.widget.AppCompatTextView;\n+\n+public class NoRelayoutTextView extends AppCompatTextView {\n+    public NoRelayoutTextView(@NonNull Context context) {\n+        super(context);\n+    }\n+\n+    public NoRelayoutTextView(@NonNull Context context, @Nullable AttributeSet attrs) {\n+        super(context, attrs);\n+    }\n+\n+    public NoRelayoutTextView(@NonNull Context context, @Nullable AttributeSet attrs, int defStyleAttr) {\n+        super(context, attrs, defStyleAttr);\n+    }\n+\n+    @SuppressLint(\"MissingSuperCall\")\n+    @Override\n+    public void requestLayout() {\n+        // Deliberate no-op\n+    }\n+}\ndiff --git a/app/src/main/res/layout/audioplayer_fragment.xml b/app/src/main/res/layout/audioplayer_fragment.xml\nindex 496875a5fa..87225e7839 100644\n--- a/app/src/main/res/layout/audioplayer_fragment.xml\n+++ b/app/src/main/res/layout/audioplayer_fragment.xml\n@@ -104,7 +104,7 @@\n                 android:paddingLeft=\"8dp\"\n                 android:paddingRight=\"8dp\">\n \n-                <TextView\n+                <de.danoeh.antennapod.view.NoRelayoutTextView\n                     android:id=\"@+id/txtvPosition\"\n                     android:layout_width=\"wrap_content\"\n                     android:layout_height=\"wrap_content\"\n@@ -116,7 +116,7 @@\n                     android:textColor=\"?android:attr/textColorSecondary\"\n                     android:textSize=\"@dimen/text_size_micro\" />\n \n-                <TextView\n+                <de.danoeh.antennapod.view.NoRelayoutTextView\n                     android:id=\"@+id/txtvLength\"\n                     android:layout_width=\"wrap_content\"\n                     android:layout_height=\"wrap_content\"\n@@ -124,6 +124,7 @@\n                     android:layout_alignParentRight=\"true\"\n                     android:layout_marginEnd=\"16dp\"\n                     android:layout_marginRight=\"16dp\"\n+                    android:textAlignment=\"textEnd\"\n                     android:background=\"?android:attr/selectableItemBackground\"\n                     android:text=\"@string/position_default_label\"\n                     android:textColor=\"?android:attr/textColorSecondary\"\n", "test_patch": "", "problem_statement": "Miniplayer jumps when playing\n### Checklist\n\n- [X] I have used the search function to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n2.4.2 (83f564ffc)\n\n### Where did you get the app from\n\nF-Droid\n\n### Android version\n\n11 + MIUI 12.5\n\n### Device model\n\nRedmi Note 9 Pro\n\n### First occurred\n\n3 weeksago\n\n### Steps to reproduce\n\n1. Start playing a podcast\r\n2. Tap on the player at the bottom so it becomes fullscreen\r\n3. Slowly start dragging the podcast down\r\n4. See it reset its position\n\n### Expected behaviour\n\nIt should stay where you're dragging it\n\n### Current behaviour\n\nIt resets its position on the screen\r\nhttps://mega.nz/file/xEJ2jRzR#ZYf-_-bV_gFSOgTtGqoAUAmw3L3OTaUv75ByTondupA\n\n### Logs\n\n_No response_\n", "hints_text": "Seems to be related to updating the position indicators. When I [comment out the related code](https://github.com/ByteHamster/AntennaPod/commit/c47ac3fb16c30bd4b9c9b9153dab68b3381414fc), the jumping goes away. I do not know why Android decides it wants to re-layout the whole screen instead of just updating the position itself. Also, we do want to keep updating the position indicators, obviously. So we somehow need to find out how to update the position without jumping", "created_at": "2023-02-23T22:05:37Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6341, "instance_id": "AntennaPod__AntennaPod-6341", "issue_numbers": ["6047"], "base_commit": "240737e3acee6d6c56ce8ca782b99f54205a4ea9", "patch": "diff --git a/net/discovery/src/main/java/de/danoeh/antennapod/net/discovery/ItunesTopListLoader.java b/net/discovery/src/main/java/de/danoeh/antennapod/net/discovery/ItunesTopListLoader.java\nindex 0bfc5a8630..5fa48458e6 100644\n--- a/net/discovery/src/main/java/de/danoeh/antennapod/net/discovery/ItunesTopListLoader.java\n+++ b/net/discovery/src/main/java/de/danoeh/antennapod/net/discovery/ItunesTopListLoader.java\n@@ -58,8 +58,9 @@ private static List<PodcastSearchResult> removeSubscribed(\n             List<PodcastSearchResult> suggestedPodcasts, List<Feed> subscribedFeeds, int limit) {\n         Set<String> subscribedPodcastsSet = new HashSet<>();\n         for (Feed subscribedFeed : subscribedFeeds) {\n-            String subscribedTitle = subscribedFeed.getTitle().trim() + \" - \" + subscribedFeed.getAuthor().trim();\n-            subscribedPodcastsSet.add(subscribedTitle);\n+            if (subscribedFeed.getTitle() != null && subscribedFeed.getAuthor() != null) {\n+                subscribedPodcastsSet.add(subscribedFeed.getTitle().trim() + \" - \" + subscribedFeed.getAuthor().trim());\n+            }\n         }\n         List<PodcastSearchResult> suggestedNotSubscribed = new ArrayList<>();\n         for (PodcastSearchResult suggested : suggestedPodcasts) {\n", "test_patch": "", "problem_statement": "Remove subscribed podcasts from discover / suggestions\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n2.7.0 beta 1\n\n### Where did you get the app from\n\nGoogle Play\n\n### Problem you may be having, or feature you want\n\nOn screen \"add a subscription\" there is a discover section listing top podcast.\r\nAdditionally when tapping on more you go to discover screen which display a more comprehensive list of top podcasts.\r\n\r\nOn both screen podcasts you already subscribed to are displayed. As the idea is to suggest podcasts to subscribe only not subscribed podcasts should be listed.\r\nRight now it would even be possible for someone to have as suggestions only podcasts he already follow.\n\n### Suggested solution\n\nFilter list in both location to ignore podcasts already subscribed by the user.\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "We have to keep in mind here that podcasts can be spread across different hosts so the feed url isn't as static as one would hope.\niTunes does not tell us the feed url before actually clicking the entries, so I don't think implementing this is possible (without requesting every single entry when refreshing, which might get us blocked because they think we DDOS them). I could swear this was already discussed somewhere but I cannot find it now.\nI am surprised it wasn't talked about before but couldn't find anything either.\r\n\r\nWould it really be a problem to base filter only on title ? There is no harm if a podcast is wrongly not displayed as a suggestion.\r\nIf a top podcast is wrongly not proposed it's better than displaying a bunch of podcasts already subscribed to as suggestions.\r\n\r\nOf course if the user initiate a search there shouldn't be such filtering. I am talking only at what AntennaPod pro actively push as suggestions.\r\n\r\nI thought there would be no debate so I posted directly on github but I am starting to think I should have posted on the forum !\n> Would it really be a problem to base filter only on title ?\n\nIndeed that should not be done for search, but I think that for the Discover that would be fine indeed. Or maybe a combination of Title + Author (latter does seem to be provided already by iTunes when viewing the full list).\nI am curious to work on this issue, but I am wondering if it is ok not to display any suggestions if the user has subscribed to all the 12 suggestions provided by `iTunes`? \nI don't think it would matter that much, but i think most people would expect other suggestions to fill the space in this case so a static list of 12 suggestions is displayed\nAgree with yoshimo. I would expect to still have 12 suggestions.\r\nIf you just exclude you could have a user without any suggestions because he subscribed to all 12.\nIf I remember correctly, we already load 25 suggestions from iTunes and only use the first 12. That should give us some room for hiding suggestions. Anyway, I am not sure it is possible to reliably filter the subscribed episodes. For example, it looks like iTunes now returns both the name and the author in the \"name\" field. We would have to follow their formatting to check this, and it would break whenever they change their mind. This sounds like a cat-and-mouse game that just leads to trouble on our side.\nThe PR is already broken because iTunes changed something in their naming scheme. Side-effect: No more suggestions at all. That's what I meant with cat-and-mouse game...", "created_at": "2023-02-23T21:01:18Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6333, "instance_id": "AntennaPod__AntennaPod-6333", "issue_numbers": ["5869"], "base_commit": "c98194f519c66e5af1575b1c6ffac5af16594141", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadService.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadService.java\nindex a18d7d1d04..b04122487d 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadService.java\n@@ -14,6 +14,7 @@\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n import androidx.annotation.VisibleForTesting;\n+import androidx.core.app.NotificationManagerCompat;\n import androidx.core.app.ServiceCompat;\n \n import de.danoeh.antennapod.core.R;\n@@ -82,6 +83,7 @@ public class DownloadService extends Service {\n     private final ExecutorService downloadEnqueueExecutor;\n \n     private final List<DownloadStatus> reportQueue = new ArrayList<>();\n+    private final List<DownloadRequest> failedRequestsForReport = new ArrayList<>();\n     private DownloadServiceNotification notificationManager;\n     private final NewEpisodesNotification newEpisodesNotification;\n     private NotificationUpdater notificationUpdater;\n@@ -176,11 +178,15 @@ public int onStartCommand(Intent intent, int flags, int startId) {\n         if (intent != null && intent.hasExtra(EXTRA_REQUESTS)) {\n             Notification notification = notificationManager.updateNotifications(downloads);\n             startForeground(R.id.notification_downloading, notification);\n+            NotificationManagerCompat.from(this).cancel(R.id.notification_download_report);\n+            NotificationManagerCompat.from(this).cancel(R.id.notification_auto_download_report);\n             setupNotificationUpdaterIfNecessary();\n             downloadEnqueueExecutor.execute(() -> onDownloadQueued(intent));\n         } else if (intent != null && intent.getBooleanExtra(EXTRA_REFRESH_ALL, false)) {\n             Notification notification = notificationManager.updateNotifications(downloads);\n             startForeground(R.id.notification_downloading, notification);\n+            NotificationManagerCompat.from(this).cancel(R.id.notification_download_report);\n+            NotificationManagerCompat.from(this).cancel(R.id.notification_auto_download_report);\n             setupNotificationUpdaterIfNecessary();\n             downloadEnqueueExecutor.execute(() -> enqueueAll(intent));\n         } else if (downloads.size() == 0) {\n@@ -198,8 +204,9 @@ public void onDestroy() {\n \n         boolean showAutoDownloadReport = UserPreferences.showAutoDownloadReport();\n         if (UserPreferences.showDownloadReport() || showAutoDownloadReport) {\n-            notificationManager.updateReport(reportQueue, showAutoDownloadReport);\n+            notificationManager.updateReport(reportQueue, showAutoDownloadReport, failedRequestsForReport);\n             reportQueue.clear();\n+            failedRequestsForReport.clear();\n         }\n \n         unregisterReceiver(cancelDownloadReceiver);\n@@ -283,7 +290,7 @@ private void handleSuccessfulDownload(Downloader downloader) {\n                 // we create a 'successful' download log if the feed's last refresh failed\n                 List<DownloadStatus> log = DBReader.getFeedDownloadLog(request.getFeedfileId());\n                 if (log.size() > 0 && !log.get(0).isSuccessful()) {\n-                    saveDownloadStatus(feedSyncTask.getDownloadStatus());\n+                    saveDownloadStatus(feedSyncTask.getDownloadStatus(), downloader.getDownloadRequest());\n                 }\n                 if (!request.isInitiatedByUser()) {\n                     // Was stored in the database before and not initiated manually\n@@ -296,13 +303,13 @@ private void handleSuccessfulDownload(Downloader downloader) {\n                 }\n             } else {\n                 DBWriter.setFeedLastUpdateFailed(request.getFeedfileId(), true);\n-                saveDownloadStatus(feedSyncTask.getDownloadStatus());\n+                saveDownloadStatus(feedSyncTask.getDownloadStatus(), downloader.getDownloadRequest());\n             }\n         } else if (type == FeedMedia.FEEDFILETYPE_FEEDMEDIA) {\n             Log.d(TAG, \"Handling completed FeedMedia Download\");\n             MediaDownloadedHandler handler = new MediaDownloadedHandler(DownloadService.this, status, request);\n             handler.run();\n-            saveDownloadStatus(handler.getUpdatedStatus());\n+            saveDownloadStatus(handler.getUpdatedStatus(), downloader.getDownloadRequest());\n         }\n     }\n \n@@ -321,7 +328,7 @@ private void handleFailedDownload(Downloader downloader) {\n                 DownloadServiceInterface.get().download(this, false, downloader.getDownloadRequest());\n             } else {\n                 Log.e(TAG, \"Download failed\");\n-                saveDownloadStatus(status);\n+                saveDownloadStatus(status, downloader.getDownloadRequest());\n                 new FailedDownloadHandler(downloader.getDownloadRequest()).run();\n \n                 if (type == FeedMedia.FEEDFILETYPE_FEEDMEDIA) {\n@@ -509,8 +516,11 @@ public static void setDownloaderFactory(DownloaderFactory downloaderFactory) {\n      *\n      * @param status the download that is going to be saved\n      */\n-    private void saveDownloadStatus(@NonNull DownloadStatus status) {\n+    private void saveDownloadStatus(@NonNull DownloadStatus status, @NonNull DownloadRequest request) {\n         reportQueue.add(status);\n+        if (!status.isSuccessful() && !status.isCancelled()) {\n+            failedRequestsForReport.add(request);\n+        }\n         DBWriter.addDownloadStatus(status);\n     }\n \ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceInterfaceImpl.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceInterfaceImpl.java\nindex 384a6070ef..7b7e52e0ea 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceInterfaceImpl.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceInterfaceImpl.java\n@@ -16,6 +16,13 @@ public class DownloadServiceInterfaceImpl extends DownloadServiceInterface {\n     private static final String TAG = \"DownloadServiceInterface\";\n \n     public void download(Context context, boolean cleanupMedia, DownloadRequest... requests) {\n+        Intent intent = makeDownloadIntent(context, cleanupMedia, requests);\n+        if (intent != null) {\n+            ContextCompat.startForegroundService(context, intent);\n+        }\n+    }\n+\n+    public Intent makeDownloadIntent(Context context, boolean cleanupMedia, DownloadRequest... requests) {\n         ArrayList<DownloadRequest> requestsToSend = new ArrayList<>();\n         for (DownloadRequest request : requests) {\n             if (!isDownloadingFile(request.getSource())) {\n@@ -23,7 +30,7 @@ public void download(Context context, boolean cleanupMedia, DownloadRequest... r\n             }\n         }\n         if (requestsToSend.isEmpty()) {\n-            return;\n+            return null;\n         } else if (requestsToSend.size() > 100) {\n             if (BuildConfig.DEBUG) {\n                 throw new IllegalArgumentException(\"Android silently drops intent payloads that are too large\");\n@@ -38,7 +45,7 @@ public void download(Context context, boolean cleanupMedia, DownloadRequest... r\n         if (cleanupMedia) {\n             launchIntent.putExtra(DownloadService.EXTRA_CLEANUP_MEDIA, true);\n         }\n-        ContextCompat.startForegroundService(context, launchIntent);\n+        return launchIntent;\n     }\n \n     public void refreshAllFeeds(Context context, boolean initiatedByUser) {\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceNotification.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceNotification.java\nindex c06b0e31d3..6ba8348d65 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceNotification.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceNotification.java\n@@ -15,6 +15,7 @@\n import de.danoeh.antennapod.model.feed.FeedMedia;\n import de.danoeh.antennapod.core.util.gui.NotificationUtils;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n+import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n import de.danoeh.antennapod.ui.appstartintent.DownloadAuthenticationActivityStarter;\n import de.danoeh.antennapod.ui.appstartintent.MainActivityStarter;\n \n@@ -153,7 +154,8 @@ private String createFailedDownloadNotificationContent(List<DownloadStatus> stat\n      * user about the number of completed downloads. A report will only be\n      * created if there is at least one failed download excluding images\n      */\n-    public void updateReport(List<DownloadStatus> reportQueue, boolean showAutoDownloadReport) {\n+    public void updateReport(List<DownloadStatus> reportQueue, boolean showAutoDownloadReport,\n+                             List<DownloadRequest> failedRequests) {\n         // check if report should be created\n         boolean createReport = false;\n         int failedDownloads = 0;\n@@ -173,48 +175,68 @@ public void updateReport(List<DownloadStatus> reportQueue, boolean showAutoDownl\n             }\n         }\n \n-        if (createReport) {\n-            Log.d(TAG, \"Creating report\");\n+        if (!createReport) {\n+            Log.d(TAG, \"No report is created\");\n+            return;\n+        }\n+        Log.d(TAG, \"Creating report\");\n+        if (failedDownloads == 0) {\n+            createAutoDownloadReportNotification(reportQueue);\n+        } else {\n+            createDownloadFailedNotification(reportQueue, failedRequests);\n+        }\n+        Log.d(TAG, \"Download report notification was posted\");\n+    }\n \n-            // create notification object\n-            String channelId;\n-            int titleId;\n-            int iconId;\n-            int id;\n-            String content;\n-            PendingIntent intent;\n-            if (failedDownloads == 0) {\n-                // We are generating an auto-download report\n-                channelId = NotificationUtils.CHANNEL_ID_AUTO_DOWNLOAD;\n-                titleId = R.string.auto_download_report_title;\n-                iconId = R.drawable.ic_notification_new;\n-                intent = getAutoDownloadReportNotificationContentIntent(context);\n-                id = R.id.notification_auto_download_report;\n-                content = createAutoDownloadNotificationContent(reportQueue);\n-            } else {\n-                channelId = NotificationUtils.CHANNEL_ID_DOWNLOAD_ERROR;\n-                titleId = R.string.download_report_title;\n-                iconId = R.drawable.ic_notification_sync_error;\n-                intent = getReportNotificationContentIntent(context);\n-                id = R.id.notification_download_report;\n-                content = createFailedDownloadNotificationContent(reportQueue);\n-            }\n+    private void createAutoDownloadReportNotification(List<DownloadStatus> reportQueue) {\n+        PendingIntent intent = getAutoDownloadReportNotificationContentIntent(context);\n+        String content = createAutoDownloadNotificationContent(reportQueue);\n+        NotificationCompat.Builder builder = new NotificationCompat.Builder(context,\n+                NotificationUtils.CHANNEL_ID_AUTO_DOWNLOAD);\n+        builder.setTicker(context.getString(R.string.auto_download_report_title))\n+                .setContentTitle(context.getString(R.string.auto_download_report_title))\n+                .setContentText(content)\n+                .setStyle(new NotificationCompat.BigTextStyle().bigText(content))\n+                .setSmallIcon(R.drawable.ic_notification_new)\n+                .setContentIntent(intent)\n+                .setAutoCancel(true)\n+                .setVisibility(NotificationCompat.VISIBILITY_PUBLIC);\n+        NotificationManager nm = (NotificationManager) context.getSystemService(Context.NOTIFICATION_SERVICE);\n+        nm.notify(R.id.notification_auto_download_report, builder.build());\n+    }\n \n-            NotificationCompat.Builder builder = new NotificationCompat.Builder(context, channelId);\n-            builder.setTicker(context.getString(titleId))\n-                   .setContentTitle(context.getString(titleId))\n-                   .setContentText(content)\n-                   .setStyle(new NotificationCompat.BigTextStyle().bigText(content))\n-                   .setSmallIcon(iconId)\n-                   .setContentIntent(intent)\n-                   .setAutoCancel(true);\n-            builder.setVisibility(NotificationCompat.VISIBILITY_PUBLIC);\n-            NotificationManager nm = (NotificationManager) context.getSystemService(Context.NOTIFICATION_SERVICE);\n-            nm.notify(id, builder.build());\n-            Log.d(TAG, \"Download report notification was posted\");\n-        } else {\n-            Log.d(TAG, \"No report is created\");\n+    private void createDownloadFailedNotification(List<DownloadStatus> reportQueue,\n+                                                  List<DownloadRequest> failedRequests) {\n+        Intent retryIntent = DownloadServiceInterface.get().makeDownloadIntent(context,\n+                false, failedRequests.toArray(new DownloadRequest[0]));\n+        PendingIntent retryPendingIntent = null;\n+        if (retryIntent != null && Build.VERSION.SDK_INT >= 26) {\n+            retryPendingIntent = PendingIntent.getForegroundService(context, R.id.pending_intent_download_service_retry,\n+                    retryIntent, PendingIntent.FLAG_UPDATE_CURRENT | PendingIntent.FLAG_IMMUTABLE);\n+        } else if (retryIntent != null) {\n+            retryPendingIntent = PendingIntent.getService(context,\n+                    R.id.pending_intent_download_service_retry, retryIntent,\n+                    PendingIntent.FLAG_UPDATE_CURRENT\n+                            | (Build.VERSION.SDK_INT >= 23 ? PendingIntent.FLAG_IMMUTABLE : 0));\n         }\n+        PendingIntent intent = getReportNotificationContentIntent(context);\n+        String content = createFailedDownloadNotificationContent(reportQueue);\n+        NotificationCompat.Builder builder = new NotificationCompat.Builder(context,\n+                NotificationUtils.CHANNEL_ID_DOWNLOAD_ERROR);\n+        builder.setTicker(context.getString(R.string.download_report_title))\n+                .setContentTitle(context.getString(R.string.download_report_title))\n+                .setContentText(content)\n+                .setStyle(new NotificationCompat.BigTextStyle().bigText(content))\n+                .setSmallIcon(R.drawable.ic_notification_sync_error)\n+                .setContentIntent(intent)\n+                .setAutoCancel(true);\n+        if (retryPendingIntent != null) {\n+            builder.addAction(new NotificationCompat.Action(\n+                    R.drawable.ic_notification_sync, context.getString(R.string.retry_label), retryPendingIntent));\n+        }\n+        builder.setVisibility(NotificationCompat.VISIBILITY_PUBLIC);\n+        NotificationManager nm = (NotificationManager) context.getSystemService(Context.NOTIFICATION_SERVICE);\n+        nm.notify(R.id.notification_download_report, builder.build());\n     }\n \n     public void postAuthenticationNotification(final DownloadRequest downloadRequest) {\ndiff --git a/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterface.java b/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterface.java\nindex 54987a83e0..b5d0cd9914 100644\n--- a/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterface.java\n+++ b/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterface.java\n@@ -1,6 +1,7 @@\n package de.danoeh.antennapod.net.download.serviceinterface;\n \n import android.content.Context;\n+import android.content.Intent;\n \n public abstract class DownloadServiceInterface {\n     private static DownloadServiceInterface impl;\n@@ -15,6 +16,8 @@ public static void setImpl(DownloadServiceInterface impl) {\n \n     public abstract void download(Context context, boolean cleanupMedia, DownloadRequest... requests);\n \n+    public abstract Intent makeDownloadIntent(Context context, boolean cleanupMedia, DownloadRequest... requests);\n+\n     public abstract void refreshAllFeeds(Context context, boolean initiatedByUser);\n \n     public abstract void cancel(Context context, String url);\ndiff --git a/ui/app-start-intent/src/main/res/values/pending_intent.xml b/ui/app-start-intent/src/main/res/values/pending_intent.xml\nindex ed7e9b2cdc..c0864046cd 100644\n--- a/ui/app-start-intent/src/main/res/values/pending_intent.xml\n+++ b/ui/app-start-intent/src/main/res/values/pending_intent.xml\n@@ -1,6 +1,7 @@\n <?xml version=\"1.0\" encoding=\"utf-8\"?>\n <resources>\n     <item name=\"pending_intent_download_service_notification\" type=\"id\"/>\n+    <item name=\"pending_intent_download_service_retry\" type=\"id\"/>\n     <item name=\"pending_intent_download_service_auth\" type=\"id\"/>\n     <item name=\"pending_intent_download_service_report\" type=\"id\"/>\n     <item name=\"pending_intent_download_service_autodownload_report\" type=\"id\"/>\n", "test_patch": "diff --git a/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterfaceStub.java b/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterfaceStub.java\nindex 251c59c61e..9477464858 100644\n--- a/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterfaceStub.java\n+++ b/net/download/service-interface/src/main/java/de/danoeh/antennapod/net/download/serviceinterface/DownloadServiceInterfaceStub.java\n@@ -1,12 +1,17 @@\n package de.danoeh.antennapod.net.download.serviceinterface;\n \n import android.content.Context;\n+import android.content.Intent;\n \n public class DownloadServiceInterfaceStub extends DownloadServiceInterface {\n \n     public void download(Context context, boolean cleanupMedia, DownloadRequest... requests) {\n     }\n \n+    public Intent makeDownloadIntent(Context context, boolean cleanupMedia, DownloadRequest... requests) {\n+        return null;\n+    }\n+\n     public void refreshAllFeeds(Context context, boolean initiatedByUser) {\n     }\n \n", "problem_statement": "Add retry action to error notifications\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n2.5.1\n\n### Where did you get the app from\n\nF-Droid\n\n### Problem you may be having, or feature you want\n\nSometimes the download of new episodes or episode lists fails. It requires several clicks on the notification and the activity to retry the download.\n\n### Suggested solution\n\nAdd a [notification action ](https://developer.android.com/guide/topics/ui/notifiers/notifications#Actions)to all error notifications, that retries the failed downloads.\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "Instead of a manual retry button, I think it would be better if AntennaPod retried automatically. Issue #1250 already covers this.\nI agree that automatic retries are the better option for the first few times, but you probably don't want to retry forever, right? At some point you'll show an error notification that could have this action.\nRelated: #2078\nYeah it would be nice if it auto retried.\nI don't know why, but I constantly am getting notifications for fetch errors for Antennapod. It's really annoying to have it keep popping up. At least once a day, but moreso a few times a day.", "created_at": "2023-02-19T12:19:12Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6332, "instance_id": "AntennaPod__AntennaPod-6332", "issue_numbers": ["6300"], "base_commit": "c98194f519c66e5af1575b1c6ffac5af16594141", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadService.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadService.java\nindex a18d7d1d04..f4839780f2 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadService.java\n@@ -461,6 +461,9 @@ private void enqueueAll(Intent intent) {\n             if (feed.getPreferences().getKeepUpdated()) {\n                 DownloadRequest.Builder builder = DownloadRequestCreator.create(feed);\n                 builder.withInitiatedByUser(initiatedByUser);\n+                if (feed.hasLastUpdateFailed()) {\n+                    builder.setForce(true);\n+                }\n                 addNewRequest(builder.build());\n             }\n         }\n", "test_patch": "", "problem_statement": "\"Last refresh failed\" remains even after successfully refreshing all episodes.\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n2.7.1\n\n### Where did you get the app from\n\nF-Droid\n\n### Android version\n\nLineageOS 19\n\n### Device model\n\nXiaomi A2 Lite (xiaomi_daisy)\n\n### First occurred\n\nabout a year ago\n\n### Steps to reproduce\n\n* Subscribe to multiple podcasts\r\n* Somehow get the \"Last refresh failed. Tap to view details\" for one or more of the podcasts.\r\n(also visible as a red circle next to podcast name)\r\n* Open  <img src=\"https://www.iconsdb.com/icons/preview/white/rss-xxl.png\" width=\"12\" /> Episodes\r\n* Pull down in order to refresh the whole feed\r\n* All feeds update just fine\r\n* Notification about failed refresh is still there :thinking: \n\n### Expected behaviour\n\n\"refresh failed\" notifications for successfully refreshed podcasts should disappear.\n\n### Current behaviour\n\nNotifications persist.\r\n\r\nHowever, if you open the individual podcast and pull-down-to-refresh there, **then** the notification goes away.\r\nSo user has to \"refresh\" podcasts individually instead of being able to do a single all-episode refresh in order to remove notifications.\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2023-02-19T11:07:57Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6328, "instance_id": "AntennaPod__AntennaPod-6328", "issue_numbers": ["6303"], "base_commit": "caf49c5da8a2f541b099ff32c15a7e96e1c557e8", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/UserInterfacePreferencesFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/UserInterfacePreferencesFragment.java\nindex caf5559641..66f592af26 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/UserInterfacePreferencesFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/UserInterfacePreferencesFragment.java\n@@ -5,18 +5,19 @@\n import android.os.Bundle;\n import android.widget.ListView;\n import androidx.appcompat.app.AlertDialog;\n-import com.google.android.material.snackbar.Snackbar;\n-import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n import androidx.core.app.ActivityCompat;\n+import androidx.preference.Preference;\n import androidx.preference.PreferenceFragmentCompat;\n+import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n+import com.google.android.material.snackbar.Snackbar;\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.PreferenceActivity;\n-import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import de.danoeh.antennapod.dialog.DrawerPreferencesDialog;\n import de.danoeh.antennapod.dialog.FeedSortDialog;\n import de.danoeh.antennapod.dialog.SubscriptionsFilterDialog;\n import de.danoeh.antennapod.event.PlayerStatusEvent;\n import de.danoeh.antennapod.event.UnreadItemsUpdateEvent;\n+import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import org.greenrobot.eventbus.EventBus;\n \n import java.util.List;\n@@ -37,22 +38,16 @@ public void onStart() {\n     }\n \n     private void setupInterfaceScreen() {\n-        findPreference(UserPreferences.PREF_THEME)\n-                .setOnPreferenceChangeListener(\n-                        (preference, newValue) -> {\n-                            ActivityCompat.recreate(getActivity());\n-                            return true;\n-                        });\n-\n+        Preference.OnPreferenceChangeListener restartApp = (preference, newValue) -> {\n+            ActivityCompat.recreate(getActivity());\n+            return true;\n+        };\n+        findPreference(UserPreferences.PREF_THEME).setOnPreferenceChangeListener(restartApp);\n+        findPreference(UserPreferences.PREF_THEME_BLACK).setOnPreferenceChangeListener(restartApp);\n+        findPreference(UserPreferences.PREF_TINTED_COLORS).setOnPreferenceChangeListener(restartApp);\n         if (Build.VERSION.SDK_INT < 31) {\n             findPreference(UserPreferences.PREF_TINTED_COLORS).setVisible(false);\n         }\n-        findPreference(UserPreferences.PREF_TINTED_COLORS)\n-                .setOnPreferenceChangeListener(\n-                        (preference, newValue) -> {\n-                            ActivityCompat.recreate(getActivity());\n-                            return true;\n-                        });\n \n         findPreference(UserPreferences.PREF_SHOW_TIME_LEFT)\n                 .setOnPreferenceChangeListener(\ndiff --git a/app/src/main/java/de/danoeh/antennapod/preferences/PreferenceUpgrader.java b/app/src/main/java/de/danoeh/antennapod/preferences/PreferenceUpgrader.java\nindex e093c067d7..79d06de599 100644\n--- a/app/src/main/java/de/danoeh/antennapod/preferences/PreferenceUpgrader.java\n+++ b/app/src/main/java/de/danoeh/antennapod/preferences/PreferenceUpgrader.java\n@@ -133,5 +133,13 @@ private static void upgrade(int oldVersion, Context context) {\n                         \"\" + UserPreferences.EPISODE_CACHE_SIZE_UNLIMITED).apply();\n             }\n         }\n+        if (oldVersion < 3010000) {\n+            if (prefs.getString(UserPreferences.PREF_THEME, \"system\").equals(\"2\")) {\n+                prefs.edit()\n+                        .putString(UserPreferences.PREF_THEME, \"1\")\n+                        .putBoolean(UserPreferences.PREF_THEME_BLACK, true)\n+                        .apply();\n+            }\n+        }\n     }\n }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/preferences/ThemePreference.java b/app/src/main/java/de/danoeh/antennapod/preferences/ThemePreference.java\nnew file mode 100644\nindex 0000000000..30cbeb5234\n--- /dev/null\n+++ b/app/src/main/java/de/danoeh/antennapod/preferences/ThemePreference.java\n@@ -0,0 +1,53 @@\n+package de.danoeh.antennapod.preferences;\n+\n+import android.content.Context;\n+import android.util.AttributeSet;\n+import androidx.cardview.widget.CardView;\n+import androidx.preference.Preference;\n+import androidx.preference.PreferenceViewHolder;\n+import com.google.android.material.elevation.SurfaceColors;\n+import de.danoeh.antennapod.R;\n+import de.danoeh.antennapod.databinding.ThemePreferenceBinding;\n+import de.danoeh.antennapod.storage.preferences.UserPreferences;\n+\n+public class ThemePreference extends Preference {\n+    ThemePreferenceBinding viewBinding;\n+\n+    public ThemePreference(Context context) {\n+        super(context);\n+        setLayoutResource(R.layout.theme_preference);\n+    }\n+\n+    public ThemePreference(Context context, AttributeSet attrs) {\n+        super(context, attrs);\n+        setLayoutResource(R.layout.theme_preference);\n+    }\n+\n+    @Override\n+    public void onBindViewHolder(PreferenceViewHolder holder) {\n+        super.onBindViewHolder(holder);\n+        viewBinding = ThemePreferenceBinding.bind(holder.itemView);\n+        updateUi();\n+    }\n+\n+    void updateThemeCard(CardView card, UserPreferences.ThemePreference theme) {\n+        float density = getContext().getResources().getDisplayMetrics().density;\n+        int surfaceColor = SurfaceColors.getColorForElevation(getContext(), 1 * density);\n+        int surfaceColorActive = SurfaceColors.getColorForElevation(getContext(), 32 * density);\n+        UserPreferences.ThemePreference activeTheme = UserPreferences.getTheme();\n+        card.setCardBackgroundColor(theme == activeTheme ? surfaceColorActive : surfaceColor);\n+        card.setOnClickListener(v -> {\n+            UserPreferences.setTheme(theme);\n+            if (getOnPreferenceChangeListener() != null) {\n+                getOnPreferenceChangeListener().onPreferenceChange(this, UserPreferences.getTheme());\n+            }\n+            updateUi();\n+        });\n+    }\n+\n+    void updateUi() {\n+        updateThemeCard(viewBinding.themeSystemCard, UserPreferences.ThemePreference.SYSTEM);\n+        updateThemeCard(viewBinding.themeLightCard, UserPreferences.ThemePreference.LIGHT);\n+        updateThemeCard(viewBinding.themeDarkCard, UserPreferences.ThemePreference.DARK);\n+    }\n+}\ndiff --git a/app/src/main/res/drawable-nodpi/theme_preview_dark.png b/app/src/main/res/drawable-nodpi/theme_preview_dark.png\nnew file mode 100644\nindex 0000000000..b4e1e0376a\nBinary files /dev/null and b/app/src/main/res/drawable-nodpi/theme_preview_dark.png differ\ndiff --git a/app/src/main/res/drawable-nodpi/theme_preview_light.png b/app/src/main/res/drawable-nodpi/theme_preview_light.png\nnew file mode 100644\nindex 0000000000..39ef47b4f6\nBinary files /dev/null and b/app/src/main/res/drawable-nodpi/theme_preview_light.png differ\ndiff --git a/app/src/main/res/drawable-nodpi/theme_preview_system.png b/app/src/main/res/drawable-nodpi/theme_preview_system.png\nnew file mode 100644\nindex 0000000000..cc6403a98d\nBinary files /dev/null and b/app/src/main/res/drawable-nodpi/theme_preview_system.png differ\ndiff --git a/app/src/main/res/layout/theme_preference.xml b/app/src/main/res/layout/theme_preference.xml\nnew file mode 100644\nindex 0000000000..32a7ed1e8b\n--- /dev/null\n+++ b/app/src/main/res/layout/theme_preference.xml\n@@ -0,0 +1,123 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<LinearLayout\n+    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"wrap_content\"\n+    android:orientation=\"horizontal\"\n+    android:background=\"?android:attr/windowBackground\"\n+    android:gravity=\"top\"\n+    android:padding=\"8dp\">\n+\n+    <androidx.cardview.widget.CardView\n+        android:id=\"@+id/themeSystemCard\"\n+        android:layout_width=\"0dp\"\n+        android:layout_height=\"wrap_content\"\n+        android:layout_margin=\"4dp\"\n+        android:clickable=\"true\"\n+        android:foreground=\"?android:attr/selectableItemBackground\"\n+        android:layout_weight=\"1\"\n+        app:cardElevation=\"0dp\"\n+        app:cardCornerRadius=\"16dp\"\n+        app:contentPadding=\"16dp\">\n+\n+        <LinearLayout\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"wrap_content\"\n+            android:orientation=\"vertical\"\n+            android:gravity=\"center\">\n+\n+            <ImageView\n+                android:layout_width=\"match_parent\"\n+                android:layout_height=\"wrap_content\"\n+                android:adjustViewBounds=\"true\"\n+                android:src=\"@drawable/theme_preview_system\" />\n+\n+            <TextView\n+                android:id=\"@+id/themeSystemRadio\"\n+                android:layout_width=\"wrap_content\"\n+                android:layout_height=\"wrap_content\"\n+                android:layout_marginTop=\"4dp\"\n+                android:textColor=\"?android:attr/textColorPrimary\"\n+                android:text=\"@string/pref_theme_title_automatic\"\n+                android:clickable=\"false\" />\n+\n+        </LinearLayout>\n+\n+    </androidx.cardview.widget.CardView>\n+\n+    <androidx.cardview.widget.CardView\n+        android:id=\"@+id/themeLightCard\"\n+        android:layout_width=\"0dp\"\n+        android:layout_height=\"wrap_content\"\n+        android:layout_margin=\"4dp\"\n+        android:clickable=\"true\"\n+        android:foreground=\"?android:attr/selectableItemBackground\"\n+        android:layout_weight=\"1\"\n+        app:cardElevation=\"0dp\"\n+        app:cardCornerRadius=\"16dp\"\n+        app:contentPadding=\"16dp\">\n+\n+        <LinearLayout\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"wrap_content\"\n+            android:orientation=\"vertical\"\n+            android:gravity=\"center\">\n+\n+            <ImageView\n+                android:layout_width=\"match_parent\"\n+                android:layout_height=\"wrap_content\"\n+                android:adjustViewBounds=\"true\"\n+                android:src=\"@drawable/theme_preview_light\" />\n+\n+            <TextView\n+                android:id=\"@+id/themeLightRadio\"\n+                android:layout_width=\"wrap_content\"\n+                android:layout_height=\"wrap_content\"\n+                android:layout_marginTop=\"4dp\"\n+                android:textColor=\"?android:attr/textColorPrimary\"\n+                android:text=\"@string/pref_theme_title_light\"\n+                android:clickable=\"false\" />\n+\n+        </LinearLayout>\n+\n+    </androidx.cardview.widget.CardView>\n+\n+    <androidx.cardview.widget.CardView\n+        android:id=\"@+id/themeDarkCard\"\n+        android:layout_width=\"0dp\"\n+        android:layout_height=\"wrap_content\"\n+        android:layout_margin=\"4dp\"\n+        android:clickable=\"true\"\n+        android:foreground=\"?android:attr/selectableItemBackground\"\n+        android:layout_weight=\"1\"\n+        app:cardElevation=\"0dp\"\n+        app:cardCornerRadius=\"16dp\"\n+        app:contentPadding=\"16dp\">\n+\n+        <LinearLayout\n+            android:layout_width=\"match_parent\"\n+            android:layout_height=\"wrap_content\"\n+            android:orientation=\"vertical\"\n+            android:gravity=\"center\">\n+\n+            <ImageView\n+                android:layout_width=\"match_parent\"\n+                android:layout_height=\"wrap_content\"\n+                android:adjustViewBounds=\"true\"\n+                android:src=\"@drawable/theme_preview_dark\" />\n+\n+            <TextView\n+                android:id=\"@+id/themeDarkCardRadio\"\n+                android:layout_width=\"wrap_content\"\n+                android:layout_height=\"wrap_content\"\n+                android:layout_marginTop=\"4dp\"\n+                android:textColor=\"?android:attr/textColorPrimary\"\n+                android:text=\"@string/pref_theme_title_dark\"\n+                android:clickable=\"false\" />\n+\n+        </LinearLayout>\n+\n+    </androidx.cardview.widget.CardView>\n+\n+</LinearLayout>\ndiff --git a/app/src/main/res/xml/preferences_user_interface.xml b/app/src/main/res/xml/preferences_user_interface.xml\nindex f11b89be73..ed3f5777af 100644\n--- a/app/src/main/res/xml/preferences_user_interface.xml\n+++ b/app/src/main/res/xml/preferences_user_interface.xml\n@@ -4,13 +4,13 @@\n         xmlns:search=\"http://schemas.android.com/apk/com.bytehamster.lib.preferencesearch\">\n \n     <PreferenceCategory android:title=\"@string/appearance\">\n-        <de.danoeh.antennapod.preferences.MaterialListPreference\n-                android:entryValues=\"@array/theme_values\"\n-                android:entries=\"@array/theme_options\"\n-                android:title=\"@string/pref_set_theme_title\"\n-                android:key=\"prefTheme\"\n-                android:summary=\"@string/pref_set_theme_sum\"\n-                android:defaultValue=\"system\"/>\n+        <de.danoeh.antennapod.preferences.ThemePreference\n+                android:key=\"prefTheme\" />\n+        <SwitchPreferenceCompat\n+                android:title=\"@string/pref_black_theme_title\"\n+                android:key=\"prefThemeBlack\"\n+                android:summary=\"@string/pref_black_theme_message\"\n+                android:defaultValue=\"false\" />\n         <SwitchPreferenceCompat\n                 android:title=\"@string/pref_tinted_theme_title\"\n                 android:key=\"prefTintedColors\"\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/preferences/ThemeSwitcher.java b/core/src/main/java/de/danoeh/antennapod/core/preferences/ThemeSwitcher.java\nindex b7e4934f51..afe814fcb2 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/preferences/ThemeSwitcher.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/preferences/ThemeSwitcher.java\n@@ -59,12 +59,15 @@ private static UserPreferences.ThemePreference readThemeValue(Context context) {\n         if (theme == UserPreferences.ThemePreference.SYSTEM) {\n             int nightMode = context.getResources().getConfiguration().uiMode & Configuration.UI_MODE_NIGHT_MASK;\n             if (nightMode == Configuration.UI_MODE_NIGHT_YES) {\n-                return UserPreferences.ThemePreference.DARK;\n+                theme = UserPreferences.ThemePreference.DARK;\n             } else {\n-                return UserPreferences.ThemePreference.LIGHT;\n+                theme = UserPreferences.ThemePreference.LIGHT;\n \n             }\n         }\n+        if (theme == UserPreferences.ThemePreference.DARK && UserPreferences.getIsBlackTheme()) {\n+            theme = UserPreferences.ThemePreference.BLACK;\n+        }\n         return theme;\n     }\n }\ndiff --git a/core/src/main/res/values/arrays.xml b/core/src/main/res/values/arrays.xml\nindex b08541771e..090d5e2e45 100644\n--- a/core/src/main/res/values/arrays.xml\n+++ b/core/src/main/res/values/arrays.xml\n@@ -135,20 +135,6 @@\n         <item>-2</item>\n     </string-array>\n \n-    <string-array name=\"theme_options\">\n-        <item>@string/pref_theme_title_use_system</item>\n-        <item>@string/pref_theme_title_light</item>\n-        <item>@string/pref_theme_title_dark</item>\n-        <item>@string/pref_theme_title_trueblack</item>\n-    </string-array>\n-\n-    <string-array name=\"theme_values\">\n-        <item>system</item>\n-        <item>0</item>\n-        <item>1</item>\n-        <item>2</item>\n-    </string-array>\n-\n     <string-array name=\"nav_drawer_titles\">\n         <item>@string/home_label</item>\n         <item>@string/queue_label</item>\ndiff --git a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\nindex 8d9b099fcd..c7758d40e2 100644\n--- a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n+++ b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n@@ -48,6 +48,7 @@ private UserPreferences(){}\n \n     // User Interface\n     public static final String PREF_THEME = \"prefTheme\";\n+    public static final String PREF_THEME_BLACK = \"prefThemeBlack\";\n     public static final String PREF_TINTED_COLORS = \"prefTintedColors\";\n     public static final String PREF_HIDDEN_DRAWER_ITEMS = \"prefHiddenDrawerItems\";\n     public static final String PREF_DRAWER_FEED_ORDER = \"prefDrawerFeedOrder\";\n@@ -159,19 +160,35 @@ public enum ThemePreference {\n         LIGHT, DARK, BLACK, SYSTEM\n     }\n \n+    public static void setTheme(ThemePreference theme) {\n+        switch (theme) {\n+            case LIGHT:\n+                prefs.edit().putString(PREF_THEME, \"0\").apply();\n+                break;\n+            case DARK:\n+                prefs.edit().putString(PREF_THEME, \"1\").apply();\n+                break;\n+            default:\n+                prefs.edit().putString(PREF_THEME, \"system\").apply();\n+                break;\n+        }\n+    }\n+\n     public static ThemePreference getTheme() {\n         switch (prefs.getString(PREF_THEME, \"system\")) {\n             case \"0\":\n                 return ThemePreference.LIGHT;\n             case \"1\":\n                 return ThemePreference.DARK;\n-            case \"2\":\n-                return ThemePreference.BLACK;\n             default:\n                 return ThemePreference.SYSTEM;\n         }\n     }\n \n+    public static boolean getIsBlackTheme() {\n+        return prefs.getBoolean(PREF_THEME_BLACK, false);\n+    }\n+\n     public static boolean getIsThemeColorTinted() {\n         return Build.VERSION.SDK_INT >= 31 && prefs.getBoolean(PREF_TINTED_COLORS, false);\n     }\ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex 40015630fa..db91c43ae5 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -432,8 +432,9 @@\n     <string name=\"pref_mobileUpdate_streaming\">Streaming</string>\n     <string name=\"user_interface_label\">User Interface</string>\n     <string name=\"user_interface_sum\">Appearance, Subscriptions, Lockscreen</string>\n-    <string name=\"pref_set_theme_title\">Select Theme</string>\n-    <string name=\"pref_tinted_theme_title\">Use Tinted Colors</string>\n+    <string name=\"pref_black_theme_title\">Full Black</string>\n+    <string name=\"pref_black_theme_message\">Use full black for the dark theme</string>\n+    <string name=\"pref_tinted_theme_title\">Tinted Colors</string>\n     <string name=\"pref_tinted_theme_message\">Tint app colors based on the background image</string>\n     <string name=\"pref_nav_drawer_items_title\">Set Navigation Drawer items</string>\n     <string name=\"pref_nav_drawer_items_sum\">Change which items appear in the navigation drawer.</string>\n@@ -441,7 +442,6 @@\n     <string name=\"pref_nav_drawer_feed_order_sum\">Change the order of your subscriptions</string>\n     <string name=\"pref_nav_drawer_feed_counter_title\">Set Subscription Counter</string>\n     <string name=\"pref_nav_drawer_feed_counter_sum\">Change the information displayed by the subscription counter. Also affects the sorting of subscriptions if \\'Subscription Order\\' is set to \\'Counter\\'.</string>\n-    <string name=\"pref_set_theme_sum\">Change the appearance of AntennaPod.</string>\n     <string name=\"pref_automatic_download_title\">Automatic Download</string>\n     <string name=\"pref_automatic_download_sum\">Configure the automatic download of episodes.</string>\n     <string name=\"pref_autodl_wifi_filter_title\">Enable Wi-Fi filter</string>\n@@ -455,10 +455,9 @@\n     <string name=\"pref_episode_cover_summary\">Use the episode specific cover in lists whenever available. If unchecked, the app will always use the podcast cover image.</string>\n     <string name=\"pref_show_remain_time_title\">Show Remaining Time</string>\n     <string name=\"pref_show_remain_time_summary\">Display remaining time of episodes when checked. If unchecked, display total duration of episodes.</string>\n-    <string name=\"pref_theme_title_use_system\">Use system theme</string>\n+    <string name=\"pref_theme_title_automatic\">Automatic</string>\n     <string name=\"pref_theme_title_light\">Light</string>\n     <string name=\"pref_theme_title_dark\">Dark</string>\n-    <string name=\"pref_theme_title_trueblack\">Black (AMOLED ready)</string>\n     <string name=\"pref_episode_cache_unlimited\">Unlimited</string>\n     <string name=\"pref_playback_speed_sum\">Customize the speeds available for variable speed playback</string>\n     <string name=\"pref_feed_playback_speed_sum\">The speed to use when starting audio playback for episodes in this podcast</string>\n", "test_patch": "diff --git a/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java b/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java\nindex 909b7a5a2d..b790bc005c 100644\n--- a/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java\n+++ b/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java\n@@ -3,32 +3,29 @@\n import android.content.Intent;\n import android.content.SharedPreferences;\n import android.content.res.Resources;\n-\n import androidx.annotation.StringRes;\n import androidx.preference.PreferenceManager;\n import androidx.test.espresso.matcher.RootMatchers;\n import androidx.test.filters.LargeTest;\n import androidx.test.rule.ActivityTestRule;\n-\n-import de.danoeh.antennapod.core.storage.EpisodeCleanupAlgorithmFactory;\n-import org.awaitility.Awaitility;\n-import org.junit.Before;\n-import org.junit.Rule;\n-import org.junit.Test;\n-\n-import java.util.Arrays;\n-import java.util.concurrent.TimeUnit;\n-\n import de.danoeh.antennapod.R;\n import de.danoeh.antennapod.activity.PreferenceActivity;\n-import de.danoeh.antennapod.storage.preferences.UserPreferences;\n-import de.danoeh.antennapod.storage.preferences.UserPreferences.EnqueueLocation;\n import de.danoeh.antennapod.core.storage.APCleanupAlgorithm;\n import de.danoeh.antennapod.core.storage.APNullCleanupAlgorithm;\n import de.danoeh.antennapod.core.storage.APQueueCleanupAlgorithm;\n import de.danoeh.antennapod.core.storage.EpisodeCleanupAlgorithm;\n+import de.danoeh.antennapod.core.storage.EpisodeCleanupAlgorithmFactory;\n import de.danoeh.antennapod.core.storage.ExceptFavoriteCleanupAlgorithm;\n+import de.danoeh.antennapod.storage.preferences.UserPreferences;\n+import de.danoeh.antennapod.storage.preferences.UserPreferences.EnqueueLocation;\n import de.test.antennapod.EspressoTestUtils;\n+import org.awaitility.Awaitility;\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+\n+import java.util.Arrays;\n+import java.util.concurrent.TimeUnit;\n \n import static androidx.test.espresso.Espresso.onData;\n import static androidx.test.espresso.Espresso.onView;\n@@ -77,22 +74,6 @@ public void setUp() {\n         UserPreferences.init(activityTestRule.getActivity());\n     }\n \n-    @Test\n-    public void testSwitchTheme() {\n-        final UserPreferences.ThemePreference theme = UserPreferences.getTheme();\n-        int otherThemeText;\n-        if (theme == UserPreferences.ThemePreference.DARK) {\n-            otherThemeText = R.string.pref_theme_title_light;\n-        } else {\n-            otherThemeText = R.string.pref_theme_title_dark;\n-        }\n-        clickPreference(R.string.user_interface_label);\n-        clickPreference(R.string.pref_set_theme_title);\n-        onView(withText(otherThemeText)).perform(click());\n-        Awaitility.await().atMost(1000, MILLISECONDS)\n-                .until(() -> UserPreferences.getTheme() != theme);\n-    }\n-\n     @Test\n     public void testEnablePersistentPlaybackControls() {\n         final boolean persistNotify = UserPreferences.isPersistNotify();\n", "problem_statement": "Theme setting: 'True black mode (AMOLED)' as checkbox affecting 'Automatic' and 'Dark' options\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n2.7.1\n\n### Where did you get the app from\n\nGoogle Play\n\n### Problem you may be having, or feature you want\n\nWhen setting the theme of the app to follow the device settings, antennapod applies the dark theme and not the black amoled theme. \n\n### Suggested solution\n\nGive us the option to select preferred dark theme. For reference, Newpipe has a similar option where the preferred night theme would apply once the phone's dark theme is enabled. \n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "I like the approach that Mastodon takes: three options (automatic, light, dark) and a checkbox 'True black mode':\r\n![Imagepipe_0](https://user-images.githubusercontent.com/11229646/219805098-dca4b150-cac8-4892-a0f6-63e2ebf675ac.jpg)\r\n\r\nFor AntennaPod, I would change the string to `True black mode (AMOLED)`\nIs this really worth yet another setting?\r\n\r\n> For AntennaPod, I would change the string to True black mode (AMOLED)\r\n\r\nMentioning AMOLED is actually quite misleading here because it makes people think that they can save battery (while there is basically no difference between dark and black).\n> Is this really worth yet another setting?\r\n\r\nIt's not another setting. It's changing an already existing setting (it now is a radio button, should be changed into a checkbox).\r\n\r\n> Mentioning AMOLED is actually quite misleading here because it makes people think that they can save battery (while there is basically no difference between dark and black).\r\n\r\nFair enough. Then let's use the exact same string as Mastodon: `True black mode`", "created_at": "2023-02-18T11:22:11Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6327, "instance_id": "AntennaPod__AntennaPod-6327", "issue_numbers": ["6308"], "base_commit": "5b6fe580e070976c9a08dc202c906ca3bd31728c", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/fragment/ItemDescriptionFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/ItemDescriptionFragment.java\nindex 8a7d2432a1..c5a8b6f2ac 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/ItemDescriptionFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/ItemDescriptionFragment.java\n@@ -1,6 +1,7 @@\n package de.danoeh.antennapod.fragment;\n \n import android.app.Activity;\n+import android.content.Context;\n import android.content.SharedPreferences;\n import android.os.Bundle;\n import android.util.Log;\n@@ -86,6 +87,10 @@ private void load() {\n         if (webViewLoader != null) {\n             webViewLoader.dispose();\n         }\n+        Context context = getContext();\n+        if (context == null) {\n+            return;\n+        }\n         webViewLoader = Maybe.<String>create(emitter -> {\n             Playable media = controller.getMedia();\n             if (media == null) {\n@@ -100,7 +105,7 @@ private void load() {\n                 DBReader.loadDescriptionOfFeedItem(feedMedia.getItem());\n             }\n             ShownotesCleaner shownotesCleaner = new ShownotesCleaner(\n-                    getActivity(), media.getDescription(), media.getDuration());\n+                    context, media.getDescription(), media.getDuration());\n             emitter.onSuccess(shownotesCleaner.processShownotes());\n         })\n                 .subscribeOn(Schedulers.io())\n", "test_patch": "", "problem_statement": "Crash while playing\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.0.0-beta4\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n11\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\nListen to episode \n\n### Expected behaviour\n\n_No response_\n\n### Current behaviour\n\n_No response_\n\n### Logs\n\n## Crash info\r\nTime: 31-01-2023 23:21:59\r\n\r\n## StackTrace\r\n```\r\njava.lang.NullPointerException: Attempt to invoke virtual method 'java.lang.String android.content.Context.getString(int)' on a null object reference\r\n\tat de.danoeh.antennapod.core.util.gui.ShownotesCleaner.<init>(SourceFile:51)\r\n\tat de.danoeh.antennapod.fragment.ItemDescriptionFragment.lambda$load$2(SourceFile:103)\r\n\tat de.danoeh.antennapod.fragment.ItemDescriptionFragment.lambda$load$2$ItemDescriptionFragment(Unknown Source:0)\r\n\tat de.danoeh.antennapod.fragment.-$$Lambda$ItemDescriptionFragment$VTYcu6WL614WEeJ0mmrJjNYwAWc.subscribe(Unknown Source:2)\r\n\tat io.reactivex.internal.operators.maybe.MaybeCreate.subscribeActual(SourceFile:45)\r\n\tat io.reactivex.Maybe.subscribe(SourceFile:4262)\r\n\tat io.reactivex.internal.operators.maybe.MaybeSubscribeOn$SubscribeTask.run(SourceFile:54)\r\n\tat io.reactivex.Scheduler$DisposeTask.run(SourceFile:578)\r\n\tat io.reactivex.internal.schedulers.ScheduledRunnable.run(SourceFile:66)\r\n\tat io.reactivex.internal.schedulers.ScheduledRunnable.call(SourceFile:57)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:301)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:641)\r\n\tat java.lang.Thread.run(Thread.java:923)\r\n```\n", "hints_text": "Does this happen all the time or just once?\r\n\r\nRelated: #4453\nI've noticed that since one of the recent versions I regularly have to press play again as an episode is suddenly paused. It does rewind a few seconds (or the latest position wasn't saved). Whether it's a crash each time or not I don't know, as I mostly listen while cycling nowadays. This time I happened to be in the elevator and checked the bug page. Next time it happens I can (stop and) check.\n> I've noticed that since one of the recent versions I regularly have to press play again as an episode is suddenly paused.\r\n\r\nYeah, that's a problem in beta4. But beta5 should already be available through Google Play.\n> beta5 should already be available through Google Play\n\nIt seems I was updated overnight \ud83d\ude03\n\nDo I sense correctly that this crash is (probably) unrelated to the other pauses?\nYes, probably unrelated to the background service stopping.", "created_at": "2023-02-18T10:11:05Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6321, "instance_id": "AntennaPod__AntennaPod-6321", "issue_numbers": ["6317"], "base_commit": "22e6a0c40f3b551cd1ad89e86e11a09242e418d1", "patch": "diff --git a/playback/cast/build.gradle b/playback/cast/build.gradle\nindex 64c16eb267..b2aefddf22 100644\n--- a/playback/cast/build.gradle\n+++ b/playback/cast/build.gradle\n@@ -15,5 +15,5 @@ dependencies {\n     annotationProcessor \"org.greenrobot:eventbus-annotation-processor:$eventbusVersion\"\n \n     playApi 'androidx.mediarouter:mediarouter:1.2.5'\n-    playApi 'com.google.android.gms:play-services-cast-framework:20.0.0'\n+    playApi 'com.google.android.gms:play-services-cast-framework:21.2.0'\n }\ndiff --git a/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastOptionsProvider.java b/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastOptionsProvider.java\nindex 37885bdd03..cdea61c393 100644\n--- a/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastOptionsProvider.java\n+++ b/playback/cast/src/play/java/de/danoeh/antennapod/playback/cast/CastOptionsProvider.java\n@@ -2,7 +2,6 @@\n \n import android.content.Context;\n import androidx.annotation.NonNull;\n-import com.google.android.gms.cast.CastMediaControlIntent;\n import com.google.android.gms.cast.framework.CastOptions;\n import com.google.android.gms.cast.framework.OptionsProvider;\n import com.google.android.gms.cast.framework.SessionProvider;\n@@ -15,7 +14,7 @@ public class CastOptionsProvider implements OptionsProvider {\n     @NonNull\n     public CastOptions getCastOptions(@NonNull Context context) {\n         return new CastOptions.Builder()\n-            .setReceiverApplicationId(CastMediaControlIntent.DEFAULT_MEDIA_RECEIVER_APPLICATION_ID)\n+            .setReceiverApplicationId(\"BEBC1DB1\")\n             .build();\n     }\n \n", "test_patch": "", "problem_statement": "Crash when casting\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.0.0-beta 5\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\nI just tested casting to my Android TV in 3.0 builds for the first time, which resulted in a crash - stacktrace below.\r\nMore precisely, the TV did go into casting mode, but playback never started.\n\n### Expected behaviour\n\n_No response_\n\n### Current behaviour\n\n_No response_\n\n### Logs\n\n## Environment\r\nAndroid version: 12\r\nOS version: 4.9.292-gab4493f31457-ab8272301\r\nAntennaPod version: 3.0.0-beta5\r\nModel: Pixel 3a\r\nDevice: sargo\r\nProduct: sargo\r\n\r\n## Crash info\r\nTime: 12-02-2023 21:22:23\r\nAntennaPod version: 3.0.0-beta5\r\n\r\n## StackTrace\r\n```\r\njava.lang.IllegalArgumentException: de.danoeh.antennapod: Targeting S+ (version 31 and above) requires that one of FLAG_IMMUTABLE or FLAG_MUTABLE be specified when creating a PendingIntent.\r\nStrongly consider using FLAG_IMMUTABLE, only use FLAG_MUTABLE if some functionality depends on the PendingIntent being mutable, e.g. if it needs to be used with inline replies or bubbles.\r\n\tat android.app.PendingIntent.checkFlags(PendingIntent.java:375)\r\n\tat android.app.PendingIntent.getBroadcastAsUser(PendingIntent.java:645)\r\n\tat android.app.PendingIntent.getBroadcast(PendingIntent.java:632)\r\n\tat com.google.android.gms.internal.cast.zzch.zzb(SourceFile:1)\r\n\tat com.google.android.gms.cast.framework.media.internal.zzp.zzb(SourceFile:10)\r\n\tat com.google.android.gms.cast.framework.CastSession.zzi(SourceFile:11)\r\n\tat com.google.android.gms.cast.framework.zzk.onComplete(SourceFile:1)\r\n\tat com.google.android.gms.tasks.zzj.run(SourceFile:4)\r\n\tat android.os.Handler.handleCallback(Handler.java:938)\r\n\tat android.os.Handler.dispatchMessage(Handler.java:99)\r\n\tat android.os.Looper.loopOnce(Looper.java:201)\r\n\tat android.os.Looper.loop(Looper.java:288)\r\n\tat android.app.ActivityThread.main(ActivityThread.java:7870)\r\n\tat java.lang.reflect.Method.invoke(Native Method)\r\n\tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548)\r\n\tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1003)\r\n```\n", "hints_text": "", "created_at": "2023-02-15T21:47:31Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6315, "instance_id": "AntennaPod__AntennaPod-6315", "issue_numbers": ["6307"], "base_commit": "08ee701dd7da76deecb3dc7227dfaacba788ea83", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/adapter/ChaptersListAdapter.java b/app/src/main/java/de/danoeh/antennapod/adapter/ChaptersListAdapter.java\nindex 31e6efc5a4..1589f06cca 100644\n--- a/app/src/main/java/de/danoeh/antennapod/adapter/ChaptersListAdapter.java\n+++ b/app/src/main/java/de/danoeh/antennapod/adapter/ChaptersListAdapter.java\n@@ -86,7 +86,7 @@ public void onBindViewHolder(@NonNull ChapterHolder holder, int position) {\n \n         if (position == currentChapterIndex) {\n             float density = context.getResources().getDisplayMetrics().density;\n-            holder.itemView.setBackgroundColor(SurfaceColors.getColorForElevation(context, 8 * density));\n+            holder.itemView.setBackgroundColor(SurfaceColors.getColorForElevation(context, 32 * density));\n             float progress = ((float) (currentChapterPosition - sc.getStart())) / duration;\n             progress = Math.max(progress, CircularProgressBar.MINIMUM_PERCENTAGE);\n             progress = Math.min(progress, CircularProgressBar.MAXIMUM_PERCENTAGE);\n", "test_patch": "", "problem_statement": "Highlight currently playing chapter\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.0.0-beta4 (7af00f7e8)\n\n### Where did you get the app from\n\nGoogle Play\n\n### Problem you may be having, or feature you want\n\nWhen scrolling through the list of chapters on a hunt for the parts I'm looking for, it's sometimes hard to see where I currently am.\n\n### Suggested solution\n\nHighlight the currently playing (or paused) chapter in the chapter list, just like for episodes in the queue.\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "", "created_at": "2023-02-11T18:22:54Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6313, "instance_id": "AntennaPod__AntennaPod-6313", "issue_numbers": ["6312"], "base_commit": "f9076cc8e367a7425a79f0dca7e36fe65161fddd", "patch": "diff --git a/ui/common/src/main/res/layout/pager_fragment.xml b/ui/common/src/main/res/layout/pager_fragment.xml\nindex 3987b871dc..e479259d54 100644\n--- a/ui/common/src/main/res/layout/pager_fragment.xml\n+++ b/ui/common/src/main/res/layout/pager_fragment.xml\n@@ -26,7 +26,7 @@\n         android:layout_height=\"wrap_content\"\n         android:background=\"?android:attr/windowBackground\"\n         app:tabBackground=\"?attr/selectableItemBackground\"\n-        app:tabMode=\"fixed\"\n+        app:tabMode=\"auto\"\n         app:tabGravity=\"fill\" />\n \n     <androidx.viewpager2.widget.ViewPager2\n", "test_patch": "", "problem_statement": "UI bug in statistics menu\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n2.7.1\n\n### Where did you get the app from\n\nF-Droid\n\n### Android version\n\n11\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\nOpen statistics menu.\r\nUI bug is there.\r\nSubscription s .\r\nThe \"s\" is in a new row.\r\n![Antenna bug](https://user-images.githubusercontent.com/68952092/218235689-8fdbe417-304a-42ce-a360-28734608fe01.jpg)\r\n\n\n### Expected behaviour\n\nTo write the whole world in a row.\n\n### Current behaviour\n\nIt writes in 2 rows.\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2023-02-11T08:51:11Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6310, "instance_id": "AntennaPod__AntennaPod-6310", "issue_numbers": ["6309"], "base_commit": "52ddf47e3614abc37afcbebb84c9849ab45f7783", "patch": "diff --git a/README.md b/README.md\nindex 3cc9729edd..ab26482eab 100644\n--- a/README.md\n+++ b/README.md\n@@ -32,5 +32,5 @@ If you want to translate AntennaPod into another language, you can visit the [Tr\n \n ## Building AntennaPod\n \n-Information on how to build AntennaPod can be found in the [wiki](https://github.com/AntennaPod/AntennaPod/wiki/Building-AntennaPod).\n+You can build AntennaPod just like any other Android project. On Android Studio, simply select `File` \u00bb `New` \u00bb `Project from version control` and paste AntennaPod's GitHub URL.\n \n", "test_patch": "", "problem_statement": "Update README.md with Build directions\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n2.7.1\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n13\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\nThe current version of README.md ends with a section titled, \"Building AntennaPod\" which directs the reader to a now defunct page on the wiki. Instead, that text should be replaced with this text from ByteHamster in:\r\n\r\nhttps://github.com/AntennaPod/AntennaPod/issues/6271\r\n\r\n\"On Android Studio, you can simply do File \u00bb New \u00bb Project from version control and paste AntennaPod's GitHub URL.\"\r\n\n\n### Expected behaviour\n\nConstructive information on how to build the app\n\n### Current behaviour\n\nYou are taken to the wiki page which has no information on how to build the app\r\n\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2023-02-06T21:40:45Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6301, "instance_id": "AntennaPod__AntennaPod-6301", "issue_numbers": ["6297", "6296"], "base_commit": "7af00f7e83bc5047ef3873494cdd1f43d31c026b", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\nindex f30c3d456b..6b2267926b 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java\n@@ -209,10 +209,7 @@ public void onSlide(@NonNull View view, float slideOffset) {\n                 audioPlayer.scrollToPage(AudioPlayerFragment.POS_COVER);\n             }\n \n-            float condensedSlideOffset = Math.max(0.0f, Math.min(0.2f, slideOffset - 0.2f)) / 0.2f;\n-            audioPlayer.getExternalPlayerHolder().setAlpha(1 - condensedSlideOffset);\n-            audioPlayer.getExternalPlayerHolder().setVisibility(\n-                    condensedSlideOffset > 0.99f ? View.GONE : View.VISIBLE);\n+            audioPlayer.fadePlayerToToolbar(slideOffset);\n         }\n     };\n \ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/AudioPlayerFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/AudioPlayerFragment.java\nindex 530d87e7fd..e93db2d2a6 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/AudioPlayerFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/AudioPlayerFragment.java\n@@ -183,10 +183,6 @@ private void setChapterDividers(Playable media) {\n         sbPosition.setDividerPos(dividerPos);\n     }\n \n-    public View getExternalPlayerHolder() {\n-        return getView().findViewById(R.id.playerFragment);\n-    }\n-\n     private void setupControlButtons() {\n         butRev.setOnClickListener(v -> {\n             if (controller != null) {\n@@ -528,6 +524,16 @@ public boolean onMenuItemClick(MenuItem item) {\n         return false;\n     }\n \n+    public void fadePlayerToToolbar(float slideOffset) {\n+        float playerFadeProgress = Math.max(0.0f, Math.min(0.2f, slideOffset - 0.2f)) / 0.2f;\n+        View player = getView().findViewById(R.id.playerFragment);\n+        player.setAlpha(1 - playerFadeProgress);\n+        player.setVisibility(playerFadeProgress > 0.99f ? View.GONE : View.VISIBLE);\n+        float toolbarFadeProgress = Math.max(0.0f, Math.min(0.2f, slideOffset - 0.6f)) / 0.2f;\n+        toolbar.setAlpha(toolbarFadeProgress);\n+        toolbar.setVisibility(toolbarFadeProgress < 0.01f ? View.INVISIBLE : View.VISIBLE);\n+    }\n+\n     private static class AudioPlayerPagerAdapter extends FragmentStateAdapter {\n         private static final String TAG = \"AudioPlayerPagerAdapter\";\n \ndiff --git a/app/src/main/res/layout/audioplayer_fragment.xml b/app/src/main/res/layout/audioplayer_fragment.xml\nindex 78d2a9a494..496875a5fa 100644\n--- a/app/src/main/res/layout/audioplayer_fragment.xml\n+++ b/app/src/main/res/layout/audioplayer_fragment.xml\n@@ -13,7 +13,6 @@\n         android:layout_gravity=\"top\"\n         android:elevation=\"8dp\"\n         android:outlineProvider=\"none\"\n-        android:paddingBottom=\"1dp\"\n         tools:layout_height=\"@dimen/external_player_height\" />\n \n     <RelativeLayout\n", "test_patch": "", "problem_statement": "Improve the way underlying icons appear when dragging the miniplayer upwards\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.0.0 beta 4\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n(First reported as a comment on #6279)\r\n\r\nThis is the UI part of the original comment:\r\n\r\n> It is indeed a bit strange to see a sliver of the icons from the screen below when dragging the miniplayer upwards (and until the miniplayer is visible).\r\n\r\nPerhaps the icons could fade in when dragging upwards in sync with the miniplayer fading out/after it has faded out? Of course we might need to test some different variations to get this right.\n\n### Expected behaviour\n\n_No response_\n\n### Current behaviour\n\n_No response_\n\n### Logs\n\n_No response_\nIcons from the full player screen can be triggered underneath the miniplayer\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.0.0 beta 4\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\nPixel 3a\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n(First reported as a comment on #6279)\r\n\r\nEven though the gap below the miniplayer reported in #6279 is not visible on my device, I am still able to trigger the underlying icons (favourites, sleep timer, etc.) by tapping at the very bottom of the miniplayer. This happens even after #6292.\n\n### Expected behaviour\n\n_No response_\n\n### Current behaviour\n\n_No response_\n\n### Logs\n\n_No response_\n", "hints_text": "@loucasal do you refer to this effect?\n![Imagepipe_0.jpg](https://user-images.githubusercontent.com/11229646/215415610-b198639e-ab38-4001-9270-ec0b7ababcef.jpg)\n\n~~I thought you also meant that these top bar buttons are clickable when they're not fully visible yet?~~ Edit: nvm, that you reported separately in #6296.\nYes - but it's more noticeable before the miniplayer starts to fade, as in this other screenshot.\r\n![icons](https://user-images.githubusercontent.com/25279797/215426285-e5f126cb-97d5-416c-9773-e0d8f4bf08c0.png)\r\n\n@loucasal That situation should not occur any-more: @ByteHamster already implemented #6292 which should fix the icons from being shown at all below the mini-player. So they should only start showing when the mini-player starts fading.\r\n\r\nIf the icons still show below the mini-player after that PR, the situation needs to be corrected further.\r\n\r\nI'm not sure if it's worth the effort of implementing fade-in of icons in the full player top bar.\nSee the post-merge exchange on #6292. Both reports are still relevant. ;)\n> See the post-merge exchange on https://github.com/AntennaPod/AntennaPod/pull/6292. Both reports are still relevant. ;)\r\n\r\nWhat you wrote there is the following:\r\n\r\n> I still manage to trigger the underlying buttons when tapping the bottom of the miniplayer. Should I open a separate ticket for that?\r\n\r\nSo, to recap:\r\n* there you mentioned the problem \"underlying buttons\" being tappable. For this you created #6296.\r\n* as you wrote in [#6296](https://github.com/AntennaPod/AntennaPod/issues/6296), \"the gap below the miniplayer reported in [#6279](https://github.com/AntennaPod/AntennaPod/issues/6279) is not visible on my device\". Above I noted that if this still happened, it should be corrected further.\r\n  * I thought from your the image you posted above that this was still occurring (in which case we should track separately), but:\r\n  * I hadn't read [#6296](https://github.com/AntennaPod/AntennaPod/issues/6296) and there you write that it doesn't occur any-more (so this problem case is closed :-) )\r\n* the problem you describe here in _this_ issue is about the top icons becoming visible a bit early when swiping up the miniplayer. This is not a bug but a UI enhancement. As I noted above: not sure it's worth the effort improving.\nYes, sorry if I caused confusion. As I said in #6279, I never experienced a noticeable gap below the miniplayer on my device, neither before, nor after the patch.\r\n\r\n> This is not a bug but a UI enhancement.\r\n\r\nI know, but users are currently only allowed to open tickets as bugs or feature requests - this repo has no template for enhancements. Perhaps we should add one?\n", "created_at": "2023-02-01T20:51:41Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6293, "instance_id": "AntennaPod__AntennaPod-6293", "issue_numbers": ["6250", "6049"], "base_commit": "04a8ee5787707c25c100acb1e575f19f054e9d62", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\nindex bf8cf77781..4fb7bcf2aa 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n@@ -760,13 +760,9 @@ public void statusChanged(PlaybackServiceMediaPlayer.PSMPInfo newInfo) {\n                     taskManager.startChapterLoader(newInfo.playable);\n                     break;\n                 case PAUSED:\n-                    if (UserPreferences.isPersistNotify() || isCasting) {\n-                        // do not remove notification on pause based on user pref\n-                        // Change [Play] button to [Pause]\n-                        updateNotificationAndMediaSession(newInfo.playable);\n-                    } else if (!UserPreferences.isPersistNotify() && !isCasting) {\n-                        // remove notification on pause\n-                        stateManager.stopForeground(true);\n+                    updateNotificationAndMediaSession(newInfo.playable);\n+                    if (!isCasting) {\n+                        stateManager.stopForeground(!UserPreferences.isPersistNotify());\n                     }\n                     cancelPositionObserver();\n                     PlaybackPreferences.writePlayerStatus(mediaPlayer.getPlayerStatus());\n@@ -811,7 +807,7 @@ public void statusChanged(PlaybackServiceMediaPlayer.PSMPInfo newInfo) {\n \n         @Override\n         public void shouldStop() {\n-            updateNotificationAndMediaSession(getPlayable()); // Stops foreground if not playing\n+            stateManager.stopForeground(!UserPreferences.isPersistNotify());\n         }\n \n         @Override\n@@ -1271,7 +1267,6 @@ private synchronized void setupNotification(final Playable playable) {\n \n         NotificationManagerCompat notificationManager = NotificationManagerCompat.from(this);\n         notificationManager.notify(R.id.notification_playing, notificationBuilder.build());\n-        startForegroundIfPlaying(playerStatus);\n \n         if (!notificationBuilder.isIconCached()) {\n             playableIconLoaderThread = new Thread(() -> {\n@@ -1286,21 +1281,6 @@ private synchronized void setupNotification(final Playable playable) {\n         }\n     }\n \n-    private void startForegroundIfPlaying(@NonNull PlayerStatus status) {\n-        Log.d(TAG, \"startForegroundIfPlaying: \" + status);\n-        if (stateManager.hasReceivedValidStartCommand()) {\n-            if (isCasting || status == PlayerStatus.PLAYING || status == PlayerStatus.PREPARING\n-                    || status == PlayerStatus.SEEKING) {\n-                stateManager.startForeground(R.id.notification_playing, notificationBuilder.build());\n-                Log.d(TAG, \"foreground\");\n-            } else {\n-                stateManager.stopForeground(false);\n-                NotificationManagerCompat notificationManager = NotificationManagerCompat.from(this);\n-                notificationManager.notify(R.id.notification_playing, notificationBuilder.build());\n-            }\n-        }\n-    }\n-\n     /**\n      * Persists the current position and last played time of the media file.\n      *\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackServiceStateManager.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackServiceStateManager.java\nindex addc6b996f..9926e01dad 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackServiceStateManager.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackServiceStateManager.java\n@@ -1,10 +1,12 @@\n package de.danoeh.antennapod.core.service.playback;\n \n import android.app.Notification;\n+import android.util.Log;\n \n import androidx.core.app.ServiceCompat;\n \n class PlaybackServiceStateManager {\n+    private static final String TAG = \"PlaybackSrvState\";\n     private final PlaybackService playbackService;\n \n     private volatile boolean isInForeground = false;\n@@ -15,17 +17,20 @@ class PlaybackServiceStateManager {\n     }\n \n     void startForeground(int notificationId, Notification notification) {\n+        Log.d(TAG, \"startForeground\");\n         playbackService.startForeground(notificationId, notification);\n         isInForeground = true;\n     }\n \n     void stopService() {\n+        Log.d(TAG, \"stopService\");\n         stopForeground(true);\n         playbackService.stopSelf();\n         hasReceivedValidStartCommand = false;\n     }\n \n     void stopForeground(boolean removeNotification) {\n+        Log.d(TAG, \"stopForeground\");\n         if (isInForeground) {\n             if (removeNotification) {\n                 ServiceCompat.stopForeground(playbackService, ServiceCompat.STOP_FOREGROUND_REMOVE);\n", "test_patch": "", "problem_statement": "Playback service fails to start next episode in background\n### Checklist\r\n\r\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n### App version\r\n\r\n3.0.0 alpha 1 and 2\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Android version\r\n\r\n12\r\n\r\n### Device model\r\n\r\n_No response_\r\n\r\n### First occurred\r\n\r\n_No response_\r\n\r\n### Steps to reproduce\r\n\r\n1. Have at least two episodes in the queue, with the \"Continuous Playback\" setting active\r\n2. Start playing the first episode\r\n3. Put AntennaPod in the background (e.g. by using another app)\r\n4. Wait until the end of the currently playing episode\r\n\r\n### Expected behaviour\r\n\r\nPlayback continues with the following episode in the queue.\r\n\r\n### Current behaviour\r\n\r\nPlayback stops. The following episode in the queue is displayed in the miniplayer, but playback needs to be started manually.\r\n\r\n### Logs\r\n\r\n_No response_\nPlayer in the notification shade disappears if interacted with while app is in background\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n2.6.2 (9e87cf611)\n\n### Where did you get the app from\n\nF-Droid\n\n### Android version\n\n13\n\n### Device model\n\nGoogle Pixel 6a\n\n### First occurred\n\nwhen moving to android 13 I THINK\n\n### Steps to reproduce\n\n1. Go to home screen.\r\n2. Open notification tray\r\n3. Press \"Play\"\r\n\n\n### Expected behaviour\n\nMini player should always exist in the notification shade when podcast is playing. \n\n### Current behaviour\n\nMini player disappears after pressing play. See video below:\r\n\r\nhttps://photos.app.goo.gl/wWdYxQtyrVaZAd2p6\n\n### Logs\n\n_No response_\n", "hints_text": "@ByteHamster I am starting to realise that the steps above might not even be necessary to reproduce this issue. Could there be a more fundamental problem with Continuous Playback in the 3.0 builds?\nFor what it's worth, I'm also experiencing this issue occasionally, but I do not have much to add yet. Did not get to debugging it yet.\n@matejdro Which version are you on?\nLocal build, based on https://github.com/AntennaPod/AntennaPod/commit/b670cf6111a0c04dee0bac1687c6fa3320bba89c\nMore testing results: everything else being equal, reaching the end of an episode by playing triggers the bug, whereas fast forwarding past the end of the episode doesn't.\r\n\r\nI also somehow managed to trigger and capture an error message. Could this be the reason?\r\n\r\n![Screenshot_20230109-213123](https://user-images.githubusercontent.com/25279797/211402724-2e779d74-5ed4-4e82-a70c-b3722b93911d.png)\r\n\nThis happens to me consistently when playing episodes in Google Maps navigation mode. I don't believe I've ever had it automatically play the next episode in the queue after finishing one, despite the relevant setting being turned on. Playback just stops, and the playback controls disappear (see #6220), both from Google Maps and the notification pull-down (see #4448) so I can't even resume it again without manually closing Google Maps, navigating to AntennaPod, and pushing the play button again.\nI've been noticing this too. It definitely started after upgrading to Android 13. In my case, once the notification removes the ability to scrub (in other words, it looks the same as when it's normally paused, except that it doesn't have the little dot on the seekbar that tells you where you currently are in the audio), pressing the play button removes the notification entirely.\r\n\r\nI could also see this being the same thing as [this topic](https://forum.antennapod.org/t/android-13-update-causing-issues-with-lock-screen-and-menu-miniplayer/2330) on the forums.\n@awbooze on rare occasions, pressing play would cause the notification to disappear and then reappear with the scrubber maybe half a second later. But most of the time it just disappears and does not return\r\n\r\nIt seems to be better since the latest Android 13 update. However, before that, I was experimenting with the battery settings for the app. When \"restricted\" from background use, the notification will lose the scrubber if playing is paused and then you close the app. If unrestricted, it seems that the scrubber never disappears, although after some time the notification will disappear but still be available in the 2nd pulldown of the notification/control center. If optimized, then the scrubber will disappear after some idle time\r\n\r\nThere may be more to it than that, but this has been my observation so far\ngetting this often since A13. here is a log, issue occured at 08:50, pressing play from the notification, playback resumed but notification dissappeared. i think the same can happen if podcast is playing, and you press pause, notification disappears.\r\n[full-logs.txt](https://github.com/AntennaPod/AntennaPod/files/9605303/full-logs.txt)\r\n\r\nalso have another issue relating to notifications, which I dont think is new to A13, where occasionally, the notification appears to \"stale\" in that it is showing an episode which i finished listening to previously, and not the most recently paused item, so pressing play results in resuming a completed podcast at some random mid-point, instead of resuming the one you were last listening to. Will try and get a log for that one and raise a new issue\r\n\nI have the same issue, but not only in the notification tray, but also on the lock screen. I'm guessing it's the same bug, but wanted to mention it just in case that's important for you to know. Thanks!\nThis issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/play-controls-disappear-on-pixel-7-pro-android-13/2597/5\n\nI have been facing this issue since upgrading to Android 13. I recently captured a bunch of logs via ADB, how much of which is relevant I don't know. This was done with simply `adb logcat` and then reproducing it; i don't know what in here is relevant but I see a lot of things in there that look suspicious, in particular the stack trace in \"no vorbis identification header found\" (which another issue mentions is not relevant and may be removed) and the CCodecConfig saying state is corrupted, but I don't know if that has anything to do with the notification in the shade; i'm just attaching an excerpt from my logs in case it's helpful. I can attach more if needed. Just hoping to help figure this out.\r\n\r\n```\r\n12-26 21:53:20.144 11989 11989 D PlaybackService: startForegroundIfPlaying: PLAYING\r\n12-26 21:53:20.144 11989 29420 D CCodec  : [c2.android.mp3.decoder] buffers are bound to CCodec for this session\r\n12-26 21:53:20.144 11989 29420 D CCodecConfig: no c2 equivalents for flags\r\n12-26 21:53:20.149 11989 29420 D CCodecConfig: config failed => CORRUPTED\r\n12-26 21:53:20.149 11989 29420 W Codec2Client: query -- param skipped: index = 1107298332.\r\n12-26 21:53:20.149 11989 29420 D CCodec  : client requested max input size 4096, which is smaller than what component recommended (8192); overriding with comp>\r\n12-26 21:53:20.149 11989 29420 W CCodec  : This behavior is subject to change. It is recommended that app developers double check whether the requested max in>\r\n12-26 21:53:20.149 11989 29420 D CCodec  : encoding statistics level = 0\r\n12-26 21:53:20.149 11989 29420 D CCodec  : setup formats input: AMessage(what = 0x00000000) = {\r\n12-26 21:53:20.149 11989 29420 D CCodec  :   int32_t bitrate = 64000\r\n12-26 21:53:20.149 11989 29420 D CCodec  :   int32_t channel-count = 2\r\n12-26 21:53:20.149 11989 29420 D CCodec  :   int32_t max-input-size = 8192\r\n12-26 21:53:20.149 11989 29420 D CCodec  :   string mime = \"audio/mpeg\"\r\n12-26 21:53:20.149 11989 29420 D CCodec  :   int32_t sample-rate = 44100\r\n12-26 21:53:20.149 11989 29420 D CCodec  : }\r\n12-26 21:53:20.150 11989 29420 D CCodec  : setup formats output: AMessage(what = 0x00000000) = {\r\n12-26 21:53:20.150 11989 29420 D CCodec  :   int32_t channel-count = 2\r\n12-26 21:53:20.150 11989 29420 D CCodec  :   string mime = \"audio/raw\"\r\n12-26 21:53:20.150 11989 29420 D CCodec  :   int32_t sample-rate = 44100\r\n12-26 21:53:20.150 11989 29420 D CCodec  :   int32_t android._config-pcm-encoding = 2\r\n12-26 21:53:20.150 11989 29420 D CCodec  : }\r\n12-26 21:53:20.150 11989 29420 I CCodecConfig: query failed after returning 7 values (BAD_INDEX)\r\n12-26 21:53:20.151 11989 29420 W Codec2Client: query -- param skipped: index = 1342179345.\r\n12-26 21:53:20.151 11989 29420 W Codec2Client: query -- param skipped: index = 2415921170.\r\n```\r\n\r\n[dl2.txt](https://github.com/AntennaPod/AntennaPod/files/10306211/dl2.txt)\r\n\n> It seems to be better since the latest Android 13 update. However, before that, I was experimenting with the battery settings for the app. When \"restricted\" from background use, the notification will lose the scrubber if playing is paused and then you close the app. If unrestricted, it seems that the scrubber never disappears, although after some time the notification will disappear but still be available in the 2nd pulldown of the notification/control center. If optimized, then the scrubber will disappear after some idle time\r\n\r\n\r\nThis is for sure what the issue is. Setting \"App battery usage\" to Unrestricted fixes the behavior and the scrubber never disappears. Both Optimized and Restricted cause the notification to disappear if the app is not in the foreground.\nThanks for your findings! That seems to be a functional workaround. But there must be a way to fix the root cause of this issue, or is this the solution for Android 13+ devices? A podcast player with unrestricted battery usage?", "created_at": "2023-01-29T12:56:56Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6292, "instance_id": "AntennaPod__AntennaPod-6292", "issue_numbers": ["6279"], "base_commit": "04a8ee5787707c25c100acb1e575f19f054e9d62", "patch": "diff --git a/app/src/main/res/layout/audioplayer_fragment.xml b/app/src/main/res/layout/audioplayer_fragment.xml\nindex a9964089ca..78d2a9a494 100644\n--- a/app/src/main/res/layout/audioplayer_fragment.xml\n+++ b/app/src/main/res/layout/audioplayer_fragment.xml\n@@ -12,6 +12,8 @@\n         android:layout_height=\"wrap_content\"\n         android:layout_gravity=\"top\"\n         android:elevation=\"8dp\"\n+        android:outlineProvider=\"none\"\n+        android:paddingBottom=\"1dp\"\n         tools:layout_height=\"@dimen/external_player_height\" />\n \n     <RelativeLayout\n", "test_patch": "", "problem_statement": "Miniplayer doesn't fully cover top bar full player\n### Checklist\r\n\r\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n### App version\r\n\r\n3.0.0-beta3 (bb43cd461)\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Android version\r\n\r\n11\r\n\r\n### Device model\r\n\r\nFP3\r\n\r\n### First occurred\r\n\r\n_No response_\r\n\r\n### Steps to reproduce\r\n\r\nStart playing podcast, make sure the mini player is visible\r\n\r\n### Expected behaviour\r\n\r\n* The icons from the top bar of the full player are fully covered by the miniplayer.\r\n* There is no gap (margin/padding) between the miniplayer and the Android bottom bar.\r\n\r\n### Current behaviour\r\n\r\nThere is a minigap and the favourite and settings icons of the full player top bar can be seen below the miniplayer:\r\n![Screenshot_20230122-085357](https://user-images.githubusercontent.com/11229646/213906313-51eb21a3-8a4a-4a30-8ac5-28e11a168b2e.png)\r\n\r\n### Logs\r\n\r\n_No response_\n", "hints_text": "On my device no gap is visible, but it is indeed a bit strange to see a sliver of the icons from the screen below when dragging the miniplayer upwards (and until the miniplayer is visible). Perhaps both points can be addressed together.\r\n\r\n_Edit_: @keunes is probably on to something that applies to all devices here: even though I cannot see a gap, I am still able to trigger the underlying icons (favourites, sleep timer, etc.) by tapping at the very bottom of the miniplayer.", "created_at": "2023-01-29T12:27:35Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6291, "instance_id": "AntennaPod__AntennaPod-6291", "issue_numbers": ["6182"], "base_commit": "73a6ff1f6003c776fb37bd8e7315045e69e710d2", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadService.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadService.java\nindex 30745a60db..a18d7d1d04 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadService.java\n@@ -273,8 +273,8 @@ private void handleSuccessfulDownload(Downloader downloader) {\n \n         if (type == Feed.FEEDFILETYPE_FEED) {\n             Log.d(TAG, \"Handling completed Feed Download\");\n-            FeedSyncTask task = new FeedSyncTask(DownloadService.this, request);\n-            boolean success = task.run();\n+            FeedSyncTask feedSyncTask = new FeedSyncTask(DownloadService.this, request);\n+            boolean success = feedSyncTask.run();\n \n             if (success) {\n                 if (request.getFeedfileId() == 0) {\n@@ -283,18 +283,20 @@ private void handleSuccessfulDownload(Downloader downloader) {\n                 // we create a 'successful' download log if the feed's last refresh failed\n                 List<DownloadStatus> log = DBReader.getFeedDownloadLog(request.getFeedfileId());\n                 if (log.size() > 0 && !log.get(0).isSuccessful()) {\n-                    saveDownloadStatus(task.getDownloadStatus());\n+                    saveDownloadStatus(feedSyncTask.getDownloadStatus());\n                 }\n                 if (!request.isInitiatedByUser()) {\n                     // Was stored in the database before and not initiated manually\n-                    newEpisodesNotification.showIfNeeded(DownloadService.this, task.getSavedFeed());\n+                    newEpisodesNotification.showIfNeeded(DownloadService.this, feedSyncTask.getSavedFeed());\n                 }\n                 if (downloader.permanentRedirectUrl != null) {\n                     DBWriter.updateFeedDownloadURL(request.getSource(), downloader.permanentRedirectUrl);\n+                } else if (feedSyncTask.getRedirectUrl() != null) {\n+                    DBWriter.updateFeedDownloadURL(request.getSource(), feedSyncTask.getRedirectUrl());\n                 }\n             } else {\n                 DBWriter.setFeedLastUpdateFailed(request.getFeedfileId(), true);\n-                saveDownloadStatus(task.getDownloadStatus());\n+                saveDownloadStatus(feedSyncTask.getDownloadStatus());\n             }\n         } else if (type == FeedMedia.FEEDFILETYPE_FEEDMEDIA) {\n             Log.d(TAG, \"Handling completed FeedMedia Download\");\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/FeedSyncTask.java b/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/FeedSyncTask.java\nindex 07670bff3a..e3010fe241 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/FeedSyncTask.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/download/handler/FeedSyncTask.java\n@@ -14,6 +14,7 @@ public class FeedSyncTask {\n     private final Context context;\n     private Feed savedFeed;\n     private final FeedParserTask task;\n+    private FeedHandlerResult feedHandlerResult;\n \n     public FeedSyncTask(Context context, DownloadRequest request) {\n         this.request = request;\n@@ -22,15 +23,15 @@ public FeedSyncTask(Context context, DownloadRequest request) {\n     }\n \n     public boolean run() {\n-        FeedHandlerResult result = task.call();\n+        feedHandlerResult = task.call();\n         if (!task.isSuccessful()) {\n             return false;\n         }\n \n-        savedFeed = DBTasks.updateFeed(context, result.feed, false);\n+        savedFeed = DBTasks.updateFeed(context, feedHandlerResult.feed, false);\n         // If loadAllPages=true, check if another page is available and queue it for download\n         final boolean loadAllPages = request.getArguments().getBoolean(DownloadRequest.REQUEST_ARG_LOAD_ALL_PAGES);\n-        final Feed feed = result.feed;\n+        final Feed feed = feedHandlerResult.feed;\n         if (loadAllPages && feed.getNextPageLink() != null) {\n             feed.setId(savedFeed.getId());\n             DBTasks.loadNextPageOfFeed(context, feed, true);\n@@ -46,4 +47,8 @@ public DownloadStatus getDownloadStatus() {\n     public Feed getSavedFeed() {\n         return savedFeed;\n     }\n+\n+    public String getRedirectUrl() {\n+        return feedHandlerResult.redirectUrl;\n+    }\n }\ndiff --git a/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/FeedHandler.java b/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/FeedHandler.java\nindex 6b364fa730..dd9cb836bc 100644\n--- a/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/FeedHandler.java\n+++ b/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/FeedHandler.java\n@@ -31,6 +31,6 @@ public FeedHandlerResult parseFeed(Feed feed) throws SAXException, IOException,\n \n         saxParser.parse(inputSource, handler);\n         inputStreamReader.close();\n-        return new FeedHandlerResult(handler.state.feed, handler.state.alternateUrls);\n+        return new FeedHandlerResult(handler.state.feed, handler.state.alternateUrls, handler.state.redirectUrl);\n     }\n }\ndiff --git a/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/FeedHandlerResult.java b/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/FeedHandlerResult.java\nindex 43b3387a0f..6db3ca47fd 100644\n--- a/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/FeedHandlerResult.java\n+++ b/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/FeedHandlerResult.java\n@@ -11,9 +11,11 @@ public class FeedHandlerResult {\n \n     public final Feed feed;\n     public final Map<String, String> alternateFeedUrls;\n+    public final String redirectUrl;\n \n-    public FeedHandlerResult(Feed feed, Map<String, String> alternateFeedUrls) {\n+    public FeedHandlerResult(Feed feed, Map<String, String> alternateFeedUrls, String redirectUrl) {\n         this.feed = feed;\n         this.alternateFeedUrls = alternateFeedUrls;\n+        this.redirectUrl = redirectUrl;\n     }\n }\ndiff --git a/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/HandlerState.java b/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/HandlerState.java\nindex 706a328e87..650931fc1f 100644\n--- a/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/HandlerState.java\n+++ b/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/HandlerState.java\n@@ -26,6 +26,7 @@ public class HandlerState {\n      * URL of the feed, the value is the title\n      */\n     public final Map<String, String> alternateUrls;\n+    public String redirectUrl = null;\n     private final ArrayList<FeedItem> items;\n     private FeedItem currentItem;\n     private FeedFunding currentFunding;\ndiff --git a/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/namespace/Itunes.java b/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/namespace/Itunes.java\nindex 9c57d4ef3c..cb4bcb8a76 100644\n--- a/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/namespace/Itunes.java\n+++ b/parser/feed/src/main/java/de/danoeh/antennapod/parser/feed/namespace/Itunes.java\n@@ -23,6 +23,7 @@ public class Itunes extends Namespace {\n     public static final String DURATION = \"duration\";\n     private static final String SUBTITLE = \"subtitle\";\n     private static final String SUMMARY = \"summary\";\n+    private static final String NEW_FEED_URL = \"new-feed-url\";\n \n     @Override\n     public SyndElement handleElementStart(String localName, HandlerState state,\n@@ -76,6 +77,8 @@ public void handleElementEnd(String localName, HandlerState state) {\n             } else if (Rss20.CHANNEL.equals(state.getSecondTag().getName()) && state.getFeed() != null) {\n                 state.getFeed().setDescription(content);\n             }\n+        } else if (NEW_FEED_URL.equals(localName) && content.trim().startsWith(\"http\")) {\n+            state.redirectUrl = content.trim();\n         }\n     }\n }\n", "test_patch": "", "problem_statement": "Support for itunes:new-feed-url\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.0.0 develop\n\n### Where did you get the app from\n\nOther\n\n### Problem you may be having, or feature you want\n\nSome hosters do not allow redirects. We should follow these itunes:new-feed-url redirects.\n\n### Suggested solution\n\n_No response_\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "This issue has been mentioned on **AntennaPod Forum**. There might be relevant details there:\n\nhttps://forum.antennapod.org/t/redirecting-a-feed-without-a-301/2475/2\n", "created_at": "2023-01-28T12:34:05Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6290, "instance_id": "AntennaPod__AntennaPod-6290", "issue_numbers": ["6278"], "base_commit": "12793de6047e0b5c7e8e4b4fd6e49c181324b406", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/home/sections/EpisodesSurpriseSection.java b/app/src/main/java/de/danoeh/antennapod/ui/home/sections/EpisodesSurpriseSection.java\nindex 8aaeb14127..7e2c855e94 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/home/sections/EpisodesSurpriseSection.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/home/sections/EpisodesSurpriseSection.java\n@@ -65,6 +65,8 @@ public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMen\n         viewBinding.recyclerView.setLayoutManager(\n                 new LinearLayoutManager(getContext(), RecyclerView.HORIZONTAL, false));\n         viewBinding.recyclerView.setAdapter(listAdapter);\n+        int paddingHorizontal = (int) (12 * getResources().getDisplayMetrics().density);\n+        viewBinding.recyclerView.setPadding(paddingHorizontal, 0, paddingHorizontal, 0);\n         if (seed == 0) {\n             seed = new Random().nextInt();\n         }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/home/sections/QueueSection.java b/app/src/main/java/de/danoeh/antennapod/ui/home/sections/QueueSection.java\nindex e35068e58c..070d56ed63 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/home/sections/QueueSection.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/home/sections/QueueSection.java\n@@ -58,6 +58,8 @@ public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMen\n         viewBinding.recyclerView.setLayoutManager(\n                 new LinearLayoutManager(getContext(), RecyclerView.HORIZONTAL, false));\n         viewBinding.recyclerView.setAdapter(listAdapter);\n+        int paddingHorizontal = (int) (12 * getResources().getDisplayMetrics().density);\n+        viewBinding.recyclerView.setPadding(paddingHorizontal, 0, paddingHorizontal, 0);\n         return view;\n     }\n \ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/home/sections/SubscriptionsSection.java b/app/src/main/java/de/danoeh/antennapod/ui/home/sections/SubscriptionsSection.java\nindex b10d20e7b9..b9a1bf8e86 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/home/sections/SubscriptionsSection.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/home/sections/SubscriptionsSection.java\n@@ -44,6 +44,8 @@ public View onCreateView(@NonNull LayoutInflater inflater,\n         listAdapter = new HorizontalFeedListAdapter((MainActivity) getActivity());\n         listAdapter.setDummyViews(NUM_FEEDS);\n         viewBinding.recyclerView.setAdapter(listAdapter);\n+        int paddingHorizontal = (int) (12 * getResources().getDisplayMetrics().density);\n+        viewBinding.recyclerView.setPadding(paddingHorizontal, 0, paddingHorizontal, 0);\n         return view;\n     }\n \n", "test_patch": "", "problem_statement": "Left side of episode card in Home doesn't align\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.0.0-beta3 (bb43cd461)\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n11\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\nView Home screen\n\n### Expected behaviour\n\nLeft (start) side of episode card left-(start-)aligns with section title.\n\n### Current behaviour\n\nThere's a small margin:\r\n![Imagepipe_0](https://user-images.githubusercontent.com/11229646/213905923-0bacfa6d-4b1d-4dfc-a7c4-935c4bee6700.jpg)\n\n### Logs\n\n_No response_\n", "hints_text": "", "created_at": "2023-01-28T10:50:17Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6288, "instance_id": "AntennaPod__AntennaPod-6288", "issue_numbers": ["6284"], "base_commit": "13439e1a485003620406e92ac5a0c2ae517ac24e", "patch": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackServiceTaskManager.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackServiceTaskManager.java\nindex 3111d01bc3..3d69dbdbce 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackServiceTaskManager.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackServiceTaskManager.java\n@@ -294,6 +294,7 @@ public SleepTimer(long waitingTime) {\n         public void run() {\n             Log.d(TAG, \"Starting\");\n             long lastTick = System.currentTimeMillis();\n+            EventBus.getDefault().post(SleepTimerUpdatedEvent.updated(timeLeft));\n             while (timeLeft > 0) {\n                 try {\n                     Thread.sleep(UPDATE_INTERVAL);\n", "test_patch": "", "problem_statement": "Sleep timer skips a second after being set\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.0 alpha 3 (but applies to all 2.x versions I used too)\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Open the sleep timer dialog\r\n2. Set a sleep timer duration, e.g. 1 minute\n\n### Expected behaviour\n\nThe sleep timer counts down from the total duration without skipping any second.\n\n### Current behaviour\n\nThe sleep timer always skips a second, regardless of the total duration (e.g. 1 minute is followed directly by 58 seconds).\n\n### Logs\n\n_No response_\n", "hints_text": "Is this really a problem? The reason simply is that by the time the timer is fully started up, 2 seconds have already passed. I mean, we could also display the text \"please wait\" while loading the timer (instead of showing the total duration), which then jumps to 58 seconds. But that would probably be confusing to users.\nIt's definitely more of an odd quirk than a functional issue. I didn't want to leave it unreported, as I've been observing it for a long time, but it won't be a big deal if it remains as is.", "created_at": "2023-01-27T19:35:00Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6286, "instance_id": "AntennaPod__AntennaPod-6286", "issue_numbers": ["6238"], "base_commit": "2b22d4b6977f9a22abfd4bc2d269c79834551ee2", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/fragment/AllEpisodesFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/AllEpisodesFragment.java\nindex dbf314876f..dfbaf96958 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/AllEpisodesFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/AllEpisodesFragment.java\n@@ -9,13 +9,17 @@\n import android.view.ViewGroup;\n import androidx.annotation.NonNull;\n import de.danoeh.antennapod.R;\n+import de.danoeh.antennapod.core.storage.DBReader;\n import de.danoeh.antennapod.dialog.AllEpisodesFilterDialog;\n+import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n+import de.danoeh.antennapod.model.feed.SortOrder;\n import org.apache.commons.lang3.StringUtils;\n import org.greenrobot.eventbus.Subscribe;\n \n import java.util.ArrayList;\n import java.util.HashSet;\n+import java.util.List;\n \n /**\n  * Shows all episodes (possibly filtered by user).\n@@ -24,20 +28,55 @@ public class AllEpisodesFragment extends EpisodesListFragment {\n     public static final String TAG = \"EpisodesFragment\";\n     private static final String PREF_NAME = \"PrefAllEpisodesFragment\";\n     private static final String PREF_FILTER = \"filter\";\n+    public static final String PREF_SORT = \"prefEpisodesSort\";\n+    private SharedPreferences prefs;\n \n     @NonNull\n     @Override\n     public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {\n         final View root = super.onCreateView(inflater, container, savedInstanceState);\n         toolbar.inflateMenu(R.menu.episodes);\n+        inflateSortMenu();\n         toolbar.setTitle(R.string.episodes_label);\n         updateToolbar();\n         updateFilterUi();\n+        prefs = getActivity().getSharedPreferences(PREF_NAME, Context.MODE_PRIVATE);\n         txtvInformation.setOnClickListener(\n                 v -> AllEpisodesFilterDialog.newInstance(getFilter()).show(getChildFragmentManager(), null));\n         return root;\n     }\n \n+    private void inflateSortMenu() {\n+        MenuItem sortItem = toolbar.getMenu().findItem(R.id.episodes_sort);\n+        getActivity().getMenuInflater().inflate(R.menu.sort_menu, sortItem.getSubMenu());\n+\n+        // Remove the sorting options that are not needed in this fragment\n+        toolbar.getMenu().findItem(R.id.sort_episode_title).setVisible(false);\n+        toolbar.getMenu().findItem(R.id.sort_feed_title).setVisible(false);\n+        toolbar.getMenu().findItem(R.id.sort_random).setVisible(false);\n+        toolbar.getMenu().findItem(R.id.sort_smart_shuffle).setVisible(false);\n+        toolbar.getMenu().findItem(R.id.keep_sorted).setVisible(false);\n+    }\n+\n+    @NonNull\n+    @Override\n+    protected List<FeedItem> loadData() {\n+        return DBReader.getRecentlyPublishedEpisodes(0, page * EPISODES_PER_PAGE,\n+                getFilter(), getSortOrder());\n+    }\n+\n+    @NonNull\n+    @Override\n+    protected List<FeedItem> loadMoreData(int page) {\n+        return DBReader.getRecentlyPublishedEpisodes((page - 1) * EPISODES_PER_PAGE,\n+                EPISODES_PER_PAGE, getFilter(), getSortOrder());\n+    }\n+\n+    @Override\n+    protected int loadTotalItemCount() {\n+        return DBReader.getTotalEpisodeCount(getFilter());\n+    }\n+\n     @Override\n     protected FeedItemFilter getFilter() {\n         SharedPreferences prefs = getActivity().getSharedPreferences(PREF_NAME, Context.MODE_PRIVATE);\n@@ -71,13 +110,23 @@ public boolean onMenuItemClick(MenuItem item) {\n             }\n             onFilterChanged(new AllEpisodesFilterDialog.AllEpisodesFilterChangedEvent(new HashSet<>(filter)));\n             return true;\n+        } else {\n+            SortOrder sortOrder = MenuItemToSortOrderConverter.convert(item);\n+            if (sortOrder != null) {\n+                saveSortOrderAndRefresh(sortOrder);\n+                return true;\n+            }\n         }\n         return false;\n     }\n \n+    private void saveSortOrderAndRefresh(SortOrder type) {\n+        prefs.edit().putString(PREF_SORT, \"\" + type.code).apply();\n+        loadItems();\n+    }\n+\n     @Subscribe\n     public void onFilterChanged(AllEpisodesFilterDialog.AllEpisodesFilterChangedEvent event) {\n-        SharedPreferences prefs = getActivity().getSharedPreferences(PREF_NAME, Context.MODE_PRIVATE);\n         prefs.edit().putString(PREF_FILTER, StringUtils.join(event.filterValues, \",\")).apply();\n         updateFilterUi();\n         page = 1;\n@@ -96,4 +145,8 @@ private void updateFilterUi() {\n         toolbar.getMenu().findItem(R.id.action_favorites).setIcon(\n                 getFilter().showIsFavorite ? R.drawable.ic_star : R.drawable.ic_star_border);\n     }\n+\n+    private SortOrder getSortOrder() {\n+        return SortOrder.fromCodeString(prefs.getString(PREF_SORT, \"\" + SortOrder.DATE_NEW_OLD.code));\n+    }\n }\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/EpisodesListFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/EpisodesListFragment.java\nindex 1384b5d784..5ba3233722 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/EpisodesListFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/EpisodesListFragment.java\n@@ -31,7 +31,6 @@\n import de.danoeh.antennapod.core.event.DownloaderUpdate;\n import de.danoeh.antennapod.core.menuhandler.MenuItemUtils;\n import de.danoeh.antennapod.core.service.download.DownloadService;\n-import de.danoeh.antennapod.core.storage.DBReader;\n import de.danoeh.antennapod.core.util.FeedItemUtil;\n import de.danoeh.antennapod.core.util.download.AutoUpdateManager;\n import de.danoeh.antennapod.event.FeedItemEvent;\n@@ -442,18 +441,12 @@ void loadItems() {\n     }\n \n     @NonNull\n-    protected List<FeedItem> loadData() {\n-        return DBReader.getRecentlyPublishedEpisodes(0, page * EPISODES_PER_PAGE, getFilter());\n-    }\n+    protected abstract List<FeedItem> loadData();\n \n     @NonNull\n-    protected List<FeedItem> loadMoreData(int page) {\n-        return DBReader.getRecentlyPublishedEpisodes((page - 1) * EPISODES_PER_PAGE, EPISODES_PER_PAGE, getFilter());\n-    }\n+    protected abstract List<FeedItem> loadMoreData(int page);\n \n-    protected int loadTotalItemCount() {\n-        return DBReader.getTotalEpisodeCount(getFilter());\n-    }\n+    protected abstract int loadTotalItemCount();\n \n     protected abstract FeedItemFilter getFilter();\n \ndiff --git a/app/src/main/res/menu/episodes.xml b/app/src/main/res/menu/episodes.xml\nindex 2841fc12f4..358573c93f 100644\n--- a/app/src/main/res/menu/episodes.xml\n+++ b/app/src/main/res/menu/episodes.xml\n@@ -21,7 +21,7 @@\n         android:icon=\"@drawable/ic_filter\"\n         android:menuCategory=\"container\"\n         android:title=\"@string/filter\"\n-        custom:showAsAction=\"always\"/>\n+        custom:showAsAction=\"ifRoom\"/>\n \n     <item\n         android:id=\"@+id/action_favorites\"\n@@ -30,4 +30,11 @@\n         android:title=\"@string/favorite_episodes_label\"\n         custom:showAsAction=\"always\"/>\n \n+    <item\n+        android:id=\"@+id/episodes_sort\"\n+        android:title=\"@string/sort\"\n+        custom:showAsAction=\"never\">\n+        <menu />\n+    </item>\n+\n </menu>\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/export/favorites/FavoritesWriter.java b/core/src/main/java/de/danoeh/antennapod/core/export/favorites/FavoritesWriter.java\nindex 0923292292..5ccfc93fed 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/export/favorites/FavoritesWriter.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/export/favorites/FavoritesWriter.java\n@@ -18,6 +18,7 @@\n import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.core.storage.DBReader;\n+import de.danoeh.antennapod.model.feed.SortOrder;\n \n /** Writes saved favorites to file. */\n public class FavoritesWriter implements ExportWriter {\n@@ -43,7 +44,7 @@ public void writeDocument(List<Feed> feeds, Writer writer, Context context)\n         String feedTemplate = IOUtils.toString(feedTemplateStream, UTF_8);\n \n         List<FeedItem> allFavorites = DBReader.getRecentlyPublishedEpisodes(0, Integer.MAX_VALUE,\n-                new FeedItemFilter(FeedItemFilter.IS_FAVORITE));\n+                new FeedItemFilter(FeedItemFilter.IS_FAVORITE), SortOrder.DATE_NEW_OLD);\n         Map<Long, List<FeedItem>> favoriteByFeed = getFeedMap(allFavorites);\n \n         writer.append(templateParts[0]);\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\nindex 176a78f0fa..36a056c5d6 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n@@ -52,6 +52,7 @@\n import de.danoeh.antennapod.event.PlayerErrorEvent;\n import de.danoeh.antennapod.event.playback.SleepTimerUpdatedEvent;\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n+import de.danoeh.antennapod.model.feed.SortOrder;\n import de.danoeh.antennapod.playback.base.PlaybackServiceMediaPlayer;\n import de.danoeh.antennapod.playback.base.PlayerStatus;\n import de.danoeh.antennapod.playback.cast.CastPsmp;\n@@ -417,7 +418,7 @@ private List<MediaBrowserCompat.MediaItem> loadChildrenSynchronous(@NonNull Stri\n         } else if (parentId.equals(getResources().getString(R.string.episodes_label))) {\n             feedItems = DBReader.getRecentlyPublishedEpisodes(0,\n                     MAX_ANDROID_AUTO_EPISODES_PER_FEED,\n-                    new FeedItemFilter(FeedItemFilter.UNPLAYED));\n+                    new FeedItemFilter(FeedItemFilter.UNPLAYED), SortOrder.DATE_NEW_OLD);\n         } else if (parentId.startsWith(\"FeedId:\")) {\n             long feedId = Long.parseLong(parentId.split(\":\")[1]);\n             feedItems = DBReader.getFeedItemList(DBReader.getFeed(feedId));\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/storage/DBReader.java b/core/src/main/java/de/danoeh/antennapod/core/storage/DBReader.java\nindex 4641e366c5..62b1db3cb4 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/storage/DBReader.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/storage/DBReader.java\n@@ -366,12 +366,12 @@ private static LongList getFavoriteIDList() {\n      * @param filter The filter describing which episodes to filter out.\n      */\n     @NonNull\n-    public static List<FeedItem> getRecentlyPublishedEpisodes(int offset, int limit, FeedItemFilter filter) {\n+    public static List<FeedItem> getRecentlyPublishedEpisodes(int offset, int limit,\n+                                                              FeedItemFilter filter, SortOrder sortOrder) {\n         Log.d(TAG, \"getRecentlyPublishedEpisodes() called with: offset=\" + offset + \", limit=\" + limit);\n-\n         PodDBAdapter adapter = PodDBAdapter.getInstance();\n         adapter.open();\n-        try (Cursor cursor = adapter.getRecentlyPublishedItemsCursor(offset, limit, filter)) {\n+        try (Cursor cursor = adapter.getRecentlyPublishedItemsCursor(offset, limit, filter, sortOrder)) {\n             List<FeedItem> items = extractItemlistFromCursor(adapter, cursor);\n             loadAdditionalFeedItemListData(items);\n             return items;\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\nindex bcb57f3bbe..bb0218a0b7 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n@@ -45,6 +45,8 @@\n import static de.danoeh.antennapod.model.feed.FeedPreferences.SPEED_USE_GLOBAL;\n import static de.danoeh.antennapod.model.feed.SortOrder.toCodeString;\n \n+import de.danoeh.antennapod.storage.database.mapper.FeedItemSortQuery;\n+\n /**\n  * Implements methods for accessing the database\n  */\n@@ -1059,11 +1061,13 @@ public final Cursor getNewItemsCursor(int offset, int limit) {\n         return db.rawQuery(query, null);\n     }\n \n-    public final Cursor getRecentlyPublishedItemsCursor(int offset, int limit, FeedItemFilter filter) {\n+    public final Cursor getRecentlyPublishedItemsCursor(int offset, int limit,\n+                                                        FeedItemFilter filter, SortOrder sortOrder) {\n+        String orderByQuery = FeedItemSortQuery.generateFrom(sortOrder);\n         String filterQuery = FeedItemFilterQuery.generateFrom(filter);\n         String whereClause = \"\".equals(filterQuery) ? \"\" : \" WHERE \" + filterQuery;\n         final String query = SELECT_FEED_ITEMS_AND_MEDIA + whereClause\n-                + \" ORDER BY \" + KEY_PUBDATE + \" DESC LIMIT \" + offset + \", \" + limit;\n+                + \"ORDER BY \" +  orderByQuery + \" LIMIT \" + offset + \", \" + limit;\n         return db.rawQuery(query, null);\n     }\n \n", "test_patch": "diff --git a/app/src/androidTest/java/de/test/antennapod/playback/PlaybackTest.java b/app/src/androidTest/java/de/test/antennapod/playback/PlaybackTest.java\nindex bb3c0bf670..426a30bb8b 100644\n--- a/app/src/androidTest/java/de/test/antennapod/playback/PlaybackTest.java\n+++ b/app/src/androidTest/java/de/test/antennapod/playback/PlaybackTest.java\n@@ -13,6 +13,7 @@\n \n import de.danoeh.antennapod.core.receiver.MediaButtonReceiver;\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n+import de.danoeh.antennapod.model.feed.SortOrder;\n import de.danoeh.antennapod.playback.base.PlayerStatus;\n import org.awaitility.Awaitility;\n import org.hamcrest.Matcher;\n@@ -252,7 +253,8 @@ protected void startLocalPlayback() {\n         openNavDrawer();\n         onDrawerItem(withText(R.string.episodes_label)).perform(click());\n \n-        final List<FeedItem> episodes = DBReader.getRecentlyPublishedEpisodes(0, 10, FeedItemFilter.unfiltered());\n+        final List<FeedItem> episodes = DBReader.getRecentlyPublishedEpisodes(0, 10,\n+                FeedItemFilter.unfiltered(), SortOrder.DATE_NEW_OLD);\n         Matcher<View> allEpisodesMatcher = allOf(withId(R.id.recyclerView), isDisplayed(), hasMinimumChildCount(2));\n         onView(isRoot()).perform(waitForView(allEpisodesMatcher, 1000));\n         onView(allEpisodesMatcher).perform(actionOnItemAtPosition(0, clickChildViewWithId(R.id.secondaryActionButton)));\n@@ -287,7 +289,8 @@ protected void replayEpisodeCheck(boolean followQueue) throws Exception {\n         uiTestUtils.addLocalFeedData(true);\n         DBWriter.clearQueue().get();\n         activityTestRule.launchActivity(new Intent());\n-        final List<FeedItem> episodes = DBReader.getRecentlyPublishedEpisodes(0, 10, FeedItemFilter.unfiltered());\n+        final List<FeedItem> episodes = DBReader.getRecentlyPublishedEpisodes(0, 10,\n+                FeedItemFilter.unfiltered(), SortOrder.DATE_NEW_OLD);\n \n         startLocalPlayback();\n         FeedMedia media = episodes.get(0).getMedia();\n", "problem_statement": "Add sort option to episodes view screen\n### Checklist\r\n\r\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\r\n\r\n### App version\r\n\r\n2.7.1\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Problem you may be having, or feature you want\r\n\r\nThe episodes view currently doesn't have an option to sort episodes within it. \r\n\r\n### Suggested solution\r\n\r\nAdd a sort option within the episodes screen to allow us to sort by date, duration, etc. \r\n\r\nThis should also give us a toggle to reverse that sort when possible. \r\n\r\n### Screenshots / Drawings / Technical details\r\n\r\n_No response_\n", "hints_text": "You know those Sort options are already available at the top of the three-dot menu, right? Are you suggesting it be moved directly onto the screen, like next to the filter button? \nYep. I mean adding the sort option to the episodes screen rather than the queue screen. ", "created_at": "2023-01-26T16:48:17Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6276, "instance_id": "AntennaPod__AntennaPod-6276", "issue_numbers": ["6650"], "base_commit": "34fb2050b257d81438374bd39d4625be4b580325", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/UserInterfacePreferencesFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/UserInterfacePreferencesFragment.java\nindex c8521caab8..0f3320e980 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/preferences/UserInterfacePreferencesFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/preferences/UserInterfacePreferencesFragment.java\n@@ -1,8 +1,10 @@\n package de.danoeh.antennapod.fragment.preferences;\n \n import android.content.Context;\n+import android.content.DialogInterface;\n import android.os.Build;\n import android.os.Bundle;\n+import android.widget.Button;\n import android.widget.ListView;\n import androidx.appcompat.app.AlertDialog;\n import androidx.core.app.ActivityCompat;\n@@ -64,9 +66,9 @@ private void setupInterfaceScreen() {\n                     return true;\n                 });\n \n-        findPreference(UserPreferences.PREF_COMPACT_NOTIFICATION_BUTTONS)\n+        findPreference(UserPreferences.PREF_FULL_NOTIFICATION_BUTTONS)\n                 .setOnPreferenceClickListener(preference -> {\n-                    showNotificationButtonsDialog();\n+                    showFullNotificationButtonsDialog();\n                     return true;\n                 });\n         findPreference(UserPreferences.PREF_FILTER_FEED)\n@@ -91,48 +93,85 @@ private void setupInterfaceScreen() {\n         }\n     }\n \n-    private void showNotificationButtonsDialog() {\n+\n+    private void showFullNotificationButtonsDialog() {\n         final Context context = getActivity();\n-        final List<Integer> preferredButtons = UserPreferences.getCompactNotificationButtons();\n+\n+        final List<Integer> preferredButtons = UserPreferences.getFullNotificationButtons();\n         final String[] allButtonNames = context.getResources().getStringArray(\n-                R.array.compact_notification_buttons_options);\n+                R.array.full_notification_buttons_options);\n+        final int[] buttonIDs = {2, 3, 4};\n+        final int exactItems = 2;\n+        final DialogInterface.OnClickListener completeListener = (dialog, which) ->\n+                UserPreferences.setFullNotificationButtons(preferredButtons);\n+        final String title = context.getResources().getString(\n+                R.string.pref_full_notification_buttons_title);\n+\n+        showNotificationButtonsDialog(preferredButtons, allButtonNames, buttonIDs, title,\n+                exactItems, completeListener\n+        );\n+    }\n+\n+    private void showNotificationButtonsDialog(List<Integer> preferredButtons,\n+            String[] allButtonNames, int[] buttonIds, String title,\n+            int exactItems, DialogInterface.OnClickListener completeListener) {\n         boolean[] checked = new boolean[allButtonNames.length]; // booleans default to false in java\n \n+        final Context context = getActivity();\n+\n+        // Clear buttons that are not part of the setting anymore\n+        for (int i = preferredButtons.size() - 1; i >= 0; i--) {\n+            boolean isValid = false;\n+            for (int j = 0; j < checked.length; j++) {\n+                if (buttonIds[j] == preferredButtons.get(i)) {\n+                    isValid = true;\n+                }\n+            }\n+\n+            if (!isValid) {\n+                preferredButtons.remove(i);\n+            }\n+        }\n+\n         for(int i=0; i < checked.length; i++) {\n-            if(preferredButtons.contains(i)) {\n+            if (preferredButtons.contains(buttonIds[i])) {\n                 checked[i] = true;\n             }\n         }\n \n         MaterialAlertDialogBuilder builder = new MaterialAlertDialogBuilder(context);\n-        builder.setTitle(String.format(context.getResources().getString(\n-                R.string.pref_compact_notification_buttons_dialog_title), 2));\n+        builder.setTitle(title);\n         builder.setMultiChoiceItems(allButtonNames, checked, (dialog, which, isChecked) -> {\n             checked[which] = isChecked;\n \n             if (isChecked) {\n-                if (preferredButtons.size() < 2) {\n-                    preferredButtons.add(which);\n-                } else {\n-                    // Only allow a maximum of two selections. This is because the notification\n-                    // on the lock screen can only display 3 buttons, and the play/pause button\n-                    // is always included.\n-                    checked[which] = false;\n-                    ListView selectionView = ((AlertDialog) dialog).getListView();\n-                    selectionView.setItemChecked(which, false);\n-                    Snackbar.make(\n-                            selectionView,\n-                            String.format(context.getResources().getString(\n-                                    R.string.pref_compact_notification_buttons_dialog_error), 2),\n-                            Snackbar.LENGTH_SHORT).show();\n-                }\n+                preferredButtons.add(buttonIds[which]);\n             } else {\n-                preferredButtons.remove((Integer) which);\n+                preferredButtons.remove((Integer) buttonIds[which]);\n             }\n         });\n-        builder.setPositiveButton(R.string.confirm_label, (dialog, which) ->\n-                UserPreferences.setCompactNotificationButtons(preferredButtons));\n+        builder.setPositiveButton(R.string.confirm_label, null);\n         builder.setNegativeButton(R.string.cancel_label, null);\n-        builder.create().show();\n+        final AlertDialog dialog = builder.create();\n+\n+        dialog.show();\n+\n+        Button positiveButton = dialog.getButton(AlertDialog.BUTTON_POSITIVE);\n+\n+        positiveButton.setOnClickListener(v -> {\n+            if (preferredButtons.size() != exactItems) {\n+                ListView selectionView = dialog.getListView();\n+                Snackbar.make(\n+                    selectionView,\n+                    String.format(context.getResources().getString(\n+                        R.string.pref_compact_notification_buttons_dialog_error_exact), exactItems),\n+                    Snackbar.LENGTH_SHORT).show();\n+\n+            } else {\n+                completeListener.onClick(dialog, AlertDialog.BUTTON_POSITIVE);\n+                dialog.cancel();\n+            }\n+        }\n+        );\n     }\n }\ndiff --git a/app/src/main/res/xml/preferences_user_interface.xml b/app/src/main/res/xml/preferences_user_interface.xml\nindex 733649ce1b..5cd25d59fd 100644\n--- a/app/src/main/res/xml/preferences_user_interface.xml\n+++ b/app/src/main/res/xml/preferences_user_interface.xml\n@@ -70,9 +70,9 @@\n                 android:summary=\"@string/pref_persistNotify_sum\"\n                 android:title=\"@string/pref_persistNotify_title\"/>\n         <Preference\n-                android:key=\"prefCompactNotificationButtons\"\n-                android:summary=\"@string/pref_compact_notification_buttons_sum\"\n-                android:title=\"@string/pref_compact_notification_buttons_title\"/>\n+                android:key=\"prefFullNotificationButtons\"\n+                android:summary=\"@string/pref_full_notification_buttons_sum\"\n+                android:title=\"@string/pref_full_notification_buttons_title\"/>\n     </PreferenceCategory>\n     <PreferenceCategory android:title=\"@string/behavior\">\n         <de.danoeh.antennapod.preferences.MaterialListPreference\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/receiver/MediaButtonReceiver.java b/core/src/main/java/de/danoeh/antennapod/core/receiver/MediaButtonReceiver.java\nindex 08bdd39bce..161af58e10 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/receiver/MediaButtonReceiver.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/receiver/MediaButtonReceiver.java\n@@ -17,6 +17,8 @@\n public class MediaButtonReceiver extends BroadcastReceiver {\n     private static final String TAG = \"MediaButtonReceiver\";\n     public static final String EXTRA_KEYCODE = \"de.danoeh.antennapod.core.service.extra.MediaButtonReceiver.KEYCODE\";\n+    public static final String EXTRA_CUSTOM_ACTION =\n+            \"de.danoeh.antennapod.core.service.extra.MediaButtonReceiver.CUSTOM_ACTION\";\n     public static final String EXTRA_SOURCE = \"de.danoeh.antennapod.core.service.extra.MediaButtonReceiver.SOURCE\";\n     public static final String EXTRA_HARDWAREBUTTON\n             = \"de.danoeh.antennapod.core.service.extra.MediaButtonReceiver.HARDWAREBUTTON\";\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\nindex 3ef2e22144..b26cf48142 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n@@ -47,6 +47,20 @@\n import androidx.core.app.NotificationManagerCompat;\n import androidx.media.MediaBrowserServiceCompat;\n \n+import de.danoeh.antennapod.core.service.QuickSettingsTileService;\n+import de.danoeh.antennapod.core.util.ChapterUtils;\n+import de.danoeh.antennapod.core.util.playback.PlayableUtils;\n+import de.danoeh.antennapod.event.playback.BufferUpdateEvent;\n+import de.danoeh.antennapod.event.playback.PlaybackServiceEvent;\n+import de.danoeh.antennapod.event.PlayerErrorEvent;\n+import de.danoeh.antennapod.event.playback.SleepTimerUpdatedEvent;\n+import de.danoeh.antennapod.model.feed.Chapter;\n+import de.danoeh.antennapod.model.feed.FeedItemFilter;\n+import de.danoeh.antennapod.playback.base.PlaybackServiceMediaPlayer;\n+import de.danoeh.antennapod.playback.base.PlayerStatus;\n+import de.danoeh.antennapod.playback.cast.CastPsmp;\n+import de.danoeh.antennapod.playback.cast.CastStateListener;\n+\n import org.greenrobot.eventbus.EventBus;\n import org.greenrobot.eventbus.Subscribe;\n import org.greenrobot.eventbus.ThreadMode;\n@@ -126,6 +140,7 @@ public class PlaybackService extends MediaBrowserServiceCompat {\n     private static final String CUSTOM_ACTION_REWIND = \"action.de.danoeh.antennapod.core.service.rewind\";\n     private static final String CUSTOM_ACTION_CHANGE_PLAYBACK_SPEED =\n             \"action.de.danoeh.antennapod.core.service.changePlaybackSpeed\";\n+    public static final String CUSTOM_ACTION_NEXT_CHAPTER = \"action.de.danoeh.antennapod.core.service.next_chapter\";\n \n     /**\n      * Set a max number of episodes to load for Android Auto, otherwise there could be performance issues\n@@ -482,9 +497,10 @@ public int onStartCommand(Intent intent, int flags, int startId) {\n         notificationManager.cancel(R.id.notification_streaming_confirmation);\n \n         final int keycode = intent.getIntExtra(MediaButtonReceiver.EXTRA_KEYCODE, -1);\n+        final String customAction = intent.getStringExtra(MediaButtonReceiver.EXTRA_CUSTOM_ACTION);\n         final boolean hardwareButton = intent.getBooleanExtra(MediaButtonReceiver.EXTRA_HARDWAREBUTTON, false);\n         Playable playable = intent.getParcelableExtra(PlaybackServiceInterface.EXTRA_PLAYABLE);\n-        if (keycode == -1 && playable == null) {\n+        if (keycode == -1 && playable == null && customAction == null) {\n             Log.e(TAG, \"PlaybackService was started with no arguments\");\n             stateManager.stopService();\n             return Service.START_NOT_STICKY;\n@@ -508,7 +524,7 @@ public int onStartCommand(Intent intent, int flags, int startId) {\n                     stateManager.stopService();\n                     return Service.START_NOT_STICKY;\n                 }\n-            } else {\n+            } else if (playable != null) {\n                 stateManager.validStartCommandWasReceived();\n                 boolean allowStreamThisTime = intent.getBooleanExtra(\n                         PlaybackServiceInterface.EXTRA_ALLOW_STREAM_THIS_TIME, false);\n@@ -536,6 +552,8 @@ public int onStartCommand(Intent intent, int flags, int startId) {\n                                     stateManager.stopService();\n                                 });\n                 return Service.START_NOT_STICKY;\n+            } else {\n+                mediaSession.getController().getTransportControls().sendCustomAction(customAction, null);\n             }\n         }\n \n@@ -783,6 +801,7 @@ public WidgetUpdater.WidgetState requestWidgetState() {\n         @Override\n         public void onChapterLoaded(Playable media) {\n             sendNotificationBroadcast(PlaybackServiceInterface.NOTIFICATION_TYPE_RELOAD, 0);\n+            updateMediaSession(mediaPlayer.getPlayerStatus());\n         }\n     };\n \n@@ -1250,20 +1269,35 @@ private void updateMediaSession(final PlayerStatus playerStatus) {\n         WearMediaSession.addWearExtrasToAction(fastForwardBuilder);\n         sessionState.addCustomAction(fastForwardBuilder.build());\n \n-        sessionState.addCustomAction(\n-                new PlaybackStateCompat.CustomAction.Builder(\n-                        CUSTOM_ACTION_CHANGE_PLAYBACK_SPEED,\n-                        getString(R.string.playback_speed),\n-                        R.drawable.ic_notification_playback_speed\n+        if (UserPreferences.showPlaybackSpeedOnFullNotification()) {\n+            sessionState.addCustomAction(\n+                    new PlaybackStateCompat.CustomAction.Builder(\n+                    CUSTOM_ACTION_CHANGE_PLAYBACK_SPEED,\n+                    getString(R.string.playback_speed),\n+                    R.drawable.ic_notification_playback_speed\n                 ).build()\n-        );\n-        sessionState.addCustomAction(\n+            );\n+        }\n+\n+        if (UserPreferences.showNextChapterOnFullNotification()) {\n+            if (getPlayable() != null && getPlayable().getChapters() != null) {\n+                sessionState.addCustomAction(\n+                        new PlaybackStateCompat.CustomAction.Builder(\n+                        CUSTOM_ACTION_NEXT_CHAPTER,\n+                        getString(R.string.next_chapter), R.drawable.ic_notification_next_chapter)\n+                        .build());\n+            }\n+        }\n+\n+        if (UserPreferences.showSkipOnFullNotification()) {\n+            sessionState.addCustomAction(\n                 new PlaybackStateCompat.CustomAction.Builder(\n-                        CUSTOM_ACTION_SKIP_TO_NEXT,\n-                        getString(R.string.skip_episode_label),\n-                        R.drawable.ic_notification_skip\n+                    CUSTOM_ACTION_SKIP_TO_NEXT,\n+                    getString(R.string.skip_episode_label),\n+                    R.drawable.ic_notification_skip\n                 ).build()\n-        );\n+            );\n+        }\n \n         WearMediaSession.mediaSessionSetExtraForWear(mediaSession);\n \n@@ -1812,6 +1846,26 @@ public void onRewind() {\n             seekDelta(-UserPreferences.getRewindSecs() * 1000);\n         }\n \n+        public void onNextChapter() {\n+            List<Chapter> chapters = mediaPlayer.getPlayable().getChapters();\n+            if (chapters == null) {\n+                // No chapters, just fallback to next episode\n+                mediaPlayer.skip();\n+                return;\n+            }\n+\n+            int nextChapter = ChapterUtils.getCurrentChapterIndex(\n+                    mediaPlayer.getPlayable(), mediaPlayer.getPosition()) + 1;\n+\n+            if (chapters.size() < nextChapter + 1) {\n+                // We are on the last chapter, just fallback to the next episode\n+                mediaPlayer.skip();\n+                return;\n+            }\n+\n+            mediaPlayer.seekTo((int) chapters.get(nextChapter).getStart());\n+        }\n+\n         @Override\n         public void onFastForward() {\n             Log.d(TAG, \"onFastForward()\");\n@@ -1884,6 +1938,8 @@ public void onCustomAction(String action, Bundle extra) {\n                 onRewind();\n             } else if (CUSTOM_ACTION_SKIP_TO_NEXT.equals(action)) {\n                 mediaPlayer.skip();\n+            } else if (CUSTOM_ACTION_NEXT_CHAPTER.equals(action)) {\n+                onNextChapter();\n             } else if (CUSTOM_ACTION_CHANGE_PLAYBACK_SPEED.equals(action)) {\n                 List<Float> selectedSpeeds = UserPreferences.getPlaybackSpeedArray();\n \ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackServiceNotificationBuilder.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackServiceNotificationBuilder.java\nindex fe98dbc8f0..471dc74542 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackServiceNotificationBuilder.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackServiceNotificationBuilder.java\n@@ -175,14 +175,12 @@ private void addActions(NotificationCompat.Builder notification, MediaSessionCom\n         ArrayList<Integer> compactActionList = new ArrayList<>();\n \n         int numActions = 0; // we start and 0 and then increment by 1 for each call to addAction\n-        // always let them rewind\n+\n         PendingIntent rewindButtonPendingIntent = getPendingIntentForMediaAction(\n                 KeyEvent.KEYCODE_MEDIA_REWIND, numActions);\n         notification.addAction(R.drawable.ic_notification_fast_rewind, context.getString(R.string.rewind_label),\n                 rewindButtonPendingIntent);\n-        if (UserPreferences.showRewindOnCompactNotification()) {\n-            compactActionList.add(numActions);\n-        }\n+        compactActionList.add(numActions);\n         numActions++;\n \n         if (playerStatus == PlayerStatus.PLAYING) {\n@@ -205,19 +203,24 @@ private void addActions(NotificationCompat.Builder notification, MediaSessionCom\n                 KeyEvent.KEYCODE_MEDIA_FAST_FORWARD, numActions);\n         notification.addAction(R.drawable.ic_notification_fast_forward, context.getString(R.string.fast_forward_label),\n                 ffButtonPendingIntent);\n-        if (UserPreferences.showFastForwardOnCompactNotification()) {\n-            compactActionList.add(numActions);\n-        }\n+        compactActionList.add(numActions);\n         numActions++;\n \n-        PendingIntent skipButtonPendingIntent = getPendingIntentForMediaAction(\n-                KeyEvent.KEYCODE_MEDIA_NEXT, numActions);\n-        notification.addAction(R.drawable.ic_notification_skip, context.getString(R.string.skip_episode_label),\n-                skipButtonPendingIntent);\n-        if (UserPreferences.showSkipOnCompactNotification()) {\n-            compactActionList.add(numActions);\n+        if (UserPreferences.showNextChapterOnFullNotification() && playable.getChapters() != null) {\n+            PendingIntent nextChapterPendingIntent = getPendingIntentForCustomMediaAction(\n+                    PlaybackService.CUSTOM_ACTION_NEXT_CHAPTER, numActions);\n+            notification.addAction(R.drawable.ic_notification_next_chapter, context.getString(R.string.next_chapter),\n+                    nextChapterPendingIntent);\n+            numActions++;\n+        }\n+\n+        if (UserPreferences.showSkipOnFullNotification()) {\n+            PendingIntent skipButtonPendingIntent = getPendingIntentForMediaAction(\n+                    KeyEvent.KEYCODE_MEDIA_NEXT, numActions);\n+            notification.addAction(R.drawable.ic_notification_skip, context.getString(R.string.skip_episode_label),\n+                    skipButtonPendingIntent);\n+            numActions++;\n         }\n-        numActions++;\n \n         PendingIntent stopButtonPendingIntent = getPendingIntentForMediaAction(\n                 KeyEvent.KEYCODE_MEDIA_STOP, numActions);\n@@ -242,6 +245,20 @@ private PendingIntent getPendingIntentForMediaAction(int keycodeValue, int reque\n         }\n     }\n \n+    private PendingIntent getPendingIntentForCustomMediaAction(String action, int requestCode) {\n+        Intent intent = new Intent(context, PlaybackService.class);\n+        intent.setAction(\"MediaAction\" + action);\n+        intent.putExtra(MediaButtonReceiver.EXTRA_CUSTOM_ACTION, action);\n+\n+        if (Build.VERSION.SDK_INT >= 26) {\n+            return PendingIntent.getForegroundService(context, requestCode, intent,\n+                    PendingIntent.FLAG_UPDATE_CURRENT | PendingIntent.FLAG_IMMUTABLE);\n+        } else {\n+            return PendingIntent.getService(context, requestCode, intent, PendingIntent.FLAG_UPDATE_CURRENT\n+                    | (Build.VERSION.SDK_INT >= 23 ? PendingIntent.FLAG_IMMUTABLE : 0));\n+        }\n+    }\n+\n     public void setMediaSessionToken(MediaSessionCompat.Token mediaSessionToken) {\n         this.mediaSessionToken = mediaSessionToken;\n     }\n@@ -253,4 +270,4 @@ public void setPlayerStatus(PlayerStatus playerStatus) {\n     public PlayerStatus getPlayerStatus() {\n         return playerStatus;\n     }\n-}\n\\ No newline at end of file\n+}\ndiff --git a/core/src/main/res/values/arrays.xml b/core/src/main/res/values/arrays.xml\nindex f72a2e1080..7eeab886a8 100644\n--- a/core/src/main/res/values/arrays.xml\n+++ b/core/src/main/res/values/arrays.xml\n@@ -246,10 +246,10 @@\n         <item>DownloadsSection</item>\n     </string-array>\n \n-    <string-array name=\"compact_notification_buttons_options\">\n-        <item>@string/rewind_label</item>\n-        <item>@string/fast_forward_label</item>\n+    <string-array name=\"full_notification_buttons_options\">\n         <item>@string/skip_episode_label</item>\n+        <item>@string/next_chapter</item>\n+        <item>@string/playback_speed</item>\n     </string-array>\n \n     <string-array name=\"default_page_values\">\ndiff --git a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\nindex 7b15584bad..b454ee5a1a 100644\n--- a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n+++ b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n@@ -54,7 +54,7 @@ private UserPreferences(){}\n     public static final String PREF_USE_EPISODE_COVER = \"prefEpisodeCover\";\n     public static final String PREF_SHOW_TIME_LEFT = \"showTimeLeft\";\n     private static final String PREF_PERSISTENT_NOTIFICATION = \"prefPersistNotify\";\n-    public static final String PREF_COMPACT_NOTIFICATION_BUTTONS = \"prefCompactNotificationButtons\";\n+    public static final String PREF_FULL_NOTIFICATION_BUTTONS = \"prefFullNotificationButtons\";\n     private static final String PREF_SHOW_DOWNLOAD_REPORT = \"prefShowDownloadReport\";\n     public static final String PREF_DEFAULT_PAGE = \"prefDefaultPage\";\n     public static final String PREF_FILTER_FEED = \"prefSubscriptionsFilter\";\n@@ -127,9 +127,12 @@ private UserPreferences(){}\n     public static final int EPISODE_CLEANUP_DEFAULT = 0;\n \n     // Constants\n-    private static final int NOTIFICATION_BUTTON_REWIND = 0;\n-    private static final int NOTIFICATION_BUTTON_FAST_FORWARD = 1;\n-    private static final int NOTIFICATION_BUTTON_SKIP = 2;\n+    public static final int NOTIFICATION_BUTTON_REWIND = 0;\n+    public static final int NOTIFICATION_BUTTON_FAST_FORWARD = 1;\n+    public static final int NOTIFICATION_BUTTON_SKIP = 2;\n+\n+    public static final int NOTIFICATION_BUTTON_NEXT_CHAPTER = 3;\n+    public static final int NOTIFICATION_BUTTON_PLAYBACK_SPEED = 4;\n     public static final int EPISODE_CACHE_SIZE_UNLIMITED = -1;\n     public static final int FEED_ORDER_COUNTER = 0;\n     public static final int FEED_ORDER_ALPHABETICAL = 1;\n@@ -195,11 +198,11 @@ public static List<String> getHiddenDrawerItems() {\n         return new ArrayList<>(Arrays.asList(TextUtils.split(hiddenItems, \",\")));\n     }\n \n-    public static List<Integer> getCompactNotificationButtons() {\n+    public static List<Integer> getFullNotificationButtons() {\n         String[] buttons = TextUtils.split(\n-                prefs.getString(PREF_COMPACT_NOTIFICATION_BUTTONS,\n-                        NOTIFICATION_BUTTON_REWIND + \",\" + NOTIFICATION_BUTTON_FAST_FORWARD),\n-                \",\");\n+            prefs.getString(PREF_FULL_NOTIFICATION_BUTTONS,\n+                NOTIFICATION_BUTTON_SKIP + \",\" + NOTIFICATION_BUTTON_PLAYBACK_SPEED), \",\");\n+\n         List<Integer> notificationButtons = new ArrayList<>();\n         for (String button : buttons) {\n             notificationButtons.add(Integer.parseInt(button));\n@@ -208,27 +211,28 @@ public static List<Integer> getCompactNotificationButtons() {\n     }\n \n     /**\n-     * Helper function to return whether the specified button should be shown on compact\n+     * Helper function to return whether the specified button should be shown on full\n      * notifications.\n      *\n-     * @param buttonId Either NOTIFICATION_BUTTON_REWIND, NOTIFICATION_BUTTON_FAST_FORWARD or\n-     *                 NOTIFICATION_BUTTON_SKIP.\n+     * @param buttonId Either NOTIFICATION_BUTTON_REWIND, NOTIFICATION_BUTTON_FAST_FORWARD,\n+     *                 NOTIFICATION_BUTTON_SKIP, NOTIFICATION_BUTTON_PLAYBACK_SPEED\n+     *                 or NOTIFICATION_BUTTON_NEXT_CHAPTER.\n      * @return {@code true} if button should be shown, {@code false}  otherwise\n      */\n-    private static boolean showButtonOnCompactNotification(int buttonId) {\n-        return getCompactNotificationButtons().contains(buttonId);\n+    private static boolean showButtonOnFullNotification(int buttonId) {\n+        return getFullNotificationButtons().contains(buttonId);\n     }\n \n-    public static boolean showRewindOnCompactNotification() {\n-        return showButtonOnCompactNotification(NOTIFICATION_BUTTON_REWIND);\n+    public static boolean showSkipOnFullNotification() {\n+        return showButtonOnFullNotification(NOTIFICATION_BUTTON_SKIP);\n     }\n \n-    public static boolean showFastForwardOnCompactNotification() {\n-        return showButtonOnCompactNotification(NOTIFICATION_BUTTON_FAST_FORWARD);\n+    public static boolean showNextChapterOnFullNotification() {\n+        return showButtonOnFullNotification(NOTIFICATION_BUTTON_NEXT_CHAPTER);\n     }\n \n-    public static boolean showSkipOnCompactNotification() {\n-        return showButtonOnCompactNotification(NOTIFICATION_BUTTON_SKIP);\n+    public static boolean showPlaybackSpeedOnFullNotification() {\n+        return showButtonOnFullNotification(NOTIFICATION_BUTTON_PLAYBACK_SPEED);\n     }\n \n     public static int getFeedOrder() {\n@@ -653,10 +657,10 @@ public static void setHiddenDrawerItems(List<String> items) {\n              .apply();\n     }\n \n-    public static void setCompactNotificationButtons(List<Integer> items) {\n+    public static void setFullNotificationButtons(List<Integer> items) {\n         String str = TextUtils.join(\",\", items);\n         prefs.edit()\n-             .putString(PREF_COMPACT_NOTIFICATION_BUTTONS, str)\n+             .putString(PREF_FULL_NOTIFICATION_BUTTONS, str)\n              .apply();\n     }\n \ndiff --git a/ui/i18n/src/main/res/values/strings.xml b/ui/i18n/src/main/res/values/strings.xml\nindex d7b6aa6cc4..ab65b6c41e 100644\n--- a/ui/i18n/src/main/res/values/strings.xml\n+++ b/ui/i18n/src/main/res/values/strings.xml\n@@ -489,10 +489,9 @@\n     <string name=\"pref_expandNotify_sum\">This usually expands the notification to show playback buttons.</string>\n     <string name=\"pref_persistNotify_title\">Persistent playback controls</string>\n     <string name=\"pref_persistNotify_sum\">Keep notification and lockscreen controls when playback is paused</string>\n-    <string name=\"pref_compact_notification_buttons_title\">Set compact notification buttons</string>\n-    <string name=\"pref_compact_notification_buttons_sum\">Change the playback buttons when the notification is collapsed. The play/pause button is always included.</string>\n-    <string name=\"pref_compact_notification_buttons_dialog_title\">Select a maximum of %1$d items</string>\n-    <string name=\"pref_compact_notification_buttons_dialog_error\">You can only select a maximum of %1$d items.</string>\n+    <string name=\"pref_compact_notification_buttons_dialog_error_exact\">You must select exactly %1$d items.</string>\n+    <string name=\"pref_full_notification_buttons_title\">Set notification buttons</string>\n+    <string name=\"pref_full_notification_buttons_sum\">Change the playback buttons on the playback notification.</string>\n     <string name=\"pref_enqueue_location_title\">Enqueue location</string>\n     <string name=\"pref_enqueue_location_sum\">Add episodes to: %1$s</string>\n     <string name=\"enqueue_location_back\">Back</string>\ndiff --git a/ui/png-icons/src/main/res/drawable/ic_notification_next_chapter.xml b/ui/png-icons/src/main/res/drawable/ic_notification_next_chapter.xml\nnew file mode 100644\nindex 0000000000..cb55e93a99\n--- /dev/null\n+++ b/ui/png-icons/src/main/res/drawable/ic_notification_next_chapter.xml\n@@ -0,0 +1,7 @@\n+<vector xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n+    android:height=\"24dp\"\r\n+    android:width=\"24dp\"\r\n+    android:viewportWidth=\"24\"\r\n+    android:viewportHeight=\"24\">\r\n+    <path android:fillColor=\"#fff\" android:pathData=\"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4M8,8V16L13,12M14,8V16H16V8\" />\r\n+</vector>\r\n", "test_patch": "diff --git a/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java b/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java\nindex 24c20242a8..9ba4276be5 100644\n--- a/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java\n+++ b/app/src/androidTest/java/de/test/antennapod/ui/PreferencesTest.java\n@@ -3,6 +3,7 @@\n import android.content.Intent;\n import android.content.SharedPreferences;\n import android.content.res.Resources;\n+\n import androidx.annotation.StringRes;\n import androidx.preference.PreferenceManager;\n import androidx.test.filters.LargeTest;\n@@ -30,9 +31,7 @@\n import static androidx.test.espresso.action.ViewActions.scrollTo;\n import static androidx.test.espresso.action.ViewActions.swipeDown;\n import static androidx.test.espresso.action.ViewActions.swipeUp;\n-import static androidx.test.espresso.assertion.ViewAssertions.doesNotExist;\n import static androidx.test.espresso.assertion.ViewAssertions.matches;\n-import static androidx.test.espresso.matcher.ViewMatchers.isChecked;\n import static androidx.test.espresso.matcher.ViewMatchers.isDisplayed;\n import static androidx.test.espresso.matcher.ViewMatchers.isRoot;\n import static androidx.test.espresso.matcher.ViewMatchers.withId;\n@@ -40,7 +39,6 @@\n import static de.test.antennapod.EspressoTestUtils.clickPreference;\n import static de.test.antennapod.EspressoTestUtils.waitForView;\n import static java.util.concurrent.TimeUnit.MILLISECONDS;\n-import static org.hamcrest.Matchers.not;\n import static org.junit.Assert.assertFalse;\n import static org.junit.Assert.assertTrue;\n \n@@ -80,38 +78,22 @@ public void testEnablePersistentPlaybackControls() {\n     }\n \n     @Test\n-    public void testSetLockscreenButtons() {\n+    public void testSetNotificationButtons() {\n         clickPreference(R.string.user_interface_label);\n-        String[] buttons = res.getStringArray(R.array.compact_notification_buttons_options);\n-        clickPreference(R.string.pref_compact_notification_buttons_title);\n+        String[] buttons = res.getStringArray(R.array.full_notification_buttons_options);\n+        clickPreference(R.string.pref_full_notification_buttons_title);\n         // First uncheck checkboxes\n-        onView(withText(buttons[0])).perform(click());\n-        onView(withText(buttons[1])).perform(click());\n-\n-        // Now try to check all checkboxes\n-        onView(withText(buttons[0])).perform(click());\n         onView(withText(buttons[1])).perform(click());\n         onView(withText(buttons[2])).perform(click());\n \n-        // Make sure that the third checkbox is unchecked\n-        onView(withText(buttons[2])).check(matches(not(isChecked())));\n-\n-        String snackBarText = String.format(res.getString(\n-                R.string.pref_compact_notification_buttons_dialog_error), 2);\n-        Awaitility.await().ignoreExceptions().atMost(4000, MILLISECONDS)\n-                .until(() -> {\n-                    onView(withText(snackBarText)).check(doesNotExist());\n-                    return true;\n-                });\n-\n         onView(withText(R.string.confirm_label)).perform(click());\n \n         Awaitility.await().atMost(1000, MILLISECONDS)\n-                .until(UserPreferences::showRewindOnCompactNotification);\n+                .until(() -> UserPreferences.showSkipOnFullNotification());\n         Awaitility.await().atMost(1000, MILLISECONDS)\n-                .until(UserPreferences::showFastForwardOnCompactNotification);\n+                .until(() -> UserPreferences.showNextChapterOnFullNotification());\n         Awaitility.await().atMost(1000, MILLISECONDS)\n-                .until(() -> !UserPreferences.showSkipOnCompactNotification());\n+                .until(() -> !UserPreferences.showPlaybackSpeedOnFullNotification());\n     }\n \n     @Test\n", "problem_statement": "Hide option to configure compact notification\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\n- [X] I will describe the problem with as much detail as possible.\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\n\n### App version\n\n3.1.0\n\n### Where did you get the app from\n\nF-Droid\n\n### Problem you may be having, or feature you want\n\nOn Android 13 I wasn't able to get the media notification in the compact state, so I guess that this compact state has been removed from the OS. \n\n### Suggested solution\n\nTherefore the setting to configure the compact media notification can be hidden on Android 13 and higher.\n\n### Screenshots / Drawings / Technical details\n\n_No response_\n", "hints_text": "", "created_at": "2023-01-18T09:55:06Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6266, "instance_id": "AntennaPod__AntennaPod-6266", "issue_numbers": ["6214"], "base_commit": "ccea00e4056b85d5be0ebfa898a1ac961c2e3c56", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/fragment/InboxFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/InboxFragment.java\nindex 37cd40b0e1..c04adee6d9 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/InboxFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/InboxFragment.java\n@@ -4,6 +4,8 @@\n import android.content.SharedPreferences;\n import android.os.Bundle;\n import android.view.LayoutInflater;\n+import android.view.Menu;\n+import android.view.MenuInflater;\n import android.view.MenuItem;\n import android.view.View;\n import android.view.ViewGroup;\n@@ -20,6 +22,8 @@\n import de.danoeh.antennapod.core.storage.DBWriter;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n+import de.danoeh.antennapod.model.feed.SortOrder;\n+import de.danoeh.antennapod.storage.preferences.UserPreferences;\n \n import java.util.List;\n \n@@ -38,6 +42,8 @@ public class InboxFragment extends EpisodesListFragment {\n     public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {\n         final View root = super.onCreateView(inflater, container, savedInstanceState);\n         toolbar.inflateMenu(R.menu.inbox);\n+        inflateSortMenu();\n+\n         toolbar.setTitle(R.string.inbox_label);\n         prefs = getActivity().getSharedPreferences(PREF_NAME, Context.MODE_PRIVATE);\n         updateToolbar();\n@@ -77,6 +83,13 @@ public boolean onMenuItemClick(MenuItem item) {\n                 showRemoveAllDialog();\n             }\n             return true;\n+        } else {\n+            SortOrder sortOrder = MenuItemToSortOrderConverter.convert(item);\n+            if (sortOrder != null) {\n+                UserPreferences.setInboxSortedOrder(sortOrder);\n+                loadItems();\n+                return true;\n+            }\n         }\n         return false;\n     }\n@@ -84,13 +97,14 @@ public boolean onMenuItemClick(MenuItem item) {\n     @NonNull\n     @Override\n     protected List<FeedItem> loadData() {\n-        return DBReader.getNewItemsList(0, page * EPISODES_PER_PAGE);\n+        return DBReader.getNewItemsList(0, page * EPISODES_PER_PAGE, UserPreferences.getInboxSortedOrder());\n     }\n \n     @NonNull\n     @Override\n     protected List<FeedItem> loadMoreData(int page) {\n-        return DBReader.getNewItemsList((page - 1) * EPISODES_PER_PAGE, EPISODES_PER_PAGE);\n+        return DBReader.getNewItemsList((page - 1) * EPISODES_PER_PAGE, EPISODES_PER_PAGE,\n+                UserPreferences.getInboxSortedOrder());\n     }\n \n     @Override\n@@ -103,6 +117,20 @@ private void removeAllFromInbox() {\n         ((MainActivity) getActivity()).showSnackbarAbovePlayer(R.string.removed_all_inbox_msg, Toast.LENGTH_SHORT);\n     }\n \n+    private void inflateSortMenu() {\n+        Menu menu = toolbar.getMenu();\n+        MenuItem downloadsItem = menu.findItem(R.id.inbox_sort);\n+        MenuInflater menuInflater = getActivity().getMenuInflater();\n+        menuInflater.inflate(R.menu.sort_menu, downloadsItem.getSubMenu());\n+\n+        // Remove the sorting options that are not needed in this fragment\n+        toolbar.getMenu().findItem(R.id.sort_episode_title).setVisible(false);\n+        toolbar.getMenu().findItem(R.id.sort_feed_title).setVisible(false);\n+        toolbar.getMenu().findItem(R.id.sort_random).setVisible(false);\n+        toolbar.getMenu().findItem(R.id.sort_smart_shuffle).setVisible(false);\n+        toolbar.getMenu().findItem(R.id.keep_sorted).setVisible(false);\n+    }\n+\n     private void showRemoveAllDialog() {\n         MaterialAlertDialogBuilder builder = new MaterialAlertDialogBuilder(getContext());\n         builder.setTitle(R.string.remove_all_inbox_label);\ndiff --git a/app/src/main/java/de/danoeh/antennapod/ui/home/sections/InboxSection.java b/app/src/main/java/de/danoeh/antennapod/ui/home/sections/InboxSection.java\nindex e635e9538b..6baea05e68 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/home/sections/InboxSection.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/home/sections/InboxSection.java\n@@ -27,6 +27,7 @@\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n import de.danoeh.antennapod.storage.database.PodDBAdapter;\n+import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import de.danoeh.antennapod.ui.home.HomeSection;\n import io.reactivex.Observable;\n import io.reactivex.android.schedulers.AndroidSchedulers;\n@@ -125,7 +126,7 @@ private void loadItems() {\n             disposable.dispose();\n         }\n         disposable = Observable.fromCallable(() ->\n-                        new Pair<>(DBReader.getNewItemsList(0, NUM_EPISODES),\n+                        new Pair<>(DBReader.getNewItemsList(0, NUM_EPISODES, UserPreferences.getInboxSortedOrder()),\n                                 PodDBAdapter.getInstance().getNumberOfNewItems()))\n                 .subscribeOn(Schedulers.io())\n                 .observeOn(AndroidSchedulers.mainThread())\ndiff --git a/app/src/main/res/menu/inbox.xml b/app/src/main/res/menu/inbox.xml\nindex a284a2f566..fba8eefdb9 100644\n--- a/app/src/main/res/menu/inbox.xml\n+++ b/app/src/main/res/menu/inbox.xml\n@@ -15,6 +15,12 @@\n         custom:showAsAction=\"always\"\n         android:icon=\"@drawable/ic_refresh\"/>\n \n+    <item\n+        android:id=\"@+id/inbox_sort\"\n+        android:title=\"@string/sort\">\n+        <menu></menu>\n+    </item>\n+\n     <item\n         android:id=\"@+id/remove_all_inbox_item\"\n         android:title=\"@string/remove_all_inbox_label\"\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/storage/AutomaticDownloadAlgorithm.java b/core/src/main/java/de/danoeh/antennapod/core/storage/AutomaticDownloadAlgorithm.java\nindex 5fbbbbc19b..c9f37fd009 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/storage/AutomaticDownloadAlgorithm.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/storage/AutomaticDownloadAlgorithm.java\n@@ -7,6 +7,7 @@\n import java.util.Iterator;\n import java.util.List;\n \n+import de.danoeh.antennapod.model.feed.SortOrder;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadRequest;\n import de.danoeh.antennapod.core.service.download.DownloadRequestCreator;\n import de.danoeh.antennapod.net.download.serviceinterface.DownloadServiceInterface;\n@@ -52,7 +53,7 @@ public Runnable autoDownloadUndownloadedItems(final Context context) {\n \n                 List<FeedItem> candidates;\n                 final List<FeedItem> queue = DBReader.getQueue();\n-                final List<FeedItem> newItems = DBReader.getNewItemsList(0, Integer.MAX_VALUE);\n+                final List<FeedItem> newItems = DBReader.getNewItemsList(0, Integer.MAX_VALUE, SortOrder.DATE_NEW_OLD);\n                 candidates = new ArrayList<>(queue.size() + newItems.size());\n                 candidates.addAll(queue);\n                 for (FeedItem newItem : newItems) {\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/storage/DBReader.java b/core/src/main/java/de/danoeh/antennapod/core/storage/DBReader.java\nindex 62b1db3cb4..b762843475 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/storage/DBReader.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/storage/DBReader.java\n@@ -328,12 +328,12 @@ public static List<FeedItem> getPlayedItems() {\n      * @param limit The maximum number of episodes that should be loaded.\n      * @return A list of FeedItems that are considered new.\n      */\n-    public static List<FeedItem> getNewItemsList(int offset, int limit) {\n+    public static List<FeedItem> getNewItemsList(int offset, int limit, SortOrder sortOrder) {\n         Log.d(TAG, \"getNewItemsList() called\");\n \n         PodDBAdapter adapter = PodDBAdapter.getInstance();\n         adapter.open();\n-        try (Cursor cursor = adapter.getNewItemsCursor(offset, limit)) {\n+        try (Cursor cursor = adapter.getNewItemsCursor(offset, limit, sortOrder)) {\n             List<FeedItem> items = extractItemlistFromCursor(adapter, cursor);\n             loadAdditionalFeedItemListData(items);\n             return items;\ndiff --git a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\nindex 0909ea4b70..825dea84ec 100644\n--- a/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n+++ b/storage/database/src/main/java/de/danoeh/antennapod/storage/database/PodDBAdapter.java\n@@ -1054,14 +1054,14 @@ public void setFeedItems(int oldState, int newState, long feedId) {\n      * Excludes those feeds that do not have 'Keep Updated' enabled.\n      * The returned cursor uses the FEEDITEM_SEL_FI_SMALL selection.\n      */\n-    public final Cursor getNewItemsCursor(int offset, int limit) {\n+    public final Cursor getNewItemsCursor(int offset, int limit, SortOrder sortOrder) {\n+        String sortQuery = FeedItemSortQuery.generateFrom(sortOrder);\n         final String query = SELECT_FEED_ITEMS_AND_MEDIA\n                 + \" INNER JOIN \" + TABLE_NAME_FEEDS\n                 + \" ON \" + TABLE_NAME_FEED_ITEMS + \".\" + KEY_FEED + \"=\" + TABLE_NAME_FEEDS + \".\" + KEY_ID\n                 + \" WHERE \" + TABLE_NAME_FEED_ITEMS + \".\" + KEY_READ + \"=\" + FeedItem.NEW\n                     + \" AND \" + TABLE_NAME_FEEDS + \".\" + KEY_KEEP_UPDATED + \" > 0\"\n-                + \" ORDER BY \" + TABLE_NAME_FEED_ITEMS + \".\" + KEY_PUBDATE + \" DESC\"\n-                + \" LIMIT \" + offset + \", \" + limit;\n+                + \" ORDER BY \" + sortQuery + \" LIMIT \" + offset + \", \" + limit;\n         return db.rawQuery(query, null);\n     }\n \ndiff --git a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\nindex 93792121b2..92acb6319e 100644\n--- a/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n+++ b/storage/preferences/src/main/java/de/danoeh/antennapod/storage/preferences/UserPreferences.java\n@@ -70,6 +70,7 @@ private UserPreferences(){}\n     public static final String PREF_QUEUE_KEEP_SORTED_ORDER = \"prefQueueKeepSortedOrder\";\n     public static final String PREF_NEW_EPISODES_ACTION = \"prefNewEpisodesAction\";\n     private static final String PREF_DOWNLOADS_SORTED_ORDER = \"prefDownloadSortedOrder\";\n+    private static final String PREF_INBOX_SORTED_ORDER = \"prefInboxSortedOrder\";\n \n     // Playback\n     public static final String PREF_PAUSE_ON_HEADSET_DISCONNECT = \"prefPauseOnHeadsetDisconnect\";\n@@ -942,12 +943,18 @@ public static SortOrder getDownloadsSortedOrder() {\n      * Sets the sort order for the downloads.\n      */\n     public static void setDownloadsSortedOrder(SortOrder sortOrder) {\n-        if (sortOrder == null) {\n-            return;\n-        }\n         prefs.edit().putString(PREF_DOWNLOADS_SORTED_ORDER, \"\" + sortOrder.code).apply();\n     }\n \n+    public static SortOrder getInboxSortedOrder() {\n+        String sortOrderStr = prefs.getString(PREF_INBOX_SORTED_ORDER, \"\" + SortOrder.DATE_NEW_OLD.code);\n+        return SortOrder.fromCodeString(sortOrderStr);\n+    }\n+\n+    public static void setInboxSortedOrder(SortOrder sortOrder) {\n+        prefs.edit().putString(PREF_INBOX_SORTED_ORDER, \"\" + sortOrder.code).apply();\n+    }\n+\n     public static SubscriptionsFilter getSubscriptionsFilter() {\n         String value = prefs.getString(PREF_FILTER_FEED, \"\");\n         return new SubscriptionsFilter(value);\n", "test_patch": "diff --git a/core/src/test/java/de/danoeh/antennapod/core/storage/DbReaderTest.java b/core/src/test/java/de/danoeh/antennapod/core/storage/DbReaderTest.java\nindex c44c6ae433..886c6821bc 100644\n--- a/core/src/test/java/de/danoeh/antennapod/core/storage/DbReaderTest.java\n+++ b/core/src/test/java/de/danoeh/antennapod/core/storage/DbReaderTest.java\n@@ -10,9 +10,11 @@\n import java.util.Random;\n \n import androidx.test.platform.app.InstrumentationRegistry;\n+\n import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedMedia;\n+import de.danoeh.antennapod.model.feed.SortOrder;\n import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import de.danoeh.antennapod.core.util.LongList;\n import de.danoeh.antennapod.storage.database.PodDBAdapter;\n@@ -281,7 +283,7 @@ public void testGetNewItemIds() {\n             for (int i = 0; i < newItems.size(); i++) {\n                 unreadIds[i] = newItems.get(i).getId();\n             }\n-            List<FeedItem> newItemsSaved = DBReader.getNewItemsList(0, Integer.MAX_VALUE);\n+            List<FeedItem> newItemsSaved = DBReader.getNewItemsList(0, Integer.MAX_VALUE, SortOrder.DATE_NEW_OLD);\n             assertNotNull(newItemsSaved);\n             assertEquals(newItemsSaved.size(), newItems.size());\n             for (FeedItem feedItem : newItemsSaved) {\n", "problem_statement": "Add option to switch a- & descending sort order for Inbox\n### Checklist\r\n\r\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same feature request.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] This request contains only one single feature, **not** a list of multiple (related) features.\r\n\r\n### App version\r\n\r\n2.7.1\r\n\r\n### Where did you get the app from\r\n\r\nF-Droid\r\n\r\n### Problem you may be having, or feature you want\r\n\r\nIt would be **so** nice to have, at last, the **option of an inbox in chronological order**.\r\n\r\nI am coming back to Antennapod after a hiatus and now I remember the main reason I left. **The queue is sortable, but for some reason the inbox is not.** This seems verging on bug-like but I guess it's just an oversight. I am well aware that only a minority of crazy people like to do things in chronological order.\r\n\r\nPlease allow me a digression on the form of a good-faith rant about sort order. Rant begins HERE. _I don't get it. Why would anyone want to deal with an inbox from bottom to top? What am I not understanding? Do we read books from bottom to top? Lists? Timetables? Anything at all? The podcasts arrived in an order - chronological order. Perhaps they are news, in which case the most recent ones are dependent on previous ones for context. Perhaps they are episodes in a series, or chapters in an audiobook. It seems to me so obviously inefficient to be working through a list backwards (or scrolling upwards) that I keep thinking I must have missed something. Have I? I suspect not, but it's a serious question._ Rant ends.\r\n\r\nGmail does this too BTW. Impossible to sort in chronological order - newest first, take it or leave it (but oddly the Conversation View is chronological). I don't use evil Gmail but Antennapod is a great FOSS project, probably even the best podcast client out there.\r\n\r\n### Suggested solution\r\n\r\nAn option to sort the Inbox into chronological order.\r\n\r\nFor those weirdos among us who like to deal with podcasts in the same order they dropped, this \"feature\" would be very, very much appreciated. Thanks for considering.\r\n\r\n### Screenshots / Drawings / Technical details\r\n\r\n_No response_\n", "hints_text": "Hi @Friptick,\n\nTwo thoughts:\n* No need for a rant \u2013 we also accept feature requests if they simply make sense ;-) (Also: you're speaking of 'at last' \u2013 sounds like you should've made this feature request earlier instead of cropping up frustration ^^)\n* The inbox _is_ in chronological order, just not of the sort you would like to see (oldest first).\n\nI don't see a reason not to introduce a 'Reverse sort order' option for the Inbox, behind the three dots in the top bar.\nThanks.\r\n\r\n>No need for a rant\r\n\r\nRest assured the rant was not directed at you, it was directed at the whole world. :)\r\n\r\n>sounds like you should've made this feature request earlier instead of cropping up frustration ^^\r\n\r\nI was one of the users who campaigned for the sort options on the queue. I guess I just ran out of energy for campaigning.\r\n\r\n>The inbox is in chronological order\r\n\r\nNo it's not. It is in reverse-chronological order. It's the innovation introduced by [blogging](https://en.wikipedia.org/wiki/Blog) (\"Posts are typically displayed in reverse chronological order so that the most recent post appears first\"). That's fine when you have one new blog post to read each time you visit a web page. It never made any sense for a feed of 100 items where (1) you don't want to miss anything, (2) \"mark as read\" exists, and (3) content is inter-related. But what do I know, hey? Nobody else is complaining, you're right. :) Seriously, I would so love to hear a counter-argument one day.\r\n\r\n>I don't see a reason not to introduce a 'Reverse sort order' option for the Inbox, behind the three dots in the top bar.\r\n\r\nYep exactly, that was where I was surprised not to find it.\r\n\r\nIf I had any experience at all with Android dev, I promise I would do this myself and submit a PR.\r\n\r\nThanks.", "created_at": "2023-01-09T10:50:52Z"}
{"repo": "AntennaPod/AntennaPod", "pull_number": 6259, "instance_id": "AntennaPod__AntennaPod-6259", "issue_numbers": ["5909"], "base_commit": "7ed78887c4411762f1fff67d3ca2330deaec2cac", "patch": "diff --git a/app/src/main/java/de/danoeh/antennapod/dialog/RemoveFeedDialog.java b/app/src/main/java/de/danoeh/antennapod/dialog/RemoveFeedDialog.java\nindex 23c032248b..363b87ca6c 100644\n--- a/app/src/main/java/de/danoeh/antennapod/dialog/RemoveFeedDialog.java\n+++ b/app/src/main/java/de/danoeh/antennapod/dialog/RemoveFeedDialog.java\n@@ -5,6 +5,8 @@\n import android.content.DialogInterface;\n import android.util.Log;\n \n+import androidx.annotation.Nullable;\n+\n import java.util.Collections;\n import java.util.List;\n \n@@ -19,21 +21,26 @@\n public class RemoveFeedDialog {\n     private static final String TAG = \"RemoveFeedDialog\";\n \n-    public static void show(Context context, Feed feed) {\n+    public static void show(Context context, Feed feed, @Nullable Runnable callback) {\n         List<Feed> feeds = Collections.singletonList(feed);\n         String message = getMessageId(context, feeds);\n-        showDialog(context, feeds, message);\n+        showDialog(context, feeds, message, callback);\n     }\n \n     public static void show(Context context, List<Feed> feeds) {\n         String message = getMessageId(context, feeds);\n-        showDialog(context, feeds, message);\n+        showDialog(context, feeds, message, null);\n     }\n \n-    private static void showDialog(Context context, List<Feed> feeds, String message) {\n+    private static void showDialog(Context context, List<Feed> feeds, String message, @Nullable Runnable callback) {\n         ConfirmationDialog dialog = new ConfirmationDialog(context, R.string.remove_feed_label, message) {\n             @Override\n             public void onConfirmButtonPressed(DialogInterface clickedDialog) {\n+\n+                if (callback != null) {\n+                    callback.run();\n+                }\n+\n                 clickedDialog.dismiss();\n \n                 ProgressDialog progressDialog = new ProgressDialog(context);\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/FeedItemlistFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/FeedItemlistFragment.java\nindex ecc60c4115..61883afe7e 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/FeedItemlistFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/FeedItemlistFragment.java\n@@ -61,6 +61,7 @@\n import de.danoeh.antennapod.model.feed.Feed;\n import de.danoeh.antennapod.model.feed.FeedItem;\n import de.danoeh.antennapod.model.feed.FeedItemFilter;\n+import de.danoeh.antennapod.storage.preferences.UserPreferences;\n import de.danoeh.antennapod.ui.glide.FastBlurTransformation;\n import de.danoeh.antennapod.view.ToolbarIconTintManager;\n import de.danoeh.antennapod.view.viewholder.EpisodeItemViewHolder;\n@@ -270,8 +271,11 @@ public boolean onMenuItemClick(MenuItem item) {\n             new RenameItemDialog(getActivity(), feed).show();\n             return true;\n         } else if (itemId == R.id.remove_feed) {\n-            ((MainActivity) getActivity()).loadFragment(AllEpisodesFragment.TAG, null);\n-            RemoveFeedDialog.show(getContext(), feed);\n+            RemoveFeedDialog.show(getContext(), feed, () -> {\n+                ((MainActivity) getActivity()).loadFragment(UserPreferences.getDefaultPage(), null);\n+                // Make sure fragment is hidden before actually starting to delete\n+                getActivity().getSupportFragmentManager().executePendingTransactions();\n+            });\n             return true;\n         } else if (itemId == R.id.action_search) {\n             ((MainActivity) getActivity()).loadChildFragment(SearchFragment.newInstance(feed.getId(), feed.getTitle()));\ndiff --git a/app/src/main/java/de/danoeh/antennapod/fragment/NavDrawerFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/NavDrawerFragment.java\nindex e155e467d1..ecb24a1e17 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/NavDrawerFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/NavDrawerFragment.java\n@@ -175,8 +175,13 @@ public void onConfirmButtonPressed(DialogInterface dialog) {\n             new RenameItemDialog(getActivity(), feed).show();\n             return true;\n         } else if (itemId == R.id.remove_feed) {\n-            ((MainActivity) getActivity()).loadFragment(AllEpisodesFragment.TAG, null);\n-            RemoveFeedDialog.show(getContext(), feed);\n+            RemoveFeedDialog.show(getContext(), feed, () -> {\n+                if (String.valueOf(feed.getId()).equals(getLastNavFragment(getContext()))) {\n+                    ((MainActivity) getActivity()).loadFragment(UserPreferences.getDefaultPage(), null);\n+                    // Make sure fragment is hidden before actually starting to delete\n+                    getActivity().getSupportFragmentManager().executePendingTransactions();\n+                }\n+            });\n             return true;\n         }\n         return super.onContextItemSelected(item);\ndiff --git a/app/src/main/java/de/danoeh/antennapod/menuhandler/FeedMenuHandler.java b/app/src/main/java/de/danoeh/antennapod/menuhandler/FeedMenuHandler.java\nindex e9b0c0b19d..9b95251334 100644\n--- a/app/src/main/java/de/danoeh/antennapod/menuhandler/FeedMenuHandler.java\n+++ b/app/src/main/java/de/danoeh/antennapod/menuhandler/FeedMenuHandler.java\n@@ -126,7 +126,7 @@ public void onConfirmButtonPressed(DialogInterface clickedDialog) {\n         } else if (menuItemId == R.id.rename_item) {\n             new RenameItemDialog(fragment.getActivity(), selectedFeed).show();\n         } else if (menuItemId == R.id.remove_feed) {\n-            RemoveFeedDialog.show(context, selectedFeed);\n+            RemoveFeedDialog.show(context, selectedFeed, null);\n         } else {\n             return false;\n         }\n", "test_patch": "", "problem_statement": "Do not switch screens when clicking \"Remove podcast\"\n### Checklist\n\n- [X] I have used the search function for [open](https://github.com/AntennaPod/AntennaPod/issues) **and** [closed](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n2.6.0-beta1\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n12\n\n### Device model\n\n_No response_\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\nCurrently, removing a podcast from within the podcast or from the Subscription list in the sidebar (but not from the Subscriptions screen) ends with the user being shown the Episodes screen.\r\nIn addition, the user is taken to the Episodes screen even before they have confirmed they actually want to remove the podcast.\n\n### Expected behaviour\n\nIt would be more intuitive if (1) the user was taken back to the previous screen instead (which I suspect would be the Subscriptions screen in many cases, but probably not all), (2) and only after confirming they want to remove a podcast.\n\n### Current behaviour\n\n(See steps to reproduce)\n\n### Logs\n\n_No response_\n", "hints_text": "The reason that the page redirects is that deleting a subscription while showing its page sometimes caused crashes. So this might need a bit of testing to get it right.", "created_at": "2023-01-03T09:36:51Z"}
